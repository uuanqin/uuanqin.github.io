{"title":"实现网站国内外分流（境外接入 Cloudflare）","tags":["DNS","DNSPod","CDN","Cloudflare","SaaS","PayPal","us.kg","hexo","GitHub","GitHub Page"],"cover":"https://cdn.gallery.uuanqin.top/img/202412100327066.webp","description":"要补课的站长请点进来","categories":["博客站点维护"],"abbrlink":"55893d1","date":"2024-12-10T03:28:48.000Z","top_img":null,"swiper_index":4,"swiper_desc":"博主精选","swiper_cover":"https://cdn.gallery.uuanqin.top/img/202412100327066.webp","summary":"前不久我在 [[域名 DNS 服务托管至 Cloudflare 以及 301 重定向的配置|这篇文章]] 中提到我的 `uuanqin.top` 域名 DNS 全线接入 Cloudflare，很多小伙伴反馈说 cf 国内访问速度很不稳定，时快时慢（有一部分是我乱套 CDN 的原因），于是我打算这段时间就致力于解决这个问题。 通过不同方案的探索并结合自己的实际情况终于试出来了，现记录操作思路。 效果预览 | 分流方式 | 境内访问 | 境外访问 | 备注 | | ----------------- | ----------------- | ----------------------- | ----------------------------------------------------------------------------- | | 只使用腾讯云 CDN（境内加速） | 🟩<50 ms | 🟧300ms<br>🔴部分超时 | 没买境外套餐包的话，境外加速流量 按量计费。 | | 只使用 Cloudflare 代理 | 🟨200ms<br>🔴部分超时 | 🟩<50 ms <!-- 以防合并1 --> | 国内访问极其不稳定，忽快忽慢。「减速 CDN」果然名不虚传。 | | 双线自动分流后 | 🟩<50 ms | 🟩<50 ms | 🎉 访客对于分线过程无感知 | 境内用境内 CDN，境外用境外 CDN，取长补短。为了更加节省开支或避免由于攻击造成的高额账单，国内线路可以不用 CDN，直接连接国内源站。 数据来源：blog.uuanqin.top_在线ping-ITDOG 原理简述 > 思路浓缩在这里了 阿里云云解析 DNS / 腾讯云 DNSPod 支持境内外分线解析，`blog.uuanqin.top` 将根据用户 IP 选择合适的线路。由于 `blog.uuanqin.top` 配置的是 `CNAME` 的记录类型，访客对于分线过程无感知，浏览器地址栏不变。 利用 Cloudflare for SaaS 实现 `blog.uuanqin.top` CNAME 指向中间域名 `cname.qinq.us.kg`，进而通过 Cloudflare 管理其 DNS 记录，再 CNAME/A 到源站。..."}