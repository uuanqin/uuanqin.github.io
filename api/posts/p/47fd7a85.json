{"data":{"title":"æ ‘çŠ¶æ•°ç»„ä¸Šæ‰‹äº†å°±ååˆ†ç®€å•","slug":"ç®—æ³•ä¸æ•°æ®ç»“æ„/æ ‘çŠ¶æ•°ç»„ä¸Šæ‰‹äº†å°±ååˆ†ç®€å•","description":"ç†è§£èµ·æ¥å¯éš¾äº†","date":"2025-09-24T15:26:16.000Z","updated":"2026-02-01T06:20:05.478Z","language":"zh-CN","comments":true,"url":"p/47fd7a85/","cover":"https://cdn.gallery.uuanqin.top/img/202510212301010.webp","images":[],"content":"<p>æœ¬æ–‡é¢˜ç›®éš¾åº¦æ ‡è¯†ï¼šğŸŸ©ç®€å•ï¼ŒğŸŸ¨ä¸­ç­‰ï¼ŒğŸŸ¥å›°éš¾ã€‚</p>\n<h1 id=\"ç›´è§‚æ„Ÿå—æ ‘çŠ¶æ•°ç»„\"><a class=\"markdownIt-Anchor\" href=\"#ç›´è§‚æ„Ÿå—æ ‘çŠ¶æ•°ç»„\"></a> ç›´è§‚æ„Ÿå—æ ‘çŠ¶æ•°ç»„</h1>\n<p>æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§æ”¯æŒã€Œå•ç‚¹ä¿®æ”¹ã€å’Œã€ŒåŒºé—´æŸ¥è¯¢ã€çš„ï¼Œä»£ç é‡å°çš„æ•°æ®ç»“æ„ï¼š</p>\n<ul>\n<li>å•ç‚¹ä¿®æ”¹ï¼šç»™å®šæ•°ç»„ <code>arr</code>ï¼Œå°† <code>arr[i]</code> è‡ªå¢ä¸º <code>k</code>ã€‚è¿™é‡Œçš„è‡ªå¢å¯ä»¥æ˜¯èµ‹å€¼ç­‰å…¶ä»–æ“ä½œã€‚</li>\n<li>åŒºé—´æŸ¥è¯¢ï¼šç»™å®š <code>l</code>ã€<code>r</code>ï¼Œæ±‚ <code>arr[l..r]</code> çš„å’Œæˆ–å…¶ä»–åŒºé—´ç‰¹å¾ã€‚</li>\n</ul>\n<p>æ™®é€šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„ä¿¡æ¯åŠè¿ç®—è¦æ»¡è¶³ ç»“åˆå¾‹ ä¸” å¯å·®åˆ†ï¼Œå¦‚åŠ æ³•ï¼ˆå’Œï¼‰ã€ä¹˜æ³•ï¼ˆç§¯ï¼‰ã€å¼‚æˆ–ç­‰ã€‚</p>\n<ul>\n<li>ç»“åˆå¾‹ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>âˆ˜</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>âˆ˜</mo><mi>z</mi><mo>=</mo><mi>x</mi><mo>âˆ˜</mo><mo stretchy=\"false\">(</mo><mi>y</mi><mo>âˆ˜</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x\\circ y)\\circ z = x\\circ (y\\circ z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ˜</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ˜</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ˜</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ˜</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>å¯å·®åˆ†ï¼šå…·æœ‰é€†è¿ç®—çš„è¿ç®—ï¼Œå³å·²çŸ¥ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>âˆ˜</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x\\circ y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ˜</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> å’Œ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>ï¼Œå¯æ±‚å‡º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>ã€‚</li>\n</ul>\n<p>äº‹å®ä¸Šï¼Œæ ‘çŠ¶æ•°ç»„èƒ½è§£å†³çš„é—®é¢˜æ˜¯ <a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/10ab676/\"><span class=\"bilink-pop-up\">ç«™å†…æ–‡ç« </span>çº¿æ®µæ ‘</a> èƒ½è§£å†³çš„é—®é¢˜çš„å­é›†ï¼šæ ‘çŠ¶æ•°ç»„èƒ½åšçš„ï¼Œçº¿æ®µæ ‘ä¸€å®šèƒ½åšï¼›çº¿æ®µæ ‘èƒ½åšçš„ï¼Œæ ‘çŠ¶æ•°ç»„ä¸ä¸€å®šå¯ä»¥ã€‚ç„¶è€Œï¼Œæ ‘çŠ¶æ•°ç»„çš„ä»£ç è¦è¿œæ¯”çº¿æ®µæ ‘çŸ­ï¼Œæ—¶é—´æ•ˆç‡å¸¸æ•°ä¹Ÿæ›´å°ï¼Œå› æ­¤ä»æœ‰å­¦ä¹ ä»·å€¼ã€‚</p>\n<p>é€šè¿‡å¯¹æ ‘çŠ¶æ•°ç»„è¿›è¡Œæ‰©å±•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿å…¶è¿›è¡Œã€ŒåŒºé—´ä¿®æ”¹ã€å’Œã€Œå•ç‚¹æŸ¥è¯¢ã€ï¼š</p>\n<ul>\n<li>åŒºé—´ä¿®æ”¹ï¼šç»™å®š <code>l</code>ã€<code>r</code>ã€<code>k</code>ï¼Œå°† <code>arr[l..r]</code> ä¸­çš„æ¯ä¸ªæ•°è‡ªå¢ <code>k</code>ã€‚è¿™é‡Œçš„è‡ªå¢å¯ä»¥æ˜¯å…¶ä»–æ“ä½œã€‚</li>\n<li>å•ç‚¹æŸ¥è¯¢ï¼šç»™å®š <code>x</code>ï¼Œæ±‚ <code>arr[x]</code>ã€‚</li>\n</ul>\n<p>æ¯”å¦‚ï¼Œåœ¨å·®åˆ†æ•°ç»„å’Œè¾…åŠ©æ•°ç»„çš„å¸®åŠ©ä¸‹ï¼Œæ ‘çŠ¶æ•°ç»„è¿˜å¯è§£å†³ã€ŒåŒºé—´åŠ æ±‚å•ç‚¹å€¼ã€ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€é—®é¢˜ã€‚</p>\n<h2 id=\"æ ‘çŠ¶æ•°ç»„çš„æ„å»ºé€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#æ ‘çŠ¶æ•°ç»„çš„æ„å»ºé€»è¾‘\"></a> æ ‘çŠ¶æ•°ç»„çš„æ„å»ºé€»è¾‘</h2>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202509242231418.webp\" alt=\"image.png\" /></p>\n<p>æ ‘çŠ¶æ•°ç»„ä¸­çš„ç»“ç‚¹ <code>c[i]</code> ç®¡è¾–äº†åŸæ•°ç»„ <code>a</code> ä¸­çš„ä¸€ä¸ªèŒƒå›´ï¼Œ<code>a[l..r]</code>ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo>â‰¤</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">l\\le r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>ã€‚æ¯”å¦‚ï¼š</p>\n<ul>\n<li><code>c[i]</code> çš„å€¼ä¸º <code>a[l..r]</code> çš„å’Œï¼›</li>\n<li><code>a[i]</code> ä¼šç›´æ¥äº¤ç»™ <code>c[i]</code> ç®¡è¾–ï¼›</li>\n<li>æ ‘çŠ¶æ•°ç»„çš„ <code>index</code> æ˜¯ 1-base çš„ï¼Œ<code>c[0]</code> ä¸ç®¡è¾–ä»»ä½•å†…å®¹ã€‚</li>\n</ul>\n<p>æ ‘çŠ¶æ•°ç»„åªæœ‰ä¸€ä¸ªçˆ¶ç»“ç‚¹ï¼Œ<code>c[i]</code> çš„çˆ¶ç»“ç‚¹ä¸º <code>c[i+lowbit(i)]</code>ã€‚è¿™æ˜¯å®ƒæ„å»ºæ ‘çš„æ ¸å¿ƒåŸç†ã€‚åè¿‡æ¥æ¨æ–­ï¼Œ<code>c[i]</code> å­èŠ‚ç‚¹çš„åºå· z å°†æ»¡è¶³ <code>z+lowbit(z)==x</code>ã€‚</p>\n\n<div class=\"callout\" data-callout=\"note\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-pencil\"><path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\"/><path d=\"m15 5 4 4\"/></svg>\n</div>\n<div class=\"callout-title-inner\"><code>lowbit(x)</code> å‡½æ•°</div>\n</div>\n<div class=\"callout-content\"><p>å‡½æ•° <code>lowbit(x)</code> è¡¨ç¤º <code>x</code> äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œæœ€ä½æ¯”ç‰¹ä½æ‰€ä»£è¡¨çš„æ•°ã€‚æ¯”å¦‚ï¼š</p>\n<ul>\n<li><code>lowbit(0b1101010)=0b10</code></li>\n<li><code>lowbit(0b0101000)=0b1000</code></li>\n</ul>\n<p>å®ƒçš„å®ç°ä¸º <code>(x)-&gt;x&amp;-x</code>ï¼Œå…·ä½“åŸç†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/d155facc/\"><span class=\"bilink-pop-up\">ç«™å†…æ–‡ç« </span>ä½è¿ç®—æŠ€å·§æ€»ç»“</a>ã€‚</p>\n</div></div><p><code>c[y]</code> æ˜¯ <code>c[x]</code> çš„ç¥–çˆ¶ç»“ç‚¹ï¼Œæ„å‘³ç€ x èƒ½é€šè¿‡ä¸æ–­åŠ ä¸Š <code>lowbit</code> èƒ½å¾—åˆ° yã€‚</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202509242237890.webp\" alt=\"image.png\" /></p>\n<p>å…·ä½“çš„æ€§è´¨ä¸è¯æ˜è¯¦è§ï¼š<a href=\"https://oi-wiki.org/ds/fenwick/#__tabbed_4_2\">æ ‘çŠ¶æ•°ç»„ - OI Wiki</a>ã€‚</p>\n<h1 id=\"æ ‘çŠ¶æ•°ç»„åŸºæœ¬æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#æ ‘çŠ¶æ•°ç»„åŸºæœ¬æ“ä½œ\"></a> æ ‘çŠ¶æ•°ç»„åŸºæœ¬æ“ä½œ</h1>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¨ <a href=\"https://www.luogu.com.cn/problem/P3374\">P3374 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1 - æ´›è°·</a></div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>æœ¬èŠ‚å°†ä»¥æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŒºé—´å’Œä¸ºä¾‹ã€‚</p>\n<h2 id=\"å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢æ¨¡æ¿\"><a class=\"markdownIt-Anchor\" href=\"#å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢æ¨¡æ¿\"></a> å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢æ¨¡æ¿</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span>[] arr;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">        arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[n+<span class=\"number\">1</span>]; <span class=\"comment\">// 1-base</span></span><br><span class=\"line\">        <span class=\"type\">int</span>[] nums = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>&#125;; <span class=\"comment\">// åŸå§‹æ•°ç»„</span></span><br><span class=\"line\">        buildTree(nums); <span class=\"comment\">// ç”¨åŸå§‹æ•°ç»„å»åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> index,<span class=\"type\">int</span> val)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> index;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(cur&lt;arr.length)&#123;</span><br><span class=\"line\">            arr[cur]+=val;</span><br><span class=\"line\">            cur+=lowbit(cur);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">sumRange</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">l</span> <span class=\"operator\">=</span> sumR(x-<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> sumR(y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> r-l;  <span class=\"comment\">// åˆ©ç”¨äº†å‰ç¼€å’Œçš„çŸ¥è¯†</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">sumRange</span><span class=\"params\">(<span class=\"type\">int</span> x)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> x;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(cur&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            ans+=arr[cur];</span><br><span class=\"line\">            cur-=lowbit(cur);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">lowbit</span><span class=\"params\">(<span class=\"type\">int</span> x)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -x&amp;x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š\n<ul>\n<li>å•ç‚¹ä¿®æ”¹ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Î˜</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\Theta(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Î˜</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>åŒºé—´æŸ¥è¯¢ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Î˜</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\Theta(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Î˜</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></li>\n</ul>\n<h2 id=\"å»ºæ ‘\"><a class=\"markdownIt-Anchor\" href=\"#å»ºæ ‘\"></a> å»ºæ ‘</h2>\n<p>æœ€åŸºæœ¬çš„å»ºæ ‘æ–¹å¼å°±æ˜¯å¯¹äºåŸæ•°ç»„ä¸­çš„æ¯ä¸ª <code>nums[i]</code>ï¼Œéƒ½æ‰§è¡Œä¸€é <code>add</code> æ“ä½œã€‚æ—¶é—´å¤æ‚åº¦ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"keyword\">static</span> <span class=\"title function_\">build</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> i+<span class=\"number\">1</span>;    <span class=\"comment\">// 1-base</span></span><br><span class=\"line\">\t\tadd(cur,nums[i]); <span class=\"comment\">// O(log n)</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ›´å¿«çš„ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> å»ºæ ‘æŠ€å·§ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯ç”±æ‰€æœ‰ä¸è‡ªå·±ç›´æ¥ç›¸è¿çš„å„¿å­çš„å€¼æ±‚å’Œå¾—åˆ°çš„ã€‚å› æ­¤å¯ä»¥å€’ç€è€ƒè™‘è´¡çŒ®ï¼Œå³æ¯æ¬¡ç¡®å®šå®Œå„¿å­çš„å€¼åï¼Œç”¨è‡ªå·±çš„å€¼æ›´æ–°è‡ªå·±çš„ç›´æ¥çˆ¶äº²ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"keyword\">static</span> <span class=\"title function_\">build</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> i+<span class=\"number\">1</span>;    <span class=\"comment\">// 1-base</span></span><br><span class=\"line\">\t\tarr[cur] += nums[i];</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> cur + lowbit(cur);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(p&lt;=n) arr[p] += arr[cur];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//é¢„å¤„ç†ä¸€ä¸ª sum å‰ç¼€å’Œæ•°ç»„ï¼Œå†è®¡ç®— c æ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"keyword\">static</span> <span class=\"title function_\">build</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> i+<span class=\"number\">1</span>;    <span class=\"comment\">// 1-base</span></span><br><span class=\"line\">\t\tarr[cur] = sum[cur] - sum[cur-lowbit(cur)];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"æ ‘çŠ¶æ•°ç»„å˜å½¢\"><a class=\"markdownIt-Anchor\" href=\"#æ ‘çŠ¶æ•°ç»„å˜å½¢\"></a> æ ‘çŠ¶æ•°ç»„å˜å½¢</h1>\n<h2 id=\"åŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œ\"><a class=\"markdownIt-Anchor\" href=\"#åŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œ\"></a> åŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œ</h2>\n<p>ã€ŒåŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œã€ä¸åŸºæœ¬æ ‘çŠ¶æ•°ç»„ä¸åŒçš„æ˜¯ï¼Œè¦æ±‚æ ‘çŠ¶æ•°ç»„å®ç°åŒºé—´ä¿®æ”¹ã€‚</p>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¨ <a href=\"https://www.luogu.com.cn/problem/P3368\">P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 2 - æ´›è°·</a></div>\n</div>\n<div class=\"callout-content\"><p>åŒºé—´åŠ æ±‚å•ç‚¹å€¼ã€‚</p>\n</div></div><p>å¯¹äºåŸºæœ¬æ ‘çŠ¶æ•°ç»„ï¼Œæ¯æ¬¡è¿›è¡Œå•ç‚¹ä¿®æ”¹å¾ˆå®¹æ˜“ã€‚å¦‚æœé¢˜ç›®è¿›è¡ŒåŒºé—´ä¿®æ”¹ï¼Œä¸€ä¸ªæƒ³æ³•æ˜¯å¯¹åŒºé—´èŒƒå›´ä¸æ–­è¿›è¡Œå•ç‚¹ä¿®æ”¹ï¼Œè¿™æ ·çš„æ•ˆç‡ä¼šå¾ˆä½ã€‚<a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/f4bb8efc/\"><span class=\"bilink-pop-up\">ç«™å†…æ–‡ç« </span>å·®åˆ†æ•°ç»„</a> å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>è€ƒè™‘æŸ¥è¯¢ <code>a[1..r]</code> çš„å’Œï¼š</p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><msub><mi>a</mi><mi>i</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><msub><mi>d</mi><mi>j</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><msub><mi>d</mi><mi>j</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><msub><mi>d</mi><mi>i</mi></msub><mo>Ã—</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mo>âˆ’</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><msub><mi>d</mi><mi>i</mi></msub><mo>Ã—</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>r</mi></munderover><msub><mi>d</mi><mi>i</mi></msub><mo>Ã—</mo><mi>i</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n\\sum_{i=1}^{r} a_{i} &amp;= \\sum_{i=1}^{r} \\sum_{j=1}^{i} d_{j} \\\\\n\\\\\n\\sum_{i=1}^{r} \\sum_{j=1}^{i} d_{j} &amp;= \\sum_{i=1}^{r} d_{i} \\times (r - i + 1) \\\\\n&amp;= \\sum_{i=1}^{r} d_{i} \\times (r + 1) - \\sum_{i=1}^{r} d_{i} \\times i\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:11.779958em;vertical-align:-5.639979em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.139979em;\"><span style=\"top:-8.139979em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-5.586202em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3.1145329999999998em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8116690000000006em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4137769999999998em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:0.25064099999999967em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.639979em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.139979em;\"><span style=\"top:-8.139979em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8116690000000006em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4137769999999998em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.1145329999999998em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:0.25064099999999967em;\"><span class=\"pstrut\" style=\"height:3.8116690000000006em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6513970000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.639979em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>è§‚å¯Ÿå¼å­å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤ <code>d[i]</code> å’Œ <code>d[i]*i</code> çš„ä¿¡æ¯ã€‚</p>\n<p>ã€Œæ±‚å•ç‚¹å€¼ã€çš„é—®é¢˜æ¯”ã€Œæ±‚åŒºé—´å’Œã€æ›´å¼±ã€‚ä¸‹é¢ä»£ç ç»™å‡ºäº†ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€æ‰€éœ€è¦çš„æ•°æ®ç»“æ„ä¸æ–¹æ³•ï¼Œ<code>main</code> å‡½æ•°ä¸­ä¾ç…§é¢˜ç›®è¦æ±‚ï¼Œåªä½¿ç”¨äº†ã€Œæ±‚å•ç‚¹å€¼ã€çš„åšæ³•ã€‚ç¨ä½œæ”¹åŠ¨å°±å¯å®ç°ã€Œæ±‚åŒºé—´å’Œã€ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span>[] sumD;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span>[] sumDi;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//Scanner in = new Scanner(System.in);</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">m</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">        sumD = <span class=\"keyword\">new</span> <span class=\"title class_\">long</span>[n + <span class=\"number\">1</span>];</span><br><span class=\"line\">        sumDi = <span class=\"keyword\">new</span> <span class=\"title class_\">long</span>[n + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[n];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">            arr[i] = e;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] d = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[n];</span><br><span class=\"line\">        d[<span class=\"number\">0</span>] = arr[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            d[i] = arr[i] - arr[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        build(d);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">op</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (op == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">y</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">k</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">                add(x, y, k);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nextInt();</span><br><span class=\"line\">                System.out.println(sumR(x, x)); <span class=\"comment\">// è¿™é‡Œæ”¹åŠ¨ä»¥ä¸‹å°±æˆä¸ºåŒºé—´åŠ åŒºé—´å’Œ</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        os.flush();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y, <span class=\"type\">int</span> val)</span> &#123;</span><br><span class=\"line\">        add(x, val);</span><br><span class=\"line\">        add(y + <span class=\"number\">1</span>, -val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> val)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> x;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (cur &lt; sumD.length) &#123;</span><br><span class=\"line\">            sumD[cur] += val;</span><br><span class=\"line\">            sumDi[cur] += (<span class=\"type\">long</span>) val * x;</span><br><span class=\"line\">            cur += lowbit(cur);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"title function_\">sumR</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">xx</span> <span class=\"operator\">=</span> (<span class=\"type\">long</span>) (x) * sumR(sumD, x - <span class=\"number\">1</span>) - sumR(sumDi, x - <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">yy</span> <span class=\"operator\">=</span> (<span class=\"type\">long</span>) (y + <span class=\"number\">1</span>) * sumR(sumD, y) - sumR(sumDi, y);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> yy - xx;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"title function_\">sumR</span><span class=\"params\">(<span class=\"type\">long</span>[] a, <span class=\"type\">int</span> x)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> x;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (cur &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            sum += a[cur];</span><br><span class=\"line\">            cur -= lowbit(cur);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sum;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">lowbit</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -x &amp; x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">build</span><span class=\"params\">(<span class=\"type\">int</span>[] arr)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> i + <span class=\"number\">1</span>;</span><br><span class=\"line\">            sumD[cur] += arr[i];</span><br><span class=\"line\">            sumDi[cur] += (<span class=\"type\">long</span>) arr[i] * cur;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">newCur</span> <span class=\"operator\">=</span> cur + lowbit(cur);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newCur &lt; sumD.length) &#123;</span><br><span class=\"line\">                sumD[newCur] += sumD[cur];</span><br><span class=\"line\">                sumDi[newCur] += sumDi[cur];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ ‡å‡†è¾“å…¥è¾“å‡ºæ¨¡æ¿</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">StreamTokenizer</span> <span class=\"variable\">sc</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StreamTokenizer</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">BufferedReader</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(System.in)));</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">PrintWriter</span> <span class=\"variable\">os</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PrintWriter</span>(System.out);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">nextInt</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        sc.nextToken();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"type\">int</span>) sc.nval;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"æœ¬æ–‡å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡å‚è€ƒ\"></a> æœ¬æ–‡å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://oi-wiki.org/ds/fenwick/#__tabbed_4_2\">æ ‘çŠ¶æ•°ç»„ - OI Wiki</a></li>\n</ul>\n","raw":"---\ntitle: æ ‘çŠ¶æ•°ç»„ä¸Šæ‰‹äº†å°±ååˆ†ç®€å•\ntags:\n  - æ ‘çŠ¶æ•°ç»„\n  - çº¿æ®µæ ‘\n  - Java\ncover: https://cdn.gallery.uuanqin.top/img/202510212301010.webp\ndescription: ç†è§£èµ·æ¥å¯éš¾äº†\nkatex: true\ncategories:\n  - ç®—æ³•ä¸æ•°æ®ç»“æ„\nabbrlink: 47fd7a85\nsummary: >-\n  æœ¬æ–‡ä»‹ç»äº†æ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ¦‚å¿µã€æ„å»ºé€»è¾‘ã€åŸºæœ¬æ“ä½œä»¥åŠå¦‚ä½•é€šè¿‡æ‰©å±•å®ç°åŒºé—´ä¿®æ”¹å’Œå•ç‚¹æŸ¥è¯¢ã€‚æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒå•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ï¼Œé€‚ç”¨äºéœ€è¦é¢‘ç¹æ›´æ–°å’ŒæŸ¥è¯¢æ•°ç»„å…ƒç´ çš„æƒ…å†µã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†æ ‘çŠ¶æ•°ç»„çš„æ„å»ºè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä½•åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„å’Œå¤„ç†åŸæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚æ¥ç€ï¼Œæ–‡ç« å±•ç¤ºäº†æ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ“ä½œæ¨¡æ¿ï¼ŒåŒ…æ‹¬å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢çš„æ–¹æ³•ï¼Œå¹¶åˆ†æäº†å…¶æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ã€‚æœ€åï¼Œæ–‡ç« æ¢è®¨äº†æ ‘çŠ¶æ•°ç»„çš„å˜å½¢åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•åˆ©ç”¨æ ‘çŠ¶æ•°ç»„è§£å†³åŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œçš„é—®é¢˜ï¼Œè¿™ç§æ–¹æ³•é€šè¿‡ç»´æŠ¤é¢å¤–çš„å·®åˆ†æ•°ç»„æ¥å®ç°é«˜æ•ˆçš„åŒºé—´ä¿®æ”¹ã€‚æ•´ä½“ä¸Šï¼Œæ–‡ç« ä¸ºè¯»è€…æä¾›äº†æ ‘çŠ¶æ•°ç»„çš„å…¨é¢ç†è§£ï¼Œå¹¶å±•ç¤ºäº†å…¶åœ¨å®é™…é—®é¢˜ä¸­çš„åº”ç”¨æ½œåŠ›ã€‚\ndate: 2025-09-24 23:26:16\ntop_img:\n---\n\næœ¬æ–‡é¢˜ç›®éš¾åº¦æ ‡è¯†ï¼šğŸŸ©ç®€å•ï¼ŒğŸŸ¨ä¸­ç­‰ï¼ŒğŸŸ¥å›°éš¾ã€‚\n\n# ç›´è§‚æ„Ÿå—æ ‘çŠ¶æ•°ç»„\n\næ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§æ”¯æŒã€Œå•ç‚¹ä¿®æ”¹ã€å’Œã€ŒåŒºé—´æŸ¥è¯¢ã€çš„ï¼Œä»£ç é‡å°çš„æ•°æ®ç»“æ„ï¼š\n\n- å•ç‚¹ä¿®æ”¹ï¼šç»™å®šæ•°ç»„ `arr`ï¼Œå°† `arr[i]` è‡ªå¢ä¸º `k`ã€‚è¿™é‡Œçš„è‡ªå¢å¯ä»¥æ˜¯èµ‹å€¼ç­‰å…¶ä»–æ“ä½œã€‚\n- åŒºé—´æŸ¥è¯¢ï¼šç»™å®š `l`ã€`r`ï¼Œæ±‚ `arr[l..r]` çš„å’Œæˆ–å…¶ä»–åŒºé—´ç‰¹å¾ã€‚\n\næ™®é€šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„ä¿¡æ¯åŠè¿ç®—è¦æ»¡è¶³ ç»“åˆå¾‹ ä¸” å¯å·®åˆ†ï¼Œå¦‚åŠ æ³•ï¼ˆå’Œï¼‰ã€ä¹˜æ³•ï¼ˆç§¯ï¼‰ã€å¼‚æˆ–ç­‰ã€‚\n\n- ç»“åˆå¾‹ï¼š$(x\\circ y)\\circ z = x\\circ (y\\circ z)$\n- å¯å·®åˆ†ï¼šå…·æœ‰é€†è¿ç®—çš„è¿ç®—ï¼Œå³å·²çŸ¥ $x\\circ y$ å’Œ $x$ï¼Œå¯æ±‚å‡º $y$ã€‚\n\näº‹å®ä¸Šï¼Œæ ‘çŠ¶æ•°ç»„èƒ½è§£å†³çš„é—®é¢˜æ˜¯ [[çº¿æ®µæ ‘æ¨¡æ¿çš„ç†è§£å’Œä½¿ç”¨|çº¿æ®µæ ‘]] èƒ½è§£å†³çš„é—®é¢˜çš„å­é›†ï¼šæ ‘çŠ¶æ•°ç»„èƒ½åšçš„ï¼Œçº¿æ®µæ ‘ä¸€å®šèƒ½åšï¼›çº¿æ®µæ ‘èƒ½åšçš„ï¼Œæ ‘çŠ¶æ•°ç»„ä¸ä¸€å®šå¯ä»¥ã€‚ç„¶è€Œï¼Œæ ‘çŠ¶æ•°ç»„çš„ä»£ç è¦è¿œæ¯”çº¿æ®µæ ‘çŸ­ï¼Œæ—¶é—´æ•ˆç‡å¸¸æ•°ä¹Ÿæ›´å°ï¼Œå› æ­¤ä»æœ‰å­¦ä¹ ä»·å€¼ã€‚\n\né€šè¿‡å¯¹æ ‘çŠ¶æ•°ç»„è¿›è¡Œæ‰©å±•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿å…¶è¿›è¡Œã€ŒåŒºé—´ä¿®æ”¹ã€å’Œã€Œå•ç‚¹æŸ¥è¯¢ã€ï¼š\n\n- åŒºé—´ä¿®æ”¹ï¼šç»™å®š `l`ã€`r`ã€`k`ï¼Œå°† `arr[l..r]` ä¸­çš„æ¯ä¸ªæ•°è‡ªå¢ `k`ã€‚è¿™é‡Œçš„è‡ªå¢å¯ä»¥æ˜¯å…¶ä»–æ“ä½œã€‚\n- å•ç‚¹æŸ¥è¯¢ï¼šç»™å®š `x`ï¼Œæ±‚ `arr[x]`ã€‚\n\næ¯”å¦‚ï¼Œåœ¨å·®åˆ†æ•°ç»„å’Œè¾…åŠ©æ•°ç»„çš„å¸®åŠ©ä¸‹ï¼Œæ ‘çŠ¶æ•°ç»„è¿˜å¯è§£å†³ã€ŒåŒºé—´åŠ æ±‚å•ç‚¹å€¼ã€ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€é—®é¢˜ã€‚\n\n## æ ‘çŠ¶æ•°ç»„çš„æ„å»ºé€»è¾‘\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202509242231418.webp)\n\næ ‘çŠ¶æ•°ç»„ä¸­çš„ç»“ç‚¹ `c[i]` ç®¡è¾–äº†åŸæ•°ç»„ `a` ä¸­çš„ä¸€ä¸ªèŒƒå›´ï¼Œ`a[l..r]`ï¼Œ$l\\le r$ã€‚æ¯”å¦‚ï¼š\n\n- `c[i]` çš„å€¼ä¸º `a[l..r]` çš„å’Œï¼›\n- `a[i]` ä¼šç›´æ¥äº¤ç»™ `c[i]` ç®¡è¾–ï¼›\n- æ ‘çŠ¶æ•°ç»„çš„ `index` æ˜¯ 1-base çš„ï¼Œ`c[0]` ä¸ç®¡è¾–ä»»ä½•å†…å®¹ã€‚\n\næ ‘çŠ¶æ•°ç»„åªæœ‰ä¸€ä¸ªçˆ¶ç»“ç‚¹ï¼Œ`c[i]` çš„çˆ¶ç»“ç‚¹ä¸º `c[i+lowbit(i)]`ã€‚è¿™æ˜¯å®ƒæ„å»ºæ ‘çš„æ ¸å¿ƒåŸç†ã€‚åè¿‡æ¥æ¨æ–­ï¼Œ`c[i]` å­èŠ‚ç‚¹çš„åºå· z å°†æ»¡è¶³ `z+lowbit(z)==x`ã€‚\n\n> [!note] `lowbit(x)` å‡½æ•°\n> å‡½æ•° `lowbit(x)` è¡¨ç¤º `x` äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œæœ€ä½æ¯”ç‰¹ä½æ‰€ä»£è¡¨çš„æ•°ã€‚æ¯”å¦‚ï¼š\n> - `lowbit(0b1101010)=0b10`\n> - `lowbit(0b0101000)=0b1000`\n> \n> å®ƒçš„å®ç°ä¸º `(x)->x&-x`ï¼Œå…·ä½“åŸç†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š[[ä½è¿ç®—æŠ€å·§æ€»ç»“]]ã€‚\n\n`c[y]` æ˜¯ `c[x]` çš„ç¥–çˆ¶ç»“ç‚¹ï¼Œæ„å‘³ç€ x èƒ½é€šè¿‡ä¸æ–­åŠ ä¸Š `lowbit` èƒ½å¾—åˆ° yã€‚\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202509242237890.webp)\n\nå…·ä½“çš„æ€§è´¨ä¸è¯æ˜è¯¦è§ï¼š[æ ‘çŠ¶æ•°ç»„ - OI Wiki](https://oi-wiki.org/ds/fenwick/#__tabbed_4_2)ã€‚\n\n# æ ‘çŠ¶æ•°ç»„åŸºæœ¬æ“ä½œ\n\n> [!example] ğŸŸ¨ [P3374 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1 - æ´›è°·](https://www.luogu.com.cn/problem/P3374)\n\næœ¬èŠ‚å°†ä»¥æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŒºé—´å’Œä¸ºä¾‹ã€‚\n\n## å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢æ¨¡æ¿\n\n```java\npublic class Main{\n    public static int[] arr;\n    public static void main(String[] args) throws IOException{\n        int n = nextInt();\n        arr = new int[n+1]; // 1-base\n        int[] nums = new int[]{1,2,3,4,5,6,7}; // åŸå§‹æ•°ç»„\n        buildTree(nums); // ç”¨åŸå§‹æ•°ç»„å»åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„\n    }\n\n    public static void add(int index,int val){\n        int cur = index;\n        while(cur<arr.length){\n            arr[cur]+=val;\n            cur+=lowbit(cur);\n        }\n    }\n\n    public static int sumRange(int x,int y){\n        int l = sumR(x-1);\n        int r = sumR(y);\n        return r-l;  // åˆ©ç”¨äº†å‰ç¼€å’Œçš„çŸ¥è¯†\n    }\n\n    public static int sumRange(int x){\n        int cur = x;\n        int ans = 0;\n        while(cur>0){\n            ans+=arr[cur];\n            cur-=lowbit(cur);\n        }\n        return ans;\n    }\n\n    public static int lowbit(int x){\n        return -x&x;\n    }\n}\n```\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š\n\t- å•ç‚¹ä¿®æ”¹ï¼š$\\Theta(\\log n)$ã€‚\n\t- åŒºé—´æŸ¥è¯¢ï¼š$\\Theta(\\log n)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$\n\n## å»ºæ ‘\n\næœ€åŸºæœ¬çš„å»ºæ ‘æ–¹å¼å°±æ˜¯å¯¹äºåŸæ•°ç»„ä¸­çš„æ¯ä¸ª `nums[i]`ï¼Œéƒ½æ‰§è¡Œä¸€é `add` æ“ä½œã€‚æ—¶é—´å¤æ‚åº¦ $O(n\\log n)$ã€‚\n\n```java\npublic void static build(int[] nums){\n\tfor(int i=0;i<nums.length;i++){\n\t\tint cur = i+1;    // 1-base\n\t\tadd(cur,nums[i]); // O(log n)\n\t}\n}\n```\n\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ›´å¿«çš„ $O(n)$ å»ºæ ‘æŠ€å·§ã€‚\n\n```java\n// æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯ç”±æ‰€æœ‰ä¸è‡ªå·±ç›´æ¥ç›¸è¿çš„å„¿å­çš„å€¼æ±‚å’Œå¾—åˆ°çš„ã€‚å› æ­¤å¯ä»¥å€’ç€è€ƒè™‘è´¡çŒ®ï¼Œå³æ¯æ¬¡ç¡®å®šå®Œå„¿å­çš„å€¼åï¼Œç”¨è‡ªå·±çš„å€¼æ›´æ–°è‡ªå·±çš„ç›´æ¥çˆ¶äº²ã€‚\npublic void static build(int[] nums){\n\tfor(int i=0;i<nums.length;i++){\n\t\tint cur = i+1;    // 1-base\n\t\tarr[cur] += nums[i];\n\t\tint p = cur + lowbit(cur);\n\t\tif(p<=n) arr[p] += arr[cur];\n\t}\n}\n\n//é¢„å¤„ç†ä¸€ä¸ª sum å‰ç¼€å’Œæ•°ç»„ï¼Œå†è®¡ç®— c æ•°ç»„ã€‚\npublic void static build(int[] nums){\n\tfor(int i=0;i<nums.length;i++){\n\t\tint cur = i+1;    // 1-base\n\t\tarr[cur] = sum[cur] - sum[cur-lowbit(cur)];\n\t}\n}\n```\n\n# æ ‘çŠ¶æ•°ç»„å˜å½¢\n\n## åŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œ\n\nã€ŒåŒºé—´åŠ æ±‚å•ç‚¹å€¼æˆ–åŒºé—´å’Œã€ä¸åŸºæœ¬æ ‘çŠ¶æ•°ç»„ä¸åŒçš„æ˜¯ï¼Œè¦æ±‚æ ‘çŠ¶æ•°ç»„å®ç°åŒºé—´ä¿®æ”¹ã€‚\n\n> [!example] ğŸŸ¨ [P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 2 - æ´›è°·](https://www.luogu.com.cn/problem/P3368)\n> åŒºé—´åŠ æ±‚å•ç‚¹å€¼ã€‚\n\nå¯¹äºåŸºæœ¬æ ‘çŠ¶æ•°ç»„ï¼Œæ¯æ¬¡è¿›è¡Œå•ç‚¹ä¿®æ”¹å¾ˆå®¹æ˜“ã€‚å¦‚æœé¢˜ç›®è¿›è¡ŒåŒºé—´ä¿®æ”¹ï¼Œä¸€ä¸ªæƒ³æ³•æ˜¯å¯¹åŒºé—´èŒƒå›´ä¸æ–­è¿›è¡Œå•ç‚¹ä¿®æ”¹ï¼Œè¿™æ ·çš„æ•ˆç‡ä¼šå¾ˆä½ã€‚[[å·®åˆ†æ•°ç»„|å·®åˆ†æ•°ç»„]] å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\nè€ƒè™‘æŸ¥è¯¢ `a[1..r]` çš„å’Œï¼š\n\n$$\n\\begin{aligned}\n\\sum_{i=1}^{r} a_{i} &= \\sum_{i=1}^{r} \\sum_{j=1}^{i} d_{j} \\\\\n\\\\\n\\sum_{i=1}^{r} \\sum_{j=1}^{i} d_{j} &= \\sum_{i=1}^{r} d_{i} \\times (r - i + 1) \\\\\n&= \\sum_{i=1}^{r} d_{i} \\times (r + 1) - \\sum_{i=1}^{r} d_{i} \\times i\n\\end{aligned}\n$$\n\nè§‚å¯Ÿå¼å­å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤ `d[i]` å’Œ `d[i]*i` çš„ä¿¡æ¯ã€‚\n\nã€Œæ±‚å•ç‚¹å€¼ã€çš„é—®é¢˜æ¯”ã€Œæ±‚åŒºé—´å’Œã€æ›´å¼±ã€‚ä¸‹é¢ä»£ç ç»™å‡ºäº†ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€æ‰€éœ€è¦çš„æ•°æ®ç»“æ„ä¸æ–¹æ³•ï¼Œ`main` å‡½æ•°ä¸­ä¾ç…§é¢˜ç›®è¦æ±‚ï¼Œåªä½¿ç”¨äº†ã€Œæ±‚å•ç‚¹å€¼ã€çš„åšæ³•ã€‚ç¨ä½œæ”¹åŠ¨å°±å¯å®ç°ã€Œæ±‚åŒºé—´å’Œã€ã€‚\n\n```java\nimport java.io.*;\n\npublic class Main {\n    public static long[] sumD;\n    public static long[] sumDi;\n\n    public static void main(String[] args) throws IOException {\n        //Scanner in = new Scanner(System.in);\n        int n = nextInt();\n        int m = nextInt();\n        sumD = new long[n + 1];\n        sumDi = new long[n + 1];\n        int[] arr = new int[n];\n        for (int i = 0; i < n; i++) {\n            int e = nextInt();\n            arr[i] = e;\n        }\n        int[] d = new int[n];\n        d[0] = arr[0];\n        for (int i = 1; i < n; i++) {\n            d[i] = arr[i] - arr[i - 1];\n        }\n        build(d);\n        for (int i = 0; i < m; i++) {\n            int op = nextInt();\n            if (op == 1) {\n                int x = nextInt();\n                int y = nextInt();\n                int k = nextInt();\n                add(x, y, k);\n            } else {\n                int x = nextInt();\n                System.out.println(sumR(x, x)); // è¿™é‡Œæ”¹åŠ¨ä»¥ä¸‹å°±æˆä¸ºåŒºé—´åŠ åŒºé—´å’Œ\n            }\n\n        }\n        os.flush();\n    }\n\n    public static void add(int x, int y, int val) {\n        add(x, val);\n        add(y + 1, -val);\n    }\n\n    public static void add(int x, int val) {\n        int cur = x;\n        while (cur < sumD.length) {\n            sumD[cur] += val;\n            sumDi[cur] += (long) val * x;\n            cur += lowbit(cur);\n        }\n    }\n\n    public static long sumR(int x, int y) {\n        long xx = (long) (x) * sumR(sumD, x - 1) - sumR(sumDi, x - 1);\n        long yy = (long) (y + 1) * sumR(sumD, y) - sumR(sumDi, y);\n        return yy - xx;\n    }\n\n    public static long sumR(long[] a, int x) {\n        int cur = x;\n        long sum = 0;\n        while (cur > 0) {\n            sum += a[cur];\n            cur -= lowbit(cur);\n        }\n        return sum;\n    }\n\n    public static int lowbit(int x) {\n        return -x & x;\n    }\n\n    public static void build(int[] arr) {\n        for (int i = 0; i < arr.length; i++) {\n            int cur = i + 1;\n            sumD[cur] += arr[i];\n            sumDi[cur] += (long) arr[i] * cur;\n            int newCur = cur + lowbit(cur);\n            if (newCur < sumD.length) {\n                sumD[newCur] += sumD[cur];\n                sumDi[newCur] += sumDi[cur];\n            }\n        }\n    }\n\n    /**\n     * æ ‡å‡†è¾“å…¥è¾“å‡ºæ¨¡æ¿\n     */\n\n    static StreamTokenizer sc = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in)));\n    static PrintWriter os = new PrintWriter(System.out);\n\n    static int nextInt() throws IOException {\n        sc.nextToken();\n        return (int) sc.nval;\n    }\n}\n```\n\n# æœ¬æ–‡å‚è€ƒ\n\n- [æ ‘çŠ¶æ•°ç»„ - OI Wiki](https://oi-wiki.org/ds/fenwick/#__tabbed_4_2)","categories":[{"name":"ç®—æ³•ä¸æ•°æ®ç»“æ„","api":"api/categories/ç®—æ³•ä¸æ•°æ®ç»“æ„.json"}],"tags":[{"name":"Java","api":"api/tags/Java.json"},{"name":"æ ‘çŠ¶æ•°ç»„","api":"api/tags/æ ‘çŠ¶æ•°ç»„.json"},{"name":"çº¿æ®µæ ‘","api":"api/tags/çº¿æ®µæ ‘.json"}]},"api":"api/posts/p/47fd7a85.json"}