{"data":{"title":"【开发杂记】第一次开发 npm 插件","slug":"百味人生/数字与代码/【开发杂记】第一次开发 npm 插件","description":"有文档了也看不懂","date":"2023-10-20T10:51:47.000Z","updated":"2025-08-16T17:23:48.123Z","language":"zh-CN","comments":true,"url":"p/ca685d6c/","cover":"https://cdn.gallery.uuanqin.top/img/RTFM_header_2cover.webp","images":[],"content":"<p>早些时间就折腾了 Hexo 与 Obsidian 联合工作的问题。将 Obsidian 上好用的新语法移植到 Hexo 往往只差一个 markdown 渲染环节。</p>\n<p>在苦苦的搜寻和探索过程中，我解决了 Obsidian 中 Callouts 语法问题，同时接触了 markdown-it-plugin。正是 <a href=\"https://widcard.win/posts/write-plugins/write-mdit-plugin\">这篇文章</a> 为我打开了一扇新世界的大门。后来，我的目光一直从 hexo-plugin 和 markdown-it-plugin 之间徘徊，甚至萌生脚本全文替换的想法。出于易用性和普遍性的考虑，我最终决定直接开发一款 markdown-it-plugin 解决 Obsidian 语法问题。</p>\n<p>入手 markdown-it 插件开发其实并不简单，虽说存在官方文档，但阅读门槛较高。</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/20231020191310.webp\" alt=\"image.png\" width=\"375px\" /></p>\n<p>经过资料查阅，大多数的中英文博客文章（甚至是 markdown-it 本 it）都建议从<strong>模仿</strong>开始入手，官方并没有心思写过于详细的手把手教程（有趣的是，关于这个问题，官方仓库论坛甚至可以看到 <a href=\"https://github.com/markdown-it/markdown-it/issues/711\">开发者骂街</a>🤭）</p>\n\n<div class=\"callout\" data-callout=\"cite\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-quote\"><path d=\"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z\"/><path d=\"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z\"/></svg>\n</div>\n<div class=\"callout-title-inner\">Cite</div>\n</div>\n<div class=\"callout-content\"><p><a href=\"https://widcard.win/posts/write-plugins/write-mdit-plugin\">widcardw</a>：markdown-it 的官方文档只是给了一部分案例，用于指导如何使用它的 API，将它接入到 Web 程序中，但是光看它的文档，我并没有找到写插件的头绪。因此，写插件的最好办法就是抄别人的代码。</p>\n<p><strong>How to write plugins?</strong> <a href=\"https://github.com/markdown-it/markdown-it/issues/10\">#10</a><br />\n<strong>Q</strong>: There are no any documentation or tutorial on how to write syntax plugins for Markdown-it, neither in this repository nor in internet.<br />\n<strong>A</strong>: Yes, at current time it’s better to <strong>look into parser src, or existing pugins</strong>. I will add more examples &amp; explanations, but do not expect it to be in top priority.</p>\n</div></div><p>有了这条明确的方向，我的插件开发探索开始了。</p>\n<ol>\n<li>首先，我需要明白 markdown-it 插件基本结构与开发方法。这一点官方是提供了一个基本概念和文档的。一口气肯定不能读完读懂，但阅读的过程中可以对基本渲染部件有所了解。</li>\n<li>接下来，开始简单的插件源码阅读。当然是挑最简单的来读啦，我看了官方写的上标插件，看懂了又好像没看懂。复杂的地方就是 state、rule 这些。背后的机理还是没完全明白，不管了我要抓紧时间啊！</li>\n<li>然后，找到合适的插件进行模仿和修改。我尝试阅读多款功能相近的插件，最终选出 <a href=\"https://www.npmjs.com/package/@peaceroad/markdown-it-renderer-image\">@peaceroad/markdown-it-renderer-image</a> 作为我大改的目标。</li>\n<li>有了模仿目标后就着手进行开发。这个项目不算远古项目，近期也有一定的下载量。此外，项目包含测试，以填补我 npm 插件开发盲区。整个程序代码不复杂，有些变量命名和逻辑可以进行优化。我做的工作主要是裁剪不需要的功能，写一个正则替换就行。为了项目二次开发，我把测试用例写得更好看些。</li>\n<li>完成测试后就是发布环节了。发布流程也很简单，大概十几分钟后，我就能通过 npm 仓库下载自己的包开始用了，整个使用流程也十分顺利。</li>\n</ol>\n<p>读源码和写代码的过程中，大模型们（New Bing、ChatGPT3.5、星火认知）确实有参与，但作用不算很大，胡说八道占一半，对它的内容我都半信半疑，不如自己上网搜。</p>\n<p>在校学习之余完成插件的整个开发过程，包括调研和总结，耗时 2~3 天。这次的成功也让我产生更多的开发想法，苦于在校没时间，只能期待以后尝试咯。</p>\n<p>最后放上本文相关项目：<a href=\"https://github.com/uuanqin/markdown-it-obsidian-imgsize\">uuanqin/markdown-it-obsidian-imgsize: Obsidian图片大小处理插件 (github.com)</a>，期待你的小⭐⭐😋！</p>\n<p><a href=\"https://github.com/uuanqin/markdown-it-obsidian-imgsize\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=markdown-it-obsidian-imgsize\" alt=\"Readme Card\" /></a></p>\n","raw":"---\ntitle: 【开发杂记】第一次开发 npm 插件\ntags:\n  - 碎碎念\n  - 开发杂记\ncover: 'https://cdn.gallery.uuanqin.top/img/RTFM_header_2cover.webp'\ncategories:\n  - 百味人生\n  - 数字与代码\nabbrlink: ca685d6c\ndescription: 有文档了也看不懂\ndate: 2023-10-20 18:51:47\ntop_img:\n---\n\n早些时间就折腾了 Hexo 与 Obsidian 联合工作的问题。将 Obsidian 上好用的新语法移植到 Hexo 往往只差一个 markdown 渲染环节。\n\n在苦苦的搜寻和探索过程中，我解决了 Obsidian 中 Callouts 语法问题，同时接触了 markdown-it-plugin。正是 [这篇文章](https://widcard.win/posts/write-plugins/write-mdit-plugin) 为我打开了一扇新世界的大门。后来，我的目光一直从 hexo-plugin 和 markdown-it-plugin 之间徘徊，甚至萌生脚本全文替换的想法。出于易用性和普遍性的考虑，我最终决定直接开发一款 markdown-it-plugin 解决 Obsidian 语法问题。\n\n入手 markdown-it 插件开发其实并不简单，虽说存在官方文档，但阅读门槛较高。\n\n![image.png|375](https://cdn.gallery.uuanqin.top/img/20231020191310.webp)\n\n经过资料查阅，大多数的中英文博客文章（甚至是 markdown-it 本 it）都建议从**模仿**开始入手，官方并没有心思写过于详细的手把手教程（有趣的是，关于这个问题，官方仓库论坛甚至可以看到 [开发者骂街](https://github.com/markdown-it/markdown-it/issues/711)🤭）\n\n> [!cite]\n> [widcardw](https://widcard.win/posts/write-plugins/write-mdit-plugin)：markdown-it 的官方文档只是给了一部分案例，用于指导如何使用它的 API，将它接入到 Web 程序中，但是光看它的文档，我并没有找到写插件的头绪。因此，写插件的最好办法就是抄别人的代码。\n>\n> **How to write plugins?** [#10](https://github.com/markdown-it/markdown-it/issues/10)\n> **Q**: There are no any documentation or tutorial on how to write syntax plugins for Markdown-it, neither in this repository nor in internet.\n> **A**: Yes, at current time it's better to **look into parser src, or existing pugins**. I will add more examples & explanations, but do not expect it to be in top priority.\n\n有了这条明确的方向，我的插件开发探索开始了。\n\n1. 首先，我需要明白 markdown-it 插件基本结构与开发方法。这一点官方是提供了一个基本概念和文档的。一口气肯定不能读完读懂，但阅读的过程中可以对基本渲染部件有所了解。\n2. 接下来，开始简单的插件源码阅读。当然是挑最简单的来读啦，我看了官方写的上标插件，看懂了又好像没看懂。复杂的地方就是 state、rule 这些。背后的机理还是没完全明白，不管了我要抓紧时间啊！\n3. 然后，找到合适的插件进行模仿和修改。我尝试阅读多款功能相近的插件，最终选出 [@peaceroad/markdown-it-renderer-image](https://www.npmjs.com/package/@peaceroad/markdown-it-renderer-image) 作为我大改的目标。\n4. 有了模仿目标后就着手进行开发。这个项目不算远古项目，近期也有一定的下载量。此外，项目包含测试，以填补我 npm 插件开发盲区。整个程序代码不复杂，有些变量命名和逻辑可以进行优化。我做的工作主要是裁剪不需要的功能，写一个正则替换就行。为了项目二次开发，我把测试用例写得更好看些。\n5. 完成测试后就是发布环节了。发布流程也很简单，大概十几分钟后，我就能通过 npm 仓库下载自己的包开始用了，整个使用流程也十分顺利。\n\n读源码和写代码的过程中，大模型们（New Bing、ChatGPT3.5、星火认知）确实有参与，但作用不算很大，胡说八道占一半，对它的内容我都半信半疑，不如自己上网搜。\n\n在校学习之余完成插件的整个开发过程，包括调研和总结，耗时 2~3 天。这次的成功也让我产生更多的开发想法，苦于在校没时间，只能期待以后尝试咯。\n\n最后放上本文相关项目：[uuanqin/markdown-it-obsidian-imgsize: Obsidian图片大小处理插件 (github.com)](https://github.com/uuanqin/markdown-it-obsidian-imgsize)，期待你的小⭐⭐😋！\n\n[![Readme Card](https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&repo=markdown-it-obsidian-imgsize)](https://github.com/uuanqin/markdown-it-obsidian-imgsize)\n","categories":[{"name":"百味人生","api":"api/categories/百味人生.json"},{"name":"数字与代码","api":"api/categories/百味人生/数字与代码.json"}],"tags":[{"name":"开发杂记","api":"api/tags/开发杂记.json"},{"name":"碎碎念","api":"api/tags/碎碎念.json"}]},"api":"api/posts/p/ca685d6c.json"}