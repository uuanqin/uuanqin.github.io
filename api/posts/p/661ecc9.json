{"data":{"title":"Nginx 的安装与反向代理配置","slug":"博客站点维护/Nginx 的安装与反向代理配置","description":"阿里云安装与配置 Nginx。","date":"2023-04-13T10:05:00.000Z","updated":"2026-02-02T16:39:40.604Z","language":"zh-CN","comments":true,"url":"p/661ecc9/","cover":"https://cdn.gallery.uuanqin.top/img/nginx1-cover.svg","images":[],"content":"<p>精通 Nginx，学其它的 Apache、Tomcat 更轻松。</p>\n<h1 id=\"安装-nginx\"><a class=\"markdownIt-Anchor\" href=\"#安装-nginx\"></a> 安装 Nginx</h1>\n<h2 id=\"centos-中通过-dnf-包管理器自动下载安装\"><a class=\"markdownIt-Anchor\" href=\"#centos-中通过-dnf-包管理器自动下载安装\"></a> CentOS 中通过 DNF 包管理器自动下载安装</h2>\n\n<div class=\"callout\" data-callout=\"note\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-pencil\"><path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\"/><path d=\"m15 5 4 4\"/></svg>\n</div>\n<div class=\"callout-title-inner\">本案例中使用的服务器信息</div>\n</div>\n<div class=\"callout-content\"><p>CPU&amp;内存：1 核 (vCPU)2 GiB<br />\n操作系统：Alibaba Cloud Linux 3.2104 64 位<br />\n实例规格：ecs.n4.small<br />\n实例规格族：共享计算型<br />\n刚刚初始化云盘的 ECS 服务器。</p>\n</div></div><p>运行以下命令安装 Nginx：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dnf -y install http://nginx.org/packages/centos/8/x86_64/RPMS/nginx-1.22.1-1.el8.ngx.x86_64.rpm </span><br></pre></td></tr></table></figure>\n<p>您可以访问 <a href=\"https://nginx.org/packages/centos/8/x86_64/RPMS/\">Nginx官方安装包</a> 获取适用于 CentOS 8 系统的多版本的 Nginx 安装包。</p>\n<h2 id=\"通过官网下载源代码自行编译\"><a class=\"markdownIt-Anchor\" href=\"#通过官网下载源代码自行编译\"></a> 通过官网下载源代码自行编译</h2>\n<blockquote>\n<p>最原始的方式</p>\n</blockquote>\n<p>官网软件包下载地址：<a href=\"https://nginx.org/en/download.html\">nginx: download</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o nginx-1.20.2.tar.gz https://nginx.org/download/nginx-1.20.2.tar.gz</span><br></pre></td></tr></table></figure>\n<p>解压：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf nginx-1.20.2.tar.gz</span><br><span class=\"line\">cd nginx-1.20.2</span><br></pre></td></tr></table></figure>\n<p>检查依赖：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br></pre></td></tr></table></figure>\n<p>yum 安装缺失的库：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install pcre pcre-devel -y</span><br><span class=\"line\">yum install openssl openssl-devel -y</span><br></pre></td></tr></table></figure>\n<p>安装完毕后可再次进行依赖检查 <code>./configure</code>。</p>\n<p>设置系统参数：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --with-http_ssl_module --with-http_v2_module --with-stream</span><br></pre></td></tr></table></figure>\n<p>编译与安装：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>编译出来的二进制文件在 <code>/usr/local/nginx/sbin/nginx</code> 中（之前 configure 检查时有提示）。</p>\n<p>接下来配置环境变量，将二进制文件的地址配置进去：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br></pre></td></tr></table></figure>\n<p>在打开的文件中的最后加入以下内容：</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export PATH=$PATH:/usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>\n<p>刷新使配置文件生效：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<h1 id=\"验证并启动-nginx\"><a class=\"markdownIt-Anchor\" href=\"#验证并启动-nginx\"></a> 验证并启动 Nginx</h1>\n<p>运行以下命令查看 Nginx 版本。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -v</span><br></pre></td></tr></table></figure>\n<p>启动 Nginx 服务：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start nginx</span><br></pre></td></tr></table></figure>\n<p>在本地电脑的浏览器输入主机地址并访问，出现 Nginx 默认页面即成功。</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230409141117412.png\" alt=\"image-20230409141117412\" width=\"500px\" /></p>\n<h1 id=\"反向代理的配置\"><a class=\"markdownIt-Anchor\" href=\"#反向代理的配置\"></a> 反向代理的配置</h1>\n<h2 id=\"一般的请求转发\"><a class=\"markdownIt-Anchor\" href=\"#一般的请求转发\"></a> 一般的请求转发</h2>\n<p>找到 <code>nginx.conf</code> 文件进行配置，一般在 <code>/etc/nginx</code> 目录下。但我遇到一个问题，就是配置文件没有 server 字段。于是我参考了 <a href=\"https://blog.csdn.net/qq_37283570/article/details/112854376\">这篇文章</a>。最终在 <code>/etc/nginx/conf.d/default.conf</code> 中找到了。</p>\n<p>修改配置文件，设定好网站的根目录：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230408205637757.png\" alt=\"image-20230408205637757\" width=\"500px\" /></p>\n<p>重启 Nginx：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart nginx</span><br><span class=\"line\"><span class=\"comment\"># 或 nginx -s reload # 不用重启nginx</span></span><br><span class=\"line\"><span class=\"comment\"># 或 systemctl reload nginx</span></span><br></pre></td></tr></table></figure>\n<p>你可以在服务器上对应自己设置的根目录创建文本文件，如 <code>xiazai.txt</code>，然后浏览器访问网址 <code>&lt;服务器主机IP&gt;/xiazai.txt</code> 进行测试。</p>\n<h2 id=\"sse-请求转发\"><a class=\"markdownIt-Anchor\" href=\"#sse-请求转发\"></a> SSE 请求转发</h2>\n<p>如果服务器部署的服务需要通过 SSE 协议交流（MCP Server），那么注意 Nginx 中不要破坏掉 SSE 的传输过程。一份能正确运行的配置如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">   listen 443 ssl;</span><br><span class=\"line\">    server_name mcp.uuanqin.top;  # 你的域名，确保已解析到服务器 IP</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://localhost:8991;</span><br><span class=\"line\">        proxy_http_version 1.1;  # 必须用 HTTP/1.1</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        # MCP 协议专用转发配置（关键！）</span><br><span class=\"line\">        proxy_set_header Connection &quot;&quot;;  # 禁用连接重置，保持长连接</span><br><span class=\"line\">        proxy_buffering off;  # 禁用缓冲，保证帧传输完整</span><br><span class=\"line\">        proxy_cache off;      # 禁用缓存</span><br><span class=\"line\">        proxy_read_timeout 120s;  # 延长读超时（MCP 握手需要时间）</span><br><span class=\"line\">        proxy_send_timeout 120s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 可选：添加访问日志，方便排查问题</span><br><span class=\"line\">    access_log /var/log/nginx/mcp.uuanqin.top.access.log main;</span><br><span class=\"line\">    error_log /var/log/nginx/mcp.uuanqin.top.error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/mcp.uuanqin.top/fullchain.pem; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/mcp.uuanqin.top/privkey.pem; # managed by Certbot</span><br><span class=\"line\">   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    if ($host = mcp.uuanqin.top) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name mcp.uuanqin.top;</span><br><span class=\"line\">    return 404; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://help.aliyun.com/document_detail/464754.html?spm=a2c4g.472049.0.0.6a8d4de5bhOeVO\">CentOS 8 自建安装 Nginx+Mysql环境+PHP环境 (aliyun.com)</a></li>\n<li><a href=\"https://blog.csdn.net/github_38336924/article/details/82756779\">Linux Nginx 配置/绑定域名_nginx配置域名_dadeity的博客-CSDN博客</a></li>\n<li><a href=\"https://www.runoob.com/w3cnote/nginx-setup-intro.html\">Nginx 配置详解 | 菜鸟教程 (runoob.com)</a></li>\n<li><a href=\"https://www.cnblogs.com/davidkam/p/3507082.html\">Nginx多域名多Server反向代理配置 - davidkam - 博客园 (cnblogs.com)</a></li>\n</ul>\n","raw":"---\ntitle: Nginx 的安装与反向代理配置\ntags:\n  - Nginx\n  - 安装\n  - ECS\n  - Linux\ncover: https://cdn.gallery.uuanqin.top/img/nginx1-cover.svg\ndescription: 阿里云安装与配置 Nginx。\nabbrlink: 661ecc9\ncategories:\n  - 博客站点维护\nsummary: >-\n  本文介绍了Nginx的安装与反向代理配置。首先，通过官网下载编译好的软件包或在CentOS中使用DNF包管理器安装Nginx，并验证启动。接着，详细说明了如何在Nginx配置文件中设置反向代理，包括定位配置文件、修改配置文件以设定网站根目录，并通过重启Nginx服务来应用更改。最后，提供了参考文章链接供读者进一步学习和参考。\ndate: 2023-04-13 18:05:00\n---\n\n精通 Nginx，学其它的 Apache、Tomcat 更轻松。\n\n# 安装 Nginx\n\n## CentOS 中通过 DNF 包管理器自动下载安装\n\n> [!note] 本案例中使用的服务器信息\n> CPU&内存：1 核 (vCPU)2 GiB\n> 操作系统：Alibaba Cloud Linux 3.2104 64 位\n> 实例规格：ecs.n4.small\n> 实例规格族：共享计算型\n> 刚刚初始化云盘的 ECS 服务器。\n\n运行以下命令安装 Nginx：\n\n```bash\ndnf -y install http://nginx.org/packages/centos/8/x86_64/RPMS/nginx-1.22.1-1.el8.ngx.x86_64.rpm \n```\n\n您可以访问 [Nginx官方安装包](https://nginx.org/packages/centos/8/x86_64/RPMS/) 获取适用于 CentOS 8 系统的多版本的 Nginx 安装包。\n\n## 通过官网下载源代码自行编译\n\n> 最原始的方式\n\n官网软件包下载地址：[nginx: download](https://nginx.org/en/download.html)\n\n```shell\ncurl -o nginx-1.20.2.tar.gz https://nginx.org/download/nginx-1.20.2.tar.gz\n```\n\n解压：\n\n```shell\ntar -zxvf nginx-1.20.2.tar.gz\ncd nginx-1.20.2\n```\n\n检查依赖：\n\n```shell\n./configure\n```\n\nyum 安装缺失的库：\n\n```shell\nyum install pcre pcre-devel -y\nyum install openssl openssl-devel -y\n```\n\n安装完毕后可再次进行依赖检查 `./configure`。\n\n设置系统参数：\n\n```shell\n./configure --with-http_ssl_module --with-http_v2_module --with-stream\n```\n\n编译与安装：\n\n```shell\nmake\nmake install\n```\n\n编译出来的二进制文件在 `/usr/local/nginx/sbin/nginx` 中（之前 configure 检查时有提示）。\n\n接下来配置环境变量，将二进制文件的地址配置进去：\n\n```shell\nvim /etc/profile\n```\n\n在打开的文件中的最后加入以下内容：\n\n```txt\nexport PATH=$PATH:/usr/local/nginx/sbin\n```\n\n刷新使配置文件生效：\n\n```shell\nsource /etc/profile\n```\n\n# 验证并启动 Nginx\n\n运行以下命令查看 Nginx 版本。\n\n```sh\nnginx -v\n```\n\n启动 Nginx 服务：\n\n```sh\nsystemctl start nginx\n```\n\n在本地电脑的浏览器输入主机地址并访问，出现 Nginx 默认页面即成功。\n\n![image-20230409141117412|500](https://cdn.gallery.uuanqin.top/img/image-20230409141117412.png)\n\n# 反向代理的配置\n\n## 一般的请求转发\n\n找到 `nginx.conf` 文件进行配置，一般在 `/etc/nginx` 目录下。但我遇到一个问题，就是配置文件没有 server 字段。于是我参考了 [这篇文章](https://blog.csdn.net/qq_37283570/article/details/112854376)。最终在 `/etc/nginx/conf.d/default.conf` 中找到了。\n\n修改配置文件，设定好网站的根目录：\n\n![image-20230408205637757|500](https://cdn.gallery.uuanqin.top/img/image-20230408205637757.png)\n\n重启 Nginx：\n\n```sh\nsystemctl restart nginx\n# 或 nginx -s reload # 不用重启nginx\n# 或 systemctl reload nginx\n```\n\n你可以在服务器上对应自己设置的根目录创建文本文件，如 `xiazai.txt`，然后浏览器访问网址 `<服务器主机IP>/xiazai.txt` 进行测试。\n\n## SSE 请求转发\n\n如果服务器部署的服务需要通过 SSE 协议交流（MCP Server），那么注意 Nginx 中不要破坏掉 SSE 的传输过程。一份能正确运行的配置如下：\n\n```conf\nserver {\n   listen 443 ssl;\n    server_name mcp.uuanqin.top;  # 你的域名，确保已解析到服务器 IP\n\n    location / {\n        proxy_pass http://localhost:8991;\n        proxy_http_version 1.1;  # 必须用 HTTP/1.1\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        # MCP 协议专用转发配置（关键！）\n        proxy_set_header Connection \"\";  # 禁用连接重置，保持长连接\n        proxy_buffering off;  # 禁用缓冲，保证帧传输完整\n        proxy_cache off;      # 禁用缓存\n        proxy_read_timeout 120s;  # 延长读超时（MCP 握手需要时间）\n        proxy_send_timeout 120s;\n    }\n\n    # 可选：添加访问日志，方便排查问题\n    access_log /var/log/nginx/mcp.uuanqin.top.access.log main;\n    error_log /var/log/nginx/mcp.uuanqin.top.error.log;\n\n    ssl_certificate /etc/letsencrypt/live/mcp.uuanqin.top/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/mcp.uuanqin.top/privkey.pem; # managed by Certbot\n   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\n\nserver {\n    if ($host = mcp.uuanqin.top) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n    listen 80;\n    server_name mcp.uuanqin.top;\n    return 404; # managed by Certbot\n}\n```\n\n# 本文参考\n\n- [CentOS 8 自建安装 Nginx+Mysql环境+PHP环境 (aliyun.com)](https://help.aliyun.com/document_detail/464754.html?spm=a2c4g.472049.0.0.6a8d4de5bhOeVO)\n- [Linux Nginx 配置/绑定域名_nginx配置域名_dadeity的博客-CSDN博客](https://blog.csdn.net/github_38336924/article/details/82756779)\n- [Nginx 配置详解 | 菜鸟教程 (runoob.com)](https://www.runoob.com/w3cnote/nginx-setup-intro.html)\n- [Nginx多域名多Server反向代理配置 - davidkam - 博客园 (cnblogs.com)](https://www.cnblogs.com/davidkam/p/3507082.html)","categories":[{"name":"博客站点维护","api":"api/categories/博客站点维护.json"}],"tags":[{"name":"Linux","api":"api/tags/Linux.json"},{"name":"安装","api":"api/tags/安装.json"},{"name":"Nginx","api":"api/tags/Nginx.json"},{"name":"ECS","api":"api/tags/ECS.json"}]},"api":"api/posts/p/661ecc9.json"}