{"data":{"title":"差分数组","slug":"算法与数据结构/差分数组","description":"运用差分数组的性质降低复杂度","date":"2025-05-22T15:04:47.000Z","updated":"2025-09-26T16:05:51.022Z","language":"zh-CN","comments":true,"url":"p/f4bb8efc/","cover":"https://cdn.gallery.uuanqin.top/img/202505262100782.webp","images":[],"content":"<p>差分数组是前缀和的逆运算。</p>\n\n<div class=\"callout\" data-callout=\"cite\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-quote\"><path d=\"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z\"/><path d=\"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z\"/></svg>\n</div>\n<div class=\"callout-title-inner\">Cite</div>\n</div>\n<div class=\"callout-content\"><p>差分与 <a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/59af443f/\"><span class=\"bilink-pop-up\">站内文章</span>前缀和</a> 的关系，类似导数与积分的关系。——<a href=\"https://leetcode.cn/u/endlesscheng/\">@灵茶山艾府</a></p>\n</div></div><p>本文题目难度标识：🟩简单，🟨中等，🟥困难。</p>\n<h1 id=\"一维差分\"><a class=\"markdownIt-Anchor\" href=\"#一维差分\"></a> 一维差分</h1>\n<p>对于数组 a，定义其差分数组（difference array）为</p>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>d</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>=</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.3599999999999999em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>a</mi><mo stretchy=\"false\">[</mo><mn>0</mn><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"1em\"/><mi>i</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>a</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo>−</mo><mi>a</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"1em\"/><mi>i</mi><mo>≥</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\">\nd[i] = \n\\begin{cases} \na[0], &amp; \\quad i = 0 \\\\ \na[i] - a[i - 1], &amp; \\quad i \\geq 1 \n\\end{cases}\n\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.0000299999999998em;vertical-align:-1.25003em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>差分数组具有以下性质：</p>\n<ul>\n<li>性质 1：从左到右累加 d 中的元素，可以得到数组 a。</li>\n<li>性质 2：如下两个操作是等价的。\n<ul>\n<li>把 a 的子数组 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">[</mo><mi>j</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">a[i],a[i+1],…,a[j]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mclose\">]</span></span></span></span> 都加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>。</li>\n<li>把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">d[i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span></span></span></span> 增加 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>，把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mo stretchy=\"false\">[</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">d[j+1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 减少 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>。</li>\n</ul>\n</li>\n</ul>\n<p>观察性质 2，原本 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的操作可以变为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 的操作，然后通过性质 1 使用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的时间恢复数组 a。性质 2 也告诉我们差分数组是怎么影响原数组的。当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">d[i]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span></span></span></span> 发生变动，如加 1，表示把 a 中下标 i 及后面的数都加上了 1。</p>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">本节例题 🟨 <a href=\"https://leetcode.cn/problems/car-pooling/description/\">1094. 拼车 - 力扣（LeetCode）</a></div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span>[] diff = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[<span class=\"number\">1003</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span>[] q: questions)&#123;</span><br><span class=\"line\">\tdiff[q[<span class=\"number\">1</span>]]+=q[<span class=\"number\">0</span>]; <span class=\"comment\">// start</span></span><br><span class=\"line\">\tdiff[q[<span class=\"number\">2</span>]]-=q[<span class=\"number\">0</span>]; <span class=\"comment\">// end+1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">pre</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;          <span class=\"comment\">// 前缀和</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;=<span class=\"number\">1000</span>;i++)&#123;</span><br><span class=\"line\">\tpre+=diff[i];</span><br><span class=\"line\">\t<span class=\"comment\">// 通过前缀和还原原数组</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>相关题目：🟩 <a href=\"https://leetcode.cn/problems/points-that-intersect-with-cars/description/\">2848. 与车相交的点 - 力扣（LeetCode）</a></p>\n<p>如果差分数组的数据比较稀疏，或构建差分数组的长度过大，那么在实现差分数组时除了建立一个 <code>Array</code> 数组外，还可以使用 <code>Map</code> 替代数组记录下标和值的键值对。</p>\n<p>Java 具体做法为，使用 <code>TreeMap</code> 或使用普通 <code>Map</code>，再对 <code>key</code> 做一次排序。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Map&lt;Integer,Integer&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">TreeMap</span>&lt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span>[] q:questions)&#123;</span><br><span class=\"line\">\tmap.merge(q[<span class=\"number\">1</span>],q[<span class=\"number\">0</span>],Integer::sum);</span><br><span class=\"line\">\tmap.merge(q[<span class=\"number\">2</span>],-q[<span class=\"number\">0</span>],Integer::sum);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">pre</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(Map.Entry&lt;Integer,Integer&gt; e:map.entrySet())&#123;</span><br><span class=\"line\">\tpre+=e.getValue();</span><br><span class=\"line\">\t<span class=\"comment\">// 通过前缀和还原原数组</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>相关题目：</p>\n<ul>\n<li>🟨 <a href=\"https://leetcode.cn/problems/my-calendar-ii/\">731. 我的日程安排表 II - 力扣（LeetCode）</a></li>\n<li>🟥 <a href=\"https://leetcode.cn/problems/my-calendar-iii/description/\">732. 我的日程安排表 III - 力扣（LeetCode）</a></li>\n</ul>\n<h1 id=\"二维差分\"><a class=\"markdownIt-Anchor\" href=\"#二维差分\"></a> 二维差分</h1>\n<p>从一位差分数组到二维差分数组：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202505262050529.webp\" alt=\"image.png\" /></p>\n<p>原数组的还原方式：计算二维前缀和即可还原。</p>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">二维前缀和：🟨 <a href=\"https://leetcode.cn/problems/range-sum-query-2d-immutable/description/\">304. 二维区域和检索 - 矩阵不可变 - 力扣（LeetCode）</a></div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>相关题目：</p>\n<ul>\n<li>🟨 <a href=\"https://leetcode.cn/problems/increment-submatrices-by-one/description/\">2536. 子矩阵元素加 1 - 力扣（LeetCode）</a></li>\n<li>🟥 <a href=\"https://leetcode.cn/problems/stamping-the-grid/description/\">2132. 用邮票贴满网格图 - 力扣（LeetCode）</a></li>\n</ul>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://leetcode.cn/problems/car-pooling/solutions/1/suan-fa-xiao-ke-tang-chai-fen-shu-zu-fu-9d4ra/\">【算法小课堂】差分数组（Python/Java/C++/Go/JS/Rust）</a></li>\n<li><a href=\"https://leetcode.cn/discuss/post/3583665/fen-xiang-gun-ti-dan-chang-yong-shu-ju-j-bvmv/\">分享丨【算法题单】常用数据结构（前缀和/栈/队列/堆/字典树/并查集/树状数组/线段树）- 讨论 - 力扣（LeetCode）</a></li>\n<li><a href=\"https://leetcode.cn/problems/stamping-the-grid/solutions/1199642/wu-nao-zuo-fa-er-wei-qian-zhui-he-er-wei-zwiu/\">2132. 用邮票贴满网格图 - 力扣（LeetCode）</a></li>\n</ul>\n","raw":"---\ntitle: 差分数组\ntags:\n  - Array\n  - Java\n  - 前缀和\ncover: 'https://cdn.gallery.uuanqin.top/img/202505262100782.webp'\ndescription: 运用差分数组的性质降低复杂度\nkatex: true\ncategories:\n  - 算法与数据结构\nabbrlink: f4bb8efc\ndate: 2025-05-22 23:04:47\ntop_img:\n---\n\n差分数组是前缀和的逆运算。\n\n> [!cite]\n> 差分与 [[前后缀分解的应用|前缀和]] 的关系，类似导数与积分的关系。——[@灵茶山艾府](https://leetcode.cn/u/endlesscheng/)\n\n本文题目难度标识：🟩简单，🟨中等，🟥困难。\n\n# 一维差分\n\n对于数组 a，定义其差分数组（difference array）为\n\n$$\n\nd[i] = \n\\begin{cases} \na[0], & \\quad i = 0 \\\\ \na[i] - a[i - 1], & \\quad i \\geq 1 \n\\end{cases}\n\n$$\n\n差分数组具有以下性质：\n\n- 性质 1：从左到右累加 d 中的元素，可以得到数组 a。\n- 性质 2：如下两个操作是等价的。\n\t- 把 a 的子数组 $a[i],a[i+1],…,a[j]$ 都加上 $x$。\n\t- 把 $d[i]$ 增加 $x$，把 $d[j+1]$ 减少 $x$。\n\n观察性质 2，原本 $O(n)$ 的操作可以变为 $O(1)$ 的操作，然后通过性质 1 使用 $O(n)$ 的时间恢复数组 a。性质 2 也告诉我们差分数组是怎么影响原数组的。当 $d[i]$ 发生变动，如加 1，表示把 a 中下标 i 及后面的数都加上了 1。\n\n> [!example] 本节例题 🟨 [1094. 拼车 - 力扣（LeetCode）](https://leetcode.cn/problems/car-pooling/description/)\n\n```java\nint[] diff = new int[1003];\nfor(int[] q: questions){\n\tdiff[q[1]]+=q[0]; // start\n\tdiff[q[2]]-=q[0]; // end+1\n}\nint pre = 0;          // 前缀和\nfor(int i=0;i<=1000;i++){\n\tpre+=diff[i];\n\t// 通过前缀和还原原数组\n}\n```\n\n相关题目：🟩 [2848. 与车相交的点 - 力扣（LeetCode）](https://leetcode.cn/problems/points-that-intersect-with-cars/description/)\n\n如果差分数组的数据比较稀疏，或构建差分数组的长度过大，那么在实现差分数组时除了建立一个 `Array` 数组外，还可以使用 `Map` 替代数组记录下标和值的键值对。\n\nJava 具体做法为，使用 `TreeMap` 或使用普通 `Map`，再对 `key` 做一次排序。\n\n```java\nMap<Integer,Integer> map = new TreeMap<>();\nfor(int[] q:questions){\n\tmap.merge(q[1],q[0],Integer::sum);\n\tmap.merge(q[2],-q[0],Integer::sum);\n}\nint pre = 0;\nfor(Map.Entry<Integer,Integer> e:map.entrySet()){\n\tpre+=e.getValue();\n\t// 通过前缀和还原原数组\n}\n```\n\n相关题目：\n\n- 🟨 [731. 我的日程安排表 II - 力扣（LeetCode）](https://leetcode.cn/problems/my-calendar-ii/)\n- 🟥 [732. 我的日程安排表 III - 力扣（LeetCode）](https://leetcode.cn/problems/my-calendar-iii/description/)\n\n# 二维差分\n\n从一位差分数组到二维差分数组：\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202505262050529.webp)\n\n原数组的还原方式：计算二维前缀和即可还原。\n\n> [!example] 二维前缀和：🟨 [304. 二维区域和检索 - 矩阵不可变 - 力扣（LeetCode）](https://leetcode.cn/problems/range-sum-query-2d-immutable/description/)\n\n相关题目：\n\n- 🟨 [2536. 子矩阵元素加 1 - 力扣（LeetCode）](https://leetcode.cn/problems/increment-submatrices-by-one/description/)\n- 🟥 [2132. 用邮票贴满网格图 - 力扣（LeetCode）](https://leetcode.cn/problems/stamping-the-grid/description/)\n\n# 本文参考\n- [【算法小课堂】差分数组（Python/Java/C++/Go/JS/Rust）](https://leetcode.cn/problems/car-pooling/solutions/1/suan-fa-xiao-ke-tang-chai-fen-shu-zu-fu-9d4ra/)\n- [分享丨【算法题单】常用数据结构（前缀和/栈/队列/堆/字典树/并查集/树状数组/线段树）- 讨论 - 力扣（LeetCode）](https://leetcode.cn/discuss/post/3583665/fen-xiang-gun-ti-dan-chang-yong-shu-ju-j-bvmv/)\n- [2132. 用邮票贴满网格图 - 力扣（LeetCode）](https://leetcode.cn/problems/stamping-the-grid/solutions/1199642/wu-nao-zuo-fa-er-wei-qian-zhui-he-er-wei-zwiu/)\n","categories":[{"name":"算法与数据结构","api":"api/categories/算法与数据结构.json"}],"tags":[{"name":"Java","api":"api/tags/Java.json"},{"name":"前缀和","api":"api/tags/前缀和.json"},{"name":"Array","api":"api/tags/Array.json"}]},"api":"api/posts/p/f4bb8efc.json"}