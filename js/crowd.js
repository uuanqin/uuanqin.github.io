console.clear(),console.log('lsakdfalskjdflnksd');let config={src:'https://s3-us-west-2.amazonaws.com/s.cdpn.io/175711/open-peeps-sheet.png',rows:15,cols:7},randomRange=(min,max)=>min+Math.random()*(max-min),randomIndex=array=>0|randomRange(0,array.length),removeFromArray=(array,i)=>array.splice(i,1)[0],removeItemFromArray=(array,item)=>removeFromArray(array,array.indexOf(item)),removeRandomFromArray=array=>removeFromArray(array,randomIndex(array)),getRandomFromArray=array=>array[0|randomIndex(array)],resetPeep=({stage,peep})=>{var direction=.5<Math.random()?1:-1,offsetY=100-250*gsap.parseEase('power2.in')(Math.random()),offsetY=stage.height-peep.height+offsetY;let startX,endX;return 1==direction?(startX=-peep.width,endX=stage.width,peep.scaleX=1):(startX=stage.width+peep.width,endX=0,peep.scaleX=-1),peep.x=startX,peep.y=offsetY,peep.anchorY=offsetY,{startX:startX,startY:offsetY,endX:endX}},normalWalk=({peep,props})=>{var{startY:props,endX}=props,tl=gsap.timeline();return tl.timeScale(randomRange(.5,1.5)),tl.to(peep,{duration:10,x:endX,ease:'none'},0),tl.to(peep,{duration:.25,repeat:40,yoyo:!0,y:props-10},0),tl},walks=[normalWalk];class Peep{constructor({image,rect}){this.image=image,this.setRect(rect),this.x=0,this.y=0,this.anchorY=0,this.scaleX=1,this.walk=null}setRect(rect){this.rect=rect,this.width=rect[2],this.height=rect[3],this.drawArgs=[this.image,...rect,0,0,this.width,this.height]}render(ctx){ctx.save(),ctx.translate(this.x,this.y),ctx.scale(this.scaleX,1),ctx.drawImage(...this.drawArgs),ctx.restore()}}let img_crowd=document.createElement('img'),canvas=(img_crowd.onload=init,img_crowd.src=config.src,document.querySelector('#canvas')),ctx=canvas.getContext('2d'),stage={width:0,height:0};var allPeeps=[];let availablePeeps=[],crowd=[];function init(){createPeeps(),resize(),gsap.ticker.add(render),window.addEventListener('resize',resize)}function createPeeps(){var{rows,cols}=config,{naturalWidth:width,naturalHeight:height}=img_crowd,total=rows*cols,rectWidth=width/rows,rectHeight=height/cols;for(let i=0;i<total;i++)allPeeps.push(new Peep({image:img_crowd,rect:[i%rows*rectWidth,(i/rows|0)*rectHeight,rectWidth,rectHeight]}))}function resize(){stage.width=canvas.clientWidth,stage.height=canvas.clientHeight,canvas.width=stage.width*devicePixelRatio,canvas.height=stage.height*devicePixelRatio,crowd.forEach(peep=>{peep.walk.kill()}),crowd.length=0,availablePeeps.length=0,availablePeeps.push(...allPeeps),initCrowd()}function initCrowd(){for(;availablePeeps.length;)addPeepToCrowd().walk.progress(Math.random())}function addPeepToCrowd(){let peep=removeRandomFromArray(availablePeeps);var walk=getRandomFromArray(walks)({peep:peep,props:resetPeep({peep:peep,stage:stage})}).eventCallback('onComplete',()=>{removePeepFromCrowd(peep),addPeepToCrowd()});return peep.walk=walk,crowd.push(peep),crowd.sort((a,b)=>a.anchorY-b.anchorY),peep}function removePeepFromCrowd(peep){removeItemFromArray(crowd,peep),availablePeeps.push(peep)}function render(){canvas.width=canvas.width,ctx.save(),ctx.scale(devicePixelRatio,devicePixelRatio),crowd.forEach(peep=>{peep.render(ctx)}),ctx.restore()}