{"data":{"title":"魔改脚本实现知网导出 Bibtex 参考格式","slug":"工具箱/魔改脚本实现知网导出 Bibtex 参考格式","description":"修改油叉脚本以适应当前访问知网的网络状况","date":"2023-05-11T08:37:21.000Z","updated":"2024-10-02T15:10:39.201Z","language":"zh-CN","comments":true,"url":"p/84ae21ea/","cover":"https://cdn.gallery.uuanqin.top/img/bibtexzhiwangcover554fsd(1).png","images":[],"content":"<blockquote>\n<p>这篇文章的脚本已发布到 Greasy Fork（油叉）平台，你可以前往 <a href=\"https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6\">知网 参考文献 bibtex 天津大学 (greasyfork.org)</a> 进行下载安装。后续脚本更新将在该平台更新。<code>230511</code><br />\n<a href=\"https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://img.shields.io/greasyfork/v/466046?label=知网 参考文献 bibtex 天津大学\" alt=\"img\" /></a></p>\n</blockquote>\n<hr />\n<p>最近不是开始写毕业论文了嘛，使用到 LaTeX 进行写作。其中，导入参考文献部分需要以 BibTeX 格式写进模板中。</p>\n<p>Google Scholar 网站上存在兼容 BibTeX 的参考文献信息，但是知网里没有这种格式的导出，这时就可以借助脚本实现这个功能。</p>\n<p>这里分享我的魔改推导步骤，不想看过程的直接复制后文源码（DIFF 文件，记得删前面的 ± 号）。</p>\n\n<div class=\"callout\" data-callout=\"warning\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-alert-triangle\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><path d=\"M12 9v4\"/><path d=\"M12 17h.01\"/></svg>\n</div>\n<div class=\"callout-title-inner\">本文仅适用于天津大学校内登录用户，代码并不具有普遍性。各位读者可以根据思路自行改动。</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><h1 id=\"不借助脚本实现-bibtex-参考文献生成及标注方法\"><a class=\"markdownIt-Anchor\" href=\"#不借助脚本实现-bibtex-参考文献生成及标注方法\"></a> 不借助脚本实现 Bibtex 参考文献生成及标注方法</h1>\n<p>在介绍使用脚本方法之前先简要说明我之前的解决方案。</p>\n<h2 id=\"使用谷歌学术进行参考文献生成\"><a class=\"markdownIt-Anchor\" href=\"#使用谷歌学术进行参考文献生成\"></a> 使用谷歌学术进行参考文献生成</h2>\n<p>通过以下几个步骤，可以轻松完成参考文献的生成。</p>\n<ol>\n<li>在谷歌学术搜索中，点击学术搜索设置。</li>\n<li>页面打开之后，在文献管理软件选项中选择显示导入 BibTeX 的链接，单击保存设置，退出。</li>\n<li>在谷歌学术搜索中检索到文献后，在文献条目区域单击导入 BibTeX 选项，页面中出现文献的引用信息。<br />\n<img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511164837738.png\" alt=\"image-20230511164837738\" width=\"500px\" /></li>\n</ol>\n<p>格式是这样的：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@article&#123;刘娟2020基于,</span><br><span class=\"line\">  title=&#123;基于 Python 爬虫的职位信息数据分析和可视化系统实现&#125;,</span><br><span class=\"line\">  author=&#123;刘娟 and 管希东&#125;,</span><br><span class=\"line\">  journal=&#123;Software Engineering and Applications&#125;,</span><br><span class=\"line\">  volume=&#123;9&#125;,</span><br><span class=\"line\">  pages=&#123;317&#125;,</span><br><span class=\"line\">  year=&#123;2020&#125;,</span><br><span class=\"line\">  publisher=&#123;中文学术期刊, 汉斯出版社, Hans Publishers&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"转化知网-noteexpress-文献导出格式\"><a class=\"markdownIt-Anchor\" href=\"#转化知网-noteexpress-文献导出格式\"></a> 转化知网 NoteExpress 文献导出格式</h2>\n<p>知网没有直接导出 BibTeX 文献导出格式的功能，但是有一个格式跟它很像。</p>\n<ol>\n<li>\n<p>在文章介绍页面点击导出参考文献</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511165242045.png\" alt=\"image-20230511165242045\" width=\"525px\" /></p>\n</li>\n<li>\n<p>选择“更多引用格式”</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511165317189.png\" alt=\"image-20230511165317189\" width=\"575px\" /></p>\n</li>\n<li>\n<p>选择 NoteExpress</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511165344333.png\" alt=\"image-20230511165344333\" width=\"500px\" /></p>\n</li>\n</ol>\n<p>对应着 BibTeX 的格式，你就可以自己写咯。</p>\n<h1 id=\"脚本解决\"><a class=\"markdownIt-Anchor\" href=\"#脚本解决\"></a> 脚本解决</h1>\n<p>使用浏览器插件 Tampermonkey，在 Greasy Fork 中搜索脚本：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511165539516.png\" alt=\"image-20230511165539516\" width=\"500px\" /></p>\n<blockquote>\n<p>读图片的介绍，知道该脚本的原理就是把知网 NodeExpress 格式进行转换，理解这一点方便我们进行后续的魔改</p>\n</blockquote>\n<p>安装后，在知网文章介绍页面中会多出按钮，点击后 BibTeX 格式的参考文献会自动复制到粘贴板中。如果你试过了没有问题，那么本篇文章到此结束。</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511165810324.png\" alt=\"\" width=\"425px\" /></p>\n<p>由于我使用的是学校账号打开的知网，知网的网址与相关接口都不一样，这个脚本就不会起作用。那么接下来就是魔改时刻。</p>\n<h2 id=\"魔改-1-脚本需要匹配对应的网址\"><a class=\"markdownIt-Anchor\" href=\"#魔改-1-脚本需要匹配对应的网址\"></a> 魔改 1- 脚本需要匹配对应的网址</h2>\n<p>这个脚本只有在特定的地址才发挥作用，不然你会看不到上文图中多出的按钮。</p>\n<p>因为我的知网文章首页地址是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://&lt;一堆字符&gt;.eds.tju.edu.cn/kcms2/article/abstract&lt;后面省略参数&gt;</span><br></pre></td></tr></table></figure>\n<p>所以我就想办法增加这条规则：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://&lt;一堆字符&gt;.eds.tju.edu.cn/kcms2/article/abstract*</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>添加的 URL 规则根据你的具体情况进行设计</p>\n</blockquote>\n<h3 id=\"方法-1js-源代码修改\"><a class=\"markdownIt-Anchor\" href=\"#方法-1js-源代码修改\"></a> 方法 1：js 源代码修改</h3>\n<p>在源代码中增加这一行规则，ctrl+s 保存即可。</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511171357098.png\" alt=\"image-20230511171357098\" width=\"550px\" /></p>\n<h3 id=\"方法-2设置页面增加设定\"><a class=\"markdownIt-Anchor\" href=\"#方法-2设置页面增加设定\"></a> 方法 2：设置页面增加设定</h3>\n<p>打开 TamperMonkey 脚本管理界面，点击设置选项卡增加用户匹配：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511171717236.png\" alt=\"image-20230511171717236\" width=\"550px\" /></p>\n<p>保存后重新访问文章简介页试试看，出现 BibTex 按钮此部分就成功了。</p>\n<h2 id=\"魔改-2-使用正确的接口\"><a class=\"markdownIt-Anchor\" href=\"#魔改-2-使用正确的接口\"></a> 魔改 2- 使用正确的接口</h2>\n<p>经过上一步后，虽然出现了按钮，但不起作用。打开控制台会出现报错信息：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511172003104.png\" alt=\"image-20230511172003104\" width=\"500px\" /></p>\n<p>看了一下脚本的源码，它发送的 POST 请求地址为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://kns.cnki.net/kns8/manage/APIGetExport</span><br></pre></td></tr></table></figure>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511170918257.png\" alt=\"image-20230511170918257\" width=\"525px\" /></p>\n<p>这里的接口地址我们可以改一下。之前我们提到脚本原理就是读取知网 NoteExpress 格式进行 BibTeX 的转换。这里我通过抓包，得到接口的地址：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230511172554301.png\" alt=\"image-20230511172554301\" width=\"550px\" /></p>\n<p>那么我们就可以把这串地址粗暴的写进去。（注意配合通配符使用）</p>\n<h2 id=\"魔改-3-使用正确的返回数据\"><a class=\"markdownIt-Anchor\" href=\"#魔改-3-使用正确的返回数据\"></a> 魔改 3- 使用正确的返回数据</h2>\n<p>改对了 POST 请求发送的地址还不够，该脚本不能正确解析返回数据。</p>\n<p>返回的数据是字符串：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ul class=&#x27;literature-list&#x27;&gt;</span><br><span class=\"line\">&lt;li&gt;</span><br><span class=\"line\">\t&#123;Reference Type&#125;: Journal Article&lt;br&gt;</span><br><span class=\"line\">\t&#123;Title&#125;: Flask框架在数据可视化的应用&lt;br&gt;</span><br><span class=\"line\">\t&#123;Author&#125;: 陈嘉发;黄宇靖;&lt;br&gt;</span><br><span class=\"line\">\t&#123;Author Address&#125;: 惠州卫生职业技术学院教育技术与信息中心;&lt;br&gt;</span><br><span class=\"line\">\t&#123;Journal&#125;: 福建电脑&lt;br&gt;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t&#123;Database Provider&#125;: CNKI&lt;br&gt;</span><br><span class=\"line\">&lt;/li&gt;</span><br><span class=\"line\">&lt;/ul&gt;</span><br><span class=\"line\">&lt;input id=&quot;traceid&quot; type=&quot;hidden&quot; value=&quot;cf4aca8f33f5471f9c383ebf93578d2f.227.16837969341201267&quot;&gt;</span><br></pre></td></tr></table></figure>\n<p>经过调试与源码推测我们需要的是 <code>&lt;li&gt;</code> 标签中的内容。</p>\n<p>对应的正则表达式为：（附工具：<a href=\"https://c.runoob.com/front-end/854/\">正则表达式在线测试 | 菜鸟工具 (runoob.com)</a>）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/(?&lt;=&lt;li&gt;).*(?=&lt;/li&gt;)/g</span><br></pre></td></tr></table></figure>\n<p>对应的 js 语句（多了个转义符 <code>\\</code>）：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ss = data.<span class=\"title function_\">match</span>(<span class=\"regexp\">/(?&lt;=&lt;li&gt;).*(?=&lt;\\/li&gt;)/g</span>)</span><br></pre></td></tr></table></figure>\n<p>一顿编辑源码与 BUG 修复就 OK 了（具体编辑看 DIFF 文件）！</p>\n<p>使用效果：</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@article&#123;cite<span class=\"built_in\">_</span>label,</span><br><span class=\"line\">   title=&#123;flask框架在数据可视化的应用&#125;,</span><br><span class=\"line\">   author=&#123;陈嘉发;黄宇靖;&#125;,</span><br><span class=\"line\">   authoraddress=&#123;惠州卫生职业技术学院教育技术与信息中心;&#125;,</span><br><span class=\"line\">   journal=&#123;福建电脑&#125;,</span><br><span class=\"line\">   year=&#123;2022&#125;,</span><br><span class=\"line\">   volume=&#123;38&#125;,</span><br><span class=\"line\">   number=&#123;12&#125;,</span><br><span class=\"line\">   pages=&#123;44-48&#125;,</span><br><span class=\"line\">   keywords=&#123;flask框架;python爬虫;数据可视化图表库&#125;,</span><br><span class=\"line\">   abstract=&#123;我就省略了，一大串的&#125;,</span><br><span class=\"line\">   isbn/issn=&#123;1673-2782&#125;,</span><br><span class=\"line\">   notes=&#123;35-1115/tp&#125;,</span><br><span class=\"line\">   doi=&#123;10.16707/j.cnki.fjpc.2022.12.009&#125;,</span><br><span class=\"line\">   databaseprovider=&#123;cnki&#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>提一点，在我的模板中，cite_label 不能是中文，否则编译出错。我使用的是天津大学毕业论文模板：<a href=\"https://gitee.com/tju_embedded/tju_undergraduate_design\">嵌入式软件工程实验室/天津大学本科毕业论文 Latex 模板 - 码云 - 开源中国 (gitee.com)</a></p>\n</blockquote>\n<h1 id=\"源码\"><a class=\"markdownIt-Anchor\" href=\"#源码\"></a> 源码</h1>\n<blockquote>\n<p>此处不再更新，新版本请前往 Greasy Fork 平台进行下载安装。DIFF 文件进提供修改参考。</p>\n</blockquote>\n<p>diff 文件。把减号行删除，删除加号行的加号即可得目的源文件。</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// ==UserScript==</span><br><span class=\"line\">// @name         知网 参考文献 bibtex</span><br><span class=\"line\">// @namespace    https://github.com/HawkTom</span><br><span class=\"line\">// @require      https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js</span><br><span class=\"line\">// @version      1.1.1</span><br><span class=\"line\">// @description  从知网文献中直接复制bibtex</span><br><span class=\"line\"><span class=\"deletion\">- // @author       Hao</span></span><br><span class=\"line\"><span class=\"addition\">+ // @author       Hao, uuanqin</span></span><br><span class=\"line\">// @match        https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*</span><br><span class=\"line\">// @match        http://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*</span><br><span class=\"line\"><span class=\"addition\">+ // @match        https://*.eds.tju.edu.cn/kcms2/article/abstract*</span></span><br><span class=\"line\">// @grant        none</span><br><span class=\"line\">// ==/UserScript==</span><br><span class=\"line\"></span><br><span class=\"line\">(function() &#123;</span><br><span class=\"line\">    &#x27;use strict&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">    jQuery(document).ready(function($) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        window.onload = function()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            var a = document.getElementById(&quot;paramdbname&quot;)</span><br><span class=\"line\">            var b = document.getElementById(&quot;paramfilename&quot;)</span><br><span class=\"line\">            var fileid = a.getAttribute(&quot;value&quot;) + &#x27;!&#x27; + b.getAttribute(&quot;value&quot;) +&#x27;!1!0&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">            var x = document.getElementsByClassName(&quot;btn-tool&quot;)</span><br><span class=\"line\">            var input = document.createElement(&#x27;li&#x27;)</span><br><span class=\"line\">            input.setAttribute(&quot;id&quot;, &quot;bibbtn&quot;)</span><br><span class=\"line\">            input.setAttribute(&quot;class&quot;, &quot;btn-quote&quot;)</span><br><span class=\"line\">            //input.setAttribute(&quot;type&quot;, &quot;button&quot;)</span><br><span class=\"line\">            input.setAttribute(&quot;title&quot;, &quot;Bibtex&quot;)</span><br><span class=\"line\">            //input.setAttribute(&quot;onclick&quot;, &quot;func(this)&quot;) href=\\&quot;javascript:void(0)\\&quot; onclick=\\&quot;getBib()\\</span><br><span class=\"line\">            input.innerHTML = &quot;&lt;a&gt;&lt;i&gt;&lt;/i&gt;Bibtex&lt;/a&gt;&quot;</span><br><span class=\"line\">            x[0].children[0].append(input)</span><br><span class=\"line\"></span><br><span class=\"line\">            $(&quot;#bibbtn&quot;).click(function()&#123;</span><br><span class=\"line\"><span class=\"addition\">+           \tvar url = window.location.hostname; // 得到 *.eds.tju.edu.cn</span></span><br><span class=\"line\"><span class=\"deletion\">-            \t$.post(&quot;https://kns.cnki.net/kns8/manage/APIGetExport&quot;,</span></span><br><span class=\"line\"><span class=\"addition\">+               $.post(`https://$&#123;url&#125;/kns8/manage/ShowExport`,</span></span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                  filename:fileid,</span><br><span class=\"line\">                  displaymode:&quot;NoteExpress&quot;</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                function(data)&#123;</span><br><span class=\"line\">                    console.log(data);</span><br><span class=\"line\">                    var bibtext = &quot;&quot;</span><br><span class=\"line\"><span class=\"deletion\">-                   var ss = data.data[0].value[0]</span></span><br><span class=\"line\"><span class=\"deletion\">-                   var ssl = ss.split(&quot;&lt;br&gt;&quot;)</span></span><br><span class=\"line\"><span class=\"addition\">+                   var ss = data.match(/(?&lt;=&lt;li&gt;).*(?=&lt;\\/li&gt;)/g) // .data[0].value[0]</span></span><br><span class=\"line\"><span class=\"addition\">+                   console.log(ss); // 输出调试而已</span></span><br><span class=\"line\"><span class=\"addition\">+                   var ssl = ss[0].split(&quot;&lt;br&gt;&quot;)</span></span><br><span class=\"line\">                    for (var i=0; i&lt;ssl.length-1; i++)&#123;</span><br><span class=\"line\">                        var k = ssl[i].toLocaleLowerCase().split(&quot; &quot;).join(&quot;&quot;).split(&quot;:&quot;)</span><br><span class=\"line\">                        var item = k[0]</span><br><span class=\"line\">                        var detail = k[1]</span><br><span class=\"line\">                        if (item == &quot;&#123;referencetype&#125;&quot;)&#123;</span><br><span class=\"line\">                            if (detail == &quot;journalarticle&quot;)&#123;</span><br><span class=\"line\">                                bibtext = &quot;@article&#123;cite_label ,\\n&quot;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            else if(detail == &quot;conferenceproceedings&quot;)&#123;</span><br><span class=\"line\">                                bibtext = &quot;@inproceedings&#123;cite_label ,\\n&quot;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        else if(item == &quot;&#123;issue&#125;&quot;)&#123;</span><br><span class=\"line\"><span class=\"deletion\">-                           bibtext = bibtext + &quot;   &#123;number&#125;=&#123;&quot; + detail + &quot;&#125;,\\n&quot;</span></span><br><span class=\"line\"><span class=\"addition\">+                           bibtext = bibtext + &quot;   number=&#123;&quot; + detail + &quot;&#125;,\\n&quot; // 不明白这里的number为什么要括起来</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        else &#123;</span><br><span class=\"line\">                            bibtext = bibtext + &quot;   &quot; + item.substr(1, item.length-2) + &quot;=&#123;&quot; + detail + &quot;&#125;,\\n&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    bibtext += &quot;&#125;&quot;</span><br><span class=\"line\">                    //console.log(bibtext)</span><br><span class=\"line\">                    const copad = document.createElement(&#x27;textarea&#x27;)</span><br><span class=\"line\">                    copad.value = bibtext</span><br><span class=\"line\">                    document.body.appendChild(copad)</span><br><span class=\"line\">                    copad.select()</span><br><span class=\"line\">                    document.execCommand(&#x27;Copy&#x27;)</span><br><span class=\"line\">                    document.body.removeChild(copad)</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h1 id=\"后记\"><a class=\"markdownIt-Anchor\" href=\"#后记\"></a> 后记</h1>\n<p>作者本人已顺利从天大毕业，相关校园网账号已封禁，因此无法再对此脚本进行测试与维护。欢迎天大大佬们继续改进与维护脚本。</p>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://blog.csdn.net/fegxig1230/article/details/118458288\">知网 BibTeX 自动生成（使用 BibTeX 引用中文参考文献）_奕小星的博客-CSDN 博客</a></li>\n<li><a href=\"https://www.w3school.com.cn/js/js_string_search.asp\">JavaScript 字符串搜索 (w3school.com.cn)</a></li>\n<li><a href=\"https://c.runoob.com/front-end/854/\">正则表达式在线测试 | 菜鸟工具 (runoob.com)</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions#special-lookahead\">正则表达式 - JavaScript | MDN (mozilla.org)</a></li>\n<li><a href=\"https://blog.csdn.net/u013288800/article/details/82787641\">使用 JS 获取当前页面的 URL(网址信息)_js 获取 url_Devere 的博客-CSDN 博客</a></li>\n</ul>\n","raw":"---\ntitle: 魔改脚本实现知网导出 Bibtex 参考格式\ntags:\n  - BibTeX\n  - 知网\n  - Javascript\n  - Tampermonkey\n  - Greasy Fork\n  - TJU\ncover: 'https://cdn.gallery.uuanqin.top/img/bibtexzhiwangcover554fsd(1).png'\ndescription: 修改油叉脚本以适应当前访问知网的网络状况\nabbrlink: 84ae21ea\ncategories:\n  - 工具箱\ndate: 2023-05-11 16:37:21\ntop_img:\n---\n\n> 这篇文章的脚本已发布到 Greasy Fork（油叉）平台，你可以前往 [知网 参考文献 bibtex 天津大学 (greasyfork.org)](https://greasyfork.org/zh-CN/scripts/466046-知网-参考文献-bibtex-天津大学) 进行下载安装。后续脚本更新将在该平台更新。`230511`\n> [![img](https://img.shields.io/greasyfork/v/466046?label=%E7%9F%A5%E7%BD%91%20%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%20bibtex%20%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6)](https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6)\n\n---\n\n最近不是开始写毕业论文了嘛，使用到 LaTeX 进行写作。其中，导入参考文献部分需要以 BibTeX 格式写进模板中。\n\nGoogle Scholar 网站上存在兼容 BibTeX 的参考文献信息，但是知网里没有这种格式的导出，这时就可以借助脚本实现这个功能。\n\n这里分享我的魔改推导步骤，不想看过程的直接复制后文源码（DIFF 文件，记得删前面的 +- 号）。\n\n> [!warning] 本文仅适用于天津大学校内登录用户，代码并不具有普遍性。各位读者可以根据思路自行改动。\n\n# 不借助脚本实现 Bibtex 参考文献生成及标注方法\n\n在介绍使用脚本方法之前先简要说明我之前的解决方案。\n\n## 使用谷歌学术进行参考文献生成\n\n通过以下几个步骤，可以轻松完成参考文献的生成。\n\n1. 在谷歌学术搜索中，点击学术搜索设置。\n2. 页面打开之后，在文献管理软件选项中选择显示导入 BibTeX 的链接，单击保存设置，退出。\n3. 在谷歌学术搜索中检索到文献后，在文献条目区域单击导入 BibTeX 选项，页面中出现文献的引用信息。\n   ![image-20230511164837738|500](https://cdn.gallery.uuanqin.top/img/image-20230511164837738.png)\n\n格式是这样的：\n\n```tex\n@article{刘娟2020基于,\n  title={基于 Python 爬虫的职位信息数据分析和可视化系统实现},\n  author={刘娟 and 管希东},\n  journal={Software Engineering and Applications},\n  volume={9},\n  pages={317},\n  year={2020},\n  publisher={中文学术期刊, 汉斯出版社, Hans Publishers}\n}\n```\n\n## 转化知网 NoteExpress 文献导出格式\n\n知网没有直接导出 BibTeX 文献导出格式的功能，但是有一个格式跟它很像。\n\n1. 在文章介绍页面点击导出参考文献\n\n   ![image-20230511165242045|525](https://cdn.gallery.uuanqin.top/img/image-20230511165242045.png)\n\n2. 选择“更多引用格式”\n\n   ![image-20230511165317189|575](https://cdn.gallery.uuanqin.top/img/image-20230511165317189.png)\n\n3. 选择 NoteExpress\n\n   ![image-20230511165344333|500](https://cdn.gallery.uuanqin.top/img/image-20230511165344333.png)\n\n对应着 BibTeX 的格式，你就可以自己写咯。\n\n# 脚本解决\n\n使用浏览器插件 Tampermonkey，在 Greasy Fork 中搜索脚本：\n\n![image-20230511165539516|500](https://cdn.gallery.uuanqin.top/img/image-20230511165539516.png)\n\n> 读图片的介绍，知道该脚本的原理就是把知网 NodeExpress 格式进行转换，理解这一点方便我们进行后续的魔改\n\n安装后，在知网文章介绍页面中会多出按钮，点击后 BibTeX 格式的参考文献会自动复制到粘贴板中。如果你试过了没有问题，那么本篇文章到此结束。\n\n![|425](https://cdn.gallery.uuanqin.top/img/image-20230511165810324.png)\n\n由于我使用的是学校账号打开的知网，知网的网址与相关接口都不一样，这个脚本就不会起作用。那么接下来就是魔改时刻。\n\n## 魔改 1- 脚本需要匹配对应的网址\n\n这个脚本只有在特定的地址才发挥作用，不然你会看不到上文图中多出的按钮。\n\n因为我的知网文章首页地址是这样的：\n\n```\nhttps://<一堆字符>.eds.tju.edu.cn/kcms2/article/abstract<后面省略参数>\n```\n\n所以我就想办法增加这条规则：\n\n```\nhttps://<一堆字符>.eds.tju.edu.cn/kcms2/article/abstract*\n```\n\n> 添加的 URL 规则根据你的具体情况进行设计\n\n### 方法 1：js 源代码修改\n\n在源代码中增加这一行规则，ctrl+s 保存即可。\n\n![image-20230511171357098|550](https://cdn.gallery.uuanqin.top/img/image-20230511171357098.png)\n\n### 方法 2：设置页面增加设定\n\n打开 TamperMonkey 脚本管理界面，点击设置选项卡增加用户匹配：\n\n![image-20230511171717236|550](https://cdn.gallery.uuanqin.top/img/image-20230511171717236.png)\n\n保存后重新访问文章简介页试试看，出现 BibTex 按钮此部分就成功了。\n\n## 魔改 2- 使用正确的接口\n\n经过上一步后，虽然出现了按钮，但不起作用。打开控制台会出现报错信息：\n\n![image-20230511172003104|500](https://cdn.gallery.uuanqin.top/img/image-20230511172003104.png)\n\n看了一下脚本的源码，它发送的 POST 请求地址为：\n\n```\nhttps://kns.cnki.net/kns8/manage/APIGetExport\n```\n\n![image-20230511170918257|525](https://cdn.gallery.uuanqin.top/img/image-20230511170918257.png)\n\n这里的接口地址我们可以改一下。之前我们提到脚本原理就是读取知网 NoteExpress 格式进行 BibTeX 的转换。这里我通过抓包，得到接口的地址：\n\n![image-20230511172554301|550](https://cdn.gallery.uuanqin.top/img/image-20230511172554301.png)\n\n那么我们就可以把这串地址粗暴的写进去。（注意配合通配符使用）\n\n## 魔改 3- 使用正确的返回数据\n\n改对了 POST 请求发送的地址还不够，该脚本不能正确解析返回数据。\n\n返回的数据是字符串：\n\n```\n<ul class='literature-list'>\n<li>\n\t{Reference Type}: Journal Article<br>\n\t{Title}: Flask框架在数据可视化的应用<br>\n\t{Author}: 陈嘉发;黄宇靖;<br>\n\t{Author Address}: 惠州卫生职业技术学院教育技术与信息中心;<br>\n\t{Journal}: 福建电脑<br>\n\t...\n\t{Database Provider}: CNKI<br>\n</li>\n</ul>\n<input id=\"traceid\" type=\"hidden\" value=\"cf4aca8f33f5471f9c383ebf93578d2f.227.16837969341201267\">\n```\n\n经过调试与源码推测我们需要的是 `<li>` 标签中的内容。\n\n对应的正则表达式为：（附工具：[正则表达式在线测试 | 菜鸟工具 (runoob.com)](https://c.runoob.com/front-end/854/)）\n\n```reg\n/(?<=<li>).*(?=</li>)/g\n```\n\n对应的 js 语句（多了个转义符 `\\`）：\n\n```js\nvar ss = data.match(/(?<=<li>).*(?=<\\/li>)/g)\n```\n\n一顿编辑源码与 BUG 修复就 OK 了（具体编辑看 DIFF 文件）！\n\n使用效果：\n\n```tex\n@article{cite_label,\n   title={flask框架在数据可视化的应用},\n   author={陈嘉发;黄宇靖;},\n   authoraddress={惠州卫生职业技术学院教育技术与信息中心;},\n   journal={福建电脑},\n   year={2022},\n   volume={38},\n   number={12},\n   pages={44-48},\n   keywords={flask框架;python爬虫;数据可视化图表库},\n   abstract={我就省略了，一大串的},\n   isbn/issn={1673-2782},\n   notes={35-1115/tp},\n   doi={10.16707/j.cnki.fjpc.2022.12.009},\n   databaseprovider={cnki},\n}\n```\n\n> 提一点，在我的模板中，cite_label 不能是中文，否则编译出错。我使用的是天津大学毕业论文模板：[嵌入式软件工程实验室/天津大学本科毕业论文 Latex 模板 - 码云 - 开源中国 (gitee.com)](https://gitee.com/tju_embedded/tju_undergraduate_design)\n\n# 源码\n\n> 此处不再更新，新版本请前往 Greasy Fork 平台进行下载安装。DIFF 文件进提供修改参考。\n\ndiff 文件。把减号行删除，删除加号行的加号即可得目的源文件。\n\n```diff\n// ==UserScript==\n// @name         知网 参考文献 bibtex\n// @namespace    https://github.com/HawkTom\n// @require      https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js\n// @version      1.1.1\n// @description  从知网文献中直接复制bibtex\n- // @author       Hao\n+ // @author       Hao, uuanqin\n// @match        https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*\n// @match        http://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*\n+ // @match        https://*.eds.tju.edu.cn/kcms2/article/abstract*\n// @grant        none\n// ==/UserScript==\n\n(function() {\n    'use strict';\n\n    jQuery(document).ready(function($) {\n\n        window.onload = function(){\n\n            var a = document.getElementById(\"paramdbname\")\n            var b = document.getElementById(\"paramfilename\")\n            var fileid = a.getAttribute(\"value\") + '!' + b.getAttribute(\"value\") +'!1!0'\n\n            var x = document.getElementsByClassName(\"btn-tool\")\n            var input = document.createElement('li')\n            input.setAttribute(\"id\", \"bibbtn\")\n            input.setAttribute(\"class\", \"btn-quote\")\n            //input.setAttribute(\"type\", \"button\")\n            input.setAttribute(\"title\", \"Bibtex\")\n            //input.setAttribute(\"onclick\", \"func(this)\") href=\\\"javascript:void(0)\\\" onclick=\\\"getBib()\\\n            input.innerHTML = \"<a><i></i>Bibtex</a>\"\n            x[0].children[0].append(input)\n\n            $(\"#bibbtn\").click(function(){\n+           \tvar url = window.location.hostname; // 得到 *.eds.tju.edu.cn\n-            \t$.post(\"https://kns.cnki.net/kns8/manage/APIGetExport\",\n+               $.post(`https://${url}/kns8/manage/ShowExport`,\n                {\n                  filename:fileid,\n                  displaymode:\"NoteExpress\"\n                },\n                function(data){\n                    console.log(data);\n                    var bibtext = \"\"\n-                   var ss = data.data[0].value[0]\n-                   var ssl = ss.split(\"<br>\")\n+                   var ss = data.match(/(?<=<li>).*(?=<\\/li>)/g) // .data[0].value[0]\n+                   console.log(ss); // 输出调试而已\n+                   var ssl = ss[0].split(\"<br>\")\n                    for (var i=0; i<ssl.length-1; i++){\n                        var k = ssl[i].toLocaleLowerCase().split(\" \").join(\"\").split(\":\")\n                        var item = k[0]\n                        var detail = k[1]\n                        if (item == \"{referencetype}\"){\n                            if (detail == \"journalarticle\"){\n                                bibtext = \"@article{cite_label ,\\n\"\n                            }\n                            else if(detail == \"conferenceproceedings\"){\n                                bibtext = \"@inproceedings{cite_label ,\\n\"\n                            }\n                        }\n                        else if(item == \"{issue}\"){\n-                           bibtext = bibtext + \"   {number}={\" + detail + \"},\\n\"\n+                           bibtext = bibtext + \"   number={\" + detail + \"},\\n\" // 不明白这里的number为什么要括起来\n                        }\n                        else {\n                            bibtext = bibtext + \"   \" + item.substr(1, item.length-2) + \"={\" + detail + \"},\\n\"\n                        }\n                    }\n                    bibtext += \"}\"\n                    //console.log(bibtext)\n                    const copad = document.createElement('textarea')\n                    copad.value = bibtext\n                    document.body.appendChild(copad)\n                    copad.select()\n                    document.execCommand('Copy')\n                    document.body.removeChild(copad)\n                });\n            })\n        };\n    })\n})();\n```\n\n# 后记\n\n作者本人已顺利从天大毕业，相关校园网账号已封禁，因此无法再对此脚本进行测试与维护。欢迎天大大佬们继续改进与维护脚本。\n\n# 本文参考\n\n- [知网 BibTeX 自动生成（使用 BibTeX 引用中文参考文献）\\_奕小星的博客-CSDN 博客](https://blog.csdn.net/fegxig1230/article/details/118458288)\n- [JavaScript 字符串搜索 (w3school.com.cn)](https://www.w3school.com.cn/js/js_string_search.asp)\n- [正则表达式在线测试 | 菜鸟工具 (runoob.com)](https://c.runoob.com/front-end/854/)\n- [正则表达式 - JavaScript | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions#special-lookahead)\n- [使用 JS 获取当前页面的 URL(网址信息)\\_js 获取 url_Devere 的博客-CSDN 博客](https://blog.csdn.net/u013288800/article/details/82787641)\n","categories":[{"name":"工具箱","api":"api/categories/工具箱.json"}],"tags":[{"name":"BibTeX","api":"api/tags/BibTeX.json"},{"name":"知网","api":"api/tags/知网.json"},{"name":"Javascript","api":"api/tags/Javascript.json"},{"name":"Tampermonkey","api":"api/tags/Tampermonkey.json"},{"name":"Greasy Fork","api":"api/tags/Greasy-Fork.json"},{"name":"TJU","api":"api/tags/TJU.json"}]},"api":"api/posts/p/84ae21ea.json"}