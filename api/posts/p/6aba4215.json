{"data":{"title":"LogTrick æ–¹æ³•è§£å†³å­æ•°ç»„æœ€å€¼æˆ–è®¡æ•°é—®é¢˜","slug":"ç®—æ³•ä¸æ•°æ®ç»“æ„/LogTrick æ–¹æ³•è§£å†³å­æ•°ç»„æœ€å€¼æˆ–è®¡æ•°é—®é¢˜","description":"é™ä½å†…å±‚å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å®ç° Trick","date":"2025-01-25T19:30:08.000Z","updated":"2025-06-09T17:19:45.848Z","language":"zh-CN","comments":true,"url":"p/6aba4215/","cover":"https://cdn.gallery.uuanqin.top/img/202501232337583.webp","images":[],"content":"<p>Logtrick æ˜¯åœ¨æ—¶é—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> è®¡ç®—å­æ•°ç»„é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ |,&amp;,lcm,gcd ç­‰æ€§è´¨ä¼˜åŒ–çš„ä¸€ç§ç®—æ³•ã€‚ é€šå¸¸ç”¨äºæ±‚ <strong>å­æ•°ç»„</strong> ç»è¿‡ä¸€äº›æ“ä½œ (gcd,lcm,&amp;,|) åçš„ maxã€ min æˆ–è€…è®¡æ•°é—®é¢˜ã€‚</p>\n<p>æœ¬æ–‡å°†åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†è®²è§£ LogTrick çš„ç†è§£ï¼š</p>\n<ul>\n<li>å­æ•°ç»„ç»è¿‡ä¸€äº›æ“ä½œåçš„æœ€å€¼é—®é¢˜</li>\n<li>å­æ•°ç»„ç»è¿‡ä¸€äº›æ“ä½œåçš„è®¡æ•°é—®é¢˜</li>\n</ul>\n<p>æœ¬æ–‡é¢˜ç›®éš¾åº¦æ ‡è¯†ï¼šğŸŸ©ç®€å•ï¼ŒğŸŸ¨ä¸­ç­‰ï¼ŒğŸŸ¥å›°éš¾ã€‚</p>\n<h1 id=\"æœ€å€¼é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å€¼é—®é¢˜\"></a> æœ€å€¼é—®é¢˜</h1>\n<h2 id=\"or-è¿ç®—-æœ€å€¼é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#or-è¿ç®—-æœ€å€¼é—®é¢˜\"></a> OR è¿ç®— - æœ€å€¼é—®é¢˜</h2>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¥ <a href=\"https://leetcode.cn/problems/find-subarray-with-bitwise-or-closest-to-k/description/\">3171. æ‰¾åˆ°æŒ‰ä½æˆ–æœ€æ¥è¿‘ K çš„å­æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></div>\n</div>\n<div class=\"callout-content\"><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ã€‚ä½ éœ€è¦æ‰¾åˆ° nums çš„ä¸€ä¸ªå­æ•°ç»„ï¼Œæ»¡è¶³å­æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æŒ‰ä½æˆ–è¿ç®— OR çš„å€¼ä¸ k çš„ <strong>ç»å¯¹å·®</strong> å°½å¯èƒ½ å° ã€‚æ¢è¨€ä¹‹ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªå­æ•°ç»„ <code>nums[l..r]</code> æ»¡è¶³ <code>|k - (nums[l] OR nums[l + 1] ... OR nums[r])|</code> æœ€å°ã€‚</p>\n<p>è¯·ä½ è¿”å› <strong>æœ€å°</strong> çš„ç»å¯¹å·®å€¼ã€‚</p>\n<p><strong>å­æ•°ç»„</strong> æ˜¯æ•°ç»„ä¸­è¿ç»­çš„ <strong>éç©º</strong> å…ƒç´ åºåˆ—ã€‚</p>\n<p>é™åˆ¶ï¼š</p>\n<ul>\n<li><code>1 &lt;= nums.length &lt;= 10^5</code></li>\n<li><code>1 &lt;= nums[i] &lt;= 10^9</code></li>\n<li><code>1 &lt;= k &lt;= 10^9</code></li>\n</ul>\n</div></div><h3 id=\"ä»æš´åŠ›æ–¹æ³•å¼€å§‹è®²èµ·\"><a class=\"markdownIt-Anchor\" href=\"#ä»æš´åŠ›æ–¹æ³•å¼€å§‹è®²èµ·\"></a> ä»æš´åŠ›æ–¹æ³•å¼€å§‹è®²èµ·</h3>\n<p>æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¸€ä¸ª <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> çš„æš´åŠ›ç®—æ³•ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æš´åŠ›ç®—æ³•ï¼Œä¼šè¶…æ—¶</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">minimumDifference</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> k)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">            ans = Math.min(ans, Math.abs(x - k)); <span class=\"comment\">// å•ä¸ªå…ƒç´ ä¹Ÿç®—å­æ•°ç»„</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span>; j--) &#123;</span><br><span class=\"line\">                nums[j] |= x; <span class=\"comment\">// ç°åœ¨ nums[j] = åŸæ•°ç»„ nums[j] åˆ° nums[i] çš„ OR</span></span><br><span class=\"line\">                ans = Math.min(ans, Math.abs(nums[j] - k));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ–¹æ³•çš„è¦ç‚¹åœ¨äºæŠŠå­æ•°ç»„ç›¸æˆ–çš„ç»“æœå­˜å‚¨åœ¨ <code>nums</code> ä¸­ã€‚</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202501182235719.webp\" alt=\"image.png\" width=\"450px\" /></p>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<h3 id=\"trick\"><a class=\"markdownIt-Anchor\" href=\"#trick\"></a> Trick!</h3>\n<p>ä¸ºäº†å……åˆ†åˆ©ç”¨ OR çš„æ€§è´¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å†…å±‚å¾ªç¯è¿›è¡Œä¼˜åŒ–ã€‚</p>\n<p>å†…å±‚å¾ªç¯ <code>j</code> åœ¨é€’å‡æ—¶ï¼Œå¦‚æœ <code>x</code> å’Œå½“å‰ <code>nums[j]</code> ç›¸æˆ–ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œ <code>nums[j-1]</code>ã€<code>nums[j-2]</code> â€¦ <code>nums[0]</code> ç›¸æˆ–ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è·³å‡ºå¾ªç¯äº†ã€‚</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202501182238691.webp\" alt=\"image.png\" width=\"425px\" /></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">minimumDifference</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> k)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">            ans = Math.min(ans, Math.abs(x - k));</span><br><span class=\"line\">            <span class=\"comment\">// å˜åŒ–ç‚¹ï¼šå¢åŠ å¾ªç¯çš„çº¦æŸæ¡ä»¶</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span> &amp;&amp; (nums[j] | x) != nums[j]; j--) &#123;</span><br><span class=\"line\">                nums[j] |= x;</span><br><span class=\"line\">                ans = Math.min(ans, Math.abs(nums[j] - k));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å½“ <code>j</code> åœ¨é€’å‡æ—¶ï¼Œx èƒ½è®©å½“å‰ <code>nums[j]</code> çš„ä¸€äº›æ¯”ç‰¹ä½ä» 0 å˜ä¸º 1ï¼Œå¦‚æœä¸èƒ½å°±ä¼šé€€å‡ºå†…å±‚å¾ªç¯ã€‚x æœ€å¤§å€¼é™åˆ¶ä¸º <code>10^9</code>ï¼Œå³ x æœ€å¤šæœ‰ 29 ä¸ªæ¯”ç‰¹ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œx æœ€å¤šèƒ½è¿›è¡Œ 29 æ¬¡å†…éƒ¨å¾ªç¯ï¼ˆç¬¬äºŒé‡å¾ªç¯ï¼‰ã€‚å› æ­¤åœ¨æœ¬é¢˜ä¸­ï¼Œå†…éƒ¨å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å°†æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚</p>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ï¼Œå…¶ä¸­ n æ˜¯ nums çš„é•¿åº¦ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(nums)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<p>è¿™ç§æ–¹æ³•ä¹‹æ‰€ä»¥è¢«ç§°ä¸º LogTrick ï¼Œæ˜¯å› ä¸ºå®ƒå·§å¦™åœ°åˆ©ç”¨äº† OR è¿ç®—çš„æ€§è´¨ï¼Œå¹¶ä¸”å…¶æ—¶é—´å¤æ‚åº¦ä¸æ•°å­—çš„ä½æ•°ï¼ˆlogarithm of the numberï¼‰ç›¸å…³ã€‚</p>\n<blockquote>\n<p>ç›¸å…³é¢˜ç›®ï¼š</p>\n<ul>\n<li>ğŸŸ¨ <a href=\"https://leetcode.cn/problems/shortest-subarray-with-or-at-least-k-ii/description/\">3097. æˆ–å€¼è‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„ II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></li>\n<li>ğŸŸ¨ <a href=\"https://leetcode.cn/problems/smallest-subarrays-with-maximum-bitwise-or/description/\">2411. æŒ‰ä½æˆ–æœ€å¤§çš„æœ€å°å­æ•°ç»„é•¿åº¦ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a> éœ€è¦ç»´æŠ¤ç­”æ¡ˆæ•°ç»„</li>\n<li>ğŸŸ¨ <a href=\"https://leetcode.cn/problems/bitwise-ors-of-subarrays/description/\">898. å­æ•°ç»„æŒ‰ä½æˆ–æ“ä½œ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a> å˜ç§é¢˜ã€‚æŸç§ç¨‹åº¦ä¸Šå¯ä»¥ç†è§£ä¸ºæœ€å€¼é—®é¢˜ã€‚</li>\n</ul>\n</blockquote>\n<h2 id=\"and-è¿ç®—æœ€å€¼é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#and-è¿ç®—æœ€å€¼é—®é¢˜\"></a> AND è¿ç®—æœ€å€¼é—®é¢˜</h2>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¥ <a href=\"https://leetcode.cn/problems/find-a-value-of-a-mysterious-function-closest-to-target/\">1521. æ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡å€¼çš„å‡½æ•°å€¼ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></div>\n</div>\n<div class=\"callout-content\"><p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202501201654970.webp\" alt=\"image.png\" width=\"375px\" /><br />\nWinston æ„é€ äº†ä¸€ä¸ªå¦‚ä¸Šæ‰€ç¤ºçš„å‡½æ•° <code>func</code> ã€‚ä»–æœ‰ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>arr</code> å’Œä¸€ä¸ªæ•´æ•° <code>target</code> ï¼Œä»–æƒ³æ‰¾åˆ°è®© <code>|func(arr, l, r) - target|</code> æœ€å°çš„ <code>l</code> å’Œ <code>r</code> ã€‚</p>\n<p>è¯·ä½ è¿”å› <code>|func(arr, l, r) - target|</code> çš„æœ€å°å€¼ã€‚</p>\n<p>è¯·æ³¨æ„ï¼Œ <code>func</code> çš„è¾“å…¥å‚æ•° <code>l</code> å’Œ <code>r</code> éœ€è¦æ»¡è¶³ <code>0 &lt;= l, r &lt; arr.length</code> ã€‚</p>\n</div></div><p>å‚è€ƒç­”æ¡ˆï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">closestToTarget</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> target)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> arr.length;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">min</span> <span class=\"operator\">=</span> Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;len;i++)&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> arr[i];</span><br><span class=\"line\">            min = Math.min(Math.abs(x-target),min);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=i-<span class=\"number\">1</span>;j&gt;=<span class=\"number\">0</span>&amp;&amp;(arr[j]&amp;x)!=arr[j];j--)&#123;</span><br><span class=\"line\">                arr[j]&amp;=x;</span><br><span class=\"line\">                min = Math.min(Math.abs(arr[j]-target),min);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> min;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å†…å±‚å¾ªç¯ <code>j</code> åœ¨é€’å‡æ—¶ï¼Œå¦‚æœ <code>x</code> å’Œå½“å‰ <code>nums[j]</code> ç›¸ä¸ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜ <code>x</code> ä¸è¶³ä»¥è®©å½“å‰ä½ç½® <code>nums[j]</code> å˜å°ï¼Œå³ <code>x</code> ä»¥åŠä¸èƒ½å»æ‰ <code>nums[j]</code> è¡¨ç¤ºçš„é›†åˆä¸­çš„æ¯”ç‰¹ä½ 1ã€‚è€Œ <code>nums[j-1]</code>ã€<code>nums[j-2]</code> â€¦ <code>nums[0]</code> éƒ½å’Œ <code>nums[j]</code> ç›¸ä¸è¿‡ï¼Œèƒ½è¢«å»æ‰çš„æ¯”ç‰¹ä½ 1 æ—©å°±è¢« <code>nums[j]</code> æ‰€è¡¨ç¤ºçš„é›†åˆå»æ‰äº†ï¼Œå› æ­¤ <code>x</code> ä¸ <code>nums[j-1]</code>ã€<code>nums[j-2]</code> â€¦ <code>nums[0]</code> è¿›è¡Œä¸è¿ç®—ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ <code>arr</code> çš„é•¿åº¦ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mi>r</mi><mi>r</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(arr)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span></span></span></span>ã€‚ç”±äº <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>2</mn></msup><mn>9</mn><mtext>âˆ’</mtext><mn>1</mn><mo>&lt;</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>&lt;</mo><msup><mn>2</mn><mn>30</mn></msup><mtext>âˆ’</mtext><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^29 âˆ’1&lt;10^9 &lt;2^{30} âˆ’1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mord\">9</span><span class=\"mord\">âˆ’</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.853208em;vertical-align:-0.0391em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">0</span></span></span></span></span></span></span></span></span><span class=\"mord\">âˆ’</span><span class=\"mord\">1</span></span></span></span>ï¼ŒäºŒè¿›åˆ¶æ•°å¯¹åº”é›†åˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ 29ï¼Œå› æ­¤åœ¨ AND è¿ç®—ä¸‹ï¼Œæ¯ä¸ªæ•°å­—è‡³å¤šå¯ä»¥å‡å°‘ 29 æ¬¡ã€‚æ€»ä½“ä¸Šçœ‹ï¼ŒäºŒé‡å¾ªç¯çš„æ€»å¾ªç¯æ¬¡æ•°ç­‰äºæ¯ä¸ªæ•°å­—å¯ä»¥å‡å°‘çš„æ¬¡æ•°ä¹‹å’Œï¼Œå³ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<h1 id=\"è®¡æ•°é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#è®¡æ•°é—®é¢˜\"></a> è®¡æ•°é—®é¢˜</h1>\n<h2 id=\"and-è¿ç®—çš„è®¡æ•°é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#and-è¿ç®—çš„è®¡æ•°é—®é¢˜\"></a> AND è¿ç®—çš„è®¡æ•°é—®é¢˜</h2>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¥ <a href=\"https://leetcode.cn/problems/number-of-subarrays-with-and-value-of-k/description/\">3209. å­æ•°ç»„æŒ‰ä½ä¸å€¼ä¸º K çš„æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></div>\n</div>\n<div class=\"callout-content\"><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è¿”å› nums ä¸­æœ‰å¤šå°‘ä¸ª <strong>å­æ•°ç»„</strong> æ»¡è¶³ï¼šå­æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æŒ‰ä½ AND çš„ç»“æœä¸º k ã€‚</p>\n</div></div><h3 id=\"list-åŸåœ°å»é‡æ³•\"><a class=\"markdownIt-Anchor\" href=\"#list-åŸåœ°å»é‡æ³•\"></a> <code>List</code> + åŸåœ°å»é‡æ³•</h3>\n<p>åœ¨ä¸Šä¸€èŠ‚çš„ OR/AND è¿ç®—ä¸­ï¼Œæ±‚çš„æ˜¯ç­”æ¡ˆçš„æœ€å€¼ã€‚å†…å±‚å¾ªç¯é‡åˆ° <code>(nums[j] | x) == nums[j]</code> å°±å¯ä»¥æå‰ç»ˆæ­¢äº†ï¼Œä»è€Œè¾¾åˆ°é™ä½å†…å±‚æ—¶é—´å¤æ‚åº¦çš„æ•ˆæœã€‚è€Œæœ¬é¢˜ä¸­è¦æ±‚ç»Ÿè®¡å­æ•°ç»„è¿ç®—åä¸ç»™å®š k ç›¸ç­‰çš„ä¸ªæ•°ï¼Œå¦‚æœ <code>(nums[j] | x) == nums[j]</code> å°±è·³å‡ºå†…å±‚å¾ªç¯ï¼Œå½“ <code>k==nums[j]</code>ï¼Œç­”æ¡ˆ <code>ans</code> å°±ä¸èƒ½å¾—åˆ°æ­£ç¡®ç´¯è®¡ä»è€Œå‡ºç°é—æ¼çŠ¶å†µã€‚</p>\n<p>ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯å¦å¤–ç»´æŠ¤ä¸€ä¸ª <code>List</code>ï¼Œå­˜å‚¨<strong>å­æ•°ç»„è¿ç®—ç»“æœ</strong>ä»¥åŠ<strong>è¯¥ç»“æœå¯¹åº”çš„æ•°é‡</strong>ã€‚å¹¶ä¸”ä¸æ—¶å»é‡åˆå¹¶ï¼Œä»è€Œè¾¾åˆ°é™ä½æ—¶é—´å¤æ‚åº¦çš„æ•ˆæœã€‚</p>\n<blockquote>\n<p>æ•°ç»„åŸåœ°å»é‡è¯·å¤ä¹ æ­¤é¢˜ï¼šğŸŸ© <a href=\"https://leetcode.cn/problems/remove-duplicates-from-sorted-array/description/\">26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">countSubarrays</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> k)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">        List&lt;<span class=\"type\">int</span>[]&gt; ls = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();<span class=\"comment\">// ä½ä¸ç»“æœï¼Œå­æ•°ç»„çš„æ•°é‡</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;len;i++)&#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">            </span><br><span class=\"line\">            ls.add(<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;x,<span class=\"number\">1</span>&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;ls.size();j++)&#123;</span><br><span class=\"line\">                <span class=\"type\">int</span>[] e = ls.get(j);</span><br><span class=\"line\">                e[<span class=\"number\">0</span>]&amp;=x;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(e[<span class=\"number\">0</span>]==k)ans+=e[<span class=\"number\">1</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// åŸåœ°å»é‡åˆå¹¶</span></span><br><span class=\"line\">            <span class=\"type\">int</span> l=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;ls.size();j++)&#123;</span><br><span class=\"line\">                <span class=\"type\">int</span>[] e = ls.get(j);</span><br><span class=\"line\">                <span class=\"type\">int</span>[] last_e = ls.get(l);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(e[<span class=\"number\">0</span>]==last_e[<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">                    last_e[<span class=\"number\">1</span>] += e[<span class=\"number\">1</span>];</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                ls.set(l+<span class=\"number\">1</span>,e);</span><br><span class=\"line\">                l++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ls.subList(l+<span class=\"number\">1</span>,ls.size()).clear(); <span class=\"comment\">// ç»´æŒ O(log U)</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å†…éƒ¨å¾ªç¯ä¸­ï¼Œ<code>ls</code> å¤§å°ä¿æŒåœ¨ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(nums)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>ã€‚</p>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ï¼Œå…¶ä¸­Â <code>n</code>Â æ˜¯Â <code>nums</code>Â çš„é•¿åº¦ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(nums)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<p>è¿™ä¸ªæ–¹æ³•æ”¹å†™è‡ª <a href=\"https://leetcode.cn/problems/smallest-subarrays-with-maximum-bitwise-or/solutions/1830911/by-endlesscheng-zai1/\">@çµèŒ¶å±±è‰¾åºœ</a> çš„æ¨¡æ¿æ–¹æ³•ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘æŠŠåŸåœ°å»é‡çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ã€‚ä½ å¯ä»¥è¯•å›¾å°†åŒçº§çš„ä¸¤ä¸ªå†…éƒ¨å¾ªç¯åˆåœ¨ä¸€èµ·å†™ï¼Œå°±å¾—åˆ°çµç¥çš„æ¨¡æ¿ã€‚</p>\n<h3 id=\"äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•\"></a> äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•</h3>\n<p>æ³¨æ„åˆ°ï¼Œæ¯æ¬¡å¤–å±‚è¿­ä»£åï¼Œé›†åˆ <code>nums[j]</code> å€¼æ˜¯éé€’å‡çš„ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ <a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/817735b/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>äºŒåˆ†æŸ¥æ‰¾</a>ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">countSubarrays</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> k)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">long</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span> &amp;&amp; (nums[j] &amp; x) != nums[j]; j--) &#123;</span><br><span class=\"line\">\t\t\tnums[j] &amp;= x;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tans += lowerBound(nums, i, k + <span class=\"number\">1</span>) - lowerBound(nums, i, k);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ­¤äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•äº¤ç»™è¯»è€…å®ç°</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"title function_\">lowerBound</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> right, <span class=\"type\">int</span> target)</span>; </span><br></pre></td></tr></table></figure>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo>+</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U+n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>ï¼Œå…¶ä¸­ n æ˜¯ <code>nums</code> çš„é•¿åº¦ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(nums)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>ã€‚ç”±äºäºŒè¿›åˆ¶æ•°å¯¹åº”é›†åˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ 29ï¼Œå› æ­¤åœ¨ AND è¿ç®—ä¸‹ï¼Œæ¯ä¸ªæ•°å­—è‡³å¤šå¯ä»¥å‡å° 29 æ¬¡ã€‚æ€»ä½“ä¸Šçœ‹ï¼ˆé™¤å»äºŒåˆ†ï¼‰ï¼ŒäºŒé‡å¾ªç¯çš„æ€»å¾ªç¯æ¬¡æ•°ç­‰äºæ¯ä¸ªæ•°å­—å¯ä»¥å‡å°çš„æ¬¡æ•°ä¹‹å’Œï¼Œå³ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<h3 id=\"ä¸ªæ•°ç»´æŠ¤æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#ä¸ªæ•°ç»´æŠ¤æ–¹æ³•\"></a> ä¸ªæ•°ç»´æŠ¤æ–¹æ³•</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">countSubarrays</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> k)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">cnt</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">            cnt += x == k ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span> &amp;&amp; (nums[j] &amp; x) != nums[j]; j--) &#123;</span><br><span class=\"line\">                cnt -= nums[j] == k ? <span class=\"number\">1</span> : <span class=\"number\">0</span>; <span class=\"comment\">// å»é™¤ä¸Šä¸€è½®ç»Ÿè®¡æ—¶ç•™ä¸‹çš„æ ‡è®°</span></span><br><span class=\"line\">                nums[j] &amp;= x;</span><br><span class=\"line\">                cnt += nums[j] == k ? <span class=\"number\">1</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            ans += cnt;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»£ç ä¸­ï¼Œ<code>cnt</code> è¡¨ç¤ºå½“å±‚ <code>i</code> ä¸­ç¬¦åˆè¦æ±‚çš„ç­”æ¡ˆæ•°é‡ã€‚</p>\n<p>å¤æ‚åº¦åˆ†æï¼š</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>â¡</mo><mi>U</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log U)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mclose\">)</span></span></span></span>ï¼Œå…¶ä¸­Â <code>n</code>Â æ˜¯Â <code>nums</code>Â çš„é•¿åº¦ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>U</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">U=\\max(nums)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n<li>ç©ºé—´å¤æ‚åº¦ï¼š<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>ã€‚</li>\n</ul>\n<h2 id=\"gcd-æœ€å¤§å…¬çº¦æ•°çš„è®¡æ•°é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#gcd-æœ€å¤§å…¬çº¦æ•°çš„è®¡æ•°é—®é¢˜\"></a> GCD æœ€å¤§å…¬çº¦æ•°çš„è®¡æ•°é—®é¢˜</h2>\n\n<div class=\"callout\" data-callout=\"example\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list\"><line x1=\"8\" x2=\"21\" y1=\"6\" y2=\"6\"/><line x1=\"8\" x2=\"21\" y1=\"12\" y2=\"12\"/><line x1=\"8\" x2=\"21\" y1=\"18\" y2=\"18\"/><line x1=\"3\" x2=\"3.01\" y1=\"6\" y2=\"6\"/><line x1=\"3\" x2=\"3.01\" y1=\"12\" y2=\"12\"/><line x1=\"3\" x2=\"3.01\" y1=\"18\" y2=\"18\"/></svg>\n</div>\n<div class=\"callout-title-inner\">ğŸŸ¨ <a href=\"https://codeforces.com/problemset/problem/475/D\">Problem - 475D - CGCDSSQ - Codeforces</a></div>\n</div>\n<div class=\"callout-content\"><p></p>\n<p>Given a sequence of integers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1,â€‰...,â€‰a_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> and q queries <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>x</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_1,â€‰...,â€‰x_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> on it. For each query <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> you have to count the number of pairs (l,â€‰r) such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mi>l</mi><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mi>r</mi><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1â€‰â‰¤â€‰lâ€‰â‰¤â€‰râ€‰â‰¤â€‰n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord mathnormal\">n</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy=\"false\">(</mo><msub><mi>a</mi><mi>l</mi></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>a</mi><mrow><mi>l</mi><mtext>â€‰</mtext><mo>+</mo><mtext>â€‰</mtext><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>a</mi><mi>r</mi></msub><mo stretchy=\"false\">)</mo><mtext>â€‰</mtext><mo>=</mo><mtext>â€‰</mtext><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">gcd(a_l,â€‰a_{lâ€‰+â€‰1},â€‰...,â€‰a_r)â€‰=â€‰x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mtight\">â€‰</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">â€‰</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>.</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy=\"false\">(</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>v</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>v</mi><mi>n</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">gcd(v_1,â€‰v_2,â€‰...,â€‰v_n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> is a greatest common divisor of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>v</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>v</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_1,â€‰v_2,â€‰...,â€‰v_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, that is equal to a largest positive integer that divides all <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>.</p>\n<p><strong>Input</strong><br />\nThe first line of the input contains integer <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mi>n</mi><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">n, (1â€‰â‰¤â€‰nâ€‰â‰¤â€‰10^5)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>, denoting the length of the sequence. The next line contains n space separated integers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mtext>â€‰</mtext><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mtext>â€‰</mtext><msub><mi>a</mi><mi>n</mi></msub><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><msub><mi>a</mi><mi>i</mi></msub><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a_1,â€‰...,â€‰a_n, (1â€‰â‰¤â€‰a_iâ€‰â‰¤â€‰10^9)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p>The third line of the input contains integer <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mi>q</mi><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mn>3</mn><mtext>â€‰</mtext><mo>Ã—</mo><mtext>â€‰</mtext><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">q, (1â€‰â‰¤â€‰qâ€‰â‰¤â€‰3â€‰Ã—â€‰10^5)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">3</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>, denoting the number of queries. Then follows q lines, each contain an integer <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><msub><mi>x</mi><mi>i</mi></msub><mtext>â€‰</mtext><mo>â‰¤</mo><mtext>â€‰</mtext><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x_i, (1â€‰â‰¤â€‰x_iâ€‰â‰¤â€‰10^9)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7859700000000001em;vertical-align:-0.15em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">â€‰</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">â‰¤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">â€‰</span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p><strong>Output</strong><br />\nFor each query print the result in a separate line.</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202501201619045.webp\" alt=\"image.png\" /></p>\n</div></div><p>æ­¤é¢˜ä¸­ï¼ŒGCD çš„è¿ç®—æ€§è´¨å’Œä¸è¿ç®—ç±»ä¼¼ã€‚</p>\n<p>æ­¤é¢˜ä¸å‰é¢é¢˜ç›®ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šæœ‰ <code>q</code> ç»„è¯¢é—®ï¼›è€Œå‰é¢é¢˜ç›®åªæœ‰ 1 ç»„è¯¢é—®ï¼Œè¿™æ—¶å°±éœ€è¦ <code>Map</code> æ¥å­˜å‚¨ä¸åŒè¯¢é—®çš„ç­”æ¡ˆã€‚</p>\n<p>ä»¥ä¸‹æ˜¯è¾“å…¥è¾“å‡ºä»£ç ç»“æ„ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Scanner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">    \t<span class=\"type\">Scanner</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Scanner</span>(System.in);</span><br><span class=\"line\">    \t<span class=\"comment\">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class=\"line\">    \t<span class=\"type\">int</span> <span class=\"variable\">T</span> <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">    \t<span class=\"type\">int</span>[] nums = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[T];</span><br><span class=\"line\">    \t</span><br><span class=\"line\">    \t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;T;i++)&#123;</span><br><span class=\"line\">    \t    <span class=\"type\">int</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">    \t    nums[i] = e;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \tMap&lt;Integer,Long&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">    \tsolution(nums,map);</span><br><span class=\"line\">    \t<span class=\"type\">int</span> <span class=\"variable\">Q</span> <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">    \t<span class=\"keyword\">while</span> (Q--!=<span class=\"number\">0</span>) &#123; <span class=\"comment\">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class=\"line\">    \t\t<span class=\"type\">int</span> <span class=\"variable\">q</span> <span class=\"operator\">=</span> in.nextInt();</span><br><span class=\"line\">    \t\tSystem.out.println(map.getOrDefault(q,<span class=\"number\">0L</span>));</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solution</span><span class=\"params\">(<span class=\"type\">int</span>[] nums,Map&lt;Integer,Long&gt; map)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">gcd</span><span class=\"params\">(<span class=\"type\">int</span> a,<span class=\"type\">int</span> b)</span>&#123; <span class=\"comment\">// åŸç†æ˜¯è¾—è½¬ç›¸é™¤æ³•ï¼ˆè¿­ä»£ç‰ˆæœ¬ï¼‰</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span>(b!=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            a%=b;</span><br><span class=\"line\">            a^=b;</span><br><span class=\"line\">            b^=a;</span><br><span class=\"line\">            a^=b;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„æ˜¯å¡«å…… <code>solution</code> è¿™ä¸ªæ ¸å¿ƒä»£ç ã€‚</p>\n<h2 id=\"ä¸ªæ•°ç»´æŠ¤æ–¹æ³•-2\"><a class=\"markdownIt-Anchor\" href=\"#ä¸ªæ•°ç»´æŠ¤æ–¹æ³•-2\"></a> ä¸ªæ•°ç»´æŠ¤æ–¹æ³•</h2>\n<p>æ­¤é¢˜æ˜¯ä¸Šé¢æåˆ°çš„ ğŸŸ¥ <a href=\"https://leetcode.cn/problems/number-of-subarrays-with-and-value-of-k/description/\">3209. å­æ•°ç»„æŒ‰ä½ä¸å€¼ä¸º K çš„æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a> ä¸ªæ•°ç»´æŠ¤æ–¹æ³• Map ç‰ˆã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solution</span><span class=\"params\">(<span class=\"type\">int</span>[] nums,Map&lt;Integer,Long&gt; map)</span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">\tMap&lt;Integer,Long&gt; cntMap = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;len;i++)&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">\t\t<span class=\"comment\">// cnt+= x==k? 1:0;</span></span><br><span class=\"line\">\t\tcntMap.put(x,cntMap.getOrDefault(x,<span class=\"number\">0L</span>)+<span class=\"number\">1L</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=i-<span class=\"number\">1</span>;j&gt;=<span class=\"number\">0</span>&amp;&amp;gcd(nums[j],x)!=nums[j];j--)&#123;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tcntMap.put(nums[j],cntMap.getOrDefault(nums[j],<span class=\"number\">0L</span>)-<span class=\"number\">1L</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(cntMap.get(nums[j])==<span class=\"number\">0</span>)cntMap.remove(nums[j]); <span class=\"comment\">// è¿™æ˜¯å¿…è¦çš„ï¼Œå®ƒèƒ½é™ä½æ—¶é—´å¤æ‚åº¦ ç»´æŒ O(log U)</span></span><br><span class=\"line\">\t\t\tnums[j] = gcd(nums[j],x);</span><br><span class=\"line\">\t\t\tcntMap.put(nums[j],cntMap.getOrDefault(nums[j],<span class=\"number\">0L</span>)+<span class=\"number\">1L</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> k:cntMap.keySet())&#123;</span><br><span class=\"line\">\t\t\tmap.put(k,map.getOrDefault(k,<span class=\"number\">0L</span>)+cntMap.get(k));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"list-åŸåœ°å»é‡æ³•-2\"><a class=\"markdownIt-Anchor\" href=\"#list-åŸåœ°å»é‡æ³•-2\"></a> <code>List</code> + åŸåœ°å»é‡æ³•</h2>\n<p>è¿™é‡Œåªç»™å‡º <code>solution</code> æ–¹æ³•çš„å®ç°ï¼Œå°†æ­¤å‡½æ•°æ›¿æ¢ä¸Šä¸€èŠ‚ä»£ç ä¸­ç›¸åº”å‡½æ•°å³å¯ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">solution</span><span class=\"params\">(<span class=\"type\">int</span>[] nums,Map&lt;Integer,Long&gt; map)</span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">\tList&lt;<span class=\"type\">int</span>[]&gt; ls = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(); <span class=\"comment\">// gcd cnt</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;len;i++)&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> nums[i];</span><br><span class=\"line\">\t\t<span class=\"comment\">// cnt+= x==k? 1:0;</span></span><br><span class=\"line\">\t\tmap.put(x,map.getOrDefault(x,<span class=\"number\">0L</span>)+<span class=\"number\">1L</span>);</span><br><span class=\"line\">\t\tls.add(<span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[]&#123;x,<span class=\"number\">1</span>&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;ls.size()-<span class=\"number\">1</span>;j++)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">int</span>[] e = ls.get(j);</span><br><span class=\"line\">\t\t\t<span class=\"type\">int</span> <span class=\"variable\">newgcd</span> <span class=\"operator\">=</span> gcd(e[<span class=\"number\">0</span>],x);</span><br><span class=\"line\">\t\t\tmap.put(newgcd,map.getOrDefault(newgcd,<span class=\"number\">0L</span>)+Long.valueOf(e[<span class=\"number\">1</span>]));</span><br><span class=\"line\">\t\t\te[<span class=\"number\">0</span>] = newgcd;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// åŸåœ°å»é‡</span></span><br><span class=\"line\">\t\t<span class=\"type\">int</span> k=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">1</span>;j&lt;ls.size();j++)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(ls.get(j)[<span class=\"number\">0</span>]==ls.get(k)[<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// int[] e = ls.get(k);</span></span><br><span class=\"line\">\t\t\t\tls.get(k)[<span class=\"number\">1</span>]+= ls.get(j)[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tls.set(k+<span class=\"number\">1</span>,ls.get(j));</span><br><span class=\"line\">\t\t\tk++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tls.subList(k+<span class=\"number\">1</span>,ls.size()).clear();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ç›¸å…³é¢˜ç›®ï¼š</p>\n<ul>\n<li>ğŸŸ¥ <a href=\"https://codeforces.com/problemset/problem/1632/D\">Problem - 1632D - New Year Concert - Codeforces</a></li>\n<li>ğŸŸ¨ <a href=\"https://www.dotcpp.com/oj/problem2622.html\">è“æ¡¥æ¯2021å¹´ç¬¬åäºŒå±Šå›½èµ›çœŸé¢˜-å’Œä¸ä¹˜ç§¯ - Cè¯­è¨€ç½‘</a></li>\n</ul>\n</blockquote>\n<h1 id=\"åç»­è®¡åˆ’\"><a class=\"markdownIt-Anchor\" href=\"#åç»­è®¡åˆ’\"></a> åç»­è®¡åˆ’</h1>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> è¡¥å…… CF1632Dã€è“æ¡¥æ¯çœŸé¢˜ç›¸å…³é¢˜è§£</li>\n</ul>\n<h1 id=\"æœ¬æ–‡å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡å‚è€ƒ\"></a> æœ¬æ–‡å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://leetcode.cn/u/endlesscheng/\">@çµèŒ¶å±±è‰¾åºœ</a> çš„ç›¸å…³ <a href=\"https://leetcode.cn/circle/discuss/dHn9Vk/\">é¢˜å•</a> ä¸é¢˜è§£</li>\n<li><a href=\"https://www.cnblogs.com/bananawolf/p/18325334\">Logtrick - GsGXT - åšå®¢å›­</a></li>\n<li><a href=\"https://gdst.dev/posts/LC-3171/\">LeetCode ğŸ”´ 3171. Find Subarray With Bitwise OR Closest to K | åå…­å€‹å¤©äº®</a></li>\n</ul>\n","raw":"---\ntitle: LogTrick æ–¹æ³•è§£å†³å­æ•°ç»„æœ€å€¼æˆ–è®¡æ•°é—®é¢˜\ntags:\n  - LogTrick\n  - äºŒåˆ†æŸ¥æ‰¾\n  - Java\n  - LeetCode\ncover: 'https://cdn.gallery.uuanqin.top/img/202501232337583.webp'\ndescription: é™ä½å†…å±‚å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å®ç° Trick\ncategories:\n  - ç®—æ³•ä¸æ•°æ®ç»“æ„\nabbrlink: 6aba4215\nkatex: true\ndate: 2025-01-26 03:30:08\ntop_img:\n---\n\nLogtrick æ˜¯åœ¨æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ è®¡ç®—å­æ•°ç»„é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ |,&,lcm,gcd ç­‰æ€§è´¨ä¼˜åŒ–çš„ä¸€ç§ç®—æ³•ã€‚ é€šå¸¸ç”¨äºæ±‚ **å­æ•°ç»„** ç»è¿‡ä¸€äº›æ“ä½œ (gcd,lcm,&,|) åçš„ maxã€ min æˆ–è€…è®¡æ•°é—®é¢˜ã€‚\n\næœ¬æ–‡å°†åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†è®²è§£ LogTrick çš„ç†è§£ï¼š\n\n- å­æ•°ç»„ç»è¿‡ä¸€äº›æ“ä½œåçš„æœ€å€¼é—®é¢˜\n- å­æ•°ç»„ç»è¿‡ä¸€äº›æ“ä½œåçš„è®¡æ•°é—®é¢˜\n\næœ¬æ–‡é¢˜ç›®éš¾åº¦æ ‡è¯†ï¼šğŸŸ©ç®€å•ï¼ŒğŸŸ¨ä¸­ç­‰ï¼ŒğŸŸ¥å›°éš¾ã€‚\n\n# æœ€å€¼é—®é¢˜\n\n## OR è¿ç®— - æœ€å€¼é—®é¢˜\n\n> [!example] ğŸŸ¥ [3171. æ‰¾åˆ°æŒ‰ä½æˆ–æœ€æ¥è¿‘ K çš„å­æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/find-subarray-with-bitwise-or-closest-to-k/description/)\n> ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ã€‚ä½ éœ€è¦æ‰¾åˆ° nums çš„ä¸€ä¸ªå­æ•°ç»„ï¼Œæ»¡è¶³å­æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æŒ‰ä½æˆ–è¿ç®— OR çš„å€¼ä¸ k çš„ **ç»å¯¹å·®** å°½å¯èƒ½ å° ã€‚æ¢è¨€ä¹‹ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªå­æ•°ç»„ `nums[l..r]` æ»¡è¶³ `|k - (nums[l] OR nums[l + 1] ... OR nums[r])|` æœ€å°ã€‚\n>\n> è¯·ä½ è¿”å› **æœ€å°** çš„ç»å¯¹å·®å€¼ã€‚\n>\n> **å­æ•°ç»„** æ˜¯æ•°ç»„ä¸­è¿ç»­çš„ **éç©º** å…ƒç´ åºåˆ—ã€‚\n>\n> é™åˆ¶ï¼š\n> - `1 <= nums.length <= 10^5`\n> - `1 <= nums[i] <= 10^9`\n> - `1 <= k <= 10^9`\n\n### ä»æš´åŠ›æ–¹æ³•å¼€å§‹è®²èµ·\n\næˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä¸€ä¸ª $O(n^2)$ çš„æš´åŠ›ç®—æ³•ï¼š\n\n```java\n// æš´åŠ›ç®—æ³•ï¼Œä¼šè¶…æ—¶\nclass Solution {\n    public int minimumDifference(int[] nums, int k) {\n        int ans = Integer.MAX_VALUE;\n        for (int i = 0; i < nums.length; i++) {\n            int x = nums[i];\n            ans = Math.min(ans, Math.abs(x - k)); // å•ä¸ªå…ƒç´ ä¹Ÿç®—å­æ•°ç»„\n            for (int j = i - 1; j >= 0; j--) {\n                nums[j] |= x; // ç°åœ¨ nums[j] = åŸæ•°ç»„ nums[j] åˆ° nums[i] çš„ OR\n                ans = Math.min(ans, Math.abs(nums[j] - k));\n            }\n        }\n        return ans;\n    }\n}\n```\n\næ–¹æ³•çš„è¦ç‚¹åœ¨äºæŠŠå­æ•°ç»„ç›¸æˆ–çš„ç»“æœå­˜å‚¨åœ¨ `nums` ä¸­ã€‚\n\n![image.png|450](https://cdn.gallery.uuanqin.top/img/202501182235719.webp)\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š $O(n^2)$\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\n### Trick!\n\nä¸ºäº†å……åˆ†åˆ©ç”¨ OR çš„æ€§è´¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å†…å±‚å¾ªç¯è¿›è¡Œä¼˜åŒ–ã€‚\n\nå†…å±‚å¾ªç¯ `j` åœ¨é€’å‡æ—¶ï¼Œå¦‚æœ `x` å’Œå½“å‰ `nums[j]` ç›¸æˆ–ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œ `nums[j-1]`ã€`nums[j-2]` ...... `nums[0]` ç›¸æˆ–ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è·³å‡ºå¾ªç¯äº†ã€‚\n\n![image.png|425](https://cdn.gallery.uuanqin.top/img/202501182238691.webp)\n\n```java\nclass Solution {\n    public int minimumDifference(int[] nums, int k) {\n        int ans = Integer.MAX_VALUE;\n        for (int i = 0; i < nums.length; i++) {\n            int x = nums[i];\n            ans = Math.min(ans, Math.abs(x - k));\n            // å˜åŒ–ç‚¹ï¼šå¢åŠ å¾ªç¯çš„çº¦æŸæ¡ä»¶\n            for (int j = i - 1; j >= 0 && (nums[j] | x) != nums[j]; j--) {\n                nums[j] |= x;\n                ans = Math.min(ans, Math.abs(nums[j] - k));\n            }\n        }\n        return ans;\n    }\n}\n```\n\nå½“ `j` åœ¨é€’å‡æ—¶ï¼Œx èƒ½è®©å½“å‰ `nums[j]` çš„ä¸€äº›æ¯”ç‰¹ä½ä» 0 å˜ä¸º 1ï¼Œå¦‚æœä¸èƒ½å°±ä¼šé€€å‡ºå†…å±‚å¾ªç¯ã€‚x æœ€å¤§å€¼é™åˆ¶ä¸º `10^9`ï¼Œå³ x æœ€å¤šæœ‰ 29 ä¸ªæ¯”ç‰¹ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œx æœ€å¤šèƒ½è¿›è¡Œ 29 æ¬¡å†…éƒ¨å¾ªç¯ï¼ˆç¬¬äºŒé‡å¾ªç¯ï¼‰ã€‚å› æ­¤åœ¨æœ¬é¢˜ä¸­ï¼Œå†…éƒ¨å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å°†æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\\log U)$ï¼Œå…¶ä¸­ n æ˜¯ nums çš„é•¿åº¦ï¼Œ$U=\\max(nums)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\nè¿™ç§æ–¹æ³•ä¹‹æ‰€ä»¥è¢«ç§°ä¸º LogTrick ï¼Œæ˜¯å› ä¸ºå®ƒå·§å¦™åœ°åˆ©ç”¨äº† OR è¿ç®—çš„æ€§è´¨ï¼Œå¹¶ä¸”å…¶æ—¶é—´å¤æ‚åº¦ä¸æ•°å­—çš„ä½æ•°ï¼ˆlogarithm of the numberï¼‰ç›¸å…³ã€‚\n\n> ç›¸å…³é¢˜ç›®ï¼š\n> - ğŸŸ¨ [3097. æˆ–å€¼è‡³å°‘ä¸º K çš„æœ€çŸ­å­æ•°ç»„ II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/shortest-subarray-with-or-at-least-k-ii/description/)\n> - ğŸŸ¨ [2411. æŒ‰ä½æˆ–æœ€å¤§çš„æœ€å°å­æ•°ç»„é•¿åº¦ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/smallest-subarrays-with-maximum-bitwise-or/description/) éœ€è¦ç»´æŠ¤ç­”æ¡ˆæ•°ç»„\n> - ğŸŸ¨ [898. å­æ•°ç»„æŒ‰ä½æˆ–æ“ä½œ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/bitwise-ors-of-subarrays/description/) å˜ç§é¢˜ã€‚æŸç§ç¨‹åº¦ä¸Šå¯ä»¥ç†è§£ä¸ºæœ€å€¼é—®é¢˜ã€‚\n\n## AND è¿ç®—æœ€å€¼é—®é¢˜\n\n> [!example] ğŸŸ¥ [1521. æ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡å€¼çš„å‡½æ•°å€¼ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/find-a-value-of-a-mysterious-function-closest-to-target/)\n> ![image.png|375](https://cdn.gallery.uuanqin.top/img/202501201654970.webp)\nWinston æ„é€ äº†ä¸€ä¸ªå¦‚ä¸Šæ‰€ç¤ºçš„å‡½æ•° `func` ã€‚ä»–æœ‰ä¸€ä¸ªæ•´æ•°æ•°ç»„ `arr` å’Œä¸€ä¸ªæ•´æ•° `target` ï¼Œä»–æƒ³æ‰¾åˆ°è®© `|func(arr, l, r) - target|` æœ€å°çš„ `l` å’Œ `r` ã€‚\n>\n> è¯·ä½ è¿”å› `|func(arr, l, r) - target|` çš„æœ€å°å€¼ã€‚\n>\n> è¯·æ³¨æ„ï¼Œ `func` çš„è¾“å…¥å‚æ•° `l` å’Œ `r` éœ€è¦æ»¡è¶³ `0 <= l, r < arr.length` ã€‚\n\nå‚è€ƒç­”æ¡ˆï¼š\n\n```java\nclass Solution {\n    public int closestToTarget(int[] arr, int target) {\n        int len = arr.length;\n        int min = Integer.MAX_VALUE;\n        for(int i=0;i<len;i++){\n            int x = arr[i];\n            min = Math.min(Math.abs(x-target),min);\n            for(int j=i-1;j>=0&&(arr[j]&x)!=arr[j];j--){\n                arr[j]&=x;\n                min = Math.min(Math.abs(arr[j]-target),min);\n            }\n        }\n        return min;\n    }\n}\n```\n\nå†…å±‚å¾ªç¯ `j` åœ¨é€’å‡æ—¶ï¼Œå¦‚æœ `x` å’Œå½“å‰ `nums[j]` ç›¸ä¸ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œè¯´æ˜ `x` ä¸è¶³ä»¥è®©å½“å‰ä½ç½® `nums[j]` å˜å°ï¼Œå³ `x` ä»¥åŠä¸èƒ½å»æ‰ `nums[j]` è¡¨ç¤ºçš„é›†åˆä¸­çš„æ¯”ç‰¹ä½ 1ã€‚è€Œ `nums[j-1]`ã€`nums[j-2]` ...... `nums[0]` éƒ½å’Œ `nums[j]` ç›¸ä¸è¿‡ï¼Œèƒ½è¢«å»æ‰çš„æ¯”ç‰¹ä½ 1 æ—©å°±è¢« `nums[j]` æ‰€è¡¨ç¤ºçš„é›†åˆå»æ‰äº†ï¼Œå› æ­¤ `x` ä¸ `nums[j-1]`ã€`nums[j-2]` ...... `nums[0]` è¿›è¡Œä¸è¿ç®—ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\\log U)$ï¼Œå…¶ä¸­ `n` æ˜¯ `arr` çš„é•¿åº¦ï¼Œ$U=\\max(arr)$ã€‚ç”±äº $2^29 âˆ’1<10^9 <2^{30} âˆ’1$ï¼ŒäºŒè¿›åˆ¶æ•°å¯¹åº”é›†åˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ 29ï¼Œå› æ­¤åœ¨ AND è¿ç®—ä¸‹ï¼Œæ¯ä¸ªæ•°å­—è‡³å¤šå¯ä»¥å‡å°‘ 29 æ¬¡ã€‚æ€»ä½“ä¸Šçœ‹ï¼ŒäºŒé‡å¾ªç¯çš„æ€»å¾ªç¯æ¬¡æ•°ç­‰äºæ¯ä¸ªæ•°å­—å¯ä»¥å‡å°‘çš„æ¬¡æ•°ä¹‹å’Œï¼Œå³ $O(n\\log U)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\n# è®¡æ•°é—®é¢˜\n\n## AND è¿ç®—çš„è®¡æ•°é—®é¢˜\n\n> [!example] ğŸŸ¥ [3209. å­æ•°ç»„æŒ‰ä½ä¸å€¼ä¸º K çš„æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/number-of-subarrays-with-and-value-of-k/description/)\n> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è¿”å› nums ä¸­æœ‰å¤šå°‘ä¸ª **å­æ•°ç»„** æ»¡è¶³ï¼šå­æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æŒ‰ä½ AND çš„ç»“æœä¸º k ã€‚\n\n\n### `List` + åŸåœ°å»é‡æ³•\n\nåœ¨ä¸Šä¸€èŠ‚çš„ OR/AND è¿ç®—ä¸­ï¼Œæ±‚çš„æ˜¯ç­”æ¡ˆçš„æœ€å€¼ã€‚å†…å±‚å¾ªç¯é‡åˆ° `(nums[j] | x) == nums[j]` å°±å¯ä»¥æå‰ç»ˆæ­¢äº†ï¼Œä»è€Œè¾¾åˆ°é™ä½å†…å±‚æ—¶é—´å¤æ‚åº¦çš„æ•ˆæœã€‚è€Œæœ¬é¢˜ä¸­è¦æ±‚ç»Ÿè®¡å­æ•°ç»„è¿ç®—åä¸ç»™å®š k ç›¸ç­‰çš„ä¸ªæ•°ï¼Œå¦‚æœ `(nums[j] | x) == nums[j]` å°±è·³å‡ºå†…å±‚å¾ªç¯ï¼Œå½“ `k==nums[j]`ï¼Œç­”æ¡ˆ `ans` å°±ä¸èƒ½å¾—åˆ°æ­£ç¡®ç´¯è®¡ä»è€Œå‡ºç°é—æ¼çŠ¶å†µã€‚\n\nä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯å¦å¤–ç»´æŠ¤ä¸€ä¸ª `List`ï¼Œå­˜å‚¨**å­æ•°ç»„è¿ç®—ç»“æœ**ä»¥åŠ**è¯¥ç»“æœå¯¹åº”çš„æ•°é‡**ã€‚å¹¶ä¸”ä¸æ—¶å»é‡åˆå¹¶ï¼Œä»è€Œè¾¾åˆ°é™ä½æ—¶é—´å¤æ‚åº¦çš„æ•ˆæœã€‚\n\n> æ•°ç»„åŸåœ°å»é‡è¯·å¤ä¹ æ­¤é¢˜ï¼šğŸŸ© [26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/remove-duplicates-from-sorted-array/description/)\n\n```java\nclass Solution {\n    public long countSubarrays(int[] nums, int k) {\n        long ans = 0;\n        int len = nums.length;\n        List<int[]> ls = new ArrayList<>();// ä½ä¸ç»“æœï¼Œå­æ•°ç»„çš„æ•°é‡\n        for(int i=0;i<len;i++){\n            int x = nums[i];\n            \n            ls.add(new int[]{x,1});\n            for(int j=0;j<ls.size();j++){\n                int[] e = ls.get(j);\n                e[0]&=x;\n                if(e[0]==k)ans+=e[1];\n            }\n\n            // åŸåœ°å»é‡åˆå¹¶\n            int l=0;\n            for(int j=1;j<ls.size();j++){\n                int[] e = ls.get(j);\n                int[] last_e = ls.get(l);\n                if(e[0]==last_e[0]){\n                    last_e[1] += e[1];\n                    continue;\n                }\n                ls.set(l+1,e);\n                l++;\n            }\n            ls.subList(l+1,ls.size()).clear(); // ç»´æŒ O(log U)\n        }\n        return ans;\n    }\n}\n```\n\nå†…éƒ¨å¾ªç¯ä¸­ï¼Œ`ls` å¤§å°ä¿æŒåœ¨ $O(\\log U)$ï¼Œ$U=\\max(nums)$ã€‚\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\\log U)$ï¼Œå…¶ä¸­Â `n`Â æ˜¯Â `nums`Â çš„é•¿åº¦ï¼Œ$U=\\max(nums)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\nè¿™ä¸ªæ–¹æ³•æ”¹å†™è‡ª [@çµèŒ¶å±±è‰¾åºœ](https://leetcode.cn/problems/smallest-subarrays-with-maximum-bitwise-or/solutions/1830911/by-endlesscheng-zai1/) çš„æ¨¡æ¿æ–¹æ³•ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘æŠŠåŸåœ°å»é‡çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ã€‚ä½ å¯ä»¥è¯•å›¾å°†åŒçº§çš„ä¸¤ä¸ªå†…éƒ¨å¾ªç¯åˆåœ¨ä¸€èµ·å†™ï¼Œå°±å¾—åˆ°çµç¥çš„æ¨¡æ¿ã€‚\n\n### äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•\n\næ³¨æ„åˆ°ï¼Œæ¯æ¬¡å¤–å±‚è¿­ä»£åï¼Œé›†åˆ `nums[j]` å€¼æ˜¯éé€’å‡çš„ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ [[ä¸ºä»€ä¹ˆäºŒåˆ†æŸ¥æ‰¾æ€»æ˜¯å†™ä¸å¯¹ï¼Ÿ|äºŒåˆ†æŸ¥æ‰¾]]ã€‚\n\n```java\npublic long countSubarrays(int[] nums, int k) {\n\tlong ans = 0;\n\tfor (int i = 0; i < nums.length; i++) {\n\t\tint x = nums[i];\n\t\tfor (int j = i - 1; j >= 0 && (nums[j] & x) != nums[j]; j--) {\n\t\t\tnums[j] &= x;\n\t\t}\n\t\tans += lowerBound(nums, i, k + 1) - lowerBound(nums, i, k);\n\t}\n\treturn ans;\n}\n\n// æ­¤äºŒåˆ†æŸ¥æ‰¾æ–¹æ³•äº¤ç»™è¯»è€…å®ç°\nprivate int lowerBound(int[] nums, int right, int target); \n```\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\\log U+n\\log n)$ï¼Œå…¶ä¸­ n æ˜¯ `nums` çš„é•¿åº¦ï¼Œ$U=\\max(nums)$ã€‚ç”±äºäºŒè¿›åˆ¶æ•°å¯¹åº”é›†åˆçš„å¤§å°ä¸ä¼šè¶…è¿‡ 29ï¼Œå› æ­¤åœ¨ AND è¿ç®—ä¸‹ï¼Œæ¯ä¸ªæ•°å­—è‡³å¤šå¯ä»¥å‡å° 29 æ¬¡ã€‚æ€»ä½“ä¸Šçœ‹ï¼ˆé™¤å»äºŒåˆ†ï¼‰ï¼ŒäºŒé‡å¾ªç¯çš„æ€»å¾ªç¯æ¬¡æ•°ç­‰äºæ¯ä¸ªæ•°å­—å¯ä»¥å‡å°çš„æ¬¡æ•°ä¹‹å’Œï¼Œå³ $O(n\\log U)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\n### ä¸ªæ•°ç»´æŠ¤æ–¹æ³•\n\n```java\nclass Solution {\n    public long countSubarrays(int[] nums, int k) {\n        long ans = 0;\n        int cnt = 0;\n        for (int i = 0; i < nums.length; i++) {\n            int x = nums[i];\n            cnt += x == k ? 1 : 0;\n            for (int j = i - 1; j >= 0 && (nums[j] & x) != nums[j]; j--) {\n                cnt -= nums[j] == k ? 1 : 0; // å»é™¤ä¸Šä¸€è½®ç»Ÿè®¡æ—¶ç•™ä¸‹çš„æ ‡è®°\n                nums[j] &= x;\n                cnt += nums[j] == k ? 1 : 0;\n            }\n            ans += cnt;\n        }\n        return ans;\n    }\n}\n```\n\nä»£ç ä¸­ï¼Œ`cnt` è¡¨ç¤ºå½“å±‚ `i` ä¸­ç¬¦åˆè¦æ±‚çš„ç­”æ¡ˆæ•°é‡ã€‚\n\nå¤æ‚åº¦åˆ†æï¼š\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n\\log U)$ï¼Œå…¶ä¸­Â `n`Â æ˜¯Â `nums`Â çš„é•¿åº¦ï¼Œ$U=\\max(nums)$ã€‚\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚\n\n## GCD æœ€å¤§å…¬çº¦æ•°çš„è®¡æ•°é—®é¢˜\n\n> [!example] ğŸŸ¨ [Problem - 475D - CGCDSSQ - Codeforces](https://codeforces.com/problemset/problem/475/D)\n>\n> Given a sequence of integers $a_1,â€‰...,â€‰a_n$ and q queries $x_1,â€‰...,â€‰x_q$ on it. For each query $x_i$ you have to count the number of pairs (l,â€‰r) such that $1â€‰â‰¤â€‰lâ€‰â‰¤â€‰râ€‰â‰¤â€‰n$ and $gcd(a_l,â€‰a_{lâ€‰+â€‰1},â€‰...,â€‰a_r)â€‰=â€‰x_i$.\n>\n> $gcd(v_1,â€‰v_2,â€‰...,â€‰v_n)$ is a greatest common divisor of $v_1,â€‰v_2,â€‰...,â€‰v_n$, that is equal to a largest positive integer that divides all $v_i$.\n>\n> **Input**\n> The first line of the input contains integer $n, (1â€‰â‰¤â€‰nâ€‰â‰¤â€‰10^5)$, denoting the length of the sequence. The next line contains n space separated integers $a_1,â€‰...,â€‰a_n, (1â€‰â‰¤â€‰a_iâ€‰â‰¤â€‰10^9)$.\n>\n> The third line of the input contains integer $q, (1â€‰â‰¤â€‰qâ€‰â‰¤â€‰3â€‰Ã—â€‰10^5)$, denoting the number of queries. Then follows q lines, each contain an integer $x_i, (1â€‰â‰¤â€‰x_iâ€‰â‰¤â€‰10^9)$.\n>\n> **Output**\n> For each query print the result in a separate line.\n>\n> ![image.png](https://cdn.gallery.uuanqin.top/img/202501201619045.webp)\n\næ­¤é¢˜ä¸­ï¼ŒGCD çš„è¿ç®—æ€§è´¨å’Œä¸è¿ç®—ç±»ä¼¼ã€‚\n\næ­¤é¢˜ä¸å‰é¢é¢˜ç›®ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šæœ‰ `q` ç»„è¯¢é—®ï¼›è€Œå‰é¢é¢˜ç›®åªæœ‰ 1 ç»„è¯¢é—®ï¼Œè¿™æ—¶å°±éœ€è¦ `Map` æ¥å­˜å‚¨ä¸åŒè¯¢é—®çš„ç­”æ¡ˆã€‚\n\nä»¥ä¸‹æ˜¯è¾“å…¥è¾“å‡ºä»£ç ç»“æ„ï¼š\n\n```java\nimport java.util.Scanner;\nimport java.util.Arrays;\nimport java.util.Map;\nimport java.util.HashMap;\n \npublic class Main{\n    \n    public static void main(String[] args) {\n    \tScanner in = new Scanner(System.in);\n    \t// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«\n    \tint T = in.nextInt();\n    \tint[] nums = new int[T];\n    \t\n    \tfor(int i=0;i<T;i++){\n    \t    int e = in.nextInt();\n    \t    nums[i] = e;\n    \t}\n    \tMap<Integer,Long> map = new HashMap<>();\n    \tsolution(nums,map);\n    \tint Q = in.nextInt();\n    \twhile (Q--!=0) { // æ³¨æ„ while å¤„ç†å¤šä¸ª case\n    \t\tint q = in.nextInt();\n    \t\tSystem.out.println(map.getOrDefault(q,0L));\n    \t}\n    }\n    \n    public static void solution(int[] nums,Map<Integer,Long> map){\n        // ...\n    }\n    \n    public static int gcd(int a,int b){ // åŸç†æ˜¯è¾—è½¬ç›¸é™¤æ³•ï¼ˆè¿­ä»£ç‰ˆæœ¬ï¼‰\n        while(b!=0){\n            a%=b;\n            a^=b;\n            b^=a;\n            a^=b;\n        }\n        return a;\n    }\n}\n```\n\næˆ‘ä»¬æ‰€éœ€è¦åšçš„æ˜¯å¡«å…… `solution` è¿™ä¸ªæ ¸å¿ƒä»£ç ã€‚\n\n## ä¸ªæ•°ç»´æŠ¤æ–¹æ³•\n\næ­¤é¢˜æ˜¯ä¸Šé¢æåˆ°çš„ ğŸŸ¥ [3209. å­æ•°ç»„æŒ‰ä½ä¸å€¼ä¸º K çš„æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/number-of-subarrays-with-and-value-of-k/description/) ä¸ªæ•°ç»´æŠ¤æ–¹æ³• Map ç‰ˆã€‚\n\n```java\npublic static void solution(int[] nums,Map<Integer,Long> map){\n\tint len = nums.length;\n\tMap<Integer,Long> cntMap = new HashMap<>();\n\tfor(int i=0;i<len;i++){\n\t\t\n\t\tint x = nums[i];\n\t\t// cnt+= x==k? 1:0;\n\t\tcntMap.put(x,cntMap.getOrDefault(x,0L)+1L);\n\t\tfor(int j=i-1;j>=0&&gcd(nums[j],x)!=nums[j];j--){\n\t\t\t\n\t\t\tcntMap.put(nums[j],cntMap.getOrDefault(nums[j],0L)-1L);\n\t\t\tif(cntMap.get(nums[j])==0)cntMap.remove(nums[j]); // è¿™æ˜¯å¿…è¦çš„ï¼Œå®ƒèƒ½é™ä½æ—¶é—´å¤æ‚åº¦ ç»´æŒ O(log U)\n\t\t\tnums[j] = gcd(nums[j],x);\n\t\t\tcntMap.put(nums[j],cntMap.getOrDefault(nums[j],0L)+1L);\n\n\t\t}\n\t\tfor(int k:cntMap.keySet()){\n\t\t\tmap.put(k,map.getOrDefault(k,0L)+cntMap.get(k));\n\t\t}\n\t}\n}\n```\n\n## `List` + åŸåœ°å»é‡æ³•\n\nè¿™é‡Œåªç»™å‡º `solution` æ–¹æ³•çš„å®ç°ï¼Œå°†æ­¤å‡½æ•°æ›¿æ¢ä¸Šä¸€èŠ‚ä»£ç ä¸­ç›¸åº”å‡½æ•°å³å¯ã€‚\n\n```java\npublic static void solution(int[] nums,Map<Integer,Long> map){\n\tint len = nums.length;\n\tList<int[]> ls = new ArrayList<>(); // gcd cnt\n\tfor(int i=0;i<len;i++){\n\t\t\n\t\tint x = nums[i];\n\t\t// cnt+= x==k? 1:0;\n\t\tmap.put(x,map.getOrDefault(x,0L)+1L);\n\t\tls.add(new int[]{x,1});\n\n\t\tfor(int j=0;j<ls.size()-1;j++){\n\t\t\tint[] e = ls.get(j);\n\t\t\tint newgcd = gcd(e[0],x);\n\t\t\tmap.put(newgcd,map.getOrDefault(newgcd,0L)+Long.valueOf(e[1]));\n\t\t\te[0] = newgcd;\n\t\t}\n\t\t// åŸåœ°å»é‡\n\t\tint k=0;\n\t\tfor(int j=1;j<ls.size();j++){\n\t\t\tif(ls.get(j)[0]==ls.get(k)[0]){\n\t\t\t\t// int[] e = ls.get(k);\n\t\t\t\tls.get(k)[1]+= ls.get(j)[1];\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tls.set(k+1,ls.get(j));\n\t\t\tk++;\n\t\t}\n\t\tls.subList(k+1,ls.size()).clear();\n\t}\n}\n```\n\n> ç›¸å…³é¢˜ç›®ï¼š\n> - ğŸŸ¥ [Problem - 1632D - New Year Concert - Codeforces](https://codeforces.com/problemset/problem/1632/D)\n> - ğŸŸ¨ [è“æ¡¥æ¯2021å¹´ç¬¬åäºŒå±Šå›½èµ›çœŸé¢˜-å’Œä¸ä¹˜ç§¯ - Cè¯­è¨€ç½‘](https://www.dotcpp.com/oj/problem2622.html)\n\n# åç»­è®¡åˆ’\n\n- [ ] è¡¥å…… CF1632Dã€è“æ¡¥æ¯çœŸé¢˜ç›¸å…³é¢˜è§£\n\n# æœ¬æ–‡å‚è€ƒ\n- [@çµèŒ¶å±±è‰¾åºœ](https://leetcode.cn/u/endlesscheng/) çš„ç›¸å…³ [é¢˜å•](https://leetcode.cn/circle/discuss/dHn9Vk/) ä¸é¢˜è§£\n- [Logtrick - GsGXT - åšå®¢å›­](https://www.cnblogs.com/bananawolf/p/18325334)\n- [LeetCode ğŸ”´ 3171. Find Subarray With Bitwise OR Closest to K | åå…­å€‹å¤©äº®](https://gdst.dev/posts/LC-3171/)\n","categories":[{"name":"ç®—æ³•ä¸æ•°æ®ç»“æ„","api":"api/categories/ç®—æ³•ä¸æ•°æ®ç»“æ„.json"}],"tags":[{"name":"Java","api":"api/tags/Java.json"},{"name":"äºŒåˆ†æŸ¥æ‰¾","api":"api/tags/äºŒåˆ†æŸ¥æ‰¾.json"},{"name":"LeetCode","api":"api/tags/LeetCode.json"},{"name":"LogTrick","api":"api/tags/LogTrick.json"}]},"api":"api/posts/p/6aba4215.json"}