{"title":"将不蒜子中的数据迁移到 Waline","categories":["博客站点维护","Waline"],"abbrlink":"e400f664","tags":["不蒜子","busuanzi","Waline","SQL","MySQL","Python"],"cover":"https://cdn.gallery.uuanqin.top/img/202411230428848.webp","description":"写了个脚本，页面统计数据掌控在自己的手中","date":"2024-11-23T02:55:57.000Z","top_img":null,"summary":"折腾重定向之后（详见 [[域名 DNS 服务托管至 Cloudflare 以及 301 重定向的配置|这篇文章]]），一个以前没考虑到的小问题来了——不蒜子页面的统计量清零了。 虽然不是什么大问题，但是感觉有点可惜啊。而且通过页面浏览量还能分析哪些文章比较多人看，可以把维护精力放到一些不是很水的文章上面（我猜蜀黍也容易在那出没）。这种情况应该很多博主都遇到，于是赶紧友链朋友圈搜搜大家都是怎么做的： 方法一：自建不蒜子服务，并通过其他项目将不蒜子数据迁移到自建服务上。但是看起来好麻烦啊喂😮，不是很想再维护多一个系统。 方法二：选用其他的统计服务。但是我的目的是想知道 busuanzi 中原来记录有的数据。 方法三：使用 Waline 评论系统带有页面浏览量统计，Butterfly 主题支持切换。结果打开配置文件一看，我早就把 Waline 的这个功能关闭了，统计还是得从头算起。 最后我的方案是： 决定把统计数据交给 Waline，「内聚」一下，少一点系统的维护。而且数据存在于服务器 MySQL 里，个人容易掌控。 我需要工具或脚本获取 busuanzi 服务器中原有的数据，导出成文件以便整理 根据导出的数据生成 SQL 方便在 Waline 中更新 于是，一个 Python 命令行程序诞生了： [](https://github.com/uuanqin/busuanzi2waline) GitHub 项目地址：uuanqin/busuanzi2waline: 将不蒜子的页面浏览量导出为 json 格式的文件，并生成SQL语句以更新Waline数据库 自我吐槽：写脚本花的时间也很多好吧！ 这篇文章主要分享解决思路，具体操作详看该项目的 README 说明。 获取不算子中的统计数据 不蒜子并没有提供现成的 API 直接获取数据。参考了一些文章，他们的方式是向不蒜子的服务器发送一个 HTTP 请求，请求头 `Referer` 参数设置为目标网址。比如使用 `curl` 命令如下： 然后返回以下字符串： `page_pv` 就是我们想要的数据，可以用一个正则提取出 JSON 就行。 拿到所有的网址 直接处理网站地图就行。因为安装有插件 hexo-generator-sitemap，网址地图 `sitemap.txt` 就躺在根目录下，我们只需要简单处理即可。..."}