{"data":{"title":"æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite","slug":"åšå®¢ç«™ç‚¹ç»´æŠ¤/Hexo/æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite","description":"è‡ªå·±å°è¯•åŠ¨æ‰‹å®ç°ä¸€ä¸ª AI æ‘˜è¦","date":"2025-06-24T15:19:05.000Z","updated":"2025-11-04T14:33:21.867Z","language":"zh-CN","comments":true,"url":"p/75efe9f3/","cover":"https://cdn.gallery.uuanqin.top/img/202506242301616.webp","images":[],"content":"<p>å‰æ®µæ—¶é—´çœ‹åˆ° <a href=\"https://blog.liushen.fun/\">@LiuShen</a> å‘è¡¨äº†ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œæˆ‘ä¸ç¦æ„Ÿæ…¨ï¼šç»§å¯¹å‹é“¾æœ‹å‹åœˆæ”¹è¿›åï¼ŒæŸ³ç¥ç»ˆäºç›¯ä¸Š AI æ‘˜è¦çš„æ”¹è¿›äº†ï¼åœ¨ @Liushen æ–‡ç« ä¸­æåˆ°äº† <a href=\"https://www.konoxin.top/\">@konoXIN</a> é€šè¿‡ Vercel å‡½æ•°è°ƒç”¨å¤§æ¨¡å‹çš„æ–¹æ³•ï¼Œå¯¹æ­¤æˆ‘ä¹Ÿå—åˆ°å¯å‘ï¼Œæ‰“ç®—åŠ¨æ‰‹å°è¯•è‡ªå·±çš„ AI æ‘˜è¦è§£å†³æ–¹æ¡ˆã€‚</p>\n<p>ç›®å‰ï¼Œé™æ€åšå®¢ AI æ‘˜è¦å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>AI æ‘˜è¦ç”Ÿæˆæ–¹å¼</th>\n<th>ä½œè€…éƒ¨ç½²é€Ÿåº¦</th>\n<th>è¯»è€…è·å–æ‘˜è¦é€Ÿåº¦</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£</td>\n<td>ğŸŸ¢å¿«</td>\n<td>ğŸ”´æ…¢ï¼Œä½†å¯ä¼˜åŒ–</td>\n<td>ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£å›ºç„¶å¾ˆæ…¢ï¼Œä½†é€šè¿‡å¼•å…¥å¤šçº§ç¼“å­˜ï¼Œæ‘˜è¦è·å–æ—¶é—´å¯å¤§å¤§ç¼©çŸ­ï¼Œè¿˜èƒ½èŠ‚çº¦æˆæœ¬ã€‚</td>\n</tr>\n<tr>\n<td>æœ¬åœ°é¢„æ„å»ºæ‘˜è¦</td>\n<td>ğŸ”´æ…¢</td>\n<td>ğŸŸ¢å¿«</td>\n<td>æœ¬åœ°é¢„æ„å»ºï¼Œç›¸å½“äºæŠŠè¯»è€…çš„è®¿é—®æ—¶é—´è½¬ç§»åˆ°ä½œè€…é¢„æ„å»ºçš„åšå®¢æ—¶é—´ã€‚è¿™ç§æ— åç«¯çš„é…ç½®æ–¹å¼çµæ´»å¯è°ƒã€‚</td>\n</tr>\n<tr>\n<td>ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡</td>\n<td colspan=\"2\">ğŸŸ¡å–å†³äºæœåŠ¡</td>\n<td>ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡å¯èƒ½ä¼šæ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œä½†æ˜¯èƒ½èŠ‚çœå¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›æˆæœ¬ã€‚</td>\n</tr>\n</tbody>\n</table>\n<p>ç›®å‰ï¼Œåšå®¢åœˆé‡Œæˆ‘äº†è§£åˆ°çš„ä¸Šé¢æ–¹æ¡ˆå¯¹åº”çš„å®ç°ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ¡ˆ</th>\n<th>ä½œè€…</th>\n<th>å‰ç«¯</th>\n<th>åç«¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://blog.zhheo.com/p/ec57d8b2.html\">TianliGPT</a></td>\n<td><a href=\"https://tianli-blog.club/\">@Tianli</a></td>\n<td>å¼•å…¥ js æ–‡ä»¶/æ’ä»¶</td>\n<td>ç¬¬ä¸‰æ–¹åç«¯ç®¡ç†</td>\n</tr>\n<tr>\n<td>æ’ä»¶ <a href=\"https://blog.liushen.fun/posts/40702a0d/\">hexo-ai-summary</a></td>\n<td><a href=\"https://blog.liushen.fun/\">@LiuShen</a></td>\n<td>æ’ä»¶ + ä¿®æ”¹ä¸»é¢˜æºç </td>\n<td>æ— ï¼ˆæœ¬åœ°æå‰ç”Ÿæˆå¥½æ‘˜è¦ï¼‰</td>\n</tr>\n<tr>\n<td>è‡ªå®šä¹‰ <a href=\"https://www.konoxin.top/posts/db7b3418/\">Vercel ä»£ç†æ–¹æ¡ˆ</a></td>\n<td><a href=\"https://www.konoxin.top/\">@konoXIN</a></td>\n<td>å¼•å…¥ js æ–‡ä»¶</td>\n<td>Vercel æ¥å£è½¬å‘</td>\n</tr>\n</tbody>\n</table>\n<p>TianliGPT æ–¹æ¡ˆæ˜¯æœ¬ç«™æœ€åˆé€‰æ‹©çš„æ–¹æ¡ˆï¼Œæœ‰ä¸“é—¨çš„åç«¯ç®¡ç†ï¼Œå†…å®¹åˆè§„ã€æ¨¡å‹é€‰æ‹©å•¥çš„åŸºæœ¬ä¸ç”¨æ“å¿ƒã€‚ç°åœ¨çš„ TianliGPT åœ¨å¤šæ¬¾ä¸»é¢˜ä¸‹ä¹Ÿå¼€å‘æœ‰å¤šæ¬¾æ’ä»¶ï¼Œå‰ç«¯éƒ¨ç½²ä¸æ˜¯é—®é¢˜ã€‚è¦æƒ³çœå¿ƒçœåŠ›ï¼Œé€‰æ‹© TianliGPT å°±è¡Œã€‚</p>\n<p>hexo-ai-summary æ˜¯å¤§ä½¬ @Liushen æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ¬¾æ–¹æ¡ˆé€šè¿‡æå‰ç”Ÿæˆåšå®¢æ‘˜è¦åµŒå…¥åˆ°æ¯ç¯‡æ–‡ç« ä¸­ï¼Œè¯»è€…è®¿é—®æ–‡ç« å°±èƒ½è®¿é—®æ‘˜è¦ï¼Œæ²¡æœ‰é¢å¤–è¯·æ±‚æ—¶å»¶ä¸”ä¸ç”¨æ‹…å¿ƒå¦å¤–çš„ç³»ç»Ÿæ•…éšœï¼Œæ­¤å¤–å¯ä»¥çµæ´»æ›¿æ¢ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹ã€‚æ­¤æ–¹æ¡ˆæ˜¯é€Ÿåº¦ä¸çµæ´»æ€§åŒé‡å…¼é¡¾æ–¹æ¡ˆï¼Œè¦æƒ³è¯»è€…ä»¥æœ€å¿«çš„é€Ÿåº¦è·å–æ–‡ç« æ‘˜è¦ï¼Œé€‰æ‹© hexo-ai-summary å‡†æ²¡é”™ã€‚</p>\n<p>@konoXIN ä¹Ÿå®ç°äº†è‡ªå·±çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼Œç”¨æˆ·è®¿é—®æ–‡ç« æ—¶æºå¸¦æ–‡ç« å†…å®¹å‘é€è‡³ Vercelï¼ŒVercel å……å½“ä»£ç†è°ƒç”¨ LLM æ¥å£ï¼Œå¹¶å°†æœ€ç»ˆçš„æ‘˜è¦æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹æ¡ˆæœ´ç´ ã€ç»“æ„ç›´è§‚ä¸”æœ‰æ•ˆï¼Œç»™æƒ³åŠ¨ (zhe) æ‰‹ (teng) çš„äººæ›´å¤§çš„å‘æŒ¥ç©ºé—´ã€‚</p>\n<p>æœ¬æ–‡ä¸»è¦å‚è€ƒçš„æ˜¯ @konoXIN çš„æ–‡ç« ï¼Œå¹¶åœ¨åŸæ–¹æ¡ˆçš„åŸºç¡€ä¸Šä½œå‡ºäº†æ”¹è¿›ã€‚ä½†æ€»çš„æ¥è¯´ä¸ä¼šæœ‰å‰é¢çš„æ–¹æ¡ˆé‚£ä¹ˆå®Œç¾ï¼Œåªèƒ½è¯´æ˜¯ä¸ªäººè¯•éªŒçš„å°ä½œå“ã€‚å½“ç„¶ä¹Ÿå¸Œæœ›å„ä½è¯»è€…åˆ†äº«ä½ ä»¬çš„æ–¹æ¡ˆä¸å»ºè®®ï¼ŒæœŸå¾…å’Œå„ä½å¤§ä½¬æ¢è®¨äº¤æµ ~</p>\n<h1 id=\"æˆ‘çš„æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#æˆ‘çš„æ–¹æ¡ˆ\"></a> æˆ‘çš„æ–¹æ¡ˆ</h1>\n<h2 id=\"æ¦‚è¿°\"><a class=\"markdownIt-Anchor\" href=\"#æ¦‚è¿°\"></a> æ¦‚è¿°</h2>\n<p>ç›¸è¾ƒäº <a href=\"https://www.konoxin.top/posts/db7b3418/\">konoXIN çš„æ–¹æ¡ˆ</a>ï¼Œæœ¬æ–¹æ¡ˆæ”¹è¿›ç‚¹å’Œå¯ä¼˜åŒ–ç‚¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>\n<table>\n<thead>\n<tr>\n<th>æ”¹è¿›ç‚¹</th>\n<th>å¯ä¼˜åŒ–ç‚¹ï¼ˆç¼ºç‚¹â€¦ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ ·å¼è°ƒæ•´ï¼š<br>âœ…æ ·å¼æ–‡ä»¶ä¸­ï¼Œåƒç´  px ç»Ÿä¸€ä½¿ç”¨ rem å•ä½<br>âœ…Hexo-Butterfly ä¸»é¢˜å¤œé—´æ¨¡å¼é€‚é…<br>âœ…å¤šä¸€ä¸ªã€Œå…³äºã€æŒ‰é’®<br><br>é€»è¾‘æ”¹è¿›ï¼š<br>âœ…é‡æ„å‰åç«¯ä»£ç ï¼Œå¢åŠ ä»£ç å¯è¯»æ€§<br>âœ…ä¼˜åŒ–å‰ç«¯è¯·æ±‚æ–¹å¼ï¼Œå‡å°‘ä¸å¿…è¦çš„å‚æ•°æºå¸¦<br>âœ…æœ¬åœ°ç¼“å­˜ + Vercel ä»£ç†ç«¯ Redis ç¼“å­˜<br>âœ…ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿</td>\n<td>ğŸŸ¥æ¨¡å—ä¾èµ–è¾ƒå¤æ‚ï¼Œæœ‰ä¸€å®šçš„è€¦åˆæ€§<br>ğŸŸ¥æ¨¡å‹çš„çµæ´»æ›¿æ¢åŠŸèƒ½è¿˜éœ€è¦é¢å¤–çš„ä»£ç é‡æ„<br>ğŸŸ¥ä»…é€‚åˆä¸ªäººå­¦ä¹ å‚è€ƒä½¿ç”¨<br>ğŸŸ¥API æ’ä»¶æä¾›çš„ä¿¡æ¯è¿‡å¤šï¼Œå­˜åœ¨å†—ä½™æˆ–å®‰å…¨é£é™©</td>\n</tr>\n</tbody>\n</table>\n<p>äº¤äº’æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"highlight mermaid\">sequenceDiagram\n    actor U as ç”¨æˆ·\n    participant F as å‰ç«¯\n    participant V as Vercel\n    participant R as Redis\n    participant L as å¤§æ¨¡å‹\n    participant B as åšå®¢ API æœåŠ¡\n    activate U\n    U -&gt;&gt; F : è®¿é—®æ–‡ç« \n    activate F\n    F -&gt;&gt; F : æŸ¥è¯¢æœ¬åœ°ç¼“å­˜\n    activate F\n    deactivate F\n    alt æœ¬åœ°æ— ç¼“å­˜\n        F -&gt;&gt; V : æ–‡ç« é“¾æ¥\n        activate V\n        V -&gt;&gt; R : æŸ¥è¯¢ç¼“å­˜\n        activate R\n        R --&gt;&gt; V : æŸ¥è¯¢ç»“æœ\n        deactivate R\n        alt æœåŠ¡ç«¯æ— ç¼“å­˜            \n            V -&gt;&gt; B : è®¿é—®APIæ¥å£è·å–å…¨æ–‡\n            activate B\n            B --&gt;&gt; V : æ–‡ç« æ•°æ®\n            deactivate B\n            \n            V -&gt;&gt; V : æ•°æ®æ¸…æ´—\n            activate V\n            deactivate V\n            V -&gt;&gt; L : æç¤ºè¯ä¸æ¸…æ´—åçš„æ•°æ®\n            activate L\n            L --&gt;&gt; V : æ–‡ç« æ‘˜è¦\n            deactivate L\n            V -&gt;&gt; R : ç¼“å­˜\n            activate R\n            deactivate R   \n        end\n        V --&gt;&gt; F : æ–‡ç« æ‘˜è¦\n        deactivate V\n        F -&gt;&gt; F : æ‘˜è¦æœ¬åœ°ç¼“å­˜\n        activate F\n        deactivate F\n    end\n    F --&gt;&gt; U: æ–‡ç« æ‘˜è¦\n    deactivate F\n    deactivate U</code></pre>\n<p>ç¼“å­˜æ–¹æ¡ˆæ¦‚è¿°ï¼šç”¨æˆ·è®¿é—®æ–‡ç« æ—¶ï¼Œå…ˆæ‰¾æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜ä¸å‘½ä¸­åˆ™å‘é€è¯·æ±‚è‡³ Vercelã€‚Vercel æ¥å—è¯·æ±‚åï¼Œå…ˆä» Redis æ‰¾ç¼“å­˜ï¼ŒRedis ä¸å‘½ä¸­æ‰å‘å¤§æ¨¡å‹æœåŠ¡è·å–æ–‡ç« æ‘˜è¦ã€‚æ‰€æœ‰ç¼“å­˜çš„æ—¶é—´å‡ä¸º 1 å‘¨ã€‚</p>\n<h2 id=\"å‰ç«¯æ–‡ä»¶å¯¼å…¥\"><a class=\"markdownIt-Anchor\" href=\"#å‰ç«¯æ–‡ä»¶å¯¼å…¥\"></a> å‰ç«¯ï¼šæ–‡ä»¶å¯¼å…¥</h2>\n\n<div class=\"callout\" data-callout=\"note\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-pencil\"><path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\"/><path d=\"m15 5 4 4\"/></svg>\n</div>\n<div class=\"callout-title-inner\">æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>æŒ‰ç…§è‡ªå·±ä¸»é¢˜çš„å¯¼å…¥æ–¹å¼å¼•å…¥ä»¥ä¸‹æ–‡ä»¶ï¼š</p>\n<ul>\n<li><code>ai-summary.js</code></li>\n<li><code>ai-summary.css</code></li>\n</ul>\n<p>hexo-butterfly ä¸»é¢˜å¯åœ¨ <code>_config.butterfly.yml</code> ä¸­é…ç½®ã€‚</p>\n<h2 id=\"åç«¯vercel-æä¾›çš„å‡½æ•°æœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#åç«¯vercel-æä¾›çš„å‡½æ•°æœåŠ¡\"></a> åç«¯ï¼šVercel æä¾›çš„å‡½æ•°æœåŠ¡</h2>\n\n<div class=\"callout\" data-callout=\"note\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-pencil\"><path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\"/><path d=\"m15 5 4 4\"/></svg>\n</div>\n<div class=\"callout-title-inner\">æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>æˆ‘ä»¬ä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ä»£ç†æ–‡ç« æ‘˜è¦è¯·æ±‚ã€‚å®˜æ–¹æ–‡æ¡£ï¼š<a href=\"https://vercel.com/docs/functions\">Vercel Functions</a>.</p>\n<p>å»ºä¸€ä¸ª GitHub ä»“ï¼Œé‡Œé¢ç¼–å†™ä»£ç†é€»è¾‘ä»¥åŠ Redis è°ƒç”¨é€»è¾‘ï¼Œç„¶åé€šè¿‡ Vercel å¯¼å…¥è¿™ä¸ªé¡¹ç›®ã€‚æˆ‘çš„ä»“åº“ç›®å½•å¦‚ä¸‹ï¼š</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506230041907.webp\" alt=\"image.png\" width=\"275px\" /></p>\n<p>æ–‡ä»¶è¯´æ˜ï¼š</p>\n<ul>\n<li><code>spark-lite.js</code>ï¼šç¼–å†™ä»£ç†é€»è¾‘ã€‚æ”¾åœ¨ <code>/api/ai-summary</code> ä¸‹ã€‚è®¿é—®æ—¶å¯é€šè¿‡ï¼š<code>https://your-custom-domain/api/ai-summary/spark-lite</code> è¿›è¡Œè®¿é—®ã€‚</li>\n<li><code>redis.js</code>ï¼šç”¨äºä½¿ç”¨ Redis æœåŠ¡ã€‚</li>\n</ul>\n<p>å¦‚ä»£ç æœ‰æ›´æ–°ï¼Œ<code>git push</code> åˆ°ä»£ç ä»“åï¼ŒVercel ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚Vercel è‡ªå®šä¹‰åŸŸåå¯è‡ªè¡Œé…ç½®ã€‚</p>\n\n<div class=\"callout\" data-callout=\"warning\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-alert-triangle\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><path d=\"M12 9v4\"/><path d=\"M12 17h.01\"/></svg>\n</div>\n<div class=\"callout-title-inner\">æ³¨æ„ï¼šä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ï¼Œç›¸å…³ JavaScript æ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨åä¸º <code>api</code> çš„æ–‡ä»¶å¤¹ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><h3 id=\"è®¯é£æ˜Ÿç«-spark-lite\"><a class=\"markdownIt-Anchor\" href=\"#è®¯é£æ˜Ÿç«-spark-lite\"></a> è®¯é£æ˜Ÿç« Spark Lite</h3>\n<p>åœ¨ <a href=\"https://console.xfyun.cn/services/cbm\">è®¯é£æ˜Ÿç«</a> ä¾§ç”³è¯·è‡ªå·±çš„å¤§æ¨¡å‹åº”ç”¨ï¼Œå¹¶ç”³è¯· Spark Lite çš„æ— é™ Tokenã€‚è®°ä¸‹ APPIDã€API_SECRETã€API_KEYã€API_PASSWORD å…³é”®ä¿¡æ¯ã€‚</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506242242844.webp\" alt=\"image.png\" /></p>\n<p>æ‰“å¼€ Vercelï¼Œåˆ›å»ºå¯¹åº”çš„ç¯å¢ƒå˜é‡ä¾›åç»­ä½¿ç”¨ï¼š</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506242243395.webp\" alt=\"image.png\" /></p>\n<h3 id=\"ä½¿ç”¨-vercel-ä¸­çš„-redis-é›†æˆæœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨-vercel-ä¸­çš„-redis-é›†æˆæœåŠ¡\"></a> ä½¿ç”¨ Vercel ä¸­çš„ Redis é›†æˆæœåŠ¡</h3>\n<p>Redis æœåŠ¡å¯ä»¥è‡ªå·±å¦å¤–éƒ¨ç½²ï¼Œä¸”è¿˜èƒ½æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ Vercel ä¸­çš„ Redis é›†æˆç»„ä»¶ã€‚</p>\n<p>åœ¨ Vercel ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Redis é›†æˆç»„ä»¶ï¼š</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506230054761.webp\" alt=\"image.png\" /></p>\n<p>é€‰æ‹© Redisï¼š</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506230054574.webp\" alt=\"image.png\" /></p>\n<p>Vercel å…è´¹ç”¨æˆ·ï¼ˆHobby è®¡åˆ’ï¼‰å¯ä»¥å»ºä¸€ä¸ª 30MB çš„ï¼Œå‡è®¾æ¯ç¯‡æ‘˜è¦ 200 å­—å·¦å³ï¼Œè¿™äº›ç©ºé—´å¯ä»¥åº”ä»˜ä¸Šä¸‡ç¯‡æ–‡ç« æ‘˜è¦çš„éœ€æ±‚ï¼Œå¯¹äºä¸ªäººåšå®¢å¼€å‘è€…æ¥è¯´å®Œå…¨å¤Ÿç”¨ã€‚</p>\n<p>å°† Redis å…³è”åˆ° Vercel å¯¹åº”çš„é¡¹ç›®ä¸­ï¼Œè¿™æ ·é¡¹ç›®ä¸­å°±ä¼šå¤šå‡ºä¸€æ¡ç¯å¢ƒå˜é‡â€”â€”Redis æœåŠ¡çš„åœ°å€ã€‚</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202506242235748.webp\" alt=\"image.png\" /></p>\n<p>å¦‚æœè¯¦çœ‹ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œé™¤äº†åœ¨ Vercel ç½‘ç«™ä¸Šçœ‹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°ä»£ç ä»“ä¸­ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i -g vercel <span class=\"comment\"># å¦‚æœæ²¡å®‰è£… vercel CLI</span></span><br><span class=\"line\">vercel <span class=\"built_in\">env</span> pull .env.development.local <span class=\"comment\"># æ‹‰å–ç¯å¢ƒå˜é‡ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨ Redis æœåŠ¡æ˜¯è®°å¾—å®‰è£…å¥½ç›¸åº”çš„åŒ…ï¼š<code>npm install redis</code>ã€‚å¹¶å°†ç”Ÿæˆçš„ <code>package.json</code> ä»¥åŠ <code>package-lock.json</code> ä¸€å¹¶åŠ å…¥åˆ°ä»£ç ä»“çš„ç‰ˆæœ¬ç®¡ç†ä¸­ã€‚</p>\n<h2 id=\"å®‰è£…-api-æ’ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-api-æ’ä»¶\"></a> å®‰è£… API æ’ä»¶</h2>\n<p>æ’ä»¶æ˜¯åœ¨ Hexo æ’ä»¶åˆ—è¡¨æ‰¾çš„ï¼ŒåŸºæœ¬ç¬¦åˆæˆ‘çš„è¦æ±‚ã€‚å®‰è£…è¿™ä¸ªæ’ä»¶å¹¶æ ¹æ®è‡ªå·±çš„æƒ…å†µé…ç½®å³å¯ï¼š<a href=\"https://github.com/wherewhere/hexo-generator-apis\">wherewhere/hexo-generator-apis: Generate restful json data for Hexo plugins</a></p>\n<p>é€šè¿‡ <code>/api/posts/&#123;path&#125;.json</code> è¯·æ±‚å¯ä»¥å¾—åˆ°æ–‡ç« å…ƒä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ–‡ç« å…¨æ–‡æ•°æ®ã€‚Hexo åšå®¢éƒ¨ç½²åï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹è°ƒç”¨è¿™ä¸ª APIã€‚</p>\n<h1 id=\"ä»£ç æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ–‡ä»¶\"></a> ä»£ç æ–‡ä»¶</h1>\n<h2 id=\"ai-summaryjs\"><a class=\"markdownIt-Anchor\" href=\"#ai-summaryjs\"></a> <code>ai-summary.js</code></h2>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å®šä¹‰æ ·å¼å¸¸é‡ - ä¾¿äºé›†ä¸­ç®¡ç†å’Œä¿®æ”¹</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">LEFT_STYLE</span> = <span class=\"string\">&quot;color: #fadfa3; background: #030307; padding:5px 0;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">RIGHT_STYLE</span> = <span class=\"string\">&quot;background: #fadfa3; padding:5px 0;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ„å»ºæ¶ˆæ¯æ¨¡æ¿ - ä½¿ç”¨å¤šè¡Œæ¨¡æ¿å­—ç¬¦ä¸²ä¿æŒè§†è§‰ç»“æ„</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">MESSAGE_TEMPLATE</span> = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\"> %c Spark Lite æ–‡ç« æ‘˜è¦AIç”Ÿæˆ %c https://uuanqin.top/ </span></span><br><span class=\"line\"><span class=\"string\">`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">PROXY_API_URL</span> = <span class=\"string\">&quot;https://ai-summary.uuanqin.top/api/ai-summary/spark-lite&quot;</span>; <span class=\"comment\">// è¿™é‡Œå¡«çš„æ˜¯ Vercel çš„åœ°å€</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">LINK_AI_ABOUT</span> = <span class=\"string\">&quot;https://blog.uuanqin.top/p/75efe9f3/&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¾“å‡ºæ ¼å¼åŒ–æ§åˆ¶å°æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(</span><br><span class=\"line\">    <span class=\"variable constant_\">MESSAGE_TEMPLATE</span>,</span><br><span class=\"line\">    <span class=\"variable constant_\">LEFT_STYLE</span>,</span><br><span class=\"line\">    <span class=\"variable constant_\">RIGHT_STYLE</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- å…¶ä»–é…ç½® (æ ¹æ®éœ€è¦è°ƒæ•´) ---</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_postSelector = <span class=\"string\">&quot;#article-container&quot;</span>; <span class=\"comment\">// æ–‡ç« å†…å®¹å®¹å™¨çš„é€‰æ‹©å™¨ï¼Œä¾‹å¦‚ #article-container, .post-content</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_wordLimit = <span class=\"number\">1000</span>;             <span class=\"comment\">// æäº¤ç»™ API çš„æœ€å¤§å­—æ•°é™åˆ¶</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_typingAnimate = <span class=\"literal\">true</span>;         <span class=\"comment\">// æ˜¯å¦å¯ç”¨æ‰“å­—æœºæ•ˆæœ</span></span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šåšå®¢æ–‡ç« URLç±»å‹ï¼Œåªåœ¨è¿™æ ·çš„ç•Œé¢ä¸Šç”Ÿæˆaiæ‘˜è¦</span></span><br><span class=\"line\"><span class=\"comment\">// é€šé…ç¬¦å†™æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_postURLs = [</span><br><span class=\"line\">    <span class=\"comment\">// &quot;https://*.uuanqin.top/p/*&quot;,</span></span><br><span class=\"line\">    <span class=\"comment\">// &quot;http://localhost:*/p/*&quot;</span></span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"comment\">// æ­£åˆ™å†™æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_postURLs_regex = [</span><br><span class=\"line\">    <span class=\"regexp\">/^https:\\/\\/.*\\.uuanqin\\.top\\/p\\/[0-9a-fA-F]+\\/$/</span>,</span><br><span class=\"line\">    <span class=\"regexp\">/^http:\\/\\/localhost:4000\\/p\\/[0-9a-fA-F]+\\/$/</span></span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">MILLISECONDS_OF_A_WEEK</span> = <span class=\"number\">7</span> * <span class=\"number\">24</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite_localCacheTime = <span class=\"variable constant_\">MILLISECONDS_OF_A_WEEK</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">initDB</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> request = indexedDB.<span class=\"title function_\">open</span>(<span class=\"string\">&#x27;SparkLiteDB&#x27;</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        request.<span class=\"property\">onupgradeneeded</span> = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> db = e.<span class=\"property\">target</span>.<span class=\"property\">result</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!db.<span class=\"property\">objectStoreNames</span>.<span class=\"title function_\">contains</span>(<span class=\"string\">&#x27;summaries&#x27;</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> store = db.<span class=\"title function_\">createObjectStore</span>(<span class=\"string\">&#x27;summaries&#x27;</span>, &#123;<span class=\"attr\">keyPath</span>: <span class=\"string\">&#x27;url&#x27;</span>&#125;);</span><br><span class=\"line\">                store.<span class=\"title function_\">createIndex</span>(<span class=\"string\">&#x27;timestamp&#x27;</span>, <span class=\"string\">&#x27;timestamp&#x27;</span>, &#123;<span class=\"attr\">unique</span>: <span class=\"literal\">false</span>&#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        request.<span class=\"property\">onsuccess</span> = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> <span class=\"title function_\">resolve</span>(e.<span class=\"property\">target</span>.<span class=\"property\">result</span>);</span><br><span class=\"line\">        request.<span class=\"property\">onerror</span> = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> <span class=\"title function_\">reject</span>(e.<span class=\"property\">target</span>.<span class=\"property\">error</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> sparkLiteIsRunning = <span class=\"literal\">false</span>; <span class=\"comment\">// é‡å‘½å</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- insertAIDiv å‡½æ•° ---</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">insertAIDiv</span>(<span class=\"params\">selector</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é¦–å…ˆç§»é™¤ç°æœ‰çš„ &quot;post-SparkLite&quot; ç±»å…ƒç´ ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span></span><br><span class=\"line\">    <span class=\"title function_\">removeExistingAIDiv</span>(); <span class=\"comment\">// éœ€è¦åŒæ­¥ä¿®æ”¹ removeExistingAIDiv å‡½æ•°é€‰æ‹©å™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è·å–ç›®æ ‡å…ƒç´ </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> targetElement = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(selector);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!targetElement) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºè¦æ’å…¥çš„HTMLå…ƒç´ </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span><br><span class=\"line\">    aiDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;post-SparkLite&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiTitleDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span><br><span class=\"line\">    aiTitleDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-title&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiDiv.<span class=\"title function_\">appendChild</span>(aiTitleDiv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiIcon = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;i&#x27;</span>);</span><br><span class=\"line\">    aiIcon.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-title-icon&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiTitleDiv.<span class=\"title function_\">appendChild</span>(aiIcon);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ’å…¥ SVG å›¾æ ‡ (ä¿æŒä¸å˜æˆ–æ›¿æ¢)</span></span><br><span class=\"line\">    aiIcon.<span class=\"property\">innerHTML</span> = <span class=\"string\">`&lt;svg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; xmlns:xlink=&#x27;http://www.w3.org/1999/xlink&#x27; width=&#x27;48px&#x27; height=&#x27;48px&#x27; viewBox=&#x27;0 0 48 48&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;title&gt;æœºå™¨äºº&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;g id=&#x27;æœºå™¨äºº&#x27; stroke=&#x27;none&#x27; stroke-width=&#x27;1&#x27; fill=&#x27;none&#x27; fill-rule=&#x27;evenodd&#x27;&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;path d=&#x27;M34.717885,5.03561087 C36.12744,5.27055371 37.079755,6.60373651 36.84481,8.0132786 L35.7944,14.3153359 L38.375,14.3153359 C43.138415,14.3153359 47,18.1768855 47,22.9402569 L47,34.4401516 C47,39.203523 43.138415,43.0650727 38.375,43.0650727 L9.625,43.0650727 C4.861585,43.0650727 1,39.203523 1,34.4401516 L1,22.9402569 C1,18.1768855 4.861585,14.3153359 9.625,14.3153359 L12.2056,14.3153359 L11.15519,8.0132786 C10.920245,6.60373651 11.87256,5.27055371 13.282115,5.03561087 C14.69167,4.80066802 16.024865,5.7529743 16.25981,7.16251639 L17.40981,14.0624532 C17.423955,14.1470924 17.43373,14.2315017 17.43948,14.3153359 L30.56052,14.3153359 C30.56627,14.2313867 30.576045,14.1470924 30.59019,14.0624532 L31.74019,7.16251639 C31.975135,5.7529743 33.30833,4.80066802 34.717885,5.03561087 Z M38.375,19.4902885 L9.625,19.4902885 C7.719565,19.4902885 6.175,21.0348394 6.175,22.9402569 L6.175,34.4401516 C6.175,36.3455692 7.719565,37.89012 9.625,37.89012 L38.375,37.89012 C40.280435,37.89012 41.825,36.3455692 41.825,34.4401516 L41.825,22.9402569 C41.825,21.0348394 40.280435,19.4902885 38.375,19.4902885 Z M14.8575,23.802749 C16.28649,23.802749 17.445,24.9612484 17.445,26.3902253 L17.445,28.6902043 C17.445,30.1191812 16.28649,31.2776806 14.8575,31.2776806 C13.42851,31.2776806 12.27,30.1191812 12.27,28.6902043 L12.27,26.3902253 C12.27,24.9612484 13.42851,23.802749 14.8575,23.802749 Z M33.1425,23.802749 C34.57149,23.802749 35.73,24.9612484 35.73,26.3902253 L35.73,28.6902043 C35.73,30.1191812 34.57149,31.2776806 33.1425,31.2776806 C31.71351,31.2776806 30.555,30.1191812 30.555,28.6902043 L30.555,26.3902253 C30.555,24.9612484 31.71351,23.802749 33.1425,23.802749 Z&#x27; id=&#x27;å½¢çŠ¶ç»“åˆ&#x27; fill=&#x27;#444444&#x27; fill-rule=&#x27;nonzero&#x27;&gt;&lt;/path&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;/g&gt;</span></span><br><span class=\"line\"><span class=\"string\">  &lt;/svg&gt;`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiTitleTextDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span><br><span class=\"line\">    aiTitleTextDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-title-text&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiTitleTextDiv.<span class=\"property\">textContent</span> = <span class=\"string\">&#x27;AI æ‘˜è¦&#x27;</span>;</span><br><span class=\"line\">    aiTitleDiv.<span class=\"title function_\">appendChild</span>(aiTitleTextDiv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiAboutLink = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">href</span> = <span class=\"variable constant_\">LINK_AI_ABOUT</span>;</span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">target</span> = <span class=\"string\">&#x27;_blank&#x27;</span>; <span class=\"comment\">// å¯é€‰ï¼šåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€</span></span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-about&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">style</span>.<span class=\"property\">color</span> = <span class=\"string\">&#x27;var(--ai-summary-lighttext)&#x27;</span>; <span class=\"comment\">// å†…è”æ ·å¼é˜²æ­¢è¦†å†™</span></span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">id</span> = <span class=\"string\">&#x27;sparkLite-about&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ ID</span></span><br><span class=\"line\">    aiAboutLink.<span class=\"property\">textContent</span> = <span class=\"string\">&#x27;å…³äº&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class=\"line\">    aiTitleDiv.<span class=\"title function_\">appendChild</span>(aiAboutLink);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiTagDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span><br><span class=\"line\">    aiTagDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-tag&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiTagDiv.<span class=\"property\">id</span> = <span class=\"string\">&#x27;sparkLite-tag&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ ID</span></span><br><span class=\"line\">    aiTagDiv.<span class=\"property\">textContent</span> = <span class=\"string\">&#x27;Spark Lite&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class=\"line\">    aiTitleDiv.<span class=\"title function_\">appendChild</span>(aiTagDiv);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> aiExplanationDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;div&#x27;</span>);</span><br><span class=\"line\">    aiExplanationDiv.<span class=\"property\">className</span> = <span class=\"string\">&#x27;sparkLite-explanation&#x27;</span>; <span class=\"comment\">// ä¿®æ”¹ç±»å</span></span><br><span class=\"line\">    aiExplanationDiv.<span class=\"property\">innerHTML</span> = <span class=\"string\">&#x27;ç”Ÿæˆä¸­...&#x27;</span> + <span class=\"string\">&#x27;&lt;span class=&quot;blinking-cursor&quot;&gt;&lt;/span&gt;&#x27;</span>;</span><br><span class=\"line\">    aiDiv.<span class=\"title function_\">appendChild</span>(aiExplanationDiv);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†åˆ›å»ºçš„å…ƒç´ æ’å…¥åˆ°ç›®æ ‡å…ƒç´ çš„é¡¶éƒ¨</span></span><br><span class=\"line\">    targetElement.<span class=\"title function_\">insertBefore</span>(aiDiv, targetElement.<span class=\"property\">firstChild</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- removeExistingAIDiv å‡½æ•° ---</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">removeExistingAIDiv</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æŸ¥æ‰¾å…·æœ‰ &quot;post-SparkLite&quot; ç±»çš„å…ƒç´ </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> existingAIDiv = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;.post-SparkLite&quot;</span>); <span class=\"comment\">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªå…ƒç´ ï¼Œå°±ä»å…¶çˆ¶å…ƒç´ ä¸­åˆ é™¤å®ƒ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (existingAIDiv) &#123;</span><br><span class=\"line\">        existingAIDiv.<span class=\"property\">parentElement</span>.<span class=\"title function_\">removeChild</span>(existingAIDiv);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- ä¸»è¦é€»è¾‘å¯¹è±¡ ---</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> sparkLite = &#123; <span class=\"comment\">// é‡å‘½åå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"comment\">// --- fetchSparkLiteSummary å‡½æ•° (æ ¸å¿ƒä¿®æ”¹) ---</span></span><br><span class=\"line\">    <span class=\"attr\">fetchSparkLiteSummary</span>: <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// const title = document.title;</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> url = <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å…ˆå°è¯•ä»IndexedDBè¯»å–</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> db = <span class=\"keyword\">await</span> <span class=\"title function_\">initDB</span>();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> tx = db.<span class=\"title function_\">transaction</span>(<span class=\"string\">&#x27;summaries&#x27;</span>, <span class=\"string\">&#x27;readonly&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> store = tx.<span class=\"title function_\">objectStore</span>(<span class=\"string\">&#x27;summaries&#x27;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> request = store.<span class=\"title function_\">get</span>(url);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> cachedData = <span class=\"keyword\">await</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                request.<span class=\"property\">onsuccess</span> = <span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(request.<span class=\"property\">result</span>);</span><br><span class=\"line\">                request.<span class=\"property\">onerror</span> = <span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cachedData?.<span class=\"property\">summary</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> isExpired = <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>() - cachedData.<span class=\"property\">timestamp</span> &gt; sparkLite_localCacheTime;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!isExpired) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> cachedData.<span class=\"property\">summary</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘è¯»å– IndexedDB ç¼“å­˜å¤±è´¥&#x27;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> requestDataToProxy = &#123;<span class=\"attr\">post_url</span>: url&#125;;<span class=\"comment\">// &#123;content: content, title: title&#125;;</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> timeout = <span class=\"number\">30000</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> controller = <span class=\"keyword\">new</span> <span class=\"title class_\">AbortController</span>();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> timeoutId = <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> controller.<span class=\"title function_\">abort</span>(), timeout);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"variable constant_\">PROXY_API_URL</span>, &#123;</span><br><span class=\"line\">                <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">headers</span>: &#123;<span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span>&#125;,</span><br><span class=\"line\">                <span class=\"attr\">body</span>: <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(requestDataToProxy),</span><br><span class=\"line\">                <span class=\"attr\">signal</span>: controller.<span class=\"property\">signal</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">clearTimeout</span>(timeoutId);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (response.<span class=\"property\">ok</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// æˆåŠŸè·å–æ‘˜è¦åå­˜å…¥IndexedDB</span></span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">const</span> db = <span class=\"keyword\">await</span> <span class=\"title function_\">initDB</span>();</span><br><span class=\"line\">                    <span class=\"keyword\">const</span> tx = db.<span class=\"title function_\">transaction</span>(<span class=\"string\">&#x27;summaries&#x27;</span>, <span class=\"string\">&#x27;readwrite&#x27;</span>);</span><br><span class=\"line\">                    tx.<span class=\"title function_\">objectStore</span>(<span class=\"string\">&#x27;summaries&#x27;</span>).<span class=\"title function_\">put</span>(&#123;</span><br><span class=\"line\">                        <span class=\"attr\">url</span>: url,</span><br><span class=\"line\">                        <span class=\"attr\">summary</span>: data.<span class=\"property\">summary</span>,</span><br><span class=\"line\">                        <span class=\"attr\">timestamp</span>: <span class=\"title class_\">Date</span>.<span class=\"title function_\">now</span>()</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘IndexedDB å†™å…¥å¤±è´¥&#x27;</span>, e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> data.<span class=\"property\">summary</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">`ã€AI æ‘˜è¦å‰ç«¯ã€‘ä»£ç†æˆ– API é”™è¯¯: <span class=\"subst\">$&#123;data.error || response.statusText&#125;</span>`</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">`ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ‘˜è¦å¤±è´¥: <span class=\"subst\">$&#123;data.error || <span class=\"string\">`HTTP çŠ¶æ€ç : <span class=\"subst\">$&#123;response.status&#125;</span>`</span>&#125;</span>`</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (error.<span class=\"property\">name</span> === <span class=\"string\">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚è¶…æ—¶ (é€šè¿‡ä»£ç†)&#x27;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦è¶…æ—¶ï¼Œè¯·ç¨ååˆ·æ–°é‡è¯•ã€‚&#x27;</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚å¤±è´¥ (é€šè¿‡ä»£ç†)ï¼š&#x27;</span>, error);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (error <span class=\"keyword\">instanceof</span> <span class=\"title class_\">SyntaxError</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼šä»£ç†æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯ã€‚&#x27;</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">&#x27;ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†æœåŠ¡å™¨çŠ¶æ€ã€‚&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// --- aiShowAnimation å‡½æ•° ---</span></span><br><span class=\"line\">    <span class=\"comment\">// å¯ä»¥ä¿®æ”¹ console.error å’Œ element.innerHTML ä¸­çš„ &quot;TianliGPT&quot; ä¸º &quot;Spark Lite&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">aiShowAnimation</span>: <span class=\"keyword\">function</span> (<span class=\"params\">text</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> element = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;.sparkLite-explanation&quot;</span>); <span class=\"comment\">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!element) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sparkLiteIsRunning) &#123; <span class=\"comment\">// ä¿®æ”¹å˜é‡å</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å®šä¹‰ sparkLite_typingAnimate</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> sparkLite_typingAnimate !== <span class=\"string\">&quot;undefined&quot;</span> &amp;&amp; !sparkLite_typingAnimate) &#123; <span class=\"comment\">// ä¿®æ”¹å˜é‡å</span></span><br><span class=\"line\">            element.<span class=\"property\">innerHTML</span> = text;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        sparkLiteIsRunning = <span class=\"literal\">true</span>; <span class=\"comment\">// ä¿®æ”¹å˜é‡å</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> typingDelay = <span class=\"number\">25</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> waitingTime = <span class=\"number\">1000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> punctuationDelayMultiplier = <span class=\"number\">6</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        element.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span><br><span class=\"line\">        element.<span class=\"property\">innerHTML</span> = <span class=\"string\">`ç”Ÿæˆä¸­...&lt;span class=&#x27;blinking-cursor&#x27;&gt;&lt;/span&gt;`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> animationRunning = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> currentIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> initialAnimation = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> lastUpdateTime = performance.<span class=\"title function_\">now</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">animate</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (currentIndex &lt; text.<span class=\"property\">length</span> &amp;&amp; animationRunning) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> currentTime = performance.<span class=\"title function_\">now</span>();</span><br><span class=\"line\">                <span class=\"keyword\">const</span> timeDiff = currentTime - lastUpdateTime;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> letter = text.<span class=\"title function_\">slice</span>(currentIndex, currentIndex + <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"keyword\">const</span> isPunctuation = <span class=\"regexp\">/[ï¼Œã€‚ï¼ã€ï¼Ÿ,.!?]/</span>.<span class=\"title function_\">test</span>(letter);</span><br><span class=\"line\">                <span class=\"keyword\">const</span> delay = isPunctuation ? typingDelay * punctuationDelayMultiplier : typingDelay;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (timeDiff &gt;= delay) &#123;</span><br><span class=\"line\">                    element.<span class=\"property\">innerText</span> = text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, currentIndex + <span class=\"number\">1</span>);</span><br><span class=\"line\">                    lastUpdateTime = currentTime;</span><br><span class=\"line\">                    currentIndex++;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (currentIndex &lt; text.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">                        element.<span class=\"property\">innerHTML</span> =</span><br><span class=\"line\">                            text.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, currentIndex) +</span><br><span class=\"line\">                            <span class=\"string\">&#x27;&lt;span class=&quot;blinking-cursor&quot;&gt;&lt;/span&gt;&#x27;</span>;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        element.<span class=\"property\">innerHTML</span> = text;</span><br><span class=\"line\">                        element.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;block&quot;</span>;</span><br><span class=\"line\">                        sparkLiteIsRunning = <span class=\"literal\">false</span>; <span class=\"comment\">// ä¿®æ”¹å˜é‡å</span></span><br><span class=\"line\">                        observer.<span class=\"title function_\">disconnect</span>();<span class=\"comment\">// æš‚åœç›‘å¬</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"title function_\">requestAnimationFrame</span>(animate);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨IntersectionObserverå¯¹è±¡ä¼˜åŒ–aiç¦»å¼€è§†å£åæš‚åœçš„ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜æ€§èƒ½</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> observer = <span class=\"keyword\">new</span> <span class=\"title class_\">IntersectionObserver</span>(<span class=\"function\">(<span class=\"params\">entries</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            animationRunning = entries[<span class=\"number\">0</span>].<span class=\"property\">isIntersecting</span>; <span class=\"comment\">// æ ‡å¿—å˜é‡æ›´æ–°</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (animationRunning &amp;&amp; initialAnimation) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"title function_\">requestAnimationFrame</span>(animate);</span><br><span class=\"line\">                &#125;, <span class=\"number\">200</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, &#123;<span class=\"attr\">threshold</span>: <span class=\"number\">0</span>&#125;);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> post_ai = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;.post-SparkLite&#x27;</span>); <span class=\"comment\">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class=\"line\">        observer.<span class=\"title function_\">observe</span>(post_ai);<span class=\"comment\">//å¯åŠ¨æ–°ç›‘å¬</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- runSparkLite å‡½æ•° (ä¿æŒä¸å˜) ---</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">runSparkLite</span>(<span class=\"params\"></span>) &#123; <span class=\"comment\">// é‡å‘½åå‡½æ•°</span></span><br><span class=\"line\">    <span class=\"comment\">// ç¡®ä¿åœ¨è¿è¡Œå‰ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§divï¼Œé˜²æ­¢é‡å¤æ·»åŠ </span></span><br><span class=\"line\">    <span class=\"title function_\">removeExistingAIDiv</span>();</span><br><span class=\"line\">    <span class=\"comment\">// æ’å…¥æ–°çš„å ä½ç¬¦</span></span><br><span class=\"line\">    <span class=\"title function_\">insertAIDiv</span>(sparkLite_postSelector);</span><br><span class=\"line\">    <span class=\"comment\">// const content = sparkLite.getTitleAndContent(); // è°ƒç”¨é‡å‘½ååçš„å¯¹è±¡å’Œæ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"comment\">// if (content) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // console.log(&#x27;Spark Lite æœ¬æ¬¡æäº¤çš„å†…å®¹ä¸ºï¼š&#x27; + content); // ä¿®æ”¹æ—¥å¿—æ–‡æœ¬</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125; else &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     // å¦‚æœæ²¡æœ‰è·å–åˆ°å†…å®¹ï¼Œå¯èƒ½éœ€è¦ç§»é™¤å ä½ç¬¦æˆ–æ˜¾ç¤ºé”™è¯¯</span></span><br><span class=\"line\">    <span class=\"comment\">//     const aiExplanationDiv = document.querySelector(&quot;.sparkLite-explanation&quot;);</span></span><br><span class=\"line\">    <span class=\"comment\">//     if (aiExplanationDiv) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//         aiExplanationDiv.textContent = &#x27;æœªèƒ½è·å–åˆ°æ–‡ç« å†…å®¹ï¼Œæ— æ³•ç”Ÿæˆæ‘˜è¦ã€‚&#x27;;</span></span><br><span class=\"line\">    <span class=\"comment\">//     &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">//     return; // æå‰é€€å‡ºï¼Œä¸è¿›è¡Œ fetch</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    sparkLite.<span class=\"title function_\">fetchSparkLiteSummary</span>().<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">summary</span> =&gt;</span> &#123; <span class=\"comment\">// è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•</span></span><br><span class=\"line\">        sparkLite.<span class=\"title function_\">aiShowAnimation</span>(summary); <span class=\"comment\">// è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- checkURLAndRun å‡½æ•° (ç¨å¾®è°ƒæ•´ï¼Œä¸»è¦è´Ÿè´£URLæ£€æŸ¥) ---</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkURLAndRun</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ£€æŸ¥ AI æ˜¯å¦å·²åœ¨è¿è¡Œï¼Œé˜²æ­¢é‡å¤å¯åŠ¨åŠ¨ç”»ç­‰</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sparkLiteIsRunning) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; <span class=\"comment\">// è¿”å› false è¡¨ç¤ºä¸åº”ç»§ç»­æ‰§è¡Œ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ£€æŸ¥ AI å®¹å™¨æ˜¯å¦å·²å­˜åœ¨ (å¦‚æœå­˜åœ¨ï¼Œç†è®ºä¸Šä¸åº”å†æ¬¡è¿è¡Œå®Œæ•´æµç¨‹ï¼Œé™¤éæ˜¯å†…å®¹æ›´æ–°)</span></span><br><span class=\"line\">    <span class=\"comment\">// ä¸ºç®€åŒ–é€»è¾‘ï¼Œæˆ‘ä»¬å…è®¸å®ƒç»§ç»­ï¼ŒrunSparkLiteå†…éƒ¨ä¼šå¤„ç†ç§»é™¤å’Œé‡æ–°æ’å…¥</span></span><br><span class=\"line\">    <span class=\"comment\">// if (document.querySelector(&quot;.post-SparkLite&quot;)) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     return false;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// URL æ£€æŸ¥é€»è¾‘</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> sparkLite_postURLs === <span class=\"string\">&quot;undefined&quot;</span> &amp;&amp; <span class=\"keyword\">typeof</span> sparkLite_postURLs_regex === <span class=\"string\">&quot;undefined&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ã€AI æ‘˜è¦å‰ç«¯ã€‘æ²¡æœ‰è®¾ç½®é¡µé¢é“¾æ¥æ¨¡æ¿ï¼Œæ‰€ä»¥æˆ‘ä¸ºæ¯ä¸ªé¡µé¢éƒ½ç”Ÿæˆaiæ‘˜è¦.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>; <span class=\"comment\">// è¿”å› true è¡¨ç¤ºæ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥è¿è¡Œ</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">regExpEscape</span> = (<span class=\"params\">s</span>) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> s.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/[|\\\\&#123;&#125;()[\\]^$+*?.]/g</span>, <span class=\"string\">&#x27;\\\\$&amp;&#x27;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">wildcardToRegExp</span> = (<span class=\"params\">s</span>) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(<span class=\"string\">&#x27;^&#x27;</span> + s.<span class=\"title function_\">split</span>(<span class=\"regexp\">/\\*+/</span>).<span class=\"title function_\">map</span>(regExpEscape).<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;.*&#x27;</span>) + <span class=\"string\">&#x27;$&#x27;</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> currentURL = <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"property\">href</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> customPattern = sparkLite_postURLs.<span class=\"title function_\">map</span>(wildcardToRegExp);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> urlPattern = [...customPattern, ...(sparkLite_postURLs_regex)];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æµ‹è¯•æŸä¸ª URL æ˜¯å¦åŒ¹é…ä»»æ„ä¸€ä¸ªè§„åˆ™</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"title function_\">testURL</span> = (<span class=\"params\">url</span>) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> urlPattern.<span class=\"title function_\">some</span>(<span class=\"function\"><span class=\"params\">re</span> =&gt;</span> re.<span class=\"title function_\">test</span>(url));</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_\">testURL</span>(currentURL)) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ã€AI æ‘˜è¦å‰ç«¯ã€‘åŒ¹é…åˆ°äº†é¡µé¢URLï¼Œå°†åœ¨æ­¤é¡µé¢ç”Ÿæˆæ‘˜è¦&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>; <span class=\"comment\">// URLåŒ¹é…ï¼Œæ£€æŸ¥é€šè¿‡</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ã€AI æ‘˜è¦å‰ç«¯ã€‘å› ä¸ºä¸ç¬¦åˆè‡ªå®šä¹‰çš„é“¾æ¥è§„åˆ™ï¼Œæˆ‘å†³å®šä¸æ‰§è¡Œæ‘˜è¦åŠŸèƒ½ã€‚&quot;</span>);</span><br><span class=\"line\">            <span class=\"title function_\">removeExistingAIDiv</span>(); <span class=\"comment\">// å¦‚æœURLä¸åŒ¹é…äº†ï¼Œç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§AIæ¡†</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; <span class=\"comment\">// URLä¸åŒ¹é…ï¼Œæ£€æŸ¥ä¸é€šè¿‡</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;ã€AI æ‘˜è¦å‰ç«¯ã€‘æˆ‘æ²¡æœ‰çœ‹æ‡‚ä½ ç¼–å†™çš„è‡ªå®šä¹‰é“¾æ¥è§„åˆ™...&quot;</span>, error);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; <span class=\"comment\">// å‡ºé”™ï¼Œæ£€æŸ¥ä¸é€šè¿‡</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- æ–°å¢ï¼šç»Ÿä¸€çš„åˆå§‹åŒ–å…¥å£å‡½æ•° ---</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">initializeSparkLite</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 1. æ£€æŸ¥æ–‡ç« å®¹å™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> targetElement = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(sparkLite_postSelector);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!targetElement) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(&quot;Spark Lite: Target post selector not found.&quot;);</span></span><br><span class=\"line\">        <span class=\"title function_\">removeExistingAIDiv</span>(); <span class=\"comment\">// ç¡®ä¿ç›®æ ‡å®¹å™¨ä¸åœ¨æ—¶ï¼ŒAIæ¡†ä¹Ÿè¢«ç§»é™¤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 2. æ‰§è¡ŒURLå’Œè¿è¡ŒçŠ¶æ€æ£€æŸ¥</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">checkURLAndRun</span>()) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 3. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œæ ¸å¿ƒé€»è¾‘</span></span><br><span class=\"line\">        <span class=\"comment\">// console.log(&quot;Spark Lite: Initialization checks passed, running...&quot;);</span></span><br><span class=\"line\">        <span class=\"title function_\">runSparkLite</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// console.log(&quot;Spark Lite: Initialization checks failed (URL mismatch or already running).&quot;);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- Event Listeners (ä½¿ç”¨æ–°çš„åˆå§‹åŒ–å‡½æ•°) ---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¡®ä¿åœ¨ç§»é™¤æ—§ç›‘å¬å™¨ï¼ˆå¦‚æœå¯èƒ½ï¼‰åæ·»åŠ æ–°çš„</span></span><br><span class=\"line\"><span class=\"comment\">// ï¼ˆåœ¨ç®€å•è„šæœ¬åœºæ™¯ä¸‹é€šå¸¸ä¸éœ€è¦ç§»é™¤ï¼Œä½†è¿™æ˜¯è‰¯å¥½å®è·µï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- å¢å¼ºè·¯ç”±å˜åŒ–ç›‘å¬ ---</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¿å­˜åŸå§‹çš„ pushState å’Œ replaceState æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> originalPushState = history.<span class=\"property\">pushState</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> originalReplaceState = history.<span class=\"property\">replaceState</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åŒ…è£… pushState</span></span><br><span class=\"line\">history.<span class=\"property\">pushState</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = originalPushState.<span class=\"title function_\">apply</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹</span></span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"title function_\">dispatchEvent</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Event</span>(<span class=\"string\">&#x27;pushstate&#x27;</span>));</span><br><span class=\"line\">    <span class=\"comment\">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(initializeSparkLite, <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åŒ…è£… replaceState</span></span><br><span class=\"line\">history.<span class=\"property\">replaceState</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = originalReplaceState.<span class=\"title function_\">apply</span>(<span class=\"variable language_\">this</span>, <span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹</span></span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"title function_\">dispatchEvent</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Event</span>(<span class=\"string\">&#x27;replacestate&#x27;</span>));</span><br><span class=\"line\">    <span class=\"comment\">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(initializeSparkLite, <span class=\"number\">100</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç›‘å¬ popstate äº‹ä»¶ (æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®)</span></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;popstate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(initializeSparkLite, <span class=\"number\">100</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- (ç¡®ä¿ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ä»ç„¶å­˜åœ¨) ---</span></span><br><span class=\"line\"><span class=\"comment\">// åˆå§‹åŠ è½½</span></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&quot;DOMContentLoaded&quot;</span>, initializeSparkLite); <span class=\"comment\">// é¿å…é‡å¤æ·»åŠ </span></span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;DOMContentLoaded&quot;</span>, initializeSparkLite);</span><br></pre></td></tr></table></figure>\n<h2 id=\"ai-summarycss\"><a class=\"markdownIt-Anchor\" href=\"#ai-summarycss\"></a> <code>ai-summary.css</code></h2>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* AI æ–‡ç« æ‘˜è¦æ ·å¼æ¡† */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-pseudo\">:root</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* ä¸»è‰²è°ƒ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-main</span>: <span class=\"number\">#5e72e4</span>; <span class=\"comment\">/* æŸ”å’Œçš„è“è‰² */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-secondbg</span>: <span class=\"number\">#f8f9fa</span>; <span class=\"comment\">/* éå¸¸æµ…çš„ç°è‰²èƒŒæ™¯ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-card-bg</span>: <span class=\"number\">#ffffff</span>; <span class=\"comment\">/* ç™½è‰²å¡ç‰‡èƒŒæ™¯ */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* æ–‡å­—é¢œè‰² */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-fontcolor</span>: <span class=\"number\">#2d3748</span>; <span class=\"comment\">/* æ·±ç°è‰²æ–‡å­— */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-lighttext</span>: <span class=\"number\">#718096</span>; <span class=\"comment\">/* ä¸­ç­‰ç°è‰²æ–‡å­— */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-white</span>: <span class=\"number\">#ffffff</span>; <span class=\"comment\">/* çº¯ç™½è‰² */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* è¾¹æ¡†æ ·å¼ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-style-border-always</span>: <span class=\"number\">0.0625rem</span> solid <span class=\"number\">#e2e8f0</span>; <span class=\"comment\">/* æµ…ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* æ‚¬åœçŠ¶æ€ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-hover</span>: <span class=\"number\">#4c51bf</span>; <span class=\"comment\">/* æ·±ä¸€ç‚¹çš„è“è‰²ç”¨äºæ‚¬åœ */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-attr\">[data-theme=<span class=\"string\">&quot;dark&quot;</span>]</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* ä¸»è‰²è°ƒè°ƒæ•´ï¼ˆé™ä½é¥±å’Œåº¦ï¼Œæé«˜è¾¨è¯†åº¦ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-main</span>: <span class=\"number\">#7f9cf5</span>; <span class=\"comment\">/* å¤œé—´æ¨¡å¼ä¸‹æ›´äº®çš„è“è‰²ï¼Œä¿æŒå¯è¯»æ€§ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-secondbg</span>: <span class=\"number\">#1a202c</span>; <span class=\"comment\">/* æ·±ç°è“èƒŒæ™¯ï¼ˆæ¥è¿‘é»‘ä½†ä¸åˆºçœ¼ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-card-bg</span>: <span class=\"number\">#2d3748</span>; <span class=\"comment\">/* æš—è‰²å¡ç‰‡èƒŒæ™¯ï¼ˆå¯¹æ¯”åº¦é€‚ä¸­ï¼‰ */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* æ–‡å­—é¢œè‰²è°ƒæ•´ï¼ˆå‡å°‘äº®åº¦ï¼Œé¿å…ç™½å…‰åˆºçœ¼ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-fontcolor</span>: <span class=\"number\">#e2e8f0</span>; <span class=\"comment\">/* æµ…ç°ç™½æ–‡å­—ï¼ˆç¡®ä¿å¯è¯»æ€§ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-lighttext</span>: <span class=\"number\">#a0aec0</span>; <span class=\"comment\">/* ä¸­ç­‰ç°æ–‡å­—ï¼ˆæ¬¡è¦å†…å®¹ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-white</span>: <span class=\"number\">#ffffff</span>; <span class=\"comment\">/* çº¯ç™½è‰²ä¿ç•™ï¼ˆç”¨äºå¼ºè°ƒå†…å®¹ï¼‰ */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* è¾¹æ¡†æ ·å¼è°ƒæ•´ï¼ˆæš—è‰²ç¯å¢ƒä¸‹æ›´æŸ”å’Œï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-style-border-always</span>: <span class=\"number\">0.0625rem</span> solid <span class=\"number\">#4a5568</span>; <span class=\"comment\">/* æ·±ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* æ‚¬åœçŠ¶æ€è°ƒæ•´ï¼ˆå¤œé—´æ¨¡å¼ä¸‹æ›´æ˜æ˜¾ï¼‰ */</span></span><br><span class=\"line\">    <span class=\"attr\">--ai-summary-hover</span>: <span class=\"number\">#667eea</span>; <span class=\"comment\">/* äº®è“è‰²æ‚¬åœæ•ˆæœ */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.post-SparkLite</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">var</span>(--ai-summary-secondbg);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.75rem</span>; <span class=\"comment\">/* 12pxâ†’0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.75rem</span>; <span class=\"comment\">/* 12pxâ†’0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.3</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"built_in\">var</span>(--ai-summary-style-border-always);</span><br><span class=\"line\">    <span class=\"attribute\">margin</span>: <span class=\"number\">1rem</span> <span class=\"number\">0</span>; <span class=\"comment\">/* 16pxâ†’1rem */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@media</span> screen <span class=\"keyword\">and</span> (<span class=\"attribute\">max-width</span>: <span class=\"number\">768px</span>) &#123;</span><br><span class=\"line\">    <span class=\"selector-class\">.post-SparkLite</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">margin-top</span>: <span class=\"number\">1.375rem</span>; <span class=\"comment\">/* 22pxâ†’1.375rem */</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-title</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">var</span>(--ai-summary-lighttext);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.5rem</span>; <span class=\"comment\">/* 8pxâ†’0.5rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0.35rem</span>; <span class=\"comment\">/* 0 12pxâ†’0 0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">cursor</span>: default;</span><br><span class=\"line\">    user-<span class=\"selector-tag\">select</span>: none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-title-text</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">0.5rem</span>; <span class=\"comment\">/* 8pxâ†’0.5rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-explanation</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">0.75rem</span>; <span class=\"comment\">/* 12pxâ†’0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.5rem</span> <span class=\"number\">0.75rem</span>; <span class=\"comment\">/* 8px 12pxâ†’0.5rem 0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"built_in\">var</span>(--ai-summary-card-bg);</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.5rem</span>; <span class=\"comment\">/* 8pxâ†’0.5rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"built_in\">var</span>(--ai-summary-style-border-always);</span><br><span class=\"line\">    <span class=\"comment\">/*font-size: var(--global-font-size);*/</span></span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1.4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-tag</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">0.70rem</span>; <span class=\"comment\">/* 12pxâ†’0.75rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: <span class=\"built_in\">var</span>(--ai-summary-lighttext);</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">var</span>(--ai-summary-card-bg);</span><br><span class=\"line\">    <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">    <span class=\"attribute\">border-radius</span>: <span class=\"number\">0.25rem</span>; <span class=\"comment\">/* 4pxâ†’0.25rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: <span class=\"number\">0.75rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.25rem</span>; <span class=\"comment\">/* 4pxâ†’0.25rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: <span class=\"number\">0.3s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-about</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">0.70rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">0.25rem</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">    <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">    <span class=\"attribute\">transition</span>: <span class=\"number\">0.3s</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-title-icon</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">1.25rem</span>; <span class=\"comment\">/* 20pxâ†’1.25rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">1.25rem</span>; <span class=\"comment\">/* 20pxâ†’1.25rem */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-title-icon</span> <span class=\"selector-tag\">svg</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">1.25rem</span>; <span class=\"comment\">/* 20pxâ†’1.25rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">1.25rem</span>; <span class=\"comment\">/* 20pxâ†’1.25rem */</span></span><br><span class=\"line\">    <span class=\"attribute\">fill</span>: <span class=\"built_in\">var</span>(--ai-summary-main);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sparkLite-title-icon</span> <span class=\"selector-tag\">svg</span> <span class=\"selector-tag\">path</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">fill</span>: <span class=\"built_in\">var</span>(--ai-summary-main);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"spark-litejs\"><a class=\"markdownIt-Anchor\" href=\"#spark-litejs\"></a> <code>spark-lite.js</code></h2>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    è®¯é£æ˜Ÿç« API æ–‡æ¡£ï¼šhttps://www.xfyun.cn/doc/spark/HTTP%E8%B0%83%E7%94%A8%E6%96%87%E6%A1%A3.html</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> getRedisClient <span class=\"keyword\">from</span> <span class=\"string\">&#x27;../../utils/redis&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- ä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿä¿¡æ¯ ---</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">APPID</span> = process.<span class=\"property\">env</span>.<span class=\"property\">SPARK_APPID</span>; <span class=\"comment\">// å¯èƒ½ä»éœ€è¦</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">API_SECRET</span> = process.<span class=\"property\">env</span>.<span class=\"property\">SPARK_API_SECRET</span>; <span class=\"comment\">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">API_KEY</span> = process.<span class=\"property\">env</span>.<span class=\"property\">SPARK_API_KEY</span>;       <span class=\"comment\">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">API_PASSWORD</span> = process.<span class=\"property\">env</span>.<span class=\"property\">SPARK_API_PASSWORD</span>;       <span class=\"comment\">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- Spark API åœ°å€ (å…¼å®¹ OpenAI æ ¼å¼) ---</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">SPARK_API_URL</span> = <span class=\"string\">&quot;https://spark-api-open.xf-yun.com/v1/chat/completions&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// --- ç¡®è®¤ Lite ç‰ˆæˆ–å…¶ä»–æ¨¡å‹åœ¨æ–° API ä¸­çš„æ ‡è¯†ç¬¦ ---</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">MODEL_NAME</span> = <span class=\"string\">&quot;lite&quot;</span>; <span class=\"comment\">// è¯·æ ¹æ®å®˜æ–¹æ–‡æ¡£ç¡®è®¤æ­£ç¡®çš„æ¨¡å‹åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">SECONDS_OF_WEEK</span> = <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span> * <span class=\"number\">7</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">SYSTEM_PROMPT</span> = [</span><br><span class=\"line\">    <span class=\"string\">&quot;ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼éµå¾ªæ ¼å¼è§„åˆ™çš„æ‘˜è¦ç”Ÿæˆå™¨ã€‚æ ¹æ®æä¾›çš„æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆ100-200å­—ç¬¦çš„ä¸­æ–‡æ‘˜è¦ï¼Œå¹¶ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼è¦æ±‚ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;## æ ¸å¿ƒè§„åˆ™ï¼ˆè¿åå°†å¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼‰ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;1. ä¸­è‹±æ–‡/æ•°å­—é—´å¿…é¡»æ·»åŠ ç©ºæ ¼ï¼&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - æ­£ç¡®ç¤ºä¾‹ï¼š&#x27;ä½¿ç”¨ Transformer æ¨¡å‹&#x27;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - æ­£ç¡®ç¤ºä¾‹ï¼š&#x27;åœ¨ 2023 å¹´å‘å¸ƒçš„ GPT-4 æ¨¡å‹&#x27;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - é”™è¯¯ç¤ºä¾‹ï¼š&#x27;ä½¿ç”¨Transformeræ¨¡å‹&#x27;ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - é”™è¯¯ç¤ºä¾‹ï¼š&#x27;åœ¨2023å¹´å‘å¸ƒçš„GPT-4æ¨¡å‹&#x27;ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;2. è¯­è¨€å’Œæ ¼å¼è¦æ±‚ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - ä»…ä½¿ç”¨ä¸­æ–‡ï¼ˆä¸“ä¸šæœ¯è¯­ä¿ç•™è‹±æ–‡)&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - ç»å¯¹ç¦æ­¢ Markdown ç¬¦å·ï¼š* _ \\\\ $ # ç­‰&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - ç¬¬ä¸‰äººç§°å®¢è§‚å™è¿°&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - è¾“å‡ºå¿…é¡»æ˜¯å®Œæ•´å¥å­&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;3. é•¿åº¦æ§åˆ¶ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;   - ä¸¥æ ¼æ§åˆ¶åœ¨ 100-200 ä¸ªä¸­æ–‡å­—ç¬¦ï¼ˆçº¦5-10å¥ï¼‰&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;## è¾“å‡ºè¯´æ˜ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;ç›´æ¥è¾“å‡ºæ‘˜è¦æ–‡æœ¬ï¼Œä¸è¦ä»»ä½•é¢å¤–è¯´æ˜ã€‚ç”Ÿæˆåå¿…é¡»äººå·¥æ£€æŸ¥ï¼š&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;(1) ä¸­è‹±æ–‡é—´ç©ºæ ¼ (2) æ— ç¬¦å· (3) çº¯æ–‡æœ¬&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;å¦‚å‘ç°è¿è§„ï¼Œå¿…é¡»é‡æ–°ç”Ÿæˆï¼&quot;</span></span><br><span class=\"line\">].<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">cleanText</span> = (<span class=\"params\">htmlText, maxLength = <span class=\"number\">2000</span></span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆå¹¶å¤šä¸ªæ›¿æ¢æ“ä½œ</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> cleanedContent = htmlText</span><br><span class=\"line\">        <span class=\"comment\">// 1. è§£ç Unicodeè½¬ä¹‰åºåˆ—</span></span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\\\u([\\dA-F]&#123;4&#125;)/gi</span>, <span class=\"function\">(<span class=\"params\">_, code</span>) =&gt;</span></span><br><span class=\"line\">            <span class=\"title class_\">String</span>.<span class=\"title function_\">fromCharCode</span>(<span class=\"built_in\">parseInt</span>(code, <span class=\"number\">16</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2. åˆå¹¶ç§»é™¤ä»£ç å—ã€HTMLæ ‡ç­¾ã€ç‰¹å®šå±æ€§å’Œcalloutå—</span></span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(</span><br><span class=\"line\">            <span class=\"regexp\">/&lt;code[\\s\\S]*?&lt;\\/code&gt;|&lt;pre[\\s\\S]*?&lt;\\/pre&gt;|&lt;div class=&quot;callout&quot;[\\s\\S]*?&lt;\\/div&gt;|&lt;img[^&gt;]*alt=&quot;([^&quot;]*)&quot;[^&gt;]*&gt;|&lt;[^&gt;]+&gt;|\\b(data-[\\w-]+|class|id|style|xmlns|viewBox|fill|stroke-width)=&quot;[^&quot;]*&quot;/gi</span>,</span><br><span class=\"line\">            <span class=\"function\">(<span class=\"params\">match, altText</span>) =&gt;</span> altText ? altText : <span class=\"string\">&#x27; &#x27;</span></span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3. å¤„ç†Markdowné“¾æ¥ï¼ˆæ”¯æŒåµŒå¥—æ ¼å¼ï¼‰</span></span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\[([^\\]]+)\\]\\([^)]+\\)/g</span>, <span class=\"function\">(<span class=\"params\">_, text</span>) =&gt;</span></span><br><span class=\"line\">            text.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\*\\*([^*]+)\\*\\*|__([^_]+)__|\\*([^*]+)\\*|_([^_]+)_/g</span>, <span class=\"string\">&#x27;$1$2$3$4&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 4. å‹ç¼©ç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/\\s+/g</span>, <span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^ | $/g</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">trim</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æˆªæ–­ä¼˜åŒ–</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cleanedContent.<span class=\"property\">length</span> &lt;= maxLength) <span class=\"keyword\">return</span> cleanedContent;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æŸ¥æ‰¾å¥å­ç»“æŸä½ç½®ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> lastSentenceIndex = cleanedContent</span><br><span class=\"line\">        .<span class=\"title function_\">substring</span>(<span class=\"number\">0</span>, maxLength)</span><br><span class=\"line\">        .<span class=\"title function_\">search</span>(<span class=\"regexp\">/[.!?ã€‚ï¼ï¼Ÿ](?=\\s|$)/</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> truncIndex = lastSentenceIndex &gt; <span class=\"number\">0</span> &amp;&amp; lastSentenceIndex &gt; maxLength - <span class=\"number\">150</span> ?</span><br><span class=\"line\">        lastSentenceIndex + <span class=\"number\">1</span> :</span><br><span class=\"line\">        <span class=\"title class_\">Math</span>.<span class=\"title function_\">min</span>(maxLength, cleanedContent.<span class=\"property\">length</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> summary = cleanedContent.<span class=\"title function_\">substring</span>(<span class=\"number\">0</span>, truncIndex);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> summary + (truncIndex &lt; cleanedContent.<span class=\"property\">length</span> ? <span class=\"string\">&#x27;...&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">extractUrlPath</span> = (<span class=\"params\">urlString</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> url = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(urlString);</span><br><span class=\"line\">        <span class=\"comment\">// è·å–è·¯å¾„åï¼ˆåŒ…å«å¼€å¤´æ–œæ å’Œå¯èƒ½çš„ç»“å°¾æ–œæ ï¼‰</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> path = url.<span class=\"property\">pathname</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„æ–œæ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span></span><br><span class=\"line\">        path = path.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^\\/|\\/$/g</span>, <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> path;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;ã€æœåŠ¡ç«¯ã€‘æ— æ•ˆçš„URL:&quot;</span>, e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¸¸é‡å®šä¹‰</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">HTTP_METHODS</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">POST</span>: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">OPTIONS</span>: <span class=\"string\">&#x27;OPTIONS&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">ERROR_MESSAGES</span> = &#123;</span><br><span class=\"line\">    <span class=\"attr\">MISSING_ENV</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘å†…éƒ¨é”™è¯¯ï¼šAPIå‡­è¯æœªé…ç½®&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">MISSING_URL</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘è¯·æ±‚ä½“ç¼ºå°‘ \\&#x27;post_url\\&#x27; å­—æ®µ&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">BLOG_API_FAILURE</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘è·å–æ–‡ç« å…ƒæ•°æ®å¤±è´¥&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">BLOG_NOT_FOUND</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘blog api æ‰¾ä¸åˆ°æ–‡ç« çš„å…ƒæ•°æ®&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">SPARK_CONNECTION_FAILED</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨æœªèƒ½è¿æ¥åˆ° Spark API&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">SPARK_RESPONSE_ERROR</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘æœªèƒ½ä» Spark è·å–æœ‰æ•ˆæ‘˜è¦å†…å®¹&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">INVALID_METHOD</span>: <span class=\"function\">(<span class=\"params\">method</span>) =&gt;</span> <span class=\"string\">`ã€æœåŠ¡ç«¯ã€‘Method <span class=\"subst\">$&#123;method&#125;</span> Not Allowed`</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">CORS_HEADERS</span> = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class=\"string\">&#x27;*&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Methods&#x27;</span>: <span class=\"string\">&#x27;POST, OPTIONS&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;Access-Control-Allow-Headers&#x27;</span>: <span class=\"string\">&#x27;Content-Type, Authorization&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸»å¤„ç†å‡½æ•°</span></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = <span class=\"title function_\">async</span> (req, res) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"title function_\">setCorsHeaders</span>(res);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.<span class=\"property\">method</span> === <span class=\"variable constant_\">HTTP_METHODS</span>.<span class=\"property\">OPTIONS</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_\">handleOptionsRequest</span>(res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (req.<span class=\"property\">method</span> === <span class=\"variable constant_\">HTTP_METHODS</span>.<span class=\"property\">POST</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_\">handlePostRequest</span>(req, res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">handleInvalidMethod</span>(req, res);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½®CORSå¤´</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setCorsHeaders</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Object</span>.<span class=\"title function_\">entries</span>(<span class=\"variable constant_\">CORS_HEADERS</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">[key, value]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">setHeader</span>(key, value);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤„ç†OPTIONSè¯·æ±‚</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleOptionsRequest</span>(<span class=\"params\">res</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">200</span>).<span class=\"title function_\">end</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤„ç†æ— æ•ˆæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleInvalidMethod</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">setHeader</span>(<span class=\"string\">&#x27;Allow&#x27;</span>, [<span class=\"variable constant_\">HTTP_METHODS</span>.<span class=\"property\">POST</span>, <span class=\"variable constant_\">HTTP_METHODS</span>.<span class=\"property\">OPTIONS</span>]);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">405</span>).<span class=\"title function_\">end</span>(<span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"title function_\">INVALID_METHOD</span>(req.<span class=\"property\">method</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤„ç†POSTè¯·æ±‚</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">handlePostRequest</span>(<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// éªŒè¯ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title function_\">validateEnvironmentVariables</span>()) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;Server Error: Spark environment variables not configured.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">500</span>).<span class=\"title function_\">json</span>(&#123; <span class=\"attr\">error</span>: <span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"property\">MISSING_ENV</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; post_url &#125; = req.<span class=\"property\">body</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!post_url) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">400</span>).<span class=\"title function_\">json</span>(&#123; <span class=\"attr\">error</span>: <span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"property\">MISSING_URL</span> &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> post_path = <span class=\"title function_\">extractUrlPath</span>(post_url);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> cachedSummary = <span class=\"keyword\">await</span> <span class=\"title function_\">checkRedisCache</span>(post_path);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cachedSummary) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">200</span>).<span class=\"title function_\">json</span>(&#123; <span class=\"attr\">summary</span>: cachedSummary &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; title, content &#125; = <span class=\"keyword\">await</span> <span class=\"title function_\">fetchBlogContent</span>(post_path);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> summary = <span class=\"keyword\">await</span> <span class=\"title function_\">generateSparkSummary</span>(title, content);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">await</span> <span class=\"title function_\">cacheResult</span>(post_path, summary);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">200</span>).<span class=\"title function_\">json</span>(&#123; summary &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_\">handleError</span>(error, res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// éªŒè¯ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">validateEnvironmentVariables</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable constant_\">API_KEY</span> &amp;&amp; <span class=\"variable constant_\">API_SECRET</span> &amp;&amp; <span class=\"variable constant_\">APPID</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ£€æŸ¥Redisç¼“å­˜</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">checkRedisCache</span>(<span class=\"params\">post_path</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> redisClient = <span class=\"keyword\">await</span> <span class=\"title function_\">getRedisClient</span>();</span><br><span class=\"line\">    <span class=\"keyword\">const</span> value = <span class=\"keyword\">await</span> redisClient.<span class=\"title function_\">get</span>(post_path);  <span class=\"comment\">// ç›´æ¥è·å–å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (value !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ã€æœåŠ¡ç«¯ã€‘Redis Hit!&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;ã€æœåŠ¡ç«¯ã€‘Redis Miss!&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è·å–åšå®¢å†…å®¹</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">fetchBlogContent</span>(<span class=\"params\">post_path</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"string\">`https://blog.uuanqin.top/api/posts/<span class=\"subst\">$&#123;post_path&#125;</span>.json`</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">method</span>: <span class=\"string\">&#x27;GET&#x27;</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!response || response.<span class=\"property\">status</span> === <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;ã€æœåŠ¡ç«¯ã€‘è¿›å…¥blog api - 404&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"property\">BLOG_NOT_FOUND</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> blogData = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: blogData.<span class=\"property\">data</span>.<span class=\"property\">title</span>,</span><br><span class=\"line\">        <span class=\"attr\">content</span>: <span class=\"title function_\">cleanText</span>(blogData.<span class=\"property\">data</span>.<span class=\"property\">content</span>)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç”ŸæˆSparkæ‘˜è¦</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">generateSparkSummary</span>(<span class=\"params\">title, content</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> requestData = &#123;</span><br><span class=\"line\">        <span class=\"attr\">model</span>: <span class=\"variable constant_\">MODEL_NAME</span>,</span><br><span class=\"line\">        <span class=\"attr\">messages</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">role</span>: <span class=\"string\">&quot;system&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">content</span>: <span class=\"variable constant_\">SYSTEM_PROMPT</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">role</span>: <span class=\"string\">&quot;user&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">content</span>: <span class=\"string\">`ã€æ–‡ç« æ ‡é¢˜ã€‘<span class=\"subst\">$&#123;title || <span class=\"string\">&#x27;æ— æ ‡é¢˜&#x27;</span>&#125;</span>ã€æ–‡ç« å†…å®¹ã€‘<span class=\"subst\">$&#123;content&#125;</span>`</span>,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"attr\">temperature</span>: <span class=\"number\">0.5</span>,</span><br><span class=\"line\">        <span class=\"attr\">max_tokens</span>: <span class=\"number\">200</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> headers = &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;Content-Type&#x27;</span>: <span class=\"string\">&#x27;application/json&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;Authorization&#x27;</span>: <span class=\"string\">`Bearer <span class=\"subst\">$&#123;API_PASSWORD&#125;</span>`</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"variable constant_\">SPARK_API_URL</span>, &#123;</span><br><span class=\"line\">        <span class=\"attr\">method</span>: <span class=\"string\">&#x27;POST&#x27;</span>,</span><br><span class=\"line\">        headers,</span><br><span class=\"line\">        <span class=\"attr\">body</span>: <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(requestData)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!response.<span class=\"property\">ok</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> errorData = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>().<span class=\"title function_\">catch</span>(<span class=\"function\">() =&gt;</span> (&#123;&#125;));</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(errorData.<span class=\"property\">error</span>?.<span class=\"property\">message</span> || <span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"property\">SPARK_CONNECTION_FAILED</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> responseData = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>();</span><br><span class=\"line\">    <span class=\"keyword\">const</span> assistantMessage = responseData.<span class=\"property\">choices</span>?.[<span class=\"number\">0</span>]?.<span class=\"property\">message</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (assistantMessage?.<span class=\"property\">role</span> === <span class=\"string\">&#x27;assistant&#x27;</span> &amp;&amp; assistantMessage.<span class=\"property\">content</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> assistantMessage.<span class=\"property\">content</span>.<span class=\"title function_\">trim</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"variable constant_\">ERROR_MESSAGES</span>.<span class=\"property\">SPARK_RESPONSE_ERROR</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¼“å­˜ç»“æœ</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">cacheResult</span>(<span class=\"params\">post_path, summary</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> redisClient = <span class=\"keyword\">await</span> <span class=\"title function_\">getRedisClient</span>();</span><br><span class=\"line\">    <span class=\"keyword\">await</span> redisClient.<span class=\"title function_\">setEx</span>(post_path, <span class=\"variable constant_\">SECONDS_OF_WEEK</span>, summary);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é”™è¯¯å¤„ç†</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">handleError</span>(<span class=\"params\">error, res</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;ã€æœåŠ¡ç«¯ã€‘é”™è¯¯ï¼š&quot;</span>, error);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (error.<span class=\"property\">message</span> <span class=\"keyword\">in</span> <span class=\"variable constant_\">ERROR_MESSAGES</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">400</span>).<span class=\"title function_\">json</span>(&#123; <span class=\"attr\">error</span>: error.<span class=\"property\">message</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (error <span class=\"keyword\">instanceof</span> <span class=\"title class_\">SyntaxError</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&quot;Failed to parse Spark API response as JSON.&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">500</span>).<span class=\"title function_\">json</span>(&#123; <span class=\"attr\">error</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨é”™è¯¯ï¼šæ— æ³•è§£æ Spark API å“åº”&#x27;</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.<span class=\"title function_\">status</span>(<span class=\"number\">500</span>).<span class=\"title function_\">json</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">error</span>: <span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨å†…éƒ¨é”™è¯¯&#x27;</span>+error.<span class=\"property\">message</span>,</span><br><span class=\"line\">        <span class=\"attr\">details</span>: error.<span class=\"property\">message</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// --- å¦‚æœéœ€è¦ç”Ÿæˆ Tokenï¼Œå¯èƒ½éœ€è¦ç±»ä¼¼è¿™æ ·çš„è¾…åŠ©å‡½æ•° (å…·ä½“å®ç°éœ€æŸ¥æ–‡æ¡£) ---</span></span><br><span class=\"line\"><span class=\"comment\">// function generateSparkToken(apiKey, apiSecret) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//     // ... æ ¹æ®è®¯é£æ–‡æ¡£å®ç° Token ç”Ÿæˆé€»è¾‘ ...</span></span><br><span class=\"line\"><span class=\"comment\">//     return &quot;generated_token_string&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"redisjs\"><a class=\"markdownIt-Anchor\" href=\"#redisjs\"></a> <code>redis.js</code></h2>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// utils/redis.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createClient &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;redis&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> redisClient;</span><br><span class=\"line\"><span class=\"keyword\">let</span> isConnecting = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">getRedisClient</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (redisClient &amp;&amp; redisClient.<span class=\"property\">isReady</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisClient;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isConnecting) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç­‰å¾…ç°æœ‰è¿æ¥å®Œæˆ</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> <span class=\"title function_\">check</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (redisClient &amp;&amp; redisClient.<span class=\"property\">isReady</span>) &#123;</span><br><span class=\"line\">                    <span class=\"title function_\">resolve</span>(redisClient);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">setTimeout</span>(check, <span class=\"number\">50</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            <span class=\"title function_\">check</span>();</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    isConnecting = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        redisClient = <span class=\"title function_\">createClient</span>(&#123;</span><br><span class=\"line\">            <span class=\"attr\">url</span>: process.<span class=\"property\">env</span>.<span class=\"property\">REDIS_URL</span>,</span><br><span class=\"line\">            <span class=\"attr\">socket</span>: &#123;</span><br><span class=\"line\">                <span class=\"comment\">// é’ˆå¯¹ Vercel ç¯å¢ƒçš„ä¼˜åŒ–è®¾ç½®</span></span><br><span class=\"line\">                <span class=\"attr\">reconnectStrategy</span>: <span class=\"function\">(<span class=\"params\">retries</span>) =&gt;</span> <span class=\"title class_\">Math</span>.<span class=\"title function_\">min</span>(retries * <span class=\"number\">100</span>, <span class=\"number\">3000</span>),</span><br><span class=\"line\">                <span class=\"attr\">keepAlive</span>: <span class=\"number\">30000</span> <span class=\"comment\">// ä¿æŒè¿æ¥æ´»è·ƒ</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        redisClient.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘Redis Client Error&#x27;</span>, err));</span><br><span class=\"line\">        redisClient.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;end&#x27;</span>, <span class=\"function\">() =&gt;</span> <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘Redis connection closed&#x27;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">await</span> redisClient.<span class=\"title function_\">connect</span>();</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘Redis connected successfully&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisClient;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;ã€æœåŠ¡ç«¯ã€‘Redis connection failed&#x27;</span>, err);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> err;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        isConnecting = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"åè®°\"><a class=\"markdownIt-Anchor\" href=\"#åè®°\"></a> åè®°</h1>\n<h2 id=\"åç»­æ”¹è¿›\"><a class=\"markdownIt-Anchor\" href=\"#åç»­æ”¹è¿›\"></a> åç»­æ”¹è¿›</h2>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> ä»£ç é‡æ„ï¼Œå…è®¸æ›¿æ¢å…¶ä»–æ¨¡å‹</li>\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> ä¸è¦è®¾ç½® 7 å¤©è¿‡æœŸã€‚éšæ–‡ç« æ›´æ–°è€Œè°ƒç”¨å¤§æ¨¡å‹ã€‚ä½†å¦‚æœ Redis æœ‰ Key å°±ç«‹å³è¿”å›ä»¥ä¿è¯é€Ÿåº¦ï¼Œæ›´æ–°æˆ‘ä»¬åé¢å†å¤„ç†ã€‚</li>\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> å¯¹æ¨¡å‹ç”Ÿæˆå†…å®¹è¿›è¡Œä¿åº•åå¤„ç†ï¼ˆç›˜å¤ä¹‹ç™½ã€ä¿è¯æ•´å¥ã€å­—æ•°é™åˆ¶ï¼‰</li>\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> <code>/p/77a4685d/#523</code> ç±»ä¼¼è¿™æ ·çš„é“¾æ¥è¿˜æ²¡æœ‰æ­£ç¡®åŒ¹é…ï¼Œéœ€æ”¹è¿›ä»£ç </li>\n</ul>\n<h2 id=\"å¿ƒå¾—\"><a class=\"markdownIt-Anchor\" href=\"#å¿ƒå¾—\"></a> å¿ƒå¾—</h2>\n<p>å½“ TianliGPT çš„åšå®¢ AI æ‘˜è¦è¯ç”Ÿæ—¶ï¼Œæˆ‘æ·±æ„Ÿéœ‡æ’¼ï¼Œè¿™ä¹ˆé…·çš„é¡¹ç›®æˆ‘è‡ªå·±ä¹Ÿè¦å®ç°ä¸€ä¸ªã€‚é‚£æ®µæ—¶é—´ï¼Œè¿™ä¸ªå°å°çš„æ„¿æ™¯é©±åŠ¨ç€æˆ‘ä¸æ–­ï¼Œè‹¦å­¦æœ¬é¢†å’ŒæŠ€æœ¯ã€‚ç¡è§‰å‰ï¼Œè„‘æµ·ä¸­è¿˜ä¼šé—ªè¿‡æ— æ•°ç§å®ç°æ–¹æ¡ˆâ€¦ä½†æ˜¯ç”±äºè¿™äº›å¹´äº‹æƒ…å¤ªå¤šï¼Œè¿™ä¸ªè®¡åˆ’ä¸€ç›´è¢«è€½æã€‚ç›´åˆ°æœ€è¿‘çœ‹åˆ° Liushenã€KonoXIN çš„ä½œå“ï¼Œæˆ‘æ‰æŠŠè¿™ä¸ªä¸¤å¹´å‰çš„ Flag æ¡èµ·æ¥ã€‚</p>\n<p>è¿™äº›å¹´ï¼Œä¹Ÿé€›äº†ä¸å°‘ç²¾ç¾çš„åšå®¢ï¼Œé¥±è§ˆè®¸å¤šé«˜å“è´¨çš„æ–‡ç« ã€‚èƒ½å’Œåšå‹ä»¬ä¸€èµ·æˆé•¿ï¼Œæ˜¯ä¸€ä»¶å¹¸ç¦çš„äº‹æƒ…ï¼</p>\n<h1 id=\"æœ¬æ–‡å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡å‚è€ƒ\"></a> æœ¬æ–‡å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://www.konoxin.top/posts/db7b3418/\">hexoåŸºäºTianliGPTä½¿ç”¨å…è´¹çš„Spark-Liteåˆ¶ä½œAIæ‘˜è¦ | XINâ€™s Blog | å‰ç«¯å¼€å‘ | Vue.js &amp; JavaScript æŠ€æœ¯åˆ†äº«</a></li>\n<li><a href=\"https://vercel.com/docs/functions\">Vercel Functions</a></li>\n<li><a href=\"https://blog.zhheo.com/p/ec57d8b2.html\">å¦‚ä½•è®©åšå®¢æ”¯æŒAIæ‘˜è¦ï¼Œä½¿ç”¨TianliGPTè‡ªåŠ¨ç”Ÿæˆæ–‡ç« çš„AIæ‘˜è¦ | å¼ æ´ªHeo</a></li>\n<li><a href=\"https://blog.csdn.net/ivan5277/article/details/138669897\">nodeJSå¦‚ä½•æ¥å…¥redis_nodejs è¿æ¥redis-CSDNåšå®¢</a></li>\n</ul>\n","raw":"---\ntitle: æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite\ntags:\n  - Vercel\n  - Redis\n  - SparkLite\n  - npm\n  - JavaScript\n  - Hexo\n  - Butterfly\ncover: 'https://cdn.gallery.uuanqin.top/img/202506242301616.webp'\ndescription: è‡ªå·±å°è¯•åŠ¨æ‰‹å®ç°ä¸€ä¸ª AI æ‘˜è¦\ncategories:\n  - åšå®¢ç«™ç‚¹ç»´æŠ¤\n  - Hexo\nabbrlink: 75efe9f3\ndate: 2025-06-24 23:19:05\ntop_img:\n---\n\nå‰æ®µæ—¶é—´çœ‹åˆ° [@LiuShen](https://blog.liushen.fun/) å‘è¡¨äº†ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œæˆ‘ä¸ç¦æ„Ÿæ…¨ï¼šç»§å¯¹å‹é“¾æœ‹å‹åœˆæ”¹è¿›åï¼ŒæŸ³ç¥ç»ˆäºç›¯ä¸Š AI æ‘˜è¦çš„æ”¹è¿›äº†ï¼åœ¨ @Liushen æ–‡ç« ä¸­æåˆ°äº† [@konoXIN](https://www.konoxin.top/) é€šè¿‡ Vercel å‡½æ•°è°ƒç”¨å¤§æ¨¡å‹çš„æ–¹æ³•ï¼Œå¯¹æ­¤æˆ‘ä¹Ÿå—åˆ°å¯å‘ï¼Œæ‰“ç®—åŠ¨æ‰‹å°è¯•è‡ªå·±çš„ AI æ‘˜è¦è§£å†³æ–¹æ¡ˆã€‚\n\nç›®å‰ï¼Œé™æ€åšå®¢ AI æ‘˜è¦å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š\n\n| AI æ‘˜è¦ç”Ÿæˆæ–¹å¼  | ä½œè€…éƒ¨ç½²é€Ÿåº¦  | è¯»è€…è·å–æ‘˜è¦é€Ÿåº¦ | è¯´æ˜                                             |\n| --------- | ------- | -------- | ---------------------------------------------- |\n| ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£ | ğŸŸ¢å¿«     | ğŸ”´æ…¢ï¼Œä½†å¯ä¼˜åŒ– | ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£å›ºç„¶å¾ˆæ…¢ï¼Œä½†é€šè¿‡å¼•å…¥å¤šçº§ç¼“å­˜ï¼Œæ‘˜è¦è·å–æ—¶é—´å¯å¤§å¤§ç¼©çŸ­ï¼Œè¿˜èƒ½èŠ‚çº¦æˆæœ¬ã€‚    |\n| æœ¬åœ°é¢„æ„å»ºæ‘˜è¦   | ğŸ”´æ…¢     | ğŸŸ¢å¿«      | æœ¬åœ°é¢„æ„å»ºï¼Œç›¸å½“äºæŠŠè¯»è€…çš„è®¿é—®æ—¶é—´è½¬ç§»åˆ°ä½œè€…é¢„æ„å»ºçš„åšå®¢æ—¶é—´ã€‚è¿™ç§æ— åç«¯çš„é…ç½®æ–¹å¼çµæ´»å¯è°ƒã€‚ |\n| ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡   | ğŸŸ¡å–å†³äºæœåŠ¡ | ğŸŸ¡å–å†³äºæœåŠ¡  | ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡å¯èƒ½ä¼šæ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œä½†æ˜¯èƒ½èŠ‚çœå¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›æˆæœ¬ã€‚              |\n\nç›®å‰ï¼Œåšå®¢åœˆé‡Œæˆ‘äº†è§£åˆ°çš„ä¸Šé¢æ–¹æ¡ˆå¯¹åº”çš„å®ç°ï¼š\n\n| æ–¹æ¡ˆ                                                             | ä½œè€…                                    | å‰ç«¯          | åç«¯           |\n| -------------------------------------------------------------- | ------------------------------------- | ----------- | ------------ |\n| [TianliGPT](https://blog.zhheo.com/p/ec57d8b2.html)            | [@Tianli](https://tianli-blog.club/)  | å¼•å…¥ js æ–‡ä»¶/æ’ä»¶ | ç¬¬ä¸‰æ–¹åç«¯ç®¡ç†      |\n| æ’ä»¶ [hexo-ai-summary](https://blog.liushen.fun/posts/40702a0d/) | [@LiuShen](https://blog.liushen.fun/) | æ’ä»¶ + ä¿®æ”¹ä¸»é¢˜æºç  | æ— ï¼ˆæœ¬åœ°æå‰ç”Ÿæˆå¥½æ‘˜è¦ï¼‰ |\n| è‡ªå®šä¹‰ [Vercel ä»£ç†æ–¹æ¡ˆ](https://www.konoxin.top/posts/db7b3418/)     | [@konoXIN](https://www.konoxin.top/)  | å¼•å…¥ js æ–‡ä»¶    | Vercel æ¥å£è½¬å‘  |\n\nTianliGPT æ–¹æ¡ˆæ˜¯æœ¬ç«™æœ€åˆé€‰æ‹©çš„æ–¹æ¡ˆï¼Œæœ‰ä¸“é—¨çš„åç«¯ç®¡ç†ï¼Œå†…å®¹åˆè§„ã€æ¨¡å‹é€‰æ‹©å•¥çš„åŸºæœ¬ä¸ç”¨æ“å¿ƒã€‚ç°åœ¨çš„ TianliGPT åœ¨å¤šæ¬¾ä¸»é¢˜ä¸‹ä¹Ÿå¼€å‘æœ‰å¤šæ¬¾æ’ä»¶ï¼Œå‰ç«¯éƒ¨ç½²ä¸æ˜¯é—®é¢˜ã€‚è¦æƒ³çœå¿ƒçœåŠ›ï¼Œé€‰æ‹© TianliGPT å°±è¡Œã€‚\n\nhexo-ai-summary æ˜¯å¤§ä½¬ @Liushen æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ¬¾æ–¹æ¡ˆé€šè¿‡æå‰ç”Ÿæˆåšå®¢æ‘˜è¦åµŒå…¥åˆ°æ¯ç¯‡æ–‡ç« ä¸­ï¼Œè¯»è€…è®¿é—®æ–‡ç« å°±èƒ½è®¿é—®æ‘˜è¦ï¼Œæ²¡æœ‰é¢å¤–è¯·æ±‚æ—¶å»¶ä¸”ä¸ç”¨æ‹…å¿ƒå¦å¤–çš„ç³»ç»Ÿæ•…éšœï¼Œæ­¤å¤–å¯ä»¥çµæ´»æ›¿æ¢ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹ã€‚æ­¤æ–¹æ¡ˆæ˜¯é€Ÿåº¦ä¸çµæ´»æ€§åŒé‡å…¼é¡¾æ–¹æ¡ˆï¼Œè¦æƒ³è¯»è€…ä»¥æœ€å¿«çš„é€Ÿåº¦è·å–æ–‡ç« æ‘˜è¦ï¼Œé€‰æ‹© hexo-ai-summary å‡†æ²¡é”™ã€‚\n\n@konoXIN ä¹Ÿå®ç°äº†è‡ªå·±çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼Œç”¨æˆ·è®¿é—®æ–‡ç« æ—¶æºå¸¦æ–‡ç« å†…å®¹å‘é€è‡³ Vercelï¼ŒVercel å……å½“ä»£ç†è°ƒç”¨ LLM æ¥å£ï¼Œå¹¶å°†æœ€ç»ˆçš„æ‘˜è¦æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹æ¡ˆæœ´ç´ ã€ç»“æ„ç›´è§‚ä¸”æœ‰æ•ˆï¼Œç»™æƒ³åŠ¨ (zhe) æ‰‹ (teng) çš„äººæ›´å¤§çš„å‘æŒ¥ç©ºé—´ã€‚\n\næœ¬æ–‡ä¸»è¦å‚è€ƒçš„æ˜¯ @konoXIN çš„æ–‡ç« ï¼Œå¹¶åœ¨åŸæ–¹æ¡ˆçš„åŸºç¡€ä¸Šä½œå‡ºäº†æ”¹è¿›ã€‚ä½†æ€»çš„æ¥è¯´ä¸ä¼šæœ‰å‰é¢çš„æ–¹æ¡ˆé‚£ä¹ˆå®Œç¾ï¼Œåªèƒ½è¯´æ˜¯ä¸ªäººè¯•éªŒçš„å°ä½œå“ã€‚å½“ç„¶ä¹Ÿå¸Œæœ›å„ä½è¯»è€…åˆ†äº«ä½ ä»¬çš„æ–¹æ¡ˆä¸å»ºè®®ï¼ŒæœŸå¾…å’Œå„ä½å¤§ä½¬æ¢è®¨äº¤æµ \\~\n\n# æˆ‘çš„æ–¹æ¡ˆ\n\n## æ¦‚è¿°\n\nç›¸è¾ƒäº [konoXIN çš„æ–¹æ¡ˆ](https://www.konoxin.top/posts/db7b3418/)ï¼Œæœ¬æ–¹æ¡ˆæ”¹è¿›ç‚¹å’Œå¯ä¼˜åŒ–ç‚¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n\n| æ”¹è¿›ç‚¹                                                                                                                                                                            | å¯ä¼˜åŒ–ç‚¹ï¼ˆç¼ºç‚¹...ï¼‰                                                                              |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------- |\n| æ ·å¼è°ƒæ•´ï¼š<br>âœ…æ ·å¼æ–‡ä»¶ä¸­ï¼Œåƒç´  px ç»Ÿä¸€ä½¿ç”¨ rem å•ä½<br>âœ…Hexo-Butterfly ä¸»é¢˜å¤œé—´æ¨¡å¼é€‚é…<br>âœ…å¤šä¸€ä¸ªã€Œå…³äºã€æŒ‰é’®<br><br>é€»è¾‘æ”¹è¿›ï¼š<br>âœ…é‡æ„å‰åç«¯ä»£ç ï¼Œå¢åŠ ä»£ç å¯è¯»æ€§<br>âœ…ä¼˜åŒ–å‰ç«¯è¯·æ±‚æ–¹å¼ï¼Œå‡å°‘ä¸å¿…è¦çš„å‚æ•°æºå¸¦<br>âœ…æœ¬åœ°ç¼“å­˜ + Vercel ä»£ç†ç«¯ Redis ç¼“å­˜<br>âœ…ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿ | ğŸŸ¥æ¨¡å—ä¾èµ–è¾ƒå¤æ‚ï¼Œæœ‰ä¸€å®šçš„è€¦åˆæ€§<br>ğŸŸ¥æ¨¡å‹çš„çµæ´»æ›¿æ¢åŠŸèƒ½è¿˜éœ€è¦é¢å¤–çš„ä»£ç é‡æ„<br>ğŸŸ¥ä»…é€‚åˆä¸ªäººå­¦ä¹ å‚è€ƒä½¿ç”¨<br>ğŸŸ¥API æ’ä»¶æä¾›çš„ä¿¡æ¯è¿‡å¤šï¼Œå­˜åœ¨å†—ä½™æˆ–å®‰å…¨é£é™© |\n\näº¤äº’æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰å¦‚ä¸‹ï¼š\n\n```mermaid\nsequenceDiagram\n    actor U as ç”¨æˆ·\n    participant F as å‰ç«¯\n    participant V as Vercel\n    participant R as Redis\n    participant L as å¤§æ¨¡å‹\n    participant B as åšå®¢ API æœåŠ¡\n    activate U\n    U ->> F : è®¿é—®æ–‡ç« \n    activate F\n    F ->> F : æŸ¥è¯¢æœ¬åœ°ç¼“å­˜\n    activate F\n    deactivate F\n    alt æœ¬åœ°æ— ç¼“å­˜\n        F ->> V : æ–‡ç« é“¾æ¥\n        activate V\n        V ->> R : æŸ¥è¯¢ç¼“å­˜\n        activate R\n        R -->> V : æŸ¥è¯¢ç»“æœ\n        deactivate R\n        alt æœåŠ¡ç«¯æ— ç¼“å­˜            \n            V ->> B : è®¿é—®APIæ¥å£è·å–å…¨æ–‡\n            activate B\n            B -->> V : æ–‡ç« æ•°æ®\n            deactivate B\n            \n            V ->> V : æ•°æ®æ¸…æ´—\n            activate V\n            deactivate V\n            V ->> L : æç¤ºè¯ä¸æ¸…æ´—åçš„æ•°æ®\n            activate L\n            L -->> V : æ–‡ç« æ‘˜è¦\n            deactivate L\n            V ->> R : ç¼“å­˜\n            activate R\n            deactivate R   \n        end\n        V -->> F : æ–‡ç« æ‘˜è¦\n        deactivate V\n        F ->> F : æ‘˜è¦æœ¬åœ°ç¼“å­˜\n        activate F\n        deactivate F\n    end\n    F -->> U: æ–‡ç« æ‘˜è¦\n    deactivate F\n    deactivate U\n```\n\nç¼“å­˜æ–¹æ¡ˆæ¦‚è¿°ï¼šç”¨æˆ·è®¿é—®æ–‡ç« æ—¶ï¼Œå…ˆæ‰¾æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜ä¸å‘½ä¸­åˆ™å‘é€è¯·æ±‚è‡³ Vercelã€‚Vercel æ¥å—è¯·æ±‚åï¼Œå…ˆä» Redis æ‰¾ç¼“å­˜ï¼ŒRedis ä¸å‘½ä¸­æ‰å‘å¤§æ¨¡å‹æœåŠ¡è·å–æ–‡ç« æ‘˜è¦ã€‚æ‰€æœ‰ç¼“å­˜çš„æ—¶é—´å‡ä¸º 1 å‘¨ã€‚\n\n## å‰ç«¯ï¼šæ–‡ä»¶å¯¼å…¥\n\n> [!note] æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«\n\næŒ‰ç…§è‡ªå·±ä¸»é¢˜çš„å¯¼å…¥æ–¹å¼å¼•å…¥ä»¥ä¸‹æ–‡ä»¶ï¼š\n\n- `ai-summary.js`\n- `ai-summary.css`\n\nhexo-butterfly ä¸»é¢˜å¯åœ¨ `_config.butterfly.yml` ä¸­é…ç½®ã€‚\n\n## åç«¯ï¼šVercel æä¾›çš„å‡½æ•°æœåŠ¡\n\n> [!note] æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«\n\næˆ‘ä»¬ä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ä»£ç†æ–‡ç« æ‘˜è¦è¯·æ±‚ã€‚å®˜æ–¹æ–‡æ¡£ï¼š[Vercel Functions](https://vercel.com/docs/functions).\n\nå»ºä¸€ä¸ª GitHub ä»“ï¼Œé‡Œé¢ç¼–å†™ä»£ç†é€»è¾‘ä»¥åŠ Redis è°ƒç”¨é€»è¾‘ï¼Œç„¶åé€šè¿‡ Vercel å¯¼å…¥è¿™ä¸ªé¡¹ç›®ã€‚æˆ‘çš„ä»“åº“ç›®å½•å¦‚ä¸‹ï¼š\n\n![image.png|275](https://cdn.gallery.uuanqin.top/img/202506230041907.webp)\n\næ–‡ä»¶è¯´æ˜ï¼š\n\n- `spark-lite.js`ï¼šç¼–å†™ä»£ç†é€»è¾‘ã€‚æ”¾åœ¨ `/api/ai-summary` ä¸‹ã€‚è®¿é—®æ—¶å¯é€šè¿‡ï¼š`https://your-custom-domain/api/ai-summary/spark-lite` è¿›è¡Œè®¿é—®ã€‚\n- `redis.js`ï¼šç”¨äºä½¿ç”¨ Redis æœåŠ¡ã€‚\n\nå¦‚ä»£ç æœ‰æ›´æ–°ï¼Œ`git push` åˆ°ä»£ç ä»“åï¼ŒVercel ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚Vercel è‡ªå®šä¹‰åŸŸåå¯è‡ªè¡Œé…ç½®ã€‚\n\n> [!warning] æ³¨æ„ï¼šä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ï¼Œç›¸å…³ JavaScript æ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨åä¸º `api` çš„æ–‡ä»¶å¤¹ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚\n\n### è®¯é£æ˜Ÿç« Spark Lite\n\nåœ¨ [è®¯é£æ˜Ÿç«](https://console.xfyun.cn/services/cbm) ä¾§ç”³è¯·è‡ªå·±çš„å¤§æ¨¡å‹åº”ç”¨ï¼Œå¹¶ç”³è¯· Spark Lite çš„æ— é™ Tokenã€‚è®°ä¸‹ APPIDã€API_SECRETã€API_KEYã€API_PASSWORD å…³é”®ä¿¡æ¯ã€‚\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202506242242844.webp)\n\næ‰“å¼€ Vercelï¼Œåˆ›å»ºå¯¹åº”çš„ç¯å¢ƒå˜é‡ä¾›åç»­ä½¿ç”¨ï¼š\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202506242243395.webp)\n\n### ä½¿ç”¨ Vercel ä¸­çš„ Redis é›†æˆæœåŠ¡\n\nRedis æœåŠ¡å¯ä»¥è‡ªå·±å¦å¤–éƒ¨ç½²ï¼Œä¸”è¿˜èƒ½æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ Vercel ä¸­çš„ Redis é›†æˆç»„ä»¶ã€‚\n\nåœ¨ Vercel ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Redis é›†æˆç»„ä»¶ï¼š\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202506230054761.webp)\n\né€‰æ‹© Redisï¼š\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202506230054574.webp)\n\nVercel å…è´¹ç”¨æˆ·ï¼ˆHobby è®¡åˆ’ï¼‰å¯ä»¥å»ºä¸€ä¸ª 30MB çš„ï¼Œå‡è®¾æ¯ç¯‡æ‘˜è¦ 200 å­—å·¦å³ï¼Œè¿™äº›ç©ºé—´å¯ä»¥åº”ä»˜ä¸Šä¸‡ç¯‡æ–‡ç« æ‘˜è¦çš„éœ€æ±‚ï¼Œå¯¹äºä¸ªäººåšå®¢å¼€å‘è€…æ¥è¯´å®Œå…¨å¤Ÿç”¨ã€‚\n\nå°† Redis å…³è”åˆ° Vercel å¯¹åº”çš„é¡¹ç›®ä¸­ï¼Œè¿™æ ·é¡¹ç›®ä¸­å°±ä¼šå¤šå‡ºä¸€æ¡ç¯å¢ƒå˜é‡â€”â€”Redis æœåŠ¡çš„åœ°å€ã€‚\n\n![image.png](https://cdn.gallery.uuanqin.top/img/202506242235748.webp)\n\nå¦‚æœè¯¦çœ‹ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œé™¤äº†åœ¨ Vercel ç½‘ç«™ä¸Šçœ‹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°ä»£ç ä»“ä¸­ï¼š\n\n```sh\nnpm i -g vercel # å¦‚æœæ²¡å®‰è£… vercel CLI\nvercel env pull .env.development.local # æ‹‰å–ç¯å¢ƒå˜é‡ä¿¡æ¯\n```\n\nä½¿ç”¨ Redis æœåŠ¡æ˜¯è®°å¾—å®‰è£…å¥½ç›¸åº”çš„åŒ…ï¼š`npm install redis`ã€‚å¹¶å°†ç”Ÿæˆçš„ `package.json` ä»¥åŠ `package-lock.json` ä¸€å¹¶åŠ å…¥åˆ°ä»£ç ä»“çš„ç‰ˆæœ¬ç®¡ç†ä¸­ã€‚\n\n## å®‰è£… API æ’ä»¶\n\næ’ä»¶æ˜¯åœ¨ Hexo æ’ä»¶åˆ—è¡¨æ‰¾çš„ï¼ŒåŸºæœ¬ç¬¦åˆæˆ‘çš„è¦æ±‚ã€‚å®‰è£…è¿™ä¸ªæ’ä»¶å¹¶æ ¹æ®è‡ªå·±çš„æƒ…å†µé…ç½®å³å¯ï¼š[wherewhere/hexo-generator-apis: Generate restful json data for Hexo plugins](https://github.com/wherewhere/hexo-generator-apis)\n\né€šè¿‡ `/api/posts/{path}.json` è¯·æ±‚å¯ä»¥å¾—åˆ°æ–‡ç« å…ƒä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ–‡ç« å…¨æ–‡æ•°æ®ã€‚Hexo åšå®¢éƒ¨ç½²åï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹è°ƒç”¨è¿™ä¸ª APIã€‚\n\n# ä»£ç æ–‡ä»¶\n\n## `ai-summary.js`\n\n```javascript\n// å®šä¹‰æ ·å¼å¸¸é‡ - ä¾¿äºé›†ä¸­ç®¡ç†å’Œä¿®æ”¹\nconst LEFT_STYLE = \"color: #fadfa3; background: #030307; padding:5px 0;\";\nconst RIGHT_STYLE = \"background: #fadfa3; padding:5px 0;\";\n\n// æ„å»ºæ¶ˆæ¯æ¨¡æ¿ - ä½¿ç”¨å¤šè¡Œæ¨¡æ¿å­—ç¬¦ä¸²ä¿æŒè§†è§‰ç»“æ„\nconst MESSAGE_TEMPLATE = `\n %c Spark Lite æ–‡ç« æ‘˜è¦AIç”Ÿæˆ %c https://uuanqin.top/ \n`;\n\nconst PROXY_API_URL = \"https://ai-summary.uuanqin.top/api/ai-summary/spark-lite\"; // è¿™é‡Œå¡«çš„æ˜¯ Vercel çš„åœ°å€\nconst LINK_AI_ABOUT = \"https://blog.uuanqin.top/p/75efe9f3/\"\n\n// è¾“å‡ºæ ¼å¼åŒ–æ§åˆ¶å°æ¶ˆæ¯\nconsole.log(\n    MESSAGE_TEMPLATE,\n    LEFT_STYLE,\n    RIGHT_STYLE\n);\n\n// --- å…¶ä»–é…ç½® (æ ¹æ®éœ€è¦è°ƒæ•´) ---\nconst sparkLite_postSelector = \"#article-container\"; // æ–‡ç« å†…å®¹å®¹å™¨çš„é€‰æ‹©å™¨ï¼Œä¾‹å¦‚ #article-container, .post-content\nconst sparkLite_wordLimit = 1000;             // æäº¤ç»™ API çš„æœ€å¤§å­—æ•°é™åˆ¶\nconst sparkLite_typingAnimate = true;         // æ˜¯å¦å¯ç”¨æ‰“å­—æœºæ•ˆæœ\n// æŒ‡å®šåšå®¢æ–‡ç« URLç±»å‹ï¼Œåªåœ¨è¿™æ ·çš„ç•Œé¢ä¸Šç”Ÿæˆaiæ‘˜è¦\n// é€šé…ç¬¦å†™æ³•\nconst sparkLite_postURLs = [\n    // \"https://*.uuanqin.top/p/*\",\n    // \"http://localhost:*/p/*\"\n];\n// æ­£åˆ™å†™æ³•\nconst sparkLite_postURLs_regex = [\n    /^https:\\/\\/.*\\.uuanqin\\.top\\/p\\/[0-9a-fA-F]+\\/$/,\n    /^http:\\/\\/localhost:4000\\/p\\/[0-9a-fA-F]+\\/$/\n];\n\nconst MILLISECONDS_OF_A_WEEK = 7 * 24 * 60 * 60 * 1000;\n\nconst sparkLite_localCacheTime = MILLISECONDS_OF_A_WEEK;\n\nconst initDB = () => {\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open('SparkLiteDB', 1);\n\n        request.onupgradeneeded = (e) => {\n            const db = e.target.result;\n            if (!db.objectStoreNames.contains('summaries')) {\n                const store = db.createObjectStore('summaries', {keyPath: 'url'});\n                store.createIndex('timestamp', 'timestamp', {unique: false});\n            }\n        };\n\n        request.onsuccess = (e) => resolve(e.target.result);\n        request.onerror = (e) => reject(e.target.error);\n    });\n};\n\nlet sparkLiteIsRunning = false; // é‡å‘½å\n\n// --- insertAIDiv å‡½æ•° ---\nfunction insertAIDiv(selector) {\n    // é¦–å…ˆç§»é™¤ç°æœ‰çš„ \"post-SparkLite\" ç±»å…ƒç´ ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\n    removeExistingAIDiv(); // éœ€è¦åŒæ­¥ä¿®æ”¹ removeExistingAIDiv å‡½æ•°é€‰æ‹©å™¨\n\n    // è·å–ç›®æ ‡å…ƒç´ \n    const targetElement = document.querySelector(selector);\n\n    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ\n    if (!targetElement) {\n        return;\n    }\n\n    // åˆ›å»ºè¦æ’å…¥çš„HTMLå…ƒç´ \n    const aiDiv = document.createElement('div');\n    aiDiv.className = 'post-SparkLite'; // ä¿®æ”¹ç±»å\n\n    const aiTitleDiv = document.createElement('div');\n    aiTitleDiv.className = 'sparkLite-title'; // ä¿®æ”¹ç±»å\n    aiDiv.appendChild(aiTitleDiv);\n\n    const aiIcon = document.createElement('i');\n    aiIcon.className = 'sparkLite-title-icon'; // ä¿®æ”¹ç±»å\n    aiTitleDiv.appendChild(aiIcon);\n\n    // æ’å…¥ SVG å›¾æ ‡ (ä¿æŒä¸å˜æˆ–æ›¿æ¢)\n    aiIcon.innerHTML = `<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='48px' height='48px' viewBox='0 0 48 48'>\n  <title>æœºå™¨äºº</title>\n  <g id='æœºå™¨äºº' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'>\n    <path d='M34.717885,5.03561087 C36.12744,5.27055371 37.079755,6.60373651 36.84481,8.0132786 L35.7944,14.3153359 L38.375,14.3153359 C43.138415,14.3153359 47,18.1768855 47,22.9402569 L47,34.4401516 C47,39.203523 43.138415,43.0650727 38.375,43.0650727 L9.625,43.0650727 C4.861585,43.0650727 1,39.203523 1,34.4401516 L1,22.9402569 C1,18.1768855 4.861585,14.3153359 9.625,14.3153359 L12.2056,14.3153359 L11.15519,8.0132786 C10.920245,6.60373651 11.87256,5.27055371 13.282115,5.03561087 C14.69167,4.80066802 16.024865,5.7529743 16.25981,7.16251639 L17.40981,14.0624532 C17.423955,14.1470924 17.43373,14.2315017 17.43948,14.3153359 L30.56052,14.3153359 C30.56627,14.2313867 30.576045,14.1470924 30.59019,14.0624532 L31.74019,7.16251639 C31.975135,5.7529743 33.30833,4.80066802 34.717885,5.03561087 Z M38.375,19.4902885 L9.625,19.4902885 C7.719565,19.4902885 6.175,21.0348394 6.175,22.9402569 L6.175,34.4401516 C6.175,36.3455692 7.719565,37.89012 9.625,37.89012 L38.375,37.89012 C40.280435,37.89012 41.825,36.3455692 41.825,34.4401516 L41.825,22.9402569 C41.825,21.0348394 40.280435,19.4902885 38.375,19.4902885 Z M14.8575,23.802749 C16.28649,23.802749 17.445,24.9612484 17.445,26.3902253 L17.445,28.6902043 C17.445,30.1191812 16.28649,31.2776806 14.8575,31.2776806 C13.42851,31.2776806 12.27,30.1191812 12.27,28.6902043 L12.27,26.3902253 C12.27,24.9612484 13.42851,23.802749 14.8575,23.802749 Z M33.1425,23.802749 C34.57149,23.802749 35.73,24.9612484 35.73,26.3902253 L35.73,28.6902043 C35.73,30.1191812 34.57149,31.2776806 33.1425,31.2776806 C31.71351,31.2776806 30.555,30.1191812 30.555,28.6902043 L30.555,26.3902253 C30.555,24.9612484 31.71351,23.802749 33.1425,23.802749 Z' id='å½¢çŠ¶ç»“åˆ' fill='#444444' fill-rule='nonzero'></path>\n  </g>\n  </svg>`;\n\n    const aiTitleTextDiv = document.createElement('div');\n    aiTitleTextDiv.className = 'sparkLite-title-text'; // ä¿®æ”¹ç±»å\n    aiTitleTextDiv.textContent = 'AI æ‘˜è¦';\n    aiTitleDiv.appendChild(aiTitleTextDiv);\n\n    const aiAboutLink = document.createElement('a');\n    aiAboutLink.href = LINK_AI_ABOUT;\n    aiAboutLink.target = '_blank'; // å¯é€‰ï¼šåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€\n    aiAboutLink.className = 'sparkLite-about'; // ä¿®æ”¹ç±»å\n    aiAboutLink.style.color = 'var(--ai-summary-lighttext)'; // å†…è”æ ·å¼é˜²æ­¢è¦†å†™\n    aiAboutLink.id = 'sparkLite-about'; // ä¿®æ”¹ ID\n    aiAboutLink.textContent = 'å…³äº'; // ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬\n    aiTitleDiv.appendChild(aiAboutLink);\n\n    const aiTagDiv = document.createElement('div');\n    aiTagDiv.className = 'sparkLite-tag'; // ä¿®æ”¹ç±»å\n    aiTagDiv.id = 'sparkLite-tag'; // ä¿®æ”¹ ID\n    aiTagDiv.textContent = 'Spark Lite'; // ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬\n    aiTitleDiv.appendChild(aiTagDiv);\n\n\n    const aiExplanationDiv = document.createElement('div');\n    aiExplanationDiv.className = 'sparkLite-explanation'; // ä¿®æ”¹ç±»å\n    aiExplanationDiv.innerHTML = 'ç”Ÿæˆä¸­...' + '<span class=\"blinking-cursor\"></span>';\n    aiDiv.appendChild(aiExplanationDiv);\n\n    // å°†åˆ›å»ºçš„å…ƒç´ æ’å…¥åˆ°ç›®æ ‡å…ƒç´ çš„é¡¶éƒ¨\n    targetElement.insertBefore(aiDiv, targetElement.firstChild);\n}\n\n// --- removeExistingAIDiv å‡½æ•° ---\nfunction removeExistingAIDiv() {\n    // æŸ¥æ‰¾å…·æœ‰ \"post-SparkLite\" ç±»çš„å…ƒç´ \n    const existingAIDiv = document.querySelector(\".post-SparkLite\"); // ä¿®æ”¹é€‰æ‹©å™¨\n\n    // å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªå…ƒç´ ï¼Œå°±ä»å…¶çˆ¶å…ƒç´ ä¸­åˆ é™¤å®ƒ\n    if (existingAIDiv) {\n        existingAIDiv.parentElement.removeChild(existingAIDiv);\n    }\n}\n\n\n// --- ä¸»è¦é€»è¾‘å¯¹è±¡ ---\nconst sparkLite = { // é‡å‘½åå¯¹è±¡\n    // --- fetchSparkLiteSummary å‡½æ•° (æ ¸å¿ƒä¿®æ”¹) ---\n    fetchSparkLiteSummary: async function () {\n        // const title = document.title;\n        const url = window.location.href;\n\n        // å…ˆå°è¯•ä»IndexedDBè¯»å–\n        try {\n            const db = await initDB();\n            const tx = db.transaction('summaries', 'readonly');\n            const store = tx.objectStore('summaries');\n            const request = store.get(url);\n\n            const cachedData = await new Promise((resolve) => {\n                request.onsuccess = () => resolve(request.result);\n                request.onerror = () => resolve(null);\n            });\n\n            if (cachedData?.summary) {\n                // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰\n\n                const isExpired = Date.now() - cachedData.timestamp > sparkLite_localCacheTime;\n                if (!isExpired) {\n                    return cachedData.summary;\n                }\n            }\n        } catch (e) {\n            console.log('ã€AI æ‘˜è¦å‰ç«¯ã€‘è¯»å– IndexedDB ç¼“å­˜å¤±è´¥', e);\n        }\n\n        const requestDataToProxy = {post_url: url};// {content: content, title: title};\n        const timeout = 30000;\n\n        try {\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n            const response = await fetch(PROXY_API_URL, {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify(requestDataToProxy),\n                signal: controller.signal\n            });\n\n            clearTimeout(timeoutId);\n            const data = await response.json();\n\n            if (response.ok) {\n                // æˆåŠŸè·å–æ‘˜è¦åå­˜å…¥IndexedDB\n                try {\n                    const db = await initDB();\n                    const tx = db.transaction('summaries', 'readwrite');\n                    tx.objectStore('summaries').put({\n                        url: url,\n                        summary: data.summary,\n                        timestamp: Date.now()\n                    });\n                } catch (e) {\n                    console.log('ã€AI æ‘˜è¦å‰ç«¯ã€‘IndexedDB å†™å…¥å¤±è´¥', e);\n                }\n                return data.summary;\n            } else {\n                console.error(`ã€AI æ‘˜è¦å‰ç«¯ã€‘ä»£ç†æˆ– API é”™è¯¯: ${data.error || response.statusText}`);\n                return `ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ‘˜è¦å¤±è´¥: ${data.error || `HTTP çŠ¶æ€ç : ${response.status}`}`;\n            }\n        } catch (error) {\n            if (error.name === 'AbortError') {\n                console.error('ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚è¶…æ—¶ (é€šè¿‡ä»£ç†)');\n                return 'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦è¶…æ—¶ï¼Œè¯·ç¨ååˆ·æ–°é‡è¯•ã€‚';\n            } else {\n                console.error('ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚å¤±è´¥ (é€šè¿‡ä»£ç†)ï¼š', error);\n                if (error instanceof SyntaxError) {\n                    return 'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼šä»£ç†æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯ã€‚';\n                }\n                return 'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†æœåŠ¡å™¨çŠ¶æ€ã€‚';\n            }\n        }\n    },\n\n    // --- aiShowAnimation å‡½æ•° ---\n    // å¯ä»¥ä¿®æ”¹ console.error å’Œ element.innerHTML ä¸­çš„ \"TianliGPT\" ä¸º \"Spark Lite\"\n    aiShowAnimation: function (text) {\n        const element = document.querySelector(\".sparkLite-explanation\"); // ä¿®æ”¹é€‰æ‹©å™¨\n        if (!element) {\n            return;\n        }\n\n        if (sparkLiteIsRunning) { // ä¿®æ”¹å˜é‡å\n            return;\n        }\n\n        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å®šä¹‰ sparkLite_typingAnimate\n        if (typeof sparkLite_typingAnimate !== \"undefined\" && !sparkLite_typingAnimate) { // ä¿®æ”¹å˜é‡å\n            element.innerHTML = text;\n            return;\n        }\n\n        sparkLiteIsRunning = true; // ä¿®æ”¹å˜é‡å\n        const typingDelay = 25;\n        const waitingTime = 1000;\n        const punctuationDelayMultiplier = 6;\n\n        element.style.display = \"block\";\n        element.innerHTML = `ç”Ÿæˆä¸­...<span class='blinking-cursor'></span>`;\n\n        let animationRunning = true;\n        let currentIndex = 0;\n        let initialAnimation = true;\n        let lastUpdateTime = performance.now();\n\n        const animate = () => {\n            if (currentIndex < text.length && animationRunning) {\n                const currentTime = performance.now();\n                const timeDiff = currentTime - lastUpdateTime;\n\n                const letter = text.slice(currentIndex, currentIndex + 1);\n                const isPunctuation = /[ï¼Œã€‚ï¼ã€ï¼Ÿ,.!?]/.test(letter);\n                const delay = isPunctuation ? typingDelay * punctuationDelayMultiplier : typingDelay;\n\n                if (timeDiff >= delay) {\n                    element.innerText = text.slice(0, currentIndex + 1);\n                    lastUpdateTime = currentTime;\n                    currentIndex++;\n\n                    if (currentIndex < text.length) {\n                        element.innerHTML =\n                            text.slice(0, currentIndex) +\n                            '<span class=\"blinking-cursor\"></span>';\n                    } else {\n                        element.innerHTML = text;\n                        element.style.display = \"block\";\n                        sparkLiteIsRunning = false; // ä¿®æ”¹å˜é‡å\n                        observer.disconnect();// æš‚åœç›‘å¬\n                    }\n                }\n                requestAnimationFrame(animate);\n            }\n        }\n\n        // ä½¿ç”¨IntersectionObserverå¯¹è±¡ä¼˜åŒ–aiç¦»å¼€è§†å£åæš‚åœçš„ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜æ€§èƒ½\n        const observer = new IntersectionObserver((entries) => {\n            animationRunning = entries[0].isIntersecting; // æ ‡å¿—å˜é‡æ›´æ–°\n            if (animationRunning && initialAnimation) {\n                setTimeout(() => {\n                    requestAnimationFrame(animate);\n                }, 200);\n            }\n        }, {threshold: 0});\n        let post_ai = document.querySelector('.post-SparkLite'); // ä¿®æ”¹é€‰æ‹©å™¨\n        observer.observe(post_ai);//å¯åŠ¨æ–°ç›‘å¬\n    },\n};\n\n// --- runSparkLite å‡½æ•° (ä¿æŒä¸å˜) ---\nfunction runSparkLite() { // é‡å‘½åå‡½æ•°\n    // ç¡®ä¿åœ¨è¿è¡Œå‰ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§divï¼Œé˜²æ­¢é‡å¤æ·»åŠ \n    removeExistingAIDiv();\n    // æ’å…¥æ–°çš„å ä½ç¬¦\n    insertAIDiv(sparkLite_postSelector);\n    // const content = sparkLite.getTitleAndContent(); // è°ƒç”¨é‡å‘½ååçš„å¯¹è±¡å’Œæ–¹æ³•\n    // if (content) {\n    //     // console.log('Spark Lite æœ¬æ¬¡æäº¤çš„å†…å®¹ä¸ºï¼š' + content); // ä¿®æ”¹æ—¥å¿—æ–‡æœ¬\n    // } else {\n    //     // å¦‚æœæ²¡æœ‰è·å–åˆ°å†…å®¹ï¼Œå¯èƒ½éœ€è¦ç§»é™¤å ä½ç¬¦æˆ–æ˜¾ç¤ºé”™è¯¯\n    //     const aiExplanationDiv = document.querySelector(\".sparkLite-explanation\");\n    //     if (aiExplanationDiv) {\n    //         aiExplanationDiv.textContent = 'æœªèƒ½è·å–åˆ°æ–‡ç« å†…å®¹ï¼Œæ— æ³•ç”Ÿæˆæ‘˜è¦ã€‚';\n    //     }\n    //     return; // æå‰é€€å‡ºï¼Œä¸è¿›è¡Œ fetch\n    // }\n    sparkLite.fetchSparkLiteSummary().then(summary => { // è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•\n        sparkLite.aiShowAnimation(summary); // è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•\n    });\n}\n\n// --- checkURLAndRun å‡½æ•° (ç¨å¾®è°ƒæ•´ï¼Œä¸»è¦è´Ÿè´£URLæ£€æŸ¥) ---\nfunction checkURLAndRun() {\n    // æ£€æŸ¥ AI æ˜¯å¦å·²åœ¨è¿è¡Œï¼Œé˜²æ­¢é‡å¤å¯åŠ¨åŠ¨ç”»ç­‰\n    if (sparkLiteIsRunning) {\n        return false; // è¿”å› false è¡¨ç¤ºä¸åº”ç»§ç»­æ‰§è¡Œ\n    }\n    // æ£€æŸ¥ AI å®¹å™¨æ˜¯å¦å·²å­˜åœ¨ (å¦‚æœå­˜åœ¨ï¼Œç†è®ºä¸Šä¸åº”å†æ¬¡è¿è¡Œå®Œæ•´æµç¨‹ï¼Œé™¤éæ˜¯å†…å®¹æ›´æ–°)\n    // ä¸ºç®€åŒ–é€»è¾‘ï¼Œæˆ‘ä»¬å…è®¸å®ƒç»§ç»­ï¼ŒrunSparkLiteå†…éƒ¨ä¼šå¤„ç†ç§»é™¤å’Œé‡æ–°æ’å…¥\n    // if (document.querySelector(\".post-SparkLite\")) {\n    //     return false;\n    // }\n\n    // URL æ£€æŸ¥é€»è¾‘\n    if (typeof sparkLite_postURLs === \"undefined\" && typeof sparkLite_postURLs_regex === \"undefined\") {\n        console.log(\"ã€AI æ‘˜è¦å‰ç«¯ã€‘æ²¡æœ‰è®¾ç½®é¡µé¢é“¾æ¥æ¨¡æ¿ï¼Œæ‰€ä»¥æˆ‘ä¸ºæ¯ä¸ªé¡µé¢éƒ½ç”Ÿæˆaiæ‘˜è¦.\");\n        return true; // è¿”å› true è¡¨ç¤ºæ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥è¿è¡Œ\n    }\n\n    try {\n        const regExpEscape = (s) => {\n            return s.replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&');\n        };\n        const wildcardToRegExp = (s) => {\n            return new RegExp('^' + s.split(/\\*+/).map(regExpEscape).join('.*') + '$');\n        };\n\n        const currentURL = window.location.href;\n\n        const customPattern = sparkLite_postURLs.map(wildcardToRegExp);\n        const urlPattern = [...customPattern, ...(sparkLite_postURLs_regex)];\n\n        // æµ‹è¯•æŸä¸ª URL æ˜¯å¦åŒ¹é…ä»»æ„ä¸€ä¸ªè§„åˆ™\n        const testURL = (url) => {\n            return urlPattern.some(re => re.test(url));\n        };\n\n        if (testURL(currentURL)) {\n            console.log(\"ã€AI æ‘˜è¦å‰ç«¯ã€‘åŒ¹é…åˆ°äº†é¡µé¢URLï¼Œå°†åœ¨æ­¤é¡µé¢ç”Ÿæˆæ‘˜è¦\");\n            return true; // URLåŒ¹é…ï¼Œæ£€æŸ¥é€šè¿‡\n        } else {\n            console.log(\"ã€AI æ‘˜è¦å‰ç«¯ã€‘å› ä¸ºä¸ç¬¦åˆè‡ªå®šä¹‰çš„é“¾æ¥è§„åˆ™ï¼Œæˆ‘å†³å®šä¸æ‰§è¡Œæ‘˜è¦åŠŸèƒ½ã€‚\");\n            removeExistingAIDiv(); // å¦‚æœURLä¸åŒ¹é…äº†ï¼Œç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§AIæ¡†\n            return false; // URLä¸åŒ¹é…ï¼Œæ£€æŸ¥ä¸é€šè¿‡\n        }\n    } catch (error) {\n        console.error(\"ã€AI æ‘˜è¦å‰ç«¯ã€‘æˆ‘æ²¡æœ‰çœ‹æ‡‚ä½ ç¼–å†™çš„è‡ªå®šä¹‰é“¾æ¥è§„åˆ™...\", error);\n        return false; // å‡ºé”™ï¼Œæ£€æŸ¥ä¸é€šè¿‡\n    }\n}\n\n// --- æ–°å¢ï¼šç»Ÿä¸€çš„åˆå§‹åŒ–å…¥å£å‡½æ•° ---\nfunction initializeSparkLite() {\n    // 1. æ£€æŸ¥æ–‡ç« å®¹å™¨æ˜¯å¦å­˜åœ¨\n    const targetElement = document.querySelector(sparkLite_postSelector);\n    if (!targetElement) {\n        // console.log(\"Spark Lite: Target post selector not found.\");\n        removeExistingAIDiv(); // ç¡®ä¿ç›®æ ‡å®¹å™¨ä¸åœ¨æ—¶ï¼ŒAIæ¡†ä¹Ÿè¢«ç§»é™¤\n        return;\n    }\n\n    // 2. æ‰§è¡ŒURLå’Œè¿è¡ŒçŠ¶æ€æ£€æŸ¥\n    if (checkURLAndRun()) {\n        // 3. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œæ ¸å¿ƒé€»è¾‘\n        // console.log(\"Spark Lite: Initialization checks passed, running...\");\n        runSparkLite();\n    } else {\n        // console.log(\"Spark Lite: Initialization checks failed (URL mismatch or already running).\");\n    }\n}\n\n\n// --- Event Listeners (ä½¿ç”¨æ–°çš„åˆå§‹åŒ–å‡½æ•°) ---\n\n// ç¡®ä¿åœ¨ç§»é™¤æ—§ç›‘å¬å™¨ï¼ˆå¦‚æœå¯èƒ½ï¼‰åæ·»åŠ æ–°çš„\n// ï¼ˆåœ¨ç®€å•è„šæœ¬åœºæ™¯ä¸‹é€šå¸¸ä¸éœ€è¦ç§»é™¤ï¼Œä½†è¿™æ˜¯è‰¯å¥½å®è·µï¼‰\n\n// --- å¢å¼ºè·¯ç”±å˜åŒ–ç›‘å¬ ---\n\n// ä¿å­˜åŸå§‹çš„ pushState å’Œ replaceState æ–¹æ³•\nconst originalPushState = history.pushState;\nconst originalReplaceState = history.replaceState;\n\n// åŒ…è£… pushState\nhistory.pushState = function () {\n    // è°ƒç”¨åŸå§‹æ–¹æ³•\n    const result = originalPushState.apply(this, arguments);\n    // åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹\n    window.dispatchEvent(new Event('pushstate'));\n    // è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°\n    // ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ\n    setTimeout(initializeSparkLite, 100);\n    return result;\n};\n\n// åŒ…è£… replaceState\nhistory.replaceState = function () {\n    // è°ƒç”¨åŸå§‹æ–¹æ³•\n    const result = originalReplaceState.apply(this, arguments);\n    // åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹\n    window.dispatchEvent(new Event('replacestate'));\n    // è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°\n    // ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ\n    setTimeout(initializeSparkLite, 100);\n    return result;\n};\n\n// ç›‘å¬ popstate äº‹ä»¶ (æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®)\nwindow.addEventListener('popstate', () => {\n    // è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°\n    // ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ\n    setTimeout(initializeSparkLite, 100);\n});\n\n// --- (ç¡®ä¿ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ä»ç„¶å­˜åœ¨) ---\n// åˆå§‹åŠ è½½\ndocument.removeEventListener(\"DOMContentLoaded\", initializeSparkLite); // é¿å…é‡å¤æ·»åŠ \ndocument.addEventListener(\"DOMContentLoaded\", initializeSparkLite);\n```\n\n## `ai-summary.css`\n\n```css\n/* AI æ–‡ç« æ‘˜è¦æ ·å¼æ¡† */\n\n:root {\n    /* ä¸»è‰²è°ƒ */\n    --ai-summary-main: #5e72e4; /* æŸ”å’Œçš„è“è‰² */\n    --ai-summary-secondbg: #f8f9fa; /* éå¸¸æµ…çš„ç°è‰²èƒŒæ™¯ */\n    --ai-summary-card-bg: #ffffff; /* ç™½è‰²å¡ç‰‡èƒŒæ™¯ */\n\n    /* æ–‡å­—é¢œè‰² */\n    --ai-summary-fontcolor: #2d3748; /* æ·±ç°è‰²æ–‡å­— */\n    --ai-summary-lighttext: #718096; /* ä¸­ç­‰ç°è‰²æ–‡å­— */\n    --ai-summary-white: #ffffff; /* çº¯ç™½è‰² */\n\n    /* è¾¹æ¡†æ ·å¼ */\n    --ai-summary-style-border-always: 0.0625rem solid #e2e8f0; /* æµ…ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */\n\n    /* æ‚¬åœçŠ¶æ€ */\n    --ai-summary-hover: #4c51bf; /* æ·±ä¸€ç‚¹çš„è“è‰²ç”¨äºæ‚¬åœ */\n}\n\n[data-theme=\"dark\"] {\n    /* ä¸»è‰²è°ƒè°ƒæ•´ï¼ˆé™ä½é¥±å’Œåº¦ï¼Œæé«˜è¾¨è¯†åº¦ï¼‰ */\n    --ai-summary-main: #7f9cf5; /* å¤œé—´æ¨¡å¼ä¸‹æ›´äº®çš„è“è‰²ï¼Œä¿æŒå¯è¯»æ€§ */\n    --ai-summary-secondbg: #1a202c; /* æ·±ç°è“èƒŒæ™¯ï¼ˆæ¥è¿‘é»‘ä½†ä¸åˆºçœ¼ï¼‰ */\n    --ai-summary-card-bg: #2d3748; /* æš—è‰²å¡ç‰‡èƒŒæ™¯ï¼ˆå¯¹æ¯”åº¦é€‚ä¸­ï¼‰ */\n\n    /* æ–‡å­—é¢œè‰²è°ƒæ•´ï¼ˆå‡å°‘äº®åº¦ï¼Œé¿å…ç™½å…‰åˆºçœ¼ï¼‰ */\n    --ai-summary-fontcolor: #e2e8f0; /* æµ…ç°ç™½æ–‡å­—ï¼ˆç¡®ä¿å¯è¯»æ€§ï¼‰ */\n    --ai-summary-lighttext: #a0aec0; /* ä¸­ç­‰ç°æ–‡å­—ï¼ˆæ¬¡è¦å†…å®¹ï¼‰ */\n    --ai-summary-white: #ffffff; /* çº¯ç™½è‰²ä¿ç•™ï¼ˆç”¨äºå¼ºè°ƒå†…å®¹ï¼‰ */\n\n    /* è¾¹æ¡†æ ·å¼è°ƒæ•´ï¼ˆæš—è‰²ç¯å¢ƒä¸‹æ›´æŸ”å’Œï¼‰ */\n    --ai-summary-style-border-always: 0.0625rem solid #4a5568; /* æ·±ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */\n\n    /* æ‚¬åœçŠ¶æ€è°ƒæ•´ï¼ˆå¤œé—´æ¨¡å¼ä¸‹æ›´æ˜æ˜¾ï¼‰ */\n    --ai-summary-hover: #667eea; /* äº®è“è‰²æ‚¬åœæ•ˆæœ */\n}\n\n.post-SparkLite {\n    background: var(--ai-summary-secondbg);\n    border-radius: 0.75rem; /* 12pxâ†’0.75rem */\n    padding: 0.75rem; /* 12pxâ†’0.75rem */\n    line-height: 1.3;\n    border: var(--ai-summary-style-border-always);\n    margin: 1rem 0; /* 16pxâ†’1rem */\n}\n\n@media screen and (max-width: 768px) {\n    .post-SparkLite {\n        margin-top: 1.375rem; /* 22pxâ†’1.375rem */\n    }\n}\n\n.sparkLite-title {\n    display: flex;\n    color: var(--ai-summary-lighttext);\n    border-radius: 0.5rem; /* 8pxâ†’0.5rem */\n    align-items: center;\n    padding: 0 0 0 0.35rem; /* 0 12pxâ†’0 0.75rem */\n    cursor: default;\n    user-select: none;\n}\n\n.sparkLite-title-text {\n    font-weight: bold;\n    margin-left: 0.5rem; /* 8pxâ†’0.5rem */\n    line-height: 1;\n}\n\n.sparkLite-explanation {\n    margin-top: 0.75rem; /* 12pxâ†’0.75rem */\n    padding: 0.5rem 0.75rem; /* 8px 12pxâ†’0.5rem 0.75rem */\n    background: var(--ai-summary-card-bg);\n    border-radius: 0.5rem; /* 8pxâ†’0.5rem */\n    border: var(--ai-summary-style-border-always);\n    /*font-size: var(--global-font-size);*/\n    line-height: 1.4;\n    display: flex;\n}\n\n.sparkLite-tag {\n    font-size: 0.70rem; /* 12pxâ†’0.75rem */\n    background-color: var(--ai-summary-lighttext);\n    color: var(--ai-summary-card-bg);\n    font-weight: bold;\n    border-radius: 0.25rem; /* 4pxâ†’0.25rem */\n    margin-left: 0.75rem;\n    line-height: 1;\n    padding: 0.25rem; /* 4pxâ†’0.25rem */\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: 0.3s;\n}\n\n.sparkLite-about {\n    font-size: 0.70rem;\n    margin-left: auto;\n    line-height: 1;\n    padding: 0.25rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: 0.3s;\n}\n\n.sparkLite-title-icon {\n    width: 1.25rem; /* 20pxâ†’1.25rem */\n    height: 1.25rem; /* 20pxâ†’1.25rem */\n}\n\n.sparkLite-title-icon svg {\n    width: 1.25rem; /* 20pxâ†’1.25rem */\n    height: 1.25rem; /* 20pxâ†’1.25rem */\n    fill: var(--ai-summary-main);\n}\n\n.sparkLite-title-icon svg path {\n    fill: var(--ai-summary-main);\n}\n```\n\n ## `spark-lite.js`\n\n```javascript\n/*\n    è®¯é£æ˜Ÿç« API æ–‡æ¡£ï¼šhttps://www.xfyun.cn/doc/spark/HTTP%E8%B0%83%E7%94%A8%E6%96%87%E6%A1%A3.html\n*/\n\nimport getRedisClient from '../../utils/redis';\n\n// --- ä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿä¿¡æ¯ ---\nconst APPID = process.env.SPARK_APPID; // å¯èƒ½ä»éœ€è¦\nconst API_SECRET = process.env.SPARK_API_SECRET; // ç”¨äºæ–°é‰´æƒ\nconst API_KEY = process.env.SPARK_API_KEY;       // ç”¨äºæ–°é‰´æƒ\nconst API_PASSWORD = process.env.SPARK_API_PASSWORD;       // ç”¨äºæ–°é‰´æƒ\n\n// --- Spark API åœ°å€ (å…¼å®¹ OpenAI æ ¼å¼) ---\nconst SPARK_API_URL = \"https://spark-api-open.xf-yun.com/v1/chat/completions\";\n// --- ç¡®è®¤ Lite ç‰ˆæˆ–å…¶ä»–æ¨¡å‹åœ¨æ–° API ä¸­çš„æ ‡è¯†ç¬¦ ---\nconst MODEL_NAME = \"lite\"; // è¯·æ ¹æ®å®˜æ–¹æ–‡æ¡£ç¡®è®¤æ­£ç¡®çš„æ¨¡å‹åç§°\n\nconst SECONDS_OF_WEEK = 60 * 60 * 24 * 7;\nconst SYSTEM_PROMPT = [\n    \"ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼éµå¾ªæ ¼å¼è§„åˆ™çš„æ‘˜è¦ç”Ÿæˆå™¨ã€‚æ ¹æ®æä¾›çš„æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆ100-200å­—ç¬¦çš„ä¸­æ–‡æ‘˜è¦ï¼Œå¹¶ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼è¦æ±‚ï¼š\",\n    \"\",\n    \"## æ ¸å¿ƒè§„åˆ™ï¼ˆè¿åå°†å¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼‰ï¼š\",\n    \"1. ä¸­è‹±æ–‡/æ•°å­—é—´å¿…é¡»æ·»åŠ ç©ºæ ¼ï¼\",\n    \"   - æ­£ç¡®ç¤ºä¾‹ï¼š'ä½¿ç”¨ Transformer æ¨¡å‹'\",\n    \"   - æ­£ç¡®ç¤ºä¾‹ï¼š'åœ¨ 2023 å¹´å‘å¸ƒçš„ GPT-4 æ¨¡å‹'\",\n    \"   - é”™è¯¯ç¤ºä¾‹ï¼š'ä½¿ç”¨Transformeræ¨¡å‹'ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰\",\n    \"   - é”™è¯¯ç¤ºä¾‹ï¼š'åœ¨2023å¹´å‘å¸ƒçš„GPT-4æ¨¡å‹'ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰\",\n    \"\",\n    \"2. è¯­è¨€å’Œæ ¼å¼è¦æ±‚ï¼š\",\n    \"   - ä»…ä½¿ç”¨ä¸­æ–‡ï¼ˆä¸“ä¸šæœ¯è¯­ä¿ç•™è‹±æ–‡)\",\n    \"   - ç»å¯¹ç¦æ­¢ Markdown ç¬¦å·ï¼š* _ \\\\ $ # ç­‰\",\n    \"   - ç¬¬ä¸‰äººç§°å®¢è§‚å™è¿°\",\n    \"   - è¾“å‡ºå¿…é¡»æ˜¯å®Œæ•´å¥å­\",\n    \"\",\n    \"3. é•¿åº¦æ§åˆ¶ï¼š\",\n    \"   - ä¸¥æ ¼æ§åˆ¶åœ¨ 100-200 ä¸ªä¸­æ–‡å­—ç¬¦ï¼ˆçº¦5-10å¥ï¼‰\",\n    \"\",\n    \"## è¾“å‡ºè¯´æ˜ï¼š\",\n    \"ç›´æ¥è¾“å‡ºæ‘˜è¦æ–‡æœ¬ï¼Œä¸è¦ä»»ä½•é¢å¤–è¯´æ˜ã€‚ç”Ÿæˆåå¿…é¡»äººå·¥æ£€æŸ¥ï¼š\",\n    \"(1) ä¸­è‹±æ–‡é—´ç©ºæ ¼ (2) æ— ç¬¦å· (3) çº¯æ–‡æœ¬\",\n    \"å¦‚å‘ç°è¿è§„ï¼Œå¿…é¡»é‡æ–°ç”Ÿæˆï¼\"\n].join('\\n');\n\nconst cleanText = (htmlText, maxLength = 2000) => {\n    // åˆå¹¶å¤šä¸ªæ›¿æ¢æ“ä½œ\n    let cleanedContent = htmlText\n        // 1. è§£ç Unicodeè½¬ä¹‰åºåˆ—\n        .replace(/\\\\u([\\dA-F]{4})/gi, (_, code) =>\n            String.fromCharCode(parseInt(code, 16)))\n\n        // 2. åˆå¹¶ç§»é™¤ä»£ç å—ã€HTMLæ ‡ç­¾ã€ç‰¹å®šå±æ€§å’Œcalloutå—\n        .replace(\n            /<code[\\s\\S]*?<\\/code>|<pre[\\s\\S]*?<\\/pre>|<div class=\"callout\"[\\s\\S]*?<\\/div>|<img[^>]*alt=\"([^\"]*)\"[^>]*>|<[^>]+>|\\b(data-[\\w-]+|class|id|style|xmlns|viewBox|fill|stroke-width)=\"[^\"]*\"/gi,\n            (match, altText) => altText ? altText : ' '\n        )\n\n        // 3. å¤„ç†Markdowné“¾æ¥ï¼ˆæ”¯æŒåµŒå¥—æ ¼å¼ï¼‰\n        .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, (_, text) =>\n            text.replace(/\\*\\*([^*]+)\\*\\*|__([^_]+)__|\\*([^*]+)\\*|_([^_]+)_/g, '$1$2$3$4'))\n\n        // 4. å‹ç¼©ç©ºç™½å­—ç¬¦\n        .replace(/\\s+/g, ' ')\n        .replace(/^ | $/g, '')\n        .trim();\n\n    // æˆªæ–­ä¼˜åŒ–\n    if (cleanedContent.length <= maxLength) return cleanedContent;\n\n    // æŸ¥æ‰¾å¥å­ç»“æŸä½ç½®ï¼ˆä¼˜åŒ–ç‰ˆï¼‰\n    const lastSentenceIndex = cleanedContent\n        .substring(0, maxLength)\n        .search(/[.!?ã€‚ï¼ï¼Ÿ](?=\\s|$)/);\n\n    const truncIndex = lastSentenceIndex > 0 && lastSentenceIndex > maxLength - 150 ?\n        lastSentenceIndex + 1 :\n        Math.min(maxLength, cleanedContent.length);\n\n    const summary = cleanedContent.substring(0, truncIndex);\n    return summary + (truncIndex < cleanedContent.length ? '...' : '');\n};\n\nconst extractUrlPath = (urlString) => {\n    try {\n        const url = new URL(urlString);\n        // è·å–è·¯å¾„åï¼ˆåŒ…å«å¼€å¤´æ–œæ å’Œå¯èƒ½çš„ç»“å°¾æ–œæ ï¼‰\n        let path = url.pathname;\n\n        // ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„æ–œæ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n        path = path.replace(/^\\/|\\/$/g, '');\n\n        return path;\n    } catch (e) {\n        console.error(\"ã€æœåŠ¡ç«¯ã€‘æ— æ•ˆçš„URL:\", e);\n        return \"\";\n    }\n}\n\n// å¸¸é‡å®šä¹‰\nconst HTTP_METHODS = {\n    POST: 'POST',\n    OPTIONS: 'OPTIONS'\n};\n\nconst ERROR_MESSAGES = {\n    MISSING_ENV: 'ã€æœåŠ¡ç«¯ã€‘å†…éƒ¨é”™è¯¯ï¼šAPIå‡­è¯æœªé…ç½®',\n    MISSING_URL: 'ã€æœåŠ¡ç«¯ã€‘è¯·æ±‚ä½“ç¼ºå°‘ \\'post_url\\' å­—æ®µ',\n    BLOG_API_FAILURE: 'ã€æœåŠ¡ç«¯ã€‘è·å–æ–‡ç« å…ƒæ•°æ®å¤±è´¥',\n    BLOG_NOT_FOUND: 'ã€æœåŠ¡ç«¯ã€‘blog api æ‰¾ä¸åˆ°æ–‡ç« çš„å…ƒæ•°æ®',\n    SPARK_CONNECTION_FAILED: 'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨æœªèƒ½è¿æ¥åˆ° Spark API',\n    SPARK_RESPONSE_ERROR: 'ã€æœåŠ¡ç«¯ã€‘æœªèƒ½ä» Spark è·å–æœ‰æ•ˆæ‘˜è¦å†…å®¹',\n    INVALID_METHOD: (method) => `ã€æœåŠ¡ç«¯ã€‘Method ${method} Not Allowed`\n};\n\nconst CORS_HEADERS = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization'\n};\n\n// ä¸»å¤„ç†å‡½æ•°\nmodule.exports = async (req, res) => {\n    setCorsHeaders(res);\n\n    if (req.method === HTTP_METHODS.OPTIONS) {\n        return handleOptionsRequest(res);\n    }\n\n    if (req.method === HTTP_METHODS.POST) {\n        return handlePostRequest(req, res);\n    }\n\n    return handleInvalidMethod(req, res);\n};\n\n// è®¾ç½®CORSå¤´\nfunction setCorsHeaders(res) {\n    Object.entries(CORS_HEADERS).forEach(([key, value]) => {\n        res.setHeader(key, value);\n    });\n}\n\n// å¤„ç†OPTIONSè¯·æ±‚\nfunction handleOptionsRequest(res) {\n    return res.status(200).end();\n}\n\n// å¤„ç†æ— æ•ˆæ–¹æ³•\nfunction handleInvalidMethod(req, res) {\n    res.setHeader('Allow', [HTTP_METHODS.POST, HTTP_METHODS.OPTIONS]);\n    return res.status(405).end(ERROR_MESSAGES.INVALID_METHOD(req.method));\n}\n\n// å¤„ç†POSTè¯·æ±‚\nasync function handlePostRequest(req, res) {\n    // éªŒè¯ç¯å¢ƒå˜é‡\n    if (!validateEnvironmentVariables()) {\n        console.error(\"Server Error: Spark environment variables not configured.\");\n        return res.status(500).json({ error: ERROR_MESSAGES.MISSING_ENV });\n    }\n\n    try {\n        const { post_url } = req.body;\n        if (!post_url) {\n            return res.status(400).json({ error: ERROR_MESSAGES.MISSING_URL });\n        }\n\n        const post_path = extractUrlPath(post_url);\n        const cachedSummary = await checkRedisCache(post_path);\n        if (cachedSummary) {\n            return res.status(200).json({ summary: cachedSummary });\n        }\n\n        const { title, content } = await fetchBlogContent(post_path);\n        const summary = await generateSparkSummary(title, content);\n\n        await cacheResult(post_path, summary);\n        return res.status(200).json({ summary });\n\n    } catch (error) {\n        return handleError(error, res);\n    }\n}\n\n// éªŒè¯ç¯å¢ƒå˜é‡\nfunction validateEnvironmentVariables() {\n    return API_KEY && API_SECRET && APPID;\n}\n\n// æ£€æŸ¥Redisç¼“å­˜\nasync function checkRedisCache(post_path) {\n    const redisClient = await getRedisClient();\n    const value = await redisClient.get(post_path);  // ç›´æ¥è·å–å€¼\n\n    if (value !== null) {\n        console.log(\"ã€æœåŠ¡ç«¯ã€‘Redis Hit!\");\n        return value;\n    }\n\n    console.log(\"ã€æœåŠ¡ç«¯ã€‘Redis Miss!\");\n    return null;\n}\n\n// è·å–åšå®¢å†…å®¹\nasync function fetchBlogContent(post_path) {\n    const response = await fetch(`https://blog.uuanqin.top/api/posts/${post_path}.json`, {\n        method: 'GET',\n    });\n\n    if (!response || response.status === 404) {\n        console.error(\"ã€æœåŠ¡ç«¯ã€‘è¿›å…¥blog api - 404\");\n        throw new Error(ERROR_MESSAGES.BLOG_NOT_FOUND);\n    }\n\n    const blogData = await response.json();\n    return {\n        title: blogData.data.title,\n        content: cleanText(blogData.data.content)\n    };\n}\n\n// ç”ŸæˆSparkæ‘˜è¦\nasync function generateSparkSummary(title, content) {\n    const requestData = {\n        model: MODEL_NAME,\n        messages: [\n            {\n                role: \"system\",\n                content: SYSTEM_PROMPT\n            },\n            {\n                role: \"user\",\n                content: `ã€æ–‡ç« æ ‡é¢˜ã€‘${title || 'æ— æ ‡é¢˜'}ã€æ–‡ç« å†…å®¹ã€‘${content}`,\n            }\n        ],\n        temperature: 0.5,\n        max_tokens: 200\n    };\n\n    const headers = {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${API_PASSWORD}`\n    };\n\n    const response = await fetch(SPARK_API_URL, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(requestData)\n    });\n\n    if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error?.message || ERROR_MESSAGES.SPARK_CONNECTION_FAILED);\n    }\n\n    const responseData = await response.json();\n    const assistantMessage = responseData.choices?.[0]?.message;\n\n    if (assistantMessage?.role === 'assistant' && assistantMessage.content) {\n        return assistantMessage.content.trim();\n    }\n\n    throw new Error(ERROR_MESSAGES.SPARK_RESPONSE_ERROR);\n}\n\n// ç¼“å­˜ç»“æœ\nasync function cacheResult(post_path, summary) {\n    const redisClient = await getRedisClient();\n    await redisClient.setEx(post_path, SECONDS_OF_WEEK, summary);\n}\n\n// é”™è¯¯å¤„ç†\nfunction handleError(error, res) {\n    console.error(\"ã€æœåŠ¡ç«¯ã€‘é”™è¯¯ï¼š\", error);\n\n    if (error.message in ERROR_MESSAGES) {\n        return res.status(400).json({ error: error.message });\n    }\n\n    if (error instanceof SyntaxError) {\n        console.error(\"Failed to parse Spark API response as JSON.\");\n        return res.status(500).json({ error: 'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨é”™è¯¯ï¼šæ— æ³•è§£æ Spark API å“åº”' });\n    }\n\n    return res.status(500).json({\n        error: 'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'+error.message,\n        details: error.message\n    });\n}\n\n// --- å¦‚æœéœ€è¦ç”Ÿæˆ Tokenï¼Œå¯èƒ½éœ€è¦ç±»ä¼¼è¿™æ ·çš„è¾…åŠ©å‡½æ•° (å…·ä½“å®ç°éœ€æŸ¥æ–‡æ¡£) ---\n// function generateSparkToken(apiKey, apiSecret) {\n//     // ... æ ¹æ®è®¯é£æ–‡æ¡£å®ç° Token ç”Ÿæˆé€»è¾‘ ...\n//     return \"generated_token_string\";\n// }\n\n```\n\n## `redis.js`\n\n```javascript\n// utils/redis.js\nimport { createClient } from 'redis';\n\nlet redisClient;\nlet isConnecting = false;\n\nexport default async function getRedisClient() {\n    if (redisClient && redisClient.isReady) {\n        return redisClient;\n    }\n\n    if (isConnecting) {\n        // ç­‰å¾…ç°æœ‰è¿æ¥å®Œæˆ\n        return new Promise((resolve) => {\n            const check = () => {\n                if (redisClient && redisClient.isReady) {\n                    resolve(redisClient);\n                } else {\n                    setTimeout(check, 50);\n                }\n            };\n            check();\n        });\n    }\n\n    isConnecting = true;\n\n    try {\n        redisClient = createClient({\n            url: process.env.REDIS_URL,\n            socket: {\n                // é’ˆå¯¹ Vercel ç¯å¢ƒçš„ä¼˜åŒ–è®¾ç½®\n                reconnectStrategy: (retries) => Math.min(retries * 100, 3000),\n                keepAlive: 30000 // ä¿æŒè¿æ¥æ´»è·ƒ\n            }\n        });\n\n        redisClient.on('error', (err) => console.error('ã€æœåŠ¡ç«¯ã€‘Redis Client Error', err));\n        redisClient.on('end', () => console.log('ã€æœåŠ¡ç«¯ã€‘Redis connection closed'));\n\n        await redisClient.connect();\n        console.log('ã€æœåŠ¡ç«¯ã€‘Redis connected successfully');\n\n        return redisClient;\n    } catch (err) {\n        console.error('ã€æœåŠ¡ç«¯ã€‘Redis connection failed', err);\n        throw err;\n    } finally {\n        isConnecting = false;\n    }\n}\n```\n\n# åè®°\n\n## åç»­æ”¹è¿›\n\n- [ ] ä»£ç é‡æ„ï¼Œå…è®¸æ›¿æ¢å…¶ä»–æ¨¡å‹\n- [ ] ä¸è¦è®¾ç½® 7 å¤©è¿‡æœŸã€‚éšæ–‡ç« æ›´æ–°è€Œè°ƒç”¨å¤§æ¨¡å‹ã€‚ä½†å¦‚æœ Redis æœ‰ Key å°±ç«‹å³è¿”å›ä»¥ä¿è¯é€Ÿåº¦ï¼Œæ›´æ–°æˆ‘ä»¬åé¢å†å¤„ç†ã€‚\n- [ ] å¯¹æ¨¡å‹ç”Ÿæˆå†…å®¹è¿›è¡Œä¿åº•åå¤„ç†ï¼ˆç›˜å¤ä¹‹ç™½ã€ä¿è¯æ•´å¥ã€å­—æ•°é™åˆ¶ï¼‰\n- [ ] `/p/77a4685d/#523` ç±»ä¼¼è¿™æ ·çš„é“¾æ¥è¿˜æ²¡æœ‰æ­£ç¡®åŒ¹é…ï¼Œéœ€æ”¹è¿›ä»£ç \n\n## å¿ƒå¾—\n\nå½“ TianliGPT çš„åšå®¢ AI æ‘˜è¦è¯ç”Ÿæ—¶ï¼Œæˆ‘æ·±æ„Ÿéœ‡æ’¼ï¼Œè¿™ä¹ˆé…·çš„é¡¹ç›®æˆ‘è‡ªå·±ä¹Ÿè¦å®ç°ä¸€ä¸ªã€‚é‚£æ®µæ—¶é—´ï¼Œè¿™ä¸ªå°å°çš„æ„¿æ™¯é©±åŠ¨ç€æˆ‘ä¸æ–­ï¼Œè‹¦å­¦æœ¬é¢†å’ŒæŠ€æœ¯ã€‚ç¡è§‰å‰ï¼Œè„‘æµ·ä¸­è¿˜ä¼šé—ªè¿‡æ— æ•°ç§å®ç°æ–¹æ¡ˆ......ä½†æ˜¯ç”±äºè¿™äº›å¹´äº‹æƒ…å¤ªå¤šï¼Œè¿™ä¸ªè®¡åˆ’ä¸€ç›´è¢«è€½æã€‚ç›´åˆ°æœ€è¿‘çœ‹åˆ° Liushenã€KonoXIN çš„ä½œå“ï¼Œæˆ‘æ‰æŠŠè¿™ä¸ªä¸¤å¹´å‰çš„ Flag æ¡èµ·æ¥ã€‚\n\nè¿™äº›å¹´ï¼Œä¹Ÿé€›äº†ä¸å°‘ç²¾ç¾çš„åšå®¢ï¼Œé¥±è§ˆè®¸å¤šé«˜å“è´¨çš„æ–‡ç« ã€‚èƒ½å’Œåšå‹ä»¬ä¸€èµ·æˆé•¿ï¼Œæ˜¯ä¸€ä»¶å¹¸ç¦çš„äº‹æƒ…ï¼\n\n# æœ¬æ–‡å‚è€ƒ\n\n- [hexoåŸºäºTianliGPTä½¿ç”¨å…è´¹çš„Spark-Liteåˆ¶ä½œAIæ‘˜è¦ | XIN's Blog | å‰ç«¯å¼€å‘ | Vue.js & JavaScript æŠ€æœ¯åˆ†äº«](https://www.konoxin.top/posts/db7b3418/)\n- [Vercel Functions](https://vercel.com/docs/functions)\n- [å¦‚ä½•è®©åšå®¢æ”¯æŒAIæ‘˜è¦ï¼Œä½¿ç”¨TianliGPTè‡ªåŠ¨ç”Ÿæˆæ–‡ç« çš„AIæ‘˜è¦ | å¼ æ´ªHeo](https://blog.zhheo.com/p/ec57d8b2.html)\n- [nodeJSå¦‚ä½•æ¥å…¥redis_nodejs è¿æ¥redis-CSDNåšå®¢](https://blog.csdn.net/ivan5277/article/details/138669897)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","categories":[{"name":"åšå®¢ç«™ç‚¹ç»´æŠ¤","api":"api/categories/åšå®¢ç«™ç‚¹ç»´æŠ¤.json"},{"name":"Hexo","api":"api/categories/åšå®¢ç«™ç‚¹ç»´æŠ¤/Hexo.json"}],"tags":[{"name":"JavaScript","api":"api/tags/JavaScript.json"},{"name":"Hexo","api":"api/tags/Hexo.json"},{"name":"npm","api":"api/tags/npm.json"},{"name":"Butterfly","api":"api/tags/Butterfly.json"},{"name":"Vercel","api":"api/tags/Vercel.json"},{"name":"Redis","api":"api/tags/Redis.json"},{"name":"SparkLite","api":"api/tags/SparkLite.json"}]},"api":"api/posts/p/75efe9f3.json"}