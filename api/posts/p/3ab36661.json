{"data":{"title":"Hexo 动态加载配置（钩子函数）","slug":"博客站点维护/Hexo/Hexo 动态加载配置（钩子函数）","description":"密密麻麻的 HTML 不会塞满我的配置了","date":"2026-02-27T19:07:11.000Z","updated":"2026-02-27T20:20:30.027Z","language":"zh-CN","comments":true,"url":"p/3ab36661/","cover":"https://cdn.gallery.uuanqin.top/img/202602280308312.webp","images":[],"content":"<p>在捣鼓自己的主题时，有一些时候会在主题配置文件（或 Hexo 配置文件）中插入大量的 HTML 代码。虽然功能是实现了，但是会导致很多问题：</p>\n<ul>\n<li>配置文件冗长</li>\n<li>HTML 内容无代码高亮，不方便格式化</li>\n<li>拓展性</li>\n</ul>\n<p>为了解决这个问题，我的想法是通过注册勾子实现主题配置的动态加载。</p>\n<h1 id=\"编写脚本并注册勾子\"><a class=\"markdownIt-Anchor\" href=\"#编写脚本并注册勾子\"></a> 编写脚本并注册勾子</h1>\n<p>默认地，Hexo 会在 Hexo 命令执行时加载博客项目 <code>scripts</code> 文件夹下的所有脚本。</p>\n\n<div class=\"callout\" data-callout=\"warning\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-alert-triangle\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><path d=\"M12 9v4\"/><path d=\"M12 17h.01\"/></svg>\n</div>\n<div class=\"callout-title-inner\">请不要在 <code>scripts</code> 文件夹下放置执行不了的非脚本文件。</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>我们在 <code>scripts</code> 文件夹中编写 <code>dynamic_config.js</code> 脚本：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 通用函数：读取外部HTML文件并赋值给Hexo配置</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">options</span> - 配置项</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; options.filePath - HTML文件相对路径（相对于Hexo根目录）</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; options.configPath - 要赋值的主题配置路径（如 &quot;aside.card_announcement.content&quot;）</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; options.failureMsg - 失败日志提示前缀</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">loadHtmlToConfig</span>(<span class=\"params\">&#123;filePath, configPath, failureMsg&#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 拼接完整文件路径</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> fullPath = path.<span class=\"title function_\">join</span>(hexo.<span class=\"property\">base_dir</span>, filePath);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 验证文件是否存在</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!fs.<span class=\"title function_\">existsSync</span>(fullPath)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">`文件不存在：<span class=\"subst\">$&#123;fullPath&#125;</span>`</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 读取HTML内容</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> htmlContent = fs.<span class=\"title function_\">readFileSync</span>(fullPath, <span class=\"string\">&#x27;utf8&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 解析配置路径并赋值（支持多级路径，如 aside.card_announcement.content）</span></span><br><span class=\"line\">        <span class=\"title function_\">setNestedConfig</span>(hexo.<span class=\"property\">theme</span>.<span class=\"property\">config</span>, configPath, htmlContent);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 输出成功日志</span></span><br><span class=\"line\">        hexo.<span class=\"property\">log</span>.<span class=\"title function_\">debug</span>(<span class=\"string\">`✅ 动态配置加载成功 <span class=\"subst\">$&#123;configPath&#125;</span>`</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 容错处理：输出警告日志，不中断构建</span></span><br><span class=\"line\">        hexo.<span class=\"property\">log</span>.<span class=\"title function_\">warn</span>(<span class=\"string\">`⚠️ <span class=\"subst\">$&#123;failureMsg&#125;</span>：<span class=\"subst\">$&#123;error.message&#125;</span>，使用主题默认内容`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 通用函数：设置嵌套对象的属性值（支持多级路径）</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">Object</span>&#125; <span class=\"variable\">obj</span> - 目标对象（如 hexo.theme.config）</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">string</span>&#125; <span class=\"variable\">path</span> - 属性路径（如 &quot;aside.card_announcement.content&quot;）</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &#123;<span class=\"type\">any</span>&#125; <span class=\"variable\">value</span> - 要设置的值</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">setNestedConfig</span>(<span class=\"params\">obj, path, value</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> keys = path.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> lastKey = keys.<span class=\"title function_\">pop</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 逐层查找/创建嵌套对象</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> targetObj = keys.<span class=\"title function_\">reduce</span>(<span class=\"function\">(<span class=\"params\">acc, key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!acc[key]) acc[key] = &#123;&#125;; <span class=\"comment\">// 路径不存在时创建空对象</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> acc[key];</span><br><span class=\"line\">    &#125;, obj);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 给最终属性赋值</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (targetObj[lastKey]) &#123; <span class=\"comment\">// 仅当原配置存在时赋值（保持原有逻辑）</span></span><br><span class=\"line\">        targetObj[lastKey] = value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 注册Hexo钩子</span></span><br><span class=\"line\">hexo.<span class=\"property\">extend</span>.<span class=\"property\">filter</span>.<span class=\"title function_\">register</span>(<span class=\"string\">&#x27;before_generate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 配置列表：新增/修改字段只需修改这个数组，无需改核心逻辑</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dynamicConfigList = [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">filePath</span>: <span class=\"string\">&#x27;source/_data/dynamic_configs/announcement.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">configPath</span>: <span class=\"string\">&#x27;aside.card_announcement.content&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">failureMsg</span>: <span class=\"string\">&#x27;读取侧边栏公告HTML文件失败&#x27;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">filePath</span>: <span class=\"string\">&#x27;source/_data/dynamic_configs/footer.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">configPath</span>: <span class=\"string\">&#x27;footer.custom_text&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">failureMsg</span>: <span class=\"string\">&#x27;读取页脚自定义文本HTML文件失败&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 新增字段示例：只需添加以下配置项即可</span></span><br><span class=\"line\">        <span class=\"comment\">// &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     filePath: &#x27;source/_data/dynamic_configs/nav.html&#x27;,</span></span><br><span class=\"line\">        <span class=\"comment\">//     configPath: &#x27;nav.custom_content&#x27;,</span></span><br><span class=\"line\">        <span class=\"comment\">//     failureMsg: &#x27;读取导航栏自定义内容HTML文件失败&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 遍历配置列表，批量执行加载逻辑</span></span><br><span class=\"line\">    dynamicConfigList.<span class=\"title function_\">forEach</span>(loadHtmlToConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;, <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<p>根据上面代码的提示，自行修改或拓展勾子函数 <code>hexo.extend.filter.register</code> 即可。比如像第一个 <code>aside</code> 的例子。原本我们在 <code>_config.butterfly.yml</code> 的某项配置为：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">aside:</span></span><br><span class=\"line\">  <span class=\"attr\">card_announcement:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">content:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">      很长很长很长的内容</span></span><br><span class=\"line\"><span class=\"string\">      ......</span></span><br><span class=\"line\"><span class=\"string\">      有很多很多行</span></span><br></pre></td></tr></table></figure>\n<p>我们可以把这些内容剪切出来放在某一个位置里，比如将内容粘贴到 <code>source/_data/dynamic_configs/announcement.html</code> 文件中即可。 <code>failureMsg</code> 随意写，用于在日志中给出相应的提示。</p>\n<p>经测试，这个动态配置甚至可以热更新，HTML 内容修改后会实时反馈到页面中。当然，目前这个脚本还在试用中，如有任何问题，欢迎在评论区进行交流和讨论。</p>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://hexo.io/zh-cn/docs/plugins\">插件 | Hexo</a></li>\n</ul>\n","raw":"---\ntitle: Hexo 动态加载配置（钩子函数）\ntags:\n  - Hexo\n  - Butterfly\n  - JavaScript\n  - HTML\n  - YAML\ncover: https://cdn.gallery.uuanqin.top/img/202602280308312.webp\ndescription: 密密麻麻的 HTML 不会塞满我的配置了\nkatex: false\ncover_prompt: >-\n  生成文章封面图，主题为「Hexo的动态配置」，卡通扁平漫画风，包含六角形Hexo图标，元素简洁有活力，比例「4:3」。||将这张图换个浅色背景色，附浅色漂浮纹理。卡片中间的六角形颜色换为Hexo标志Logo的蓝色。\ncover_model: Seedream 4.5\ncategories:\n  - 博客站点维护\n  - Hexo\nabbrlink: 3ab36661\nsummary: >-\n  本文介绍了如何在 Hexo 主题中通过注册钩子函数实现配置文件的动态加载，以解决配置文件冗长、HTML 内容无代码高亮和扩展性差的问题。作者详细说明了如何编写脚本并注册钩子，在配置文件被修改后能够实时更新页面内容。此外，文章还提供了一个具体的配置示例，并指出当前脚本仍处于试用阶段，欢迎读者在评论区交流讨论。\ndate: 2026-02-28 03:07:11\ntop_img:\nassistant_model: \n  - 豆包\n---\n\n在捣鼓自己的主题时，有一些时候会在主题配置文件（或 Hexo 配置文件）中插入大量的 HTML 代码。虽然功能是实现了，但是会导致很多问题：\n\n- 配置文件冗长\n- HTML 内容无代码高亮，不方便格式化\n- 拓展性\n\n为了解决这个问题，我的想法是通过注册勾子实现主题配置的动态加载。\n\n# 编写脚本并注册勾子\n\n默认地，Hexo 会在 Hexo 命令执行时加载博客项目 `scripts` 文件夹下的所有脚本。\n\n> [!warning] 请不要在 `scripts` 文件夹下放置执行不了的非脚本文件。\n\n我们在 `scripts` 文件夹中编写 `dynamic_config.js` 脚本：\n\n```js\nconst fs = require('fs');\nconst path = require('path');\n\n/**\n * 通用函数：读取外部HTML文件并赋值给Hexo配置\n * @param {Object} options - 配置项\n * @param {string} options.filePath - HTML文件相对路径（相对于Hexo根目录）\n * @param {string} options.configPath - 要赋值的主题配置路径（如 \"aside.card_announcement.content\"）\n * @param {string} options.failureMsg - 失败日志提示前缀\n */\nfunction loadHtmlToConfig({filePath, configPath, failureMsg}) {\n    try {\n        // 拼接完整文件路径\n        const fullPath = path.join(hexo.base_dir, filePath);\n\n        // 验证文件是否存在\n        if (!fs.existsSync(fullPath)) {\n            throw new Error(`文件不存在：${fullPath}`);\n        }\n\n        // 读取HTML内容\n        const htmlContent = fs.readFileSync(fullPath, 'utf8');\n\n        // 解析配置路径并赋值（支持多级路径，如 aside.card_announcement.content）\n        setNestedConfig(hexo.theme.config, configPath, htmlContent);\n\n        // 输出成功日志\n        hexo.log.debug(`✅ 动态配置加载成功 ${configPath}`);\n    } catch (error) {\n        // 容错处理：输出警告日志，不中断构建\n        hexo.log.warn(`⚠️ ${failureMsg}：${error.message}，使用主题默认内容`);\n    }\n}\n\n/**\n * 通用函数：设置嵌套对象的属性值（支持多级路径）\n * @param {Object} obj - 目标对象（如 hexo.theme.config）\n * @param {string} path - 属性路径（如 \"aside.card_announcement.content\"）\n * @param {any} value - 要设置的值\n */\nfunction setNestedConfig(obj, path, value) {\n    const keys = path.split('.');\n    const lastKey = keys.pop();\n\n    // 逐层查找/创建嵌套对象\n    const targetObj = keys.reduce((acc, key) => {\n        if (!acc[key]) acc[key] = {}; // 路径不存在时创建空对象\n        return acc[key];\n    }, obj);\n\n    // 给最终属性赋值\n    if (targetObj[lastKey]) { // 仅当原配置存在时赋值（保持原有逻辑）\n        targetObj[lastKey] = value;\n    }\n}\n\n// 注册Hexo钩子\nhexo.extend.filter.register('before_generate', () => {\n\n    // 配置列表：新增/修改字段只需修改这个数组，无需改核心逻辑\n    const dynamicConfigList = [\n        {\n            filePath: 'source/_data/dynamic_configs/announcement.html',\n            configPath: 'aside.card_announcement.content',\n            failureMsg: '读取侧边栏公告HTML文件失败'\n        },\n        {\n            filePath: 'source/_data/dynamic_configs/footer.html',\n            configPath: 'footer.custom_text',\n            failureMsg: '读取页脚自定义文本HTML文件失败'\n        }\n        // 新增字段示例：只需添加以下配置项即可\n        // {\n        //     filePath: 'source/_data/dynamic_configs/nav.html',\n        //     configPath: 'nav.custom_content',\n        //     failureMsg: '读取导航栏自定义内容HTML文件失败'\n        // }\n    ];\n\n    // 遍历配置列表，批量执行加载逻辑\n    dynamicConfigList.forEach(loadHtmlToConfig);\n\n}, 1);\n```\n\n根据上面代码的提示，自行修改或拓展勾子函数 `hexo.extend.filter.register` 即可。比如像第一个 `aside` 的例子。原本我们在 `_config.butterfly.yml` 的某项配置为：\n\n```yaml\naside:\n  card_announcement:\n    enable: true\n    content: |\n      很长很长很长的内容\n      ......\n      有很多很多行\n```\n\n我们可以把这些内容剪切出来放在某一个位置里，比如将内容粘贴到 `source/_data/dynamic_configs/announcement.html` 文件中即可。 `failureMsg` 随意写，用于在日志中给出相应的提示。\n\n经测试，这个动态配置甚至可以热更新，HTML 内容修改后会实时反馈到页面中。当然，目前这个脚本还在试用中，如有任何问题，欢迎在评论区进行交流和讨论。\n\n# 本文参考\n\n- [插件 | Hexo](https://hexo.io/zh-cn/docs/plugins)","categories":[{"name":"博客站点维护","api":"api/categories/博客站点维护.json"},{"name":"Hexo","api":"api/categories/博客站点维护/Hexo.json"}],"tags":[{"name":"HTML","api":"api/tags/HTML.json"},{"name":"JavaScript","api":"api/tags/JavaScript.json"},{"name":"Hexo","api":"api/tags/Hexo.json"},{"name":"Butterfly","api":"api/tags/Butterfly.json"},{"name":"YAML","api":"api/tags/YAML.json"}]},"api":"api/posts/p/3ab36661.json"}