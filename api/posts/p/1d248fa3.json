{"data":{"title":"Waline 配置头像服务（含常用公共头像服务介绍）","slug":"博客站点维护/Waline/Waline 配置头像服务（含常用公共头像服务介绍）","description":"简要介绍常用公共头像服务，尝试在 Waline 中上手实践替换默认头像","date":"2024-10-12T19:07:11.000Z","updated":"2026-02-01T08:42:41.810Z","language":"zh-CN","comments":true,"url":"p/1d248fa3/","cover":"https://cdn.gallery.uuanqin.top/img/202410130307005.webp","images":[],"content":"<p>本文将介绍「修改 Waline 默认头像」、「通过 QQ 邮箱自动获取头像」的方法。</p>\n<h1 id=\"公共头像服务简介\"><a class=\"markdownIt-Anchor\" href=\"#公共头像服务简介\"></a> 公共头像服务简介</h1>\n<h2 id=\"gravatar\"><a class=\"markdownIt-Anchor\" href=\"#gravatar\"></a> Gravatar</h2>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130321499.webp\" alt=\"image.png\" width=\"275px\" /></p>\n<p>Gravatar 是 WordPress 母公司 Automattic 推出的一个公共头像服务。你只需要去 <a href=\"http://Gravatar.com\">Gravatar.com</a> 注册账号绑定自己的域名邮箱，然后上传自己的头像。在逛博客评论的时候，邮箱填写您的域名邮箱，会默认输出你在 Gravatar 上传的头像。</p>\n<p>Gravatar 可以说是较知名且应用较广泛的公共头像服务了。Wordpress、GitHub、OpenAI、Figma、Stack Overflow 等网站都在使用 Gravatar 服务。但是由于一些原因，Gravatar 在国内使用体验并不好。</p>\n<h2 id=\"libravatar\"><a class=\"markdownIt-Anchor\" href=\"#libravatar\"></a> Libravatar</h2>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130323310.webp\" alt=\"image.png\" width=\"233px\" /></p>\n<p>Libravatar (Libre Avatar) 是一个免费服务，也是一个开放规范，用于托管与电子邮件或 OpenID 地址绑定的个人图像。</p>\n<p>Libravatar 受 Gravatar 启发，并提供了额外的功能：允许域名所有者为自己的组织托管图像。Libravatar API 的使用方式和 Gravatar 很像，在大多数情况下，从 Gravatar 迁移到 Libravatar 只需要改一下域名就行。</p>\n<p>如果在 Libravatar 找不到头像怎么办？</p>\n<ul>\n<li>如果是通过<strong>邮件地址</strong>获取不到头像，将重定向至图像链接参数指定的默认头像。例如链接 <code>https://seccdn.libravatar.org/avatar/HASH?d=/static/nobody.jpg</code> 中，<code>d</code> 参数指定了默认头像的位置。</li>\n<li>如果是通过 <strong>MD5 哈希算法</strong>获取不到头像，<strong>Libravatar 将首先重定向到 Gravatar 试图获取头像</strong>。如果还找不到，就将重定向至图像链接参数指定的默认头像。</li>\n</ul>\n<h2 id=\"cravatar\"><a class=\"markdownIt-Anchor\" href=\"#cravatar\"></a> Cravatar</h2>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130322871.webp\" alt=\"image.png\" width=\"225px\" /></p>\n<p>Cravatar 是中国认可的头像（China Recognized Avatar）的缩写，又名「初认头像」，是一款免费的公共头像服务。它具有更快的响应速度，且服务完全架设并运行在中国大陆境内。对于国内用户来说，它是一个 Gravatar 完美的替代品。</p>\n<p>Cravatar 使用了三级头像匹配：<strong>Cravatar 头像 -&gt;Gravatar 头像 -&gt;QQ 头像</strong>，大约 70% 的访客都能得到准确的头像。</p>\n<p><strong>Cravatar 会对所有头像进行人工审核（也包括来自 Gravatar 和 QQ 的头像）</strong>，所有包含暴恐、色情、政治等违反中国法律的内容都会被屏蔽，并返回默认头像。这一点可以分担一些国内站长的审核压力。</p>\n<h2 id=\"三种公共头像服务小结\"><a class=\"markdownIt-Anchor\" href=\"#三种公共头像服务小结\"></a> 三种公共头像服务小结</h2>\n<table>\n<thead>\n<tr>\n<th>头像服务</th>\n<th>获取头像的基本格式</th>\n<th>匹配级别</th>\n<th style=\"text-align:center\">支持的参数</th>\n<th>官方 API 文档</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Gravatar</td>\n<td><code>https://gravatar.com/avatar/HASH</code></td>\n<td>Gravatar</td>\n<td style=\"text-align:center\" rowspan=\"3\"><code>s,size</code>：图像大小<br><code>d,default</code>：默认头像</td>\n<td><a href=\"https://docs.gravatar.com/api/avatars/images/\">链接</a></td>\n</tr>\n<tr>\n<td>Libravatar</td>\n<td><code>https://seccdn.libravatar.org/avatar/HASH</code></td>\n<td>Libravatar<br>Gravatar</td>\n<td><a href=\"https://wiki.libravatar.org/api/\">链接</a></td>\n</tr>\n<tr>\n<td>Cravatar</td>\n<td><code>https://cravatar.cn/avatar/HASH</code><br><br><code>https://cn.cravatar.com/avatar/HASH</code></td>\n<td>Cravatar<br>Gravatar<br>QQ 头像</td>\n<td><a href=\"https://cravatar.com/developer/api\">链接</a></td>\n</tr>\n</tbody>\n</table>\n<p>除了使用 <code>d</code> 或 <code>default</code> 参数可以指定自己设置的默认头像外，还可以使用服务内置的默认头像：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>简介</th>\n<th style=\"text-align:center\">Gravatar</th>\n<th style=\"text-align:center\">Libravatar</th>\n<th style=\"text-align:center\">Cravatar</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>没有指定 <code>d</code> 参数</td>\n<td>如果图像链接没有指定默认头像，那么将返回这个图像。</td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130115877.webp\" alt=\"image.png\" width=\"55px\" /></td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130115039.webp\" alt=\"image.png\" width=\"56px\" /></td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130144803.webp\" alt=\"image.png\" width=\"50px\" /></td>\n</tr>\n<tr>\n<td><code>404</code></td>\n<td>如果没有与电子邮件哈希关联的图像，则不加载任何图像，而是返回 HTTP 404 响应</td>\n<td style=\"text-align:center\" colspan=\"3\">支持</td>\n</tr>\n<tr>\n<td><code>mp</code></td>\n<td>一个简单的卡通风格的人物轮廓。<br>Libravatar 中还可以使用 <code>mm</code>。</td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130156202.webp\" alt=\"image.png\" width=\"55px\" /></td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130208049.webp\" alt=\"image.png\" width=\"55px\" /></td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130203228.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>identicon</code></td>\n<td>一个几何图案（随机生成）</td>\n<td style=\"text-align:center\" colspan=\"3\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130156080.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>monsterid</code></td>\n<td>具有不同颜色、面孔的“怪物”（随机生成）</td>\n<td style=\"text-align:center\" colspan=\"3\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130156694.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>wavatar</code></td>\n<td>具有不同特征和背景的人脸（随机生成）</td>\n<td style=\"text-align:center\" colspan=\"3\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130157080.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>retro</code></td>\n<td>8 位色的像素人脸（随机生成）</td>\n<td style=\"text-align:center\" colspan=\"3\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130157506.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>robohash</code></td>\n<td>具有不同颜色、面部的机器人（随机生成）</td>\n<td style=\"text-align:center\" colspan=\"3\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130157636.webp\" alt=\"image.png\" width=\"55px\" /></td>\n</tr>\n<tr>\n<td><code>pagan</code></td>\n<td>复古冒险游戏的角色（随机生成）</td>\n<td style=\"text-align:center\">不支持</td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130207584.webp\" alt=\"image.png\" width=\"55px\" /></td>\n<td style=\"text-align:center\">不支持</td>\n</tr>\n<tr>\n<td><code>blank</code></td>\n<td>透明的 PNG 图像。</td>\n<td style=\"text-align:center\"><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130157285.webp\" alt=\"image.png\" width=\"55px\" /></td>\n<td style=\"text-align:center\">不支持</td>\n<td style=\"text-align:center\">（透明图像）</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>顺便提一嘴国内最近出现的 WeAvatar，它的特点是支持手机号匹配头像（前提是在其服务中有账号），且支持根据用户名生成字母头像。个人感觉可能不太实用，还要多注册个号比较麻烦。但毕竟从目前来看还是公益服务，这里就简单支持一下：<a href=\"https://weavatar.com/\">WeAvatar</a></p>\n</blockquote>\n<p>更多 Gravatar 镜像源参考：<a href=\"https://www.tjsky.net/tutorial/740\">Gravatar 头像镜像源收集 （2024年） - 秋风于渭水 (tjsky.net)</a></p>\n<h1 id=\"waline-配置头像服务\"><a class=\"markdownIt-Anchor\" href=\"#waline-配置头像服务\"></a> Waline 配置头像服务</h1>\n<h2 id=\"通过服务端环境变量配置\"><a class=\"markdownIt-Anchor\" href=\"#通过服务端环境变量配置\"></a> 通过服务端环境变量配置</h2>\n<p>服务端中环境变量 <code>GRAVATAR_STR</code> 指定了获取头像的地址。</p>\n<table>\n<thead>\n<tr>\n<th>环境变量名称</th>\n<th>Waline 默认值</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>GRAVATAR_STR</code></td>\n<td><code>https://seccdn.libravatar.org/avatar/&#123;&#123;mail\\|md5&#125;&#125;</code></td>\n<td>Gravatar 头像的地址，基于 nunjucks 语法。</td>\n</tr>\n</tbody>\n</table>\n<p>可以看到 Waline 默认使用 Libravatar 提供的公共头像服务。修改这个值可以切换服务，或增加 <code>d</code> 参数修改默认头像。</p>\n<p>下面将演示修改默认头像的方法（假设你使用 Vercel 部署服务端）。</p>\n<p>打开 Vercel 中的 Waline 项目，选择 setting-&gt;Environment Variables：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130218376.webp\" alt=\"image.png\" width=\"500px\" /></p>\n<p>添加以下键值对：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/202410130219679.webp\" alt=\"image.png\" width=\"500px\" /></p>\n<p>我们通过 <code>d</code> 参数指定默认头像为「8 位色的像素人脸（随机生成）」。</p>\n<p>点击 Save 后，重新部署 Waline 项目即可。</p>\n<h2 id=\"通过修改-indexjs-文件更灵活地配置头像\"><a class=\"markdownIt-Anchor\" href=\"#通过修改-indexjs-文件更灵活地配置头像\"></a> 通过修改 <code>index.js</code> 文件更灵活地配置头像</h2>\n<p>通过修改 Vercel 对应的 Github 仓库下的 <code>index.js</code> 文件（或者 <code>index.cjs</code>）可以更灵活指定评论者的头像。具体使用详看接下来由 Waline 官方提供的例子。</p>\n<p>假设你使用的头像服务不支持通过数字 QQ 邮箱获取头像，那么你可以通过以下方式增加此功能。</p>\n<p>首先打开 Vercel 对应 Waline 项目的 Github 仓库，修改 <code>index.js</code> 文件，将以下内容添加至方框位置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">此方法或传入一个 comment 对象，你可以通过 comment.mail 获取邮箱。若返回值为 string 类型，则会直接调用返回值作为头像地址，否则正常生成 MD5。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"title function_\">avatarUrl</span>(<span class=\"params\">comment</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reg = <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(<span class=\"string\">&#x27;(\\\\d+)@qq\\\\.com$&#x27;</span>, <span class=\"string\">&#x27;i&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> mail = comment.<span class=\"property\">mail</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (reg.<span class=\"title function_\">test</span>(mail)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> q = mail.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/@qq\\.com/i</span>, <span class=\"string\">&#x27;&#x27;</span>).<span class=\"title function_\">toLowerCase</span>();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&#x27;https://q1.qlogo.cn/headimg_dl?dst_uin=&#x27;</span> + q + <span class=\"string\">&#x27;&amp;spec=4&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<p>完整代码示例：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/image-20230428162327261.png\" alt=\"image-20230428162327261\" width=\"500px\" /></p>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://zh.wikipedia.org/wiki/Gravatar\">Gravatar - 维基百科，自由的百科全书 (wikipedia.org)</a></li>\n<li><a href=\"https://docs.gravatar.com/api/avatars/images/\">Avatar Requests – Gravatar Developer Docs</a></li>\n<li><a href=\"https://cloud.tencent.com/developer/article/1926000\">彻底对令人头疼的Gravatar头像说再见，正式换上国内的Cravatar头像源-腾讯云开发者社区-腾讯云 (tencent.com)</a></li>\n<li><a href=\"https://wiki.libravatar.org/\">Libravatar Wiki</a></li>\n<li><a href=\"https://cravatar.com/developer/introduction\">Cravatar 开发指南 – Cravatar 开发文档</a></li>\n<li><a href=\"https://waline.js.org/reference/server/env.html#%E6%98%BE%E7%A4%BA\">服务端环境变量 | Waline</a></li>\n</ul>\n","raw":"---\ntitle: Waline 配置头像服务（含常用公共头像服务介绍）\ntags:\n  - Waline\n  - Gravatar\n  - Cravatar\n  - Libravatar\n  - Vercel\n  - GitHub\n  - JavaScript\ncover: https://cdn.gallery.uuanqin.top/img/202410130307005.webp\ndescription: 简要介绍常用公共头像服务，尝试在 Waline 中上手实践替换默认头像\ncategories:\n  - 博客站点维护\n  - Waline\nabbrlink: 1d248fa3\nsummary: >-\n  本文介绍了 Waline 配置头像服务的相关内容，包括公共头像服务的种类和使用方法。公共头像服务有 Gravatar、Libravatar 和 Cravatar 等，它们各有特点和优势。Gravatar 服务广泛但在中国使用体验不佳，Libravatar 提供额外功能且迁移相对容易，而 Cravatar 则是中国认可的免费服务，具有快速响应速度和严格的审核机制。 文章还详细说明了如何在 Waline 中通过服务端环境变量和修改 index.js 文件来配置自定义头像。通过服务端环境变量可以轻松切换头像服务或设置默认头像；而修改 index.js 文件则提供了更灵活的配置方式，特别是增加了通过 QQ 邮箱自动获取头像的功能。 此外，文章还列出了相关参考资料，方便读者深入了解各个公共头像服务以及\n  Waline 配置头像服务的具体操作细节。\ndate: 2024-10-13 03:07:11\ntop_img:\n---\n\n本文将介绍「修改 Waline 默认头像」、「通过 QQ 邮箱自动获取头像」的方法。\n\n# 公共头像服务简介\n\n## Gravatar\n\n![image.png|275](https://cdn.gallery.uuanqin.top/img/202410130321499.webp)\n\nGravatar 是 WordPress 母公司 Automattic 推出的一个公共头像服务。你只需要去 Gravatar.com 注册账号绑定自己的域名邮箱，然后上传自己的头像。在逛博客评论的时候，邮箱填写您的域名邮箱，会默认输出你在 Gravatar 上传的头像。\n\nGravatar 可以说是较知名且应用较广泛的公共头像服务了。Wordpress、GitHub、OpenAI、Figma、Stack Overflow 等网站都在使用 Gravatar 服务。但是由于一些原因，Gravatar 在国内使用体验并不好。\n\n## Libravatar\n\n![image.png|233](https://cdn.gallery.uuanqin.top/img/202410130323310.webp)\n\nLibravatar (Libre Avatar) 是一个免费服务，也是一个开放规范，用于托管与电子邮件或 OpenID 地址绑定的个人图像。\n\nLibravatar 受 Gravatar 启发，并提供了额外的功能：允许域名所有者为自己的组织托管图像。Libravatar API 的使用方式和 Gravatar 很像，在大多数情况下，从 Gravatar 迁移到 Libravatar 只需要改一下域名就行。\n\n如果在 Libravatar 找不到头像怎么办？\n\n- 如果是通过**邮件地址**获取不到头像，将重定向至图像链接参数指定的默认头像。例如链接 `https://seccdn.libravatar.org/avatar/HASH?d=/static/nobody.jpg` 中，`d` 参数指定了默认头像的位置。\n- 如果是通过 **MD5 哈希算法**获取不到头像，**Libravatar 将首先重定向到 Gravatar 试图获取头像**。如果还找不到，就将重定向至图像链接参数指定的默认头像。\n\n## Cravatar\n\n![image.png|225](https://cdn.gallery.uuanqin.top/img/202410130322871.webp)\n\nCravatar 是中国认可的头像（China Recognized Avatar）的缩写，又名「初认头像」，是一款免费的公共头像服务。它具有更快的响应速度，且服务完全架设并运行在中国大陆境内。对于国内用户来说，它是一个 Gravatar 完美的替代品。\n\nCravatar 使用了三级头像匹配：**Cravatar 头像 ->Gravatar 头像 ->QQ 头像**，大约 70% 的访客都能得到准确的头像。\n\n**Cravatar 会对所有头像进行人工审核（也包括来自 Gravatar 和 QQ 的头像）**，所有包含暴恐、色情、政治等违反中国法律的内容都会被屏蔽，并返回默认头像。这一点可以分担一些国内站长的审核压力。\n\n## 三种公共头像服务小结\n\n| 头像服务       | 获取头像的基本格式                                                                      | 匹配级别                          |               支持的参数               | 官方 API 文档                                           |\n| ---------- | ------------------------------------------------------------------------------ | ----------------------------- | :-------------------------------: | --------------------------------------------------- |\n| Gravatar   | `https://gravatar.com/avatar/HASH`                                             | Gravatar                      | `s,size`：图像大小<br>`d,default`：默认头像 | [链接](https://docs.gravatar.com/api/avatars/images/) |\n| Libravatar | `https://seccdn.libravatar.org/avatar/HASH`                                    | Libravatar<br>Gravatar        | `s,size`：图像大小<br>`d,default`：默认头像 | [链接](https://wiki.libravatar.org/api/)              |\n| Cravatar   | `https://cravatar.cn/avatar/HASH`<br><br>`https://cn.cravatar.com/avatar/HASH` | Cravatar<br>Gravatar<br>QQ 头像 | `s,size`：图像大小<br>`d,default`：默认头像 | [链接](https://cravatar.com/developer/api)            |\n\n除了使用 `d` 或 `default` 参数可以指定自己设置的默认头像外，还可以使用服务内置的默认头像：\n\n| 参数          | 简介                                         |                                  Gravatar                                  |                                 Libravatar                                 |                                  Cravatar                                  |\n| ----------- | ------------------------------------------ | :------------------------------------------------------------------------: | :------------------------------------------------------------------------: | :------------------------------------------------------------------------: |\n| 没有指定 `d` 参数 | 如果图像链接没有指定默认头像，那么将返回这个图像。                  | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130115877.webp) | ![image.png\\|56](https://cdn.gallery.uuanqin.top/img/202410130115039.webp) | ![image.png\\|50](https://cdn.gallery.uuanqin.top/img/202410130144803.webp) |\n| `404`       | 如果没有与电子邮件哈希关联的图像，则不加载任何图像，而是返回 HTTP 404 响应 |                                     支持                                     |                                     支持                                     |                                     支持                                     |\n| `mp`        | 一个简单的卡通风格的人物轮廓。<br>Libravatar 中还可以使用 `mm`。 | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156202.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130208049.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130203228.webp) |\n| `identicon` | 一个几何图案（随机生成）                               | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156080.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156080.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156080.webp) |\n| `monsterid` | 具有不同颜色、面孔的“怪物”（随机生成）                       | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156694.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156694.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130156694.webp) |\n| `wavatar`   | 具有不同特征和背景的人脸（随机生成）                         | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157080.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157080.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157080.webp) |\n| `retro`     | 8 位色的像素人脸（随机生成）                            | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157506.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157506.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157506.webp) |\n| `robohash`  | 具有不同颜色、面部的机器人（随机生成）                        | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157636.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157636.webp) | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157636.webp) |\n| `pagan`     | 复古冒险游戏的角色（随机生成）                            |                                    不支持                                     | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130207584.webp) |                                    不支持                                     |\n| `blank`     | 透明的 PNG 图像。                                | ![image.png\\|55](https://cdn.gallery.uuanqin.top/img/202410130157285.webp) |                                    不支持                                     |                                   （透明图像）                                   |\n\n> 顺便提一嘴国内最近出现的 WeAvatar，它的特点是支持手机号匹配头像（前提是在其服务中有账号），且支持根据用户名生成字母头像。个人感觉可能不太实用，还要多注册个号比较麻烦。但毕竟从目前来看还是公益服务，这里就简单支持一下：[WeAvatar](https://weavatar.com/)\n\n更多 Gravatar 镜像源参考：[Gravatar 头像镜像源收集 （2024年） - 秋风于渭水 (tjsky.net)](https://www.tjsky.net/tutorial/740)\n\n# Waline 配置头像服务\n\n## 通过服务端环境变量配置\n\n服务端中环境变量 `GRAVATAR_STR` 指定了获取头像的地址。\n\n| 环境变量名称         | Waline 默认值                                           | 备注                             |\n| -------------- | ---------------------------------------------------- | ------------------------------ |\n| `GRAVATAR_STR` | `https://seccdn.libravatar.org/avatar/{{mail\\|md5}}` | Gravatar 头像的地址，基于 nunjucks 语法。 |\n\n可以看到 Waline 默认使用 Libravatar 提供的公共头像服务。修改这个值可以切换服务，或增加 `d` 参数修改默认头像。\n\n下面将演示修改默认头像的方法（假设你使用 Vercel 部署服务端）。\n\n打开 Vercel 中的 Waline 项目，选择 setting->Environment Variables：\n\n![image.png|500](https://cdn.gallery.uuanqin.top/img/202410130218376.webp)\n\n添加以下键值对：\n\n![image.png|500](https://cdn.gallery.uuanqin.top/img/202410130219679.webp)\n\n我们通过 `d` 参数指定默认头像为「8 位色的像素人脸（随机生成）」。\n\n点击 Save 后，重新部署 Waline 项目即可。\n\n## 通过修改 `index.js` 文件更灵活地配置头像\n\n通过修改 Vercel 对应的 Github 仓库下的 `index.js` 文件（或者 `index.cjs`）可以更灵活指定评论者的头像。具体使用详看接下来由 Waline 官方提供的例子。\n\n假设你使用的头像服务不支持通过数字 QQ 邮箱获取头像，那么你可以通过以下方式增加此功能。\n\n首先打开 Vercel 对应 Waline 项目的 Github 仓库，修改 `index.js` 文件，将以下内容添加至方框位置：\n\n```js\n/*\n此方法或传入一个 comment 对象，你可以通过 comment.mail 获取邮箱。若返回值为 string 类型，则会直接调用返回值作为头像地址，否则正常生成 MD5。\n*/\nasync avatarUrl(comment) {\n    const reg = new RegExp('(\\\\d+)@qq\\\\.com$', 'i');\n    const mail = comment.mail;\n    if (reg.test(mail)) {\n      const q = mail.replace(/@qq\\.com/i, '').toLowerCase();\n      return 'https://q1.qlogo.cn/headimg_dl?dst_uin=' + q + '&spec=4';\n    }\n  },\n```\n\n完整代码示例：\n\n![image-20230428162327261|500](https://cdn.gallery.uuanqin.top/img/image-20230428162327261.png)\n\n# 本文参考\n- [Gravatar - 维基百科，自由的百科全书 (wikipedia.org)](https://zh.wikipedia.org/wiki/Gravatar)\n- [Avatar Requests – Gravatar Developer Docs](https://docs.gravatar.com/api/avatars/images/)\n- [彻底对令人头疼的Gravatar头像说再见，正式换上国内的Cravatar头像源-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/1926000)\n- [Libravatar Wiki](https://wiki.libravatar.org/)\n- [Cravatar 开发指南 – Cravatar 开发文档](https://cravatar.com/developer/introduction)\n- [服务端环境变量 | Waline](https://waline.js.org/reference/server/env.html#%E6%98%BE%E7%A4%BA)","categories":[{"name":"博客站点维护","api":"api/categories/博客站点维护.json"},{"name":"Waline","api":"api/categories/博客站点维护/Waline.json"}],"tags":[{"name":"JavaScript","api":"api/tags/JavaScript.json"},{"name":"GitHub","api":"api/tags/GitHub.json"},{"name":"Waline","api":"api/tags/Waline.json"},{"name":"Vercel","api":"api/tags/Vercel.json"},{"name":"Gravatar","api":"api/tags/Gravatar.json"},{"name":"Cravatar","api":"api/tags/Cravatar.json"},{"name":"Libravatar","api":"api/tags/Libravatar.json"}]},"api":"api/posts/p/1d248fa3.json"}