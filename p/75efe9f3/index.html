<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite | åŠæ–¹æ± æ°´åŠæ–¹ç”°</title><meta name="author" content="wuanqin"><meta name="copyright" content="wuanqin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="è‡ªå·±å°è¯•åŠ¨æ‰‹å®ç°ä¸€ä¸ª AI æ‘˜è¦"><meta property="og:type" content="article"><meta property="og:title" content="æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite"><meta property="og:url" content="https://blog.uuanqin.top/p/75efe9f3/index.html"><meta property="og:site_name" content="åŠæ–¹æ± æ°´åŠæ–¹ç”°"><meta property="og:description" content="è‡ªå·±å°è¯•åŠ¨æ‰‹å®ç°ä¸€ä¸ª AI æ‘˜è¦"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.gallery.uuanqin.top/img/202506242301616.webp"><meta property="article:published_time" content="2025-06-24T15:19:05.000Z"><meta property="article:modified_time" content="2025-07-05T11:37:00.772Z"><meta property="article:author" content="wuanqin"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="Hexo"><meta property="article:tag" content="npm"><meta property="article:tag" content="Butterfly"><meta property="article:tag" content="Vercel"><meta property="article:tag" content="Redis"><meta property="article:tag" content="SparkLite"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.gallery.uuanqin.top/img/202506242301616.webp"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite","url":"https://blog.uuanqin.top/p/75efe9f3/","image":"https://cdn.gallery.uuanqin.top/img/202506242301616.webp","datePublished":"2025-06-24T15:19:05.000Z","dateModified":"2025-07-05T11:37:00.772Z","author":[{"@type":"Person","name":"wuanqin","url":"https://blog.uuanqin.top"}]}</script><link rel="icon shortcut" href="/image/qlogo-400x400.webp"><link rel="canonical" href="https://blog.uuanqin.top/p/75efe9f3/index.html"><link rel="preconnect" href="//unpkg.com"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//www.clarity.ms"><meta name="baidu-site-verification" content="codeva-IupgPifNxU"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/font-awesome/6.6.0/css/all.min.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/fancyapps-ui/5.0.17/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>(()=>{var saveToLocal={set:(key,value,ttl)=>{ttl&&(ttl=Date.now()+864e5*ttl,localStorage.setItem(key,JSON.stringify({value:value,expiry:ttl})))},get:key=>{var itemStr=localStorage.getItem(key);if(itemStr){var{value:itemStr,expiry}=JSON.parse(itemStr);if(!(Date.now()>expiry))return itemStr;localStorage.removeItem(key)}}},activateDarkMode=(window.btf={saveToLocal:saveToLocal,getScript:(url,attr={})=>new Promise((resolve,reject)=>{let script=document.createElement('script');script.src=url,script.async=!0,Object.entries(attr).forEach(([key,val])=>script.setAttribute(key,val)),script.onload=script.onreadystatechange=()=>{script.readyState&&!/loaded|complete/.test(script.readyState)||resolve()},script.onerror=reject,document.head.appendChild(script)}),getCSS:(url,id)=>new Promise((resolve,reject)=>{let link=document.createElement('link');link.rel='stylesheet',link.href=url,id&&(link.id=id),link.onload=link.onreadystatechange=()=>{link.readyState&&!/loaded|complete/.test(link.readyState)||resolve()},link.onerror=reject,document.head.appendChild(link)}),addGlobalFn:(key,fn,name=!1,parent=window)=>{var globalFn;key.startsWith('pjax')||((globalFn=parent.globalFn||{})[key]=globalFn[key]||{},globalFn[key][name||Object.keys(globalFn[key]).length]=fn,parent.globalFn=globalFn)}},()=>{document.documentElement.setAttribute('data-theme','dark'),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute('content','#0d0d0d')}),activateLightMode=()=>{document.documentElement.setAttribute('data-theme','light'),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute('content','ffffff')},theme=(btf.activateDarkMode=activateDarkMode,btf.activateLightMode=activateLightMode,saveToLocal.get('theme')),hour=(new Date).getHours(),hour=((void 0===theme?hour<=8||23<=hour?activateDarkMode:activateLightMode:'light'===theme?activateLightMode:activateDarkMode)(),saveToLocal.get('aside-status'));void 0!==hour&&document.documentElement.classList.toggle('hide-aside','hide'===hour);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add('apple')})();</script><script>var _hmt=_hmt||[];(()=>{var hm=document.createElement('script'),s=(hm.src='https://hm.baidu.com/hm.js?877eb1cd1993b0865452ed4011fcd2d8',document.getElementsByTagName('script')[0]);s.parentNode.insertBefore(hm,s)})(),btf.addGlobalFn('pjaxComplete',()=>{_hmt.push(['_trackPageview',window.location.pathname])},'baidu_analytics');</script><script>((c,l,a,r,t,y)=>{c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)},(t=l.createElement(r)).async=1,t.src='https://www.clarity.ms/tag/gwn59ub66c',(y=l.getElementsByTagName(r)[0]).parentNode.insertBefore(t,y)})(window,document,'clarity','script');</script><script>let GLOBAL_CONFIG={root:'/',algolia:{appId:'2JINTHATAF',apiKey:'086110423d680367cda9c0216b336eb8',indexName:'blog.uuanqin.top',hitsPerPage:6,languages:{input_placeholder:'æœç´¢æ–‡ç« ',hits_empty:'æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}',hits_stats:'æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’'}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:'ç¹',msgToSimplifiedChinese:'ç®€'},highlight:{plugin:'highlight.js',highlightCopy:!0,highlightLang:!0,highlightHeightLimit:350,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:'å¤åˆ¶æˆåŠŸ',error:'å¤åˆ¶å¤±è´¥',noSupport:'æµè§ˆå™¨ä¸æ”¯æŒ'},relativeDate:{homepage:!0,post:!1},runtime:'',dateSuffix:{just:'åˆšåˆš',min:'åˆ†é’Ÿå‰',hour:'å°æ—¶å‰',day:'å¤©å‰',month:'ä¸ªæœˆå‰'},copyright:void 0,lightbox:'fancybox',Snackbar:{chs_to_cht:'å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡',cht_to_chs:'å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡',day_to_night:'å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼',night_to_day:'å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼',bgLight:'#177ecd',bgDark:'#1f1f1f',position:'top-center'},infinitegrid:{js:'https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js',buttonText:'åŠ è½½æ›´å¤š'},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1};</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:'æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite',isHighlightShrink:!1,isToc:!0,pageType:'post'};</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4037705_yv0gf35i5r.css"><link rel="stylesheet" href="/css/iconfont_custom.css"><script src="/js/random.js?8"></script><link rel="stylesheet" href="/css/seamless_card.css"><link rel="stylesheet" href="/css/footer.css?0814"><link rel="stylesheet" href="/css/darktheme_modify.css?0814"><link rel="stylesheet" href="/css/markdown-it-obsidian-callouts.css"><link rel="stylesheet" href="/css/bi-links.css"><link rel="stylesheet" href="/css/links-card.css"><link rel="stylesheet" href="/css/links-bilibili-card.css"><link rel="stylesheet" href="/css/links-art-card.css"><link rel="stylesheet" href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/KaTeX/0.16.9/katex.min.css"><meta name="google-site-verification" content="ppz3zz_ljO3DX-zHwknKzh4A9v_qNLtrhhpSDoCdps8"><link rel="stylesheet" href="/css/ai-summary.css"><link rel="stylesheet" href="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Swiper/4.1.6/css/swiper.min.css"><link rel="stylesheet" href="/css/swiperstyle.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="åŠæ–¹æ± æ°´åŠæ–¹ç”°" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/avatar.webp" onerror="this.onerror=null;this.src='/image/loading.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">177</div></a><a href="/pages/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">393</div></a><a href="/pages/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">26</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw icon-nongtian iconfont"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-guanli iconfont"></i><span> å½’æ¡£</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" href="/DO_NOT_render/cosmoscope/cosmoscope_trim.html"><i class="fa-fw icon-guanxitu iconfont"></i><span> å…³ç³»å›¾</span></a></li><li><a class="child site-page" href="/archives/"><i class="fa-fw icon-timeAxis iconfont"></i><span> æ—¶é—´è½´</span></a></li><li><a class="child site-page" href="/pages/categories/"><i class="fa-fw icon-2 iconfont"></i><span> åˆ†ç±»</span></a></li><li><a class="child site-page" href="/pages/tags/"><i class="fa-fw icon-24gf-tags iconfont"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-daimaguanli iconfont"></i><span> é¡¹ç›®</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/obsidian2cosma"><i class="fa-fw icon-xinghao iconfont"></i><span> PythonCLI obsidian2cosma</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/waline-link-interceptor"><i class="fa-fw icon-a-lanjiezudangzhangaiwuzuzhi iconfont"></i><span> waline-link-interceptor</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/hexo-filter-titlebased-link"><i class="fa-fw icon-line-bracketszhongkuohao iconfont"></i><span> hexo-filter-titlebased-link</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/markdown-it-obsidian-imgsize"><i class="fa-fw icon-daxiao iconfont"></i><span> markdown-it-obsidian-imgsize</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/busuanzi2waline"><i class="fa-fw icon-suantou iconfont"></i><span> PythonCLI busuanzi2waline</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6"><i class="fa-fw icon-yinyong iconfont"></i><span> UserScripts bibtex-TJU</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/hexo-filter-custom-link"><i class="fa-fw icon-neibujiekou iconfont"></i><span> hexo-filter-custom-link</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();" rel="external nofollow noreferrer"><i class="fa-fw icon-suijibofang iconfont"></i><span> éšæœº</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.travellings.cn/go-by-clouds.html"><i class="fa-fw icon-huochepiao iconfont"></i><span> å¼€å¾€</span></a></div><div class="menus_item"><a class="site-page" href="/pages/friends/"><i class="fa-fw icon-pengyoufill iconfont"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/pages/friend_circle/"><i class="fa-fw icon-pengyouquan iconfont"></i><span> æœ‹å‹åœˆ</span></a></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-guanfangwangzhan iconfont"></i><span> å…³äº</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" href="/pages/about.html"><i class="fa-fw icon-mao iconfont"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="child site-page" href="/sitemap.xml"><i class="fa-fw icon-ditu iconfont"></i><span> ç«™ç‚¹åœ°å›¾</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://pl.uuanqin.top/ui"><i class="fa-fw icon-w iconfont"></i><span> è¯„è®ºåå°</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://uuanqin.instatus.com/"><i class="fa-fw icon-jiankong iconfont"></i><span> ç«™ç‚¹çŠ¶æ€</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="fixed not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/image/logo-bc.webp" alt="Logo"><span class="site-name">åŠæ–¹æ± æ°´åŠæ–¹ç”°</span></a><a class="nav-page-title" href="/"><span class="site-name">æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite</span><span class="site-name"><i class="fa-circle-arrow-left fa-solid"></i><span> è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="search site-page social-icon"><i class="fa-fw fa-search fas"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw icon-nongtian iconfont"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-guanli iconfont"></i><span> å½’æ¡£</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" href="/DO_NOT_render/cosmoscope/cosmoscope_trim.html"><i class="fa-fw icon-guanxitu iconfont"></i><span> å…³ç³»å›¾</span></a></li><li><a class="child site-page" href="/archives/"><i class="fa-fw icon-timeAxis iconfont"></i><span> æ—¶é—´è½´</span></a></li><li><a class="child site-page" href="/pages/categories/"><i class="fa-fw icon-2 iconfont"></i><span> åˆ†ç±»</span></a></li><li><a class="child site-page" href="/pages/tags/"><i class="fa-fw icon-24gf-tags iconfont"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-daimaguanli iconfont"></i><span> é¡¹ç›®</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/obsidian2cosma"><i class="fa-fw icon-xinghao iconfont"></i><span> PythonCLI obsidian2cosma</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/waline-link-interceptor"><i class="fa-fw icon-a-lanjiezudangzhangaiwuzuzhi iconfont"></i><span> waline-link-interceptor</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/hexo-filter-titlebased-link"><i class="fa-fw icon-line-bracketszhongkuohao iconfont"></i><span> hexo-filter-titlebased-link</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/markdown-it-obsidian-imgsize"><i class="fa-fw icon-daxiao iconfont"></i><span> markdown-it-obsidian-imgsize</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/busuanzi2waline"><i class="fa-fw icon-suantou iconfont"></i><span> PythonCLI busuanzi2waline</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://greasyfork.org/zh-CN/scripts/466046-%E7%9F%A5%E7%BD%91-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE-bibtex-%E5%A4%A9%E6%B4%A5%E5%A4%A7%E5%AD%A6"><i class="fa-fw icon-yinyong iconfont"></i><span> UserScripts bibtex-TJU</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/uuanqin/hexo-filter-custom-link"><i class="fa-fw icon-neibujiekou iconfont"></i><span> hexo-filter-custom-link</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();" rel="external nofollow noreferrer"><i class="fa-fw icon-suijibofang iconfont"></i><span> éšæœº</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.travellings.cn/go-by-clouds.html"><i class="fa-fw icon-huochepiao iconfont"></i><span> å¼€å¾€</span></a></div><div class="menus_item"><a class="site-page" href="/pages/friends/"><i class="fa-fw icon-pengyoufill iconfont"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/pages/friend_circle/"><i class="fa-fw icon-pengyouquan iconfont"></i><span> æœ‹å‹åœˆ</span></a></div><div class="menus_item"><span class="group site-page"><i class="fa-fw icon-guanfangwangzhan iconfont"></i><span> å…³äº</span><i class="fa-chevron-down fas"></i></span><ul class="menus_item_child"><li><a class="child site-page" href="/pages/about.html"><i class="fa-fw icon-mao iconfont"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="child site-page" href="/sitemap.xml"><i class="fa-fw icon-ditu iconfont"></i><span> ç«™ç‚¹åœ°å›¾</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://pl.uuanqin.top/ui"><i class="fa-fw icon-w iconfont"></i><span> è¯„è®ºåå°</span></a></li><li><a class="child site-page" target="_blank" rel="external nofollow noopener noreferrer" href="https://uuanqin.instatus.com/"><i class="fa-fw icon-jiankong iconfont"></i><span> ç«™ç‚¹çŠ¶æ€</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fa-bars fa-fw fas"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">æˆ‘çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼šVercel+Redis+Hexo API+Spark Lite</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-calendar-alt fa-fw far post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-06-24T15:19:05.000Z" title="å‘è¡¨äº 2025-06-24 23:19:05">2025-06-24</time><span class="post-meta-separator">|</span><i class="fa-fw fa-history fas post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-07-05T11:37:00.772Z" title="æ›´æ–°äº 2025-07-05 19:37:00">2025-07-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fa-fw fa-inbox fas post-meta-icon"></i><a class="post-meta-categories" href="/pages/categories/%E5%8D%9A%E5%AE%A2%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/">åšå®¢ç«™ç‚¹ç»´æŠ¤</a><i class="fa-angle-right fas post-meta-separator"></i><i class="fa-fw fa-inbox fas post-meta-icon"></i><a class="post-meta-categories" href="/pages/categories/%E5%8D%9A%E5%AE%A2%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/Hexo/">Hexo</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="fa-file-word fa-fw far post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="fa-clock fa-fw far post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>34åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="fa-eye fa-fw far post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span class="waline-pageview-count" data-path="/p/75efe9f3/"><i class="fa-solid fa-spin fa-spinner"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="fa-comments fa-fw far post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/p/75efe9f3/#post-comment"><span class="waline-comment-count" data-path="/p/75efe9f3/"><i class="fa-solid fa-spin fa-spinner"></i></span></a></span></div></div></div><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è¿™ä¸ªé¡µé¢å·²ç»æœ‰&quot;,&quot;messageNext&quot;:&quot;å¤©æ²¡æœ‰æ›´æ–°äº†ï¼Œæ–‡ç« éƒ¨åˆ†å†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶&quot;,&quot;postUpdate&quot;:&quot;2025-07-05 19:37:00&quot;}" hidden=""></div><p>å‰æ®µæ—¶é—´çœ‹åˆ° <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.liushen.fun/">@LiuShen</a> å‘è¡¨äº†ä¸€ç¯‡åšå®¢æ–‡ç« ï¼Œæˆ‘ä¸ç¦æ„Ÿæ…¨ï¼šç»§å¯¹å‹é“¾æœ‹å‹åœˆæ”¹è¿›åï¼ŒæŸ³ç¥ç»ˆäºç›¯ä¸Š AI æ‘˜è¦çš„æ”¹è¿›äº†ï¼åœ¨ Liushen æ–‡ç« ä¸­æåˆ°äº† <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly93d3cua29ub3hpbi50b3Av">@konoXIN</a> é€šè¿‡ Vercel å‡½æ•°è°ƒç”¨å¤§æ¨¡å‹çš„æ–¹æ³•ï¼Œå¯¹æ­¤æˆ‘ä¹Ÿå—åˆ°å¯å‘ï¼Œæ‰“ç®—åŠ¨æ‰‹å°è¯•è‡ªå·±çš„ AI æ‘˜è¦è§£å†³æ–¹æ¡ˆã€‚</p> <p>ç›®å‰ï¼Œé™æ€åšå®¢ AI æ‘˜è¦å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p> <table> <thead> <tr> <th>AI æ‘˜è¦ç”Ÿæˆæ–¹å¼</th> <th>ä½œè€…éƒ¨ç½²é€Ÿåº¦</th> <th>è¯»è€…è·å–æ‘˜è¦é€Ÿåº¦</th> <th>è¯´æ˜</th> </tr> </thead> <tbody> <tr> <td>ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£</td> <td>ğŸŸ¢å¿«</td> <td>ğŸ”´æ…¢ï¼Œä½†å¯ä¼˜åŒ–</td> <td>ç›´æ¥è°ƒç”¨å¤§æ¨¡å‹æ¥å£å›ºç„¶å¾ˆæ…¢ï¼Œä½†é€šè¿‡å¼•å…¥å¤šçº§ç¼“å­˜ï¼Œæ‘˜è¦è·å–æ—¶é—´å¯å¤§å¤§ç¼©çŸ­ï¼Œè¿˜èƒ½èŠ‚çº¦æˆæœ¬ã€‚</td> </tr> <tr> <td>æœ¬åœ°é¢„æ„å»ºæ‘˜è¦</td> <td>ğŸ”´æ…¢</td> <td>ğŸŸ¢å¿«</td> <td>æœ¬åœ°é¢„æ„å»ºï¼Œç›¸å½“äºæŠŠè¯»è€…çš„è®¿é—®æ—¶é—´è½¬ç§»åˆ°ä½œè€…é¢„æ„å»ºçš„åšå®¢æ—¶é—´ã€‚è¿™ç§æ— åç«¯çš„é…ç½®æ–¹å¼çµæ´»å¯è°ƒã€‚</td> </tr> <tr> <td>ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡</td> <td colspan="2">ğŸŸ¡å–å†³äºæœåŠ¡</td> <td>ç¬¬ä¸‰æ–¹æ‘˜è¦æœåŠ¡å¯èƒ½ä¼šæ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œä½†æ˜¯èƒ½èŠ‚çœå¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›æˆæœ¬ã€‚</td> </tr> </tbody> </table> <p>ç›®å‰ï¼Œåšå®¢åœˆé‡Œæˆ‘äº†è§£åˆ°çš„ä¸Šé¢æ–¹æ¡ˆå¯¹åº”çš„å®ç°ï¼š</p> <table> <thead> <tr> <th>æ–¹æ¡ˆ</th> <th>ä½œè€…</th> <th>å‰ç«¯</th> <th>åç«¯</th> </tr> </thead> <tbody> <tr> <td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.zhheo.com/p/ec57d8b2.html">TianliGPT</a></td> <td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tianli-blog.club/">@Tianli</a></td> <td>å¼•å…¥ js æ–‡ä»¶/æ’ä»¶</td> <td>ç¬¬ä¸‰æ–¹åç«¯ç®¡ç†</td> </tr> <tr> <td>æ’ä»¶ <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.liushen.fun/posts/40702a0d/">hexo-ai-summary</a></td> <td><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.liushen.fun/">@LiuShen</a></td> <td>æ’ä»¶ + ä¿®æ”¹ä¸»é¢˜æºç </td> <td>æ— ï¼ˆæœ¬åœ°æå‰ç”Ÿæˆå¥½æ‘˜è¦ï¼‰</td> </tr> <tr> <td>è‡ªå®šä¹‰ <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly93d3cua29ub3hpbi50b3AvcG9zdHMvZGI3YjM0MTgv">Vercel ä»£ç†æ–¹æ¡ˆ</a></td> <td><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly93d3cua29ub3hpbi50b3Av">@konoXIN</a></td> <td>å¼•å…¥ js æ–‡ä»¶</td> <td>Vercel æ¥å£è½¬å‘</td> </tr> </tbody> </table> <p>TianliGPT æ–¹æ¡ˆæ˜¯æœ¬ç«™æœ€åˆé€‰æ‹©çš„æ–¹æ¡ˆï¼Œæœ‰ä¸“é—¨çš„åç«¯ç®¡ç†ï¼Œå†…å®¹åˆè§„ã€æ¨¡å‹é€‰æ‹©å•¥çš„åŸºæœ¬ä¸ç”¨æ“å¿ƒã€‚ç°åœ¨çš„ TianliGPT åœ¨å¤šæ¬¾ä¸»é¢˜ä¸‹ä¹Ÿå¼€å‘æœ‰å¤šæ¬¾æ’ä»¶ï¼Œå‰ç«¯éƒ¨ç½²ä¸æ˜¯é—®é¢˜ã€‚è¦æƒ³çœå¿ƒçœåŠ›ï¼Œé€‰æ‹© TianliGPT å°±è¡Œã€‚</p> <p>hexo-ai-summary æ˜¯å¤§ä½¬ Liushen æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ¬¾æ–¹æ¡ˆé€šè¿‡æå‰ç”Ÿæˆåšå®¢æ‘˜è¦åµŒå…¥åˆ°æ¯ç¯‡æ–‡ç« ä¸­ï¼Œè¯»è€…è®¿é—®æ–‡ç« å°±èƒ½è®¿é—®æ‘˜è¦ï¼Œæ²¡æœ‰é¢å¤–è¯·æ±‚æ—¶å»¶ä¸”ä¸ç”¨æ‹…å¿ƒå¦å¤–çš„ç³»ç»Ÿæ•…éšœï¼Œæ­¤å¤–å¯ä»¥çµæ´»æ›¿æ¢ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹ã€‚æ­¤æ–¹æ¡ˆæ˜¯é€Ÿåº¦ä¸çµæ´»æ€§åŒé‡å…¼é¡¾æ–¹æ¡ˆï¼Œè¦æƒ³è¯»è€…ä»¥æœ€å¿«çš„é€Ÿåº¦è·å–æ–‡ç« æ‘˜è¦ï¼Œé€‰æ‹© hexo-ai-summary å‡†æ²¡é”™ã€‚</p> <p>konoXIN ä¹Ÿå®ç°äº†è‡ªå·±çš„ AI æ‘˜è¦æ–¹æ¡ˆï¼Œç”¨æˆ·è®¿é—®æ–‡ç« æ—¶æºå¸¦æ–‡ç« å†…å®¹å‘é€è‡³ Vercelï¼ŒVercel å……å½“ä»£ç†è°ƒç”¨ LLM æ¥å£ï¼Œå¹¶å°†æœ€ç»ˆçš„æ‘˜è¦æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹æ¡ˆæœ´ç´ ã€ç»“æ„ç›´è§‚ä¸”æœ‰æ•ˆï¼Œç»™æƒ³åŠ¨ (zhe) æ‰‹ (teng) çš„äººæ›´å¤§çš„å‘æŒ¥ç©ºé—´ã€‚</p> <p>æœ¬æ–‡ä¸»è¦å‚è€ƒçš„æ˜¯ konoXIN çš„æ–‡ç« ï¼Œå¹¶åœ¨åŸæ–¹æ¡ˆçš„åŸºç¡€ä¸Šä½œå‡ºäº†æ”¹è¿›ã€‚ä½†æ€»çš„æ¥è¯´ä¸ä¼šæœ‰å‰é¢çš„æ–¹æ¡ˆé‚£ä¹ˆå®Œç¾ï¼Œåªèƒ½è¯´æ˜¯ä¸ªäººè¯•éªŒçš„å°ä½œå“ã€‚å½“ç„¶ä¹Ÿå¸Œæœ›å„ä½è¯»è€…åˆ†äº«ä½ ä»¬çš„æ–¹æ¡ˆä¸å»ºè®®ï¼ŒæœŸå¾…å’Œå„ä½å¤§ä½¬æ¢è®¨äº¤æµ ~</p> <h1 id="æˆ‘çš„æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#æˆ‘çš„æ–¹æ¡ˆ"></a> æˆ‘çš„æ–¹æ¡ˆ</h1> <h2 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h2> <p>ç›¸è¾ƒäº <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly93d3cua29ub3hpbi50b3AvcG9zdHMvZGI3YjM0MTgv">konoXIN çš„æ–¹æ¡ˆ</a>ï¼Œæœ¬æ–¹æ¡ˆæ”¹è¿›ç‚¹å’Œå¯ä¼˜åŒ–ç‚¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p> <table> <thead> <tr> <th>æ”¹è¿›ç‚¹</th> <th>å¯ä¼˜åŒ–ç‚¹ï¼ˆç¼ºç‚¹â€¦ï¼‰</th> </tr> </thead> <tbody> <tr> <td>æ ·å¼è°ƒæ•´ï¼š<br>âœ…æ ·å¼æ–‡ä»¶ä¸­ï¼Œåƒç´  px ç»Ÿä¸€ä½¿ç”¨ rem å•ä½<br>âœ…Hexo-Butterfly ä¸»é¢˜å¤œé—´æ¨¡å¼é€‚é…<br>âœ…å¤šä¸€ä¸ªã€Œå…³äºã€æŒ‰é’®<br><br>é€»è¾‘æ”¹è¿›ï¼š<br>âœ…é‡æ„å‰åç«¯ä»£ç ï¼Œå¢åŠ ä»£ç å¯è¯»æ€§<br>âœ…ä¼˜åŒ–å‰ç«¯è¯·æ±‚æ–¹å¼ï¼Œå‡å°‘ä¸å¿…è¦çš„å‚æ•°æºå¸¦<br>âœ…æœ¬åœ°ç¼“å­˜ + Vercel ä»£ç†ç«¯ Redis ç¼“å­˜<br>âœ…ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿</td> <td>ğŸŸ¥æ¨¡å—ä¾èµ–è¾ƒå¤æ‚ï¼Œæœ‰ä¸€å®šçš„è€¦åˆæ€§<br>ğŸŸ¥æ¨¡å‹çš„çµæ´»æ›¿æ¢åŠŸèƒ½è¿˜éœ€è¦é¢å¤–çš„ä»£ç é‡æ„<br>ğŸŸ¥ä»…é€‚åˆä¸ªäººå­¦ä¹ å‚è€ƒä½¿ç”¨<br>ğŸŸ¥API æ’ä»¶æä¾›çš„ä¿¡æ¯è¿‡å¤šï¼Œå­˜åœ¨å†—ä½™æˆ–å®‰å…¨é£é™©</td> </tr> </tbody> </table> <p>äº¤äº’æ—¶åºå›¾ï¼ˆSequence Diagramï¼‰å¦‚ä¸‹ï¼š</p> <pre><code class="highlight mermaid">sequenceDiagram
    actor U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant V as Vercel
    participant R as Redis
    participant L as å¤§æ¨¡å‹
    participant B as åšå®¢ API æœåŠ¡
    activate U
    U -&gt;&gt; F : è®¿é—®æ–‡ç« 
    activate F
    F -&gt;&gt; F : æŸ¥è¯¢æœ¬åœ°ç¼“å­˜
    activate F
    deactivate F
    alt æœ¬åœ°æ— ç¼“å­˜
        F -&gt;&gt; V : æ–‡ç« é“¾æ¥
        activate V
        V -&gt;&gt; R : æŸ¥è¯¢ç¼“å­˜
        activate R
        R --&gt;&gt; V : æŸ¥è¯¢ç»“æœ
        deactivate R
        alt æœåŠ¡ç«¯æ— ç¼“å­˜            
            V -&gt;&gt; B : è®¿é—®APIæ¥å£è·å–å…¨æ–‡
            activate B
            B --&gt;&gt; V : æ–‡ç« æ•°æ®
            deactivate B
            
            V -&gt;&gt; V : æ•°æ®æ¸…æ´—
            activate V
            deactivate V
            V -&gt;&gt; L : æç¤ºè¯ä¸æ¸…æ´—åçš„æ•°æ®
            activate L
            L --&gt;&gt; V : æ–‡ç« æ‘˜è¦
            deactivate L
            V -&gt;&gt; R : ç¼“å­˜
            activate R
            deactivate R   
        end
        V --&gt;&gt; F : æ–‡ç« æ‘˜è¦
        deactivate V
        F -&gt;&gt; F : æ‘˜è¦æœ¬åœ°ç¼“å­˜
        activate F
        deactivate F
    end
    F --&gt;&gt; U: æ–‡ç« æ‘˜è¦
    deactivate F
    deactivate U</code></pre> <p>ç¼“å­˜æ–¹æ¡ˆæ¦‚è¿°ï¼šç”¨æˆ·è®¿é—®æ–‡ç« æ—¶ï¼Œå…ˆæ‰¾æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜ä¸å‘½ä¸­åˆ™å‘é€è¯·æ±‚è‡³ Vercelã€‚Vercel æ¥å—è¯·æ±‚åï¼Œå…ˆä» Redis æ‰¾ç¼“å­˜ï¼ŒRedis ä¸å‘½ä¸­æ‰å‘å¤§æ¨¡å‹æœåŠ¡è·å–æ–‡ç« æ‘˜è¦ã€‚æ‰€æœ‰ç¼“å­˜çš„æ—¶é—´å‡ä¸º 1 å‘¨ã€‚</p> <h2 id="å‰ç«¯æ–‡ä»¶å¯¼å…¥"><a class="markdownIt-Anchor" href="#å‰ç«¯æ–‡ä»¶å¯¼å…¥"></a> å‰ç«¯ï¼šæ–‡ä»¶å¯¼å…¥</h2> <div class="callout" data-callout="note"> <div class="callout-title"> <div class="callout-title-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg> </div> <div class="callout-title-inner">æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«</div> </div> <div class="callout-content"><p></p> </div></div><p>æŒ‰ç…§è‡ªå·±ä¸»é¢˜çš„å¯¼å…¥æ–¹å¼å¼•å…¥ä»¥ä¸‹æ–‡ä»¶ï¼š</p> <ul> <li><code>ai-summary.js</code></li> <li><code>ai-summary.css</code></li> </ul> <p>hexo-butterfly ä¸»é¢˜å¯åœ¨ <code>_config.butterfly.yml</code> ä¸­é…ç½®ã€‚</p> <h2 id="åç«¯vercel-æä¾›çš„å‡½æ•°æœåŠ¡"><a class="markdownIt-Anchor" href="#åç«¯vercel-æä¾›çš„å‡½æ•°æœåŠ¡"></a> åç«¯ï¼šVercel æä¾›çš„å‡½æ•°æœåŠ¡</h2> <div class="callout" data-callout="note"> <div class="callout-title"> <div class="callout-title-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg> </div> <div class="callout-title-inner">æœ¬æ–‡æ‰€æœ‰ä»£ç æ–‡ä»¶å‡é™„äºæ–‡æœ«</div> </div> <div class="callout-content"><p></p> </div></div><p>æˆ‘ä»¬ä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ä»£ç†æ–‡ç« æ‘˜è¦è¯·æ±‚ã€‚å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="https://vercel.com/docs/functions">Vercel Functions</a>.</p> <p>å»ºä¸€ä¸ª GitHub ä»“ï¼Œé‡Œé¢ç¼–å†™ä»£ç†é€»è¾‘ä»¥åŠ Redis è°ƒç”¨é€»è¾‘ï¼Œç„¶åé€šè¿‡ Vercel å¯¼å…¥è¿™ä¸ªé¡¹ç›®ã€‚æˆ‘çš„ä»“åº“ç›®å½•å¦‚ä¸‹ï¼š</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506230041907.webp" alt="image.png" width="275px"></p> <p>æ–‡ä»¶è¯´æ˜ï¼š</p> <ul> <li><code>spark-lite.js</code>ï¼šç¼–å†™ä»£ç†é€»è¾‘ã€‚æ”¾åœ¨ <code>/api/ai-summary</code> ä¸‹ã€‚è®¿é—®æ—¶å¯é€šè¿‡ï¼š<code>https://your-custom-domain/api/ai-summary/spark-lite</code> è¿›è¡Œè®¿é—®ã€‚</li> <li><code>redis.js</code>ï¼šç”¨äºä½¿ç”¨ Redis æœåŠ¡ã€‚</li> </ul> <p>å¦‚ä»£ç æœ‰æ›´æ–°ï¼Œ<code>git push</code> åˆ°ä»£ç ä»“åï¼ŒVercel ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚Vercel è‡ªå®šä¹‰åŸŸåå¯è‡ªè¡Œé…ç½®ã€‚</p> <div class="callout" data-callout="warning"> <div class="callout-title"> <div class="callout-title-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg> </div> <div class="callout-title-inner">æ³¨æ„ï¼šä½¿ç”¨ Vercel å‡½æ•°æœåŠ¡ï¼Œç›¸å…³ JavaScript æ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨åä¸º <code>api</code> çš„æ–‡ä»¶å¤¹ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚</div> </div> <div class="callout-content"><p></p> </div></div><h3 id="è®¯é£æ˜Ÿç«-spark-lite"><a class="markdownIt-Anchor" href="#è®¯é£æ˜Ÿç«-spark-lite"></a> è®¯é£æ˜Ÿç« Spark Lite</h3> <p>åœ¨ <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9jb25zb2xlLnhmeXVuLmNuL3NlcnZpY2VzL2NibQ==">è®¯é£æ˜Ÿç«</a> ä¾§ç”³è¯·è‡ªå·±çš„å¤§æ¨¡å‹åº”ç”¨ï¼Œå¹¶ç”³è¯· Spark Lite çš„æ— é™ Tokenã€‚è®°ä¸‹ APPIDã€API_SECRETã€API_KEYã€API_PASSWORD å…³é”®ä¿¡æ¯ã€‚</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506242242844.webp" alt="image.png"></p> <p>æ‰“å¼€ Vercelï¼Œåˆ›å»ºå¯¹åº”çš„ç¯å¢ƒå˜é‡ä¾›åç»­ä½¿ç”¨ï¼š</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506242243395.webp" alt="image.png"></p> <h3 id="ä½¿ç”¨-vercel-ä¸­çš„-redis-é›†æˆæœåŠ¡"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-vercel-ä¸­çš„-redis-é›†æˆæœåŠ¡"></a> ä½¿ç”¨ Vercel ä¸­çš„ Redis é›†æˆæœåŠ¡</h3> <p>Redis æœåŠ¡å¯ä»¥è‡ªå·±å¦å¤–éƒ¨ç½²ï¼Œä¸”è¿˜èƒ½æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚æœ¬æ–‡ä»‹ç»çš„æ˜¯ Vercel ä¸­çš„ Redis é›†æˆç»„ä»¶ã€‚</p> <p>åœ¨ Vercel ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Redis é›†æˆç»„ä»¶ï¼š</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506230054761.webp" alt="image.png"></p> <p>é€‰æ‹© Redisï¼š</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506230054574.webp" alt="image.png"></p> <p>Vercel å…è´¹ç”¨æˆ·ï¼ˆHobby è®¡åˆ’ï¼‰å¯ä»¥å»ºä¸€ä¸ª 30MB çš„ï¼Œå‡è®¾æ¯ç¯‡æ‘˜è¦ 200 å­—å·¦å³ï¼Œè¿™äº›ç©ºé—´å¯ä»¥åº”ä»˜ä¸Šä¸‡ç¯‡æ–‡ç« æ‘˜è¦çš„éœ€æ±‚ï¼Œå¯¹äºä¸ªäººåšå®¢å¼€å‘è€…æ¥è¯´å®Œå…¨å¤Ÿç”¨ã€‚</p> <p>å°† Redis å…³è”åˆ° Vercel å¯¹åº”çš„é¡¹ç›®ä¸­ï¼Œè¿™æ ·é¡¹ç›®ä¸­å°±ä¼šå¤šå‡ºä¸€æ¡ç¯å¢ƒå˜é‡â€”â€”Redis æœåŠ¡çš„åœ°å€ã€‚</p> <p><img src="/image/loading.gif" data-lazy-src="https://cdn.gallery.uuanqin.top/img/202506242235748.webp" alt="image.png"></p> <p>å¦‚æœè¯¦çœ‹ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œé™¤äº†åœ¨ Vercel ç½‘ç«™ä¸Šçœ‹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°ä»£ç ä»“ä¸­ï¼š</p> <figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -g vercel <span class="comment"># å¦‚æœæ²¡å®‰è£… vercel CLI</span></span><br><span class="line">vercel <span class="built_in">env</span> pull .env.development.local <span class="comment"># æ‹‰å–ç¯å¢ƒå˜é‡ä¿¡æ¯</span></span><br></pre></td></tr></tbody></table></figure> <p>ä½¿ç”¨ Redis æœåŠ¡æ˜¯è®°å¾—å®‰è£…å¥½ç›¸åº”çš„åŒ…ï¼š<code>npm install redis</code>ã€‚å¹¶å°†ç”Ÿæˆçš„ <code>package.json</code> ä»¥åŠ <code>package-lock.json</code> ä¸€å¹¶åŠ å…¥åˆ°ä»£ç ä»“çš„ç‰ˆæœ¬ç®¡ç†ä¸­ã€‚</p> <h2 id="å®‰è£…-api-æ’ä»¶"><a class="markdownIt-Anchor" href="#å®‰è£…-api-æ’ä»¶"></a> å®‰è£… API æ’ä»¶</h2> <p>æ’ä»¶æ˜¯åœ¨ Hexo æ’ä»¶åˆ—è¡¨æ‰¾çš„ï¼ŒåŸºæœ¬ç¬¦åˆæˆ‘çš„è¦æ±‚ã€‚å®‰è£…è¿™ä¸ªæ’ä»¶å¹¶æ ¹æ®è‡ªå·±çš„æƒ…å†µé…ç½®å³å¯ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wherewhere/hexo-generator-apis">wherewhere/hexo-generator-apis: Generate restful json data for Hexo plugins</a></p> <p>é€šè¿‡ <code>/api/posts/{path}.json</code> è¯·æ±‚å¯ä»¥å¾—åˆ°æ–‡ç« å…ƒä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ–‡ç« å…¨æ–‡æ•°æ®ã€‚Hexo åšå®¢éƒ¨ç½²åï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹è°ƒç”¨è¿™ä¸ª APIã€‚</p> <h1 id="ä»£ç æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä»£ç æ–‡ä»¶"></a> ä»£ç æ–‡ä»¶</h1> <h2 id="ai-summaryjs"><a class="markdownIt-Anchor" href="#ai-summaryjs"></a> <code>ai-summary.js</code></h2> <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ ·å¼å¸¸é‡ - ä¾¿äºé›†ä¸­ç®¡ç†å’Œä¿®æ”¹</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">LEFT_STYLE</span> = <span class="string">"color: #fadfa3; background: #030307; padding:5px 0;"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">RIGHT_STYLE</span> = <span class="string">"background: #fadfa3; padding:5px 0;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºæ¶ˆæ¯æ¨¡æ¿ - ä½¿ç”¨å¤šè¡Œæ¨¡æ¿å­—ç¬¦ä¸²ä¿æŒè§†è§‰ç»“æ„</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">MESSAGE_TEMPLATE</span> = <span class="string">`</span></span><br><span class="line"><span class="string"> %c Spark Lite æ–‡ç« æ‘˜è¦AIç”Ÿæˆ %c https://uuanqin.top/ </span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">PROXY_API_URL</span> = <span class="string">"https://ai-summary.uuanqin.top/api/ai-summary/spark-lite"</span>; <span class="comment">// è¿™é‡Œå¡«çš„æ˜¯ Vercel çš„åœ°å€</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">LINK_AI_ABOUT</span> = <span class="string">"https://blog.uuanqin.top/p/75efe9f3/"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºæ ¼å¼åŒ–æ§åˆ¶å°æ¶ˆæ¯</span></span><br><span class="line"><span class="language_ variable">console</span>.<span class="function_ title">log</span>(</span><br><span class="line">    <span class="constant_ variable">MESSAGE_TEMPLATE</span>,</span><br><span class="line">    <span class="constant_ variable">LEFT_STYLE</span>,</span><br><span class="line">    <span class="constant_ variable">RIGHT_STYLE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- å…¶ä»–é…ç½® (æ ¹æ®éœ€è¦è°ƒæ•´) ---</span></span><br><span class="line"><span class="keyword">const</span> sparkLite_postSelector = <span class="string">"#article-container"</span>; <span class="comment">// æ–‡ç« å†…å®¹å®¹å™¨çš„é€‰æ‹©å™¨ï¼Œä¾‹å¦‚ #article-container, .post-content</span></span><br><span class="line"><span class="keyword">const</span> sparkLite_wordLimit = <span class="number">1000</span>;             <span class="comment">// æäº¤ç»™ API çš„æœ€å¤§å­—æ•°é™åˆ¶</span></span><br><span class="line"><span class="keyword">const</span> sparkLite_typingAnimate = <span class="literal">true</span>;         <span class="comment">// æ˜¯å¦å¯ç”¨æ‰“å­—æœºæ•ˆæœ</span></span><br><span class="line"><span class="comment">// æŒ‡å®šåšå®¢æ–‡ç« URLç±»å‹ï¼Œåªåœ¨è¿™æ ·çš„ç•Œé¢ä¸Šç”Ÿæˆaiæ‘˜è¦</span></span><br><span class="line"><span class="comment">// é€šé…ç¬¦å†™æ³•</span></span><br><span class="line"><span class="keyword">const</span> sparkLite_postURLs = [</span><br><span class="line">    <span class="comment">// "https://*.uuanqin.top/p/*",</span></span><br><span class="line">    <span class="comment">// "http://localhost:*/p/*"</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// æ­£åˆ™å†™æ³•</span></span><br><span class="line"><span class="keyword">const</span> sparkLite_postURLs_regex = [</span><br><span class="line">    <span class="regexp">/^https:\/\/.*\.uuanqin\.top\/p\/[0-9a-fA-F]+\/$/</span>,</span><br><span class="line">    <span class="regexp">/^http:\/\/localhost:4000\/p\/[0-9a-fA-F]+\/$/</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">MILLISECONDS_OF_A_WEEK</span> = <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sparkLite_localCacheTime = <span class="constant_ variable">MILLISECONDS_OF_A_WEEK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="function_ title">initDB</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class_ title">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">const</span> request = indexedDB.<span class="function_ title">open</span>(<span class="string">'SparkLiteDB'</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        request.<span class="property">onupgradeneeded</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">const</span> db = e.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">            <span class="keyword">if</span> (!db.<span class="property">objectStoreNames</span>.<span class="function_ title">contains</span>(<span class="string">'summaries'</span>)) {</span><br><span class="line">                <span class="keyword">const</span> store = db.<span class="function_ title">createObjectStore</span>(<span class="string">'summaries'</span>, {<span class="attr">keyPath</span>: <span class="string">'url'</span>});</span><br><span class="line">                store.<span class="function_ title">createIndex</span>(<span class="string">'timestamp'</span>, <span class="string">'timestamp'</span>, {<span class="attr">unique</span>: <span class="literal">false</span>});</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        request.<span class="property">onsuccess</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="function_ title">resolve</span>(e.<span class="property">target</span>.<span class="property">result</span>);</span><br><span class="line">        request.<span class="property">onerror</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="function_ title">reject</span>(e.<span class="property">target</span>.<span class="property">error</span>);</span><br><span class="line">    });</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sparkLiteIsRunning = <span class="literal">false</span>; <span class="comment">// é‡å‘½å</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- insertAIDiv å‡½æ•° ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">insertAIDiv</span>(<span class="params">selector</span>) {</span><br><span class="line">    <span class="comment">// é¦–å…ˆç§»é™¤ç°æœ‰çš„ "post-SparkLite" ç±»å…ƒç´ ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span></span><br><span class="line">    <span class="function_ title">removeExistingAIDiv</span>(); <span class="comment">// éœ€è¦åŒæ­¥ä¿®æ”¹ removeExistingAIDiv å‡½æ•°é€‰æ‹©å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç›®æ ‡å…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> targetElement = <span class="language_ variable">document</span>.<span class="function_ title">querySelector</span>(selector);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡å…ƒç´ ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (!targetElement) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè¦æ’å…¥çš„HTMLå…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> aiDiv = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">    aiDiv.<span class="property">className</span> = <span class="string">'post-SparkLite'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiTitleDiv = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">    aiTitleDiv.<span class="property">className</span> = <span class="string">'sparkLite-title'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiDiv.<span class="function_ title">appendChild</span>(aiTitleDiv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiIcon = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'i'</span>);</span><br><span class="line">    aiIcon.<span class="property">className</span> = <span class="string">'sparkLite-title-icon'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiTitleDiv.<span class="function_ title">appendChild</span>(aiIcon);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’å…¥ SVG å›¾æ ‡ (ä¿æŒä¸å˜æˆ–æ›¿æ¢)</span></span><br><span class="line">    aiIcon.<span class="property">innerHTML</span> = <span class="string">`&lt;svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='48px' height='48px' viewBox='0 0 48 48'&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;æœºå™¨äºº&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;g id='æœºå™¨äºº' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'&gt;</span></span><br><span class="line"><span class="string">    &lt;path d='M34.717885,5.03561087 C36.12744,5.27055371 37.079755,6.60373651 36.84481,8.0132786 L35.7944,14.3153359 L38.375,14.3153359 C43.138415,14.3153359 47,18.1768855 47,22.9402569 L47,34.4401516 C47,39.203523 43.138415,43.0650727 38.375,43.0650727 L9.625,43.0650727 C4.861585,43.0650727 1,39.203523 1,34.4401516 L1,22.9402569 C1,18.1768855 4.861585,14.3153359 9.625,14.3153359 L12.2056,14.3153359 L11.15519,8.0132786 C10.920245,6.60373651 11.87256,5.27055371 13.282115,5.03561087 C14.69167,4.80066802 16.024865,5.7529743 16.25981,7.16251639 L17.40981,14.0624532 C17.423955,14.1470924 17.43373,14.2315017 17.43948,14.3153359 L30.56052,14.3153359 C30.56627,14.2313867 30.576045,14.1470924 30.59019,14.0624532 L31.74019,7.16251639 C31.975135,5.7529743 33.30833,4.80066802 34.717885,5.03561087 Z M38.375,19.4902885 L9.625,19.4902885 C7.719565,19.4902885 6.175,21.0348394 6.175,22.9402569 L6.175,34.4401516 C6.175,36.3455692 7.719565,37.89012 9.625,37.89012 L38.375,37.89012 C40.280435,37.89012 41.825,36.3455692 41.825,34.4401516 L41.825,22.9402569 C41.825,21.0348394 40.280435,19.4902885 38.375,19.4902885 Z M14.8575,23.802749 C16.28649,23.802749 17.445,24.9612484 17.445,26.3902253 L17.445,28.6902043 C17.445,30.1191812 16.28649,31.2776806 14.8575,31.2776806 C13.42851,31.2776806 12.27,30.1191812 12.27,28.6902043 L12.27,26.3902253 C12.27,24.9612484 13.42851,23.802749 14.8575,23.802749 Z M33.1425,23.802749 C34.57149,23.802749 35.73,24.9612484 35.73,26.3902253 L35.73,28.6902043 C35.73,30.1191812 34.57149,31.2776806 33.1425,31.2776806 C31.71351,31.2776806 30.555,30.1191812 30.555,28.6902043 L30.555,26.3902253 C30.555,24.9612484 31.71351,23.802749 33.1425,23.802749 Z' id='å½¢çŠ¶ç»“åˆ' fill='#444444' fill-rule='nonzero'&gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">  &lt;/g&gt;</span></span><br><span class="line"><span class="string">  &lt;/svg&gt;`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiTitleTextDiv = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">    aiTitleTextDiv.<span class="property">className</span> = <span class="string">'sparkLite-title-text'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiTitleTextDiv.<span class="property">textContent</span> = <span class="string">'AI æ‘˜è¦'</span>;</span><br><span class="line">    aiTitleDiv.<span class="function_ title">appendChild</span>(aiTitleTextDiv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiAboutLink = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'a'</span>);</span><br><span class="line">    aiAboutLink.<span class="property">href</span> = <span class="constant_ variable">LINK_AI_ABOUT</span>;</span><br><span class="line">    aiAboutLink.<span class="property">target</span> = <span class="string">'_blank'</span>; <span class="comment">// å¯é€‰ï¼šåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€</span></span><br><span class="line">    aiAboutLink.<span class="property">className</span> = <span class="string">'sparkLite-about'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiAboutLink.<span class="property">style</span>.<span class="property">color</span> = <span class="string">'var(--ai-summary-lighttext)'</span>; <span class="comment">// å†…è”æ ·å¼é˜²æ­¢è¦†å†™</span></span><br><span class="line">    aiAboutLink.<span class="property">id</span> = <span class="string">'sparkLite-about'</span>; <span class="comment">// ä¿®æ”¹ ID</span></span><br><span class="line">    aiAboutLink.<span class="property">textContent</span> = <span class="string">'å…³äº'</span>; <span class="comment">// ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    aiTitleDiv.<span class="function_ title">appendChild</span>(aiAboutLink);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiTagDiv = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">    aiTagDiv.<span class="property">className</span> = <span class="string">'sparkLite-tag'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiTagDiv.<span class="property">id</span> = <span class="string">'sparkLite-tag'</span>; <span class="comment">// ä¿®æ”¹ ID</span></span><br><span class="line">    aiTagDiv.<span class="property">textContent</span> = <span class="string">'Spark Lite'</span>; <span class="comment">// ä¿®æ”¹æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    aiTitleDiv.<span class="function_ title">appendChild</span>(aiTagDiv);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> aiExplanationDiv = <span class="language_ variable">document</span>.<span class="function_ title">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">    aiExplanationDiv.<span class="property">className</span> = <span class="string">'sparkLite-explanation'</span>; <span class="comment">// ä¿®æ”¹ç±»å</span></span><br><span class="line">    aiExplanationDiv.<span class="property">innerHTML</span> = <span class="string">'ç”Ÿæˆä¸­...'</span> + <span class="string">'&lt;span class="blinking-cursor"&gt;&lt;/span&gt;'</span>;</span><br><span class="line">    aiDiv.<span class="function_ title">appendChild</span>(aiExplanationDiv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†åˆ›å»ºçš„å…ƒç´ æ’å…¥åˆ°ç›®æ ‡å…ƒç´ çš„é¡¶éƒ¨</span></span><br><span class="line">    targetElement.<span class="function_ title">insertBefore</span>(aiDiv, targetElement.<span class="property">firstChild</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- removeExistingAIDiv å‡½æ•° ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">removeExistingAIDiv</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å…·æœ‰ "post-SparkLite" ç±»çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> existingAIDiv = <span class="language_ variable">document</span>.<span class="function_ title">querySelector</span>(<span class="string">".post-SparkLite"</span>); <span class="comment">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªå…ƒç´ ï¼Œå°±ä»å…¶çˆ¶å…ƒç´ ä¸­åˆ é™¤å®ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (existingAIDiv) {</span><br><span class="line">        existingAIDiv.<span class="property">parentElement</span>.<span class="function_ title">removeChild</span>(existingAIDiv);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- ä¸»è¦é€»è¾‘å¯¹è±¡ ---</span></span><br><span class="line"><span class="keyword">const</span> sparkLite = { <span class="comment">// é‡å‘½åå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// --- fetchSparkLiteSummary å‡½æ•° (æ ¸å¿ƒä¿®æ”¹) ---</span></span><br><span class="line">    <span class="attr">fetchSparkLiteSummary</span>: <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">        <span class="comment">// const title = document.title;</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="language_ variable">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆå°è¯•ä»IndexedDBè¯»å–</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="function_ title">initDB</span>();</span><br><span class="line">            <span class="keyword">const</span> tx = db.<span class="function_ title">transaction</span>(<span class="string">'summaries'</span>, <span class="string">'readonly'</span>);</span><br><span class="line">            <span class="keyword">const</span> store = tx.<span class="function_ title">objectStore</span>(<span class="string">'summaries'</span>);</span><br><span class="line">            <span class="keyword">const</span> request = store.<span class="function_ title">get</span>(url);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> cachedData = <span class="keyword">await</span> <span class="keyword">new</span> <span class="class_ title">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> {</span><br><span class="line">                request.<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> <span class="function_ title">resolve</span>(request.<span class="property">result</span>);</span><br><span class="line">                request.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="function_ title">resolve</span>(<span class="literal">null</span>);</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cachedData?.<span class="property">summary</span>) {</span><br><span class="line">                <span class="comment">// æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> isExpired = <span class="class_ title">Date</span>.<span class="function_ title">now</span>() - cachedData.<span class="property">timestamp</span> &gt; sparkLite_localCacheTime;</span><br><span class="line">                <span class="keyword">if</span> (!isExpired) {</span><br><span class="line">                    <span class="keyword">return</span> cachedData.<span class="property">summary</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (e) {</span><br><span class="line">            <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘è¯»å– IndexedDB ç¼“å­˜å¤±è´¥'</span>, e);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> requestDataToProxy = {<span class="attr">post_url</span>: url};<span class="comment">// {content: content, title: title};</span></span><br><span class="line">        <span class="keyword">const</span> timeout = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="class_ title">AbortController</span>();</span><br><span class="line">            <span class="keyword">const</span> timeoutId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> controller.<span class="function_ title">abort</span>(), timeout);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function_ title">fetch</span>(<span class="constant_ variable">PROXY_API_URL</span>, {</span><br><span class="line">                <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">                <span class="attr">headers</span>: {<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>},</span><br><span class="line">                <span class="attr">body</span>: <span class="class_ title">JSON</span>.<span class="function_ title">stringify</span>(requestDataToProxy),</span><br><span class="line">                <span class="attr">signal</span>: controller.<span class="property">signal</span></span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            <span class="built_in">clearTimeout</span>(timeoutId);</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function_ title">json</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (response.<span class="property">ok</span>) {</span><br><span class="line">                <span class="comment">// æˆåŠŸè·å–æ‘˜è¦åå­˜å…¥IndexedDB</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="function_ title">initDB</span>();</span><br><span class="line">                    <span class="keyword">const</span> tx = db.<span class="function_ title">transaction</span>(<span class="string">'summaries'</span>, <span class="string">'readwrite'</span>);</span><br><span class="line">                    tx.<span class="function_ title">objectStore</span>(<span class="string">'summaries'</span>).<span class="function_ title">put</span>({</span><br><span class="line">                        <span class="attr">url</span>: url,</span><br><span class="line">                        <span class="attr">summary</span>: data.<span class="property">summary</span>,</span><br><span class="line">                        <span class="attr">timestamp</span>: <span class="class_ title">Date</span>.<span class="function_ title">now</span>()</span><br><span class="line">                    });</span><br><span class="line">                } <span class="keyword">catch</span> (e) {</span><br><span class="line">                    <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘IndexedDB å†™å…¥å¤±è´¥'</span>, e);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> data.<span class="property">summary</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">`ã€AI æ‘˜è¦å‰ç«¯ã€‘ä»£ç†æˆ– API é”™è¯¯: <span class="subst">${data.error || response.statusText}</span>`</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ‘˜è¦å¤±è´¥: <span class="subst">${data.error || <span class="string">`HTTP çŠ¶æ€ç : <span class="subst">${response.status}</span>`</span>}</span>`</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (error) {</span><br><span class="line">            <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">'AbortError'</span>) {</span><br><span class="line">                <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚è¶…æ—¶ (é€šè¿‡ä»£ç†)'</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦è¶…æ—¶ï¼Œè¯·ç¨ååˆ·æ–°é‡è¯•ã€‚'</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘Spark Lite è¯·æ±‚å¤±è´¥ (é€šè¿‡ä»£ç†)ï¼š'</span>, error);</span><br><span class="line">                <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="class_ title">SyntaxError</span>) {</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼šä»£ç†æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯ã€‚'</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'ã€AI æ‘˜è¦å‰ç«¯ã€‘è·å–æ–‡ç« æ‘˜è¦å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†æœåŠ¡å™¨çŠ¶æ€ã€‚'</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --- aiShowAnimation å‡½æ•° ---</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä¿®æ”¹ console.error å’Œ element.innerHTML ä¸­çš„ "TianliGPT" ä¸º "Spark Lite"</span></span><br><span class="line">    <span class="attr">aiShowAnimation</span>: <span class="keyword">function</span> (<span class="params">text</span>) {</span><br><span class="line">        <span class="keyword">const</span> element = <span class="language_ variable">document</span>.<span class="function_ title">querySelector</span>(<span class="string">".sparkLite-explanation"</span>); <span class="comment">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class="line">        <span class="keyword">if</span> (!element) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sparkLiteIsRunning) { <span class="comment">// ä¿®æ”¹å˜é‡å</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å®šä¹‰ sparkLite_typingAnimate</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> sparkLite_typingAnimate !== <span class="string">"undefined"</span> &amp;&amp; !sparkLite_typingAnimate) { <span class="comment">// ä¿®æ”¹å˜é‡å</span></span><br><span class="line">            element.<span class="property">innerHTML</span> = text;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        sparkLiteIsRunning = <span class="literal">true</span>; <span class="comment">// ä¿®æ”¹å˜é‡å</span></span><br><span class="line">        <span class="keyword">const</span> typingDelay = <span class="number">25</span>;</span><br><span class="line">        <span class="keyword">const</span> waitingTime = <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">const</span> punctuationDelayMultiplier = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">        element.<span class="property">style</span>.<span class="property">display</span> = <span class="string">"block"</span>;</span><br><span class="line">        element.<span class="property">innerHTML</span> = <span class="string">`ç”Ÿæˆä¸­...&lt;span class='blinking-cursor'&gt;&lt;/span&gt;`</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> animationRunning = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">let</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> initialAnimation = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">let</span> lastUpdateTime = performance.<span class="function_ title">now</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="function_ title">animate</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">            <span class="keyword">if</span> (currentIndex &lt; text.<span class="property">length</span> &amp;&amp; animationRunning) {</span><br><span class="line">                <span class="keyword">const</span> currentTime = performance.<span class="function_ title">now</span>();</span><br><span class="line">                <span class="keyword">const</span> timeDiff = currentTime - lastUpdateTime;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> letter = text.<span class="function_ title">slice</span>(currentIndex, currentIndex + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">const</span> isPunctuation = <span class="regexp">/[ï¼Œã€‚ï¼ã€ï¼Ÿ,.!?]/</span>.<span class="function_ title">test</span>(letter);</span><br><span class="line">                <span class="keyword">const</span> delay = isPunctuation ? typingDelay * punctuationDelayMultiplier : typingDelay;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (timeDiff &gt;= delay) {</span><br><span class="line">                    element.<span class="property">innerText</span> = text.<span class="function_ title">slice</span>(<span class="number">0</span>, currentIndex + <span class="number">1</span>);</span><br><span class="line">                    lastUpdateTime = currentTime;</span><br><span class="line">                    currentIndex++;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (currentIndex &lt; text.<span class="property">length</span>) {</span><br><span class="line">                        element.<span class="property">innerHTML</span> =</span><br><span class="line">                            text.<span class="function_ title">slice</span>(<span class="number">0</span>, currentIndex) +</span><br><span class="line">                            <span class="string">'&lt;span class="blinking-cursor"&gt;&lt;/span&gt;'</span>;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        element.<span class="property">innerHTML</span> = text;</span><br><span class="line">                        element.<span class="property">style</span>.<span class="property">display</span> = <span class="string">"block"</span>;</span><br><span class="line">                        sparkLiteIsRunning = <span class="literal">false</span>; <span class="comment">// ä¿®æ”¹å˜é‡å</span></span><br><span class="line">                        observer.<span class="function_ title">disconnect</span>();<span class="comment">// æš‚åœç›‘å¬</span></span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="function_ title">requestAnimationFrame</span>(animate);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨IntersectionObserverå¯¹è±¡ä¼˜åŒ–aiç¦»å¼€è§†å£åæš‚åœçš„ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜æ€§èƒ½</span></span><br><span class="line">        <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="class_ title">IntersectionObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> {</span><br><span class="line">            animationRunning = entries[<span class="number">0</span>].<span class="property">isIntersecting</span>; <span class="comment">// æ ‡å¿—å˜é‡æ›´æ–°</span></span><br><span class="line">            <span class="keyword">if</span> (animationRunning &amp;&amp; initialAnimation) {</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">                    <span class="function_ title">requestAnimationFrame</span>(animate);</span><br><span class="line">                }, <span class="number">200</span>);</span><br><span class="line">            }</span><br><span class="line">        }, {<span class="attr">threshold</span>: <span class="number">0</span>});</span><br><span class="line">        <span class="keyword">let</span> post_ai = <span class="language_ variable">document</span>.<span class="function_ title">querySelector</span>(<span class="string">'.post-SparkLite'</span>); <span class="comment">// ä¿®æ”¹é€‰æ‹©å™¨</span></span><br><span class="line">        observer.<span class="function_ title">observe</span>(post_ai);<span class="comment">//å¯åŠ¨æ–°ç›‘å¬</span></span><br><span class="line">    },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- runSparkLite å‡½æ•° (ä¿æŒä¸å˜) ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">runSparkLite</span>(<span class="params"></span>) { <span class="comment">// é‡å‘½åå‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç¡®ä¿åœ¨è¿è¡Œå‰ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§divï¼Œé˜²æ­¢é‡å¤æ·»åŠ </span></span><br><span class="line">    <span class="function_ title">removeExistingAIDiv</span>();</span><br><span class="line">    <span class="comment">// æ’å…¥æ–°çš„å ä½ç¬¦</span></span><br><span class="line">    <span class="function_ title">insertAIDiv</span>(sparkLite_postSelector);</span><br><span class="line">    <span class="comment">// const content = sparkLite.getTitleAndContent(); // è°ƒç”¨é‡å‘½ååçš„å¯¹è±¡å’Œæ–¹æ³•</span></span><br><span class="line">    <span class="comment">// if (content) {</span></span><br><span class="line">    <span class="comment">//     // console.log('Spark Lite æœ¬æ¬¡æäº¤çš„å†…å®¹ä¸ºï¼š' + content); // ä¿®æ”¹æ—¥å¿—æ–‡æœ¬</span></span><br><span class="line">    <span class="comment">// } else {</span></span><br><span class="line">    <span class="comment">//     // å¦‚æœæ²¡æœ‰è·å–åˆ°å†…å®¹ï¼Œå¯èƒ½éœ€è¦ç§»é™¤å ä½ç¬¦æˆ–æ˜¾ç¤ºé”™è¯¯</span></span><br><span class="line">    <span class="comment">//     const aiExplanationDiv = document.querySelector(".sparkLite-explanation");</span></span><br><span class="line">    <span class="comment">//     if (aiExplanationDiv) {</span></span><br><span class="line">    <span class="comment">//         aiExplanationDiv.textContent = 'æœªèƒ½è·å–åˆ°æ–‡ç« å†…å®¹ï¼Œæ— æ³•ç”Ÿæˆæ‘˜è¦ã€‚';</span></span><br><span class="line">    <span class="comment">//     }</span></span><br><span class="line">    <span class="comment">//     return; // æå‰é€€å‡ºï¼Œä¸è¿›è¡Œ fetch</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    sparkLite.<span class="function_ title">fetchSparkLiteSummary</span>().<span class="function_ title">then</span>(<span class="function"><span class="params">summary</span> =&gt;</span> { <span class="comment">// è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•</span></span><br><span class="line">        sparkLite.<span class="function_ title">aiShowAnimation</span>(summary); <span class="comment">// è°ƒç”¨é‡å‘½ååçš„æ–¹æ³•</span></span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- checkURLAndRun å‡½æ•° (ç¨å¾®è°ƒæ•´ï¼Œä¸»è¦è´Ÿè´£URLæ£€æŸ¥) ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">checkURLAndRun</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ AI æ˜¯å¦å·²åœ¨è¿è¡Œï¼Œé˜²æ­¢é‡å¤å¯åŠ¨åŠ¨ç”»ç­‰</span></span><br><span class="line">    <span class="keyword">if</span> (sparkLiteIsRunning) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// è¿”å› false è¡¨ç¤ºä¸åº”ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ AI å®¹å™¨æ˜¯å¦å·²å­˜åœ¨ (å¦‚æœå­˜åœ¨ï¼Œç†è®ºä¸Šä¸åº”å†æ¬¡è¿è¡Œå®Œæ•´æµç¨‹ï¼Œé™¤éæ˜¯å†…å®¹æ›´æ–°)</span></span><br><span class="line">    <span class="comment">// ä¸ºç®€åŒ–é€»è¾‘ï¼Œæˆ‘ä»¬å…è®¸å®ƒç»§ç»­ï¼ŒrunSparkLiteå†…éƒ¨ä¼šå¤„ç†ç§»é™¤å’Œé‡æ–°æ’å…¥</span></span><br><span class="line">    <span class="comment">// if (document.querySelector(".post-SparkLite")) {</span></span><br><span class="line">    <span class="comment">//     return false;</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// URL æ£€æŸ¥é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> sparkLite_postURLs === <span class="string">"undefined"</span> &amp;&amp; <span class="keyword">typeof</span> sparkLite_postURLs_regex === <span class="string">"undefined"</span>) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">"ã€AI æ‘˜è¦å‰ç«¯ã€‘æ²¡æœ‰è®¾ç½®é¡µé¢é“¾æ¥æ¨¡æ¿ï¼Œæ‰€ä»¥æˆ‘ä¸ºæ¯ä¸ªé¡µé¢éƒ½ç”Ÿæˆaiæ‘˜è¦."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// è¿”å› true è¡¨ç¤ºæ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥è¿è¡Œ</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> <span class="function_ title">regExpEscape</span> = (<span class="params">s</span>) =&gt; {</span><br><span class="line">            <span class="keyword">return</span> s.<span class="function_ title">replace</span>(<span class="regexp">/[|\\{}()[\]^$+*?.]/g</span>, <span class="string">'\\$&amp;'</span>);</span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">const</span> <span class="function_ title">wildcardToRegExp</span> = (<span class="params">s</span>) =&gt; {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="class_ title">RegExp</span>(<span class="string">'^'</span> + s.<span class="function_ title">split</span>(<span class="regexp">/\*+/</span>).<span class="function_ title">map</span>(regExpEscape).<span class="function_ title">join</span>(<span class="string">'.*'</span>) + <span class="string">'$'</span>);</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> currentURL = <span class="language_ variable">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> customPattern = sparkLite_postURLs.<span class="function_ title">map</span>(wildcardToRegExp);</span><br><span class="line">        <span class="keyword">const</span> urlPattern = [...customPattern, ...(sparkLite_postURLs_regex)];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•æŸä¸ª URL æ˜¯å¦åŒ¹é…ä»»æ„ä¸€ä¸ªè§„åˆ™</span></span><br><span class="line">        <span class="keyword">const</span> <span class="function_ title">testURL</span> = (<span class="params">url</span>) =&gt; {</span><br><span class="line">            <span class="keyword">return</span> urlPattern.<span class="function_ title">some</span>(<span class="function"><span class="params">re</span> =&gt;</span> re.<span class="function_ title">test</span>(url));</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="function_ title">testURL</span>(currentURL)) {</span><br><span class="line">            <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">"ã€AI æ‘˜è¦å‰ç«¯ã€‘åŒ¹é…åˆ°äº†é¡µé¢URLï¼Œå°†åœ¨æ­¤é¡µé¢ç”Ÿæˆæ‘˜è¦"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// URLåŒ¹é…ï¼Œæ£€æŸ¥é€šè¿‡</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">"ã€AI æ‘˜è¦å‰ç«¯ã€‘å› ä¸ºä¸ç¬¦åˆè‡ªå®šä¹‰çš„é“¾æ¥è§„åˆ™ï¼Œæˆ‘å†³å®šä¸æ‰§è¡Œæ‘˜è¦åŠŸèƒ½ã€‚"</span>);</span><br><span class="line">            <span class="function_ title">removeExistingAIDiv</span>(); <span class="comment">// å¦‚æœURLä¸åŒ¹é…äº†ï¼Œç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§AIæ¡†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// URLä¸åŒ¹é…ï¼Œæ£€æŸ¥ä¸é€šè¿‡</span></span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"ã€AI æ‘˜è¦å‰ç«¯ã€‘æˆ‘æ²¡æœ‰çœ‹æ‡‚ä½ ç¼–å†™çš„è‡ªå®šä¹‰é“¾æ¥è§„åˆ™..."</span>, error);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// å‡ºé”™ï¼Œæ£€æŸ¥ä¸é€šè¿‡</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- æ–°å¢ï¼šç»Ÿä¸€çš„åˆå§‹åŒ–å…¥å£å‡½æ•° ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">initializeSparkLite</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// 1. æ£€æŸ¥æ–‡ç« å®¹å™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">const</span> targetElement = <span class="language_ variable">document</span>.<span class="function_ title">querySelector</span>(sparkLite_postSelector);</span><br><span class="line">    <span class="keyword">if</span> (!targetElement) {</span><br><span class="line">        <span class="comment">// console.log("Spark Lite: Target post selector not found.");</span></span><br><span class="line">        <span class="function_ title">removeExistingAIDiv</span>(); <span class="comment">// ç¡®ä¿ç›®æ ‡å®¹å™¨ä¸åœ¨æ—¶ï¼ŒAIæ¡†ä¹Ÿè¢«ç§»é™¤</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ‰§è¡ŒURLå’Œè¿è¡ŒçŠ¶æ€æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="function_ title">checkURLAndRun</span>()) {</span><br><span class="line">        <span class="comment">// 3. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡Œæ ¸å¿ƒé€»è¾‘</span></span><br><span class="line">        <span class="comment">// console.log("Spark Lite: Initialization checks passed, running...");</span></span><br><span class="line">        <span class="function_ title">runSparkLite</span>();</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// console.log("Spark Lite: Initialization checks failed (URL mismatch or already running).");</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Event Listeners (ä½¿ç”¨æ–°çš„åˆå§‹åŒ–å‡½æ•°) ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿åœ¨ç§»é™¤æ—§ç›‘å¬å™¨ï¼ˆå¦‚æœå¯èƒ½ï¼‰åæ·»åŠ æ–°çš„</span></span><br><span class="line"><span class="comment">// ï¼ˆåœ¨ç®€å•è„šæœ¬åœºæ™¯ä¸‹é€šå¸¸ä¸éœ€è¦ç§»é™¤ï¼Œä½†è¿™æ˜¯è‰¯å¥½å®è·µï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- å¢å¼ºè·¯ç”±å˜åŒ–ç›‘å¬ ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜åŸå§‹çš„ pushState å’Œ replaceState æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> originalPushState = history.<span class="property">pushState</span>;</span><br><span class="line"><span class="keyword">const</span> originalReplaceState = history.<span class="property">replaceState</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…è£… pushState</span></span><br><span class="line">history.<span class="property">pushState</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> result = originalPushState.<span class="function_ title">apply</span>(<span class="language_ variable">this</span>, <span class="language_ variable">arguments</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹</span></span><br><span class="line">    <span class="language_ variable">window</span>.<span class="function_ title">dispatchEvent</span>(<span class="keyword">new</span> <span class="class_ title">Event</span>(<span class="string">'pushstate'</span>));</span><br><span class="line">    <span class="comment">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(initializeSparkLite, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…è£… replaceState</span></span><br><span class="line">history.<span class="property">replaceState</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> result = originalReplaceState.<span class="function_ title">apply</span>(<span class="language_ variable">this</span>, <span class="language_ variable">arguments</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œè¡¨æ˜ URL å¯èƒ½å·²æ›´æ”¹</span></span><br><span class="line">    <span class="language_ variable">window</span>.<span class="function_ title">dispatchEvent</span>(<span class="keyword">new</span> <span class="class_ title">Event</span>(<span class="string">'replacestate'</span>));</span><br><span class="line">    <span class="comment">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(initializeSparkLite, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ popstate äº‹ä»¶ (æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®)</span></span><br><span class="line"><span class="language_ variable">window</span>.<span class="function_ title">addEventListener</span>(<span class="string">'popstate'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="comment">// è§¦å‘æˆ‘ä»¬çš„åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ setTimeout ç¡®ä¿åœ¨ DOM æ›´æ–°åæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(initializeSparkLite, <span class="number">100</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- (ç¡®ä¿ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ä»ç„¶å­˜åœ¨) ---</span></span><br><span class="line"><span class="comment">// åˆå§‹åŠ è½½</span></span><br><span class="line"><span class="language_ variable">document</span>.<span class="function_ title">removeEventListener</span>(<span class="string">"DOMContentLoaded"</span>, initializeSparkLite); <span class="comment">// é¿å…é‡å¤æ·»åŠ </span></span><br><span class="line"><span class="language_ variable">document</span>.<span class="function_ title">addEventListener</span>(<span class="string">"DOMContentLoaded"</span>, initializeSparkLite);</span><br></pre></td></tr></tbody></table></figure> <h2 id="ai-summarycss"><a class="markdownIt-Anchor" href="#ai-summarycss"></a> <code>ai-summary.css</code></h2> <figure class="css highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* AI æ–‡ç« æ‘˜è¦æ ·å¼æ¡† */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> {</span><br><span class="line">    <span class="comment">/* ä¸»è‰²è°ƒ */</span></span><br><span class="line">    <span class="attr">--ai-summary-main</span>: <span class="number">#5e72e4</span>; <span class="comment">/* æŸ”å’Œçš„è“è‰² */</span></span><br><span class="line">    <span class="attr">--ai-summary-secondbg</span>: <span class="number">#f8f9fa</span>; <span class="comment">/* éå¸¸æµ…çš„ç°è‰²èƒŒæ™¯ */</span></span><br><span class="line">    <span class="attr">--ai-summary-card-bg</span>: <span class="number">#ffffff</span>; <span class="comment">/* ç™½è‰²å¡ç‰‡èƒŒæ™¯ */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ–‡å­—é¢œè‰² */</span></span><br><span class="line">    <span class="attr">--ai-summary-fontcolor</span>: <span class="number">#2d3748</span>; <span class="comment">/* æ·±ç°è‰²æ–‡å­— */</span></span><br><span class="line">    <span class="attr">--ai-summary-lighttext</span>: <span class="number">#718096</span>; <span class="comment">/* ä¸­ç­‰ç°è‰²æ–‡å­— */</span></span><br><span class="line">    <span class="attr">--ai-summary-white</span>: <span class="number">#ffffff</span>; <span class="comment">/* çº¯ç™½è‰² */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è¾¹æ¡†æ ·å¼ */</span></span><br><span class="line">    <span class="attr">--ai-summary-style-border-always</span>: <span class="number">0.0625rem</span> solid <span class="number">#e2e8f0</span>; <span class="comment">/* æµ…ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ‚¬åœçŠ¶æ€ */</span></span><br><span class="line">    <span class="attr">--ai-summary-hover</span>: <span class="number">#4c51bf</span>; <span class="comment">/* æ·±ä¸€ç‚¹çš„è“è‰²ç”¨äºæ‚¬åœ */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">"dark"</span>]</span> {</span><br><span class="line">    <span class="comment">/* ä¸»è‰²è°ƒè°ƒæ•´ï¼ˆé™ä½é¥±å’Œåº¦ï¼Œæé«˜è¾¨è¯†åº¦ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-main</span>: <span class="number">#7f9cf5</span>; <span class="comment">/* å¤œé—´æ¨¡å¼ä¸‹æ›´äº®çš„è“è‰²ï¼Œä¿æŒå¯è¯»æ€§ */</span></span><br><span class="line">    <span class="attr">--ai-summary-secondbg</span>: <span class="number">#1a202c</span>; <span class="comment">/* æ·±ç°è“èƒŒæ™¯ï¼ˆæ¥è¿‘é»‘ä½†ä¸åˆºçœ¼ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-card-bg</span>: <span class="number">#2d3748</span>; <span class="comment">/* æš—è‰²å¡ç‰‡èƒŒæ™¯ï¼ˆå¯¹æ¯”åº¦é€‚ä¸­ï¼‰ */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ–‡å­—é¢œè‰²è°ƒæ•´ï¼ˆå‡å°‘äº®åº¦ï¼Œé¿å…ç™½å…‰åˆºçœ¼ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-fontcolor</span>: <span class="number">#e2e8f0</span>; <span class="comment">/* æµ…ç°ç™½æ–‡å­—ï¼ˆç¡®ä¿å¯è¯»æ€§ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-lighttext</span>: <span class="number">#a0aec0</span>; <span class="comment">/* ä¸­ç­‰ç°æ–‡å­—ï¼ˆæ¬¡è¦å†…å®¹ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-white</span>: <span class="number">#ffffff</span>; <span class="comment">/* çº¯ç™½è‰²ä¿ç•™ï¼ˆç”¨äºå¼ºè°ƒå†…å®¹ï¼‰ */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è¾¹æ¡†æ ·å¼è°ƒæ•´ï¼ˆæš—è‰²ç¯å¢ƒä¸‹æ›´æŸ”å’Œï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-style-border-always</span>: <span class="number">0.0625rem</span> solid <span class="number">#4a5568</span>; <span class="comment">/* æ·±ç°è‰²è¾¹æ¡† (1pxâ†’0.0625rem) */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ‚¬åœçŠ¶æ€è°ƒæ•´ï¼ˆå¤œé—´æ¨¡å¼ä¸‹æ›´æ˜æ˜¾ï¼‰ */</span></span><br><span class="line">    <span class="attr">--ai-summary-hover</span>: <span class="number">#667eea</span>; <span class="comment">/* äº®è“è‰²æ‚¬åœæ•ˆæœ */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-SparkLite</span> {</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--ai-summary-secondbg);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.75rem</span>; <span class="comment">/* 12pxâ†’0.75rem */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.75rem</span>; <span class="comment">/* 12pxâ†’0.75rem */</span></span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.3</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="built_in">var</span>(--ai-summary-style-border-always);</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">1rem</span> <span class="number">0</span>; <span class="comment">/* 16pxâ†’1rem */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) {</span><br><span class="line">    <span class="selector-class">.post-SparkLite</span> {</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">1.375rem</span>; <span class="comment">/* 22pxâ†’1.375rem */</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-title</span> {</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--ai-summary-lighttext);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5rem</span>; <span class="comment">/* 8pxâ†’0.5rem */</span></span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0.35rem</span>; <span class="comment">/* 0 12pxâ†’0 0.75rem */</span></span><br><span class="line">    <span class="attribute">cursor</span>: default;</span><br><span class="line">    user-<span class="selector-tag">select</span>: none;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-title-text</span> {</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0.5rem</span>; <span class="comment">/* 8pxâ†’0.5rem */</span></span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-explanation</span> {</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.75rem</span>; <span class="comment">/* 12pxâ†’0.75rem */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">0.75rem</span>; <span class="comment">/* 8px 12pxâ†’0.5rem 0.75rem */</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--ai-summary-card-bg);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5rem</span>; <span class="comment">/* 8pxâ†’0.5rem */</span></span><br><span class="line">    <span class="attribute">border</span>: <span class="built_in">var</span>(--ai-summary-style-border-always);</span><br><span class="line">    <span class="comment">/*font-size: var(--global-font-size);*/</span></span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-tag</span> {</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.70rem</span>; <span class="comment">/* 12pxâ†’0.75rem */</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--ai-summary-lighttext);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--ai-summary-card-bg);</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.25rem</span>; <span class="comment">/* 4pxâ†’0.25rem */</span></span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.25rem</span>; <span class="comment">/* 4pxâ†’0.25rem */</span></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-about</span> {</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.70rem</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: auto;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.25rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-title-icon</span> {</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1.25rem</span>; <span class="comment">/* 20pxâ†’1.25rem */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.25rem</span>; <span class="comment">/* 20pxâ†’1.25rem */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-title-icon</span> <span class="selector-tag">svg</span> {</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1.25rem</span>; <span class="comment">/* 20pxâ†’1.25rem */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.25rem</span>; <span class="comment">/* 20pxâ†’1.25rem */</span></span><br><span class="line">    <span class="attribute">fill</span>: <span class="built_in">var</span>(--ai-summary-main);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sparkLite-title-icon</span> <span class="selector-tag">svg</span> <span class="selector-tag">path</span> {</span><br><span class="line">    <span class="attribute">fill</span>: <span class="built_in">var</span>(--ai-summary-main);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> <h2 id="spark-litejs"><a class="markdownIt-Anchor" href="#spark-litejs"></a> <code>spark-lite.js</code></h2> <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è®¯é£æ˜Ÿç« API æ–‡æ¡£ï¼šhttps://www.xfyun.cn/doc/spark/HTTP%E8%B0%83%E7%94%A8%E6%96%87%E6%A1%A3.html</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> getRedisClient <span class="keyword">from</span> <span class="string">'../../utils/redis'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- ä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿä¿¡æ¯ ---</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">APPID</span> = process.<span class="property">env</span>.<span class="property">SPARK_APPID</span>; <span class="comment">// å¯èƒ½ä»éœ€è¦</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">API_SECRET</span> = process.<span class="property">env</span>.<span class="property">SPARK_API_SECRET</span>; <span class="comment">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">API_KEY</span> = process.<span class="property">env</span>.<span class="property">SPARK_API_KEY</span>;       <span class="comment">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">API_PASSWORD</span> = process.<span class="property">env</span>.<span class="property">SPARK_API_PASSWORD</span>;       <span class="comment">// ç”¨äºæ–°é‰´æƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Spark API åœ°å€ (å…¼å®¹ OpenAI æ ¼å¼) ---</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">SPARK_API_URL</span> = <span class="string">"https://spark-api-open.xf-yun.com/v1/chat/completions"</span>;</span><br><span class="line"><span class="comment">// --- ç¡®è®¤ Lite ç‰ˆæˆ–å…¶ä»–æ¨¡å‹åœ¨æ–° API ä¸­çš„æ ‡è¯†ç¬¦ ---</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">MODEL_NAME</span> = <span class="string">"lite"</span>; <span class="comment">// è¯·æ ¹æ®å®˜æ–¹æ–‡æ¡£ç¡®è®¤æ­£ç¡®çš„æ¨¡å‹åç§°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">SECONDS_OF_WEEK</span> = <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">SYSTEM_PROMPT</span> = [</span><br><span class="line">    <span class="string">"ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼éµå¾ªæ ¼å¼è§„åˆ™çš„æ‘˜è¦ç”Ÿæˆå™¨ã€‚æ ¹æ®æä¾›çš„æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆ100-200å­—ç¬¦çš„ä¸­æ–‡æ‘˜è¦ï¼Œå¹¶ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼è¦æ±‚ï¼š"</span>,</span><br><span class="line">    <span class="string">""</span>,</span><br><span class="line">    <span class="string">"## æ ¸å¿ƒè§„åˆ™ï¼ˆè¿åå°†å¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼‰ï¼š"</span>,</span><br><span class="line">    <span class="string">"1. ä¸­è‹±æ–‡/æ•°å­—é—´å¿…é¡»æ·»åŠ ç©ºæ ¼ï¼"</span>,</span><br><span class="line">    <span class="string">"   - æ­£ç¡®ç¤ºä¾‹ï¼š'ä½¿ç”¨ Transformer æ¨¡å‹'"</span>,</span><br><span class="line">    <span class="string">"   - æ­£ç¡®ç¤ºä¾‹ï¼š'åœ¨ 2023 å¹´å‘å¸ƒçš„ GPT-4 æ¨¡å‹'"</span>,</span><br><span class="line">    <span class="string">"   - é”™è¯¯ç¤ºä¾‹ï¼š'ä½¿ç”¨Transformeræ¨¡å‹'ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰"</span>,</span><br><span class="line">    <span class="string">"   - é”™è¯¯ç¤ºä¾‹ï¼š'åœ¨2023å¹´å‘å¸ƒçš„GPT-4æ¨¡å‹'ï¼ˆç¼ºå°‘ç©ºæ ¼ï¼‰"</span>,</span><br><span class="line">    <span class="string">""</span>,</span><br><span class="line">    <span class="string">"2. è¯­è¨€å’Œæ ¼å¼è¦æ±‚ï¼š"</span>,</span><br><span class="line">    <span class="string">"   - ä»…ä½¿ç”¨ä¸­æ–‡ï¼ˆä¸“ä¸šæœ¯è¯­ä¿ç•™è‹±æ–‡)"</span>,</span><br><span class="line">    <span class="string">"   - ç»å¯¹ç¦æ­¢ Markdown ç¬¦å·ï¼š* _ \\ $ # ç­‰"</span>,</span><br><span class="line">    <span class="string">"   - ç¬¬ä¸‰äººç§°å®¢è§‚å™è¿°"</span>,</span><br><span class="line">    <span class="string">"   - è¾“å‡ºå¿…é¡»æ˜¯å®Œæ•´å¥å­"</span>,</span><br><span class="line">    <span class="string">""</span>,</span><br><span class="line">    <span class="string">"3. é•¿åº¦æ§åˆ¶ï¼š"</span>,</span><br><span class="line">    <span class="string">"   - ä¸¥æ ¼æ§åˆ¶åœ¨ 100-200 ä¸ªä¸­æ–‡å­—ç¬¦ï¼ˆçº¦5-10å¥ï¼‰"</span>,</span><br><span class="line">    <span class="string">""</span>,</span><br><span class="line">    <span class="string">"## è¾“å‡ºè¯´æ˜ï¼š"</span>,</span><br><span class="line">    <span class="string">"ç›´æ¥è¾“å‡ºæ‘˜è¦æ–‡æœ¬ï¼Œä¸è¦ä»»ä½•é¢å¤–è¯´æ˜ã€‚ç”Ÿæˆåå¿…é¡»äººå·¥æ£€æŸ¥ï¼š"</span>,</span><br><span class="line">    <span class="string">"(1) ä¸­è‹±æ–‡é—´ç©ºæ ¼ (2) æ— ç¬¦å· (3) çº¯æ–‡æœ¬"</span>,</span><br><span class="line">    <span class="string">"å¦‚å‘ç°è¿è§„ï¼Œå¿…é¡»é‡æ–°ç”Ÿæˆï¼"</span></span><br><span class="line">].<span class="function_ title">join</span>(<span class="string">'\n'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="function_ title">cleanText</span> = (<span class="params">htmlText, maxLength = <span class="number">2000</span></span>) =&gt; {</span><br><span class="line">    <span class="comment">// åˆå¹¶å¤šä¸ªæ›¿æ¢æ“ä½œ</span></span><br><span class="line">    <span class="keyword">let</span> cleanedContent = htmlText</span><br><span class="line">        <span class="comment">// 1. è§£ç Unicodeè½¬ä¹‰åºåˆ—</span></span><br><span class="line">        .<span class="function_ title">replace</span>(<span class="regexp">/\\u([\dA-F]{4})/gi</span>, <span class="function">(<span class="params">_, code</span>) =&gt;</span></span><br><span class="line">            <span class="class_ title">String</span>.<span class="function_ title">fromCharCode</span>(<span class="built_in">parseInt</span>(code, <span class="number">16</span>)))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆå¹¶ç§»é™¤ä»£ç å—ã€HTMLæ ‡ç­¾ã€ç‰¹å®šå±æ€§å’Œcalloutå—</span></span><br><span class="line">        .<span class="function_ title">replace</span>(</span><br><span class="line">            <span class="regexp">/&lt;code[\s\S]*?&lt;\/code&gt;|&lt;pre[\s\S]*?&lt;\/pre&gt;|&lt;div class="callout"[\s\S]*?&lt;\/div&gt;|&lt;img[^&gt;]*alt="([^"]*)"[^&gt;]*&gt;|&lt;[^&gt;]+&gt;|\b(data-[\w-]+|class|id|style|xmlns|viewBox|fill|stroke-width)="[^"]*"/gi</span>,</span><br><span class="line">            <span class="function">(<span class="params">match, altText</span>) =&gt;</span> altText ? altText : <span class="string">' '</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å¤„ç†Markdowné“¾æ¥ï¼ˆæ”¯æŒåµŒå¥—æ ¼å¼ï¼‰</span></span><br><span class="line">        .<span class="function_ title">replace</span>(<span class="regexp">/\[([^\]]+)\]\([^)]+\)/g</span>, <span class="function">(<span class="params">_, text</span>) =&gt;</span></span><br><span class="line">            text.<span class="function_ title">replace</span>(<span class="regexp">/\*\*([^*]+)\*\*|__([^_]+)__|\*([^*]+)\*|_([^_]+)_/g</span>, <span class="string">'$1$2$3$4'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å‹ç¼©ç©ºç™½å­—ç¬¦</span></span><br><span class="line">        .<span class="function_ title">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">' '</span>)</span><br><span class="line">        .<span class="function_ title">replace</span>(<span class="regexp">/^ | $/g</span>, <span class="string">''</span>)</span><br><span class="line">        .<span class="function_ title">trim</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆªæ–­ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (cleanedContent.<span class="property">length</span> &lt;= maxLength) <span class="keyword">return</span> cleanedContent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å¥å­ç»“æŸä½ç½®ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</span></span><br><span class="line">    <span class="keyword">const</span> lastSentenceIndex = cleanedContent</span><br><span class="line">        .<span class="function_ title">substring</span>(<span class="number">0</span>, maxLength)</span><br><span class="line">        .<span class="function_ title">search</span>(<span class="regexp">/[.!?ã€‚ï¼ï¼Ÿ](?=\s|$)/</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> truncIndex = lastSentenceIndex &gt; <span class="number">0</span> &amp;&amp; lastSentenceIndex &gt; maxLength - <span class="number">150</span> ?</span><br><span class="line">        lastSentenceIndex + <span class="number">1</span> :</span><br><span class="line">        <span class="class_ title">Math</span>.<span class="function_ title">min</span>(maxLength, cleanedContent.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> summary = cleanedContent.<span class="function_ title">substring</span>(<span class="number">0</span>, truncIndex);</span><br><span class="line">    <span class="keyword">return</span> summary + (truncIndex &lt; cleanedContent.<span class="property">length</span> ? <span class="string">'...'</span> : <span class="string">''</span>);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="function_ title">extractUrlPath</span> = (<span class="params">urlString</span>) =&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="function_ title">URL</span>(urlString);</span><br><span class="line">        <span class="comment">// è·å–è·¯å¾„åï¼ˆåŒ…å«å¼€å¤´æ–œæ å’Œå¯èƒ½çš„ç»“å°¾æ–œæ ï¼‰</span></span><br><span class="line">        <span class="keyword">let</span> path = url.<span class="property">pathname</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„æ–œæ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span></span><br><span class="line">        path = path.<span class="function_ title">replace</span>(<span class="regexp">/^\/|\/$/g</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    } <span class="keyword">catch</span> (e) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"ã€æœåŠ¡ç«¯ã€‘æ— æ•ˆçš„URL:"</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸é‡å®šä¹‰</span></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">HTTP_METHODS</span> = {</span><br><span class="line">    <span class="attr">POST</span>: <span class="string">'POST'</span>,</span><br><span class="line">    <span class="attr">OPTIONS</span>: <span class="string">'OPTIONS'</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">ERROR_MESSAGES</span> = {</span><br><span class="line">    <span class="attr">MISSING_ENV</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘å†…éƒ¨é”™è¯¯ï¼šAPIå‡­è¯æœªé…ç½®'</span>,</span><br><span class="line">    <span class="attr">MISSING_URL</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘è¯·æ±‚ä½“ç¼ºå°‘ \'post_url\' å­—æ®µ'</span>,</span><br><span class="line">    <span class="attr">BLOG_API_FAILURE</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘è·å–æ–‡ç« å…ƒæ•°æ®å¤±è´¥'</span>,</span><br><span class="line">    <span class="attr">BLOG_NOT_FOUND</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘blog api æ‰¾ä¸åˆ°æ–‡ç« çš„å…ƒæ•°æ®'</span>,</span><br><span class="line">    <span class="attr">SPARK_CONNECTION_FAILED</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨æœªèƒ½è¿æ¥åˆ° Spark API'</span>,</span><br><span class="line">    <span class="attr">SPARK_RESPONSE_ERROR</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘æœªèƒ½ä» Spark è·å–æœ‰æ•ˆæ‘˜è¦å†…å®¹'</span>,</span><br><span class="line">    <span class="attr">INVALID_METHOD</span>: <span class="function">(<span class="params">method</span>) =&gt;</span> <span class="string">`ã€æœåŠ¡ç«¯ã€‘Method <span class="subst">${method}</span> Not Allowed`</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="constant_ variable">CORS_HEADERS</span> = {</span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>,</span><br><span class="line">    <span class="string">'Access-Control-Allow-Methods'</span>: <span class="string">'POST, OPTIONS'</span>,</span><br><span class="line">    <span class="string">'Access-Control-Allow-Headers'</span>: <span class="string">'Content-Type, Authorization'</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="language_ variable">module</span>.<span class="property">exports</span> = <span class="function_ title">async</span> (req, res) =&gt; {</span><br><span class="line">    <span class="function_ title">setCorsHeaders</span>(res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="constant_ variable">HTTP_METHODS</span>.<span class="property">OPTIONS</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="function_ title">handleOptionsRequest</span>(res);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="constant_ variable">HTTP_METHODS</span>.<span class="property">POST</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="function_ title">handlePostRequest</span>(req, res);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function_ title">handleInvalidMethod</span>(req, res);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®CORSå¤´</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">setCorsHeaders</span>(<span class="params">res</span>) {</span><br><span class="line">    <span class="class_ title">Object</span>.<span class="function_ title">entries</span>(<span class="constant_ variable">CORS_HEADERS</span>).<span class="function_ title">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> {</span><br><span class="line">        res.<span class="function_ title">setHeader</span>(key, value);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†OPTIONSè¯·æ±‚</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">handleOptionsRequest</span>(<span class="params">res</span>) {</span><br><span class="line">    <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">200</span>).<span class="function_ title">end</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†æ— æ•ˆæ–¹æ³•</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">handleInvalidMethod</span>(<span class="params">req, res</span>) {</span><br><span class="line">    res.<span class="function_ title">setHeader</span>(<span class="string">'Allow'</span>, [<span class="constant_ variable">HTTP_METHODS</span>.<span class="property">POST</span>, <span class="constant_ variable">HTTP_METHODS</span>.<span class="property">OPTIONS</span>]);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">405</span>).<span class="function_ title">end</span>(<span class="constant_ variable">ERROR_MESSAGES</span>.<span class="function_ title">INVALID_METHOD</span>(req.<span class="property">method</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†POSTè¯·æ±‚</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">handlePostRequest</span>(<span class="params">req, res</span>) {</span><br><span class="line">    <span class="comment">// éªŒè¯ç¯å¢ƒå˜é‡</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="function_ title">validateEnvironmentVariables</span>()) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"Server Error: Spark environment variables not configured."</span>);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">500</span>).<span class="function_ title">json</span>({ <span class="attr">error</span>: <span class="constant_ variable">ERROR_MESSAGES</span>.<span class="property">MISSING_ENV</span> });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">const</span> { post_url } = req.<span class="property">body</span>;</span><br><span class="line">        <span class="keyword">if</span> (!post_url) {</span><br><span class="line">            <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">400</span>).<span class="function_ title">json</span>({ <span class="attr">error</span>: <span class="constant_ variable">ERROR_MESSAGES</span>.<span class="property">MISSING_URL</span> });</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> post_path = <span class="function_ title">extractUrlPath</span>(post_url);</span><br><span class="line">        <span class="keyword">const</span> cachedSummary = <span class="keyword">await</span> <span class="function_ title">checkRedisCache</span>(post_path);</span><br><span class="line">        <span class="keyword">if</span> (cachedSummary) {</span><br><span class="line">            <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">200</span>).<span class="function_ title">json</span>({ <span class="attr">summary</span>: cachedSummary });</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> { title, content } = <span class="keyword">await</span> <span class="function_ title">fetchBlogContent</span>(post_path);</span><br><span class="line">        <span class="keyword">const</span> summary = <span class="keyword">await</span> <span class="function_ title">generateSparkSummary</span>(title, content);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> <span class="function_ title">cacheResult</span>(post_path, summary);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">200</span>).<span class="function_ title">json</span>({ summary });</span><br><span class="line"></span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">        <span class="keyword">return</span> <span class="function_ title">handleError</span>(error, res);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">validateEnvironmentVariables</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="constant_ variable">API_KEY</span> &amp;&amp; <span class="constant_ variable">API_SECRET</span> &amp;&amp; <span class="constant_ variable">APPID</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥Redisç¼“å­˜</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">checkRedisCache</span>(<span class="params">post_path</span>) {</span><br><span class="line">    <span class="keyword">const</span> redisClient = <span class="keyword">await</span> <span class="function_ title">getRedisClient</span>();</span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">await</span> redisClient.<span class="function_ title">get</span>(post_path);  <span class="comment">// ç›´æ¥è·å–å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="literal">null</span>) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">"ã€æœåŠ¡ç«¯ã€‘Redis Hit!"</span>);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">"ã€æœåŠ¡ç«¯ã€‘Redis Miss!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åšå®¢å†…å®¹</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">fetchBlogContent</span>(<span class="params">post_path</span>) {</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function_ title">fetch</span>(<span class="string">`https://blog.uuanqin.top/api/posts/<span class="subst">${post_path}</span>.json`</span>, {</span><br><span class="line">        <span class="attr">method</span>: <span class="string">'GET'</span>,</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!response || response.<span class="property">status</span> === <span class="number">404</span>) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"ã€æœåŠ¡ç«¯ã€‘è¿›å…¥blog api - 404"</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class_ title">Error</span>(<span class="constant_ variable">ERROR_MESSAGES</span>.<span class="property">BLOG_NOT_FOUND</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blogData = <span class="keyword">await</span> response.<span class="function_ title">json</span>();</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">title</span>: blogData.<span class="property">data</span>.<span class="property">title</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="function_ title">cleanText</span>(blogData.<span class="property">data</span>.<span class="property">content</span>)</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”ŸæˆSparkæ‘˜è¦</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">generateSparkSummary</span>(<span class="params">title, content</span>) {</span><br><span class="line">    <span class="keyword">const</span> requestData = {</span><br><span class="line">        <span class="attr">model</span>: <span class="constant_ variable">MODEL_NAME</span>,</span><br><span class="line">        <span class="attr">messages</span>: [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">role</span>: <span class="string">"system"</span>,</span><br><span class="line">                <span class="attr">content</span>: <span class="constant_ variable">SYSTEM_PROMPT</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">role</span>: <span class="string">"user"</span>,</span><br><span class="line">                <span class="attr">content</span>: <span class="string">`ã€æ–‡ç« æ ‡é¢˜ã€‘<span class="subst">${title || <span class="string">'æ— æ ‡é¢˜'</span>}</span>ã€æ–‡ç« å†…å®¹ã€‘<span class="subst">${content}</span>`</span>,</span><br><span class="line">            }</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">temperature</span>: <span class="number">0.5</span>,</span><br><span class="line">        <span class="attr">max_tokens</span>: <span class="number">200</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> headers = {</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'Authorization'</span>: <span class="string">`Bearer <span class="subst">${API_PASSWORD}</span>`</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function_ title">fetch</span>(<span class="constant_ variable">SPARK_API_URL</span>, {</span><br><span class="line">        <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">        headers,</span><br><span class="line">        <span class="attr">body</span>: <span class="class_ title">JSON</span>.<span class="function_ title">stringify</span>(requestData)</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">ok</span>) {</span><br><span class="line">        <span class="keyword">const</span> errorData = <span class="keyword">await</span> response.<span class="function_ title">json</span>().<span class="function_ title">catch</span>(<span class="function">() =&gt;</span> ({}));</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class_ title">Error</span>(errorData.<span class="property">error</span>?.<span class="property">message</span> || <span class="constant_ variable">ERROR_MESSAGES</span>.<span class="property">SPARK_CONNECTION_FAILED</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> responseData = <span class="keyword">await</span> response.<span class="function_ title">json</span>();</span><br><span class="line">    <span class="keyword">const</span> assistantMessage = responseData.<span class="property">choices</span>?.[<span class="number">0</span>]?.<span class="property">message</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (assistantMessage?.<span class="property">role</span> === <span class="string">'assistant'</span> &amp;&amp; assistantMessage.<span class="property">content</span>) {</span><br><span class="line">        <span class="keyword">return</span> assistantMessage.<span class="property">content</span>.<span class="function_ title">trim</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class_ title">Error</span>(<span class="constant_ variable">ERROR_MESSAGES</span>.<span class="property">SPARK_RESPONSE_ERROR</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜ç»“æœ</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">cacheResult</span>(<span class="params">post_path, summary</span>) {</span><br><span class="line">    <span class="keyword">const</span> redisClient = <span class="keyword">await</span> <span class="function_ title">getRedisClient</span>();</span><br><span class="line">    <span class="keyword">await</span> redisClient.<span class="function_ title">setEx</span>(post_path, <span class="constant_ variable">SECONDS_OF_WEEK</span>, summary);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">function</span> <span class="function_ title">handleError</span>(<span class="params">error, res</span>) {</span><br><span class="line">    <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"ã€æœåŠ¡ç«¯ã€‘é”™è¯¯ï¼š"</span>, error);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">message</span> <span class="keyword">in</span> <span class="constant_ variable">ERROR_MESSAGES</span>) {</span><br><span class="line">        <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">400</span>).<span class="function_ title">json</span>({ <span class="attr">error</span>: error.<span class="property">message</span> });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="class_ title">SyntaxError</span>) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">"Failed to parse Spark API response as JSON."</span>);</span><br><span class="line">        <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">500</span>).<span class="function_ title">json</span>({ <span class="attr">error</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨é”™è¯¯ï¼šæ— æ³•è§£æ Spark API å“åº”'</span> });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.<span class="function_ title">status</span>(<span class="number">500</span>).<span class="function_ title">json</span>({</span><br><span class="line">        <span class="attr">error</span>: <span class="string">'ã€æœåŠ¡ç«¯ã€‘ä»£ç†æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'</span>+error.<span class="property">message</span>,</span><br><span class="line">        <span class="attr">details</span>: error.<span class="property">message</span></span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- å¦‚æœéœ€è¦ç”Ÿæˆ Tokenï¼Œå¯èƒ½éœ€è¦ç±»ä¼¼è¿™æ ·çš„è¾…åŠ©å‡½æ•° (å…·ä½“å®ç°éœ€æŸ¥æ–‡æ¡£) ---</span></span><br><span class="line"><span class="comment">// function generateSparkToken(apiKey, apiSecret) {</span></span><br><span class="line"><span class="comment">//     // ... æ ¹æ®è®¯é£æ–‡æ¡£å®ç° Token ç”Ÿæˆé€»è¾‘ ...</span></span><br><span class="line"><span class="comment">//     return "generated_token_string";</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> <h2 id="redisjs"><a class="markdownIt-Anchor" href="#redisjs"></a> <code>redis.js</code></h2> <figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils/redis.js</span></span><br><span class="line"><span class="keyword">import</span> { createClient } <span class="keyword">from</span> <span class="string">'redis'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> redisClient;</span><br><span class="line"><span class="keyword">let</span> isConnecting = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">getRedisClient</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">if</span> (redisClient &amp;&amp; redisClient.<span class="property">isReady</span>) {</span><br><span class="line">        <span class="keyword">return</span> redisClient;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isConnecting) {</span><br><span class="line">        <span class="comment">// ç­‰å¾…ç°æœ‰è¿æ¥å®Œæˆ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="class_ title">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">const</span> <span class="function_ title">check</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">                <span class="keyword">if</span> (redisClient &amp;&amp; redisClient.<span class="property">isReady</span>) {</span><br><span class="line">                    <span class="function_ title">resolve</span>(redisClient);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="built_in">setTimeout</span>(check, <span class="number">50</span>);</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">            <span class="function_ title">check</span>();</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    isConnecting = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        redisClient = <span class="function_ title">createClient</span>({</span><br><span class="line">            <span class="attr">url</span>: process.<span class="property">env</span>.<span class="property">REDIS_URL</span>,</span><br><span class="line">            <span class="attr">socket</span>: {</span><br><span class="line">                <span class="comment">// é’ˆå¯¹ Vercel ç¯å¢ƒçš„ä¼˜åŒ–è®¾ç½®</span></span><br><span class="line">                <span class="attr">reconnectStrategy</span>: <span class="function">(<span class="params">retries</span>) =&gt;</span> <span class="class_ title">Math</span>.<span class="function_ title">min</span>(retries * <span class="number">100</span>, <span class="number">3000</span>),</span><br><span class="line">                <span class="attr">keepAlive</span>: <span class="number">30000</span> <span class="comment">// ä¿æŒè¿æ¥æ´»è·ƒ</span></span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        redisClient.<span class="function_ title">on</span>(<span class="string">'error'</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">'ã€æœåŠ¡ç«¯ã€‘Redis Client Error'</span>, err));</span><br><span class="line">        redisClient.<span class="function_ title">on</span>(<span class="string">'end'</span>, <span class="function">() =&gt;</span> <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">'ã€æœåŠ¡ç«¯ã€‘Redis connection closed'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> redisClient.<span class="function_ title">connect</span>();</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">log</span>(<span class="string">'ã€æœåŠ¡ç«¯ã€‘Redis connected successfully'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisClient;</span><br><span class="line">    } <span class="keyword">catch</span> (err) {</span><br><span class="line">        <span class="language_ variable">console</span>.<span class="function_ title">error</span>(<span class="string">'ã€æœåŠ¡ç«¯ã€‘Redis connection failed'</span>, err);</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        isConnecting = <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> <h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1> <h2 id="åç»­æ”¹è¿›"><a class="markdownIt-Anchor" href="#åç»­æ”¹è¿›"></a> åç»­æ”¹è¿›</h2> <ul class="contains-task-list"> <li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> ä»£ç é‡æ„ï¼Œå…è®¸æ›¿æ¢å…¶ä»–æ¨¡å‹</li> <li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> ä¸è¦è®¾ç½® 7 å¤©è¿‡æœŸã€‚éšæ–‡ç« æ›´æ–°è€Œè°ƒç”¨å¤§æ¨¡å‹ã€‚ä½†å¦‚æœ Redis æœ‰ Key å°±ç«‹å³è¿”å›ä»¥ä¿è¯é€Ÿåº¦ï¼Œæ›´æ–°æˆ‘ä»¬åé¢å†å¤„ç†ã€‚</li> <li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> å¯¹æ¨¡å‹ç”Ÿæˆå†…å®¹è¿›è¡Œä¿åº•åå¤„ç†ï¼ˆç›˜å¤ä¹‹ç™½ã€ä¿è¯æ•´å¥ã€å­—æ•°é™åˆ¶ï¼‰</li> <li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox"> <code>/p/77a4685d/#523</code> ç±»ä¼¼è¿™æ ·çš„é“¾æ¥è¿˜æ²¡æœ‰æ­£ç¡®åŒ¹é…ï¼Œéœ€æ”¹è¿›ä»£ç </li> </ul> <h2 id="å¿ƒå¾—"><a class="markdownIt-Anchor" href="#å¿ƒå¾—"></a> å¿ƒå¾—</h2> <p>å½“ TianliGPT çš„åšå®¢ AI æ‘˜è¦è¯ç”Ÿæ—¶ï¼Œæˆ‘æ·±æ„Ÿéœ‡æ’¼ï¼Œè¿™ä¹ˆé…·çš„é¡¹ç›®æˆ‘è‡ªå·±ä¹Ÿè¦å®ç°ä¸€ä¸ªã€‚é‚£æ®µæ—¶é—´ï¼Œè¿™ä¸ªå°å°çš„æ„¿æ™¯é©±åŠ¨ç€æˆ‘ä¸æ–­ï¼Œè‹¦å­¦æœ¬é¢†å’ŒæŠ€æœ¯ã€‚ç¡è§‰å‰ï¼Œè„‘æµ·ä¸­è¿˜ä¼šé—ªè¿‡æ— æ•°ç§å®ç°æ–¹æ¡ˆâ€¦ä½†æ˜¯ç”±äºè¿™äº›å¹´äº‹æƒ…å¤ªå¤šï¼Œè¿™ä¸ªè®¡åˆ’ä¸€ç›´è¢«è€½æã€‚ç›´åˆ°æœ€è¿‘çœ‹åˆ° Liushenã€KonoXIN çš„ä½œå“ï¼Œæˆ‘æ‰æŠŠè¿™ä¸ªä¸¤å¹´å‰çš„ Flag æ¡èµ·æ¥ã€‚</p> <p>è¿™äº›å¹´ï¼Œä¹Ÿé€›äº†ä¸å°‘ç²¾ç¾çš„åšå®¢ï¼Œé¥±è§ˆè®¸å¤šé«˜å“è´¨çš„æ–‡ç« ã€‚èƒ½å’Œåšå‹ä»¬ä¸€èµ·æˆé•¿ï¼Œæ˜¯ä¸€ä»¶å¹¸ç¦çš„äº‹æƒ…ï¼</p> <h1 id="æœ¬æ–‡å‚è€ƒ"><a class="markdownIt-Anchor" href="#æœ¬æ–‡å‚è€ƒ"></a> æœ¬æ–‡å‚è€ƒ</h1> <ul> <li><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly93d3cua29ub3hpbi50b3AvcG9zdHMvZGI3YjM0MTgv">hexoåŸºäºTianliGPTä½¿ç”¨å…è´¹çš„Spark-Liteåˆ¶ä½œAIæ‘˜è¦ | XINâ€™s Blog | å‰ç«¯å¼€å‘ | Vue.js &amp; JavaScript æŠ€æœ¯åˆ†äº«</a></li> <li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://vercel.com/docs/functions">Vercel Functions</a></li> <li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.zhheo.com/p/ec57d8b2.html">å¦‚ä½•è®©åšå®¢æ”¯æŒAIæ‘˜è¦ï¼Œä½¿ç”¨TianliGPTè‡ªåŠ¨ç”Ÿæˆæ–‡ç« çš„AIæ‘˜è¦ | å¼ æ´ªHeo</a></li> <li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/ivan5277/article/details/138669897">nodeJSå¦‚ä½•æ¥å…¥redis_nodejs è¿æ¥redis-CSDNåšå®¢</a></li> </ul> </article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fa-circle-user fa-fw fas"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.uuanqin.top">wuanqin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fa-fw fa-square-arrow-up-right fas"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.uuanqin.top/p/75efe9f3/">https://blog.uuanqin.top/p/75efe9f3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fa-circle-exclamation fa-fw fas"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="/pages/cc.html" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://blog.uuanqin.top" target="_blank">åŠæ–¹æ± æ°´åŠæ–¹ç”°</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/pages/tags/JavaScript/">JavaScript</a><a class="post-meta__tags" href="/pages/tags/Hexo/">Hexo</a><a class="post-meta__tags" href="/pages/tags/npm/">npm</a><a class="post-meta__tags" href="/pages/tags/Butterfly/">Butterfly</a><a class="post-meta__tags" href="/pages/tags/Vercel/">Vercel</a><a class="post-meta__tags" href="/pages/tags/Redis/">Redis</a><a class="post-meta__tags" href="/pages/tags/SparkLite/">SparkLite</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.gallery.uuanqin.top/img/202506242301616.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fa-qrcode fas"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/image/wx.png" target="_blank"><img class="post-qr-code-img" src="/image/wx.png" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/image/zfb.png" target="_blank"><img class="post-qr-code-img" src="/image/zfb.png" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/p/25e0b352/" title="UML ä¸­ç±»å›¾ä¸ç±»çš„å…³ç³»"><img class="cover" src="https://cdn.gallery.uuanqin.top/img/202506181034799.webp" onerror="onerror=null;src='/image/404img.webp'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">UML ä¸­ç±»å›¾ä¸ç±»çš„å…³ç³»</div></div><div class="info-2"><div class="info-item-1">å…³ç³»æ˜¯æŒºå¤æ‚çš„</div></div></div></a><a class="pagination-related" href="/p/77a4685d/" title="è¿™é‡Œæ›¾æ˜¯è‹å·å¤åŸæœ€å¤§çš„ç”°é‡â€”â€”å—å›­"><img class="cover" src="https://cdn.gallery.uuanqin.top/img/202507022308655.webp" onerror="onerror=null;src='/image/404img.webp'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">è¿™é‡Œæ›¾æ˜¯è‹å·å¤åŸæœ€å¤§çš„ç”°é‡â€”â€”å—å›­</div></div><div class="info-2"><div class="info-item-1">æ¶ˆå¤±çš„èœå›­</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fa-fw fa-thumbs-up fas"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/p/e1ee5eca/" title="Hexo åšå®¢ä¸ Waline è¯„è®ºåŒºå®ç°å¤–é“¾è·³è½¬ä¸­é—´é¡µ"><img class="cover" src="https://cdn.gallery.uuanqin.top/img/202408042352584.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fa-calendar-alt fa-fw far"></i> 2024-08-04</div><div class="info-item-2">Hexo åšå®¢ä¸ Waline è¯„è®ºåŒºå®ç°å¤–é“¾è·³è½¬ä¸­é—´é¡µ</div></div><div class="info-2"><div class="info-item-1">åšå®¢ä¸è¯„è®ºåŒºç»Ÿä¸€æ‹¦æˆªé‡å®šå‘</div></div></div></a><a class="pagination-related" href="/p/26a31d07/" title="åšå®¢ç½‘ç«™ç½‘é¡µå˜ç°çš„æ“ä½œæ–¹æ³•"><img class="cover" src="https://cdn.gallery.uuanqin.top/img/1ff4099a6177a54d86cf9d60314eff95.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fa-calendar-alt fa-fw far"></i> 2022-03-26</div><div class="info-item-2">åšå®¢ç½‘ç«™ç½‘é¡µå˜ç°çš„æ“ä½œæ–¹æ³•</div></div><div class="info-2"><div class="info-item-1">åœ¨ã€Œé¢å¤–CSSã€ä¸­åŠ å…¥ä»£ç ã€‚</div></div></div></a><a class="pagination-related" href="/p/1d248fa3/" title="Waline é…ç½®å¤´åƒæœåŠ¡ï¼ˆå«å¸¸ç”¨å…¬å…±å¤´åƒæœåŠ¡ä»‹ç»ï¼‰"><img class="cover" src="https://cdn.gallery.uuanqin.top/img/202410130307005.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fa-calendar-alt fa-fw far"></i> 2024-10-13</div><div class="info-item-2">Waline é…ç½®å¤´åƒæœåŠ¡ï¼ˆå«å¸¸ç”¨å…¬å…±å¤´åƒæœåŠ¡ä»‹ç»ï¼‰</div></div><div class="info-2"><div class="info-item-1">ç®€è¦ä»‹ç»å¸¸ç”¨å…¬å…±å¤´åƒæœåŠ¡ï¼Œå°è¯•åœ¨ Waline ä¸­ä¸Šæ‰‹å®è·µæ›¿æ¢é»˜è®¤å¤´åƒ</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fa-comments fa-fw fas"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-info card-widget text-center"><div class="avatar-img"><img src="/image/avatar.webp" onerror="this.onerror=null;this.src='/image/loading.gif'" alt="avatar"></div><div class="author-info-name">wuanqin</div><div class="author-info-description">åªèƒ½æ‡‚ä¸€ç‚¹ç‚¹</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">177</div></a><a href="/pages/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">393</div></a><a href="/pages/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">26</div></a></div><a id="card-info-btn" href="/pages/building.html"><i class="fa-address-card fa-solid"></i><span>ç”¨æˆ·è®¤è¯é¡µ/è°ƒè¯•é¡µ</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/uuanqin" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fa-brands fa-github"></i></a><a class="social-icon" href="mailto:uuanqin@uuanqin.top" target="_blank" title="Email"><i class="fa-at fa-solid"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-rss fa-solid"></i></a><a class="social-icon" href="https://app.follow.is/share/users/uuanqin" rel="external nofollow noreferrer" target="_blank" title="Follow"><i class="fa-solid fa-square-rss"></i></a><a class="social-icon" href="https://steamcommunity.com/id/uuanqin/" rel="external nofollow noreferrer" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a></div></div><div class="card-announcement card-widget"><div class="item-headline"><i class="fa-bullhorn fa-shake fas"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ğŸŒå…¨çƒè®¿é—®æœ¬ç«™çš„é€Ÿåº¦æ›´å¿«äº†ï¼<br> âš ï¸è´¦å•ä¿å«è¡ŒåŠ¨ï¼šå°ç ´ç«™æ­£æŠµå¾¡åäººçš„æ”»å‡»ï¼éƒ¨åˆ†çœå¸‚ç”¨æˆ·è¿‘æœŸå°†æ— æ³•è®¿é—®æœ¬ç«™ã€‚ </div></div><div class="card-widget seamless-card"><div class="item-headline"><i></i><span></span></div><div class="item-content"><div style="height:250px"> <iframe src="/DO_NOT_render/cosmoscope/cosmoscope_trim.html" frameborder="no" style="width:100%;height:100%"></iframe> </div> </div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fa-stream fas"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">1.</span> <span class="toc-text"> æˆ‘çš„æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text"> æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text"> å‰ç«¯ï¼šæ–‡ä»¶å¯¼å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AFvercel-%E6%8F%90%E4%BE%9B%E7%9A%84%E5%87%BD%E6%95%B0%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text"> åç«¯ï¼šVercel æä¾›çš„å‡½æ•°æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AF%E9%A3%9E%E6%98%9F%E7%81%AB-spark-lite"><span class="toc-number">1.3.1.</span> <span class="toc-text"> è®¯é£æ˜Ÿç« Spark Lite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-vercel-%E4%B8%AD%E7%9A%84-redis-%E9%9B%86%E6%88%90%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.2.</span> <span class="toc-text"> ä½¿ç”¨ Vercel ä¸­çš„ Redis é›†æˆæœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-api-%E6%8F%92%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text"> å®‰è£… API æ’ä»¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text"> ä»£ç æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ai-summaryjs"><span class="toc-number">2.1.</span> <span class="toc-text"> ai-summary.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ai-summarycss"><span class="toc-number">2.2.</span> <span class="toc-text"> ai-summary.css</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spark-litejs"><span class="toc-number">2.3.</span> <span class="toc-text"> spark-lite.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redisjs"><span class="toc-number">2.4.</span> <span class="toc-text"> redis.js</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">3.</span> <span class="toc-text"> åè®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E6%94%B9%E8%BF%9B"><span class="toc-number">3.1.</span> <span class="toc-text"> åç»­æ”¹è¿›</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%83%E5%BE%97"><span class="toc-number">3.2.</span> <span class="toc-text"> å¿ƒå¾—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text"> æœ¬æ–‡å‚è€ƒ</span></a></li></ol></div></div><div class="card-recent-post card-widget"><div class="item-headline"><i class="fa-history fas"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/p/10ab676/" title="çº¿æ®µæ ‘æ¨¡æ¿çš„ç†è§£å’Œä½¿ç”¨"><img src="https://cdn.gallery.uuanqin.top/img/202508270057686.webp" onerror="this.onerror=null;this.src='/image/404img.webp'" alt="çº¿æ®µæ ‘æ¨¡æ¿çš„ç†è§£å’Œä½¿ç”¨"></a><div class="content"><a class="title" href="/p/10ab676/" title="çº¿æ®µæ ‘æ¨¡æ¿çš„ç†è§£å’Œä½¿ç”¨">çº¿æ®µæ ‘æ¨¡æ¿çš„ç†è§£å’Œä½¿ç”¨</a><time datetime="2025-08-26T16:59:08.426Z" title="æ›´æ–°äº 2025-08-27 00:59:08">2025-08-27</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"></div><div class="footer_custom_text"><div class="my-footer-svg-div"> <svg class="my-footer-wave-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 100" preserveAspectRatio="none"> <path class="my-footer-wave-path" d="M851.8,100c125,0,288.3-45,348.2-64V0H0v44c3.7-1,7.3-1.9,11-2.9C80.7,22,151.7,10.8,223.5,6.3C276.7,2.9,330,4,383,9.8 c52.2,5.7,103.3,16.2,153.4,32.8C623.9,71.3,726.8,100,851.8,100z"></path> </svg> </div> <div class="my-footer-content-div"> <div class="my-footer-content"> <div class="my-footer-content-column"> <div class="my-footer-logo"> <a class="my-footer-logo-link" href="#"> <span class="hidden-link-text">LOGO</span> <img src="/image/footer/qlogo_white_no_words.png" style="height:40%;width:40%"> </a> </div> <div class="my-footer-menu"> <h2 class="my-footer-menu-name">å¼€å§‹</h2> <ul id="menu-get-started" class="my-footer-menu-list"> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a href="/pages/about.html">å…³äºæœ¬ç«™</a> </li> </ul> </div> </div> <div class="my-footer-content-column"> <div class="my-footer-menu"> <h2 class="my-footer-menu-name">å¿«é€Ÿé“¾æ¥</h2> <ul id="menu-company" class="my-footer-menu-list"> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://hexo.io/zh-cn/">Hexo</a>&nbsp;â¨¯&nbsp;<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a> </li> <li class="menu-item menu-item-object-category menu-item-type-taxonomy"> <a href="/archives/">æ—¶é—´è½´</a>&nbsp;|&nbsp;<a href="/DO_NOT_render/cosmoscope/cosmoscope_trim.html">å…³ç³»å›¾</a>&nbsp;|&nbsp;<a href="/pages/categories/">åˆ†ç±»</a> </li> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a href="/p/91b7dad/">åŒæ¬¾é¡µè„š</a> </li> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a href="https://www.foreverblog.cn/" rel="external nofollow noopener noreferrer" target="_blank"> <img class="img-foreverblog" src="/image/footer/forever_logo_en_default_white.png" alt="" style="width:auto;height:21px;margin-top:6px"> </a> </li> </ul> </div> </div> <div class="my-footer-content-column"> <div class="my-footer-menu"> <h2 class="my-footer-menu-name">æ³•å¾‹å£°æ˜</h2> <ul id="menu-legal" class="my-footer-menu-list"> <li class="menu-item menu-item-170434 menu-item-object-page menu-item-privacy-policy menu-item-type-post_type"> <a href="/pages/privacy.html">éšç§æ”¿ç­–</a> </li> </ul> </div> <div class="my-footer-call-to-action"> <h2 class="my-footer-call-to-action-title">è”ç³»æœ¬ç«™</h2> <ul id="menu-legal" class="my-footer-menu-list"> <li class="menu-item menu-item-170434 menu-item-object-page menu-item-privacy-policy menu-item-type-post_type"> <a href="/DO_NOT_render/wechatOA/index.html">å¾®ä¿¡å…¬ä¼—å·</a> </li> <li class="menu-item menu-item-170434 menu-item-object-page menu-item-privacy-policy menu-item-type-post_type"> <a class="my-footer-call-to-action-link" href="mailto:uuanqin@uuanqin.top" target="_self"> uuan<span style="display:none">@</span>qin@<span style="display:none">@</span>uuan<span style="display:none">@</span>qin.top </a> </li> </ul> </div> </div> <div class="my-footer-content-column"> <ul id="menu-get-started" class="my-footer-menu-list"> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a href="https://notbyai.fyi/" target="_blank" rel="external nofollow noopener noreferrer"><img class="img-not-ai" src="/image/footer/Written-By-Human-Not-By-AI-Badge-white.svg" alt="Written by Human, Not by AI"></a> </li> <li class="menu-item menu-item-object-product menu-item-type-post_type"> <a href="/pages/cc.html"><img src="/image/footer/by-nc-sa.svg" alt="ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…"></a> </li> <li class="menu-item menu-item-object-product menu-item-type-post_type"> Â©2022-2025 By wuanqin </li> </ul> </div> <div class="my-footer-social-links"> <svg class="my-footer-social-amoeba-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 236 54"> <path class="my-footer-social-amoeba-path" d="M223.06,43.32c-.77-7.2,1.87-28.47-20-32.53C187.78,8,180.41,18,178.32,20.7s-5.63,10.1-4.07,16.7-.13,15.23-4.06,15.91-8.75-2.9-6.89-7S167.41,36,167.15,33a18.93,18.93,0,0,0-2.64-8.53c-3.44-5.5-8-11.19-19.12-11.19a21.64,21.64,0,0,0-18.31,9.18c-2.08,2.7-5.66,9.6-4.07,16.69s.64,14.32-6.11,13.9S108.35,46.5,112,36.54s-1.89-21.24-4-23.94S96.34,0,85.23,0,57.46,8.84,56.49,24.56s6.92,20.79,7,24.59c.07,2.75-6.43,4.16-12.92,2.38s-4-10.75-3.46-12.38c1.85-6.6-2-14-4.08-16.69a21.62,21.62,0,0,0-18.3-9.18C13.62,13.28,9.06,19,5.62,24.47A18.81,18.81,0,0,0,3,33a21.85,21.85,0,0,0,1.58,9.08,16.58,16.58,0,0,1,1.06,5A6.75,6.75,0,0,1,0,54H236C235.47,54,223.83,50.52,223.06,43.32Z"></path> </svg> <a class="github my-footer-social-link" href="https://github.com/uuanqin" target="_blank" rel="external nofollow noopener noreferrer"> <span class="hidden-link-text">Github</span> <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"> <path class="my-footer-social-icon-path" d="M 16 4 C 9.371094 4 4 9.371094 4 16 C 4 21.300781 7.4375 25.800781 12.207031 27.386719 C 12.808594 27.496094 13.027344 27.128906 13.027344 26.808594 C 13.027344 26.523438 13.015625 25.769531 13.011719 24.769531 C 9.671875 25.492188 8.96875 23.160156 8.96875 23.160156 C 8.421875 21.773438 7.636719 21.402344 7.636719 21.402344 C 6.546875 20.660156 7.71875 20.675781 7.71875 20.675781 C 8.921875 20.761719 9.554688 21.910156 9.554688 21.910156 C 10.625 23.746094 12.363281 23.214844 13.046875 22.910156 C 13.15625 22.132813 13.46875 21.605469 13.808594 21.304688 C 11.144531 21.003906 8.34375 19.972656 8.34375 15.375 C 8.34375 14.0625 8.8125 12.992188 9.578125 12.152344 C 9.457031 11.851563 9.042969 10.628906 9.695313 8.976563 C 9.695313 8.976563 10.703125 8.65625 12.996094 10.207031 C 13.953125 9.941406 14.980469 9.808594 16 9.804688 C 17.019531 9.808594 18.046875 9.941406 19.003906 10.207031 C 21.296875 8.65625 22.300781 8.976563 22.300781 8.976563 C 22.957031 10.628906 22.546875 11.851563 22.421875 12.152344 C 23.191406 12.992188 23.652344 14.0625 23.652344 15.375 C 23.652344 19.984375 20.847656 20.996094 18.175781 21.296875 C 18.605469 21.664063 18.988281 22.398438 18.988281 23.515625 C 18.988281 25.121094 18.976563 26.414063 18.976563 26.808594 C 18.976563 27.128906 19.191406 27.503906 19.800781 27.386719 C 24.566406 25.796875 28 21.300781 28 16 C 28 9.371094 22.628906 4 16 4 Z "></path> </svg> </a> <a class="email my-footer-social-link" href="mailto:uuanqin@uuanqin.top" target="_blank" rel="external nofollow noopener noreferrer"> <span class="hidden-link-text">Email</span> <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">  <path class="my-footer-social-icon-path" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path> </svg> </a> <a class="follow my-footer-social-link" href="https://app.follow.is/share/users/uuanqin" target="_blank" rel="external nofollow noopener noreferrer"> <span class="hidden-link-text">Follow</span> <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">  <path class="my-footer-social-icon-path" d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path> </svg> </a> <a class="my-footer-social-link rss" href="/atom.xml" target="_blank" rel="external nofollow noopener noreferrer"> <span class="hidden-link-text">RSS</span> <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">  <path class="my-footer-social-icon-path" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path> </svg> </a> </div> </div> </div> <div class="my-footer-copyright"> <div class="my-footer-copyright-wrapper"> <p class="my-footer-copyright-text"> <a target="_blank" href="https://beian.miit.gov.cn/" rel="external nofollow noopener noreferrer"><img class="icp-icon" src="/image/footer/icp.ico"><span>æ´¥ICPå¤‡2022002156å·-1</span></a> &nbsp;|&nbsp;<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621" rel="external nofollow noopener noreferrer"><img class="icp-icon" src="/image/footer/beian_logo.png"><span>æ´¥å…¬ç½‘å®‰å¤‡ 12011202000621å·</span></a> &nbsp;|&nbsp;&nbsp; <span>è¿æ³•ä¸ä¸è‰¯ä¿¡æ¯ä¸¾æŠ¥é‚®ç®±&nbsp; j<span style="display:none">@</span>b@<span style="display:none">@</span>uuan<span style="display:none">@</span>q.in </span> </p> </div> </div> </div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fa-book-open fas"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fa-adjust fas"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fa-arrows-alt-h fas"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fa-cog fa-spin fas"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fa-list-ul fas"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fa-comments fas"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fa-arrow-up fas"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/fancyapps-ui/5.0.17/fancybox/fancybox.umd.js"></script><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/instant.page/5.2.0/instantpage.min.js" type="module"></script><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/mermaid/11.9.0/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(()=>{let initFn=window.walineFn||null,isShuoshuo='shuoshuo'===GLOBAL_CONFIG_SITE.pageType,option={locale:{nick:'æ˜µç§°',mail:'é‚®ç®±',link:'ç½‘ç«™',placeholder:'éƒ½çœ‹åˆ°è¿™äº†ï¼Œä¸å¦¨å°†ä½ çš„çœŸçŸ¥ç¼è§ç‹ ç‹ çš„å¡æ»¡æˆ‘......',requiredMeta:[],sofa:'è¯„è®ºåŒºç©ºç©ºå¦‚ä¹Ÿ~å–µå‘œå‘œå‘œ',anonymous:'åŒ¿åè®¿å®¢',login:'ç™»å½•(å¯é€‰)'},search:!1,emoji:['https://github.elemecdn.com/@waline/emojis@1.2.0/tieba/','https://github.elemecdn.com/@waline/emojis@1.2.0/bilibili/','https://github.elemecdn.com/@waline/emojis@1.2.0/qq/','https://github.elemecdn.com/@waline/emojis@1.2.0/weibo/'],reaction:['/image/comment/reaction1.gif','/image/comment/reaction2.gif','/image/comment/reaction3.gif','/image/comment/reaction4.gif','/image/comment/reaction5.gif','/image/comment/reaction6.gif'],smms:{token:'Yx2wAPCKbYms7rNGNMOACsnLe1yL62I5'}},destroyWaline=ele=>ele.destroy(),initWaline=(Fn,el=document,path=window.location.pathname)=>{let waline=Fn({el:el.querySelector('#waline-wrap'),serverURL:'https://pl.uuanqin.top',pageview:!0,dark:'html[data-theme="dark"]',comment:!0,...option,path:!isShuoshuo&&option&&option.path||path});isShuoshuo&&(window.shuoshuoComment.destroyWaline=()=>{destroyWaline(waline),el.children.length&&(el.innerHTML='',el.classList.add('no-comment'))})};var loadWaline=(el,path)=>{initFn?initWaline(initFn,el,path):btf.getCSS('/css/mywaline.css').then(()=>import('https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/waline/3.3.0/waline.js')).then(({init})=>{initFn=init||Waline.init,initWaline(initFn,el,path),window.walineFn=initFn})};isShuoshuo?window.shuoshuoComment={loadComment:loadWaline}:setTimeout(loadWaline,0)})();</script></div><script src="/js/ai-summary.js"></script><script src="/js/gray_page.js"></script><script src="/js/bi-links.js"></script><script src="/js/links-art-card.js"></script><script src="/js/genuine_website_verification4.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fa-times fas"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/algoliasearch/4.25.2/algoliasearch-lite.umd.js"></script><script src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/instantsearch.js/4.79.2/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div> <script data-pjax="">var parent,child;document.getElementById('recent-posts')&&'/'===location.pathname&&(parent=document.getElementById('recent-posts'),child='<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="/pages/categories/åšå®¢ç«™ç‚¹ç»´æŠ¤/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ åšå®¢ç»´æŠ¤ä¸ç¾åŒ– (41)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="/pages/categories/æ ¸å¿ƒååŒ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ”· æ ¸å¿ƒååŒæ¿å— (16)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="/pages/categories/ç™¾å‘³äººç”Ÿ/æœ‰æ„Ÿè€Œå‘/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ„â€â™‚ï¸ çƒ­çˆ±ç”Ÿæ´» (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="/pages/categories/åµŒå…¥å¼/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ§© åµŒå…¥å¼å¼€å‘ (16)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="/pages/categories/æŠ€æœ¯å­¦ä¹ /"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ§‘â€ğŸ’» æ¡©æ¡©çŒ«å­¦æŠ€æœ¯ (15)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="/pages/categories/ç®—æ³•ä¸æ•°æ®ç»“æ„/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ§® ç®—æ³•æ—¥è®° (17)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="/pages/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>',console.log('å·²æŒ‚è½½magnet'),parent.insertAdjacentHTML('afterbegin',child));</script><style>#catalog_magnet{flex-wrap:wrap;display:flex;width:100%;justify-content:space-between;padding:10px 10px 0;align-content:flex-start}.magnet_item{flex-basis:calc(33.333333333333336% - 5px);background:#f2f2f2;margin-bottom:10px;border-radius:8px;transition:.2s ease-in-out}.magnet_item:hover{background:#690}.magnet_link_more{color:#555}.magnet_link{color:#000}.magnet_link:hover{color:#fff}@media screen and (max-width:600px){.magnet_item{flex-basis:100%}}.magnet_link_context{display:flex;padding:10px;font-size:16px;transition:.2s ease-in-out}.magnet_link_context:hover{padding:10px 20px}</style> <style></style> <script data-pjax="">var parent,child;document.getElementById('recent-posts')&&'/'==location.pathname&&(parent=document.getElementById('recent-posts'),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://cdn.gallery.uuanqin.top/img/hexoobsidian-Grammar.webp" alt="https://cdn.gallery.uuanqin.top/img/hexoobsidian-Grammar.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-08-01</span><a class="blog-slider__title" href="p/d4bc55f2/">Hexo åšå®¢é€‚é… Obsidian æ–°è¯­æ³•</a><div class="blog-slider__text">ä½ å¯èƒ½åœ¨å¯»æ‰¾è¿™ç¯‡æ–‡ç« </div><a class="blog-slider__button" href="p/d4bc55f2/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://cdn.gallery.uuanqin.top/img/202408042352584.webp" alt="https://cdn.gallery.uuanqin.top/img/202408042352584.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-08-04</span><a class="blog-slider__title" href="p/e1ee5eca/">Hexo åšå®¢ä¸ Waline è¯„è®ºåŒºå®ç°å¤–é“¾è·³è½¬ä¸­é—´é¡µ</a><div class="blog-slider__text">æ–‡ç« æ¨è</div><a class="blog-slider__button" href="p/e1ee5eca/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://cdn.gallery.uuanqin.top/img/202411272314587.webp" alt="https://cdn.gallery.uuanqin.top/img/202411272314587.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-11-27</span><a class="blog-slider__title" href="p/8aa53d93/">è‡ªå®šä¹‰ Hexo ä¸­çš„è¶…é“¾æ¥æ ·å¼</a><div class="blog-slider__text">æœ€è¿‘æ›´æ–°å®Œå–„</div><a class="blog-slider__button" href="p/8aa53d93/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://cdn.gallery.uuanqin.top/img/202412010504201.webp" alt="https://cdn.gallery.uuanqin.top/img/202412010504201.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-12-01</span><a class="blog-slider__title" href="p/7d2de43e/">é˜²æ­¢ç½‘ç«™è¢«é•œåƒçš„è‹¥å¹²é˜²æŠ¤æªæ–½åŠååˆ¶æ‰‹æ®µ</a><div class="blog-slider__text">è¿‘æœŸçƒ­é—¨</div><a class="blog-slider__button" href="p/7d2de43e/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://cdn.gallery.uuanqin.top/img/202412100327066.webp" alt="https://cdn.gallery.uuanqin.top/img/202412100327066.webp"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-12-10</span><a class="blog-slider__title" href="p/55893d1/">å®ç°ç½‘ç«™å›½å†…å¤–åˆ†æµï¼ˆå¢ƒå¤–æ¥å…¥ Cloudflareï¼‰</a><div class="blog-slider__text">åšä¸»ç²¾é€‰</div><a class="blog-slider__button" href="p/55893d1/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>',console.log('å·²æŒ‚è½½swiper'),parent.insertAdjacentHTML('afterbegin',child));</script>    <script data-pjax="" src="https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Swiper/4.1.6/js/swiper.min.js"></script> <script data-pjax="" src="/js/swiperindex.js"></script> <style></style></body></html>