{"data":{"title":"Hexo 博客添加漂浮物效果（可定制显示页面）","slug":"博客站点维护/Hexo/Hexo 博客添加漂浮物效果（可定制显示页面）","description":"为博客添加漂浮物效果，并可定制需要显示漂浮物的页面。Hexo 优雅改。","date":"2023-04-30T10:53:23.000Z","updated":"2024-12-09T19:37:21.214Z","language":"zh-CN","comments":true,"url":"p/28a4bfe2/","cover":"https://cdn.gallery.uuanqin.top/img/starfloat.png","images":[],"content":"<p>本文为 Hexo Butterfly 主题的优雅改（只引入 js 文件）。</p>\n<p>原码参考自：<a href=\"https://yisous.xyz/posts/670e47f/#%E8%90%BD%E6%A8%B1%E7%89%B9%E6%95%88%E6%90%AD%E9%85%8D%E5%8D%9A%E5%AE%A2%E8%AE%BE%E7%BD%AE%E9%A3%9F%E7%94%A8\">博客魔改日记（3） | Ariasakaの小窝 (yisous.xyz)</a>，在其中做了改动：</p>\n<ul>\n<li>替换了部分变量和注释名</li>\n<li>增加可定制显示漂浮物页面的逻辑</li>\n</ul>\n<h1 id=\"引入方式-1作为-js-文件直接-inject-到博客中\"><a class=\"markdownIt-Anchor\" href=\"#引入方式-1作为-js-文件直接-inject-到博客中\"></a> 引入方式 1：作为 js 文件直接 inject 到博客中</h1>\n<p>这种方式在对于多个页面使用漂浮物效果时有用。</p>\n<p>使用方法：</p>\n<ul>\n<li>需要所有博客页面都显示漂浮物：将 <code>allowAll = true</code></li>\n<li>指定显示漂浮物的页面：将 <code>allowAll = false</code>，在 urlAllowList 中列出需要显示漂浮物的网页相对地址。如 <code>/about/</code>。</li>\n</ul>\n<p>优点：统一指定需要使用漂浮物的 url。</p>\n<p>缺点：还是有那么一点不灵活。</p>\n<p>js 代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 漂浮物</span></span><br><span class=\"line\"><span class=\"comment\">// 新增函数 </span></span><br><span class=\"line\"><span class=\"comment\">// 首先获取 Url，然后把 Url 通过 // 截成两部分，再从后一部分中截取相对路径。如果截取到的相对路径中有参数，则把参数去掉。</span></span><br><span class=\"line\"><span class=\"comment\">// 获取相对路径</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">GetUrlRelativePath</span>(<span class=\"params\"></span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> url = <span class=\"variable language_\">document</span>.<span class=\"property\">location</span>.<span class=\"title function_\">toString</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrUrl = url.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;//&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> start = arrUrl[<span class=\"number\">1</span>].<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> relUrl = arrUrl[<span class=\"number\">1</span>].<span class=\"title function_\">substring</span>(start);<span class=\"comment\">//stop省略，截取从start开始到结尾的所有字符</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(relUrl.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;?&quot;</span>) != -<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        relUrl = relUrl.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;?&quot;</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> relUrl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> allowAll = <span class=\"literal\">false</span>; <span class=\"comment\">// true 则允许所有网页存在漂浮物</span></span><br><span class=\"line\"><span class=\"comment\">// 允许显示漂浮物的网址列表</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> urlAllowList = [</span><br><span class=\"line\">    <span class=\"string\">&quot;/about/&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;/link/friends/&quot;</span>,</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> isAllowFloat = <span class=\"literal\">false</span>;   <span class=\"comment\">// 全局变量，允许使用漂浮特效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 判断</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">decide</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    isAllowFloat = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!allowAll)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 判断当前页面是否为指定页面</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"title class_\">GetUrlRelativePath</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(;i&lt;urlAllowList.<span class=\"property\">length</span>;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(url===urlAllowList[i])&#123;</span><br><span class=\"line\">                <span class=\"comment\">// console.log(i);</span></span><br><span class=\"line\">                isAllowFloat = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(i===urlAllowList.<span class=\"property\">length</span>)&#123;</span><br><span class=\"line\">            isAllowFloat = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(isAllowFloat)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(isAllowFloat)<span class=\"title function_\">startFloat</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stop, staticx;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">&quot;/image/star_float.png&quot;</span>; <span class=\"comment\">// 图片</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Float</span>(<span class=\"params\">x, y, s, r, fn</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = x;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = y;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = s;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = r;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span> = fn;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Float</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">draw</span> = <span class=\"keyword\">function</span>(<span class=\"params\">cxt</span>) &#123;</span><br><span class=\"line\">    cxt.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xc = <span class=\"number\">40</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> / <span class=\"number\">4</span>;</span><br><span class=\"line\">    cxt.<span class=\"title function_\">translate</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">x</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    cxt.<span class=\"title function_\">rotate</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">r</span>);</span><br><span class=\"line\">    cxt.<span class=\"title function_\">drawImage</span>(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">35</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span>, <span class=\"number\">35</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span>)</span><br><span class=\"line\">    <span class=\"comment\">//漂浮物大小</span></span><br><span class=\"line\">    cxt.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Float</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">update</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">x</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">x</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">y</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">y</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">r</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">r</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">x</span> &gt; <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> &lt; <span class=\"number\">0</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> &gt; <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnr&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() &gt; <span class=\"number\">0.4</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;x&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;y&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">FloatList</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">list</span> = [];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">push</span> = <span class=\"keyword\">function</span>(<span class=\"params\">float</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"title function_\">push</span>(float);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">update</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i].<span class=\"title function_\">update</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">draw</span> = <span class=\"keyword\">function</span>(<span class=\"params\">cxt</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i].<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">get</span> = <span class=\"keyword\">function</span>(<span class=\"params\">i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">size</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getRandom</span>(<span class=\"params\">option</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret, random;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (option) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;x&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;y&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;s&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;r&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">6</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fnx&#x27;</span>:</span><br><span class=\"line\">        random = -<span class=\"number\">0.5</span> + <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">1</span>;</span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> x + <span class=\"number\">0.5</span> * random - <span class=\"number\">0.6</span>;</span><br><span class=\"line\">            <span class=\"comment\">//x轴速度</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fny&#x27;</span>:</span><br><span class=\"line\">        random = <span class=\"number\">0.8</span> + <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">0.7</span></span><br><span class=\"line\">        <span class=\"comment\">//y轴速度</span></span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> y + random;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fnr&#x27;</span>:</span><br><span class=\"line\">        random = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">0.03</span>;</span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">r</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> r + random;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">startFloat</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    requestAnimationFrame = <span class=\"variable language_\">window</span>.<span class=\"property\">requestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">mozRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">webkitRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">msRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">oRequestAnimationFrame</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>), cxt;</span><br><span class=\"line\">    staticx = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    canvas.<span class=\"property\">height</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">    canvas.<span class=\"property\">width</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">    canvas.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;style&#x27;</span>, <span class=\"string\">&#x27;position: fixed;left: 0;top: 0;pointer-events: none;&#x27;</span>);</span><br><span class=\"line\">    canvas.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;id&#x27;</span>, <span class=\"string\">&#x27;canvas_float&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;body&#x27;</span>)[<span class=\"number\">0</span>].<span class=\"title function_\">appendChild</span>(canvas);</span><br><span class=\"line\">    cxt = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> floatList = <span class=\"keyword\">new</span> <span class=\"title class_\">FloatList</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//漂浮物数量</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> float, randomX, randomY, randomS, randomR, randomFnx, randomFny;</span><br><span class=\"line\">        randomX = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;x&#x27;</span>);</span><br><span class=\"line\">        randomY = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;y&#x27;</span>);</span><br><span class=\"line\">        randomR = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        randomS = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">        randomFnx = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnx&#x27;</span>);</span><br><span class=\"line\">        randomFny = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fny&#x27;</span>);</span><br><span class=\"line\">        randomFnR = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnr&#x27;</span>);</span><br><span class=\"line\">        float = <span class=\"keyword\">new</span> <span class=\"title class_\">Float</span>(randomX,randomY,randomS,randomR,&#123;</span><br><span class=\"line\">            <span class=\"attr\">x</span>: randomFnx,</span><br><span class=\"line\">            <span class=\"attr\">y</span>: randomFny,</span><br><span class=\"line\">            <span class=\"attr\">r</span>: randomFnR</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        float.<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">        floatList.<span class=\"title function_\">push</span>(float);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    stop = <span class=\"title function_\">requestAnimationFrame</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        cxt.<span class=\"title function_\">clearRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.<span class=\"property\">width</span>, canvas.<span class=\"property\">height</span>);</span><br><span class=\"line\">        floatList.<span class=\"title function_\">update</span>();</span><br><span class=\"line\">        floatList.<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">        stop = <span class=\"title function_\">requestAnimationFrame</span>(<span class=\"variable language_\">arguments</span>.<span class=\"property\">callee</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onresize</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!isAllowFloat)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvasSnow = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;canvas_float&#x27;</span>);</span><br><span class=\"line\">    canvasSnow.<span class=\"property\">width</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">    canvasSnow.<span class=\"property\">height</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">stopp</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!e &amp;&amp; <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> child = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>);</span><br><span class=\"line\">        child.<span class=\"property\">parentNode</span>.<span class=\"title function_\">removeChild</span>(child);</span><br><span class=\"line\">        <span class=\"variable language_\">window</span>.<span class=\"title function_\">cancelAnimationFrame</span>(stop);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e &amp;&amp; !<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">decide</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;DOMContentLoaded&quot;</span>,decide);</span><br></pre></td></tr></table></figure>\n<h1 id=\"引入方式-2只在单个普通文章中使用\"><a class=\"markdownIt-Anchor\" href=\"#引入方式-2只在单个普通文章中使用\"></a> 引入方式 2：只在单个普通文章中使用</h1>\n\n<div class=\"callout\" data-callout=\"warning\">\n<div class=\"callout-title\">\n<div class=\"callout-title-icon\">\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-alert-triangle\"><path d=\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z\"/><path d=\"M12 9v4\"/><path d=\"M12 17h.01\"/></svg>\n</div>\n<div class=\"callout-title-inner\">使用本方式时，开启 Pjax 会导致漂浮物应用范围错乱</div>\n</div>\n<div class=\"callout-content\"><p></p>\n</div></div><p>就像本页面展示的效果那样。</p>\n<ul>\n<li>优点：省去博客每次都要请求一个 js 文件。</li>\n<li>缺点：不灵活。</li>\n</ul>\n<p>直接在文章末尾插入 script，等 markdown 文件渲染成 html 后就相当于只注入这段脚本到当前页面：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> stop, staticx;</span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">&quot;/image/star_float.png&quot;</span>; <span class=\"comment\">// 图片</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">Float</span>(<span class=\"params\">x, y, s, r, fn</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = x;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = y;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = s;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = r;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span> = fn;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Float</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">draw</span> = <span class=\"keyword\">function</span>(<span class=\"params\">cxt</span>) &#123;</span><br><span class=\"line\">    cxt.<span class=\"title function_\">save</span>();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xc = <span class=\"number\">40</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> / <span class=\"number\">4</span>;</span><br><span class=\"line\">    cxt.<span class=\"title function_\">translate</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">x</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    cxt.<span class=\"title function_\">rotate</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">r</span>);</span><br><span class=\"line\">    cxt.<span class=\"title function_\">drawImage</span>(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">35</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span>, <span class=\"number\">35</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">s</span>)</span><br><span class=\"line\">    <span class=\"comment\">//漂浮物大小</span></span><br><span class=\"line\">    cxt.<span class=\"title function_\">restore</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Float</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">update</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">x</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">x</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">y</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">y</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">y</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">fn</span>.<span class=\"title function_\">r</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">r</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">x</span> &gt; <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> &lt; <span class=\"number\">0</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> &gt; <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span> || <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnr&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() &gt; <span class=\"number\">0.4</span>) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;x&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">x</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">y</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;y&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">s</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">r</span> = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">FloatList</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">list</span> = [];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">push</span> = <span class=\"keyword\">function</span>(<span class=\"params\">float</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"title function_\">push</span>(float);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">update</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i].<span class=\"title function_\">update</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">draw</span> = <span class=\"keyword\">function</span>(<span class=\"params\">cxt</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i].<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">get</span> = <span class=\"keyword\">function</span>(<span class=\"params\">i</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>[i];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title class_\">FloatList</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">size</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">list</span>.<span class=\"property\">length</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getRandom</span>(<span class=\"params\">option</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret, random;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (option) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;x&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;y&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;s&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>();</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;r&#x27;</span>:</span><br><span class=\"line\">        ret = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">6</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fnx&#x27;</span>:</span><br><span class=\"line\">        random = -<span class=\"number\">0.5</span> + <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">1</span>;</span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> x + <span class=\"number\">0.5</span> * random - <span class=\"number\">0.6</span>;</span><br><span class=\"line\">            <span class=\"comment\">//x轴速度</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fny&#x27;</span>:</span><br><span class=\"line\">        random = <span class=\"number\">0.8</span> + <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">0.7</span></span><br><span class=\"line\">        <span class=\"comment\">//y轴速度</span></span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">x, y</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> y + random;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">&#x27;fnr&#x27;</span>:</span><br><span class=\"line\">        random = <span class=\"title class_\">Math</span>.<span class=\"title function_\">random</span>() * <span class=\"number\">0.03</span>;</span><br><span class=\"line\">        ret = <span class=\"keyword\">function</span>(<span class=\"params\">r</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> r + random;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">startFloat</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    requestAnimationFrame = <span class=\"variable language_\">window</span>.<span class=\"property\">requestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">mozRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">webkitRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">msRequestAnimationFrame</span> || <span class=\"variable language_\">window</span>.<span class=\"property\">oRequestAnimationFrame</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;canvas&#x27;</span>), cxt;</span><br><span class=\"line\">    staticx = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    canvas.<span class=\"property\">height</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">    canvas.<span class=\"property\">width</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">    canvas.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;style&#x27;</span>, <span class=\"string\">&#x27;position: fixed;left: 0;top: 0;pointer-events: none;&#x27;</span>);</span><br><span class=\"line\">    canvas.<span class=\"title function_\">setAttribute</span>(<span class=\"string\">&#x27;id&#x27;</span>, <span class=\"string\">&#x27;canvas_float&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&#x27;body&#x27;</span>)[<span class=\"number\">0</span>].<span class=\"title function_\">appendChild</span>(canvas);</span><br><span class=\"line\">    cxt = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> floatList = <span class=\"keyword\">new</span> <span class=\"title class_\">FloatList</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//漂浮物数量</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> float, randomX, randomY, randomS, randomR, randomFnx, randomFny;</span><br><span class=\"line\">        randomX = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;x&#x27;</span>);</span><br><span class=\"line\">        randomY = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;y&#x27;</span>);</span><br><span class=\"line\">        randomR = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;r&#x27;</span>);</span><br><span class=\"line\">        randomS = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;s&#x27;</span>);</span><br><span class=\"line\">        randomFnx = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnx&#x27;</span>);</span><br><span class=\"line\">        randomFny = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fny&#x27;</span>);</span><br><span class=\"line\">        randomFnR = <span class=\"title function_\">getRandom</span>(<span class=\"string\">&#x27;fnr&#x27;</span>);</span><br><span class=\"line\">        float = <span class=\"keyword\">new</span> <span class=\"title class_\">Float</span>(randomX,randomY,randomS,randomR,&#123;</span><br><span class=\"line\">            <span class=\"attr\">x</span>: randomFnx,</span><br><span class=\"line\">            <span class=\"attr\">y</span>: randomFny,</span><br><span class=\"line\">            <span class=\"attr\">r</span>: randomFnR</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        float.<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">        floatList.<span class=\"title function_\">push</span>(float);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    stop = <span class=\"title function_\">requestAnimationFrame</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        cxt.<span class=\"title function_\">clearRect</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.<span class=\"property\">width</span>, canvas.<span class=\"property\">height</span>);</span><br><span class=\"line\">        floatList.<span class=\"title function_\">update</span>();</span><br><span class=\"line\">        floatList.<span class=\"title function_\">draw</span>(cxt);</span><br><span class=\"line\">        stop = <span class=\"title function_\">requestAnimationFrame</span>(<span class=\"variable language_\">arguments</span>.<span class=\"property\">callee</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onresize</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!isAllowFloat)<span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvasSnow = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;canvas_float&#x27;</span>);</span><br><span class=\"line\">    canvasSnow.<span class=\"property\">width</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span>;</span><br><span class=\"line\">    canvasSnow.<span class=\"property\">height</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">stopp</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!e &amp;&amp; <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> child = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>);</span><br><span class=\"line\">        child.<span class=\"property\">parentNode</span>.<span class=\"title function_\">removeChild</span>(child);</span><br><span class=\"line\">        <span class=\"variable language_\">window</span>.<span class=\"title function_\">cancelAnimationFrame</span>(stop);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e &amp;&amp; !<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;canvas_float&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//decide();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_\">startFloat</span>();</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>这段脚本其实就是把页面判断逻辑删去了。注意选择的图片路径。</p>\n<h1 id=\"未来计划\"><a class=\"markdownIt-Anchor\" href=\"#未来计划\"></a> 未来计划</h1>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> 简化 Script</li>\n<li class=\"task-list-item\"><input class=\"task-list-item-checkbox\" disabled=\"\" type=\"checkbox\"> 节日触发漂浮物效果，以及优雅进行实现。<a href=\"https://blog.csdn.net/LEVsunshine/article/details/109069345\">js处理时间戳为各种格式/js判断公历/农历/周历节日和节气_js 二十四节气计算_to Zero-的博客-CSDN博客</a></li>\n</ul>\n<script>\n\nvar stop, staticx;\nvar img = new Image();\nimg.src = \"/image/star_float.png\"; // 图片\n\nfunction Float(x, y, s, r, fn) {\n    this.x = x;\n    this.y = y;\n    this.s = s;\n    this.r = r;\n    this.fn = fn;\n}\n\nFloat.prototype.draw = function(cxt) {\n    cxt.save();\n    var xc = 40 * this.s / 4;\n    cxt.translate(this.x, this.y);\n    cxt.rotate(this.r);\n    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)\n    //漂浮物大小\n    cxt.restore();\n}\n\nFloat.prototype.update = function() {\n    this.x = this.fn.x(this.x, this.y);\n    this.y = this.fn.y(this.y, this.y);\n    this.r = this.fn.r(this.r);\n    if (this.x > window.innerWidth || this.x < 0 || this.y > window.innerHeight || this.y < 0) {\n        this.r = getRandom('fnr');\n        if (Math.random() > 0.4) {\n            this.x = getRandom('x');\n            this.y = 0;\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        } else {\n            this.x = window.innerWidth;\n            this.y = getRandom('y');\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        }\n    }\n}\n\nFloatList = function() {\n    this.list = [];\n}\nFloatList.prototype.push = function(float) {\n    this.list.push(float);\n}\nFloatList.prototype.update = function() {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].update();\n    }\n}\nFloatList.prototype.draw = function(cxt) {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].draw(cxt);\n    }\n}\nFloatList.prototype.get = function(i) {\n    return this.list[i];\n}\nFloatList.prototype.size = function() {\n    return this.list.length;\n}\n\nfunction getRandom(option) {\n    var ret, random;\n    switch (option) {\n    case 'x':\n        ret = Math.random() * window.innerWidth;\n        break;\n    case 'y':\n        ret = Math.random() * window.innerHeight;\n        break;\n    case 's':\n        ret = Math.random();\n        break;\n    case 'r':\n        ret = Math.random() * 6;\n        break;\n    case 'fnx':\n        random = -0.5 + Math.random() * 1;\n        ret = function(x, y) {\n            return x + 0.5 * random - 0.6;\n            //x轴速度\n        }\n        ;\n        break;\n    case 'fny':\n        random = 0.8 + Math.random() * 0.7\n        //y轴速度\n        ret = function(x, y) {\n            return y + random;\n        }\n        ;\n        break;\n    case 'fnr':\n        random = Math.random() * 0.03;\n        ret = function(r) {\n            return r + random;\n        }\n        ;\n        break;\n    }\n    return ret;\n}\n\nfunction startFloat() {\n\n    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;\n    var canvas = document.createElement('canvas'), cxt;\n    staticx = true;\n    canvas.height = window.innerHeight;\n    canvas.width = window.innerWidth;\n    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');\n    canvas.setAttribute('id', 'canvas_float');\n    document.getElementsByTagName('body')[0].appendChild(canvas);\n    cxt = canvas.getContext('2d');\n    var floatList = new FloatList();\n    for (var i = 0; i < 10; i++) {\n        //漂浮物数量\n        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;\n        randomX = getRandom('x');\n        randomY = getRandom('y');\n        randomR = getRandom('r');\n        randomS = getRandom('s');\n        randomFnx = getRandom('fnx');\n        randomFny = getRandom('fny');\n        randomFnR = getRandom('fnr');\n        float = new Float(randomX,randomY,randomS,randomR,{\n            x: randomFnx,\n            y: randomFny,\n            r: randomFnR\n        });\n        float.draw(cxt);\n        floatList.push(float);\n    }\n    stop = requestAnimationFrame(function() {\n        cxt.clearRect(0, 0, canvas.width, canvas.height);\n        floatList.update();\n        floatList.draw(cxt);\n        stop = requestAnimationFrame(arguments.callee);\n    })\n}\n\nwindow.onresize = function() {\n    if(!isAllowFloat)return;\n    var canvasSnow = document.getElementById('canvas_float');\n    canvasSnow.width = window.innerWidth;\n    canvasSnow.height = window.innerHeight;\n}\n\nfunction stopp(e) {\n    if (!e && document.getElementById(\"canvas_float\")) {\n        var child = document.getElementById(\"canvas_float\");\n        child.parentNode.removeChild(child);\n        window.cancelAnimationFrame(stop);\n    } else if (e && !document.getElementById(\"canvas_float\")) {\n        //decide();\n    }\n}\n\nstartFloat();\n</script>","raw":"---\ntitle: Hexo 博客添加漂浮物效果（可定制显示页面）\ntags:\n  - ButterFly\n  - JavaScript\ncover: 'https://cdn.gallery.uuanqin.top/img/starfloat.png'\ndescription: 为博客添加漂浮物效果，并可定制需要显示漂浮物的页面。Hexo 优雅改。\nabbrlink: 28a4bfe2\ncategories:\n  - 博客站点维护\n  - Hexo\ndate: 2023-04-30 18:53:23\n---\n\n本文为 Hexo Butterfly 主题的优雅改（只引入 js 文件）。\n\n原码参考自：[博客魔改日记（3） | Ariasakaの小窝 (yisous.xyz)](https://yisous.xyz/posts/670e47f/#落樱特效搭配博客设置食用)，在其中做了改动：\n\n* 替换了部分变量和注释名\n* 增加可定制显示漂浮物页面的逻辑\n\n# 引入方式 1：作为 js 文件直接 inject 到博客中\n\n这种方式在对于多个页面使用漂浮物效果时有用。\n\n使用方法：\n\n* 需要所有博客页面都显示漂浮物：将 `allowAll = true`\n* 指定显示漂浮物的页面：将 `allowAll = false`，在 urlAllowList 中列出需要显示漂浮物的网页相对地址。如 `/about/`。\n\n优点：统一指定需要使用漂浮物的 url。\n\n缺点：还是有那么一点不灵活。\n\njs 代码：\n\n```js\n// 漂浮物\n// 新增函数 \n// 首先获取 Url，然后把 Url 通过 // 截成两部分，再从后一部分中截取相对路径。如果截取到的相对路径中有参数，则把参数去掉。\n// 获取相对路径\nfunction GetUrlRelativePath()\n{\n    var url = document.location.toString();\n    var arrUrl = url.split(\"//\");\n\n    var start = arrUrl[1].indexOf(\"/\");\n    var relUrl = arrUrl[1].substring(start);//stop省略，截取从start开始到结尾的所有字符\n\n    if(relUrl.indexOf(\"?\") != -1){\n        relUrl = relUrl.split(\"?\")[0];\n    }\n    return relUrl;\n}\nvar allowAll = false; // true 则允许所有网页存在漂浮物\n// 允许显示漂浮物的网址列表\nvar urlAllowList = [\n    \"/about/\",\n    \"/link/friends/\",\n]\n\nvar isAllowFloat = false;   // 全局变量，允许使用漂浮特效\n\n// 判断\nfunction decide(){\n    isAllowFloat = true;\n    if(!allowAll){\n        // 判断当前页面是否为指定页面\n        var url = GetUrlRelativePath();\n        var i = 0;\n        for(;i<urlAllowList.length;i++){\n            if(url===urlAllowList[i]){\n                // console.log(i);\n                isAllowFloat = true;\n                break;\n            }\n        }\n        if(i===urlAllowList.length){\n            isAllowFloat = false;\n        }\n    }\n    console.log(isAllowFloat)\n    if(isAllowFloat)startFloat();\n}\n\nvar stop, staticx;\nvar img = new Image();\nimg.src = \"/image/star_float.png\"; // 图片\n\nfunction Float(x, y, s, r, fn) {\n    this.x = x;\n    this.y = y;\n    this.s = s;\n    this.r = r;\n    this.fn = fn;\n}\n\nFloat.prototype.draw = function(cxt) {\n    cxt.save();\n    var xc = 40 * this.s / 4;\n    cxt.translate(this.x, this.y);\n    cxt.rotate(this.r);\n    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)\n    //漂浮物大小\n    cxt.restore();\n}\n\nFloat.prototype.update = function() {\n    this.x = this.fn.x(this.x, this.y);\n    this.y = this.fn.y(this.y, this.y);\n    this.r = this.fn.r(this.r);\n    if (this.x > window.innerWidth || this.x < 0 || this.y > window.innerHeight || this.y < 0) {\n        this.r = getRandom('fnr');\n        if (Math.random() > 0.4) {\n            this.x = getRandom('x');\n            this.y = 0;\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        } else {\n            this.x = window.innerWidth;\n            this.y = getRandom('y');\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        }\n    }\n}\n\nFloatList = function() {\n    this.list = [];\n}\nFloatList.prototype.push = function(float) {\n    this.list.push(float);\n}\nFloatList.prototype.update = function() {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].update();\n    }\n}\nFloatList.prototype.draw = function(cxt) {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].draw(cxt);\n    }\n}\nFloatList.prototype.get = function(i) {\n    return this.list[i];\n}\nFloatList.prototype.size = function() {\n    return this.list.length;\n}\n\nfunction getRandom(option) {\n    var ret, random;\n    switch (option) {\n    case 'x':\n        ret = Math.random() * window.innerWidth;\n        break;\n    case 'y':\n        ret = Math.random() * window.innerHeight;\n        break;\n    case 's':\n        ret = Math.random();\n        break;\n    case 'r':\n        ret = Math.random() * 6;\n        break;\n    case 'fnx':\n        random = -0.5 + Math.random() * 1;\n        ret = function(x, y) {\n            return x + 0.5 * random - 0.6;\n            //x轴速度\n        }\n        ;\n        break;\n    case 'fny':\n        random = 0.8 + Math.random() * 0.7\n        //y轴速度\n        ret = function(x, y) {\n            return y + random;\n        }\n        ;\n        break;\n    case 'fnr':\n        random = Math.random() * 0.03;\n        ret = function(r) {\n            return r + random;\n        }\n        ;\n        break;\n    }\n    return ret;\n}\n\nfunction startFloat() {\n\n    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;\n    var canvas = document.createElement('canvas'), cxt;\n    staticx = true;\n    canvas.height = window.innerHeight;\n    canvas.width = window.innerWidth;\n    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');\n    canvas.setAttribute('id', 'canvas_float');\n    document.getElementsByTagName('body')[0].appendChild(canvas);\n    cxt = canvas.getContext('2d');\n    var floatList = new FloatList();\n    for (var i = 0; i < 10; i++) {\n        //漂浮物数量\n        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;\n        randomX = getRandom('x');\n        randomY = getRandom('y');\n        randomR = getRandom('r');\n        randomS = getRandom('s');\n        randomFnx = getRandom('fnx');\n        randomFny = getRandom('fny');\n        randomFnR = getRandom('fnr');\n        float = new Float(randomX,randomY,randomS,randomR,{\n            x: randomFnx,\n            y: randomFny,\n            r: randomFnR\n        });\n        float.draw(cxt);\n        floatList.push(float);\n    }\n    stop = requestAnimationFrame(function() {\n        cxt.clearRect(0, 0, canvas.width, canvas.height);\n        floatList.update();\n        floatList.draw(cxt);\n        stop = requestAnimationFrame(arguments.callee);\n    })\n}\n\nwindow.onresize = function() {\n    if(!isAllowFloat)return;\n    var canvasSnow = document.getElementById('canvas_float');\n    canvasSnow.width = window.innerWidth;\n    canvasSnow.height = window.innerHeight;\n}\n\nfunction stopp(e) {\n    if (!e && document.getElementById(\"canvas_float\")) {\n        var child = document.getElementById(\"canvas_float\");\n        child.parentNode.removeChild(child);\n        window.cancelAnimationFrame(stop);\n    } else if (e && !document.getElementById(\"canvas_float\")) {\n        decide();\n    }\n}\n\nwindow.addEventListener(\"DOMContentLoaded\",decide);\n```\n\n# 引入方式 2：只在单个普通文章中使用\n\n> [!warning] 使用本方式时，开启 Pjax 会导致漂浮物应用范围错乱\n\n就像本页面展示的效果那样。\n\n- 优点：省去博客每次都要请求一个 js 文件。\n- 缺点：不灵活。\n\n直接在文章末尾插入 script，等 markdown 文件渲染成 html 后就相当于只注入这段脚本到当前页面：\n\n```js\n<script>\n\nvar stop, staticx;\nvar img = new Image();\nimg.src = \"/image/star_float.png\"; // 图片\n\nfunction Float(x, y, s, r, fn) {\n    this.x = x;\n    this.y = y;\n    this.s = s;\n    this.r = r;\n    this.fn = fn;\n}\n\nFloat.prototype.draw = function(cxt) {\n    cxt.save();\n    var xc = 40 * this.s / 4;\n    cxt.translate(this.x, this.y);\n    cxt.rotate(this.r);\n    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)\n    //漂浮物大小\n    cxt.restore();\n}\n\nFloat.prototype.update = function() {\n    this.x = this.fn.x(this.x, this.y);\n    this.y = this.fn.y(this.y, this.y);\n    this.r = this.fn.r(this.r);\n    if (this.x > window.innerWidth || this.x < 0 || this.y > window.innerHeight || this.y < 0) {\n        this.r = getRandom('fnr');\n        if (Math.random() > 0.4) {\n            this.x = getRandom('x');\n            this.y = 0;\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        } else {\n            this.x = window.innerWidth;\n            this.y = getRandom('y');\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        }\n    }\n}\n\nFloatList = function() {\n    this.list = [];\n}\nFloatList.prototype.push = function(float) {\n    this.list.push(float);\n}\nFloatList.prototype.update = function() {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].update();\n    }\n}\nFloatList.prototype.draw = function(cxt) {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].draw(cxt);\n    }\n}\nFloatList.prototype.get = function(i) {\n    return this.list[i];\n}\nFloatList.prototype.size = function() {\n    return this.list.length;\n}\n\nfunction getRandom(option) {\n    var ret, random;\n    switch (option) {\n    case 'x':\n        ret = Math.random() * window.innerWidth;\n        break;\n    case 'y':\n        ret = Math.random() * window.innerHeight;\n        break;\n    case 's':\n        ret = Math.random();\n        break;\n    case 'r':\n        ret = Math.random() * 6;\n        break;\n    case 'fnx':\n        random = -0.5 + Math.random() * 1;\n        ret = function(x, y) {\n            return x + 0.5 * random - 0.6;\n            //x轴速度\n        }\n        ;\n        break;\n    case 'fny':\n        random = 0.8 + Math.random() * 0.7\n        //y轴速度\n        ret = function(x, y) {\n            return y + random;\n        }\n        ;\n        break;\n    case 'fnr':\n        random = Math.random() * 0.03;\n        ret = function(r) {\n            return r + random;\n        }\n        ;\n        break;\n    }\n    return ret;\n}\n\nfunction startFloat() {\n\n    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;\n    var canvas = document.createElement('canvas'), cxt;\n    staticx = true;\n    canvas.height = window.innerHeight;\n    canvas.width = window.innerWidth;\n    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');\n    canvas.setAttribute('id', 'canvas_float');\n    document.getElementsByTagName('body')[0].appendChild(canvas);\n    cxt = canvas.getContext('2d');\n    var floatList = new FloatList();\n    for (var i = 0; i < 10; i++) {\n        //漂浮物数量\n        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;\n        randomX = getRandom('x');\n        randomY = getRandom('y');\n        randomR = getRandom('r');\n        randomS = getRandom('s');\n        randomFnx = getRandom('fnx');\n        randomFny = getRandom('fny');\n        randomFnR = getRandom('fnr');\n        float = new Float(randomX,randomY,randomS,randomR,{\n            x: randomFnx,\n            y: randomFny,\n            r: randomFnR\n        });\n        float.draw(cxt);\n        floatList.push(float);\n    }\n    stop = requestAnimationFrame(function() {\n        cxt.clearRect(0, 0, canvas.width, canvas.height);\n        floatList.update();\n        floatList.draw(cxt);\n        stop = requestAnimationFrame(arguments.callee);\n    })\n}\n\nwindow.onresize = function() {\n    if(!isAllowFloat)return;\n    var canvasSnow = document.getElementById('canvas_float');\n    canvasSnow.width = window.innerWidth;\n    canvasSnow.height = window.innerHeight;\n}\n\nfunction stopp(e) {\n    if (!e && document.getElementById(\"canvas_float\")) {\n        var child = document.getElementById(\"canvas_float\");\n        child.parentNode.removeChild(child);\n        window.cancelAnimationFrame(stop);\n    } else if (e && !document.getElementById(\"canvas_float\")) {\n        //decide();\n    }\n}\n\nstartFloat();\n</script>\n```\n\n这段脚本其实就是把页面判断逻辑删去了。注意选择的图片路径。\n\n# 未来计划\n\n- [ ] 简化 Script\n- [ ] 节日触发漂浮物效果，以及优雅进行实现。[js处理时间戳为各种格式/js判断公历/农历/周历节日和节气_js 二十四节气计算_to Zero-的博客-CSDN博客](https://blog.csdn.net/LEVsunshine/article/details/109069345)\n\n<script>\n\nvar stop, staticx;\nvar img = new Image();\nimg.src = \"/image/star_float.png\"; // 图片\n\nfunction Float(x, y, s, r, fn) {\n    this.x = x;\n    this.y = y;\n    this.s = s;\n    this.r = r;\n    this.fn = fn;\n}\n\nFloat.prototype.draw = function(cxt) {\n    cxt.save();\n    var xc = 40 * this.s / 4;\n    cxt.translate(this.x, this.y);\n    cxt.rotate(this.r);\n    cxt.drawImage(img, 0, 0, 35 * this.s, 35 * this.s)\n    //漂浮物大小\n    cxt.restore();\n}\n\nFloat.prototype.update = function() {\n    this.x = this.fn.x(this.x, this.y);\n    this.y = this.fn.y(this.y, this.y);\n    this.r = this.fn.r(this.r);\n    if (this.x > window.innerWidth || this.x < 0 || this.y > window.innerHeight || this.y < 0) {\n        this.r = getRandom('fnr');\n        if (Math.random() > 0.4) {\n            this.x = getRandom('x');\n            this.y = 0;\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        } else {\n            this.x = window.innerWidth;\n            this.y = getRandom('y');\n            this.s = getRandom('s');\n            this.r = getRandom('r');\n        }\n    }\n}\n\nFloatList = function() {\n    this.list = [];\n}\nFloatList.prototype.push = function(float) {\n    this.list.push(float);\n}\nFloatList.prototype.update = function() {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].update();\n    }\n}\nFloatList.prototype.draw = function(cxt) {\n    for (var i = 0, len = this.list.length; i < len; i++) {\n        this.list[i].draw(cxt);\n    }\n}\nFloatList.prototype.get = function(i) {\n    return this.list[i];\n}\nFloatList.prototype.size = function() {\n    return this.list.length;\n}\n\nfunction getRandom(option) {\n    var ret, random;\n    switch (option) {\n    case 'x':\n        ret = Math.random() * window.innerWidth;\n        break;\n    case 'y':\n        ret = Math.random() * window.innerHeight;\n        break;\n    case 's':\n        ret = Math.random();\n        break;\n    case 'r':\n        ret = Math.random() * 6;\n        break;\n    case 'fnx':\n        random = -0.5 + Math.random() * 1;\n        ret = function(x, y) {\n            return x + 0.5 * random - 0.6;\n            //x轴速度\n        }\n        ;\n        break;\n    case 'fny':\n        random = 0.8 + Math.random() * 0.7\n        //y轴速度\n        ret = function(x, y) {\n            return y + random;\n        }\n        ;\n        break;\n    case 'fnr':\n        random = Math.random() * 0.03;\n        ret = function(r) {\n            return r + random;\n        }\n        ;\n        break;\n    }\n    return ret;\n}\n\nfunction startFloat() {\n\n    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;\n    var canvas = document.createElement('canvas'), cxt;\n    staticx = true;\n    canvas.height = window.innerHeight;\n    canvas.width = window.innerWidth;\n    canvas.setAttribute('style', 'position: fixed;left: 0;top: 0;pointer-events: none;');\n    canvas.setAttribute('id', 'canvas_float');\n    document.getElementsByTagName('body')[0].appendChild(canvas);\n    cxt = canvas.getContext('2d');\n    var floatList = new FloatList();\n    for (var i = 0; i < 10; i++) {\n        //漂浮物数量\n        var float, randomX, randomY, randomS, randomR, randomFnx, randomFny;\n        randomX = getRandom('x');\n        randomY = getRandom('y');\n        randomR = getRandom('r');\n        randomS = getRandom('s');\n        randomFnx = getRandom('fnx');\n        randomFny = getRandom('fny');\n        randomFnR = getRandom('fnr');\n        float = new Float(randomX,randomY,randomS,randomR,{\n            x: randomFnx,\n            y: randomFny,\n            r: randomFnR\n        });\n        float.draw(cxt);\n        floatList.push(float);\n    }\n    stop = requestAnimationFrame(function() {\n        cxt.clearRect(0, 0, canvas.width, canvas.height);\n        floatList.update();\n        floatList.draw(cxt);\n        stop = requestAnimationFrame(arguments.callee);\n    })\n}\n\nwindow.onresize = function() {\n    if(!isAllowFloat)return;\n    var canvasSnow = document.getElementById('canvas_float');\n    canvasSnow.width = window.innerWidth;\n    canvasSnow.height = window.innerHeight;\n}\n\nfunction stopp(e) {\n    if (!e && document.getElementById(\"canvas_float\")) {\n        var child = document.getElementById(\"canvas_float\");\n        child.parentNode.removeChild(child);\n        window.cancelAnimationFrame(stop);\n    } else if (e && !document.getElementById(\"canvas_float\")) {\n        //decide();\n    }\n}\n\nstartFloat();\n</script>","categories":[{"name":"博客站点维护","api":"api/categories/博客站点维护.json"},{"name":"Hexo","api":"api/categories/博客站点维护/Hexo.json"}],"tags":[{"name":"JavaScript","api":"api/tags/JavaScript.json"},{"name":"ButterFly","api":"api/tags/ButterFly.json"}]},"api":"api/posts/p/28a4bfe2.json"}