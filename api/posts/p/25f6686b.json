{"data":{"title":"页面展示用户 IP 地址及地理位置信息","slug":"博客站点维护/页面展示用户 IP 地址及地理位置信息","description":"利用 API 获取 IP 地址信息，这也是对 Heo 方案的改进","date":"2023-09-09T08:13:29.000Z","updated":"2024-12-09T19:37:21.214Z","language":"zh-CN","comments":true,"url":"p/25f6686b/","cover":"https://cdn.gallery.uuanqin.top/img/1590736606072ip.webp","images":[],"content":"<p>最近开始筹备隐私政策的撰写了，注意到 <a href=\"https://blog.zhheo.com\">洪涝 Heo</a> 的隐私政策有这样一个表格，感觉有趣，尝试借鉴一下：</p>\n<p><img src= \"/image/loading.gif\" data-lazy-src=\"https://cdn.gallery.uuanqin.top/img/20230909161740.webp\" alt=\"\" /></p>\n<p>Heo 发布过这一教程：<a href=\"https://blog.zhheo.com/p/70bd84fc.html\">js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)</a> 但是近期该 API 出现了一些问题（从上图你可以发现其中的问题所在）。下面我通过使用另一个接口： <a href=\"https://2023.ipchaxun.com/\">https://2023.ipchaxun.com/</a> 来尝试实现这个功能。</p>\n<h1 id=\"实现效果\"><a class=\"markdownIt-Anchor\" href=\"#实现效果\"></a> 实现效果</h1>\n<script src=\"/js/privacy.js\"></script>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型<div style=\"width:100px\"></th>\n<th style=\"text-align:left\">信息</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">IP 地址</td>\n<td style=\"text-align:left\"><div id=\"userAgentIp\"></div></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">国家</td>\n<td style=\"text-align:left\"><div id=\"userAgentCountry\"></div></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">省份</td>\n<td style=\"text-align:left\"><div id=\"userAgentRegion\"></div></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">城市</td>\n<td style=\"text-align:left\"><div id=\"userAgentCity\"></div></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">运营商</td>\n<td style=\"text-align:left\"><div id=\"userAgentIsp\"></div></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">UA</td>\n<td style=\"text-align:left\"><div id=\"userAgent\"></div></td>\n</tr>\n</tbody>\n</table>\n<script type=\"text/javascript\">getIpInfo()</script>\n<h1 id=\"编写新的-js-文件\"><a class=\"markdownIt-Anchor\" href=\"#编写新的-js-文件\"></a> 编写新的 JS 文件</h1>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取ip</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">getIpInfo</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> path = <span class=\"string\">&#x27;https://2024.ipchaxun.com/&#x27;</span>; <span class=\"comment\">// 实测这网址会更新，比如刚写这篇文章时接口地址是2023</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(path !== <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">\t    <span class=\"comment\">// 第一步：建立所需的对象</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> httpRequest = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 第二步：打开连接  将请求参数写在url中  ps:&quot;./Ptest.php?name=test&amp;nameone=testone&quot;</span></span><br><span class=\"line\">        httpRequest.<span class=\"title function_\">open</span>(<span class=\"string\">&#x27;GET&#x27;</span>, path , <span class=\"literal\">true</span>);</span><br><span class=\"line\">        httpRequest.<span class=\"title function_\">send</span>();<span class=\"comment\">//第三步：发送请求  将请求参数写在URL中</span></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 获取数据后的处理程序</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        httpRequest.<span class=\"property\">onreadystatechange</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (httpRequest.<span class=\"property\">readyState</span> == <span class=\"number\">4</span> &amp;&amp; httpRequest.<span class=\"property\">status</span> == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> info = httpRequest.<span class=\"property\">responseText</span>;<span class=\"comment\">//获取到json字符串，还需解析</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> obj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(info)</span><br><span class=\"line\">                <span class=\"keyword\">const</span> ip = obj.<span class=\"property\">ip</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgentIp&quot;</span>).<span class=\"property\">innerHTML</span> = obj.<span class=\"property\">ip</span>;</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgentCountry&quot;</span>).<span class=\"property\">innerHTML</span> = obj.<span class=\"property\">data</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgentRegion&quot;</span>).<span class=\"property\">innerHTML</span> = obj.<span class=\"property\">data</span>[<span class=\"number\">1</span>];</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgentCity&quot;</span>).<span class=\"property\">innerHTML</span> = obj.<span class=\"property\">data</span>[<span class=\"number\">2</span>];</span><br><span class=\"line\">                <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgentIsp&quot;</span>).<span class=\"property\">innerHTML</span> = obj.<span class=\"property\">data</span>[<span class=\"number\">4</span>];</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;privacy.js - 获取信息失败. httpRequest.readyState=%d, httpRequest.status=%d&#x27;</span>,httpRequest.<span class=\"property\">readyState</span>,httpRequest.<span class=\"property\">status</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;privacy.js - path === undefined&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> uaInfo = navigator.<span class=\"property\">userAgent</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&quot;userAgent&quot;</span>).<span class=\"property\">innerHTML</span> = uaInfo;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个文件是由洪涝 Heo <a href=\"https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/privacy/privacy.js\">https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/privacy/privacy.js</a> 改动而来。我们不妨也将其命名为 <code>privacy.js</code> 吧。</p>\n<h1 id=\"页面使用\"><a class=\"markdownIt-Anchor\" href=\"#页面使用\"></a> 页面使用</h1>\n<p>Hexo 新建页面，写入以下内容即可。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;[你的 privacy.js 路径]&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">| 类型<span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width:100px&quot;</span>&gt;</span></span> | 信息                              |</span><br><span class=\"line\">| :---------------------------: | :-------------------------------- |</span><br><span class=\"line\">|            IP 地址            | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgentIp&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>      |</span><br><span class=\"line\">|             国家              | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgentCountry&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span> |</span><br><span class=\"line\">|             省份              | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgentRegion&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>  |</span><br><span class=\"line\">|             城市              | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgentCity&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>    |</span><br><span class=\"line\">|            运营商             | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgentIsp&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>     |</span><br><span class=\"line\">|              UA               | <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;userAgent&quot;</span>&gt;</span></span><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>        |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span></span>getIpInfo()<span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>注意上面的代码中填写你正确的 <code>privacy.js</code> 路径。</p>\n<h1 id=\"本文参考\"><a class=\"markdownIt-Anchor\" href=\"#本文参考\"></a> 本文参考</h1>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_43762932/article/details/129408876\">获取 IP 地址信息的 API 合集_api 地址_psonh 的博客-CSDN 博客</a></li>\n<li><a href=\"https://juejin.cn/post/7183234641816453175\">JavaScript 获取用户操作系统信息及浏览器信息 - 掘金 (juejin.cn)</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse\">JSON.parse() - JavaScript | MDN (mozilla.org)</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice\">Array.prototype.slice() - JavaScript | MDN (mozilla.org)</a></li>\n<li><a href=\"https://blog.zhheo.com/privacy/\">隐私政策 | 张洪 Heo (zhheo.com)</a></li>\n<li><a href=\"https://blog.zhheo.com/p/70bd84fc.html\">js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)</a></li>\n</ul>\n","raw":"---\ntitle: 页面展示用户 IP 地址及地理位置信息\ntags:\n  - API\n  - IP\n  - UA\ncover: 'https://cdn.gallery.uuanqin.top/img/1590736606072ip.webp'\ndescription: 利用 API 获取 IP 地址信息，这也是对 Heo 方案的改进\nabbrlink: 25f6686b\ncategories:\n  - 博客站点维护\ndate: 2023-09-09 16:13:29\ntop_img:\n---\n\n最近开始筹备隐私政策的撰写了，注意到 [洪涝 Heo](https://blog.zhheo.com) 的隐私政策有这样一个表格，感觉有趣，尝试借鉴一下：\n\n![](https://cdn.gallery.uuanqin.top/img/20230909161740.webp)\n\nHeo 发布过这一教程：[js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)](https://blog.zhheo.com/p/70bd84fc.html) 但是近期该 API 出现了一些问题（从上图你可以发现其中的问题所在）。下面我通过使用另一个接口： https://2023.ipchaxun.com/ 来尝试实现这个功能。\n\n# 实现效果\n\n<script src=\"/js/privacy.js\"></script>\n\n| 类型<div style=\"width:100px\"> | 信息                              |\n| :---------------------------: | :-------------------------------- |\n|            IP 地址            | <div id=\"userAgentIp\"></div>      |\n|             国家              | <div id=\"userAgentCountry\"></div> |\n|             省份              | <div id=\"userAgentRegion\"></div>  |\n|             城市              | <div id=\"userAgentCity\"></div>    |\n|            运营商             | <div id=\"userAgentIsp\"></div>     |\n|              UA               | <div id=\"userAgent\"></div>        |\n\n<script type=\"text/javascript\">getIpInfo()</script>\n\n# 编写新的 JS 文件\n\n```js\n// 获取ip\nfunction getIpInfo(){\n    var path = 'https://2024.ipchaxun.com/'; // 实测这网址会更新，比如刚写这篇文章时接口地址是2023\n    if(path !== undefined){\n\t    // 第一步：建立所需的对象\n        var httpRequest = new XMLHttpRequest();\n        // 第二步：打开连接  将请求参数写在url中  ps:\"./Ptest.php?name=test&nameone=testone\"\n        httpRequest.open('GET', path , true);\n        httpRequest.send();//第三步：发送请求  将请求参数写在URL中\n        /**\n         * 获取数据后的处理程序\n         */\n        httpRequest.onreadystatechange = function () {\n            if (httpRequest.readyState == 4 && httpRequest.status == 200) {\n                var info = httpRequest.responseText;//获取到json字符串，还需解析\n                var obj = JSON.parse(info)\n                const ip = obj.ip;\n                document.getElementById(\"userAgentIp\").innerHTML = obj.ip;\n                document.getElementById(\"userAgentCountry\").innerHTML = obj.data[0];\n                document.getElementById(\"userAgentRegion\").innerHTML = obj.data[1];\n                document.getElementById(\"userAgentCity\").innerHTML = obj.data[2];\n                document.getElementById(\"userAgentIsp\").innerHTML = obj.data[4];\n            }else{\n                console.log('privacy.js - 获取信息失败. httpRequest.readyState=%d, httpRequest.status=%d',httpRequest.readyState,httpRequest.status);\n            }\n        };\n    }else{\n        console.log('privacy.js - path === undefined');\n    }\n\n    var uaInfo = navigator.userAgent;\n    document.getElementById(\"userAgent\").innerHTML = uaInfo;\n}\n```\n\n这个文件是由洪涝 Heo https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/privacy/privacy.js 改动而来。我们不妨也将其命名为 `privacy.js` 吧。\n\n# 页面使用\n\nHexo 新建页面，写入以下内容即可。\n\n```markdown\n<script src=\"[你的 privacy.js 路径]\"></script>\n\n| 类型<div style=\"width:100px\"> | 信息                              |\n| :---------------------------: | :-------------------------------- |\n|            IP 地址            | <div id=\"userAgentIp\"></div>      |\n|             国家              | <div id=\"userAgentCountry\"></div> |\n|             省份              | <div id=\"userAgentRegion\"></div>  |\n|             城市              | <div id=\"userAgentCity\"></div>    |\n|            运营商             | <div id=\"userAgentIsp\"></div>     |\n|              UA               | <div id=\"userAgent\"></div>        |\n\n<script type=\"text/javascript\">getIpInfo()</script>\n```\n\n注意上面的代码中填写你正确的 `privacy.js` 路径。\n\n# 本文参考\n\n- [获取 IP 地址信息的 API 合集\\_api 地址\\_psonh 的博客-CSDN 博客](https://blog.csdn.net/qq_43762932/article/details/129408876)\n- [JavaScript 获取用户操作系统信息及浏览器信息 - 掘金 (juejin.cn)](https://juejin.cn/post/7183234641816453175)\n- [JSON.parse() - JavaScript | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)\n- [Array.prototype.slice() - JavaScript | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice)\n- [隐私政策 | 张洪 Heo (zhheo.com)](https://blog.zhheo.com/privacy/)\n- [js 获取用户 IP 和地理位置信息、UA 并展示 | 张洪 Heo (zhheo.com)](https://blog.zhheo.com/p/70bd84fc.html)\n","categories":[{"name":"博客站点维护","api":"api/categories/博客站点维护.json"}],"tags":[{"name":"API","api":"api/tags/API.json"},{"name":"IP","api":"api/tags/IP.json"},{"name":"UA","api":"api/tags/UA.json"}]},"api":"api/posts/p/25f6686b.json"}